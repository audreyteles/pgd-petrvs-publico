"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[150],{6150:(ri,K,s)=>{s.r(K),s.d(K,{PlanoTrabalhoModule:()=>li});var h=s(6610),aa=s(1260),f=s(1620),b=s(6819),u=s(3308),G=s(1641),ta=s(2119),S=s(6867),ea=s(5374),ya=s(9047),oa=s(6268),F=s(3535),w=s(5413),ia=s(9276),R=s(5464),na=s(24),Ga=s(3609),a=s(3279),O=s(114),Ra=s(4734),E=s(7363),U=s(16),x=s(5524),I=s(8857),la=s(5556);const Ia=["usuario"],Pa=["unidade"],Sa=["programa"],Fa=["tipoDocumento"],Oa=["tipoModalidade"];let Ya=(()=>{class i extends na.n{constructor(t){super(t,R.C,S.x),this.injector=t,this.validate=(e,o)=>{let n=null;return"tipo_documento_id"==o&&!e?.value?.length&&this.form?.controls?.numero_processo?.value?.length&&(n="Obrigat\xf3rio"),n},this.formValidation=e=>{if(!this.tipoDocumento?.selectedEntity&&e?.controls.tipo_documento_id.value?.length)return"Aguarde o carregamento do tipo de documento"},this.titleEdit=e=>"Editando "+this.lex.translate("TCR")+" "+this.lex.translate("do Plano de Trabalho")+": "+(e?.usuario?.nome||""),this.join=["unidade","usuario","programa.template_tcr","tipo_modalidade","documento","documentos","atividades.atividade"],this.unidadeDao=t.get(F.s),this.programaDao=t.get(ea.X),this.usuarioDao=t.get(w._),this.tipoDocumentoDao=t.get(ya.Y),this.allPages=t.get(ia.v),this.tipoModalidadeDao=t.get(oa.U),this.documentoDao=t.get(ta.c),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},programa_id:{default:""},usuario_id:{default:""},unidade_id:{default:""},documento_id:{default:""},documentos:{default:[]},tipo_documento_id:{default:""},numero_processo:{default:""},vinculadas:{default:!0},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"}},this.cdRef,this.validate)}onVinculadasChange(t){this.cdRef.detectChanges()}loadData(t,e){var o=this;return(0,u.A)(function*(){let n=Object.assign({},e.value);n=o.util.fillForm(n,t),yield Promise.all([o.unidade.loadSearch(t.unidade||t.unidade_id),o.usuario.loadSearch(t.usuario||t.usuario_id),o.programa.loadSearch(t.programa||t.programa_id),o.tipoModalidade.loadSearch(t.tipo_modalidade||t.tipo_modalidade_id)]),o.processo&&(n.id_processo=o.processo.id_processo,n.numero_processo=o.processo.numero_processo),n.data_inicio=o.auth.hora,e.patchValue(n)})()}initializeData(t){var e=this;return(0,u.A)(function*(){e.entity=yield e.dao.getById(e.metadata.plano_trabalho.id,e.join),e.processo=e.metadata?.processo,yield e.loadData(e.entity,t)})()}saveData(t){return new Promise((e,o)=>{e(new Ga.p(Object.assign(this.form.value,{codigo_tipo_documento:this.tipoDocumento?.selectedEntity?.codigo})))})}get formaContagemCargaHoraria(){const t=this.form?.controls.forma_contagem_carga_horaria?.value||"DIA";return"DIA"==t?"day":"SEMANA"==t?"week":"mouth"}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["plano-trabalho-form-termo"]],viewQuery:function(e,o){if(1&e&&(a.GBs(G.Q,5),a.GBs(Ia,5),a.GBs(Pa,5),a.GBs(Sa,5),a.GBs(Fa,5),a.GBs(Oa,5)),2&e){let n;a.mGM(n=a.lsd())&&(o.editableForm=n.first),a.mGM(n=a.lsd())&&(o.usuario=n.first),a.mGM(n=a.lsd())&&(o.unidade=n.first),a.mGM(n=a.lsd())&&(o.programa=n.first),a.mGM(n=a.lsd())&&(o.tipoDocumento=n.first),a.mGM(n=a.lsd())&&(o.tipoModalidade=n.first)}},features:[a.Vt3],decls:25,vars:41,consts:[["programa",""],["usuario",""],["unidade",""],["tipoModalidade",""],["tipoDocumento",""],["initialFocus","programa_id",3,"submit","cancel","form","disabled","title"],["collapse","",3,"title","collapsed"],[1,"row"],["disabled","","controlName","programa_id",3,"size","dao"],["disabled","","controlName","usuario_id",3,"size","dao"],["disabled","","controlName","unidade_id",3,"size","dao"],["disabled","","controlName","tipo_modalidade_id",3,"size","dao"],["numbers","","disabled","","label","% prod.","icon","bi bi-hourglass-split","controlName","ganho_produtividade",3,"size","control","labelInfo"],["label","H. Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["disabled","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","In\xedcio da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","Final","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Final da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","C. Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria",3,"size","unit","control","labelInfo"],["label","H. Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["disabled","","label","Data e hora","controlName","data_inicio","labelInfo","Data de cadastro do termo",3,"size","control"],["controlName","numero_processo","disabled","","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"label","size","control"],["controlName","tipo_documento_id","required","",3,"size","disabled","dao"],["label","Vinculadas","controlName","vinculadas","labelInfo","Se inclui as atividades das unidades vinculadas a unidade do plano",3,"change","disabled","size","control"]],template:function(e,o){if(1&e){const n=a.RV6();a.j41(0,"editable-form",5),a.bIt("submit",function(){return a.eBV(n),a.Njj(o.onSaveData())})("cancel",function(){return a.eBV(n),a.Njj(o.onCancel())}),a.j41(1,"separator",6)(2,"div",7),a.nrm(3,"input-search",8,0)(5,"input-search",9,1),a.k0s(),a.j41(7,"div",7),a.nrm(8,"input-search",10,2)(10,"input-search",11,3)(12,"input-text",12)(13,"input-display",13),a.k0s(),a.j41(14,"div",7),a.nrm(15,"input-datetime",14)(16,"input-datetime",15)(17,"input-workload",16)(18,"input-display",17),a.k0s()(),a.j41(19,"div",7),a.nrm(20,"input-datetime",18)(21,"input-text",19)(22,"input-search",20,4),a.j41(24,"input-switch",21),a.bIt("change",function(d){return a.eBV(n),a.Njj(o.onVinculadasChange(d))}),a.k0s()()()}2&e&&(a.Y8G("form",o.form)("disabled",o.formDisabled)("title",o.isModal?"":o.title),a.R7$(),a.Y8G("title",o.lex.translate("Plano de trabalho"))("collapsed",!1),a.R7$(2),a.Y8G("size",6)("dao",o.programaDao),a.R7$(2),a.Y8G("size",6)("dao",o.usuarioDao),a.R7$(3),a.Y8G("size",5)("dao",o.unidadeDao),a.R7$(2),a.Y8G("size",3)("dao",o.tipoModalidadeDao),a.R7$(2),a.Y8G("size",2)("control",o.form.controls.ganho_produtividade)("labelInfo","Percentual de ganho de produtividade (Ser\xe1 descontado do "+o.lex.translate("tempo pactuado")+")"),a.BMQ("maxlength",250),a.R7$(),a.Y8G("size",2)("control",o.form.controls.tempo_proporcional),a.R7$(2),a.Y8G("size",3)("control",o.form.controls.data_inicio),a.R7$(),a.Y8G("size",3)("control",o.form.controls.data_fim),a.R7$(),a.Y8G("size",3)("unit",o.formaContagemCargaHoraria)("control",o.form.controls.carga_horaria)("labelInfo","Carga hor\xe1ria"+o.lex.translate("do usu\xe1rio")),a.R7$(),a.Y8G("size",3)("control",o.form.controls.tempo_total),a.R7$(2),a.Y8G("size",3)("control",o.form.controls.data_inicio),a.R7$(),a.Y8G("label","N\xfamero "+o.lex.translate("Processo"))("size",3)("control",o.form.controls.numero_processo),a.BMQ("maxlength",250),a.R7$(),a.Y8G("size",4)("disabled",null!=o.form.controls.numero_processo.value&&o.form.controls.numero_processo.value.length?void 0:"true")("dao",o.tipoDocumentoDao),a.R7$(2),a.Y8G("disabled",null!=o.entity&&null!=o.entity.atividades&&o.entity.atividades.length?"true":void 0)("size",2)("control",o.form.controls.vinculadas))},dependencies:[G.Q,O.S,Ra.Q,E.O,U.H,x.r,I.F,la.j]})}return i})();var ka=s(9344),ra=s(5624),Y=s(4450),Na=s(2736),$a=s(2342),ja=s(314),V=s(2075),L=s(6774),xa=s(9209),Va=s(6336),wa=s(5121),Ua=s(6009),A=s(5611),k=s(4795),La=s(2701),Ba=s(6190),Ma=s(9416),sa=s(8717),B=s(976),N=s(2034),$=s(5852),da=s(158),M=s(3678),P=s(5201),ca=s(8311);const za=["origem"],Xa=["planoEntrega"],Ha=["entrega"],z=()=>["PROPRIA_UNIDADE","OUTRA_UNIDADE"],qa=()=>["entregas.entrega:id,nome","unidade"],Ja=i=>["unidade_id","==",i],ua=()=>["status","==","ATIVO"],Qa=(i,l)=>[i,l],Wa=i=>[i],Za=i=>({unidade_id:i,status:"ATIVO"}),ma=i=>({filter:i}),Ka=()=>({status:"ATIVO"});function at(i,l){1&i&&(a.j41(0,"div",22)(1,"span")(2,"strong"),a.EFF(3,"Origem"),a.k0s()()())}function tt(i,l){if(1&i&&a.nrm(0,"badge",31),2&i){const t=a.XpG().row,e=a.XpG();a.Y8G("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"DESCONHECIDO")("icon",e.entityService.getIcon("Unidade"))}}function et(i,l){if(1&i&&a.nrm(0,"badge",32),2&i){const t=a.XpG().row;a.Y8G("label",t.orgao)}}function ot(i,l){if(1&i&&(a.j41(0,"div",26)(1,"div",27),a.nrm(2,"badge",28),a.DNE(3,tt,1,2,"badge",29)(4,et,1,1,"badge",30),a.k0s()()),2&i){const t=l.row,e=a.XpG();a.R7$(2),a.Y8G("label",e.planoTrabalhoService.tipoEntrega(t,e.entity).titulo)("color",e.planoTrabalhoService.tipoEntrega(t,e.entity).cor),a.R7$(),a.Y8G("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),a.R7$(),a.Y8G("ngIf",null==t.orgao?null:t.orgao.length)}}function it(i,l){if(1&i){const t=a.RV6();a.j41(0,"input-search",36,15),a.bIt("change",function(o){a.eBV(t);const n=a.XpG(2);return a.Njj(n.onPlanoEntregaChange(o))}),a.k0s()}if(2&i){a.XpG();const t=a.sdS(1),e=a.XpG();a.Y8G("placeholder","Selecione o "+e.lex.translate("Plano de entrega"))("join",a.lJ4(5,qa))("where","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.l_i(9,Qa,a.eq3(6,Ja,null==e.entity?null:e.entity.unidade_id),a.lJ4(8,ua)):a.eq3(13,Wa,a.lJ4(12,ua)))("selectParams","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.eq3(17,ma,a.eq3(15,Za,null==e.entity?null:e.entity.unidade_id)):a.eq3(20,ma,a.lJ4(19,Ka)))("dao",e.planoEntregaDao)}}function nt(i,l){1&i&&a.nrm(0,"input-text",37,16),2&i&&a.BMQ("maxlength",250)}function lt(i,l){if(1&i){const t=a.RV6();a.j41(0,"input-select",33,14),a.bIt("change",function(){const o=a.eBV(t).row,n=a.XpG();return a.Njj(n.onOrigemChange(o))}),a.k0s(),a.DNE(2,it,2,22,"input-search",34)(3,nt,2,1,"input-text",35)}if(2&i){const t=a.sdS(1),e=a.XpG();a.Y8G("control",e.form.controls.origem)("items",e.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO),a.R7$(2),a.Y8G("ngIf",a.lJ4(4,z).includes(null==t?null:t.value)),a.R7$(),a.Y8G("ngIf","OUTRO_ORGAO"==(null==t?null:t.value))}}function rt(i,l){1&i&&(a.j41(0,"span")(1,"strong"),a.EFF(2,"Entrega"),a.k0s()())}function st(i,l){if(1&i&&(a.j41(0,"div",40),a.nrm(1,"badge",41)(2,"badge",42),a.k0s()),2&i){const t=a.XpG().row,e=a.XpG();a.R7$(),a.Y8G("label",e.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)),a.R7$(),a.Y8G("label",e.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim))}}function dt(i,l){if(1&i&&(a.j41(0,"small"),a.EFF(1),a.k0s(),a.DNE(2,st,3,2,"div",38),a.nrm(3,"reaction",39)),2&i){const t=l.row,e=a.XpG();a.R7$(),a.JRh(e.planoTrabalhoService.tipoEntrega(t,e.entity).descricao),a.R7$(),a.Y8G("ngIf",a.lJ4(3,z).includes(e.planoTrabalhoService.tipoEntrega(t,e.entity).tipo)),a.R7$(),a.Y8G("entity",t)}}function ct(i,l){if(1&i){const t=a.RV6();a.j41(0,"input-select",44,17),a.bIt("change",function(o){a.eBV(t);const n=a.XpG(2);return a.Njj(n.onEntregaChange(o))}),a.k0s()}if(2&i){const t=a.XpG(2);a.Y8G("control",t.form.controls.plano_entrega_entrega_id)("items",t.entregas)}}function ut(i,l){if(1&i&&(a.j41(0,"div",40),a.nrm(1,"badge",41)(2,"badge",42),a.k0s()),2&i){const t=a.XpG(2);a.R7$(),a.Y8G("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_inicio)),a.R7$(),a.Y8G("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_fim))}}function mt(i,l){if(1&i&&a.DNE(0,ct,2,2,"input-select",43)(1,ut,3,2,"div",38),2&i){const t=a.XpG();a.Y8G("ngIf",a.lJ4(2,z).includes(null==t.origem?null:t.origem.value)),a.R7$(),a.Y8G("ngIf",null==t.entrega?null:t.entrega.selectedItem)}}function pt(i,l){if(1&i&&(a.j41(0,"div")(1,"small"),a.nrm(2,"badge",46),a.k0s(),a.j41(3,"small"),a.nrm(4,"badge",47),a.k0s()()),2&i){const t=a.XpG(2);a.R7$(2),a.Y8G("color","warning")("label",t.totalForcaTrabalho+"%"),a.R7$(2),a.Y8G("color","secondary")("label",t.totalForcaTrabalho-100+"%")}}function _t(i,l){if(1&i&&(a.j41(0,"small"),a.nrm(1,"badge",46),a.k0s()),2&i){const t=a.XpG(2);a.R7$(),a.Y8G("color",100==t.totalForcaTrabalho?"success":"warning")("label",t.totalForcaTrabalho+"%")}}function ht(i,l){if(1&i&&(a.j41(0,"div",22),a.DNE(1,pt,5,4,"div",45)(2,_t,2,2,"ng-template",null,18,a.C5r),a.k0s()),2&i){const t=a.sdS(3),e=a.XpG();a.R7$(),a.Y8G("ngIf",e.totalForcaTrabalho>100)("ngIfElse",t)}}function gt(i,l){if(1&i&&(a.j41(0,"small"),a.EFF(1),a.k0s()),2&i){const t=l.row;a.R7$(),a.JRh(t.forca_trabalho+"%")}}function ft(i,l){if(1&i){const t=a.RV6();a.j41(0,"input-text",48),a.bIt("change",function(){const o=a.eBV(t).row,n=a.XpG();return a.Njj(n.onForcaTrabalhoChange(o))}),a.k0s()}if(2&i){const t=a.XpG();a.Y8G("control",t.form.controls.forca_trabalho),a.BMQ("maxlength",250)}}function bt(i,l){1&i&&(a.j41(0,"div",22)(1,"span")(2,"strong"),a.EFF(3,"Descri\xe7\xe3o dos Trabalhos"),a.k0s()()())}function vt(i,l){if(1&i&&(a.j41(0,"div")(1,"small"),a.EFF(2),a.k0s()()),2&i){const t=a.XpG().row;a.R7$(2),a.JRh(t.descricao)}}function Tt(i,l){if(1&i&&a.DNE(0,vt,3,1,"div",45),2&i){const t=l.row,e=a.XpG(),o=a.sdS(30);a.Y8G("ngIf",t.descricao!=e.planoTrabalhoService.tipoEntrega(t,e.entity).descricao)("ngIfElse",o)}}function Ct(i,l){1&i&&(a.j41(0,"small"),a.EFF(1,"Detalhe/Descreva os trabalhos"),a.k0s())}function Et(i,l){if(1&i&&a.nrm(0,"input-textarea",49),2&i){const t=a.XpG();a.Y8G("rows",2)("control",t.form.controls.descricao)}}let X=(()=>{class i extends k.g{set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}set disabled(t){this._disabled!=t&&(this._disabled=t)}get disabled(){return this._disabled}set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set planoTrabalhoEditavel(t){this._planoTrabalhoEditavel!=t&&(this._planoTrabalhoEditavel=t)}get planoTrabalhoEditavel(){return this._planoTrabalhoEditavel}get items(){return this.gridControl.value||this.gridControl.setValue(new R.C),this.gridControl.value.entregas||(this.gridControl.value.entregas=[]),this.gridControl.value.entregas}constructor(t){super(t),this.injector=t,this.atualizaPlanoTrabalhoEvent=new a.bkB,this.options=[],this.totalForcaTrabalho=0,this.entregas=[],this._disabled=!1,this._planoTrabalhoEditavel=!0,this.validate=(e,o)=>{let n=null;return["forca_trabalho"].indexOf(o)>=0&&1==e.value||(["forca_trabalho"].indexOf(o)>=0&&!e.value&&(n="Obrigat\xf3rio!"),["descricao"].indexOf(o)>=0&&!e.value?.length&&(n="Obrigat\xf3rio!"),["forca_trabalho"].indexOf(o)>=0&&(e.value<1||e.value>100)&&(n="Deve estar entre 1 e 100"),["plano_entrega_entrega_id"].indexOf(o)>=0&&(["PROPRIA_UNIDADE","OUTRA_UNIDADE"].includes(this.form?.controls.origem.value)&&!e.value&&(n="Obrigat\xf3rio!"),this.entity?.entregas?.filter(r=>!!r.plano_entrega_entrega_id&&r.id!=this.grid?.editing?.id).find(r=>r.plano_entrega_entrega_id==e.value)&&(n="Esta entrega est\xe1 em duplicidade!"))),n},this.dao=t.get(Ba.R),this.cdRef=t.get(a.gRc),this.planoTrabalhoDao=t.get(S.x),this.planoEntregaDao=t.get(Ma.m),this.planoTrabalhoService=t.get(Y.V),this.peeDao=t.get(sa.o),this.unidadeService=t.get(B.S),this.join=["entrega","plano_entrega_entrega.entrega","plano_entrega_entrega.plano_entrega:id,unidade_id","plano_entrega_entrega.plano_entrega.unidade:id,sigla"],this.form=this.fh.FormBuilder({origem:{default:null},orgao:{default:null},descricao:{default:""},forca_trabalho:{default:1},plano_trabalho_id:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}validateEntregas(){let t={start:this.entity.data_inicio,end:this.entity.data_fim};for(let e of this.items){let o=e.plano_entrega_entrega;if(o&&(!(o.data_fim?o.data_fim:o.data_inicio.getTime()<=this.entity.data_fim.getTime()?this.entity.data_fim:void 0)||!this.util.intersection([{start:o.data_inicio,end:o.data_fim||o.data_inicio},t])))return this.lex.translate("Entrega")+" "+o.descricao+" possui datas incompat\xedveis (in\xedcio "+this.util.getDateFormatted(o.data_inicio)+(o.data_fim?"e fim "+this.util.getDateFormatted(o.data_fim):"")+")"}}ngOnInit(){var t=()=>super.ngOnInit,e=this;return(0,u.A)(function*(){t().call(e),e.entity=e.metadata?.entity||e.entity,e.totalForcaTrabalho=Math.round(100*e.somaForcaTrabalho(e.entity?.entregas))/100,e.entity._metadata=e.entity._metadata||{},e.entity._metadata.novaEntrega=void 0})()}addEntrega(){var t=this;return(0,u.A)(function*(){return Object.assign(new La.I,{_status:"ADD",id:t.dao.generateUuid(),plano_trabalho_id:t.entity?.id})})()}loadEntrega(t,e){var o=this;return(0,u.A)(function*(){let n=e;if(t.controls.descricao.setValue(e.descricao),t.controls.forca_trabalho.setValue(e.forca_trabalho),t.controls.plano_trabalho_id.setValue(e.plano_trabalho_id),t.controls.orgao.setValue(null),t.controls.plano_entrega_entrega_id.setValue(null),e.plano_entrega_entrega&&(t.controls.plano_entrega_id.setValue(e.plano_entrega_entrega.plano_entrega.id),t.controls.plano_entrega_entrega_id.setValue(e.plano_entrega_entrega_id)),"ADD"!=n._status||t.controls.plano_entrega_id.value)n.plano_entrega_entrega?.plano_entrega?.unidade_id==o.entity.unidade_id?(t.controls.origem.setValue("PROPRIA_UNIDADE"),yield o.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),t.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.plano_entrega_entrega?(t.controls.origem.setValue("OUTRA_UNIDADE"),yield o.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),t.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.orgao?.length?(t.controls.origem.setValue("OUTRO_ORGAO"),t.controls.orgao.setValue(n.orgao)):t.controls.origem.setValue("SEM_ENTREGA");else{t.controls.origem.setValue("PROPRIA_UNIDADE");let r=yield o.planoEntregaDao.query({where:[["unidade_id","==",o.entity.unidade_id],["status","==","ATIVO"]]}).asPromise();t.controls.plano_entrega_id.setValue(r[0].id)}})()}removeEntrega(t){var e=this;return(0,u.A)(function*(){if(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir?")){e.loading=!0;try{e.isNoPersist?Object.assign(t,{_status:"DELETE"}):yield e.dao?.delete(t.id)}finally{e.loading=!1,e.atualizaPlanoTrabalhoEvent.emit(e.entity.id)}return e.totalForcaTrabalho=Math.round(100*(e.totalForcaTrabalho-1*t.forca_trabalho))/100,!e.isNoPersist}return!1})()}saveEntrega(t,e){var o=this;return(0,u.A)(function*(){o.entity._metadata=o.entity._metadata||{},o.entity._metadata.novaEntrega=e,o.entity._metadata.novaEntrega.plano_entrega_entrega_id=o.form?.controls.plano_entrega_entrega_id.value,o.entity._metadata.novaEntrega.orgao=o.form?.controls.orgao.value,o.entity._metadata.novaEntrega.descricao=o.form?.controls.descricao.value,o.entity._metadata.novaEntrega.forca_trabalho=o.form?.controls.forca_trabalho.value,o.loading=!0;try{o.isNoPersist||(yield o.dao.save(o.entity._metadata.novaEntrega,o.join))}catch(n){o.error(n.message?n.message:n.toString()||n)}finally{e.forca_trabalho=1*o.form?.controls.forca_trabalho.value,e.plano_entrega_entrega=o.entrega?.selectedItem?.data||null,o.totalForcaTrabalho=Math.round(100*o.somaForcaTrabalho(o.entity?.entregas))/100,o.loading=!1}return o.entity._metadata.novaEntrega})()}saveEndEntrega(t){this.entity._metadata=null,this.atualizaPlanoTrabalhoEvent.emit(this.entity.id)}somaForcaTrabalho(t=[]){return t.map(e=>1*e.forca_trabalho).reduce((e,o)=>e+o,0)}carregarEntregas(t){var e=this;return(0,u.A)(function*(){let o="string"==typeof t?yield e.planoEntregaDao.getById(t,["entregas.entrega:id,nome","unidade"]):t,n={id:o?.id,unidade_id:o?.unidade_id,unidade:o?.unidade};e.entregas=o?.entregas.map(r=>Object.assign({},{key:r.id,value:r.descricao||r.entrega?.nome||"Desconhecido",data:Object.assign(r,{plano_entrega:n})}))||[],e.entregas.sort((r,d)=>r.value>d.value?1:-1),e.entregas.find(r=>r.key==e.form.controls.plano_entrega_entrega_id.value)||e.form.controls.plano_entrega_entrega_id.setValue(null)})()}onOrigemChange(t){var e=this;return(0,u.A)(function*(){let o=e.form.controls.origem.value;e.cdRef.detectChanges(),"OUTRO_ORGAO"==o?e.form?.controls.plano_entrega_entrega_id.setValue(null):"SEM_ENTREGA"==o?(e.form?.controls.orgao.setValue(null),e.form?.controls.plano_entrega_entrega_id.setValue(null)):"OUTRA_UNIDADE"==o&&(e.form?.controls.orgao.setValue(null),e.form?.controls.plano_entrega_id.value||(e.loading=!0,e.planoEntrega?.onSelectClick(new Event("SELECT")),e.loading=!1))})()}onPlanoEntregaChange(t){let e=this.planoEntrega?.selectedEntity;this.carregarEntregas(e)}onEntregaChange(t){}onForcaTrabalhoChange(t){let e=this.items.findIndex(o=>o.id==t.id);this.totalForcaTrabalho=Math.round(100*(this.somaForcaTrabalho(this.grid?.items)-1*this.items[e].forca_trabalho+1*this.form?.controls.forca_trabalho.value))/100}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["plano-trabalho-list-entrega"]],viewQuery:function(e,o){if(1&e&&(a.GBs(G.Q,5),a.GBs(A._,5),a.GBs(za,5),a.GBs(Xa,5),a.GBs(Ha,5)),2&e){let n;a.mGM(n=a.lsd())&&(o.editableForm=n.first),a.mGM(n=a.lsd())&&(o.grid=n.first),a.mGM(n=a.lsd())&&(o.origem=n.first),a.mGM(n=a.lsd())&&(o.planoEntrega=n.first),a.mGM(n=a.lsd())&&(o.entrega=n.first)}},inputs:{control:"control",entity:"entity",disabled:"disabled",noPersist:"noPersist",cdRef:"cdRef",planoTrabalhoEditavel:"planoTrabalhoEditavel"},outputs:{atualizaPlanoTrabalhoEvent:"atualizaPlanoTrabalhoEvent"},features:[a.Vt3],decls:34,vars:39,consts:[["gridEntregas",""],["titleOrigem",""],["columnOrigem",""],["editOrigem",""],["titleEntrega",""],["columnEntrega",""],["editEntrega",""],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["editForcaTrabalho",""],["titleDescricao",""],["columnDescricao",""],["solicitarDescricao",""],["editDescricao",""],["origem",""],["planoEntrega",""],["orgao",""],["entrega",""],["umCHD",""],["noMargin","","editable","",3,"items","form","selectable","minHeight","join","groupBy","add","remove","save","load","saveEnd","hasDelete","hasEdit","hasAdd"],[3,"titleTemplate","template","editTemplate","verticalAlign","width","align"],[3,"width","titleTemplate","template","editTemplate","verticalAlign"],[1,"text-center"],[3,"titleTemplate","title","template","editTemplate","width","align","titleHint"],[3,"minWidth","maxWidth","titleTemplate","template","editTemplate","verticalAlign","align"],["type","options"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["controlName","origem","controlName","origem",3,"change","control","items"],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change",4,"ngIf"],["controlName","orgao","placeholder","\xd3rg\xe3o",4,"ngIf"],["label","","controlName","plano_entrega_id",3,"change","placeholder","join","where","selectParams","dao"],["controlName","orgao","placeholder","\xd3rg\xe3o"],["class","w-100",4,"ngIf"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],[1,"w-100"],["color","light","icon","bi bi-box-arrow-in-right","hint","Data de in\xedcio",3,"label"],["color","light","icon","bi bi-box-arrow-right","hint","Data de t\xe9rmino",3,"label"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change",4,"ngIf"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"change","control","items"],[4,"ngIf","ngIfElse"],["icon","bi bi-calculator",3,"color","label"],["icon","bi bi-intersect",3,"color","label"],["number","","sufix","%","controlName","forca_trabalho",3,"change","control"],["controlName","descricao",3,"rows","control"]],template:function(e,o){if(1&e&&(a.j41(0,"grid",19,0)(2,"columns")(3,"column",20),a.DNE(4,at,4,0,"ng-template",null,1,a.C5r)(6,ot,5,4,"ng-template",null,2,a.C5r)(8,lt,4,5,"ng-template",null,3,a.C5r),a.k0s(),a.j41(10,"column",21),a.DNE(11,rt,3,0,"ng-template",22,4,a.C5r)(13,dt,4,4,"ng-template",null,5,a.C5r)(15,mt,2,3,"ng-template",null,6,a.C5r),a.k0s(),a.j41(17,"column",23),a.DNE(18,ht,4,2,"ng-template",null,7,a.C5r)(20,gt,2,1,"ng-template",null,8,a.C5r)(22,ft,1,2,"ng-template",null,9,a.C5r),a.k0s(),a.j41(24,"column",24),a.DNE(25,bt,4,0,"ng-template",null,10,a.C5r)(27,Tt,1,2,"ng-template",null,11,a.C5r)(29,Ct,2,0,"ng-template",null,12,a.C5r)(31,Et,1,2,"ng-template",null,13,a.C5r),a.k0s(),a.nrm(33,"column",25),a.k0s()()),2&e){const n=a.sdS(5),r=a.sdS(7),d=a.sdS(9),c=a.sdS(12),_=a.sdS(14),m=a.sdS(16),g=a.sdS(19),p=a.sdS(21),C=a.sdS(23),y=a.sdS(26),j=a.sdS(28),D=a.sdS(32);a.Y8G("items",o.items)("form",o.form)("selectable",!1)("minHeight",o.items.length>2?0:300)("join",o.join)("groupBy",o.groupBy)("add",o.addEntrega.bind(o))("remove",o.removeEntrega.bind(o))("save",o.saveEntrega.bind(o))("load",o.loadEntrega.bind(o))("saveEnd",o.saveEndEntrega.bind(o))("hasDelete",!o.disabled&&o.planoTrabalhoEditavel)("hasEdit",!o.disabled&&o.planoTrabalhoEditavel)("hasAdd",!o.disabled&&o.planoTrabalhoEditavel),a.R7$(3),a.Y8G("titleTemplate",n)("template",r)("editTemplate",d)("verticalAlign","middle")("width",300)("align","center"),a.R7$(7),a.Y8G("width",350)("titleTemplate",c)("template",_)("editTemplate",m)("verticalAlign","middle"),a.R7$(7),a.Y8G("titleTemplate",g)("title","% CHD")("template",p)("editTemplate",C)("width",100)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),a.R7$(7),a.Y8G("minWidth",150)("maxWidth",250)("titleTemplate",y)("template",j)("editTemplate",D)("verticalAlign","middle")("align","center")}},dependencies:[h.bT,A._,N.T,$.I,E.O,U.H,da.S,M.K,P.n,ca.T]})}return i})();const At=["gridAtividades"],Dt=["gridDocumentos"],yt=["tabs"],Gt=["usuario"],Rt=["programa"],It=["unidade"],Pt=["tipoModalidade"],St=["planoEntrega"],Ft=["atividade"],Ot=["entrega"],Yt=["documentos"],kt=()=>["afastamentos","lotacao","unidades","participacoes_programas"],Nt=()=>["usuario_id"],$t=()=>["usuario_id","programa_id","tipo_modalidade_id"];function jt(i,l){if(1&i&&(a.j41(0,"separator",27),a.nrm(1,"calendar-efemerides",28),a.k0s()),2&i){const t=a.XpG(2);a.R7$(),a.Y8G("efemerides",t.horasTotais)("partial",!1)}}function xt(i,l){if(1&i&&(a.j41(0,"separator",29),a.nrm(1,"calendar-efemerides",30),a.k0s()),2&i){const t=a.XpG(2);a.R7$(),a.Y8G("efemerides",t.horasParciais)}}function Vt(i,l){if(1&i){const t=a.RV6();a.qex(0),a.j41(1,"div",9)(2,"input-workload",22),a.bIt("change",function(o){a.eBV(t);const n=a.XpG();return a.Njj(n.onCargaHorariaChenge(o))}),a.k0s(),a.nrm(3,"input-timer",23)(4,"input-timer",24),a.k0s(),a.DNE(5,jt,2,2,"separator",25)(6,xt,2,1,"separator",26),a.bVm()}if(2&i){const t=a.XpG();a.R7$(2),a.Y8G("size",4)("unit",t.formaContagemCargaHoraria)("control",t.form.controls.carga_horaria)("unitChange",t.onFormaContagemCargaHorariaChange.bind(t)),a.R7$(),a.Y8G("size",4)("control",t.form.controls.tempo_total),a.R7$(),a.Y8G("size",4)("control",t.form.controls.tempo_proporcional),a.R7$(),a.Y8G("ngIf",t.horasTotais),a.R7$(),a.Y8G("ngIf",t.horasParciais)}}function wt(i,l){if(1&i&&a.nrm(0,"top-alert",31),2&i){const t=a.XpG();a.Y8G("message","Antes de incluir "+t.lex.translate("entrega")+" neste "+t.lex.translate("Plano de Trabalho")+", \xe9 necess\xe1rio selecionar "+t.lex.translate("a Unidade")+" e  o "+t.lex.translate("Programa")+"!")}}function Ut(i,l){if(1&i&&(a.j41(0,"div"),a.nrm(1,"plano-trabalho-list-entrega",32),a.k0s()),2&i){const t=a.XpG();a.R7$(),a.Y8G("disabled",t.formDisabled)("entity",t.entity)}}function Lt(i,l){if(1&i&&(a.j41(0,"tab",33)(1,"separator",18),a.nrm(2,"input-switch",34)(3,"input-editor",35),a.k0s(),a.j41(4,"separator",36),a.nrm(5,"input-switch",37)(6,"input-editor",38),a.k0s()()),2&i){const t=a.XpG();a.Y8G("label",t.lex.translate("Texto Complementar")),a.R7$(),a.Y8G("title","Texto complementar da "+t.lex.translate("unidade")),a.R7$(),a.Y8G("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("na unidade")),a.R7$(),a.Y8G("disabled",t.form.controls.editar_texto_complementar_unidade.value?void 0:"true")("dataset",t.planoDataset),a.R7$(2),a.Y8G("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("do usu\xe1rio")),a.R7$(),a.Y8G("disabled",t.form.controls.editar_texto_complementar_usuario.value?void 0:"true")("dataset",t.planoDataset)}}function Bt(i,l){if(1&i&&(a.j41(0,"tab",39)(1,"div",40),a.nrm(2,"documentos",41,5),a.k0s()()),2&i){const t=a.XpG(),e=a.sdS(12);a.Y8G("label",t.lex.translate("Termo")),a.R7$(2),a.Y8G("entity",t.entity)("disabled",t.formDisabled)("cdRef",t.cdRef)("needSign",t.planoTrabalhoService.needSign)("extraTags",t.planoTrabalhoService.extraTags)("editingId",t.formDisabled?void 0:t.editingId)("datasource",t.datasource)("template",null==e||null==e.selectedEntity?null:e.selectedEntity.template_tcr)}}let H=(()=>{class i extends na.n{constructor(t){super(t,R.C,S.x),this.injector=t,this.entregas=[],this.gestoresUnidadeExecutora=[],this.validate=(e,o)=>{let n=null;return["unidade_id","programa_id","usuario_id","tipo_modalidade_id"].indexOf(o)>=0&&!e.value?.length?n="Obrigat\xf3rio":["carga_horaria"].indexOf(o)>=0&&!e.value?n="Valor n\xe3o pode ser zero.":["data_inicio","data_fim"].includes(o)&&!this.util.isDataValid(e.value)?n="Inv\xe1lido":"data_fim"==o&&this.util.isDataValid(this.form?.controls.data_inicio.value)&&this.util.asTimestamp(e.value)<=this.util.asTimestamp(this.form.controls.data_inicio.value)?n="Menor que o in\xedcio":this.programa&&"data_inicio"==o&&e.value.getTime()<this.programa.selectedEntity?.data_inicio.getTime()?n="Menor que programa":this.programa&&"data_fim"==o&&e.value.getTime()>this.programa.selectedEntity?.data_fim.getTime()&&(n="Maior que programa"),n},this.formValidation=function(){var e=(0,u.A)(function*(o){return""});return function(o){return e.apply(this,arguments)}}(),this.titleEdit=e=>"Editando "+this.lex.translate("Plano de Trabalho")+": "+(e?.usuario?.apelido||""),this.join=["unidade.entidade","entregas.entrega","entregas.plano_entrega_entrega:id,plano_entrega_id","usuario","programa.template_tcr","tipo_modalidade","documento","documentos.assinaturas.usuario:id,nome,apelido","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega.unidade:id,nome,sigla","entregas.reacoes.usuario:id,nome,apelido"],this.joinPrograma=["template_tcr"],this.programaDao=t.get(ea.X),this.usuarioDao=t.get(w._),this.unidadeDao=t.get(F.s),this.documentoService=t.get(ka.s),this.templateService=t.get(Na.I),this.utilService=t.get($a.a),this.calendar=t.get(ra.I),this.allPages=t.get(ia.v),this.tipoModalidadeDao=t.get(oa.U),this.documentoDao=t.get(ta.c),this.planoTrabalhoService=t.get(Y.V),this.modalWidth=1300,this.planoDataset=this.dao.dataset(),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},unidade_id:{default:""},programa_id:{default:""},documento_id:{default:null},documentos:{default:[]},atividades:{default:[]},entregas:{default:[]},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"},editar_texto_complementar_unidade:{default:!1},editar_texto_complementar_usuario:{default:!1},unidade_texto_complementar:{default:""},usuario_texto_complementar:{default:""},criterios_avaliacao:{default:[]},criterio_avaliacao:{default:""}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!0,vigentesUnidadeExecutora:!1}}ngOnInit(){super.ngOnInit();const t=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["termos"].includes(t)?t:this.action,this.buscaGestoresUnidadeExecutora(this.entity?.unidade??null)}atualizarTcr(){this.entity=this.loadEntity();let o=this.planoTrabalhoService.atualizarTcr(this.planoTrabalho,this.entity,this.form.controls.usuario_texto_complementar.value,this.form.controls.unidade_texto_complementar.value);this.form?.controls.documento_id.setValue(o?.id),this.form?.controls.documentos.setValue(this.entity.documentos),this.datasource=o?.datasource||{},this.template=this.entity.programa?.template_tcr,this.editingId=["ADD","EDIT"].includes(o?._status||"")?o.id:void 0,this.cdRef.detectChanges()}get isTermos(){return"termos"==this.action}onUnidadeSelect(t){let e=this.unidade?.selectedEntity;this.entity.unidade=e,this.entity.unidade_id=e.id,this.form.controls.forma_contagem_carga_horaria.setValue(e?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(e?.texto_complementar_plano||""),this.unidadeDao.getById(e.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(o=>{this.buscaGestoresUnidadeExecutora(o)})}podeEditarTextoComplementar(t){return t==this.auth.unidadeGestor()?.id?void 0:"true"}onProgramaSelect(t){let e=t.entity;this.entity.programa_id=e.id,this.entity.programa=e,this.form?.controls.criterios_avaliacao.setValue(e.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity(),this.calculaTempos(),this.cdRef.detectChanges()}onUsuarioSelect(t){var e=this;this.form.controls.usuario_texto_complementar.setValue(t.entity?.texto_complementar_plano||""),this.form?.controls.unidade_id.value||t.entity.unidades?.every(function(){var o=(0,u.A)(function*(n){if(t.entity.lotacao.unidade_id==n.id){if(!e.form?.controls.programa_id.value){n.path.split("/").reverse();let c=0,_=0;for(;0==c;)yield e.programaDao.query({where:[["vigentesUnidadeExecutora","==",e.auth.unidade.id]]}).asPromise().then(m=>{m.length>0&&0==c&&(c=1,e.preencheUnidade(n),e.preenchePrograma(m[0]))}),_+=1}return!1}return!0});return function(n){return o.apply(this,arguments)}}()),this.calculaTempos(),this.cdRef.detectChanges()}preencheUnidade(t){this.form?.controls.unidade_id.setValue(t.id),this.entity.unidade=t,this.entity.unidade_id=t.id,this.form.controls.forma_contagem_carga_horaria.setValue(t?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(t?.texto_complementar_plano||""),this.unidadeDao.getById(t.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(e=>{this.buscaGestoresUnidadeExecutora(e)})}preenchePrograma(t){this.form?.controls.programa_id.setValue(t.id),this.entity.programa_id=t.id,this.entity.programa=t,this.form?.controls.criterios_avaliacao.setValue(t.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity()}onDataInicioChange(t){this.calculaTempos()}onDataFimChange(t){this.calculaTempos()}onCargaHorariaChenge(t){this.calculaTempos()}calculaTempos(){const t=this.form?.controls.data_inicio.value,e=this.form?.controls.data_fim.value,o=this.form?.controls.carga_horaria.value||8,n=this.usuario?.selectedEntity,r=this.unidade?.selectedEntity;n&&r&&this.util.isDataValid(t)&&this.util.isDataValid(e)&&this.util.asTimestamp(t)<this.util.asTimestamp(e)&&this.calendar.loadFeriadosCadastrados(r.id).then(d=>{this.horasTotais=this.calendar.calculaDataTempoUnidade(t,e,o,r,"ENTREGA",[],[]),this.horasParciais=this.calendar.calculaDataTempoUnidade(t,e,o,r,"ENTREGA",[],n.afastamentos),this.form?.controls.tempo_total.setValue(this.horasTotais.tempoUtil),this.form?.controls.tempo_proporcional.setValue(this.horasParciais.tempoUtil)})}loadData(t,e){var o=this;return(0,u.A)(function*(){o.planoTrabalho=new R.C(t),yield Promise.all([o.calendar.loadFeriadosCadastrados(t.unidade_id),o.usuario?.loadSearch(t.usuario||t.usuario_id),o.unidade?.loadSearch(t.unidade||t.unidade_id),o.programa?.loadSearch(t.programa||t.programa_id),o.tipoModalidade?.loadSearch(t.tipo_modalidade||t.tipo_modalidade_id)]);let n=Object.assign({},e.value);e.patchValue(o.util.fillForm(n,t)),o.calculaTempos(),o.atualizarTcr()})()}initializeData(t){var e=this;return(0,u.A)(function*(){if(e.isTermos)e.entity=yield e.dao.getById(e.urlParams.get("id"),e.join);else{e.entity=new R.C,e.entity.carga_horaria=e.auth.entidade?.carga_horaria_padrao||8,e.entity.forma_contagem_carga_horaria=e.auth.entidade?.forma_contagem_carga_horaria||"DIA",e.entity.unidade_id=e.auth.unidade.id;let n=yield e.programaDao.query({where:[["vigentesUnidadeExecutora","==",e.auth.unidade.id]],join:e.joinPrograma}).asPromise();e.preenchePrograma(n[n.length-1]),e.buscaGestoresUnidadeExecutora(e.auth.unidade),e.gestoresUnidadeExecutora.includes(e.auth.unidade.id)||(e.entity.usuario_id=e.auth.usuario.id)}yield e.loadData(e.entity,e.form);let o=new Date;o.setHours(0,0,0,0),e.form?.controls.data_inicio.setValue(o),e.form?.controls.data_fim.setValue("")})()}loadEntity(){let t=this.util.fill(new R.C,this.entity);return t=this.util.fillForm(t,this.form.value),t.usuario=this.usuario.selectedEntity||this.entity?.usuario,t.unidade=this.unidade?.selectedEntity||this.entity?.unidade,t.programa=this.programa?.selectedEntity||this.entity?.programa,t.tipo_modalidade=this.tipoModalidade.selectedEntity||this.entity?.tipo_modalidade,t}saveData(t){var e=this;return(0,u.A)(function*(){e.submitting=!0;try{e.atualizarTcr(),e.documentos?.saveData(),e.submitting=!0,e.entity.documentos=e.entity.documentos.filter(r=>["ADD","EDIT","DELETE"].includes(r._status||""));let o=[e.dao.save(e.entity,e.join)];e.form.controls.editar_texto_complementar_unidade.value&&o.push(e.unidadeDao.update(e.entity.unidade_id,{texto_complementar_plano:e.form.controls.unidade_texto_complementar.value})),e.form.controls.editar_texto_complementar_usuario.value&&o.push(e.usuarioDao.update(e.entity.usuario_id,{texto_complementar_plano:e.form.controls.usuario_texto_complementar.value}));let n=yield Promise.all(o);e.entity=n[0]}finally{e.submitting=!1}return!0})()}onTabSelect(t){"TERMO"==t.key&&this.atualizarTcr()}documentoDynamicButtons(t){let e=[];return this.isTermos&&this.planoTrabalhoService.needSign(this.entity,t)&&e.push({hint:"Assinar",icon:"bi bi-pen",onClick:this.signDocumento.bind(this)}),e.push({hint:"Preview",icon:"bi bi-zoom-in",onClick:(n=>{this.dialog.html({title:"Termo de ades\xe3o",modalWidth:1e3},n.conteudo||"")}).bind(this)}),e}signDocumento(t){var e=this;return(0,u.A)(function*(){yield e.documentoService.sign([t]),e.cdRef.detectChanges()})()}get formaContagemCargaHoraria(){const t=this.form?.controls.forma_contagem_carga_horaria.value||"DIA";return"DIA"==t?"day":"SEMANA"==t?"week":"mouth"}onFormaContagemCargaHorariaChange(t){this.form.controls.forma_contagem_carga_horaria.setValue("day"==t?"DIA":"week"==t?"SEMANA":"MES")}isVigente(t){return this.form.controls.documento_id.value==t.id}buscaGestoresUnidadeExecutora(t){return t&&[t.gestor?.usuario_id,...t.gestores_substitutos?.map(e=>e.usuario_id),...t.gestores_delegados?.map(e=>e.usuario_id)].forEach(e=>{e&&this.gestoresUnidadeExecutora.push(e)}),this.gestoresUnidadeExecutora}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["plano-trabalho-form"]],viewQuery:function(e,o){if(1&e&&(a.GBs(G.Q,5),a.GBs(At,5),a.GBs(Dt,5),a.GBs(yt,5),a.GBs(Gt,5),a.GBs(Rt,5),a.GBs(It,5),a.GBs(Pt,5),a.GBs(St,5),a.GBs(Ft,5),a.GBs(Ot,5),a.GBs(Yt,5)),2&e){let n;a.mGM(n=a.lsd())&&(o.editableForm=n.first),a.mGM(n=a.lsd())&&(o.gridAtividades=n.first),a.mGM(n=a.lsd())&&(o.gridDocumentos=n.first),a.mGM(n=a.lsd())&&(o.tabs=n.first),a.mGM(n=a.lsd())&&(o.usuario=n.first),a.mGM(n=a.lsd())&&(o.programa=n.first),a.mGM(n=a.lsd())&&(o.unidade=n.first),a.mGM(n=a.lsd())&&(o.tipoModalidade=n.first),a.mGM(n=a.lsd())&&(o.planoEntrega=n.first),a.mGM(n=a.lsd())&&(o.atividade=n.first),a.mGM(n=a.lsd())&&(o.entrega=n.first),a.mGM(n=a.lsd())&&(o.documentos=n.first)}},features:[a.Vt3],decls:24,vars:36,consts:[["tabs",""],["usuario",""],["unidade",""],["programa",""],["tipoModalidade",""],["documentos",""],["initialFocus","plano_entrega_id",3,"submit","cancel","form","disabled","noButtons"],["display","","right","",3,"hidden","title","select"],["key","DADOS","label","Dados"],[1,"row"],[1,"col-md-12"],["required","","controlName","usuario_id",3,"select","size","disabled","dao","join"],["required","","controlName","unidade_id",3,"select","size","disabled","dao"],["icon","bi bi-file-bar-graph","required","","controlName","programa_id",3,"select","size","label","disabled","join","dao","metadata"],["label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","required","",3,"change","size","control","labelInfo"],["label","Final","icon","bi bi-calendar-date","controlName","data_fim","required","",3,"change","size","control","labelInfo"],["controlName","tipo_modalidade_id","required","",3,"size","dao"],[4,"ngIf"],[3,"title"],["type","warning",3,"message",4,"ngIf"],["key","MENSAGENS",3,"label",4,"ngIf"],["key","TERMO",3,"label",4,"ngIf"],["label","Carga Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria","labelInfo","Carga hor\xe1ria do usu\xe1rio (M\xe1x.: di\xe1ria 24 horas; semana 24*5=240 horas; mensal 24*20=480 horas)","required","",3,"change","size","unit","control","unitChange"],["onlyHours","","disabled","","label","Horas Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["onlyHours","","disabled","","label","Horas Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["title","C\xe1lculos das horas totais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas parciais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas totais","collapse",""],[3,"efemerides","partial"],["title","C\xe1lculos das horas parciais","collapse",""],[3,"efemerides"],["type","warning",3,"message"],["noPersist","",3,"disabled","entity"],["key","MENSAGENS",3,"label"],["controlName","editar_texto_complementar_unidade","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","unidade_texto_complementar",3,"disabled","dataset"],["title","Texto complementar do usuario"],["controlName","editar_texto_complementar_usuario","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","usuario_texto_complementar",3,"disabled","dataset"],["key","TERMO",3,"label"],["clss","row"],["noPersist","","especie","TCR",3,"entity","disabled","cdRef","needSign","extraTags","editingId","datasource","template"]],template:function(e,o){if(1&e){const n=a.RV6();a.j41(0,"editable-form",6),a.bIt("submit",function(){return a.eBV(n),a.Njj(o.onSaveData())})("cancel",function(){return a.eBV(n),a.Njj(o.onCancel())}),a.j41(1,"tabs",7,0)(3,"tab",8)(4,"div",9)(5,"div",10)(6,"div",9)(7,"input-search",11,1),a.bIt("select",function(d){return a.eBV(n),a.Njj(o.onUsuarioSelect(d))}),a.k0s(),a.j41(9,"input-search",12,2),a.bIt("select",function(d){return a.eBV(n),a.Njj(o.onUnidadeSelect(d))}),a.k0s(),a.j41(11,"input-search",13,3),a.bIt("select",function(d){return a.eBV(n),a.Njj(o.onProgramaSelect(d))}),a.k0s()(),a.j41(13,"div",9)(14,"input-datetime",14),a.bIt("change",function(d){return a.eBV(n),a.Njj(o.onDataInicioChange(d))}),a.k0s(),a.j41(15,"input-datetime",15),a.bIt("change",function(d){return a.eBV(n),a.Njj(o.onDataFimChange(d))}),a.k0s(),a.nrm(16,"input-search",16,4),a.k0s(),a.DNE(18,Vt,7,10,"ng-container",17),a.k0s()(),a.j41(19,"separator",18),a.DNE(20,wt,1,1,"top-alert",19)(21,Ut,2,2,"div",17),a.k0s()(),a.DNE(22,Lt,7,12,"tab",20)(23,Bt,4,9,"tab",21),a.k0s()()}if(2&e){const n=a.sdS(17);a.Y8G("form",o.form)("disabled",o.formDisabled)("noButtons",o.isTermos?"true":void 0),a.R7$(),a.Y8G("hidden",o.isTermos?"true":void 0)("title",o.isModal?"":o.title)("select",o.onTabSelect.bind(o)),a.R7$(6),a.Y8G("size",4)("disabled","new"==o.action?void 0:"true")("dao",o.usuarioDao)("join",a.lJ4(33,kt)),a.R7$(2),a.Y8G("size",4)("disabled","new"==o.action?void 0:"true")("dao",o.unidadeDao),a.R7$(2),a.Y8G("size",4)("label",o.lex.translate("Programa de gest\xe3o"))("disabled","new"==o.action?void 0:"true")("join",o.joinPrograma)("dao",o.programaDao)("metadata",o.programaMetadata),a.R7$(3),a.Y8G("size",3)("control",o.form.controls.data_inicio)("labelInfo","In\xedcio da Vig\xeancia do "+o.lex.translate("Plano de trabalho")),a.R7$(),a.Y8G("size",3)("control",o.form.controls.data_fim)("labelInfo","Final da Vig\xeancia do "+o.lex.translate("Plano de trabalho")),a.R7$(),a.Y8G("size",6)("dao",o.tipoModalidadeDao),a.R7$(2),a.Y8G("ngIf",null==n.selectedEntity?null:n.selectedEntity.plano_trabalho_calcula_horas),a.R7$(),a.Y8G("title",o.lex.translate("Entregas")+o.lex.translate(" do plano de trabalho")),a.R7$(),a.Y8G("ngIf",!(null!=o.form.controls.programa_id.value&&o.form.controls.programa_id.value.length&&null!=o.form.controls.unidade_id.value&&o.form.controls.unidade_id.value.length)),a.R7$(),a.Y8G("ngIf",(null==o.form.controls.programa_id.value?null:o.form.controls.programa_id.value.length)&&(null==o.form.controls.unidade_id.value?null:o.form.controls.unidade_id.value.length)),a.R7$(),a.Y8G("ngIf",o.checkFilled(a.lJ4(34,Nt))),a.R7$(),a.Y8G("ngIf",o.checkFilled(a.lJ4(35,$t)))}},dependencies:[h.bT,G.Q,O.S,E.O,x.r,ja.r,V.O,L.j,I.F,xa.P,la.j,Va.p,wa.D,Ua.h,X]})}return i})();var pa=s(6295),q=s(7772),_a=s(5825),Mt=s(9592);const zt=["*"],ha=i=>({data:i});function Xt(i,l){if(1&i&&a.nrm(0,"i"),2&i){const t=a.XpG();a.HbH(t.icon)}}function Ht(i,l){if(1&i&&a.eu8(0,5),2&i){const t=a.XpG();a.Y8G("ngTemplateOutlet",t.titleTemplate)("ngTemplateOutletContext",a.eq3(2,ha,t.data))}}function qt(i,l){if(1&i&&a.eu8(0,5),2&i){const t=a.XpG(2);a.Y8G("ngTemplateOutlet",t.template)("ngTemplateOutletContext",a.eq3(2,ha,t.data))}}function Jt(i,l){if(1&i&&(a.j41(0,"div",6),a.DNE(1,qt,1,4,"ng-container",3),a.SdG(2),a.k0s()),2&i){const t=a.XpG();a.R7$(),a.Y8G("ngIf",t.template)}}let Qt=(()=>{class i extends Mt.x{set class(t){this._class!=t&&(this._class=t)}get class(){return"card m-3 "+this.getClassBorderColor(this.color)+this._class}constructor(t){super(t),this.injector=t,this.collapsed=!0}ngOnInit(){}onHeaderClick(){this.collapsed=!this.collapsed,this.cdRef.detectChanges()}get style(){return this.getStyleBgColor(this.color)}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["collapse-card"]],inputs:{title:"title",data:"data",icon:"icon",collapsed:"collapsed",color:"color",template:"template",titleTemplate:"titleTemplate",class:"class"},features:[a.Vt3],ngContentSelectors:zt,decls:7,vars:6,consts:[[1,"card","border-primary","m-3"],["role","button",1,"card-header",3,"click"],[3,"class",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],["class","card-body text-primary",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"card-body","text-primary"]],template:function(e,o){1&e&&(a.NAR(),a.j41(0,"div",0)(1,"div",1),a.bIt("click",function(){return o.onHeaderClick()}),a.DNE(2,Xt,1,2,"i",2),a.EFF(3),a.DNE(4,Ht,1,4,"ng-container",3),a.nrm(5,"i"),a.k0s(),a.DNE(6,Jt,3,1,"div",4),a.k0s()),2&e&&(a.R7$(2),a.Y8G("ngIf",o.icon),a.R7$(),a.SpI(" ",o.title||""," "),a.R7$(),a.Y8G("ngIf",o.titleTemplate),a.R7$(),a.HbH("collapse-card-toggle-icon "+(o.collapsed?"bi bi-chevron-down":"bi bi-chevron-up")),a.R7$(),a.Y8G("ngIf",!o.collapsed))},dependencies:[h.bT,h.T3],styles:[".card-header[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transition:.3s transform ease-in-out}.card-header[_ngcontent-%COMP%]   .collapsed[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transform:rotate(90deg)}.collapse-card-toggle-icon[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}"]})}return i})();var Wt=s(4022),J=s(1629),Zt=s(291);class ga extends Zt.C{constructor(l){super(),this.data_inicio=new Date,this.data_fim=new Date,this.status="INCLUIDO",this.avaliacoes=[],this.status_historico=[],this.plano_trabalho_id="",this.avaliacao_id=null,this.initialization(l)}}var fa=s(9036),ba=s(3400),Kt=s(4407),ae=s(6807),te=s(1928),ee=s(336),oe=s(2464),ie=s(4566),ne=s(4423);let le=(()=>{class i extends ne.F{constructor(t){super("Comparecimento",t),this.injector=t,this.inputSearchConfig.searchFields=["data_comparecimento"]}static#a=this.\u0275fac=function(e){return new(e||i)(a.KVO(a.zZn))};static#t=this.\u0275prov=a.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var re=s(4682),se=s(1230),de=s(3881),ce=s(368),ue=s(7072),va=s(6073),me=s(3814);const pe=["gridEntregas"],_e=["gridAtividades"],he=["etiqueta"],ge=["tipoAtividade"],fe=["listTarefas"],be=()=>({abrirEmEdicao:!0});function ve(i,l){if(1&i&&(a.j41(0,"span",44),a.nrm(1,"i",45),a.EFF(2),a.k0s()),2&i){const t=a.XpG().row;a.R7$(2),a.SpI(" ",null==t.atividades?null:t.atividades.length,"")}}function Te(i,l){if(1&i&&a.DNE(0,ve,3,1,"span",43),2&i){const t=l.row;a.Y8G("ngIf",null==t.atividades?null:t.atividades.length)}}function Ce(i,l){if(1&i&&(a.j41(0,"span",44),a.nrm(1,"i",45),a.EFF(2),a.k0s()),2&i){const t=a.XpG().row;a.R7$(2),a.SpI(" ",null==t.tarefas?null:t.tarefas.length,"")}}function Ee(i,l){if(1&i&&a.DNE(0,Ce,3,1,"span",43),2&i){const t=l.row;a.Y8G("ngIf",null==t.tarefas?null:t.tarefas.length)}}function Ae(i,l){1&i&&a.nrm(0,"atividade-list-tarefa",52,23),2&i&&a.Y8G("atividade",l.row)("consolidacao",!1)}function De(i,l){if(1&i&&(a.j41(0,"span",53),a.nrm(1,"badge",54),a.k0s(),a.j41(2,"span",55),a.EFF(3),a.k0s(),a.nrm(4,"reaction",56)),2&i){const t=l.row,e=a.XpG(2);a.R7$(),a.Y8G("label",t.numero)("data",t.numero)("click",e.atividadeService.onIdClick.bind(e)),a.R7$(2),a.JRh(t.descricao),a.R7$(),a.Y8G("entity",t)}}function ye(i,l){if(1&i&&a.nrm(0,"input-textarea",57),2&i){const t=a.XpG(2);a.Y8G("size",12)("rows",2)("control",t.formAtividade.controls.descricao)}}function Ge(i,l){1&i&&a.nrm(0,"badge",60),2&i&&a.Y8G("badge",l.$implicit)}function Re(i,l){if(1&i&&(a.j41(0,"div",58),a.DNE(1,Ge,1,1,"badge",59),a.k0s()),2&i){const t=l.row,e=a.XpG(2);a.R7$(),a.Y8G("ngForOf",e.tempoAtividade(t))}}function Ie(i,l){if(1&i&&(a.j41(0,"separator",61),a.nrm(1,"input-datetime",62)(2,"input-datetime",63),a.k0s()),2&i){const t=a.XpG(2);a.Y8G("collapsed",!0),a.R7$(),a.Y8G("control",t.formAtividade.controls.data_inicio),a.R7$(),a.Y8G("control",t.formAtividade.controls.data_entrega)}}function Pe(i,l){1&i&&a.nrm(0,"badge",68),2&i&&a.Y8G("lookup",l.$implicit)}function Se(i,l){1&i&&a.nrm(0,"separator",69)}function Fe(i,l){1&i&&a.nrm(0,"i",73)}function Oe(i,l){if(1&i&&(a.j41(0,"tr")(1,"td"),a.DNE(2,Fe,1,0,"i",71),a.k0s(),a.j41(3,"td",72),a.EFF(4),a.k0s()()),2&i){const t=l.$implicit;a.R7$(2),a.Y8G("ngIf",t.checked),a.R7$(2),a.JRh(t.texto)}}function Ye(i,l){if(1&i&&(a.j41(0,"table"),a.DNE(1,Oe,5,2,"tr",70),a.k0s()),2&i){const t=a.XpG().row;a.R7$(),a.Y8G("ngForOf",t.checklist)}}function ke(i,l){if(1&i&&(a.nrm(0,"progress-bar",64),a.DNE(1,Pe,1,1,"badge",65)(2,Se,1,0,"separator",66)(3,Ye,2,1,"table",67)),2&i){const t=l.row;a.Y8G("value",t.progresso),a.R7$(),a.Y8G("ngForOf",t.etiquetas),a.R7$(),a.Y8G("ngIf",null==t.checklist?null:t.checklist.length),a.R7$(),a.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function Ne(i,l){1&i&&a.nrm(0,"separator",69)}function $e(i,l){if(1&i&&(a.j41(0,"tr")(1,"td"),a.nrm(2,"input-switch",77),a.k0s(),a.j41(3,"td",72),a.EFF(4),a.k0s()()),2&i){const t=l.$implicit,e=l.index,o=a.XpG(4);a.R7$(2),a.Y8G("size",12)("source",o.checklist)("path",e+".checked"),a.R7$(2),a.JRh(t.texto)}}function je(i,l){if(1&i&&(a.j41(0,"table"),a.DNE(1,$e,5,4,"tr",70),a.k0s()),2&i){const t=a.XpG(3);a.R7$(),a.Y8G("ngForOf",t.checklist)}}function xe(i,l){if(1&i){const t=a.RV6();a.EFF(0),a.nrm(1,"input-number",74),a.j41(2,"input-multiselect",75)(3,"input-select",76,24),a.bIt("details",function(){a.eBV(t);const o=a.XpG(2);return a.Njj(o.onEtiquetaConfigClick())}),a.k0s()(),a.DNE(5,Ne,1,0,"separator",66)(6,je,2,1,"table",67)}if(2&i){const t=l.row,e=a.XpG(2);a.SpI(" ",t._status," "),a.R7$(),a.Y8G("size",12)("decimals",2)("control",e.formEdit.controls.progresso),a.R7$(),a.Y8G("size",12)("control",e.formEdit.controls.etiquetas)("addItemHandle",e.addItemHandleEtiquetas.bind(e)),a.R7$(),a.Y8G("size",12)("control",e.formEdit.controls.etiqueta)("items",e.etiquetas),a.R7$(2),a.Y8G("ngIf",null==t.checklist?null:t.checklist.length),a.R7$(),a.Y8G("ngIf",null==t.checklist?null:t.checklist.length)}}function Ve(i,l){if(1&i&&a.nrm(0,"badge",82),2&i){const t=l.$implicit;a.Y8G("data",t)("color",t.color)("icon",t.icon)("label",t.label)}}function we(i,l){if(1&i&&a.nrm(0,"comentarios-widget",83),2&i){const t=a.XpG().row;a.XpG();const e=a.sdS(1);a.Y8G("entity",t)("selectable",!1)("grid",e)}}function Ue(i,l){if(1&i&&(a.nrm(0,"documentos-badge",78),a.j41(1,"span",79),a.DNE(2,Ve,1,4,"badge",80),a.k0s(),a.DNE(3,we,1,3,"comentarios-widget",81)),2&i){const t=l.row;a.XpG();const e=a.sdS(1),o=a.XpG();a.Y8G("documento",t.documento_requisicao),a.R7$(2),a.Y8G("ngForOf",o.atividadeService.getStatus(t,o.entity)),a.R7$(),a.Y8G("ngIf",!e.editing)}}function Le(i,l){if(1&i&&(a.j41(0,"grid",46,13)(2,"columns")(3,"column",47),a.DNE(4,Ee,1,1,"ng-template",null,14,a.C5r)(6,Ae,2,2,"ng-template",null,15,a.C5r),a.k0s(),a.j41(8,"column",48),a.DNE(9,De,5,5,"ng-template",null,16,a.C5r)(11,ye,1,3,"ng-template",null,17,a.C5r),a.k0s(),a.j41(13,"column",49),a.DNE(14,Re,2,1,"ng-template",null,18,a.C5r)(16,Ie,3,3,"ng-template",null,19,a.C5r),a.k0s(),a.j41(18,"column",50),a.DNE(19,ke,4,4,"ng-template",null,20,a.C5r)(21,xe,7,12,"ng-template",null,21,a.C5r),a.k0s(),a.j41(23,"column",49),a.DNE(24,Ue,4,3,"ng-template",null,22,a.C5r),a.k0s(),a.nrm(26,"column",51),a.k0s()()),2&i){const t=l.row,e=a.sdS(5),o=a.sdS(7),n=a.sdS(10),r=a.sdS(12),d=a.sdS(15),c=a.sdS(17),_=a.sdS(20),m=a.sdS(22),g=a.sdS(25),p=a.XpG();a.Y8G("items",t.atividades)("minHeight",0)("form",p.formAtividade)("hasAdd",!p.disabled)("hasDelete",!1)("hasEdit",!1)("add",p.addAtividade.bind(p,t.entrega))("load",p.loadAtividade.bind(p))("remove",p.removeAtividade.bind(p,t.atividades))("save",p.saveAtividade.bind(p)),a.R7$(3),a.Y8G("width",50)("align","center")("hint","Tarefas da "+p.lex.translate("atividade"))("template",e)("expandTemplate",o),a.R7$(5),a.Y8G("title","#ID/Trabalho executado")("width",400)("template",n)("editTemplate",r)("columnEditTemplate",r)("edit",p.onColumnAtividadeDescricaoEdit.bind(p))("save",p.onColumnAtividadeDescricaoSave.bind(p))("metadata",a.lJ4(42,be)),a.R7$(5),a.Y8G("title","In\xedcio e Conclus\xe3o")("width",250)("template",d)("editTemplate",c),a.R7$(5),a.Y8G("title","Progresso\nEtiquetas/Checklist")("width",200)("template",_)("editTemplate",_)("columnEditTemplate",m)("edit",p.onColumnProgressoEtiquetasChecklistEdit.bind(p))("save",p.onColumnProgressoEtiquetasChecklistSave.bind(p))("canEdit",p.podeEditar.bind(p)),a.R7$(5),a.Y8G("title","n\xba Processo/Status\nComent\xe1rios")("width",300)("template",g)("editTemplate",g),a.R7$(3),a.Y8G("metadata",p.atividadeOptionsMetadata)("dynamicOptions",p.atividadeService.dynamicOptions.bind(p))("dynamicButtons",p.atividadeService.dynamicButtons.bind(p))}}function Be(i,l){if(1&i&&a.nrm(0,"badge",84),2&i){const t=l.row;a.Y8G("label",t.badge.titulo)("color",t.badge.cor)}}function Me(i,l){if(1&i&&(a.EFF(0),a.nrm(1,"br"),a.j41(2,"small"),a.EFF(3),a.k0s(),a.nrm(4,"reaction",85)),2&i){const t=l.row;a.SpI(" ",t.badge.descricao||t.entrega.descricao,""),a.R7$(3),a.JRh(t.entrega.descricao),a.R7$(),a.Y8G("entity",t.entrega)}}function ze(i,l){1&i&&a.nrm(0,"badge",86),2&i&&a.Y8G("label",l.row.entrega.forca_trabalho+"%")}function Xe(i,l){if(1&i&&a.nrm(0,"badge",87)(1,"br")(2,"badge",88),2&i){const t=l.row;a.Y8G("textValue",t.meta),a.R7$(2),a.Y8G("textValue",t.metaRealizado)}}function He(i,l){1&i&&a.nrm(0,"progress-bar",64),2&i&&a.Y8G("value",l.row.progresso_realizado)}function qe(i,l){if(1&i&&(a.nrm(0,"badge",89),a.EFF(1)),2&i){const t=l.row;a.Y8G("color",t.tipo_motivo_afastamento.cor)("icon",t.tipo_motivo_afastamento.icone)("label",t.tipo_motivo_afastamento.nome),a.R7$(),a.SpI(" ",t.observacao," ")}}function Je(i,l){if(1&i&&a.nrm(0,"badge",90),2&i){const t=l.row,e=a.XpG();a.Y8G("icon",e.entityService.getIcon("Unidade"))("label",t.unidade.sigla)("textValue",t.unidade.nome)}}function Qe(i,l){if(1&i&&a.nrm(0,"input-search",91,25),2&i){const t=a.XpG();a.Y8G("size",6)("dao",t.unidadeDao)}}let Ta=(()=>{class i extends k.g{set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t,this.bindEntity()}get entity(){return super.entity}set disabled(t){(this._disabled!=t||this.atividadeOptionsMetadata.disabled!==t)&&(this._disabled=t,this.atividadeOptionsMetadata.disabled=t,this.cdRef.detectChanges())}get disabled(){return this._disabled}constructor(t){super(t),this.injector=t,this.joinAtividade=["demandante","usuario","tipo_atividade","comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.itemsEntregas=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.itemsOcorrencias=[],this.itemsComparecimentos=[],this.itemsAfastamentos=[],this._disabled=!0,this.validateAtividade=(e,o)=>{let n=null;return["descricao"].indexOf(o)>=0&&!e.value?.length?n="Obrigat\xf3rio":["data_inicio","data_entrega"].includes(o)&&!this.util.isDataValid(e.value)?n="Inv\xe1lido":"data_inicio"==o&&e.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()||"data_entrega"==o&&e.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()?n="Menor que distribui\xe7\xe3o":"data_entrega"==o&&e.value.getTime()<this.formAtividade?.controls.data_inicio.value.getTime()&&(n="Menor que in\xedcio"),n},this.validateComparecimento=(e,o)=>{let n=null;return["detalhamento","unidade_id"].indexOf(o)>=0&&!e.value?.length?n="Obrigat\xf3rio":"data_comparecimento"==o&&this.entity&&!this.util.between(e.value,{start:this.entity.data_inicio,end:this.entity.data_fim})&&(n="Inv\xe1lido"),n},this.cdRef=t.get(a.gRc),this.dao=t.get(J.I),this.unidadeDao=t.get(F.s),this.comparecimentoDao=t.get(le),this.atividadeDao=t.get(ee.R),this.atividadeService=t.get(oe.h),this.calendar=t.get(ra.I),this.ocorrenciaDao=t.get(re.F),this.tipoAtividadeDao=t.get(ae.f),this.planoTrabalhoService=t.get(Y.V),this.planoEntregaService=t.get(te.C),this.pEEDao=t.get(sa.o),this.formAtividade=this.fh.FormBuilder({descricao:{default:""},etiquetas:{default:[]},checklist:{default:[]},comentarios:{default:[]},esforco:{default:0},tempo_planejado:{default:0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},data_inicio:{default:new Date},data_entrega:{default:new Date}},this.cdRef,this.validateAtividade),this.formComparecimento=this.fh.FormBuilder({data_comparecimento:{default:new Date},unidade_id:{default:""},detalhamento:{default:""}},this.cdRef,this.validateComparecimento),this.formEdit=this.fh.FormBuilder({descricao:{default:""},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.atividadeOptionsMetadata={refreshId:this.atividadeRefreshId.bind(this),removeId:this.atividadeRemoveId.bind(this),refresh:this.refresh.bind(this)}}refresh(){this.loadData(this.entity,this.form)}bindEntity(){this.entity&&(this.entity._metadata=this.entity._metadata||{},this.entity._metadata.planoTrabalhoConsolidacaoFormComponent=this)}atividadeRefreshId(t,e){this.itemsEntregas.forEach(o=>{let n=o.atividades.findIndex(r=>r.id==t);n>=0&&(e?o.atividades[n]=e:this.atividadeDao.getById(t,this.joinAtividade).then(r=>{r&&(o.atividades[n]=r)}))}),this.cdRef.detectChanges()}atividadeRemoveId(t){this.itemsEntregas.forEach(e=>{let o=e.atividades.findIndex(n=>n.id==t);o>=0&&e.atividades.splice(o,1)}),this.cdRef.detectChanges()}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),(0,u.A)(function*(){yield t.loadData(t.entity,t.form)})()}loadConsolidacao(t){this.itemsEntregas=t.entregas.map(e=>(e.plano_entrega_entrega&&(e.plano_entrega_entrega.plano_entrega=t.planosEntregas.find(n=>n.id==e.plano_entrega_entrega?.plano_entrega_id)),{id:e.id,entrega:e,atividades:t.atividades.filter(n=>n.plano_trabalho_entrega_id==e.id),badge:this.planoTrabalhoService.tipoEntrega(e,t.planoTrabalho),meta:e.plano_entrega_entrega?this.planoEntregaService.getValorMeta(e.plano_entrega_entrega):"",metaRealizado:e.plano_entrega_entrega?this.planoEntregaService.getValorRealizado(e.plano_entrega_entrega):"",progresso_realizado:e.plano_entrega_entrega?e.plano_entrega_entrega.progresso_realizado:0,objetivos:e.plano_entrega_entrega?e.plano_entrega_entrega.objetivos:[],processos:e.plano_entrega_entrega?e.plano_entrega_entrega.processos:[]})),this.programa=t.programa,this.planoTrabalho=t.planoTrabalho,this.itemsOcorrencias=t.ocorrencias,this.itemsComparecimentos=t.comparecimentos,this.itemsAfastamentos=t.afastamentos,this.unidade=t.planoTrabalho.unidade||this.entity.plano_trabalho?.unidade,this.cdRef.detectChanges()}loadData(t,e){var o=this;return(0,u.A)(function*(){o.gridEntregas.loading=!0,o.cdRef.detectChanges();try{let n=yield o.dao.dadosConsolidacao(t.id);o.loadConsolidacao(n)}finally{o.gridEntregas.loading=!1,o.cdRef.detectChanges()}})()}addAtividade(t){var e=this;return(0,u.A)(function*(){let o=t.plano_trabalho||e.entity.plano_trabalho,n=e.calendar.calculaDataTempoUnidade(e.entity.data_inicio,e.entity.data_fim,o.carga_horaria,e.unidade,"ENTREGA");const r=e.calendar.horasUteis(e.entity.data_inicio,e.entity.data_fim,o.carga_horaria,e.unidade,"DISTRIBUICAO"),d=e.util.maxDate(e.util.setTime(e.entity.data_inicio,0,0,0),o.data_inicio),c=e.util.minDate(e.util.setTime(e.entity.data_fim,23,59,59),o.data_fim);let _=e.dao.generateUuid();return new Kt.Y({id:_,plano_trabalho:o,plano_trabalho_entrega:t,plano_trabalho_consolidacao:e.entity,demandante:e.auth.usuario,usuario:e.auth.usuario,unidade:e.unidade,data_distribuicao:d,carga_horaria:o.carga_horaria,data_estipulada_entrega:c,data_inicio:d,data_entrega:c,tempo_planejado:r,tempo_despendido:n?.tempoUtil||0,status:"CONCLUIDO",progresso:100,plano_trabalho_id:e.entity.plano_trabalho_id,plano_trabalho_entrega_id:t.id,plano_trabalho_consolidacao_id:e.entity.id,demandante_id:e.auth.usuario.id,usuario_id:e.auth.usuario.id,unidade_id:e.unidade.id,metadados:{atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!0,concluido:!0,avaliado:!1,arquivado:!1,produtividade:0,extra:void 0,_status:[]},_status:"temporario"})})()}loadAtividade(t,e){var o=this;return(0,u.A)(function*(){o.formAtividade.patchValue(e),o.cdRef.detectChanges()})()}removeAtividade(t,e){var o=this;return(0,u.A)(function*(){if(!(yield o.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let r=e;return yield o.atividadeDao?.delete(r),t.splice(t.findIndex(d=>d.id==r.id),1),!0}catch{return!1}})()}saveAtividade(t,e){var o=this;return(0,u.A)(function*(){let n;if(o.gridAtividades.error="",o.formAtividade.markAllAsTouched(),o.formAtividade.valid){e.id="NEW"==e.id?o.dao.generateUuid():e.id,o.util.fillForm(e,o.formAtividade.value),o.submitting=!0;try{n=yield o.atividadeDao?.save(e,o.joinAtividade,["etiquetas","checklist","comentarios","pausas","tarefas"]),o.atividadeRefreshId(e.id,n)}catch(r){n=!1,o.gridAtividades.error=r.message||r}finally{o.submitting=!1}}return n})()}onDataDistribuicaoChange(t){this.formAtividade.controls.data_inicio.setValue(this.formAtividade.controls.data_distribuicao.value)}onDataEstipuladaEntregaChange(t){this.formAtividade.controls.data_entrega.setValue(this.formAtividade.controls.data_estipulada_entrega.value)}atividadeDynamicButtons(t){let e=[];return e.push(Object.assign({},this.gridEntregas.BUTTON_EDIT,{})),e.push(Object.assign({},this.gridEntregas.BUTTON_DELETE,{})),e}onColumnProgressoEtiquetasChecklistEdit(t){var e=this;return(0,u.A)(function*(){if(!e.etiquetasAscendentes.filter(o=>o.data==t.plano_trabalho.unidade.id).length){let o=yield e.carregaEtiquetasUnidadesAscendentes(t.plano_trabalho.unidade);e.etiquetasAscendentes.push(...o)}e.formEdit.controls.progresso.setValue(t.progresso),e.formEdit.controls.etiquetas.setValue(t.etiquetas),e.formEdit.controls.etiqueta.setValue(null),e.etiquetas=e.util.merge(t.tipo_atividade?.etiquetas,t.plano_trabalho.unidade?.etiquetas,(o,n)=>o.key==n.key),e.etiquetas=e.util.merge(e.etiquetas,e.auth.usuario.config?.etiquetas,(o,n)=>o.key==n.key),e.etiquetas=e.util.merge(e.etiquetas,e.etiquetasAscendentes.filter(o=>o.data==t.plano_trabalho.unidade.id),(o,n)=>o.key==n.key),e.checklist=e.util.clone(t.checklist)})()}carregaEtiquetasUnidadesAscendentes(t){var e=this;return(0,u.A)(function*(){let o=[];if((t=t||e.auth.unidade).path){let n=t.path.split("/");(yield e.unidadeDao.query({where:[["id","in",n]]}).asPromise()).forEach(d=>{o=e.util.merge(o,d.etiquetas,(c,_)=>c.key==_.key)}),o.forEach(d=>d.data=t.id)}return o})()}onColumnProgressoEtiquetasChecklistSave(t){var e=this;return(0,u.A)(function*(){console.log(t);try{const o=yield e.atividadeDao.update(t.id,{progresso:e.formEdit.controls.progresso.value,etiquetas:e.formEdit.controls.etiquetas.value,checklist:e.checklist});return t.progresso=e.formEdit.controls.progresso.value,t.checklist=e.checklist,!!o}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:t=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(e,o)=>e.key==o.key),this.cdRef.detectChanges()}})}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const e=this.etiqueta.selectedItem,o=e.key?.length?e.key:this.util.textHash(e.value);this.util.validateLookupItem(this.formEdit.controls.etiquetas.value,o)&&(t={key:o,value:e.value,color:e.color,icon:e.icon},this.formEdit.controls.etiqueta.setValue(null))}return t}podeEditar(t){return!t._status}loadTipoAtividade(t){t?(this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade,t),this.atividadeService.buildChecklist(t,this.formAtividade.controls.checklist),this.formAtividade.controls.esforco.setValue(t?.esforco||0)):(this.etiquetas=[],this.formAtividade.controls.esforco.setValue(0)),this.cdRef.detectChanges()}onTipoAtividadeSelect(t){const e=t.entity;this.loadTipoAtividade(e),this.atividadeService.comentarioAtividade(e,this.formAtividade.controls.comentarios),this.cdRef.detectChanges()}onColumnAtividadeDescricaoEdit(t){var e=this;return(0,u.A)(function*(){e.formAtividade.controls.descricao.setValue(t.descricao),e.formAtividade.controls.comentarios.setValue(t.comentarios)})()}onColumnAtividadeDescricaoSave(t){var e=this;return(0,u.A)(function*(){try{e.atividadeService.comentarioAtividade(e.tipoAtividade?.selectedEntity,e.formAtividade.controls.comentarios);const o=yield e.atividadeDao.update(t.id,{descricao:e.formAtividade.controls.descricao.value,comentarios:(e.formAtividade.controls.comentarios.value||[]).filter(n=>["ADD","EDIT","DELETE"].includes(n._status||""))});return t.descricao=e.formAtividade.controls.descricao.value,t.tipo_atividade=e.tipoAtividade?.selectedEntity||null,t.comentarios=e.formAtividade.controls.comentarios.value,!!o}catch{return!1}})()}tempoAtividade(t){let e=[{color:"light",hint:"In\xedcio",icon:"bi bi-file-earmark-play",label:this.dao.getDateTimeFormatted(t.data_inicio)}],o=this.atividadeService.temposAtividade(t);return o=o.filter(n=>"bi bi-file-earmark-plus"!=n.icon&&"bi bi-calendar-check"!=n.icon),e.push(...o),e}dynamicButtons(t){let e=[];return e.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),e}showDetalhes(t){var e=this;return(0,u.A)(function*(){let o=yield e.pEEDao.getById(t.entrega.plano_entrega_entrega.id,["entrega","objetivos.objetivo"]);e.go.navigate({route:["gestao","plano-entrega","entrega",t.entrega.plano_entrega_entrega.id,"detalhes"]},{metadata:{plano_entrega:t.entrega.plano_entrega_entrega.plano_entrega,planejamento_id:t.entrega.plano_entrega_entrega.plano_entrega.planejamento_id,cadeia_valor_id:t.entrega.plano_entrega_entrega.plano_entrega.cadeia_valor_id,unidade_id:t.entrega.plano_entrega_entrega.plano_entrega.unidade_id,entrega:o}})})()}addOcorrencia(){var t=this;return(0,u.A)(function*(){t.go.navigate({route:["gestao","ocorrencia","new"]},{metadata:{consolidacao:t.entity,planoTrabalho:t.planoTrabalho},modalClose:e=>{e&&t.refresh()}})})()}editOcorrencia(t){var e=this;return(0,u.A)(function*(){e.go.navigate({route:["gestao","ocorrencia",t.id,"edit"]},{modalClose:o=>{o&&e.refresh()}})})()}removeOcorrencia(t){var e=this;return(0,u.A)(function*(){if(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")){e.submitting=!0;try{let o=t;yield e.ocorrenciaDao?.delete(o),e.itemsOcorrencias.splice(e.itemsOcorrencias.findIndex(n=>n.id==o.id),1)}finally{e.submitting=!1}}})()}ocorrenciaDynamicButtons(t){let e=[];return!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EDT")&&e.push(Object.assign({},this.OPTION_ALTERAR,{onClick:this.editOcorrencia.bind(this)})),!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EXCL")&&e.push(Object.assign({},this.OPTION_EXCLUIR,{onClick:this.removeOcorrencia.bind(this)})),e}addComparecimento(){var t=this;return(0,u.A)(function*(){return new ie.l({unidade_id:t.unidade?.id,unidade:t.unidade,plano_trabalho_consolidacao_id:t.entity.id})})()}loadComparecimento(t,e){var o=this;return(0,u.A)(function*(){o.formComparecimento.patchValue({data_comparecimento:e.data_comparecimento,unidade_id:e.unidade_id,detalhamento:e.detalhamento}),o.cdRef.detectChanges()})()}removeComparecimento(t){var e=this;return(0,u.A)(function*(){if(!(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=t;return yield e.comparecimentoDao?.delete(n),e.itemsComparecimentos.splice(e.itemsComparecimentos.findIndex(r=>r.id==n.id),1),!0}catch{return!1}})()}saveComparecimento(t,e){var o=this;return(0,u.A)(function*(){let n;if(o.formComparecimento.markAllAsTouched(),o.formComparecimento.valid){e.id="NEW"==e.id?o.dao.generateUuid():e.id,e.data_comparecimento=t.controls.data_comparecimento.value,e.detalhamento=t.controls.detalhamento.value,e.plano_trabalho_consolidacao_id=o.entity.id,e.unidade_id=t.controls.unidade_id.value,o.submitting=!0;try{n=yield o.comparecimentoDao?.save(e)}finally{o.submitting=!1}}return n})()}comparecimentoDynamicButtons(t){return[]}addAfastamento(){var t=this;return(0,u.A)(function*(){t.go.navigate({route:["gestao","afastamento","new"]},{metadata:{consolidacao:t.entity},filterSnapshot:void 0,querySnapshot:void 0,modalClose:e=>{e&&t.refresh()}})})()}afastamentoDynamicButtons(t){let e=[];return e.push(Object.assign({},this.OPTION_INFORMACOES,{onClick:o=>this.go.navigate({route:["gestao","afastamento",o.id,"consult"]})})),e}showPlanejamento(t){var e=this;return(0,u.A)(function*(){e.go.navigate({route:["gestao","planejamento",t,"consult"]},{modal:!0})})()}showCadeiaValor(t){var e=this;return(0,u.A)(function*(){e.go.navigate({route:["gestao","cadeia-valor",t,"consult"]},{modal:!0})})()}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["plano-trabalho-consolidacao-form"]],viewQuery:function(e,o){if(1&e&&(a.GBs(G.Q,5),a.GBs(pe,5),a.GBs(_e,5),a.GBs(he,5),a.GBs(ge,5),a.GBs(fe,5)),2&e){let n;a.mGM(n=a.lsd())&&(o.editableForm=n.first),a.mGM(n=a.lsd())&&(o.gridEntregas=n.first),a.mGM(n=a.lsd())&&(o.gridAtividades=n.first),a.mGM(n=a.lsd())&&(o.etiqueta=n.first),a.mGM(n=a.lsd())&&(o.tipoAtividade=n.first),a.mGM(n=a.lsd())&&(o.listTarefas=n.first)}},inputs:{cdRef:"cdRef",planoTrabalho:"planoTrabalho",noPersist:"noPersist",control:"control",entity:"entity",disabled:"disabled"},features:[a.Vt3],decls:47,vars:54,consts:[["gridEntregas",""],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["columnOrigem",""],["columnEntrega",""],["columnForcaTrabalho",""],["columnMetaRealizado",""],["columnProgresso",""],["gridAfastamento",""],["columnMotivoObservacao",""],["gridComparecimento",""],["columnUnidade",""],["editUnidade",""],["gridAtividades",""],["columnTarefas",""],["columnExpandedTarefas",""],["columnAtividadeDescricao",""],["editAtividadeDescricao",""],["columnTempos",""],["editTempos",""],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],["columnNumero",""],["listTarefas",""],["etiqueta",""],["unidade",""],["collapse","",3,"collapsed","title","icon"],[3,"items","minHeight","hasEdit"],["type","expand",3,"width","icon","align","hint","template","expandTemplate"],["title","Origem",3,"template","width"],["title","Entrega",3,"template"],["title","% CHD Planejado",3,"template","width","titleHint"],[3,"title","template","width"],["title","Progresso",3,"template","width"],["type","options",3,"dynamicButtons"],["editable","",3,"items","minHeight","hasEdit","hasDelete","hasAdd","add"],["title","In\xedcio","type","datetime","field","data_inicio",3,"width"],["title","Fim","type","datetime","field","data_fim",3,"width"],["title","Motivo/Observa\xe7\xe3o",3,"template"],["editable","",3,"items","minHeight","form","hasDelete","hasAdd","hasEdit","add","load","remove","save"],["title","Data","type","date","field","data_comparecimento",3,"width"],["title","Unidade",3,"template","editTemplate"],["title","Detalhamento","type","text","field","detalhamento"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["editable","",3,"items","minHeight","form","hasAdd","hasDelete","hasEdit","add","load","remove","save"],["type","expand","icon","bi bi-boxes",3,"width","align","hint","template","expandTemplate"],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save","metadata"],[3,"title","width","template","editTemplate"],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save","canEdit"],["type","options",3,"metadata","dynamicOptions","dynamicButtons"],["persist","",3,"atividade","consolidacao"],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["title","In\xedcio e Conclus\xe3o","collapse","",3,"collapsed"],["icon","bi bi-play-circle","label","In\xedcio","controlName","data_inicio","labelInfo","Data de inicializa\xe7\xe3o da atividade",3,"control"],["icon","bi bi-check-circle","label","Conclus\xe3o","controlName","data_entrega","labelInfo","Data da conclus\xe3o da atividade",3,"control"],["color","success",3,"value"],[3,"lookup",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],[4,"ngIf"],[3,"lookup"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["controlName","etiquetas",3,"size","control","addItemHandle"],["label","Etiqueta","controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"details","size","control","items"],["scale","small",3,"size","source","path"],[3,"documento"],[1,"d-block"],[3,"data","color","icon","label",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid",4,"ngIf"],[3,"data","color","icon","label"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"label","color"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],["color","light",3,"label"],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],[3,"color","icon","label"],["color","success",3,"icon","label","textValue"],["label","","icon","","controlName","unidade_id",3,"size","dao"]],template:function(e,o){if(1&e&&(a.j41(0,"separator",26)(1,"grid",27,0)(3,"columns")(4,"column",28),a.DNE(5,Te,1,1,"ng-template",null,1,a.C5r)(7,Le,27,43,"ng-template",null,2,a.C5r),a.k0s(),a.j41(9,"column",29),a.DNE(10,Be,1,2,"ng-template",null,3,a.C5r),a.k0s(),a.j41(12,"column",30),a.DNE(13,Me,5,3,"ng-template",null,4,a.C5r),a.k0s(),a.j41(15,"column",31),a.DNE(16,ze,1,1,"ng-template",null,5,a.C5r),a.k0s(),a.j41(18,"column",32),a.DNE(19,Xe,3,2,"ng-template",null,6,a.C5r),a.k0s(),a.j41(21,"column",33),a.DNE(22,He,1,1,"ng-template",null,7,a.C5r),a.k0s(),a.nrm(24,"column",34),a.k0s()()(),a.j41(25,"separator",26)(26,"grid",35,8)(28,"columns"),a.nrm(29,"column",36)(30,"column",37),a.j41(31,"column",38),a.DNE(32,qe,2,4,"ng-template",null,9,a.C5r),a.k0s(),a.nrm(34,"column",34),a.k0s()()(),a.j41(35,"separator",26)(36,"grid",39,10)(38,"columns"),a.nrm(39,"column",40),a.j41(40,"column",41),a.DNE(41,Je,1,3,"ng-template",null,11,a.C5r)(43,Qe,2,2,"ng-template",null,12,a.C5r),a.k0s(),a.nrm(45,"column",42)(46,"column",34),a.k0s()()()),2&e){const n=a.sdS(6),r=a.sdS(8),d=a.sdS(11),c=a.sdS(14),_=a.sdS(17),m=a.sdS(20),g=a.sdS(23),p=a.sdS(33),C=a.sdS(42),y=a.sdS(44);a.Y8G("collapsed",!1)("title",o.lex.translate("Atividades"))("icon",o.entityService.getIcon("Atividade")),a.R7$(),a.Y8G("items",o.itemsEntregas)("minHeight",0)("hasEdit",!1),a.R7$(3),a.Y8G("width",50)("icon",o.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",o.lex.translate("Consolida\xe7\xe3o"))("template",n)("expandTemplate",r),a.R7$(5),a.Y8G("template",d)("width",200),a.R7$(3),a.Y8G("template",c),a.R7$(3),a.Y8G("template",_)("width",100)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada"),a.R7$(3),a.Y8G("title","Meta")("template",m)("width",100),a.R7$(3),a.Y8G("template",g)("width",150),a.R7$(3),a.Y8G("dynamicButtons",o.dynamicButtons.bind(o)),a.R7$(),a.Y8G("collapsed",!1)("title",o.lex.translate("Afastamentos"))("icon",o.entityService.getIcon("Afastamento")),a.R7$(),a.Y8G("items",o.itemsAfastamentos)("minHeight",0)("hasEdit",!1)("hasDelete",!1)("hasAdd",!o.disabled)("add",o.addAfastamento.bind(o)),a.R7$(3),a.Y8G("width",300),a.R7$(),a.Y8G("width",300),a.R7$(),a.Y8G("template",p),a.R7$(3),a.Y8G("dynamicButtons",o.afastamentoDynamicButtons.bind(o)),a.R7$(),a.Y8G("collapsed",!1)("title",o.lex.translate("Comparecimentos"))("icon",o.entityService.getIcon("Comparecimento")),a.R7$(),a.Y8G("items",o.itemsComparecimentos)("minHeight",0)("form",o.formComparecimento)("hasDelete",!o.disabled)("hasAdd",!o.disabled)("hasEdit",!o.disabled)("add",o.addComparecimento.bind(o))("load",o.loadComparecimento.bind(o))("remove",o.removeComparecimento.bind(o))("save",o.saveComparecimento.bind(o)),a.R7$(3),a.Y8G("width",300),a.R7$(),a.Y8G("template",C)("editTemplate",y),a.R7$(6),a.Y8G("dynamicButtons",o.comparecimentoDynamicButtons.bind(o))}},dependencies:[h.Sq,h.bT,A._,N.T,$.I,O.S,E.O,da.S,x.r,M.K,se.b,I.F,P.n,de.a,ce.n,ca.T,ue.c,va.s,me.A]})}return i})();function We(i,l){}function Ze(i,l){if(1&i&&a.nrm(0,"plano-trabalho-consolidacao-form",17,7),2&i){const t=l.row,e=a.XpG();a.Y8G("disabled",e.isDisabled(t))("entity",t)("planoTrabalho",e.entity)("cdRef",e.cdRef)}}function Ke(i,l){if(1&i&&a.EFF(0),2&i){const t=l.row,e=a.XpG();a.SpI(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function ao(i,l){if(1&i&&a.EFF(0),2&i){const t=l.row,e=a.XpG();a.SpI(" ",e.util.getDateFormatted(t.data_fim)," ")}}function to(i,l){if(1&i){const t=a.RV6();a.j41(0,"avaliar-nota-badge",20),a.bIt("click",function(){a.eBV(t);const o=a.XpG().row,n=a.XpG();return a.Njj(n.mostrarAvaliacao(o))}),a.k0s()}if(2&i){const t=a.XpG().row,e=a.XpG();a.Y8G("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao||e.entity.programa.tipo_avaliacao_plano_trabalho)("nota",t.avaliacao.nota)}}function eo(i,l){if(1&i&&(a.j41(0,"separator",21)(1,"small"),a.EFF(2),a.k0s()()),2&i){const t=a.XpG().row;a.Y8G("collapsed",!1),a.R7$(2),a.JRh(t.avaliacao.recurso)}}function oo(i,l){if(1&i&&a.DNE(0,to,1,3,"avaliar-nota-badge",18)(1,eo,3,2,"separator",19),2&i){const t=l.row;a.Y8G("ngIf",t.avaliacao),a.R7$(),a.Y8G("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function io(i,l){1&i&&a.nrm(0,"badge",25)}function no(i,l){if(1&i&&(a.j41(0,"div",22),a.nrm(1,"badge",23),a.DNE(2,io,1,0,"badge",24),a.k0s()),2&i){const t=l.row,e=a.XpG();a.R7$(),a.Y8G("color",e.lookup.getColor(e.lookup.CONSOLIDACAO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.CONSOLIDACAO_STATUS,t.status))("label",e.lookup.getValue(e.lookup.CONSOLIDACAO_STATUS,t.status)),a.R7$(),a.Y8G("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}let Ca=(()=>{class i extends k.g{set entity(t){super.entity=t}get entity(){return super.entity}get items(){return this.entity?.consolidacoes||[]}constructor(t){super(t),this.injector=t,this.validate=(e,o)=>null,this.dao=t.get(J.I),this.avaliacaoDao=t.get(fa.l),this.planoTrabalhoService=t.get(Y.V),this.unidadeService=t.get(B.S),this.planoTrabalhoDao=t.get(S.x),this.title=this.lex.translate("Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD",this.modalWidth=1200,this.form=this.fh.FormBuilder({data_inicio:{default:new Date},data_fim:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),(0,u.A)(function*(){if(t.urlParams?.has("usuarioId")&&t.urlParams?.has("planoTrabalhoId")){let o=yield t.planoTrabalhoDao.getByUsuario(t.urlParams.get("usuarioId"),!0,t.urlParams.get("planoTrabalhoId"));1==o.planos.length&&(t.entity=o.planos[0])}let e=(new Date).getTime();t.items.forEach(o=>{o.plano_trabalho||(o.plano_trabalho=t.entity),t.util.asTimestamp(o.data_inicio)<=e&&e<=t.util.asTimestamp(o.data_fim)&&t.grid.expand(o.id)})})()}addConsolidacao(){var t=this;return(0,u.A)(function*(){return new ga({id:t.dao.generateUuid(),plano_trabalho_id:t.entity.id})})()}loadConsolidacao(t,e){var o=this;return(0,u.A)(function*(){o.form.patchValue({data_inicio:e.data_inicio,data_fim:e.data_fim}),o.cdRef.detectChanges()})()}removeConsolidacao(t){var e=this;return(0,u.A)(function*(){if(!(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=t;return yield e.dao?.delete(n),e.items.splice(e.items.findIndex(r=>r.id==n.id),1),!0}catch{return!1}})()}saveConsolidacao(t,e){var o=this;return(0,u.A)(function*(){let n;return o.form.markAllAsTouched(),o.form.valid&&(e.id="NEW"==e.id?o.dao.generateUuid():e.id,e.data_inicio=t.controls.data_inicio.value,e.data_fim=t.controls.data_fim.value,n=yield o.dao?.save(e)),n})()}refreshConsolidacao(t,e){e&&t._metadata?.planoTrabalhoConsolidacaoFormComponent?(t._metadata?.planoTrabalhoConsolidacaoFormComponent).loadConsolidacao(e):this.grid.refreshExpanded(t.id),this.grid.refreshRows()}concluir(t){var e=this;return(0,u.A)(function*(){e.submitting=!0;try{let o=yield e.dao.concluir(t.id);t.status=o.status,e.refreshConsolidacao(t,o)}catch(o){e.error(o.message||o)}finally{e.submitting=!1}})()}cancelarConclusao(t){var e=this;return(0,u.A)(function*(){e.submitting=!0;try{let o=yield e.dao.cancelarConclusao(t.id);t.status=o.status,e.refreshConsolidacao(t,o)}catch(o){e.error(o.message||o)}finally{e.submitting=!1}})()}anterior(t){return this.entity.consolidacoes.reduce((e,o)=>this.util.asTimestamp(o.data_inicio)<this.util.asTimestamp(t.data_inicio)&&(!e||this.util.asTimestamp(e.data_inicio)<this.util.asTimestamp(o.data_inicio))?o:e,void 0)}proximo(t){return this.entity.consolidacoes.reduce((e,o)=>this.util.asTimestamp(o.data_fim)>this.util.asTimestamp(t.data_fim)&&(!e||this.util.asTimestamp(e.data_fim)>this.util.asTimestamp(o.data_fim))?o:e,void 0)}isDisabled(t){return t&&"INCLUIDO"!=t.status||"ATIVO"!=this.entity?.status}podeInserir(){return this.auth.hasPermissionTo("MOD_PTR_CSLD_INCL")}dynamicButtons(t){let e=[],o=t;const n=o.plano_trabalho?.usuario_id,r=this.entity.unidade_id,d=o?.avaliacoes.filter(v=>null!=v.recurso).length>0,c=this.auth.usuario.id==n,_={gestor:!1,gestorSubstituto:!1,gestorDelegado:!1},m=this.entity?._metadata.atribuicoesGestorUsuarioLogado||_,g=this.entity?._metadata.atribuicoesGestorUsuario||_,p=this.entity?._metadata.gestorUnidadeSuperior||_,C=!c&&this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL")&&(this.auth.isIntegrante("AVALIADOR_PLANO_TRABALHO",r)||g.gestor&&(p.gestor||p.gestorSubstituto)||g.gestorSubstituto&&(m.gestor||p.gestor||p.gestorSubstituto)||!g.gestor&&!g.gestorSubstituto&&(m.gestor||m.gestorSubstituto)),y={hint:"Concluir",icon:"bi bi-check-circle",color:"btn-outline-success",onClick:this.concluir.bind(this)},j={hint:"Cancelar conclus\xe3o",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:this.cancelarConclusao.bind(this)},D={hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-warning",onClick:v=>this.planoTrabalhoService.avaliar(v,this.entity.programa,this.refreshConsolidacao.bind(this))},Q={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:v=>this.planoTrabalhoService.avaliar(v,this.entity.programa,this.refreshConsolidacao.bind(this))},W={label:"Recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:v=>this.planoTrabalhoService.fazerRecurso(v,this.entity.programa,this.refreshConsolidacao.bind(this))},Z={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:v=>this.planoTrabalhoService.cancelarAvaliacao(v,this,this.refreshConsolidacao.bind(this))};return"INCLUIDO"==o.status&&(c||this.auth.hasPermissionTo("MOD_PTR_CSLD_CONCL"))&&e.push(y),"CONCLUIDO"==o.status&&(c||this.auth.hasPermissionTo("MOD_PTR_CSLD_DES_CONCL"))&&e.push(j),"CONCLUIDO"==o.status&&C&&e.push(D),"AVALIADO"==o.status&&o.avaliacao&&(c&&!d&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&o.avaliacao?.data_avaliacao&&e.push(W),C&&(e.push(Q),e.push(Z))),e}mostrarAvaliacao(t){this.planoTrabalhoService.fazerRecurso(t,this.entity.programa,this.refreshConsolidacao.bind(this))}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["plano-trabalho-consolidacao-list"]],viewQuery:function(e,o){if(1&e&&a.GBs(A._,5),2&e){let n;a.mGM(n=a.lsd())&&(o.grid=n.first)}},inputs:{entity:"entity"},features:[a.Vt3],decls:24,vars:20,consts:[["grid",""],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["columnDataInicio",""],["columnDataFim",""],["columnEstatisticas",""],["columnStatus",""],["consolidacao",""],["editable","",3,"items","form","hasDelete","minHeight","add","hasAdd","hasEdit"],[1,"my-2"],[1,"bi","bi-arrow-down"],["type","expand",3,"icon","align","hint","template","expandTemplate"],["title","Data in\xedcio",3,"template"],["title","Data fim",3,"template"],["title","Estat\xedsticas/Avalia\xe7\xf5es",3,"template","width"],["title","Status",3,"template"],["type","options",3,"dynamicButtons"],[3,"disabled","entity","planoTrabalho","cdRef"],[3,"align","tipoAvaliacao","nota","click",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"click","align","tipoAvaliacao","nota"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"]],template:function(e,o){if(1&e&&(a.j41(0,"grid",8,0)(2,"h5",9),a.EFF(3),a.nrm(4,"i",10),a.k0s(),a.j41(5,"columns")(6,"column",11),a.DNE(7,We,0,0,"ng-template",null,1,a.C5r)(9,Ze,2,4,"ng-template",null,2,a.C5r),a.k0s(),a.j41(11,"column",12),a.DNE(12,Ke,1,1,"ng-template",null,3,a.C5r),a.k0s(),a.j41(14,"column",13),a.DNE(15,ao,1,1,"ng-template",null,4,a.C5r),a.k0s(),a.j41(17,"column",14),a.DNE(18,oo,2,2,"ng-template",null,5,a.C5r),a.k0s(),a.j41(20,"column",15),a.DNE(21,no,3,4,"ng-template",null,6,a.C5r),a.k0s(),a.nrm(23,"column",16),a.k0s()()),2&e){const n=a.sdS(8),r=a.sdS(10),d=a.sdS(13),c=a.sdS(16),_=a.sdS(19),m=a.sdS(22);a.Y8G("items",o.items)("form",o.form)("hasDelete",!0)("minHeight",0)("add",o.addConsolidacao.bind(o))("hasAdd",!1)("hasEdit",!1)("hasDelete",!1),a.R7$(3),a.SpI("",o.lex.translate("Consolida\xe7\xf5es")," "),a.R7$(3),a.Y8G("icon",o.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",o.lex.translate("Consolida\xe7\xe3o"))("template",n)("expandTemplate",r),a.R7$(5),a.Y8G("template",d),a.R7$(3),a.Y8G("template",c),a.R7$(3),a.Y8G("template",_)("width",300),a.R7$(3),a.Y8G("template",m),a.R7$(3),a.Y8G("dynamicButtons",o.dynamicButtons.bind(o))}},dependencies:[h.bT,A._,N.T,$.I,I.F,P.n,ba.R,Ta]})}return i})();const lo=["accordion"];function ro(i,l){1&i&&a.nrm(0,"badge",13),2&i&&a.Y8G("badge",l.$implicit)}function so(i,l){if(1&i&&(a.j41(0,"div",4)(1,"div",5),a.EFF(2),a.k0s(),a.j41(3,"div",6),a.nrm(4,"badge",10)(5,"badge",10)(6,"badge",10)(7,"badge",10),a.k0s(),a.j41(8,"div",7),a.EFF(9),a.k0s(),a.j41(10,"div",8),a.DNE(11,ro,1,1,"badge",11),a.k0s(),a.j41(12,"div",8),a.nrm(13,"badge",12),a.k0s()()),2&i){const t=l.item,e=a.XpG();a.R7$(2),a.JRh("#"+t.numero),a.R7$(2),a.Y8G("icon",e.entityService.getIcon("Usuario"))("label",null==t.usuario?null:t.usuario.nome)("hint",e.lex.translate("Participante")+": "+(null==t.usuario?null:t.usuario.nome)),a.R7$(),a.Y8G("icon",e.entityService.getIcon("Unidade"))("label",null==t.unidade?null:t.unidade.sigla)("hint",e.lex.translate("Unidade")+": "+(null==t.unidade?null:t.unidade.nome)),a.R7$(),a.Y8G("icon",e.entityService.getIcon("Programa"))("label",null==t.programa?null:t.programa.nome)("hint",e.lex.translate("Programa")),a.R7$(),a.Y8G("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.tipo_modalidade?null:t.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade")),a.R7$(2),a.SpI(" ",e.dao.getDateFormatted(t.data_inicio)+" at\xe9 "+e.dao.getDateFormatted(t.data_fim)," "),a.R7$(2),a.Y8G("ngForOf",e.getPlanoBadges(t)),a.R7$(2),a.Y8G("label",e.lookup.getValue(e.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.PLANO_TRABALHO_STATUS,t.status))("color",e.lookup.getColor(e.lookup.PLANO_TRABALHO_STATUS,t.status))}}function co(i,l){1&i&&a.nrm(0,"plano-trabalho-consolidacao-list",14),2&i&&a.Y8G("entity",l.item)}let uo=(()=>{class i extends k.g{set arquivados(t){this._arquivados!=t&&(this._arquivados=t,this.viewInit&&this.loadData(this.entity,this.form))}get arquivados(){return this._arquivados}constructor(t){super(t),this.injector=t,this.selectedIndex=-1,this.planos=[],this._arquivados=!1,this.dao=t.get(S.x)}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),(0,u.A)(function*(){yield t.loadData(t.entity,t.form)})()}loadData(t,e){var o=this;return(0,u.A)(function*(){o.accordion.loading=!0;try{let r=yield o.dao.getByUsuario(o.usuarioId,o.arquivados),d=(new Date).getTime();o.planos=r.planos;for(var n=0;n<o.planos.length;n++)o.util.asTimestamp(o.planos[n].data_inicio)<=d&&d<=o.util.asTimestamp(o.planos[n].data_fim)&&["ATIVO","CONCLUIDO"].includes(o.planos[n].status)&&(o.selectedIndex=n)}finally{o.accordion.loading=!1,o.cdRef.detectChanges()}})()}getPlanoBadges(t){let e=[],o=t.consolidacoes.filter(r=>"CONCLUIDO"==r.status),n=t.consolidacoes.filter(r=>"AVALIADO"==r.status);if(o.length){const r=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"CONCLUIDO");e.push({icon:r?.icon,label:r?.value,color:r?.color,textValue:o.length.toString()})}if(n.length){const r=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"AVALIADO");e.push({icon:r?.icon,label:r?.value,color:r?.color,textValue:n.length.toString()})}return JSON.stringify(t._metadata?.badges)!=this.JSON.stringify(e)&&(t._metadata=Object.assign(t._metadata||{},{badges:e})),t._metadata.badges}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["plano-trabalho-list-accordeon"]],viewQuery:function(e,o){if(1&e&&a.GBs(lo,5),2&e){let n;a.mGM(n=a.lsd())&&(o.accordion=n.first)}},inputs:{usuarioId:"usuarioId",arquivados:"arquivados"},features:[a.Vt3],decls:17,vars:8,consts:[["accordion",""],["planoTrabalhoSectionTitle",""],["planoTrabalhoSection",""],[1,"p-3","bg-body-secondary","mb-3"],[1,"row","w-100"],[1,"col-md-1"],[1,"col-md-4"],[1,"col-md-3"],[1,"col-md-2"],[3,"items","selectedIndex","titleTemplate","template"],["color","light",3,"icon","label","hint"],[3,"badge",4,"ngFor","ngForOf"],[3,"label","icon","color"],[3,"badge"],[3,"entity"]],template:function(e,o){if(1&e&&(a.j41(0,"div",3)(1,"div",4)(2,"div",5),a.EFF(3,"#ID"),a.k0s(),a.j41(4,"div",6),a.EFF(5),a.k0s(),a.j41(6,"div",7),a.EFF(7,"Vig\xeancia"),a.k0s(),a.nrm(8,"div",8),a.j41(9,"div",8),a.EFF(10,"Status"),a.k0s()()(),a.j41(11,"accordion",9,0),a.DNE(13,so,14,18,"ng-template",null,1,a.C5r)(15,co,1,1,"ng-template",null,2,a.C5r),a.k0s()),2&e){const n=a.sdS(14),r=a.sdS(16);a.R7$(5),a.LHq("",o.lex.translate("Participante"),"/",o.lex.translate("Unidade"),"/",o.lex.translate("Programa"),"/",o.lex.translate("Tipo de modalidade"),""),a.R7$(6),a.Y8G("items",o.planos)("selectedIndex",o.selectedIndex)("titleTemplate",n)("template",r)}},dependencies:[h.Sq,P.n,Wt.M,Ca]})}return i})();function mo(i,l){1&i&&(a.j41(0,"div",17)(1,"div",18),a.nrm(2,"span",19),a.k0s()())}function po(i,l){if(1&i&&(a.j41(0,"div",21)(1,"div",22),a.nrm(2,"profile-picture",23),a.k0s(),a.j41(3,"div",24)(4,"strong"),a.EFF(5),a.k0s(),a.nrm(6,"br"),a.j41(7,"small"),a.EFF(8),a.k0s()()()),2&i){const t=l.data;a.R7$(2),a.Y8G("url",t.url_foto)("size",40)("hint",t.nome),a.R7$(3),a.JRh(t.nome||""),a.R7$(3),a.JRh(t.apelido||"")}}function _o(i,l){1&i&&a.nrm(0,"plano-trabalho-list-accordeon",25),2&i&&a.Y8G("usuarioId",l.data.id)}function ho(i,l){if(1&i&&(a.j41(0,"collapse-card",20),a.DNE(1,po,9,5,"ng-template",null,4,a.C5r)(3,_o,1,1,"ng-template",null,5,a.C5r),a.k0s()),2&i){const t=l.$implicit,e=a.sdS(2),o=a.sdS(4);a.Y8G("data",t)("titleTemplate",e)("template",o)}}function go(i,l){if(1&i&&(a.j41(0,"filter",10)(1,"div",11),a.nrm(2,"input-search",12,3),a.k0s()(),a.j41(4,"div",13)(5,"h5"),a.EFF(6),a.k0s(),a.j41(7,"h4"),a.EFF(8),a.nrm(9,"i",14),a.k0s()(),a.DNE(10,mo,3,0,"div",15)(11,ho,5,3,"collapse-card",16)),2&i){const t=a.sdS(3),e=a.XpG(2);a.Y8G("form",e.filter)("filter",e.filterWhere)("collapsed",!1),a.R7$(2),a.Y8G("size",12)("control",e.filter.controls.unidade_id)("dao",e.unidadeDao),a.R7$(4),a.E5c("",e.lex.translate("Unidade")," selecionada: ",null==t||null==t.selectedItem?null:t.selectedItem.entity.sigla," - ",null==t||null==t.selectedItem?null:t.selectedItem.entity.nome,""),a.R7$(2),a.SpI("",e.lex.translate("Participantes")," "),a.R7$(2),a.Y8G("ngIf",e.loading),a.R7$(),a.Y8G("ngForOf",e.usuarios)}}function fo(i,l){if(1&i&&(a.j41(0,"tab",9),a.DNE(1,go,12,12,"ng-template",null,2,a.C5r),a.k0s()),2&i){const t=a.sdS(2),e=a.XpG();a.Y8G("icon",e.entityService.getIcon("Unidade"))("label",e.lex.translate("Unidade"))("template",t)}}function bo(i,l){if(1&i&&(a.j41(0,"div",26)(1,"h5",27),a.EFF(2),a.nrm(3,"i",14),a.k0s(),a.nrm(4,"separator",28),a.k0s(),a.nrm(5,"plano-trabalho-list-accordeon",29)),2&i){const t=a.XpG();a.R7$(2),a.SpI("",t.lex.translate("Planos de Trabalho")," "),a.R7$(2),a.Y8G("control",t.form.controls.arquivados)("title","Mostrar "+t.lex.translate("Planos de trabalho")+" arquivados?"),a.R7$(),a.Y8G("usuarioId",t.auth.usuario.id)("arquivados",t.form.controls.arquivados.value)}}let vo=(()=>{class i extends k.g{constructor(t){super(t),this.injector=t,this.usuarios=[],this.loadingUnidade=!1,this.filterWhere=e=>{this.loadUsuarios(e.value.unidade_id)},this.unidadeDao=t.get(F.s),this.form=this.fh.FormBuilder({arquivados:{default:!1}}),this.filter=this.fh.FormBuilder({unidade_id:{default:!1}})}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),this.tabs.active=this.queryParams?.tab||"USUARIO",this.tabs.title=this.lex.translate("Consolida\xe7\xf5es"),(0,u.A)(function*(){yield t.loadData(t.entity,t.form)})()}loadData(t,e){var o=this;return(0,u.A)(function*(){o.unidade=o.auth.unidadeGestor(),o.filter.controls.unidade_id.setValue(o.unidade?.id||o.auth.lotacao||null),o.unidade&&(yield o.loadUsuarios(o.unidade.id))})()}loadUsuarios(t){var e=this;return(0,u.A)(function*(){e.usuarios=[],e.loadingUnidade=!0,e.loading=!0,e.cdRef.detectChanges();try{e.usuarios=yield e.unidadeDao.lotados(t)}finally{e.loading=!1,e.loadingUnidade=!1,e.cdRef.detectChanges()}})()}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["app-plano-trabalho-consolidacao"]],viewQuery:function(e,o){if(1&e&&(a.GBs(V.O,5),a.GBs(E.O,5)),2&e){let n;a.mGM(n=a.lsd())&&(o.tabs=n.first),a.mGM(n=a.lsd())&&(o.unidadeSelecionada=n.first)}},features:[a.Vt3],decls:6,vars:5,consts:[["tabs",""],["tabUsuario",""],["tabUnidade",""],["unidadeSelecionada",""],["usuarioCardTitle",""],["usuarioCard",""],["right","",3,"title"],["key","UNIDADE",3,"icon","label","template",4,"ngIf"],["key","USUARIO",3,"icon","label","template"],["key","UNIDADE",3,"icon","label","template"],[3,"form","filter","collapsed"],[1,"row"],["label","Selecione a unidade","controlName","unidade_id",3,"size","control","dao"],[1,"p-3","mb-3","bg-body-secondary"],[1,"bi","bi-arrow-down"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"data","titleTemplate","template",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[3,"data","titleTemplate","template"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],[3,"usuarioId"],[1,"d-flex","justify-content-between"],[1,"mt-2"],[3,"control","title"],[3,"usuarioId","arquivados"]],template:function(e,o){if(1&e&&(a.j41(0,"tabs",6,0),a.DNE(2,fo,3,3,"tab",7),a.j41(3,"tab",8),a.DNE(4,bo,6,5,"ng-template",null,1,a.C5r),a.k0s()()),2&e){const n=a.sdS(5);a.Y8G("title",o.isModal?"":o.title),a.R7$(2),a.Y8G("ngIf",o.unidade),a.R7$(),a.Y8G("icon",o.entityService.getIcon("Usuario"))("label",o.lex.translate("Usu\xe1rio"))("template",n)}},dependencies:[h.Sq,h.bT,q.i,E.O,V.O,L.j,I.F,_a.r,Qt,uo]})}return i})();var Ea=s(3764),To=s(9062),Co=s(619),Aa=s(2305),Da=s(6764);function Eo(i,l){if(1&i&&(a.j41(0,"div",42)(1,"div",43),a.nrm(2,"profile-picture",44),a.k0s(),a.j41(3,"div",45)(4,"strong"),a.EFF(5),a.k0s(),a.nrm(6,"br")(7,"badge",46),a.k0s()()),2&i){let t,e,o,n;const r=l.separator,d=a.XpG(2);a.R7$(2),a.Y8G("url",null==(t=d.usuarioSeparator(r))?null:t.url_foto)("size",40)("hint",null==(e=d.usuarioSeparator(r))?null:e.nome),a.R7$(3),a.JRh((null==(o=d.usuarioSeparator(r))?null:o.nome)||"Desconhecido"),a.R7$(2),a.Y8G("icon",d.entityService.getIcon("Unidade"))("label",(null==(n=d.unidadeSeparator(r))?null:n.sigla)||"Desconhecido")}}function Ao(i,l){1&i&&a.nrm(0,"toolbar")}function Do(i,l){}function yo(i,l){if(1&i&&a.nrm(0,"plano-trabalho-consolidacao-form",47,14),2&i){const t=l.row,e=a.XpG(2);a.Y8G("disabled",!0)("entity",t)("planoTrabalho",t.plano_trabalho)("cdRef",e.cdRef)}}function Go(i,l){if(1&i&&(a.EFF(0),a.nrm(1,"badge",48)(2,"badge",49)(3,"badge",50)),2&i){const t=l.row,e=a.XpG(2);a.SpI(" #",null==t.plano_trabalho?null:t.plano_trabalho.numero," "),a.R7$(),a.Y8G("textValue",e.util.getDateFormatted(null==t.plano_trabalho?null:t.plano_trabalho.data_inicio)),a.R7$(),a.Y8G("textValue",e.util.getDateFormatted(null==t.plano_trabalho?null:t.plano_trabalho.data_fim)),a.R7$(),a.Y8G("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho||null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade"))}}function Ro(i,l){if(1&i&&a.EFF(0),2&i){const t=l.row,e=a.XpG(2);a.SpI(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function Io(i,l){if(1&i&&(a.j41(0,"strong"),a.EFF(1),a.k0s()),2&i){const t=l.row,e=a.XpG(2);a.R7$(),a.JRh(e.util.getDateFormatted(t.data_fim))}}function Po(i,l){if(1&i&&a.nrm(0,"avaliar-nota-badge",53),2&i){const t=a.XpG().row;a.Y8G("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function So(i,l){if(1&i&&(a.j41(0,"separator",54)(1,"small"),a.EFF(2),a.k0s()()),2&i){const t=a.XpG().row;a.Y8G("collapsed",!1),a.R7$(2),a.JRh(t.avaliacao.recurso)}}function Fo(i,l){if(1&i&&a.DNE(0,Po,1,3,"avaliar-nota-badge",51)(1,So,3,2,"separator",52),2&i){const t=l.row;a.Y8G("ngIf",t.avaliacao),a.R7$(),a.Y8G("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function Oo(i,l){1&i&&a.nrm(0,"badge",58)}function Yo(i,l){if(1&i&&(a.j41(0,"div",55),a.nrm(1,"badge",56),a.DNE(2,Oo,1,0,"badge",57),a.k0s()),2&i){const t=l.row,e=a.XpG(2);a.R7$(),a.Y8G("color",e.lookup.getColor(e.lookup.CONSOLIDACAO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.CONSOLIDACAO_STATUS,t.status))("label",e.lookup.getValue(e.lookup.CONSOLIDACAO_STATUS,t.status)),a.R7$(),a.Y8G("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function ko(i,l){if(1&i){const t=a.RV6();a.j41(0,"grid",26),a.DNE(1,Eo,8,6,"ng-template",null,2,a.C5r)(3,Ao,1,0,"toolbar",27),a.j41(4,"filter",28)(5,"div",29),a.nrm(6,"input-search",30,3),a.j41(8,"input-search",31,4),a.bIt("change",function(o){a.eBV(t);const n=a.XpG();return a.Njj(n.onUnidadeChange(o))}),a.k0s(),a.nrm(10,"input-switch",32,5)(12,"input-switch",33,6),a.k0s()(),a.j41(14,"columns")(15,"column",34),a.DNE(16,Do,0,0,"ng-template",null,7,a.C5r)(18,yo,2,4,"ng-template",null,8,a.C5r),a.k0s(),a.j41(20,"column",35),a.DNE(21,Go,4,6,"ng-template",null,9,a.C5r),a.k0s(),a.j41(23,"column",36),a.DNE(24,Ro,1,1,"ng-template",null,10,a.C5r),a.k0s(),a.j41(26,"column",37),a.DNE(27,Io,2,1,"ng-template",null,11,a.C5r),a.k0s(),a.j41(29,"column",38),a.DNE(30,Fo,2,2,"ng-template",null,12,a.C5r),a.k0s(),a.j41(32,"column",39),a.DNE(33,Yo,3,4,"ng-template",null,13,a.C5r),a.k0s(),a.nrm(35,"column",40),a.k0s(),a.nrm(36,"pagination",41),a.k0s()}if(2&i){const t=a.sdS(2),e=a.sdS(17),o=a.sdS(19),n=a.sdS(22),r=a.sdS(25),d=a.sdS(28),c=a.sdS(31),_=a.sdS(34),m=a.XpG();a.Y8G("dao",m.dao)("orderBy",m.orderBy)("groupBy",m.groupBy)("join",m.join)("init",m.initGrid.bind(m))("hasAdd",!1)("hasEdit",!1)("loadList",m.onGridLoad.bind(m))("groupTemplate",t),a.R7$(3),a.Y8G("ngIf",!m.selectable),a.R7$(),a.Y8G("form",m.filter)("where",m.filterWhere)("submit",m.filterSubmit.bind(m))("collapseChange",m.filterCollapseChange.bind(m))("collapsed",m.filterCollapsed)("deleted",m.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.R7$(2),a.Y8G("size",5)("control",m.filter.controls.usuario_id)("dao",m.usuarioDao),a.R7$(2),a.Y8G("size",5)("control",m.filter.controls.unidade_id)("dao",m.unidadeDao),a.R7$(2),a.Y8G("size",1)("disabled",m.canFilterSubordinadas)("control",m.filter.controls.unidades_subordinadas),a.R7$(2),a.Y8G("size",1)("control",m.filter.controls.incluir_arquivados),a.R7$(3),a.Y8G("icon",m.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",m.lex.translate("Consolida\xe7\xe3o"))("template",e)("expandTemplate",o),a.R7$(5),a.Y8G("title","Plano de trabalho/Vig\xeancia/Modalidade")("template",n),a.R7$(3),a.Y8G("template",r),a.R7$(3),a.Y8G("template",d),a.R7$(3),a.Y8G("title","Estat\xedsticas\nAvalia\xe7\xf5es")("template",c)("width",300),a.R7$(3),a.Y8G("template",_),a.R7$(3),a.Y8G("dynamicButtons",m.dynamicButtons.bind(m)),a.R7$(),a.Y8G("rows",m.rowsLimit)}}function No(i,l){if(1&i&&(a.j41(0,"div",42)(1,"div",43),a.nrm(2,"profile-picture",44),a.k0s(),a.j41(3,"div",45)(4,"strong"),a.EFF(5),a.k0s(),a.nrm(6,"br")(7,"badge",46),a.k0s()()),2&i){let t,e,o,n;const r=l.separator,d=a.XpG(2);a.R7$(2),a.Y8G("url",null==(t=d.usuarioSeparator(r))?null:t.url_foto)("size",40)("hint",null==(e=d.usuarioSeparator(r))?null:e.nome),a.R7$(3),a.JRh((null==(o=d.usuarioSeparator(r))?null:o.nome)||"Desconhecido"),a.R7$(2),a.Y8G("icon",d.entityService.getIcon("Unidade"))("label",(null==(n=d.unidadeSeparator(r))?null:n.sigla)||"Desconhecido")}}function $o(i,l){1&i&&a.nrm(0,"toolbar")}function jo(i,l){}function xo(i,l){if(1&i&&(a.j41(0,"div",64)(1,"div",65),a.nrm(2,"profile-picture",44),a.k0s(),a.j41(3,"div",66)(4,"strong"),a.EFF(5),a.k0s(),a.nrm(6,"br"),a.j41(7,"small"),a.EFF(8),a.k0s()()()),2&i){const t=l.row;a.R7$(2),a.Y8G("url",t.avaliador.url_foto||"")("size",40)("hint",t.avaliador.nome||""),a.R7$(3),a.JRh(t.avaliador.nome||""),a.R7$(3),a.JRh(t.avaliador.apelido||"")}}function Vo(i,l){if(1&i&&(a.nrm(0,"badge",67)(1,"br"),a.j41(2,"small"),a.EFF(3),a.k0s()),2&i){const t=l.row,e=a.XpG(3);a.Y8G("label",e.getNota(t).nota)("icon",e.getNota(t).icone)("color",e.getNota(t).cor),a.R7$(3),a.JRh(e.getNota(t).descricao)}}function wo(i,l){if(1&i&&a.nrm(0,"badge",69),2&i){const t=l.$implicit,e=a.XpG(4);a.Y8G("icon",e.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function Uo(i,l){if(1&i&&(a.EFF(0),a.j41(1,"div",55),a.DNE(2,wo,1,2,"badge",68),a.k0s()),2&i){const t=l.row;a.SpI(" ",t.justificativa||""," "),a.R7$(2),a.Y8G("ngForOf",t.justificativas)}}function Lo(i,l){if(1&i&&(a.j41(0,"small"),a.EFF(1),a.k0s()),2&i){const t=l.row;a.R7$(),a.JRh(t.recurso||"")}}function Bo(i,l){1&i&&a.nrm(0,"badge",58)}function Mo(i,l){1&i&&a.nrm(0,"badge",71)}function zo(i,l){if(1&i&&(a.j41(0,"div",55),a.DNE(1,Bo,1,0,"badge",57)(2,Mo,1,0,"badge",70),a.k0s()),2&i){const t=l.row,e=a.XpG(3);a.R7$(),a.Y8G("ngIf",null==t.recurso?null:t.recurso.length),a.R7$(),a.Y8G("ngIf",t.id==(null==e.avaliacao?null:e.avaliacao.id))}}function Xo(i,l){if(1&i&&(a.j41(0,"grid",60,18)(2,"columns"),a.nrm(3,"column",61),a.j41(4,"column",62),a.DNE(5,xo,9,5,"ng-template",null,19,a.C5r),a.k0s(),a.j41(7,"column",35),a.DNE(8,Vo,4,4,"ng-template",null,20,a.C5r),a.k0s(),a.j41(10,"column",35),a.DNE(11,Uo,3,2,"ng-template",null,21,a.C5r),a.k0s(),a.j41(13,"column",63),a.DNE(14,Lo,2,1,"ng-template",null,22,a.C5r),a.k0s(),a.j41(16,"column",39),a.DNE(17,zo,3,2,"ng-template",null,13,a.C5r),a.k0s()()()),2&i){const t=l.row,e=a.sdS(6),o=a.sdS(9),n=a.sdS(12),r=a.sdS(15),d=a.sdS(18),c=a.XpG(2);a.Y8G("items",c.getAvaliacoes(t))("minHeight",0),a.R7$(4),a.Y8G("template",e),a.R7$(3),a.Y8G("title","Nota")("template",o),a.R7$(3),a.Y8G("title","Justificativas")("template",n),a.R7$(3),a.Y8G("template",r),a.R7$(3),a.Y8G("template",d)}}function Ho(i,l){if(1&i&&(a.EFF(0),a.nrm(1,"badge",48)(2,"badge",49)(3,"badge",50)),2&i){const t=l.row,e=a.XpG(2);a.SpI(" # ",null==t.plano_trabalho?null:t.plano_trabalho.numero," "),a.R7$(),a.Y8G("textValue",e.util.getDateFormatted(t.plano_trabalho.data_inicio)),a.R7$(),a.Y8G("textValue",e.util.getDateFormatted(t.plano_trabalho.data_fim)),a.R7$(),a.Y8G("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade"))}}function qo(i,l){if(1&i&&a.EFF(0),2&i){const t=l.row,e=a.XpG(2);a.SpI(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function Jo(i,l){if(1&i&&a.EFF(0),2&i){const t=l.row,e=a.XpG(2);a.SpI(" ",e.util.getDateFormatted(t.data_fim)," ")}}function Qo(i,l){if(1&i){const t=a.RV6();a.j41(0,"grid",26),a.DNE(1,No,8,6,"ng-template",null,15,a.C5r)(3,$o,1,0,"toolbar",27),a.j41(4,"filter",28)(5,"div",29),a.nrm(6,"input-search",30,3),a.j41(8,"input-search",31,4),a.bIt("change",function(o){a.eBV(t);const n=a.XpG();return a.Njj(n.onUnidadeChange(o))}),a.k0s(),a.nrm(10,"input-switch",32,5)(12,"input-switch",33,6),a.k0s()(),a.j41(14,"columns")(15,"column",59),a.DNE(16,jo,0,0,"ng-template",null,16,a.C5r)(18,Xo,19,9,"ng-template",null,17,a.C5r),a.k0s(),a.j41(20,"column",35),a.DNE(21,Ho,4,6,"ng-template",null,9,a.C5r),a.k0s(),a.j41(23,"column",36),a.DNE(24,qo,1,1,"ng-template",null,10,a.C5r),a.k0s(),a.j41(26,"column",37),a.DNE(27,Jo,1,1,"ng-template",null,11,a.C5r),a.k0s()(),a.nrm(29,"pagination",41),a.k0s()}if(2&i){const t=a.sdS(2),e=a.sdS(17),o=a.sdS(19),n=a.sdS(22),r=a.sdS(25),d=a.sdS(28),c=a.XpG();a.Y8G("dao",c.dao)("orderBy",c.orderBy)("groupBy",c.groupBy)("join",c.join)("init",c.initGrid.bind(c))("hasAdd",!1)("hasEdit",!1)("loadList",c.onGridLoadHistorico.bind(c))("groupTemplate",t),a.R7$(3),a.Y8G("ngIf",!c.selectable),a.R7$(),a.Y8G("form",c.filter)("where",c.filterWhereHistorico)("submit",c.filterSubmit.bind(c))("collapseChange",c.filterCollapseChange.bind(c))("collapsed",c.filterCollapsed)("deleted",c.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.R7$(2),a.Y8G("size",5)("control",c.filter.controls.usuario_id)("dao",c.usuarioDao),a.R7$(2),a.Y8G("size",5)("control",c.filter.controls.unidade_id)("dao",c.unidadeDao),a.R7$(2),a.Y8G("size",1)("disabled",c.canFilterSubordinadas)("control",c.filter.controls.unidades_subordinadas),a.R7$(2),a.Y8G("size",1)("control",c.filter.controls.incluir_arquivados),a.R7$(3),a.Y8G("icon",c.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("template",e)("expandTemplate",o),a.R7$(5),a.Y8G("title","Plano de trabalho/Vig\xeancia/Modalidade")("template",n),a.R7$(3),a.Y8G("template",r),a.R7$(3),a.Y8G("template",d),a.R7$(3),a.Y8G("rows",c.rowsLimit)}}const Zo=[{path:"",component:pa.r,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Planos de Trabalho"}},{path:"new",component:H,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Trabalho",modal:!0}},{path:"termo",component:Ya,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Termo de ades\xe3o",modal:!0}},{path:"consolidacao/avaliacao",component:(()=>{class i extends To.P{constructor(t){super(t,ga,J.I),this.injector=t,this.avaliacoes=[],this.avaliacao=new Co.K,this.consolidacaoId=[],this.joinAvaliacao=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.filterWhere=e=>{let o=[],n=e.value;return o.push(["status","in",["CONCLUIDO","AVALIADO"]]),n.usuario_id?.length&&o.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&o.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&o.push(["incluir_arquivados","==",!0]),o},this.filterWhereHistorico=e=>{let o=[],n=e.value;return o.push(["status","in",["AVALIADO"]]),n.usuario_id?.length&&o.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&o.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&o.push(["incluir_arquivados","==",!0]),o},this.unidadeService=t.get(B.S),this.join=["avaliacao","plano_trabalho:id"],this.extraJoin=["avaliacao.tipoAvaliacao.notas","planoTrabalho.unidade:id,sigla,nome","planoTrabalho.unidade.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.unidadePai.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.unidade.unidadePai.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.tipoModalidade:id,nome","planoTrabalho.usuario:id,nome,apelido,foto_perfil,url_foto"],this.groupBy=[{field:"plano_trabalho.unidade.sigla",label:this.lex.translate("Unidade")},{field:"plano_trabalho.unidade.id",label:"Unidade Id"},{field:"plano_trabalho.usuario.nome",label:this.lex.translate("Participante")},{field:"plano_trabalho.usuario.id",label:"Usu\xe1rio Id"}],this.usuarioDao=t.get(w._),this.unidadeDao=t.get(F.s),this.avaliacaoDao=t.get(fa.l),this.planoTrabalhoService=t.get(Y.V),this.title="Avalia\xe7\xf5es "+this.lex.translate("das Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD_AVAL",this.filter=this.fh.FormBuilder({usuario_id:{default:""},unidade_id:{default:""},unidades_subordinadas:{default:!1},incluir_arquivados:{default:!1}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||this.auth.lotacao||null)}get canFilterSubordinadas(){return this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)?void 0:"true"}usuarioSeparator(t){let e=t.group[3].value;return t.metadata=t.metadata||{},t.metadata.usuario=t.metadata.usuario||this.extra?.planos_trabalhos?.find(o=>o.usuario_id==e)?.usuario,t.metadata.usuario}unidadeSeparator(t){let e=t.group[1].value;return t.metadata=t.metadata||{},t.metadata.unidade=t.metadata.unidade||this.extra?.planos_trabalhos?.find(o=>o.unidade_id==e)?.unidade,t.metadata.unidade}onUnidadeChange(t){this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)||this.filter.controls.unidades_subordinadas.setValue(!1)}onGridLoad(t){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(o=>{let n=o;n.programa=this.extra?.programas?.find(r=>r.id==n.programa_id)}),t?.forEach(o=>{let n=o;n.plano_trabalho=this.extra?.planos_trabalhos?.find(r=>r.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(r=>r.id==n.avaliacao.tipo_avaliacao_id))})}refreshConsolidacao(t){var e=this;(0,u.A)(function*(){yield e.grid.query.refreshId(t.id,e.extraJoin),e.grid.refreshRows()})()}dynamicButtons(t){let e=[],o=t,n=o.plano_trabalho.programa,r=!1;const d=o.plano_trabalho.usuario_id,c=o.plano_trabalho.unidade_id,_=o.plano_trabalho.unidade,m=d==this.auth.usuario?.id,g=_?.gestor?.usuario_id==d,p=_?.gestores_substitutos.map(T=>T.usuario_id).includes(d),C=_?.gestores_delegados.map(T=>T.usuario_id).includes(d),y=!g&&!p&&!C,j=this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL"),D=this.unidadeService.isGestorUnidadeSuperior(o.plano_trabalho?.unidade);g?r=D:p?r=D||this.unidadeService.isGestorTitularUnidade(c):C?r=D||this.unidadeService.isGestorUnidade(c,!1):y&&(r=D||this.unidadeService.isGestorUnidade(c));const W={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:T=>this.planoTrabalhoService.avaliar(T,n,this.refreshConsolidacao.bind(this))},Z={label:"Recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:T=>this.planoTrabalhoService.fazerRecurso(T,n,this.refreshConsolidacao.bind(this))},v={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:T=>this.planoTrabalhoService.cancelarAvaliacao(T,this,this.refreshConsolidacao.bind(this))};return"CONCLUIDO"==o.status&&!m&&r&&j&&e.push({hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-info",onClick:T=>this.planoTrabalhoService.avaliar(T,n,this.refreshConsolidacao.bind(this))}),"AVALIADO"==o.status&&o.avaliacao&&(m&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&o.avaliacao?.data_avaliacao&&e.push(Z),r&&(e.push(W),e.push(v))),e}onSelectTab(t){var e=this;return(0,u.A)(function*(){e.viewInit&&e.saveUsuarioConfig({active_tab:t.key})})()}initGrid(t){t.queryInit()}getAvaliacoes(t){return this.avaliacoes.filter(e=>e.plano_trabalho_consolidacao_id==t.id)}loadData(){var t=this;return(0,u.A)(function*(){t.loading=!0;try{t.avaliacoes=yield t.avaliacaoDao.query({where:[["plano_trabalho_consolidacao_id","in",t.consolidacaoId]],join:t.joinAvaliacao,orderBy:[["data_avaliacao","desc"]]}).asPromise(),t.avaliacao=t.avaliacoes[0]||t.avaliacao}finally{t.loading=!1}})()}onGridLoadHistorico(t){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(o=>{let n=o;n.programa=this.extra?.programas?.find(r=>r.id==n.programa_id)}),t?.forEach(o=>{this.consolidacaoId?.push(o.id);let n=o;n.plano_trabalho=this.extra?.planos_trabalhos?.find(r=>r.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(r=>r.id==n.avaliacao.tipo_avaliacao_id))}),this.loadData()}getNota(t){return t.tipo_avaliacao.notas.find(e=>e.codigo==t.nota)}static#a=this.\u0275fac=function(e){return new(e||i)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:i,selectors:[["app-plano-trabalho-consolidacao-avaliacao"]],viewQuery:function(e,o){if(1&e&&a.GBs(A._,5),2&e){let n;a.mGM(n=a.lsd())&&(o.grid=n.first)}},features:[a.Vt3],decls:7,vars:5,consts:[["consolidacoes",""],["historico",""],["groupUnidadeUsuario",""],["usuario",""],["unidade",""],["subordinadas",""],["arquivadas",""],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["columnPlanoTrabalho",""],["columnDataInicio",""],["columnDataFim",""],["columnEstatisticas",""],["columnStatus",""],["consolidacao",""],["groupHistorico",""],["columnHistorico",""],["columnExpandedHistorico",""],["gridEntregas",""],["columnAvaliador",""],["columnNota",""],["columnJustificativa",""],["columnRecurso",""],["right","",3,"title","select"],["key","CONSOLIDACOES","icon","bi bi-clipboard-check",3,"label","template"],["key","HISTORICO","icon","bi bi-clipboard-pulse","label","Hist\xf3rico de Avalia\xe7\xf5es",3,"template"],[3,"dao","orderBy","groupBy","join","init","hasAdd","hasEdit","loadList","groupTemplate"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["controlName","unidade_id",3,"change","size","control","dao"],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","disabled","control"],["label","Arq.","controlName","incluir_arquivados","labelInfo","Incluir os planos de trabalhos arquivados",3,"size","control"],["type","expand",3,"icon","align","hint","template","expandTemplate"],[3,"title","template"],["title","Data in\xedcio",3,"template"],["title","Data fim",3,"template"],[3,"title","template","width"],["title","Status",3,"template"],["type","options",3,"dynamicButtons"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","primary",3,"icon","label"],[3,"disabled","entity","planoTrabalho","cdRef"],["label","In\xedcio","color","light","icon","bi bi-calendar2",3,"textValue"],["label","T\xe9rmino","color","light","icon","bi bi-calendar2-check",3,"textValue"],["color","light",3,"icon","label","hint"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["type","expand",3,"icon","align","template","expandTemplate"],[3,"items","minHeight"],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],["title","Recurso",3,"template"],[1,"avaliador"],[1,"avaliador-profile"],[1,"avaliador-nome"],[3,"label","icon","color"],[3,"icon","label",4,"ngFor","ngForOf"],[3,"icon","label"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(e,o){if(1&e&&(a.j41(0,"tabs",23)(1,"tab",24),a.DNE(2,ko,37,42,"ng-template",null,0,a.C5r),a.k0s(),a.j41(4,"tab",25),a.DNE(5,Qo,30,36,"ng-template",null,1,a.C5r),a.k0s()()),2&e){const n=a.sdS(3),r=a.sdS(6);a.Y8G("title",o.isModal?"":o.title)("select",o.onSelectTab.bind(o)),a.R7$(),a.Y8G("label",o.lex.translate("Consolida\xe7\xf5es"))("template",n),a.R7$(3),a.Y8G("template",r)}},dependencies:[h.Sq,h.bT,A._,N.T,$.I,q.i,Aa.H,Da.e,O.S,E.O,V.O,L.j,I.F,P.n,_a.r,ba.R,Ta]})}return i})(),canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Avalia\xe7\xe3o das Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/avaliar",component:Ea.I,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Avaliar Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/recurso",component:Ea.I,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Recurso da Avalia\xe7\xe3o da Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:usuarioId/:planoTrabalhoId",component:Ca,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao",component:vo,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es"}},{path:":id/edit",component:H,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Trabalho",modal:!0}},{path:":id/consult",component:H,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Trabalho",modal:!0}},{path:"entrega-list",component:X,canActivate:[f.q],resolve:{config:b.L},runGuardsAndResolvers:"always",data:{title:"Lista de Entregas do Plano de Trabalho",modal:!0}}];let Ko=(()=>{class i{static#a=this.\u0275fac=function(e){return new(e||i)};static#t=this.\u0275mod=a.$C({type:i});static#e=this.\u0275inj=a.G2t({imports:[aa.iI.forChild(Zo),aa.iI]})}return i})();var ai=s(8425),ti=s(8832),ei=s(3756),oi=s(9601),ii=s(3024),ni=s(9898);let li=(()=>{class i{static#a=this.\u0275fac=function(e){return new(e||i)};static#t=this.\u0275mod=a.$C({type:i});static#e=this.\u0275inj=a.G2t({imports:[h.MD,ai.h,ti.X1,Ko,ei.UteisModule,oi.AtividadeModule]})}return i})();a.wjB(pa.r,[h.bT,A._,N.T,$.I,q.i,Aa.H,Da.e,O.S,E.O,U.H,x.r,M.K,ii.g,ni.Y,P.n,va.s,X],[])}}]);