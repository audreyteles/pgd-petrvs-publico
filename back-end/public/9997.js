"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9997],{41095:(z,D,r)=>{r.d(D,{w:()=>R});var c,L=r(56976),C=r(20755);class R extends L.B{constructor(g){super("Avaliacao",g),this.injector=g,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(g){return new Promise((b,f)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:g}).subscribe(O=>{O?.error?f(O?.error):b(!0)},O=>f(O))})}recorrer(g,b){return new Promise((f,O)=>{this.server.post("api/"+this.collection+"/recorrer",{id:g.id,recurso:b}).subscribe(E=>{E?.error?O(E?.error):(g.recurso=b,f(!0))},E=>O(E))})}}(c=R).\u0275fac=function(g){return new(g||c)(C.LFG(C.zs3))},c.\u0275prov=C.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"})},89997:(z,D,r)=>{r.d(D,{H:()=>K});var s,L=r(73150),C=r(25026),c=r(87744),R=r(92214),U=r(66075),g=r(81214),b=r(35255),f=r(20762),O=r(78509),E=r(80684),v=r(22702),Z=r(49193),x=r(20609),t=r(20755);function n(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"input-switch",47),t.NdJ("change",function(l){t.CHM(e);const m=t.oxw(2);return t.KtG(m.onLotadosMinhaUnidadeChange(l))}),t.qZA()}if(2&i){const e=t.oxw(2);t.Q6J("size",4)("control",e.filter.controls.lotados_minha_unidade)}}function u(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"toolbar"),t.YNc(1,n,1,2,"input-switch",45),t.TgZ(2,"input-switch",46),t.NdJ("change",function(l){t.CHM(e);const m=t.oxw();return t.KtG(m.onAgruparChange(l))}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.temAtribuicaoChefia),t.xp6(1),t.Q6J("size",4)("control",e.filter.controls.agrupar)}}function _(i,a){if(1&i&&(t.TgZ(0,"span",52),t._UZ(1,"i",53),t._uU(2),t.qZA()),2&i){const e=t.oxw().row;t.xp6(2),t.hij(" ",null==e.entregas?null:e.entregas.length,"")}}function h(i,a){if(1&i&&t.YNc(0,_,3,1,"span",51),2&i){const e=a.row;t.Q6J("ngIf",null==e.entregas?null:e.entregas.length)}}function p(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"plano-trabalho-list-entrega",54),t.NdJ("atualizaPlanoTrabalhoEvent",function(l){t.CHM(e);const m=t.oxw(2);return t.KtG(null==((null==m.grid?null:m.grid.query)||m.query)?null:((null==m.grid?null:m.grid.query)||m.query).refreshId(l))}),t.qZA()}if(2&i){const e=a.row;t.Q6J("entity",e)("planoTrabalhoEditavel",e._metadata.editavel||!1)}}function d(i,a){if(1&i&&(t.TgZ(0,"column",48),t.YNc(1,h,1,1,"ng-template",null,49,t.W1O),t.YNc(3,p,1,2,"ng-template",null,50,t.W1O),t.qZA()),2&i){const e=t.MAs(2),o=t.MAs(4),l=t.oxw();t.Q6J("align","center")("hint",l.lex.translate("Entrega"))("template",e)("expandTemplate",o)}}function S(i,a){if(1&i&&(t.TgZ(0,"order",55),t._uU(1,"#ID"),t.qZA()),2&i){const e=a.header;t.Q6J("header",e)}}function $(i,a){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=a.row;t.xp6(1),t.hij(" ","#"+e.numero,"")}}function tt(i,a){if(1&i&&(t.TgZ(0,"order",56),t._uU(1,"Usu\xe1rio"),t.qZA(),t._UZ(2,"br"),t._uU(3,"Programa ")),2&i){const e=a.header;t.Q6J("header",e)}}function et(i,a){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA(),t._UZ(2,"br")(3,"badge",57)),2&i){const e=a.row;t.xp6(1),t.hij(" ",(null==e.usuario?null:e.usuario.nome)||"",""),t.xp6(2),t.Q6J("label",(null==e.programa?null:e.programa.nome)||"")}}function at(i,a){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=a.row;t.xp6(1),t.hij(" ",(null==e.unidade?null:e.unidade.sigla)||"","")}}function it(i,a){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=a.row;t.xp6(1),t.hij(" ",(null==e.tipo_modalidade?null:e.tipo_modalidade.nome)||"","")}}function ot(i,a){if(1&i&&(t._uU(0," Vig\xeancia de"),t._UZ(1,"br"),t.TgZ(2,"order",58),t._uU(3,"In\xedcio"),t.qZA(),t._uU(4,"a"),t.TgZ(5,"order",59),t._uU(6,"Fim"),t.qZA()),2&i){const e=a.header;t.xp6(2),t.Q6J("header",e),t.xp6(3),t.Q6J("header",e)}}function st(i,a){1&i&&t._UZ(0,"badge",62)}function nt(i,a){if(1&i&&(t.TgZ(0,"small"),t._uU(1),t.qZA(),t.TgZ(2,"div",60),t.YNc(3,st,1,0,"badge",61),t.qZA()),2&i){const e=a.row,o=t.oxw();t.xp6(1),t.AsE(" ",o.dao.getDateFormatted(e.data_inicio)," "," at\xe9 "+o.dao.getDateFormatted(e.data_fim),""),t.xp6(2),t.Q6J("ngIf",o.planoTrabalhoService.estaVigente(e))}}function lt(i,a){if(1&i&&t._UZ(0,"documentos-badge",63),2&i){const e=a.row;t.Q6J("documento",e.documento)("maxWidth",200)}}function rt(i,a){1&i&&t._UZ(0,"badge",67)}function dt(i,a){1&i&&t._UZ(0,"badge",68)}function ut(i,a){if(1&i&&(t._UZ(0,"badge",64)(1,"br"),t.YNc(2,rt,1,0,"badge",65),t.YNc(3,dt,1,0,"badge",66)),2&i){const e=a.row,o=t.oxw();t.Q6J("color",o.lookup.getColor(o.lookup.PLANO_TRABALHO_STATUS,e.status))("icon",o.lookup.getIcon(o.lookup.PLANO_TRABALHO_STATUS,e.status))("label",o.lookup.getValue(o.lookup.PLANO_TRABALHO_STATUS,e.status)),t.xp6(2),t.Q6J("ngIf",e.data_arquivamento),t.xp6(1),t.Q6J("ngIf",e.deleted_at)}}function _t(i,a){if(1&i&&t._uU(0),2&i){const e=a.row;t.Oqu(e.numero)}}function ct(i,a){if(1&i&&t._uU(0),2&i){const e=a.row;t.Oqu((null==e.usuario?null:e.usuario.matricula)||"")}}function ht(i,a){if(1&i&&t._uU(0),2&i){const e=a.row;t.Oqu((null==e.programa?null:e.programa.nome)||"")}}function mt(i,a){if(1&i&&t._uU(0),2&i){const e=a.row;t.Oqu((null==e.unidade?null:e.unidade.nome)||"")}}function pt(i,a){if(1&i&&t._uU(0),2&i){const e=a.row;t.Oqu((null==e.tipo_modalidade?null:e.tipo_modalidade.nome)||"")}}function At(i,a){if(1&i&&t._uU(0),2&i){const e=a.row,o=t.oxw();t.Oqu(o.util.getDateTimeFormatted(e.data_inicio))}}function gt(i,a){if(1&i&&t._uU(0),2&i){const e=a.row,o=t.oxw();t.Oqu(o.util.getDateTimeFormatted(e.data_fim))}}function Ot(i,a){if(1&i&&t._uU(0),2&i){const e=a.row;t.Oqu(null!=e.documento&&null!=e.documento.numero_processo&&e.documento.numero_processo.length?null==e.documento?null:e.documento.numero_processo:"N\xe3o atribu\xeddo")}}class K extends O.E{constructor(a){super(a,f.p,c.t),this.injector=a,this.temAtribuicaoChefia=!1,this.routeStatus={route:["uteis","status"]},this.multiselectAllFields=["tipo_modalidade_id","usuario_id","unidade_id","documento_id"],this.relatorios=[{key:"PTR_LISTA",value:"Lista Planos de Trabalhos"}],this.botoes=[],this.planoTrabalhoEditavel=!1,this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.filterValidate=(e,o)=>{let l=null;return"data_filtro_inicio"==o&&e.value>this.filter?.controls.data_filtro_fim.value?l="Maior que fim":"data_filtro_fim"==o&&e.value<this.filter?.controls.data_filtro_inicio.value&&(l="Menor que in\xedcio"),l},this.filterWhere=e=>{let o=[],l=e.value;return l.tipo_modalidade_id?.length&&o.push(["tipo_modalidade_id","==",l.tipo_modalidade_id]),l.data_filtro&&(o.push(["data_filtro","==",l.data_filtro]),o.push(["data_filtro_inicio","==",l.data_filtro_inicio]),o.push(["data_filtro_fim","==",l.data_filtro_fim])),l.usuario?.length&&o.push(["usuario.nome","like","%"+l.usuario.trim().replace(" ","%")+"%"]),l.unidade_id?.length&&o.push(["unidade_id","==",l.unidade_id]),l.status&&o.push(["status","==",l.status]),l.lotados_minha_unidade&&o.push(["lotados_minha_unidade","==",!0]),o.push(["incluir_arquivados","==",this.filter.controls.arquivados.value]),o},this.dynamicMultiselectMenu=e=>{let o=!!Object.keys(e).length,l=[];return Object.entries(e).forEach(([m,N])=>{this.planoTrabalhoService.needSign(N)||(o=!1)}),o&&l.push({label:"Assinar",icon:"bi bi-pen",onClick:this.assinar.bind(this)}),l},this.unidadeDao=a.get(g.J),this.programaDao=a.get(R.w),this.documentoDao=a.get(C.d),this.documentoService=a.get(v.t),this.unidadeService=a.get(x.Z),this.utilService=a.get(Z.f),this.usuarioDao=a.get(b.q),this.planoTrabalhoService=a.get(E.p),this.tipoModalidadeDao=a.get(U.D),this.title=this.lex.translate("Planos de Trabalho"),this.code="MOD_PTR",this.filter=this.fh.FormBuilder({agrupar:{default:!0},lotados_minha_unidade:{default:!1},usuario:{default:""},status:{default:""},unidade_id:{default:null},arquivados:{default:!1},tipo_modalidade_id:{default:null},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date}},this.cdRef,this.filterValidate),this.join=["unidade.entidade","unidade.gestor.usuario:id","usuario","programa.template_tcr","documento.assinaturas.usuario:id,nome,url_foto","tipo_modalidade","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega:id,unidade_id","entregas.plano_entrega_entrega.plano_entrega.unidade","entregas.entrega","entregas.reacoes.usuario:id,nome,apelido"],this.temAtribuicaoChefia=this.auth.isGestorAlgumaAreaTrabalho(!1),this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:this.edit.bind(this)},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_ASSINAR={label:"Assinar",icon:"bi bi-pen",onClick:this.assinar.bind(this)},this.BOTAO_ATIVAR={label:"Ativar",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),onClick:this.ativar.bind(this)},this.BOTAO_CANCELAR_ASSINATURA={label:"Cancelar assinatura",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA ou INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA ou INCLUIDO"),onClick:this.cancelarAssinatura.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_ENVIAR_ASSINATURA={label:"Enviar para assinatura",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA"),onClick:this.enviarParaAssinatura.bind(this)},this.BOTAO_INFORMACOES={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:this.consult.bind(this)},this.BOTAO_RELATORIO={label:"Relat\xf3rio",icon:"bi bi-file-pdf",onClick:e=>this.report(e,"PTR_LISTA_ENTREGAS")},this.BOTAO_TERMOS={label:"Termos",icon:"bi bi-file-earmark-check",onClick:(e=>this.go.navigate({route:["uteis","documentos","TCR",e.id]},{modalClose:o=>(this.grid?.query||this.query).refreshId(e.id),metadata:this.planoTrabalhoService.metadados(e)})).bind(this)},this.BOTAO_CONSOLIDACOES={label:"Consolida\xe7\xf5es",icon:this.entityService.getIcon("PlanoTrabalhoConsolidacao"),onClick:(e=>this.go.navigate({route:["gestao","plano-trabalho","consolidacao",e.usuario_id,e.id]},{modalClose:o=>(this.grid?.query||this.query).refreshId(e.id),modal:!0})).bind(this)},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_ASSINAR,this.BOTAO_ATIVAR,this.BOTAO_CANCELAR_ASSINATURA,this.BOTAO_CANCELAR_PLANO,this.BOTAO_DESARQUIVAR,this.BOTAO_ENVIAR_ASSINATURA,this.BOTAO_INFORMACOES,this.BOTAO_RELATORIO,this.BOTAO_TERMOS,this.BOTAO_CONSOLIDACOES,this.BOTAO_REATIVAR,this.BOTAO_SUSPENDER]}ngOnInit(){super.ngOnInit(),this.metadata?.minha_unidade&&this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id)}dynamicOptions(a){let e=[];return this.botoes.forEach(o=>{this.botaoAtendeCondicoes(o,a)&&e.push(o)}),e.push(this.BOTAO_RELATORIO),e}dynamicButtons(a){let e=[],o=a;switch(this.planoTrabalhoService.situacaoPlano(o)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_ASSINAR,a)?e.push(this.BOTAO_ASSINAR):this.botaoAtendeCondicoes(this.BOTAO_ATIVAR,a)?e.push(this.BOTAO_ATIVAR):this.botaoAtendeCondicoes(this.BOTAO_ENVIAR_ASSINATURA,a)&&e.push(this.BOTAO_ENVIAR_ASSINATURA);break;case"AGUARDANDO_ASSINATURA":this.botaoAtendeCondicoes(this.BOTAO_ASSINAR,a)&&e.push(this.BOTAO_ASSINAR);break;case"ATIVO":case"SUSPENSO":case"ARQUIVADO":break;case"CONCLUIDO":case"CANCELADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,a)&&e.push(this.BOTAO_ARQUIVAR)}return e.length||e.push(this.BOTAO_INFORMACOES),e}filterClear(a){a.controls.usuario.setValue(""),a.controls.unidade_id.setValue(null),a.controls.status.setValue(null),a.controls.arquivados.setValue(!1),a.controls.tipo_modalidade_id.setValue(null),a.controls.data_filtro.setValue(null),a.controls.data_filtro_inicio.setValue(new Date),a.controls.data_filtro_fim.setValue(new Date),super.filterClear(a)}onAgruparChange(a){const e=this.filter.controls.agrupar.value;(e&&!this.groupBy?.length||!e&&this.groupBy?.length)&&(this.groupBy=e?[{field:"unidade.sigla",label:"Unidade"}]:[],this.grid.reloadFilter())}onLotadosMinhaUnidadeChange(a){this.grid.reloadFilter()}botaoAtendeCondicoes(a,e){let o=e._metadata?.assinaturasExigidas,l=[...o.gestores_entidade,...o.gestores_unidade_executora,...o.gestores_unidade_lotacao,...o.participante],m=this.planoTrabalhoService.assinaturasFaltantes(e._metadata?.assinaturasExigidas,e._metadata?.jaAssinaramTCR),N=!!(m.participante.length||m.gestores_unidade_executora.length||m.gestores_unidade_lotacao.length||m.gestores_entidade.length),P=this.unidadeService.isGestorUnidade(e.unidade_id),M=this.planoTrabalhoService.usuarioAssinou(e._metadata?.jaAssinaramTCR),q=!!l?.includes(this.auth.usuario?.id),I="INCLUIDO"==this.planoTrabalhoService.situacaoPlano(e),T=this.auth.usuario?.id==e.usuario_id,B="AGUARDANDO_ASSINATURA"==this.planoTrabalhoService.situacaoPlano(e),k="ATIVO"==this.planoTrabalhoService.situacaoPlano(e),J="CONCLUIDO"==this.planoTrabalhoService.situacaoPlano(e),W="CANCELADO"==this.planoTrabalhoService.situacaoPlano(e),w="EXCLUIDO"==this.planoTrabalhoService.situacaoPlano(e),V="ARQUIVADO"==this.planoTrabalhoService.situacaoPlano(e),F="SUSPENSO"==this.planoTrabalhoService.situacaoPlano(e),y=e.entregas.length>0;if(a==this.BOTAO_INFORMACOES&&this.auth.hasPermissionTo("MOD_PTR"))return!0;if(w)return!1;{let A=!1,G=e._metadata?.atribuicoesLogadoUnidadeSuperior.gestor||e._metadata?.atribuicoesLogadoUnidadeSuperior.gestorSubstituto,Q=e._metadata?.atribuicoesLogado.gestor||e._metadata?.atribuicoesLogado.gestorSubstituto;switch(a){case this.BOTAO_ALTERAR:A=T?e._metadata?.usuarioEhParticipanteHabilitado:e._metadata?.atribuicoesParticipante.gestor?G:e._metadata?.atribuicoesParticipante.gestorSubstituto?G||e._metadata?.atribuicoesLogado.gestor:e._metadata?.atribuicoesParticipante.gestorDelegado?Q:Q||e._metadata?.atribuicoesLogado.gestorDelegado;let Y=this.auth.hasPermissionTo("MOD_PTR_EDT"),H=this.planoTrabalhoService.isValido(e),j=(I||B)&&A,X=k&&A&&this.auth.hasPermissionTo("MOD_PTR_EDT_ATV");return e._metadata={...e._metadata,editavel:Y&&H&&(j||X)},Y&&H&&(j||X);case this.BOTAO_ARQUIVAR:return(J||W)&&!V&&(T||P);case this.BOTAO_ASSINAR:return(I||B)&&y&&q&&!M;case this.BOTAO_ATIVAR:return A=e._metadata?.atribuicoesParticipante.gestor?G||e._metadata?.usuarioEhParticipanteHabilitado:e._metadata?.atribuicoesParticipante.gestorSubstituto?e._metadata?.atribuicoesLogado.gestor||T&&e._metadata?.usuarioEhParticipanteHabilitado||!T&&e._metadata?.atribuicoesLogado.gestorSubstituto:e._metadata?.atribuicoesParticipante.gestorDelegado?e._metadata?.atribuicoesLogado.gestor||e._metadata?.atribuicoesLogado.gestorSubstituto||T&&e._metadata?.usuarioEhParticipanteHabilitado:T?Q||e._metadata?.usuarioEhParticipanteHabilitado:Q,I&&A&&!o?.todas?.length&&y;case this.BOTAO_CANCELAR_ASSINATURA:return B&&M;case this.BOTAO_CANCELAR_PLANO:return!!e._metadata?.podeCancelar;case this.BOTAO_DESARQUIVAR:return V&&(T||P);case this.BOTAO_ENVIAR_ASSINATURA:return I&&(!q||M)&&N&&y&&(T||P);case this.BOTAO_REATIVAR:return F&&P;case this.BOTAO_SUSPENDER:return k&&P;case this.BOTAO_TERMOS:return this.auth.hasPermissionTo("MOD_PTR");case this.BOTAO_CONSOLIDACOES:return!0}}return!1}arquivar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:Object.assign({},a,{arquivar:!0}),novoStatus:a.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}assinar(a){const e=a?[a.id]:Object.keys(this.grid.multiselected||{}),o=this.grid.items.filter(l=>e.includes(l.id)&&l.documento_id?.length).map(l=>l.documento);o.length?this.documentoService.sign(o).then(()=>(this.grid?.query||this.query).refreshId(a.id)):this.dialog.alert("Selecione","Nenhum plano selecionado!")}ativar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"ATIVO",onClick:this.dao.ativar.bind(this.dao)},title:"Ativar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}cancelarAssinatura(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"AGUARDANDO_ASSINATURA",onClick:this.dao.cancelarAssinatura.bind(this.dao)},title:"Cancelar Assinatura do TCR",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}cancelarPlano(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:Object.assign({},a,{arquivar:!0}),exigeJustificativa:!0,novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}desarquivar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:Object.assign({},a,{arquivar:!1}),novoStatus:a.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}report(a,e){const o={id:a.id,join:["unidade.entidade","unidade.gestor.usuario:id","usuario","programa.template_tcr","tipo_modalidade","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega:id,unidade_id","entregas.plano_entrega_entrega.plano_entrega.unidade","entregas.entrega"]};this.grid?.buildRowReport(e,o)}enviarParaAssinatura(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"AGUARDANDO_ASSINATURA",onClick:this.dao.enviarParaAssinatura.bind(this.dao)},title:"Disponibilizar Plano de Trabalho para assinatura",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}reativar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}suspender(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}}(s=K).\u0275fac=function(a){return new(a||s)(t.Y36(t.zs3))},s.\u0275cmp=t.Xpm({type:s,selectors:[["plano-trabalho-list"]],viewQuery:function(a,e){if(1&a&&t.Gf(L.M,5),2&a){let o;t.iGM(o=t.CRH())&&(e.grid=o.first)}},features:[t.qOj],decls:69,vars:71,consts:[["multiselect","",3,"dao","add","title","orderBy","groupBy","join","selectable","relatorios","hasDelete","hasAdd","hasEdit","dynamicMultiselectMenu","multiselectAllFields","select"],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","usuario","placeholder","Usu\xe1rio",3,"size","label","control"],["controlName","unidade_id",3,"size","control","dao"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","items","control","valueTodos"],["label","Arq.","controlName","arquivados","labelInfo","Listar tamb\xe9m os planos de trabalho arquivados",3,"size","control"],["controlName","tipo_modalidade_id",3,"size","control","dao"],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template","minWidth"],["titleNumero",""],["columnNumero",""],[3,"titleTemplate","template"],["titleUsuario",""],["columnUsuario",""],["title","Unidade",3,"template"],["columnUnidade",""],["title","Modalidade",3,"template"],["columnModalidade",""],["titleVigencia",""],["columnInicioVigencia",""],[3,"title","template"],["documento",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicOptions","dynamicButtons"],["title","Numero",3,"template"],["reportNumero",""],["title","Matricula usu\xe1rio",3,"template"],["reportMatricula",""],["title","Programa",3,"template"],["reportPrograma",""],["reportUnidade",""],["reportModalidade",""],["title","In\xedcio vig\xeancia",3,"template"],["reportInicioVigencia",""],["title","Fim vig\xeancia",3,"template"],["reportFimVigencia",""],["title","Termo de Ades\xe3o",3,"template"],["reportTermoAdesao",""],[3,"rows"],["labelPosition","left","label","Lotados em minha Un.","controlName","lotados_minha_unidade",3,"size","control","change",4,"ngIf"],["labelPosition","left","label","Agrupar por Un.","controlName","agrupar",3,"size","control","change"],["labelPosition","left","label","Lotados em minha Un.","controlName","lotados_minha_unidade",3,"size","control","change"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["columnEntregas",""],["columnExpandedEntregas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"entity","planoTrabalhoEditavel","atualizaPlanoTrabalhoEvent"],["by","numero",3,"header"],["by","usuario.nome",3,"header"],["color","light","icon","bi bi-file-bar-graph",3,"label"],["by","data_inicio",3,"header"],["by","data_fim",3,"header"],[1,"d-block"],["color","#5362fb","icon","bi bi-calendar-check-fill","label","Vigente","hint","Vigente",4,"ngIf"],["color","#5362fb","icon","bi bi-calendar-check-fill","label","Vigente","hint","Vigente"],["signatures","","noRounded","","withLink","",3,"documento","maxWidth"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"]],template:function(a,e){if(1&a&&(t.TgZ(0,"grid",0),t.NdJ("select",function(l){return e.onSelect(l)}),t.YNc(1,u,3,3,"toolbar",1),t.TgZ(2,"filter",2)(3,"div",3),t._UZ(4,"input-text",4)(5,"input-search",5)(6,"input-select",6)(7,"input-switch",7),t.qZA(),t.TgZ(8,"div",3),t._UZ(9,"input-search",8)(10,"input-select",9)(11,"input-datetime",10)(12,"input-datetime",11),t.qZA()(),t.TgZ(13,"columns"),t.YNc(14,d,5,4,"column",12),t.TgZ(15,"column",13),t.YNc(16,S,2,1,"ng-template",null,14,t.W1O),t.YNc(18,$,2,1,"ng-template",null,15,t.W1O),t.qZA(),t.TgZ(20,"column",16),t.YNc(21,tt,4,1,"ng-template",null,17,t.W1O),t.YNc(23,et,4,2,"ng-template",null,18,t.W1O),t.qZA(),t.TgZ(25,"column",19),t.YNc(26,at,2,1,"ng-template",null,20,t.W1O),t.qZA(),t.TgZ(28,"column",21),t.YNc(29,it,2,1,"ng-template",null,22,t.W1O),t.qZA(),t.TgZ(31,"column",16),t.YNc(32,ot,7,2,"ng-template",null,23,t.W1O),t.YNc(34,nt,4,3,"ng-template",null,24,t.W1O),t.qZA(),t.TgZ(36,"column",25),t.YNc(37,lt,1,2,"ng-template",null,26,t.W1O),t.qZA(),t.TgZ(39,"column",27),t.YNc(40,ut,4,5,"ng-template",null,28,t.W1O),t.qZA(),t._UZ(42,"column",29),t.qZA(),t.TgZ(43,"report")(44,"column",30),t.YNc(45,_t,1,1,"ng-template",null,31,t.W1O),t.qZA(),t.TgZ(47,"column",32),t.YNc(48,ct,1,1,"ng-template",null,33,t.W1O),t.qZA(),t.TgZ(50,"column",34),t.YNc(51,ht,1,1,"ng-template",null,35,t.W1O),t.qZA(),t.TgZ(53,"column",19),t.YNc(54,mt,1,1,"ng-template",null,36,t.W1O),t.qZA(),t.TgZ(56,"column",21),t.YNc(57,pt,1,1,"ng-template",null,37,t.W1O),t.qZA(),t.TgZ(59,"column",38),t.YNc(60,At,1,1,"ng-template",null,39,t.W1O),t.qZA(),t.TgZ(62,"column",40),t.YNc(63,gt,1,1,"ng-template",null,41,t.W1O),t.qZA(),t.TgZ(65,"column",42),t.YNc(66,Ot,1,1,"ng-template",null,43,t.W1O),t.qZA()(),t._UZ(68,"pagination",44),t.qZA()),2&a){const o=t.MAs(17),l=t.MAs(19),m=t.MAs(22),N=t.MAs(24),P=t.MAs(27),M=t.MAs(30),q=t.MAs(33),I=t.MAs(35),T=t.MAs(38),B=t.MAs(41),k=t.MAs(46),J=t.MAs(49),W=t.MAs(52),w=t.MAs(55),V=t.MAs(58),F=t.MAs(61),y=t.MAs(64),A=t.MAs(67);t.Q6J("dao",e.dao)("add",e.add)("title",e.isModal?"":e.title)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("relatorios",e.relatorios)("hasDelete",!1)("hasAdd",e.auth.hasPermissionTo("MOD_PTR_INCL"))("hasEdit",!1)("dynamicMultiselectMenu",e.dynamicMultiselectMenu.bind(e))("multiselectAllFields",e.multiselectAllFields),t.xp6(1),t.Q6J("ngIf",!e.selectable),t.xp6(1),t.Q6J("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),t.xp6(2),t.Q6J("size",4)("label",e.lex.translate("Usu\xe1rio"))("control",e.filter.controls.usuario),t.uIk("maxlength",250),t.xp6(1),t.Q6J("size",4)("control",e.filter.controls.unidade_id)("dao",e.unidadeDao),t.xp6(1),t.Q6J("size",3)("items",e.lookup.PLANO_TRABALHO_STATUS)("control",e.filter.controls.status)("valueTodos",null),t.xp6(1),t.Q6J("size",1)("control",e.filter.controls.arquivados),t.xp6(2),t.Q6J("size",6)("control",e.filter.controls.tipo_modalidade_id)("dao",e.tipoModalidadeDao),t.xp6(1),t.Q6J("size",2)("valueTodos",null)("control",e.filter.controls.data_filtro)("items",e.DATAS_FILTRO),t.xp6(1),t.Q6J("size",2)("disabled",null==e.filter.controls.data_filtro.value?"true":void 0)("control",e.filter.controls.data_filtro_inicio),t.xp6(1),t.Q6J("size",2)("disabled",null==e.filter.controls.data_filtro.value?"true":void 0)("control",e.filter.controls.data_filtro_fim),t.xp6(2),t.Q6J("ngIf",!e.selectable),t.xp6(1),t.Q6J("titleTemplate",o)("template",l)("minWidth",50),t.xp6(5),t.Q6J("titleTemplate",m)("template",N),t.xp6(5),t.Q6J("template",P),t.xp6(3),t.Q6J("template",M),t.xp6(3),t.Q6J("titleTemplate",q)("template",I),t.xp6(5),t.Q6J("title","Termo\nAssinaturas")("template",T),t.xp6(3),t.Q6J("template",B),t.xp6(3),t.Q6J("dynamicOptions",e.dynamicOptions.bind(e))("dynamicButtons",e.dynamicButtons.bind(e)),t.xp6(2),t.Q6J("template",k),t.xp6(3),t.Q6J("template",J),t.xp6(3),t.Q6J("template",W),t.xp6(3),t.Q6J("template",w),t.xp6(3),t.Q6J("template",V),t.xp6(3),t.Q6J("template",F),t.xp6(3),t.Q6J("template",y),t.xp6(3),t.Q6J("template",A),t.xp6(3),t.Q6J("rows",e.rowsLimit)}}})},80684:(z,D,r)=>{r.d(D,{p:()=>Z});var v,L=r(8239),C=r(43972),c=r(20755),R=r(32333),U=r(49193),g=r(92307),b=r(39702),f=r(87744),O=r(41095),E=r(49367);class Z{constructor(t,s,n,u,_,h,p,d){this.auth=t,this.util=s,this.go=n,this.lookup=u,this.dao=_,this.avaliacaoDao=h,this.templateService=p,this.planoTrabalhoDao=d}template(t){return t.programa?.template_tcr}metadados(t){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(t),template:t.programa?.template_tcr,template_id:t.programa?.template_tcr_id}}needSign(t,s){const n=t,u=s||(n?.documentos||[]).find(_=>n?.documento_id?.length&&_.id==n?.documento_id)||n?.documento;if(t&&u&&!u.assinaturas?.find(_=>_.usuario_id==this.auth.usuario.id)){const _=n.tipo_modalidade,h=n.programa,p=this.auth.entidade;let d=[];return h?.plano_trabalho_assinatura_participante&&d.push(n.usuario_id),h?.plano_trabalho_assinatura_gestor_lotacao&&d.push(...this.auth.gestoresLotacao.map(S=>S.id)),h?.plano_trabalho_assinatura_gestor_unidade&&d.push(n.unidade?.gestor?.id||"",...n.unidade?.gestores_substitutos?.map(S=>S.id)||""),h?.plano_trabalho_assinatura_gestor_entidade&&d.push(p.gestor_id||"",p.gestor_substituto_id||""),!!_&&d.includes(this.auth.usuario.id)}return!1}extraTags(t,s,n){const u=t;let _=[];return u?.documento_id==s.id&&_.push({key:s.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(n.tags)!=JSON.stringify(_)&&(n.tags=_),n.tags}tipoEntrega(t,s){let n=s||t.plano_trabalho,u=t.plano_entrega_entrega?.plano_entrega?.unidade_id==n.unidade_id?"PROPRIA_UNIDADE":t.plano_entrega_entrega?"OUTRA_UNIDADE":t.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",_=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(d=>d.key==u)||{key:"",value:"Desconhecido1"},h=n?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||t.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",p=n?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||t.plano_entrega_entrega?.descricao||"";return{titulo:_.value,cor:_.color||"danger",nome:h,tipo:u,descricao:p}}atualizarTcr(t,s,n,u){if(s.usuario&&s.unidade){let _=this.dao.datasource(t),h=this.dao.datasource(s),p=s.programa;if(h.usuario.texto_complementar_plano=n||s.usuario?.texto_complementar_plano||"",h.unidade.texto_complementar_plano=u||s.unidade?.texto_complementar_plano||"",(p?.termo_obrigatorio||s.documento_id?.length)&&JSON.stringify(h)!=JSON.stringify(_)&&p?.template_tcr){let d=s.documentos?.find(S=>S.id==s.documento_id);s.documento_id?.length&&d&&!d.assinaturas?.length&&"LINK"!=d.tipo?(d.conteudo=this.templateService.renderTemplate(p?.template_tcr?.conteudo||"",h),d.dataset=this.dao.dataset(),d.datasource=h,d._status="ADD"==d._status?"ADD":"EDIT"):(d=new C.U({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(p?.template_tcr?.conteudo||"",h),status:"GERADO",_status:"ADD",template:p?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:h,entidade_id:this.auth.entidade?.id,plano_trabalho_id:s.id,template_id:p?.template_tcr_id}),s.documentos.push(d)),s.documento=d,s.documento_id=d?.id||null}}return s.documento}situacaoPlano(t){return t.deleted_at?"EXCLUIDO":t.data_arquivamento?"ARQUIVADO":t.status}isValido(t){return!t.deleted_at&&"CANCELADO"!=t.status&&!t.data_arquivamento}estaVigente(t){let s=new Date;return"ATIVO"==t.status&&t.data_inicio<=s&&t.data_fim>=s}diasParaConcluirConsolidacao(t,s){return t&&s?this.util.daystamp(t.data_fim)+s.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(t,s,n){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",t.id,"avaliar"]},{modal:!0,metadata:{consolidacao:t,programa:s},modalClose:u=>{u&&(t.status="AVALIADO",t.avaliacao_id=u.id,t.avaliacao=u,n(t))}})}fazerRecurso(t,s,n){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",t.id,"recurso"]},{modal:!0,metadata:{recurso:!0,consolidacao:t,programa:s},modalClose:u=>{u&&(t.avaliacao=u,n(t))}})}cancelarAvaliacao(t,s,n){var u=this;return(0,L.Z)(function*(){s.submitting=!0;try{(yield u.avaliacaoDao.cancelarAvaliacao(t.avaliacao.id))&&(t.status="CONCLUIDO",t.avaliacao_id=null,t.avaliacao=void 0,n(t))}catch(_){s.error(_.message||_)}finally{s.submitting=!1}})()}usuarioAssinou(t,s){return s=s||this.auth.usuario.id,Object.values(t).some(n=>(n||[]).includes(s))}assinaturasFaltantes(t,s){return{participante:t.participante.filter(n=>!s.participante.includes(n)),gestores_unidade_executora:t.gestores_unidade_executora.length?t.gestores_unidade_executora.filter(n=>s.gestores_unidade_executora.includes(n)).length?[]:t.gestores_unidade_executora:[],gestores_unidade_lotacao:t.gestores_unidade_lotacao.length?t.gestores_unidade_lotacao.filter(n=>s.gestores_unidade_lotacao.includes(n)).length?[]:t.gestores_unidade_lotacao:[],gestores_entidade:t.gestores_entidade.length?t.gestores_entidade.filter(n=>s.gestores_entidade.includes(n)).length?[]:t.gestores_entidade:[]}}}(v=Z).\u0275fac=function(t){return new(t||v)(c.LFG(R.e),c.LFG(U.f),c.LFG(g.o),c.LFG(b.W),c.LFG(f.t),c.LFG(O.w),c.LFG(E.E),c.LFG(f.t))},v.\u0275prov=c.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"})}}]);