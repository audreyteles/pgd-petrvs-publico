"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9997],{41095:(G,I,r)=>{r.d(I,{w:()=>m});var D=r(56976),C=r(20755);class m extends D.B{constructor(g){super("Avaliacao",g),this.injector=g,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(g){return new Promise((T,b)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:g}).subscribe(O=>{O?.error?b(O?.error):T(!0)},O=>b(O))})}recorrer(g,T){return new Promise((b,O)=>{this.server.post("api/"+this.collection+"/recorrer",{id:g.id,recurso:T}).subscribe(E=>{E?.error?O(E?.error):(g.recurso=T,b(!0))},E=>O(E))})}static#t=this.\u0275fac=function(T){return new(T||m)(C.LFG(C.zs3))};static#e=this.\u0275prov=C.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"})}},89997:(G,I,r)=>{r.d(I,{H:()=>y});var D=r(73150),C=r(25026),m=r(87744),Q=r(92214),g=r(66075),T=r(81214),b=r(35255),O=r(20762),E=r(78509),x=r(80684),v=r(22702),j=r(49193),s=r(20609),t=r(20755);function l(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"input-switch",47),t.NdJ("change",function(n){t.CHM(e);const c=t.oxw(2);return t.KtG(c.onLotadosMinhaUnidadeChange(n))}),t.qZA()}if(2&o){const e=t.oxw(2);t.Q6J("size",4)("control",e.filter.controls.lotados_minha_unidade)}}function u(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"toolbar"),t.YNc(1,l,1,2,"input-switch",45),t.TgZ(2,"input-switch",46),t.NdJ("change",function(n){t.CHM(e);const c=t.oxw();return t.KtG(c.onAgruparChange(n))}),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.temAtribuicaoChefia),t.xp6(1),t.Q6J("size",4)("control",e.filter.controls.agrupar)}}function _(o,a){if(1&o&&(t.TgZ(0,"span",52),t._UZ(1,"i",53),t._uU(2),t.qZA()),2&o){const e=t.oxw().row;t.xp6(2),t.hij(" ",null==e.entregas?null:e.entregas.length,"")}}function h(o,a){if(1&o&&t.YNc(0,_,3,1,"span",51),2&o){const e=a.row;t.Q6J("ngIf",null==e.entregas?null:e.entregas.length)}}function p(o,a){if(1&o){const e=t.EpF();t.TgZ(0,"plano-trabalho-list-entrega",54),t.NdJ("atualizaPlanoTrabalhoEvent",function(n){t.CHM(e);const c=t.oxw(2);return t.KtG(null==((null==c.grid?null:c.grid.query)||c.query)?null:((null==c.grid?null:c.grid.query)||c.query).refreshId(n))}),t.qZA()}if(2&o){const e=a.row;t.Q6J("entity",e)("planoTrabalhoEditavel",e._metadata.editavel||!1)}}function d(o,a){if(1&o&&(t.TgZ(0,"column",48),t.YNc(1,h,1,1,"ng-template",null,49,t.W1O),t.YNc(3,p,1,2,"ng-template",null,50,t.W1O),t.qZA()),2&o){const e=t.MAs(2),i=t.MAs(4),n=t.oxw();t.Q6J("align","center")("hint",n.lex.translate("Entrega"))("template",e)("expandTemplate",i)}}function S(o,a){if(1&o&&(t.TgZ(0,"order",55),t._uU(1,"#ID"),t.qZA()),2&o){const e=a.header;t.Q6J("header",e)}}function X(o,a){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=a.row;t.xp6(1),t.hij(" ","#"+e.numero,"")}}function $(o,a){if(1&o&&(t.TgZ(0,"order",56),t._uU(1,"Usu\xe1rio"),t.qZA(),t._UZ(2,"br"),t._uU(3,"Programa ")),2&o){const e=a.header;t.Q6J("header",e)}}function tt(o,a){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA(),t._UZ(2,"br")(3,"badge",57)),2&o){const e=a.row;t.xp6(1),t.hij(" ",(null==e.usuario?null:e.usuario.nome)||"",""),t.xp6(2),t.Q6J("label",(null==e.programa?null:e.programa.nome)||"")}}function et(o,a){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=a.row;t.xp6(1),t.hij(" ",(null==e.unidade?null:e.unidade.sigla)||"","")}}function at(o,a){if(1&o&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&o){const e=a.row;t.xp6(1),t.hij(" ",(null==e.tipo_modalidade?null:e.tipo_modalidade.nome)||"","")}}function it(o,a){if(1&o&&(t._uU(0," Vig\xeancia de"),t._UZ(1,"br"),t.TgZ(2,"order",58),t._uU(3,"In\xedcio"),t.qZA(),t._uU(4,"a"),t.TgZ(5,"order",59),t._uU(6,"Fim"),t.qZA()),2&o){const e=a.header;t.xp6(2),t.Q6J("header",e),t.xp6(3),t.Q6J("header",e)}}function ot(o,a){1&o&&t._UZ(0,"badge",62)}function st(o,a){if(1&o&&(t.TgZ(0,"small"),t._uU(1),t.qZA(),t.TgZ(2,"div",60),t.YNc(3,ot,1,0,"badge",61),t.qZA()),2&o){const e=a.row,i=t.oxw();t.xp6(1),t.AsE(" ",i.dao.getDateFormatted(e.data_inicio)," "," at\xe9 "+i.dao.getDateFormatted(e.data_fim),""),t.xp6(2),t.Q6J("ngIf",i.planoTrabalhoService.estaVigente(e))}}function nt(o,a){if(1&o&&t._UZ(0,"documentos-badge",63),2&o){const e=a.row;t.Q6J("documento",e.documento)("maxWidth",200)}}function lt(o,a){1&o&&t._UZ(0,"badge",67)}function rt(o,a){1&o&&t._UZ(0,"badge",68)}function dt(o,a){if(1&o&&(t._UZ(0,"badge",64)(1,"br"),t.YNc(2,lt,1,0,"badge",65),t.YNc(3,rt,1,0,"badge",66)),2&o){const e=a.row,i=t.oxw();t.Q6J("color",i.lookup.getColor(i.lookup.PLANO_TRABALHO_STATUS,e.status))("icon",i.lookup.getIcon(i.lookup.PLANO_TRABALHO_STATUS,e.status))("label",i.lookup.getValue(i.lookup.PLANO_TRABALHO_STATUS,e.status)),t.xp6(2),t.Q6J("ngIf",e.data_arquivamento),t.xp6(1),t.Q6J("ngIf",e.deleted_at)}}function ut(o,a){if(1&o&&t._uU(0),2&o){const e=a.row;t.Oqu(e.numero)}}function _t(o,a){if(1&o&&t._uU(0),2&o){const e=a.row;t.Oqu((null==e.usuario?null:e.usuario.matricula)||"")}}function ct(o,a){if(1&o&&t._uU(0),2&o){const e=a.row;t.Oqu((null==e.programa?null:e.programa.nome)||"")}}function ht(o,a){if(1&o&&t._uU(0),2&o){const e=a.row;t.Oqu((null==e.unidade?null:e.unidade.nome)||"")}}function mt(o,a){if(1&o&&t._uU(0),2&o){const e=a.row;t.Oqu((null==e.tipo_modalidade?null:e.tipo_modalidade.nome)||"")}}function pt(o,a){if(1&o&&t._uU(0),2&o){const e=a.row,i=t.oxw();t.Oqu(i.util.getDateTimeFormatted(e.data_inicio))}}function At(o,a){if(1&o&&t._uU(0),2&o){const e=a.row,i=t.oxw();t.Oqu(i.util.getDateTimeFormatted(e.data_fim))}}function gt(o,a){if(1&o&&t._uU(0),2&o){const e=a.row;t.Oqu(null!=e.documento&&null!=e.documento.numero_processo&&e.documento.numero_processo.length?null==e.documento?null:e.documento.numero_processo:"N\xe3o atribu\xeddo")}}class y extends E.E{constructor(a){super(a,O.p,m.t),this.injector=a,this.temAtribuicaoChefia=!1,this.routeStatus={route:["uteis","status"]},this.multiselectAllFields=["tipo_modalidade_id","usuario_id","unidade_id","documento_id"],this.relatorios=[{key:"PTR_LISTA",value:"Lista Planos de Trabalhos"}],this.botoes=[],this.planoTrabalhoEditavel=!1,this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.filterValidate=(e,i)=>{let n=null;return"data_filtro_inicio"==i&&e.value>this.filter?.controls.data_filtro_fim.value?n="Maior que fim":"data_filtro_fim"==i&&e.value<this.filter?.controls.data_filtro_inicio.value&&(n="Menor que in\xedcio"),n},this.filterWhere=e=>{let i=[],n=e.value;return n.tipo_modalidade_id?.length&&i.push(["tipo_modalidade_id","==",n.tipo_modalidade_id]),n.data_filtro&&(i.push(["data_filtro","==",n.data_filtro]),i.push(["data_filtro_inicio","==",n.data_filtro_inicio]),i.push(["data_filtro_fim","==",n.data_filtro_fim])),n.usuario?.length&&i.push(["usuario.nome","like","%"+n.usuario.trim().replace(" ","%")+"%"]),n.unidade_id?.length&&i.push(["unidade_id","==",n.unidade_id]),n.status&&i.push(["status","==",n.status]),n.lotados_minha_unidade&&i.push(["lotados_minha_unidade","==",!0]),i.push(["incluir_arquivados","==",this.filter.controls.arquivados.value]),i},this.dynamicMultiselectMenu=e=>{let i=!!Object.keys(e).length,n=[];return Object.entries(e).forEach(([c,L])=>{this.planoTrabalhoService.needSign(L)||(i=!1)}),i&&n.push({label:"Assinar",icon:"bi bi-pen",onClick:this.assinar.bind(this)}),n},this.unidadeDao=a.get(T.J),this.programaDao=a.get(Q.w),this.documentoDao=a.get(C.d),this.documentoService=a.get(v.t),this.unidadeService=a.get(s.Z),this.utilService=a.get(j.f),this.usuarioDao=a.get(b.q),this.planoTrabalhoService=a.get(x.p),this.tipoModalidadeDao=a.get(g.D),this.title=this.lex.translate("Planos de Trabalho"),this.code="MOD_PTR",this.filter=this.fh.FormBuilder({agrupar:{default:!0},lotados_minha_unidade:{default:!1},usuario:{default:""},status:{default:""},unidade_id:{default:null},arquivados:{default:!1},tipo_modalidade_id:{default:null},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date}},this.cdRef,this.filterValidate),this.join=["unidade.entidade","unidade.gestor.usuario:id","usuario","programa.template_tcr","documento.assinaturas.usuario:id,nome,url_foto","tipo_modalidade","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega:id,unidade_id","entregas.plano_entrega_entrega.plano_entrega.unidade","entregas.entrega","entregas.reacoes.usuario:id,nome,apelido"],this.temAtribuicaoChefia=this.auth.isGestorAlgumaAreaTrabalho(!1),this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:this.edit.bind(this)},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_ASSINAR={label:"Assinar",icon:"bi bi-pen",onClick:this.assinar.bind(this)},this.BOTAO_ATIVAR={label:"Ativar",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),onClick:this.ativar.bind(this)},this.BOTAO_CANCELAR_ASSINATURA={label:"Cancelar assinatura",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA ou INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA ou INCLUIDO"),onClick:this.cancelarAssinatura.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_ENVIAR_ASSINATURA={label:"Enviar para assinatura",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"AGUARDANDO_ASSINATURA"),onClick:this.enviarParaAssinatura.bind(this)},this.BOTAO_INFORMACOES={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:this.consult.bind(this)},this.BOTAO_RELATORIO={label:"Relat\xf3rio",icon:"bi bi-file-pdf",onClick:e=>this.report(e,"PTR_LISTA_ENTREGAS")},this.BOTAO_TERMOS={label:"Termos",icon:"bi bi-file-earmark-check",onClick:(e=>this.go.navigate({route:["uteis","documentos","TCR",e.id]},{modalClose:i=>(this.grid?.query||this.query).refreshId(e.id),metadata:this.planoTrabalhoService.metadados(e)})).bind(this)},this.BOTAO_CONSOLIDACOES={label:"Consolida\xe7\xf5es",icon:this.entityService.getIcon("PlanoTrabalhoConsolidacao"),onClick:(e=>this.go.navigate({route:["gestao","plano-trabalho","consolidacao",e.usuario_id,e.id]},{modalClose:i=>(this.grid?.query||this.query).refreshId(e.id),modal:!0})).bind(this)},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",icon:this.lookup.getIcon(this.lookup.PLANO_TRABALHO_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_TRABALHO_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_ASSINAR,this.BOTAO_ATIVAR,this.BOTAO_CANCELAR_ASSINATURA,this.BOTAO_CANCELAR_PLANO,this.BOTAO_DESARQUIVAR,this.BOTAO_ENVIAR_ASSINATURA,this.BOTAO_INFORMACOES,this.BOTAO_RELATORIO,this.BOTAO_TERMOS,this.BOTAO_CONSOLIDACOES,this.BOTAO_REATIVAR,this.BOTAO_SUSPENDER]}ngOnInit(){super.ngOnInit(),this.metadata?.minha_unidade&&this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.route.queryParams.subscribe(a=>{"EXECUCAO"==a.context&&this.filter&&this.filter?.controls.usuario.setValue(this.auth.usuario?.nome),"GESTAO"==a.context&&this.filter&&this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id)})}dynamicOptions(a){let e=[];return this.botoes.forEach(i=>{this.botaoAtendeCondicoes(i,a)&&e.push(i)}),e.push(this.BOTAO_RELATORIO),e}dynamicButtons(a){let e=[],i=a;switch(this.planoTrabalhoService.situacaoPlano(i)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_ASSINAR,a)?e.push(this.BOTAO_ASSINAR):this.botaoAtendeCondicoes(this.BOTAO_ATIVAR,a)?e.push(this.BOTAO_ATIVAR):this.botaoAtendeCondicoes(this.BOTAO_ENVIAR_ASSINATURA,a)&&e.push(this.BOTAO_ENVIAR_ASSINATURA);break;case"AGUARDANDO_ASSINATURA":this.botaoAtendeCondicoes(this.BOTAO_ASSINAR,a)&&e.push(this.BOTAO_ASSINAR);break;case"ATIVO":case"SUSPENSO":case"ARQUIVADO":break;case"CONCLUIDO":case"CANCELADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,a)&&e.push(this.BOTAO_ARQUIVAR)}return e.length||e.push(this.BOTAO_INFORMACOES),e}filterClear(a){a.controls.usuario.setValue(""),a.controls.unidade_id.setValue(null),a.controls.status.setValue(null),a.controls.arquivados.setValue(!1),a.controls.tipo_modalidade_id.setValue(null),a.controls.data_filtro.setValue(null),a.controls.data_filtro_inicio.setValue(new Date),a.controls.data_filtro_fim.setValue(new Date),super.filterClear(a)}onAgruparChange(a){const e=this.filter.controls.agrupar.value;(e&&!this.groupBy?.length||!e&&this.groupBy?.length)&&(this.groupBy=e?[{field:"unidade.sigla",label:"Unidade"}]:[],this.grid.reloadFilter())}onLotadosMinhaUnidadeChange(a){this.grid.reloadFilter()}botaoAtendeCondicoes(a,e){let i=e._metadata?.assinaturasExigidas,n=[...i.gestores_entidade,...i.gestores_unidade_executora,...i.gestores_unidade_lotacao,...i.participante],c=this.planoTrabalhoService.assinaturasFaltantes(e._metadata?.assinaturasExigidas,e._metadata?.jaAssinaramTCR),L=!!(c.participante.length||c.gestores_unidade_executora.length||c.gestores_unidade_lotacao.length||c.gestores_entidade.length),P=this.unidadeService.isGestorUnidade(e.unidade_id),U=this.planoTrabalhoService.usuarioAssinou(e._metadata?.jaAssinaramTCR),Z=!!n?.includes(this.auth.usuario?.id),R="INCLUIDO"==this.planoTrabalhoService.situacaoPlano(e),f=this.auth.usuario?.id==e.usuario_id,N="AGUARDANDO_ASSINATURA"==this.planoTrabalhoService.situacaoPlano(e),q="ATIVO"==this.planoTrabalhoService.situacaoPlano(e),J="CONCLUIDO"==this.planoTrabalhoService.situacaoPlano(e),W="CANCELADO"==this.planoTrabalhoService.situacaoPlano(e),w="EXCLUIDO"==this.planoTrabalhoService.situacaoPlano(e),k="ARQUIVADO"==this.planoTrabalhoService.situacaoPlano(e),F="SUSPENSO"==this.planoTrabalhoService.situacaoPlano(e),M=e.entregas.length>0;if(a==this.BOTAO_INFORMACOES&&this.auth.hasPermissionTo("MOD_PTR"))return!0;if(w)return!1;{let A=!1,B=e._metadata?.atribuicoesLogadoUnidadeSuperior.gestor||e._metadata?.atribuicoesLogadoUnidadeSuperior.gestorSubstituto,V=e._metadata?.atribuicoesLogado.gestor||e._metadata?.atribuicoesLogado.gestorSubstituto;switch(a){case this.BOTAO_ALTERAR:A=f?e._metadata?.usuarioEhParticipanteHabilitado:e._metadata?.atribuicoesParticipante.gestor?B:e._metadata?.atribuicoesParticipante.gestorSubstituto?B||e._metadata?.atribuicoesLogado.gestor:e._metadata?.atribuicoesParticipante.gestorDelegado?V:V||e._metadata?.atribuicoesLogado.gestorDelegado;let z=this.auth.hasPermissionTo("MOD_PTR_EDT"),K=this.planoTrabalhoService.isValido(e),Y=(R||N)&&A,H=q&&A&&this.auth.hasPermissionTo("MOD_PTR_EDT_ATV");return e._metadata={...e._metadata,editavel:z&&K&&(Y||H)},z&&K&&(Y||H);case this.BOTAO_ARQUIVAR:return(J||W)&&!k&&(f||P);case this.BOTAO_ASSINAR:return(R||N)&&M&&Z&&!U;case this.BOTAO_ATIVAR:return A=e._metadata?.atribuicoesParticipante.gestor?B||e._metadata?.usuarioEhParticipanteHabilitado:e._metadata?.atribuicoesParticipante.gestorSubstituto?e._metadata?.atribuicoesLogado.gestor||f&&e._metadata?.usuarioEhParticipanteHabilitado||!f&&e._metadata?.atribuicoesLogado.gestorSubstituto:e._metadata?.atribuicoesParticipante.gestorDelegado?e._metadata?.atribuicoesLogado.gestor||e._metadata?.atribuicoesLogado.gestorSubstituto||f&&e._metadata?.usuarioEhParticipanteHabilitado:f?V||e._metadata?.usuarioEhParticipanteHabilitado:V,R&&A&&!i?.todas?.length&&M;case this.BOTAO_CANCELAR_ASSINATURA:return N&&U;case this.BOTAO_CANCELAR_PLANO:return!!e._metadata?.podeCancelar;case this.BOTAO_DESARQUIVAR:return k&&(f||P);case this.BOTAO_ENVIAR_ASSINATURA:return R&&(!Z||U)&&L&&M&&(f||P);case this.BOTAO_REATIVAR:return F&&P;case this.BOTAO_SUSPENDER:return q&&P;case this.BOTAO_TERMOS:return this.auth.hasPermissionTo("MOD_PTR");case this.BOTAO_CONSOLIDACOES:return!0}}return!1}arquivar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:Object.assign({},a,{arquivar:!0}),novoStatus:a.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}assinar(a){const e=a?[a.id]:Object.keys(this.grid.multiselected||{}),i=this.grid.items.filter(n=>e.includes(n.id)&&n.documento_id?.length).map(n=>n.documento);i.length?this.documentoService.sign(i).then(()=>(this.grid?.query||this.query).refreshId(a.id)):this.dialog.alert("Selecione","Nenhum plano selecionado!")}ativar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"ATIVO",onClick:this.dao.ativar.bind(this.dao)},title:"Ativar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}cancelarAssinatura(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"AGUARDANDO_ASSINATURA",onClick:this.dao.cancelarAssinatura.bind(this.dao)},title:"Cancelar Assinatura do TCR",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}cancelarPlano(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:Object.assign({},a,{arquivar:!0}),exigeJustificativa:!0,novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}desarquivar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:Object.assign({},a,{arquivar:!1}),novoStatus:a.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}report(a,e){const i={id:a.id,join:["unidade.entidade","unidade.gestor.usuario:id","usuario","programa.template_tcr","tipo_modalidade","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega:id,unidade_id","entregas.plano_entrega_entrega.plano_entrega.unidade","entregas.entrega"]};this.grid?.buildRowReport(e,i)}enviarParaAssinatura(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"AGUARDANDO_ASSINATURA",onClick:this.dao.enviarParaAssinatura.bind(this.dao)},title:"Disponibilizar Plano de Trabalho para assinatura",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}reativar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}suspender(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoTrabalho",entity:a,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Trabalho",modalClose:e=>{e&&(this.grid?.query||this.query).refreshId(a.id)}})}static#t=this.\u0275fac=function(e){return new(e||y)(t.Y36(t.zs3))};static#e=this.\u0275cmp=t.Xpm({type:y,selectors:[["plano-trabalho-list"]],viewQuery:function(e,i){if(1&e&&t.Gf(D.M,5),2&e){let n;t.iGM(n=t.CRH())&&(i.grid=n.first)}},features:[t.qOj],decls:69,vars:71,consts:[["multiselect","",3,"dao","add","title","orderBy","groupBy","join","selectable","relatorios","hasDelete","hasAdd","hasEdit","dynamicMultiselectMenu","multiselectAllFields","select"],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","usuario","placeholder","Usu\xe1rio",3,"size","label","control"],["controlName","unidade_id",3,"size","control","dao"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","items","control","valueTodos"],["label","Arquivados","controlName","arquivados","labelInfo","Listar tamb\xe9m os planos de trabalho arquivados",3,"size","control"],["controlName","tipo_modalidade_id",3,"size","control","dao"],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template","minWidth"],["titleNumero",""],["columnNumero",""],[3,"titleTemplate","template"],["titleUsuario",""],["columnUsuario",""],["title","Unidade",3,"template"],["columnUnidade",""],["title","Modalidade",3,"template"],["columnModalidade",""],["titleVigencia",""],["columnInicioVigencia",""],[3,"title","template"],["documento",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicOptions","dynamicButtons"],["title","Numero",3,"template"],["reportNumero",""],["title","Matricula usu\xe1rio",3,"template"],["reportMatricula",""],["title","Programa",3,"template"],["reportPrograma",""],["reportUnidade",""],["reportModalidade",""],["title","In\xedcio vig\xeancia",3,"template"],["reportInicioVigencia",""],["title","Fim vig\xeancia",3,"template"],["reportFimVigencia",""],["title","Termo de Ades\xe3o",3,"template"],["reportTermoAdesao",""],[3,"rows"],["labelPosition","left","label","Lotados em minha unidade","controlName","lotados_minha_unidade",3,"size","control","change",4,"ngIf"],["labelPosition","left","label","Agrupar por unidade","controlName","agrupar",3,"size","control","change"],["labelPosition","left","label","Lotados em minha unidade","controlName","lotados_minha_unidade",3,"size","control","change"],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["columnEntregas",""],["columnExpandedEntregas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"entity","planoTrabalhoEditavel","atualizaPlanoTrabalhoEvent"],["by","numero",3,"header"],["by","usuario.nome",3,"header"],["color","light","icon","bi bi-file-bar-graph",3,"label"],["by","data_inicio",3,"header"],["by","data_fim",3,"header"],[1,"d-block"],["color","#5362fb","icon","bi bi-calendar-check-fill","label","Vigente","hint","Vigente",4,"ngIf"],["color","#5362fb","icon","bi bi-calendar-check-fill","label","Vigente","hint","Vigente"],["signatures","","noRounded","","withLink","",3,"documento","maxWidth"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"]],template:function(e,i){if(1&e&&(t.TgZ(0,"grid",0),t.NdJ("select",function(c){return i.onSelect(c)}),t.YNc(1,u,3,3,"toolbar",1),t.TgZ(2,"filter",2)(3,"div",3),t._UZ(4,"input-text",4)(5,"input-search",5)(6,"input-select",6)(7,"input-switch",7),t.qZA(),t.TgZ(8,"div",3),t._UZ(9,"input-search",8)(10,"input-select",9)(11,"input-datetime",10)(12,"input-datetime",11),t.qZA()(),t.TgZ(13,"columns"),t.YNc(14,d,5,4,"column",12),t.TgZ(15,"column",13),t.YNc(16,S,2,1,"ng-template",null,14,t.W1O),t.YNc(18,X,2,1,"ng-template",null,15,t.W1O),t.qZA(),t.TgZ(20,"column",16),t.YNc(21,$,4,1,"ng-template",null,17,t.W1O),t.YNc(23,tt,4,2,"ng-template",null,18,t.W1O),t.qZA(),t.TgZ(25,"column",19),t.YNc(26,et,2,1,"ng-template",null,20,t.W1O),t.qZA(),t.TgZ(28,"column",21),t.YNc(29,at,2,1,"ng-template",null,22,t.W1O),t.qZA(),t.TgZ(31,"column",16),t.YNc(32,it,7,2,"ng-template",null,23,t.W1O),t.YNc(34,st,4,3,"ng-template",null,24,t.W1O),t.qZA(),t.TgZ(36,"column",25),t.YNc(37,nt,1,2,"ng-template",null,26,t.W1O),t.qZA(),t.TgZ(39,"column",27),t.YNc(40,dt,4,5,"ng-template",null,28,t.W1O),t.qZA(),t._UZ(42,"column",29),t.qZA(),t.TgZ(43,"report")(44,"column",30),t.YNc(45,ut,1,1,"ng-template",null,31,t.W1O),t.qZA(),t.TgZ(47,"column",32),t.YNc(48,_t,1,1,"ng-template",null,33,t.W1O),t.qZA(),t.TgZ(50,"column",34),t.YNc(51,ct,1,1,"ng-template",null,35,t.W1O),t.qZA(),t.TgZ(53,"column",19),t.YNc(54,ht,1,1,"ng-template",null,36,t.W1O),t.qZA(),t.TgZ(56,"column",21),t.YNc(57,mt,1,1,"ng-template",null,37,t.W1O),t.qZA(),t.TgZ(59,"column",38),t.YNc(60,pt,1,1,"ng-template",null,39,t.W1O),t.qZA(),t.TgZ(62,"column",40),t.YNc(63,At,1,1,"ng-template",null,41,t.W1O),t.qZA(),t.TgZ(65,"column",42),t.YNc(66,gt,1,1,"ng-template",null,43,t.W1O),t.qZA()(),t._UZ(68,"pagination",44),t.qZA()),2&e){const n=t.MAs(17),c=t.MAs(19),L=t.MAs(22),P=t.MAs(24),U=t.MAs(27),Z=t.MAs(30),R=t.MAs(33),f=t.MAs(35),N=t.MAs(38),q=t.MAs(41),J=t.MAs(46),W=t.MAs(49),w=t.MAs(52),k=t.MAs(55),F=t.MAs(58),M=t.MAs(61),A=t.MAs(64),B=t.MAs(67);t.Q6J("dao",i.dao)("add",i.add)("title",i.isModal?"":i.title)("orderBy",i.orderBy)("groupBy",i.groupBy)("join",i.join)("selectable",i.selectable)("relatorios",i.relatorios)("hasDelete",!1)("hasAdd",i.auth.hasPermissionTo("MOD_PTR_INCL"))("hasEdit",!1)("dynamicMultiselectMenu",i.dynamicMultiselectMenu.bind(i))("multiselectAllFields",i.multiselectAllFields),t.xp6(1),t.Q6J("ngIf",!i.selectable),t.xp6(1),t.Q6J("deleted",i.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",i.filter)("where",i.filterWhere)("submit",i.filterSubmit.bind(i))("clear",i.filterClear.bind(i))("collapseChange",i.filterCollapseChange.bind(i))("collapsed",!i.selectable&&i.filterCollapsed),t.xp6(2),t.Q6J("size",4)("label",i.lex.translate("Usu\xe1rio"))("control",i.filter.controls.usuario),t.uIk("maxlength",250),t.xp6(1),t.Q6J("size",4)("control",i.filter.controls.unidade_id)("dao",i.unidadeDao),t.xp6(1),t.Q6J("size",2)("items",i.lookup.PLANO_TRABALHO_STATUS)("control",i.filter.controls.status)("valueTodos",null),t.xp6(1),t.Q6J("size",2)("control",i.filter.controls.arquivados),t.xp6(2),t.Q6J("size",6)("control",i.filter.controls.tipo_modalidade_id)("dao",i.tipoModalidadeDao),t.xp6(1),t.Q6J("size",2)("valueTodos",null)("control",i.filter.controls.data_filtro)("items",i.DATAS_FILTRO),t.xp6(1),t.Q6J("size",2)("disabled",null==i.filter.controls.data_filtro.value?"true":void 0)("control",i.filter.controls.data_filtro_inicio),t.xp6(1),t.Q6J("size",2)("disabled",null==i.filter.controls.data_filtro.value?"true":void 0)("control",i.filter.controls.data_filtro_fim),t.xp6(2),t.Q6J("ngIf",!i.selectable),t.xp6(1),t.Q6J("titleTemplate",n)("template",c)("minWidth",50),t.xp6(5),t.Q6J("titleTemplate",L)("template",P),t.xp6(5),t.Q6J("template",U),t.xp6(3),t.Q6J("template",Z),t.xp6(3),t.Q6J("titleTemplate",R)("template",f),t.xp6(5),t.Q6J("title","Termo\nAssinaturas")("template",N),t.xp6(3),t.Q6J("template",q),t.xp6(3),t.Q6J("dynamicOptions",i.dynamicOptions.bind(i))("dynamicButtons",i.dynamicButtons.bind(i)),t.xp6(2),t.Q6J("template",J),t.xp6(3),t.Q6J("template",W),t.xp6(3),t.Q6J("template",w),t.xp6(3),t.Q6J("template",k),t.xp6(3),t.Q6J("template",F),t.xp6(3),t.Q6J("template",M),t.xp6(3),t.Q6J("template",A),t.xp6(3),t.Q6J("template",B),t.xp6(3),t.Q6J("rows",i.rowsLimit)}}})}},80684:(G,I,r)=>{r.d(I,{p:()=>v});var D=r(8239),C=r(43972),m=r(20755),Q=r(32333),g=r(49193),T=r(92307),b=r(39702),O=r(87744),E=r(41095),x=r(49367);class v{constructor(s,t,l,u,_,h,p,d){this.auth=s,this.util=t,this.go=l,this.lookup=u,this.dao=_,this.avaliacaoDao=h,this.templateService=p,this.planoTrabalhoDao=d}template(s){return s.programa?.template_tcr}metadados(s){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(s),template:s.programa?.template_tcr,template_id:s.programa?.template_tcr_id}}needSign(s,t){const l=s,u=t||(l?.documentos||[]).find(_=>l?.documento_id?.length&&_.id==l?.documento_id)||l?.documento;if(s&&u&&!u.assinaturas?.find(_=>_.usuario_id==this.auth.usuario.id)){const _=l.tipo_modalidade,h=l.programa,p=this.auth.entidade;let d=[];return h?.plano_trabalho_assinatura_participante&&d.push(l.usuario_id),h?.plano_trabalho_assinatura_gestor_lotacao&&d.push(...this.auth.gestoresLotacao.map(S=>S.id)),h?.plano_trabalho_assinatura_gestor_unidade&&d.push(l.unidade?.gestor?.id||"",...l.unidade?.gestores_substitutos?.map(S=>S.id)||""),h?.plano_trabalho_assinatura_gestor_entidade&&d.push(p.gestor_id||"",p.gestor_substituto_id||""),!!_&&d.includes(this.auth.usuario.id)}return!1}extraTags(s,t,l){const u=s;let _=[];return u?.documento_id==t.id&&_.push({key:t.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(l.tags)!=JSON.stringify(_)&&(l.tags=_),l.tags}tipoEntrega(s,t){let l=t||s.plano_trabalho,u=s.plano_entrega_entrega?.plano_entrega?.unidade_id==l.unidade_id?"PROPRIA_UNIDADE":s.plano_entrega_entrega?"OUTRA_UNIDADE":s.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",_=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(d=>d.key==u)||{key:"",value:"Desconhecido1"},h=l?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||s.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",p=l?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||s.plano_entrega_entrega?.descricao||"";return{titulo:_.value,cor:_.color||"danger",nome:h,tipo:u,descricao:p}}atualizarTcr(s,t,l,u){if(t.usuario&&t.unidade){let _=this.dao.datasource(s),h=this.dao.datasource(t),p=t.programa;if(h.usuario.texto_complementar_plano=l||t.usuario?.texto_complementar_plano||"",h.unidade.texto_complementar_plano=u||t.unidade?.texto_complementar_plano||"",(p?.termo_obrigatorio||t.documento_id?.length)&&JSON.stringify(h)!=JSON.stringify(_)&&p?.template_tcr){let d=t.documentos?.find(S=>S.id==t.documento_id);t.documento_id?.length&&d&&!d.assinaturas?.length&&"LINK"!=d.tipo?(d.conteudo=this.templateService.renderTemplate(p?.template_tcr?.conteudo||"",h),d.dataset=this.dao.dataset(),d.datasource=h,d._status="ADD"==d._status?"ADD":"EDIT"):(d=new C.U({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(p?.template_tcr?.conteudo||"",h),status:"GERADO",_status:"ADD",template:p?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:h,entidade_id:this.auth.entidade?.id,plano_trabalho_id:t.id,template_id:p?.template_tcr_id}),t.documentos.push(d)),t.documento=d,t.documento_id=d?.id||null}}return t.documento}situacaoPlano(s){return s.deleted_at?"EXCLUIDO":s.data_arquivamento?"ARQUIVADO":s.status}isValido(s){return!s.deleted_at&&"CANCELADO"!=s.status&&!s.data_arquivamento}estaVigente(s){let t=new Date;return"ATIVO"==s.status&&s.data_inicio<=t&&s.data_fim>=t}diasParaConcluirConsolidacao(s,t){return s&&t?this.util.daystamp(s.data_fim)+t.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(s,t,l){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",s.id,"avaliar"]},{modal:!0,metadata:{consolidacao:s,programa:t},modalClose:u=>{u&&(s.status="AVALIADO",s.avaliacao_id=u.id,s.avaliacao=u,l(s))}})}fazerRecurso(s,t,l){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",s.id,"recurso"]},{modal:!0,metadata:{recurso:!0,consolidacao:s,programa:t},modalClose:u=>{u&&(s.avaliacao=u,l(s))}})}cancelarAvaliacao(s,t,l){var u=this;return(0,D.Z)(function*(){t.submitting=!0;try{(yield u.avaliacaoDao.cancelarAvaliacao(s.avaliacao.id))&&(s.status="CONCLUIDO",s.avaliacao_id=null,s.avaliacao=void 0,l(s))}catch(_){t.error(_.message||_)}finally{t.submitting=!1}})()}usuarioAssinou(s,t){return t=t||this.auth.usuario.id,Object.values(s).some(l=>(l||[]).includes(t))}assinaturasFaltantes(s,t){return{participante:s.participante.filter(l=>!t.participante.includes(l)),gestores_unidade_executora:s.gestores_unidade_executora.length?s.gestores_unidade_executora.filter(l=>t.gestores_unidade_executora.includes(l)).length?[]:s.gestores_unidade_executora:[],gestores_unidade_lotacao:s.gestores_unidade_lotacao.length?s.gestores_unidade_lotacao.filter(l=>t.gestores_unidade_lotacao.includes(l)).length?[]:s.gestores_unidade_lotacao:[],gestores_entidade:s.gestores_entidade.length?s.gestores_entidade.filter(l=>t.gestores_entidade.includes(l)).length?[]:s.gestores_entidade:[]}}static#t=this.\u0275fac=function(t){return new(t||v)(m.LFG(Q.e),m.LFG(g.f),m.LFG(T.o),m.LFG(b.W),m.LFG(O.t),m.LFG(E.w),m.LFG(x.E),m.LFG(O.t))};static#e=this.\u0275prov=m.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"})}}}]);