"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[184],{7184:(K,p,l)=>{l.r(p),l.d(p,{OcorrenciaModule:()=>Z});var m=l(6610),f=l(1260),d=l(1620),c=l(6819),C=l(3308),v=l(1641),g=l(4682),u=l(3569),T=l(24),_=l(5413),O=l(6867),a=l(3279),b=l(7363),R=l(158),D=l(5524),F=l(9209);const E=["plano"],I=["usuario"];function j(n,r){if(1&n&&a.nrm(0,"top-alert",10),2&n){const o=a.XpG();a.Y8G("message",o.warning)}}let h=(()=>{class n extends T.n{constructor(o){super(o,u.q,g.F),this.injector=o,this.validate=(i,t)=>{let e=null;return"plano_trabalho_id"==t&&i.value?.length&&this.plano?.selectedEntity?.usuario_id!=this.form?.controls.usuario_id.value?e="Obrigat\xf3rio ser o mesmo "+this.lex.translate("usu\xe1rio")+" do "+this.lex.translate("plano de trabalho"):["data_inicio","data_fim"].indexOf(t)>=0&&!this.dao?.validDateTime(i.value)?e="Inv\xe1lido":"data_fim"==t&&this.util.asTimestamp(this.form?.controls.data_inicio.value)>this.util.asTimestamp(i.value)&&(e="Menor que in\xedcio"),e},this.titleEdit=i=>"Editando "+this.lex.translate("ocorr\xeancia")+": "+(i?.usuario?.nome||""),this.planoTrabalhoDao=o.get(O.x),this.usuarioDao=o.get(_._),this.modalWidth=500,this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},plano_trabalho_id:{default:""}},this.cdRef,this.validate),this.join=["usuario","plano_trabalho.usuario:id,nome,apelido"]}loadData(o,i){var t=this;return(0,C.A)(function*(){let e=Object.assign({},i.value);t.metadata?.consolidacao&&(t.consolidacao=t.metadata?.consolidacao,t.planoTrabalho=t.metadata?.plano_trabalho||t.consolidacao.plano_trabalho,o.usuario_id=t.planoTrabalho.usuario_id,o.usuario=t.planoTrabalho.usuario,o.plano_trabalho_id=t.consolidacao.plano_trabalho_id,o.plano_trabalho=t.planoTrabalho),yield Promise.all([t.usuario.loadSearch(o.usuario||o.usuario_id),t.plano.loadSearch(o.plano_trabalho||o.plano_trabalho_id)]),i.patchValue(t.util.fillForm(e,o))})()}initializeData(o){this.entity=new u.q,this.entity.usuario_id=this.auth.usuario.id,this.loadData(this.entity,o)}saveData(o){return new Promise((i,t)=>{let e=this.util.fill(new u.q,this.entity);e=this.util.fillForm(e,this.form.value),i(e)})}get warning(){let o,i=this.util.asDate(this.form.controls.data_inicio.value),t=this.util.asDate(this.form.controls.data_fim.value);return this.consolidacao&&i&&t&&(this.util.daystamp(i)<this.util.daystamp(this.consolidacao.data_inicio)||this.util.daystamp(t)>this.util.daystamp(this.consolidacao.data_fim))&&(o="Aten\xe7\xe3o: Data da consolida\xe7\xe3o do plano \xe9 de "+this.util.getDateFormatted(this.consolidacao.data_inicio)+" a "+this.util.getDateFormatted(this.consolidacao.data_fim)),o}static#a=this.\u0275fac=function(i){return new(i||n)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:n,selectors:[["app-ocorrencia-form"]],viewQuery:function(i,t){if(1&i&&(a.GBs(v.Q,5),a.GBs(E,5),a.GBs(I,5)),2&i){let e;a.mGM(e=a.lsd())&&(t.editableForm=e.first),a.mGM(e=a.lsd())&&(t.plano=e.first),a.mGM(e=a.lsd())&&(t.usuario=e.first)}},features:[a.Vt3],decls:13,vars:13,consts:[["usuario",""],["plano",""],["type","warning",3,"message",4,"ngIf"],["initialFocus","usuario_id",3,"submit","cancel","form","disabled","title"],[1,"row"],["controlName","usuario_id","required","",3,"size","disabled","dao"],["controlName","plano_trabalho_id",3,"size","dao"],["label","In\xedcio","controlName","data_inicio","required","",3,"size"],["label","Fim","controlName","data_fim","required","",3,"size"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows"],["type","warning",3,"message"]],template:function(i,t){if(1&i){const e=a.RV6();a.DNE(0,j,1,1,"top-alert",2),a.j41(1,"editable-form",3),a.bIt("submit",function(){return a.eBV(e),a.Njj(t.onSaveData())})("cancel",function(){return a.eBV(e),a.Njj(t.onCancel())}),a.j41(2,"div",4),a.nrm(3,"input-search",5,0),a.k0s(),a.j41(5,"div",4),a.nrm(6,"input-search",6,1),a.k0s(),a.j41(8,"div",4),a.nrm(9,"input-datetime",7)(10,"input-datetime",8),a.k0s(),a.j41(11,"div",4),a.nrm(12,"input-textarea",9),a.k0s()()}2&i&&(a.Y8G("ngIf",null==t.warning?null:t.warning.length),a.R7$(),a.Y8G("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),a.R7$(2),a.Y8G("size",12)("disabled",t.consolidacao||"new"!=t.action?"true":void 0)("dao",t.usuarioDao),a.R7$(3),a.Y8G("size",12)("dao",t.planoTrabalhoDao),a.R7$(3),a.Y8G("size",6),a.R7$(),a.Y8G("size",6),a.R7$(2),a.Y8G("size",12)("rows",3))},dependencies:[m.bT,v.Q,b.O,R.S,D.r,F.P]})}return n})();var G=l(5611),y=l(9062),z=l(2034),$=l(5852),Y=l(7772),N=l(2305),L=l(6764),B=l(16),M=l(5201),A=l(5825);function V(n,r){1&n&&a.nrm(0,"toolbar")}function w(n,r){if(1&n&&a.nrm(0,"badge",25),2&n){const o=a.XpG().row,i=a.XpG();a.Y8G("maxWidth",300)("icon",i.entityService.getIcon("PlanoTrabalho"))("label",o.plano_trabalho.unidade.sigla+" - #"+o.plano_trabalho.numero)("textValue",i.util.getDateFormatted(o.plano_trabalho.data_inicio)+" \xe0 "+i.util.getDateFormatted(o.plano_trabalho.data_fim))("hint",i.lex.translate("Plano de trabalho"))}}function S(n,r){if(1&n&&(a.j41(0,"div",20)(1,"div",21),a.nrm(2,"profile-picture",22),a.k0s(),a.j41(3,"div",23)(4,"strong"),a.EFF(5),a.k0s(),a.nrm(6,"br"),a.DNE(7,w,1,5,"badge",24),a.k0s()()),2&n){const o=r.row;a.R7$(2),a.Y8G("url",o.usuario.url_foto)("size",40)("hint",o.usuario.nome),a.R7$(3),a.JRh(o.usuario.nome||""),a.R7$(2),a.Y8G("ngIf",o.plano_trabalho)}}function P(n,r){if(1&n&&(a.j41(0,"span"),a.EFF(1),a.k0s()),2&n){const o=r.row,i=a.XpG();a.R7$(),a.SpI(" ",i.dao.getDateFormatted(o.data_inicio),"")}}function U(n,r){if(1&n&&(a.j41(0,"span"),a.EFF(1),a.k0s()),2&n){const o=r.row,i=a.XpG();a.R7$(),a.SpI(" ",i.dao.getDateFormatted(o.data_fim),"")}}const X=[{path:"",component:(()=>{class n extends y.P{constructor(o){super(o,u.q,g.F),this.injector=o,this.listagemInicial=!0,this.filterWhere=i=>{let t=[],e=i.value;return e.plano_trabalho_id?.length?t.push(["plano_trabalho_id","==",e.plano_trabalho_id]):e.usuario_id?.length?t.push(["usuario_id","==",e.usuario_id]):e.descricao?.length?t.push(["descricao","like","%"+e.descricao.replace(" ","%")+"%"]):this.dao?.validDateTime(e.data_inicio)?t.push(["data_fim",">=",e.data_inicio]):this.dao?.validDateTime(e.data_fim)&&t.push(["data_inicio","<=",e.data_fim]),t},this.join=["plano_trabalho:id,numero,data_inicio,data_fim","plano_trabalho.unidade:id,nome,sigla","usuario:id,nome,url_foto"],this.planoTrabalhoDao=o.get(O.x),this.usuarioDao=o.get(_._),this.title=this.lex.translate("Ocorr\xeancias"),this.code="MOD_OCOR",this.filter=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:void 0},data_fim:{default:void 0},usuario_id:{default:""},plano_trabalho_id:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_OCOR_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}filtro(){this.listagemInicial=!1}static#a=this.\u0275fac=function(i){return new(i||n)(a.rXU(a.zZn))};static#t=this.\u0275cmp=a.VBU({type:n,selectors:[["app-ocorrencia-list"]],viewQuery:function(i,t){if(1&i&&a.GBs(G._,5),2&i){let e;a.mGM(e=a.lsd())&&(t.grid=e.first)}},features:[a.Vt3],decls:25,vars:34,consts:[["usuario",""],["planoTrabalho",""],["columnUsuario",""],["columnInicio",""],["columnFim",""],[3,"dao","add","title","orderBy","groupBy","join","hasAdd","hasEdit"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["controlName","plano_trabalho_id",3,"size","control","dao"],["label","Cont\xe9m a descri\xe7\xe3o","controlName","descricao",3,"size","control"],["date","","label","In\xedcio","controlName","data_inicio",3,"click","size","control"],["date","","label","Fim","controlName","data_fim",3,"click","size","control"],[3,"title","template"],["title","In\xedcio",3,"template"],["title","Fim",3,"template"],["title","Descri\xe7\xe3o","field","descricao"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","light",3,"maxWidth","icon","label","textValue","hint",4,"ngIf"],["color","light",3,"maxWidth","icon","label","textValue","hint"]],template:function(i,t){if(1&i){const e=a.RV6();a.j41(0,"grid",5),a.DNE(1,V,1,0,"toolbar",6),a.j41(2,"filter",7)(3,"div",8),a.nrm(4,"input-search",9,0)(6,"input-search",10,1),a.k0s(),a.j41(8,"div",8),a.nrm(9,"input-text",11),a.j41(10,"input-datetime",12),a.bIt("click",function(){return a.eBV(e),a.Njj(t.filtro())}),a.k0s(),a.j41(11,"input-datetime",13),a.bIt("click",function(){return a.eBV(e),a.Njj(t.filtro())}),a.k0s()()(),a.j41(12,"columns")(13,"column",14),a.DNE(14,S,8,5,"ng-template",null,2,a.C5r),a.k0s(),a.j41(16,"column",15),a.DNE(17,P,2,1,"ng-template",null,3,a.C5r),a.k0s(),a.j41(19,"column",16),a.DNE(20,U,2,1,"ng-template",null,4,a.C5r),a.k0s(),a.nrm(22,"column",17)(23,"column",18),a.k0s(),a.nrm(24,"pagination",19),a.k0s()}if(2&i){const e=a.sdS(15),s=a.sdS(18),J=a.sdS(21);a.Y8G("dao",t.dao)("add",t.add)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("hasAdd",t.auth.hasPermissionTo("MOD_OCOR_INCL"))("hasEdit",t.auth.hasPermissionTo("MOD_OCOR_EDT")),a.R7$(),a.Y8G("ngIf",!t.selectable),a.R7$(),a.Y8G("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",t.filterCollapsed)("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.R7$(2),a.Y8G("size",6)("control",t.filter.controls.usuario_id)("dao",t.usuarioDao),a.R7$(2),a.Y8G("size",6)("control",t.filter.controls.plano_trabalho_id)("dao",t.planoTrabalhoDao),a.R7$(3),a.Y8G("size",6)("control",t.filter.controls.descricao),a.R7$(),a.Y8G("size",3)("control",t.filter.controls.data_inicio),a.R7$(),a.Y8G("size",3)("control",t.filter.controls.data_fim),a.R7$(2),a.Y8G("title",t.lex.translate("Usu\xe1rio"))("template",e),a.R7$(3),a.Y8G("template",s),a.R7$(3),a.Y8G("template",J),a.R7$(4),a.Y8G("onEdit",t.edit)("options",t.options),a.R7$(),a.Y8G("rows",t.rowsLimit)}},dependencies:[m.bT,G._,z.T,$.I,Y.i,N.H,L.e,b.O,B.H,D.r,M.n,A.r]})}return n})(),canActivate:[d.q],resolve:{config:c.L},runGuardsAndResolvers:"always",data:{title:"Ocorr\xeancias"}},{path:"new",component:h,canActivate:[d.q],resolve:{config:c.L},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Ocorr\xeancia",modal:!0}},{path:":id/edit",component:h,canActivate:[d.q],resolve:{config:c.L},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Ocorr\xeancia",modal:!0}},{path:":id/consult",component:h,canActivate:[d.q],resolve:{config:c.L},runGuardsAndResolvers:"always",data:{title:"Consulta a Ocorr\xeancia",modal:!0}}];let Q=(()=>{class n{static#a=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=a.$C({type:n});static#o=this.\u0275inj=a.G2t({imports:[f.iI.forChild(X),f.iI]})}return n})();var W=l(8425),H=l(8832);let Z=(()=>{class n{static#a=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=a.$C({type:n});static#o=this.\u0275inj=a.G2t({imports:[m.MD,W.h,H.X1,Q]})}return n})()}}]);