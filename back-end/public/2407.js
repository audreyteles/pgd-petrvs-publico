"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[2407],{82407:(K,f,n)=>{n.r(f),n.d(f,{OcorrenciaModule:()=>p});var h=n(76733),g=n(55579),r=n(1391),d=n(2314),C=n(8239),_=n(74040),v=n(25034),c=n(34325),A=n(1184),O=n(35255),T=n(87744),a=n(20755),b=n(32802),Q=n(74508),Z=n(84495),y=n(50933);const z=["plano"],J=["usuario"];function F(l,i){if(1&l&&a._UZ(0,"top-alert",10),2&l){const o=a.oxw();a.Q6J("message",o.warning)}}class s extends A.F{constructor(i){super(i,c.M,v.u),this.injector=i,this.validate=(o,t)=>{let e=null;return"plano_trabalho_id"==t&&o.value?.length&&this.plano?.selectedEntity?.usuario_id!=this.form?.controls.usuario_id.value?e="Obrigat\xf3rio ser o mesmo "+this.lex.translate("usu\xe1rio")+" do "+this.lex.translate("plano de trabalho"):["data_inicio","data_fim"].indexOf(t)>=0&&!this.dao?.validDateTime(o.value)?e="Inv\xe1lido":"data_fim"==t&&this.util.asTimestamp(this.form?.controls.data_inicio.value)>this.util.asTimestamp(o.value)&&(e="Menor que in\xedcio"),e},this.titleEdit=o=>"Editando "+this.lex.translate("ocorr\xeancia")+": "+(o?.usuario?.nome||""),this.planoTrabalhoDao=i.get(T.t),this.usuarioDao=i.get(O.q),this.modalWidth=500,this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},plano_trabalho_id:{default:""}},this.cdRef,this.validate),this.join=["usuario","plano_trabalho.usuario:id,nome,apelido"]}loadData(i,o){var t=this;return(0,C.Z)(function*(){let e=Object.assign({},o.value);t.metadata?.consolidacao&&(t.consolidacao=t.metadata?.consolidacao,t.planoTrabalho=t.metadata?.plano_trabalho||t.consolidacao.plano_trabalho,i.usuario_id=t.planoTrabalho.usuario_id,i.usuario=t.planoTrabalho.usuario,i.plano_trabalho_id=t.consolidacao.plano_trabalho_id,i.plano_trabalho=t.planoTrabalho),yield Promise.all([t.usuario.loadSearch(i.usuario||i.usuario_id),t.plano.loadSearch(i.plano_trabalho||i.plano_trabalho_id)]),o.patchValue(t.util.fillForm(e,i))})()}initializeData(i){this.entity=new c.M,this.entity.usuario_id=this.auth.usuario.id,this.loadData(this.entity,i)}saveData(i){return new Promise((o,t)=>{let e=this.util.fill(new c.M,this.entity);e=this.util.fillForm(e,this.form.value),o(e)})}get warning(){let i,o=this.util.asDate(this.form.controls.data_inicio.value),t=this.util.asDate(this.form.controls.data_fim.value);return this.consolidacao&&o&&t&&(this.util.daystamp(o)<this.util.daystamp(this.consolidacao.data_inicio)||this.util.daystamp(t)>this.util.daystamp(this.consolidacao.data_fim))&&(i="Aten\xe7\xe3o: Data da consolida\xe7\xe3o do plano \xe9 de "+this.util.getDateFormatted(this.consolidacao.data_inicio)+" a "+this.util.getDateFormatted(this.consolidacao.data_fim)),i}static#a=this.\u0275fac=function(o){return new(o||s)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:s,selectors:[["app-ocorrencia-form"]],viewQuery:function(o,t){if(1&o&&(a.Gf(_.Q,5),a.Gf(z,5),a.Gf(J,5)),2&o){let e;a.iGM(e=a.CRH())&&(t.editableForm=e.first),a.iGM(e=a.CRH())&&(t.plano=e.first),a.iGM(e=a.CRH())&&(t.usuario=e.first)}},features:[a.qOj],decls:13,vars:13,consts:[["type","warning",3,"message",4,"ngIf"],["initialFocus","usuario_id",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","usuario_id","required","",3,"size","disabled","dao"],["usuario",""],["controlName","plano_trabalho_id",3,"size","dao"],["plano",""],["label","In\xedcio","controlName","data_inicio","required","",3,"size"],["label","Fim","controlName","data_fim","required","",3,"size"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows"],["type","warning",3,"message"]],template:function(o,t){1&o&&(a.YNc(0,F,1,1,"top-alert",0),a.TgZ(1,"editable-form",1),a.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),a.TgZ(2,"div",2),a._UZ(3,"input-search",3,4),a.qZA(),a.TgZ(5,"div",2),a._UZ(6,"input-search",5,6),a.qZA(),a.TgZ(8,"div",2),a._UZ(9,"input-datetime",7)(10,"input-datetime",8),a.qZA(),a.TgZ(11,"div",2),a._UZ(12,"input-textarea",9),a.qZA()()),2&o&&(a.Q6J("ngIf",null==t.warning?null:t.warning.length),a.xp6(1),a.Q6J("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),a.xp6(2),a.Q6J("size",12)("disabled",t.consolidacao||"new"!=t.action?"true":void 0)("dao",t.usuarioDao),a.xp6(3),a.Q6J("size",12)("dao",t.planoTrabalhoDao),a.xp6(3),a.Q6J("size",6),a.xp6(1),a.Q6J("size",6),a.xp6(2),a.Q6J("size",12)("rows",3))},dependencies:[h.O5,_.Q,b.V,Q.Q,Z.k,y.o]})}var D=n(73150),E=n(78509),M=n(57224),I=n(83351),N=n(57765),U=n(45512),w=n(42704),L=n(92392),G=n(95489),R=n(2729);function x(l,i){1&l&&a._UZ(0,"toolbar")}function B(l,i){if(1&l&&a._UZ(0,"badge",25),2&l){const o=a.oxw().row,t=a.oxw();a.Q6J("maxWidth",300)("icon",t.entityService.getIcon("PlanoTrabalho"))("label",o.plano_trabalho.unidade.sigla+" - #"+o.plano_trabalho.numero)("textValue",t.util.getDateFormatted(o.plano_trabalho.data_inicio)+" \xe0 "+t.util.getDateFormatted(o.plano_trabalho.data_fim))("hint",t.lex.translate("Plano de trabalho"))}}function P(l,i){if(1&l&&(a.TgZ(0,"div",20)(1,"div",21),a._UZ(2,"profile-picture",22),a.qZA(),a.TgZ(3,"div",23)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.YNc(7,B,1,5,"badge",24),a.qZA()()),2&l){const o=i.row;a.xp6(2),a.Q6J("url",o.usuario.url_foto)("size",40)("hint",o.usuario.nome),a.xp6(3),a.Oqu(o.usuario.nome||""),a.xp6(2),a.Q6J("ngIf",o.plano_trabalho)}}function j(l,i){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&l){const o=i.row,t=a.oxw();a.xp6(1),a.hij(" ",t.dao.getDateFormatted(o.data_inicio),"")}}function S(l,i){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&l){const o=i.row,t=a.oxw();a.xp6(1),a.hij(" ",t.dao.getDateFormatted(o.data_fim),"")}}class u extends E.E{constructor(i){super(i,c.M,v.u),this.injector=i,this.listagemInicial=!0,this.filterWhere=o=>{let t=[],e=o.value;return e.plano_trabalho_id?.length?t.push(["plano_trabalho_id","==",e.plano_trabalho_id]):e.usuario_id?.length?t.push(["usuario_id","==",e.usuario_id]):e.descricao?.length?t.push(["descricao","like","%"+e.descricao.replace(" ","%")+"%"]):this.dao?.validDateTime(e.data_inicio)?t.push(["data_fim",">=",e.data_inicio]):this.dao?.validDateTime(e.data_fim)&&t.push(["data_inicio","<=",e.data_fim]),t},this.join=["plano_trabalho:id,numero,data_inicio,data_fim","plano_trabalho.unidade:id,nome,sigla","usuario:id,nome,url_foto"],this.planoTrabalhoDao=i.get(T.t),this.usuarioDao=i.get(O.q),this.title=this.lex.translate("Ocorr\xeancias"),this.code="MOD_OCOR",this.filter=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:void 0},data_fim:{default:void 0},usuario_id:{default:""},plano_trabalho_id:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_OCOR_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}filtro(){this.listagemInicial=!1}static#a=this.\u0275fac=function(o){return new(o||u)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:u,selectors:[["app-ocorrencia-list"]],viewQuery:function(o,t){if(1&o&&a.Gf(D.M,5),2&o){let e;a.iGM(e=a.CRH())&&(t.grid=e.first)}},features:[a.qOj],decls:25,vars:34,consts:[[3,"dao","add","title","orderBy","groupBy","join","hasAdd","hasEdit"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","plano_trabalho_id",3,"size","control","dao"],["planoTrabalho",""],["label","Cont\xe9m a descri\xe7\xe3o","controlName","descricao",3,"size","control"],["date","","label","In\xedcio","controlName","data_inicio",3,"size","control","click"],["date","","label","Fim","controlName","data_fim",3,"size","control","click"],[3,"title","template"],["columnUsuario",""],["title","In\xedcio",3,"template"],["columnInicio",""],["title","Fim",3,"template"],["columnFim",""],["title","Descri\xe7\xe3o","field","descricao"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","light",3,"maxWidth","icon","label","textValue","hint",4,"ngIf"],["color","light",3,"maxWidth","icon","label","textValue","hint"]],template:function(o,t){if(1&o&&(a.TgZ(0,"grid",0),a.YNc(1,x,1,0,"toolbar",1),a.TgZ(2,"filter",2)(3,"div",3),a._UZ(4,"input-search",4,5)(6,"input-search",6,7),a.qZA(),a.TgZ(8,"div",3),a._UZ(9,"input-text",8),a.TgZ(10,"input-datetime",9),a.NdJ("click",function(){return t.filtro()}),a.qZA(),a.TgZ(11,"input-datetime",10),a.NdJ("click",function(){return t.filtro()}),a.qZA()()(),a.TgZ(12,"columns")(13,"column",11),a.YNc(14,P,8,5,"ng-template",null,12,a.W1O),a.qZA(),a.TgZ(16,"column",13),a.YNc(17,j,2,1,"ng-template",null,14,a.W1O),a.qZA(),a.TgZ(19,"column",15),a.YNc(20,S,2,1,"ng-template",null,16,a.W1O),a.qZA(),a._UZ(22,"column",17)(23,"column",18),a.qZA(),a._UZ(24,"pagination",19),a.qZA()),2&o){const e=a.MAs(15),X=a.MAs(18),H=a.MAs(21);a.Q6J("dao",t.dao)("add",t.add)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("hasAdd",t.auth.hasPermissionTo("MOD_OCOR_INCL"))("hasEdit",t.auth.hasPermissionTo("MOD_OCOR_EDT")),a.xp6(1),a.Q6J("ngIf",!t.selectable),a.xp6(1),a.Q6J("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",t.filterCollapsed)("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",6)("control",t.filter.controls.usuario_id)("dao",t.usuarioDao),a.xp6(2),a.Q6J("size",6)("control",t.filter.controls.plano_trabalho_id)("dao",t.planoTrabalhoDao),a.xp6(3),a.Q6J("size",6)("control",t.filter.controls.descricao),a.xp6(1),a.Q6J("size",3)("control",t.filter.controls.data_inicio),a.xp6(1),a.Q6J("size",3)("control",t.filter.controls.data_fim),a.xp6(2),a.Q6J("title",t.lex.translate("Usu\xe1rio"))("template",e),a.xp6(3),a.Q6J("template",X),a.xp6(3),a.Q6J("template",H),a.xp6(4),a.Q6J("onEdit",t.edit)("options",t.options),a.xp6(1),a.Q6J("rows",t.rowsLimit)}},dependencies:[h.O5,D.M,M.a,I.b,N.z,U.n,w.Q,b.V,L.m,Z.k,G.F,R.q]})}const W=[{path:"",component:u,canActivate:[r.a],resolve:{config:d.o},runGuardsAndResolvers:"always",data:{title:"Ocorr\xeancias"}},{path:"new",component:s,canActivate:[r.a],resolve:{config:d.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Ocorr\xeancia",modal:!0}},{path:":id/edit",component:s,canActivate:[r.a],resolve:{config:d.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Ocorr\xeancia",modal:!0}},{path:":id/consult",component:s,canActivate:[r.a],resolve:{config:d.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Ocorr\xeancia",modal:!0}}];class m{static#a=this.\u0275fac=function(o){return new(o||m)};static#t=this.\u0275mod=a.oAB({type:m});static#o=this.\u0275inj=a.cJS({imports:[g.Bz.forChild(W),g.Bz]})}var Y=n(58568),V=n(72133);class p{static#a=this.\u0275fac=function(o){return new(o||p)};static#t=this.\u0275mod=a.oAB({type:p});static#o=this.\u0275inj=a.cJS({imports:[h.ez,Y.K,V.UX,m]})}}}]);