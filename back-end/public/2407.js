"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[2407],{82407:(k,g,e)=>{e.r(g),e.d(g,{OcorrenciaModule:()=>F});var d,f=e(76733),_=e(55579),u=e(1391),m=e(2314),y=e(8239),v=e(74040),O=e(25034),p=e(34325),z=e(1184),T=e(35255),b=e(87744),a=e(20755),Z=e(32802),J=e(74508),D=e(84495),M=e(50933);const E=["plano"],I=["usuario"];function N(n,t){if(1&n&&a._UZ(0,"top-alert",10),2&n){const o=a.oxw();a.Q6J("message",o.warning)}}class h extends z.F{constructor(t){super(t,p.M,O.u),this.injector=t,this.validate=(o,i)=>{let l=null;return"plano_trabalho_id"==i&&o.value?.length&&this.plano?.selectedEntity?.usuario_id!=this.form?.controls.usuario_id.value?l="Obrigat\xf3rio ser o mesmo "+this.lex.translate("usu\xe1rio")+" do "+this.lex.translate("plano de trabalho"):["data_inicio","data_fim"].indexOf(i)>=0&&!this.dao?.validDateTime(o.value)?l="Inv\xe1lido":"data_fim"==i&&this.util.asTimestamp(this.form?.controls.data_inicio.value)>this.util.asTimestamp(o.value)&&(l="Menor que in\xedcio"),l},this.titleEdit=o=>"Editando "+this.lex.translate("ocorr\xeancia")+": "+(o?.usuario?.nome||""),this.planoTrabalhoDao=t.get(b.t),this.usuarioDao=t.get(T.q),this.modalWidth=500,this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},plano_trabalho_id:{default:""}},this.cdRef,this.validate),this.join=["usuario","plano_trabalho.usuario:id,nome,apelido"]}loadData(t,o){var i=this;return(0,y.Z)(function*(){let l=Object.assign({},o.value);i.metadata?.consolidacao&&(i.consolidacao=i.metadata?.consolidacao,i.planoTrabalho=i.metadata?.plano_trabalho||i.consolidacao.plano_trabalho,t.usuario_id=i.planoTrabalho.usuario_id,t.usuario=i.planoTrabalho.usuario,t.plano_trabalho_id=i.consolidacao.plano_trabalho_id,t.plano_trabalho=i.planoTrabalho),yield Promise.all([i.usuario.loadSearch(t.usuario||t.usuario_id),i.plano.loadSearch(t.plano_trabalho||t.plano_trabalho_id)]),o.patchValue(i.util.fillForm(l,t))})()}initializeData(t){this.entity=new p.M,this.entity.usuario_id=this.auth.usuario.id,this.loadData(this.entity,t)}saveData(t){return new Promise((o,i)=>{let l=this.util.fill(new p.M,this.entity);l=this.util.fillForm(l,this.form.value),o(l)})}get warning(){let t,o=this.util.asDate(this.form.controls.data_inicio.value),i=this.util.asDate(this.form.controls.data_fim.value);return this.consolidacao&&o&&i&&(this.util.daystamp(o)<this.util.daystamp(this.consolidacao.data_inicio)||this.util.daystamp(i)>this.util.daystamp(this.consolidacao.data_fim))&&(t="Aten\xe7\xe3o: Data da consolida\xe7\xe3o do plano \xe9 de "+this.util.getDateFormatted(this.consolidacao.data_inicio)+" a "+this.util.getDateFormatted(this.consolidacao.data_fim)),t}}(d=h).\u0275fac=function(t){return new(t||d)(a.Y36(a.zs3))},d.\u0275cmp=a.Xpm({type:d,selectors:[["app-ocorrencia-form"]],viewQuery:function(t,o){if(1&t&&(a.Gf(v.Q,5),a.Gf(E,5),a.Gf(I,5)),2&t){let i;a.iGM(i=a.CRH())&&(o.editableForm=i.first),a.iGM(i=a.CRH())&&(o.plano=i.first),a.iGM(i=a.CRH())&&(o.usuario=i.first)}},features:[a.qOj],decls:13,vars:13,consts:[["type","warning",3,"message",4,"ngIf"],["initialFocus","usuario_id",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","usuario_id","required","",3,"size","disabled","dao"],["usuario",""],["controlName","plano_trabalho_id",3,"size","dao"],["plano",""],["label","In\xedcio","controlName","data_inicio","required","",3,"size"],["label","Fim","controlName","data_fim","required","",3,"size"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows"],["type","warning",3,"message"]],template:function(t,o){1&t&&(a.YNc(0,N,1,1,"top-alert",0),a.TgZ(1,"editable-form",1),a.NdJ("submit",function(){return o.onSaveData()})("cancel",function(){return o.onCancel()}),a.TgZ(2,"div",2),a._UZ(3,"input-search",3,4),a.qZA(),a.TgZ(5,"div",2),a._UZ(6,"input-search",5,6),a.qZA(),a.TgZ(8,"div",2),a._UZ(9,"input-datetime",7)(10,"input-datetime",8),a.qZA(),a.TgZ(11,"div",2),a._UZ(12,"input-textarea",9),a.qZA()()),2&t&&(a.Q6J("ngIf",null==o.warning?null:o.warning.length),a.xp6(1),a.Q6J("form",o.form)("disabled",o.formDisabled)("title",o.isModal?"":o.title),a.xp6(2),a.Q6J("size",12)("disabled",o.consolidacao||"new"!=o.action?"true":void 0)("dao",o.usuarioDao),a.xp6(3),a.Q6J("size",12)("dao",o.planoTrabalhoDao),a.xp6(3),a.Q6J("size",6),a.xp6(1),a.Q6J("size",6),a.xp6(2),a.Q6J("size",12)("rows",3))},dependencies:[f.O5,v.Q,Z.V,J.Q,D.k,M.o]});var c,r,C=e(73150),U=e(78509),w=e(57224),L=e(83351),R=e(57765),G=e(45512),x=e(42704),B=e(92392),P=e(95489),j=e(2729);function S(n,t){1&n&&a._UZ(0,"toolbar")}function W(n,t){if(1&n&&a._UZ(0,"badge",25),2&n){const o=a.oxw().row,i=a.oxw();a.Q6J("maxWidth",300)("icon",i.entityService.getIcon("PlanoTrabalho"))("label",o.plano_trabalho.unidade.sigla+" - #"+o.plano_trabalho.numero)("textValue",i.util.getDateFormatted(o.plano_trabalho.data_inicio)+" \xe0 "+i.util.getDateFormatted(o.plano_trabalho.data_fim))("hint",i.lex.translate("Plano de trabalho"))}}function Y(n,t){if(1&n&&(a.TgZ(0,"div",20)(1,"div",21),a._UZ(2,"profile-picture",22),a.qZA(),a.TgZ(3,"div",23)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.YNc(7,W,1,5,"badge",24),a.qZA()()),2&n){const o=t.row;a.xp6(2),a.Q6J("url",o.usuario.url_foto)("size",40)("hint",o.usuario.nome),a.xp6(3),a.Oqu(o.usuario.nome||""),a.xp6(2),a.Q6J("ngIf",o.plano_trabalho)}}function V(n,t){if(1&n&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&n){const o=t.row,i=a.oxw();a.xp6(1),a.hij(" ",i.dao.getDateFormatted(o.data_inicio),"")}}function X(n,t){if(1&n&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&n){const o=t.row,i=a.oxw();a.xp6(1),a.hij(" ",i.dao.getDateFormatted(o.data_fim),"")}}class A extends U.E{constructor(t){super(t,p.M,O.u),this.injector=t,this.listagemInicial=!0,this.filterWhere=o=>{let i=[],l=o.value;return l.plano_trabalho_id?.length?i.push(["plano_trabalho_id","==",l.plano_trabalho_id]):l.usuario_id?.length?i.push(["usuario_id","==",l.usuario_id]):l.descricao?.length?i.push(["descricao","like","%"+l.descricao.replace(" ","%")+"%"]):this.dao?.validDateTime(l.data_inicio)?i.push(["data_fim",">=",l.data_inicio]):this.dao?.validDateTime(l.data_fim)&&i.push(["data_inicio","<=",l.data_fim]),i},this.join=["plano_trabalho:id,numero,data_inicio,data_fim","plano_trabalho.unidade:id,nome,sigla","usuario:id,nome,url_foto"],this.planoTrabalhoDao=t.get(b.t),this.usuarioDao=t.get(T.q),this.title=this.lex.translate("Ocorr\xeancias"),this.code="MOD_OCOR",this.filter=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:void 0},data_fim:{default:void 0},usuario_id:{default:""},plano_trabalho_id:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_OCOR_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}filtro(){this.listagemInicial=!1}}(c=A).\u0275fac=function(t){return new(t||c)(a.Y36(a.zs3))},c.\u0275cmp=a.Xpm({type:c,selectors:[["app-ocorrencia-list"]],viewQuery:function(t,o){if(1&t&&a.Gf(C.M,5),2&t){let i;a.iGM(i=a.CRH())&&(o.grid=i.first)}},features:[a.qOj],decls:25,vars:34,consts:[[3,"dao","add","title","orderBy","groupBy","join","hasAdd","hasEdit"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","plano_trabalho_id",3,"size","control","dao"],["planoTrabalho",""],["label","Cont\xe9m a descri\xe7\xe3o","controlName","descricao",3,"size","control"],["date","","label","In\xedcio","controlName","data_inicio",3,"size","control","click"],["date","","label","Fim","controlName","data_fim",3,"size","control","click"],[3,"title","template"],["columnUsuario",""],["title","In\xedcio",3,"template"],["columnInicio",""],["title","Fim",3,"template"],["columnFim",""],["title","Descri\xe7\xe3o","field","descricao"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","light",3,"maxWidth","icon","label","textValue","hint",4,"ngIf"],["color","light",3,"maxWidth","icon","label","textValue","hint"]],template:function(t,o){if(1&t&&(a.TgZ(0,"grid",0),a.YNc(1,S,1,0,"toolbar",1),a.TgZ(2,"filter",2)(3,"div",3),a._UZ(4,"input-search",4,5)(6,"input-search",6,7),a.qZA(),a.TgZ(8,"div",3),a._UZ(9,"input-text",8),a.TgZ(10,"input-datetime",9),a.NdJ("click",function(){return o.filtro()}),a.qZA(),a.TgZ(11,"input-datetime",10),a.NdJ("click",function(){return o.filtro()}),a.qZA()()(),a.TgZ(12,"columns")(13,"column",11),a.YNc(14,Y,8,5,"ng-template",null,12,a.W1O),a.qZA(),a.TgZ(16,"column",13),a.YNc(17,V,2,1,"ng-template",null,14,a.W1O),a.qZA(),a.TgZ(19,"column",15),a.YNc(20,X,2,1,"ng-template",null,16,a.W1O),a.qZA(),a._UZ(22,"column",17)(23,"column",18),a.qZA(),a._UZ(24,"pagination",19),a.qZA()),2&t){const i=a.MAs(15),l=a.MAs(18),q=a.MAs(21);a.Q6J("dao",o.dao)("add",o.add)("title",o.isModal?"":o.title)("orderBy",o.orderBy)("groupBy",o.groupBy)("join",o.join)("hasAdd",o.auth.hasPermissionTo("MOD_OCOR_INCL"))("hasEdit",o.auth.hasPermissionTo("MOD_OCOR_EDT")),a.xp6(1),a.Q6J("ngIf",!o.selectable),a.xp6(1),a.Q6J("form",o.filter)("where",o.filterWhere)("submit",o.filterSubmit.bind(o))("collapseChange",o.filterCollapseChange.bind(o))("collapsed",o.filterCollapsed)("deleted",o.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",6)("control",o.filter.controls.usuario_id)("dao",o.usuarioDao),a.xp6(2),a.Q6J("size",6)("control",o.filter.controls.plano_trabalho_id)("dao",o.planoTrabalhoDao),a.xp6(3),a.Q6J("size",6)("control",o.filter.controls.descricao),a.xp6(1),a.Q6J("size",3)("control",o.filter.controls.data_inicio),a.xp6(1),a.Q6J("size",3)("control",o.filter.controls.data_fim),a.xp6(2),a.Q6J("title",o.lex.translate("Usu\xe1rio"))("template",i),a.xp6(3),a.Q6J("template",l),a.xp6(3),a.Q6J("template",q),a.xp6(4),a.Q6J("onEdit",o.edit)("options",o.options),a.xp6(1),a.Q6J("rows",o.rowsLimit)}},dependencies:[f.O5,C.M,w.a,L.b,R.z,G.n,x.Q,Z.V,B.m,D.k,P.F,j.q]});const H=[{path:"",component:A,canActivate:[u.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Ocorr\xeancias"}},{path:"new",component:h,canActivate:[u.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Ocorr\xeancia",modal:!0}},{path:":id/edit",component:h,canActivate:[u.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Ocorr\xeancia",modal:!0}},{path:":id/consult",component:h,canActivate:[u.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Ocorr\xeancia",modal:!0}}];class Q{}(r=Q).\u0275fac=function(t){return new(t||r)},r.\u0275mod=a.oAB({type:r}),r.\u0275inj=a.cJS({imports:[_.Bz.forChild(H),_.Bz]});var s,K=e(58568),$=e(72133);class F{}(s=F).\u0275fac=function(t){return new(t||s)},s.\u0275mod=a.oAB({type:s}),s.\u0275inj=a.cJS({imports:[f.ez,K.K,$.UX,Q]})}}]);