"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9314],{49314:(q,_,n)=>{n.r(_),n.d(_,{AfastamentoModule:()=>y});var r,h=n(76733),v=n(55579),u=n(1391),f=n(2314),Q=n(8239),g=n(74040),A=n(74561),p=n(34684),J=n(1184),T=n(94002),D=n(35255),t=n(20755),Z=n(32802),z=n(74508),C=n(84495),w=n(50933);const I=["tipoMotivoAfastamento"],N=["usuario"];function U(e,a){if(1&e&&t._UZ(0,"top-alert",10),2&e){const o=t.oxw();t.Q6J("message",o.warning)}}class c extends J.F{constructor(a){super(a,p.i,A.e),this.injector=a,this.validate=(o,i)=>{let s=null;return["usuario_id","tipo_motivo_afastamento_id"].indexOf(i)>=0&&!o.value?.length?s="Obrigat\xf3rio":["data_inicio","data_fim"].indexOf(i)>=0&&!this.dao?.validDateTime(o.value)&&(s="Inv\xe1lido"),s},this.titleEdit=o=>"Editando "+this.lex.translate("afastamento")+": "+(o?.usuario?.nome||"")+" - "+(o?.tipo_motivo_afastamento?.nome||""),this.tipoMotivoAfastamentoDao=a.get(T.n),this.usuarioDao=a.get(D.q),this.title=this.lex.translate("Afastamento"),this.form=this.fh.FormBuilder({observacoes:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},tipo_motivo_afastamento_id:{default:""}},this.cdRef,this.validate),this.join=["usuario","tipo_motivo_afastamento"]}isHoras(){return!(!this.form.controls.tipo_motivo_afastamento_id.value?.length||!this.tipoMotivoAfastamento?.selectedEntity?.horas)}loadData(a,o){var i=this;return(0,Q.Z)(function*(){let s=Object.assign({},o.value);i.metadata?.consolidacao&&(i.consolidacao=i.metadata?.consolidacao,a.usuario_id=i.consolidacao.plano_trabalho.usuario_id,a.usuario=i.consolidacao.plano_trabalho?.usuario),yield Promise.all([i.usuario.loadSearch(a.usuario||s.usuario_id),i.tipoMotivoAfastamento.loadSearch(a.tipo_motivo_afastamento||s.tipo_motivo_afastamento_id)]),o.patchValue(i.util.fillForm(s,a))})()}initializeData(a){this.entity=new p.i,this.loadData(this.entity,a)}saveData(a){return new Promise((o,i)=>{let s=this.util.fill(new p.i,this.entity);s=this.util.fillForm(s,this.form.value),this.isHoras()||(s.data_inicio.setHours(0,0,0),s.data_fim.setHours(23,59,0),s.data_fim.setDate(s.data_fim.getDate())),o(s)})}get warning(){let a,o=this.util.asDate(this.form.controls.data_inicio.value),i=this.util.asDate(this.form.controls.data_fim.value);return this.consolidacao&&o&&i&&(this.util.daystamp(o)<this.util.daystamp(this.consolidacao.data_inicio)||this.util.daystamp(i)>this.util.daystamp(this.consolidacao.data_fim))&&(a="Aten\xe7\xe3o: Data da consolida\xe7\xe3o do plano \xe9 de "+this.util.getDateFormatted(this.consolidacao.data_inicio)+" a "+this.util.getDateFormatted(this.consolidacao.data_fim)),a}}(r=c).\u0275fac=function(a){return new(a||r)(t.Y36(t.zs3))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-afastamento-form"]],viewQuery:function(a,o){if(1&a&&(t.Gf(g.Q,5),t.Gf(I,5),t.Gf(N,5)),2&a){let i;t.iGM(i=t.CRH())&&(o.editableForm=i.first),t.iGM(i=t.CRH())&&(o.tipoMotivoAfastamento=i.first),t.iGM(i=t.CRH())&&(o.usuario=i.first)}},features:[t.qOj],decls:12,vars:16,consts:[["type","warning",3,"message",4,"ngIf"],["initialFocus","usuario_id",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","usuario_id","required","",3,"size","disabled","dao"],["usuario",""],["controlName","tipo_motivo_afastamento_id","required","",3,"size","dao"],["tipoMotivoAfastamento",""],["label","In\xedcio","controlName","data_inicio",3,"date","size"],["label","Fim","controlName","data_fim",3,"date","size"],["label","Observa\xe7\xf5es","controlName","observacoes",3,"size","rows"],["type","warning",3,"message"]],template:function(a,o){1&a&&(t.YNc(0,U,1,1,"top-alert",0),t.TgZ(1,"editable-form",1),t.NdJ("submit",function(){return o.onSaveData()})("cancel",function(){return o.onCancel()}),t.TgZ(2,"div",2),t._UZ(3,"input-search",3,4)(5,"input-search",5,6),t.qZA(),t.TgZ(7,"div",2),t._UZ(8,"input-datetime",7)(9,"input-datetime",8),t.qZA(),t.TgZ(10,"div",2),t._UZ(11,"input-textarea",9),t.qZA()()),2&a&&(t.Q6J("ngIf",null==o.warning?null:o.warning.length),t.xp6(1),t.Q6J("form",o.form)("disabled",o.formDisabled)("title",o.isModal?"":o.title),t.xp6(2),t.Q6J("size",6)("disabled",o.consolidacao?"true":void 0)("dao",o.usuarioDao),t.xp6(2),t.Q6J("size",6)("dao",o.tipoMotivoAfastamentoDao),t.xp6(3),t.Q6J("date",o.isHoras()?void 0:"")("size",6),t.xp6(1),t.Q6J("date",o.isHoras()?void 0:"")("size",6),t.xp6(2),t.Q6J("size",12)("rows",3),t.uIk("maxlength",250))},dependencies:[h.O5,g.Q,Z.V,z.Q,C.k,w.o]});var d,l,M=n(73150),E=n(78509),L=n(57224),b=n(83351),G=n(57765),R=n(45512),j=n(42704);function B(e,a){1&e&&t._UZ(0,"toolbar")}function H(e,a){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const o=a.row;t.xp6(1),t.hij(" ",o.usuario.nome,"")}}function Y(e,a){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const o=t.oxw().row;t.xp6(1),t.hij(" ","(c\xf3d. "+o.tipo_motivo_afastamento.codigo+")","")}}function P(e,a){if(1&e&&(t._UZ(0,"i"),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.YNc(3,Y,2,1,"span",1)),2&e){const o=a.row;t.Tol(o.tipo_motivo_afastamento.icone),t.xp6(1),t.Udp("color",o.tipo_motivo_afastamento.cor),t.xp6(1),t.hij(" ",o.tipo_motivo_afastamento.nome,""),t.xp6(1),t.Q6J("ngIf",o.tipo_motivo_afastamento.codigo)}}function S(e,a){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const o=a.row,i=t.oxw();t.xp6(1),t.hij(" ",i.dao.getDateFormatted(o.data_inicio),"")}}function W(e,a){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const o=a.row,i=t.oxw();t.xp6(1),t.hij(" ",i.dao.getDateFormatted(o.data_fim),"")}}class O extends E.E{constructor(a){super(a,p.i,A.e),this.injector=a,this.listagemInicial=!0,this.filterWhere=o=>{let i=[],s=o.value;return s.usuario_id?.length&&s.tipo_motivo_afastamento_id?.length?(i.push(["usuario_id","==",s.usuario_id]),i.push(["tipo_motivo_afastamento_id","==",s.tipo_motivo_afastamento_id])):s.usuario_id?.length?i.push(["usuario_id","==",s.usuario_id]):s.tipo_motivo_afastamento_id?.length?i.push(["tipo_motivo_afastamento_id","==",s.tipo_motivo_afastamento_id]):this.dao?.validDateTime(s.data_inicio)&&this.dao?.validDateTime(s.data_fim)&&!this.listagemInicial&&i.push(this.dao?.intersectionWhere("data_inicio","data_fim",this.util.startOfDay(s.data_inicio),this.util.startOfDay(s.data_fim))),i},this.join=["tipo_motivo_afastamento:id, nome","usuario: id, nome"],this.tipoMotivoAfastamentoDao=a.get(T.n),this.usuarioDao=a.get(D.q),this.title=this.lex.translate("Afastamentos"),this.code="MOD_AFT",this.filter=this.fh.FormBuilder({observacoes:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},tipo_motivo_afastamento_id:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_AFT_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}filtro(){this.listagemInicial=!1}}(d=O).\u0275fac=function(a){return new(a||d)(t.Y36(t.zs3))},d.\u0275cmp=t.Xpm({type:d,selectors:[["app-afastamento-list"]],viewQuery:function(a,o){if(1&a&&t.Gf(M.M,5),2&a){let i;t.iGM(i=t.CRH())&&(o.grid=i.first)}},features:[t.qOj],decls:26,vars:32,consts:[[3,"dao","add","title","orderBy","groupBy","join","hasAdd","hasEdit"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","tipo_motivo_afastamento_id",3,"size","control","dao"],["tipoMotivoAfastamento",""],["date","","label","In\xedcio","controlName","data_inicio",3,"size","click"],["date","","label","Fim","controlName","data_fim",3,"size","click"],[3,"title","template"],["columnUsuario",""],["columnMotivoAfastamento",""],["title","In\xedcio",3,"template"],["columnInicioAfastamento",""],["title","Fim",3,"template"],["columnFimAfastamento",""],["title","Observa\xe7\xf5es","field","observacoes"],["type","options",3,"onEdit","options"],[3,"rows"]],template:function(a,o){if(1&a&&(t.TgZ(0,"grid",0),t.YNc(1,B,1,0,"toolbar",1),t.TgZ(2,"filter",2)(3,"div",3),t._UZ(4,"input-search",4,5)(6,"input-search",6,7),t.TgZ(8,"input-datetime",8),t.NdJ("click",function(){return o.filtro()}),t.qZA(),t.TgZ(9,"input-datetime",9),t.NdJ("click",function(){return o.filtro()}),t.qZA()()(),t.TgZ(10,"columns")(11,"column",10),t.YNc(12,H,2,1,"ng-template",null,11,t.W1O),t.qZA(),t.TgZ(14,"column",10),t.YNc(15,P,4,6,"ng-template",null,12,t.W1O),t.qZA(),t.TgZ(17,"column",13),t.YNc(18,S,2,1,"ng-template",null,14,t.W1O),t.qZA(),t.TgZ(20,"column",15),t.YNc(21,W,2,1,"ng-template",null,16,t.W1O),t.qZA(),t._UZ(23,"column",17)(24,"column",18),t.qZA(),t._UZ(25,"pagination",19),t.qZA()),2&a){const i=t.MAs(13),s=t.MAs(16),K=t.MAs(19),$=t.MAs(22);t.Q6J("dao",o.dao)("add",o.add)("title",o.isModal?"":o.title)("orderBy",o.orderBy)("groupBy",o.groupBy)("join",o.join)("hasAdd",o.auth.hasPermissionTo("MOD_AFT_INCL"))("hasEdit",o.auth.hasPermissionTo("MOD_AFT_EDT")),t.xp6(1),t.Q6J("ngIf",!o.selectable),t.xp6(1),t.Q6J("form",o.filter)("where",o.filterWhere)("submit",o.filterSubmit.bind(o))("collapseChange",o.filterCollapseChange.bind(o))("collapsed",o.filterCollapsed)("deleted",o.auth.hasPermissionTo("MOD_AUDIT_DEL")),t.xp6(2),t.Q6J("size",3)("control",o.filter.controls.usuario_id)("dao",o.usuarioDao),t.xp6(2),t.Q6J("size",3)("control",o.filter.controls.tipo_motivo_afastamento_id)("dao",o.tipoMotivoAfastamentoDao),t.xp6(2),t.Q6J("size",3),t.xp6(1),t.Q6J("size",3),t.xp6(2),t.Q6J("title",o.lex.translate("Usu\xe1rio"))("template",i),t.xp6(3),t.Q6J("title",o.lex.translate("Motivo"))("template",s),t.xp6(3),t.Q6J("template",K),t.xp6(3),t.Q6J("template",$),t.xp6(4),t.Q6J("onEdit",o.edit)("options",o.options),t.xp6(1),t.Q6J("rows",o.rowsLimit)}},dependencies:[h.O5,M.M,L.a,b.b,G.z,R.n,j.Q,Z.V,C.k]});const X=[{path:"",component:O,canActivate:[u.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Afastamentos"}},{path:"new",component:c,canActivate:[u.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Afastamento",modal:!0}},{path:":id/edit",component:c,canActivate:[u.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Afastamento",modal:!0}},{path:":id/consult",component:c,canActivate:[u.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Afastamento",modal:!0}}];class F{}(l=F).\u0275fac=function(a){return new(a||l)},l.\u0275mod=t.oAB({type:l}),l.\u0275inj=t.cJS({imports:[v.Bz.forChild(X),v.Bz]});var m,x=n(58568),V=n(72133);class y{}(m=y).\u0275fac=function(a){return new(a||m)},m.\u0275mod=t.oAB({type:m}),m.\u0275inj=t.cJS({imports:[h.ez,x.K,V.UX,F]})}}]);