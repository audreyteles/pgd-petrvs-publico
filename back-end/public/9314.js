"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9314],{49314:(V,h,s)=>{s.r(h),s.d(h,{AfastamentoModule:()=>p});var c=s(76733),_=s(55579),m=s(1391),r=s(2314),C=s(8239),v=s(74040),g=s(74561),d=s(34684),y=s(1184),A=s(94002),T=s(35255),t=s(20755),D=s(32802),F=s(74508),Z=s(84495),M=s(50933);const Q=["tipoMotivoAfastamento"],J=["usuario"];function z(n,e){if(1&n&&t._UZ(0,"top-alert",10),2&n){const o=t.oxw();t.Q6J("message",o.warning)}}class l extends y.F{constructor(e){super(e,d.i,g.e),this.injector=e,this.validate=(o,a)=>{let i=null;return["usuario_id","tipo_motivo_afastamento_id"].indexOf(a)>=0&&!o.value?.length?i="Obrigat\xf3rio":["data_inicio","data_fim"].indexOf(a)>=0&&!this.dao?.validDateTime(o.value)&&(i="Inv\xe1lido"),i},this.titleEdit=o=>"Editando "+this.lex.translate("afastamento")+": "+(o?.usuario?.nome||"")+" - "+(o?.tipo_motivo_afastamento?.nome||""),this.tipoMotivoAfastamentoDao=e.get(A.n),this.usuarioDao=e.get(T.q),this.title=this.lex.translate("Afastamento"),this.form=this.fh.FormBuilder({observacoes:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},tipo_motivo_afastamento_id:{default:""}},this.cdRef,this.validate),this.join=["usuario","tipo_motivo_afastamento"]}isHoras(){return!(!this.form.controls.tipo_motivo_afastamento_id.value?.length||!this.tipoMotivoAfastamento?.selectedEntity?.horas)}loadData(e,o){var a=this;return(0,C.Z)(function*(){let i=Object.assign({},o.value);a.metadata?.consolidacao&&(a.consolidacao=a.metadata?.consolidacao,e.usuario_id=a.consolidacao.plano_trabalho.usuario_id,e.usuario=a.consolidacao.plano_trabalho?.usuario),yield Promise.all([a.usuario.loadSearch(e.usuario||i.usuario_id),a.tipoMotivoAfastamento.loadSearch(e.tipo_motivo_afastamento||i.tipo_motivo_afastamento_id)]),o.patchValue(a.util.fillForm(i,e))})()}initializeData(e){this.entity=new d.i,this.loadData(this.entity,e)}saveData(e){return new Promise((o,a)=>{let i=this.util.fill(new d.i,this.entity);i=this.util.fillForm(i,this.form.value),this.isHoras()||(i.data_inicio.setHours(0,0,0),i.data_fim.setHours(23,59,0),i.data_fim.setDate(i.data_fim.getDate())),o(i)})}get warning(){let e,o=this.util.asDate(this.form.controls.data_inicio.value),a=this.util.asDate(this.form.controls.data_fim.value);return this.consolidacao&&o&&a&&(this.util.daystamp(o)<this.util.daystamp(this.consolidacao.data_inicio)||this.util.daystamp(a)>this.util.daystamp(this.consolidacao.data_fim))&&(e="Aten\xe7\xe3o: Data da consolida\xe7\xe3o do plano \xe9 de "+this.util.getDateFormatted(this.consolidacao.data_inicio)+" a "+this.util.getDateFormatted(this.consolidacao.data_fim)),e}static#t=this.\u0275fac=function(o){return new(o||l)(t.Y36(t.zs3))};static#a=this.\u0275cmp=t.Xpm({type:l,selectors:[["app-afastamento-form"]],viewQuery:function(o,a){if(1&o&&(t.Gf(v.Q,5),t.Gf(Q,5),t.Gf(J,5)),2&o){let i;t.iGM(i=t.CRH())&&(a.editableForm=i.first),t.iGM(i=t.CRH())&&(a.tipoMotivoAfastamento=i.first),t.iGM(i=t.CRH())&&(a.usuario=i.first)}},features:[t.qOj],decls:12,vars:16,consts:[["type","warning",3,"message",4,"ngIf"],["initialFocus","usuario_id",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","usuario_id","required","",3,"size","disabled","dao"],["usuario",""],["controlName","tipo_motivo_afastamento_id","required","",3,"size","dao"],["tipoMotivoAfastamento",""],["label","In\xedcio","controlName","data_inicio",3,"date","size"],["label","Fim","controlName","data_fim",3,"date","size"],["label","Observa\xe7\xf5es","controlName","observacoes",3,"size","rows"],["type","warning",3,"message"]],template:function(o,a){1&o&&(t.YNc(0,z,1,1,"top-alert",0),t.TgZ(1,"editable-form",1),t.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),t.TgZ(2,"div",2),t._UZ(3,"input-search",3,4)(5,"input-search",5,6),t.qZA(),t.TgZ(7,"div",2),t._UZ(8,"input-datetime",7)(9,"input-datetime",8),t.qZA(),t.TgZ(10,"div",2),t._UZ(11,"input-textarea",9),t.qZA()()),2&o&&(t.Q6J("ngIf",null==a.warning?null:a.warning.length),t.xp6(1),t.Q6J("form",a.form)("disabled",a.formDisabled)("title",a.isModal?"":a.title),t.xp6(2),t.Q6J("size",6)("disabled",a.consolidacao?"true":void 0)("dao",a.usuarioDao),t.xp6(2),t.Q6J("size",6)("dao",a.tipoMotivoAfastamentoDao),t.xp6(3),t.Q6J("date",a.isHoras()?void 0:"")("size",6),t.xp6(1),t.Q6J("date",a.isHoras()?void 0:"")("size",6),t.xp6(2),t.Q6J("size",12)("rows",3),t.uIk("maxlength",250))},dependencies:[c.O5,v.Q,D.V,F.Q,Z.k,M.o]})}var O=s(73150),w=s(78509),I=s(57224),N=s(83351),U=s(57765),E=s(45512),b=s(42704);function L(n,e){1&n&&t._UZ(0,"toolbar")}function G(n,e){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const o=e.row;t.xp6(1),t.hij(" ",o.usuario.nome,"")}}function j(n,e){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const o=t.oxw().row;t.xp6(1),t.hij(" ","(c\xf3d. "+o.tipo_motivo_afastamento.codigo+")","")}}function B(n,e){if(1&n&&(t._UZ(0,"i"),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.YNc(3,j,2,1,"span",1)),2&n){const o=e.row;t.Tol(o.tipo_motivo_afastamento.icone),t.xp6(1),t.Udp("color",o.tipo_motivo_afastamento.cor),t.xp6(1),t.hij(" ",o.tipo_motivo_afastamento.nome,""),t.xp6(1),t.Q6J("ngIf",o.tipo_motivo_afastamento.codigo)}}function R(n,e){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const o=e.row,a=t.oxw();t.xp6(1),t.hij(" ",a.dao.getDateFormatted(o.data_inicio),"")}}function H(n,e){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const o=e.row,a=t.oxw();t.xp6(1),t.hij(" ",a.dao.getDateFormatted(o.data_fim),"")}}class u extends w.E{constructor(e){super(e,d.i,g.e),this.injector=e,this.listagemInicial=!0,this.filterWhere=o=>{let a=[],i=o.value;return i.usuario_id?.length&&i.tipo_motivo_afastamento_id?.length?(a.push(["usuario_id","==",i.usuario_id]),a.push(["tipo_motivo_afastamento_id","==",i.tipo_motivo_afastamento_id])):i.usuario_id?.length?a.push(["usuario_id","==",i.usuario_id]):i.tipo_motivo_afastamento_id?.length?a.push(["tipo_motivo_afastamento_id","==",i.tipo_motivo_afastamento_id]):this.dao?.validDateTime(i.data_inicio)&&this.dao?.validDateTime(i.data_fim)&&!this.listagemInicial&&a.push(this.dao?.intersectionWhere("data_inicio","data_fim",this.util.startOfDay(i.data_inicio),this.util.startOfDay(i.data_fim))),a},this.join=["tipo_motivo_afastamento:id, nome","usuario: id, nome"],this.tipoMotivoAfastamentoDao=e.get(A.n),this.usuarioDao=e.get(T.q),this.title=this.lex.translate("Afastamentos"),this.code="MOD_AFT",this.filter=this.fh.FormBuilder({observacoes:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},tipo_motivo_afastamento_id:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_AFT_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}filtro(){this.listagemInicial=!1}static#t=this.\u0275fac=function(o){return new(o||u)(t.Y36(t.zs3))};static#a=this.\u0275cmp=t.Xpm({type:u,selectors:[["app-afastamento-list"]],viewQuery:function(o,a){if(1&o&&t.Gf(O.M,5),2&o){let i;t.iGM(i=t.CRH())&&(a.grid=i.first)}},features:[t.qOj],decls:26,vars:32,consts:[[3,"dao","add","title","orderBy","groupBy","join","hasAdd","hasEdit"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","tipo_motivo_afastamento_id",3,"size","control","dao"],["tipoMotivoAfastamento",""],["date","","label","In\xedcio","controlName","data_inicio",3,"size","click"],["date","","label","Fim","controlName","data_fim",3,"size","click"],[3,"title","template"],["columnUsuario",""],["columnMotivoAfastamento",""],["title","In\xedcio",3,"template"],["columnInicioAfastamento",""],["title","Fim",3,"template"],["columnFimAfastamento",""],["title","Observa\xe7\xf5es","field","observacoes"],["type","options",3,"onEdit","options"],[3,"rows"]],template:function(o,a){if(1&o&&(t.TgZ(0,"grid",0),t.YNc(1,L,1,0,"toolbar",1),t.TgZ(2,"filter",2)(3,"div",3),t._UZ(4,"input-search",4,5)(6,"input-search",6,7),t.TgZ(8,"input-datetime",8),t.NdJ("click",function(){return a.filtro()}),t.qZA(),t.TgZ(9,"input-datetime",9),t.NdJ("click",function(){return a.filtro()}),t.qZA()()(),t.TgZ(10,"columns")(11,"column",10),t.YNc(12,G,2,1,"ng-template",null,11,t.W1O),t.qZA(),t.TgZ(14,"column",10),t.YNc(15,B,4,6,"ng-template",null,12,t.W1O),t.qZA(),t.TgZ(17,"column",13),t.YNc(18,R,2,1,"ng-template",null,14,t.W1O),t.qZA(),t.TgZ(20,"column",15),t.YNc(21,H,2,1,"ng-template",null,16,t.W1O),t.qZA(),t._UZ(23,"column",17)(24,"column",18),t.qZA(),t._UZ(25,"pagination",19),t.qZA()),2&o){const i=t.MAs(13),W=t.MAs(16),X=t.MAs(19),x=t.MAs(22);t.Q6J("dao",a.dao)("add",a.add)("title",a.isModal?"":a.title)("orderBy",a.orderBy)("groupBy",a.groupBy)("join",a.join)("hasAdd",a.auth.hasPermissionTo("MOD_AFT_INCL"))("hasEdit",a.auth.hasPermissionTo("MOD_AFT_EDT")),t.xp6(1),t.Q6J("ngIf",!a.selectable),t.xp6(1),t.Q6J("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",a.filterCollapsed)("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL")),t.xp6(2),t.Q6J("size",3)("control",a.filter.controls.usuario_id)("dao",a.usuarioDao),t.xp6(2),t.Q6J("size",3)("control",a.filter.controls.tipo_motivo_afastamento_id)("dao",a.tipoMotivoAfastamentoDao),t.xp6(2),t.Q6J("size",3),t.xp6(1),t.Q6J("size",3),t.xp6(2),t.Q6J("title",a.lex.translate("Usu\xe1rio"))("template",i),t.xp6(3),t.Q6J("title",a.lex.translate("Motivo"))("template",W),t.xp6(3),t.Q6J("template",X),t.xp6(3),t.Q6J("template",x),t.xp6(4),t.Q6J("onEdit",a.edit)("options",a.options),t.xp6(1),t.Q6J("rows",a.rowsLimit)}},dependencies:[c.O5,O.M,I.a,N.b,U.z,E.n,b.Q,D.V,Z.k]})}const Y=[{path:"",component:u,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Afastamentos"}},{path:"new",component:l,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Afastamento",modal:!0}},{path:":id/edit",component:l,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Afastamento",modal:!0}},{path:":id/consult",component:l,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Afastamento",modal:!0}}];class f{static#t=this.\u0275fac=function(o){return new(o||f)};static#a=this.\u0275mod=t.oAB({type:f});static#o=this.\u0275inj=t.cJS({imports:[_.Bz.forChild(Y),_.Bz]})}var P=s(31415),S=s(72133);class p{static#t=this.\u0275fac=function(o){return new(o||p)};static#a=this.\u0275mod=t.oAB({type:p});static#o=this.\u0275inj=t.cJS({imports:[c.ez,P.K,S.UX,f]})}}}]);