"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[38],{31313:(y,m,i)=>{i.d(m,{g:()=>l});var d=i(64368);class l extends d.X{constructor(v){super(),this.data_avaliacao=new Date,this.nota=0,this.justificativa=null,this.recurso=null,this.justificativas=[],this.entregas_checklist=[],this.avaliador_id="",this.plano_trabalho_consolidacao_id=null,this.plano_entrega_id=null,this.tipo_avaliacao_id="",this.initialization(v)}}},56486:(y,m,i)=>{i.d(m,{M:()=>I});var g,d=i(72133),l=i(20755),C=i(76733),v=i(40052),T=i(95489);function Z(u,p){if(1&u&&(l.TgZ(0,"div",2),l._UZ(1,"input-rate",3),l.qZA()),2&u){const r=l.oxw();l.xp6(1),l.Q6J("starMargin",1)("align",r.align)("size",12)("control",r.fakeControl)}}function N(u,p){if(1&u&&l._UZ(0,"badge",5),2&u){const r=l.oxw(2);l.Q6J("icon",r.tipoAvaliacaoNota.icone)("label",r.tipoAvaliacaoNota.nota)}}function x(u,p){if(1&u&&l.YNc(0,N,1,2,"badge",4),2&u){const r=l.oxw();l.Q6J("ngIf",r.tipoAvaliacaoNota)}}class I{constructor(){this.align="center",this.items=[],this.fakeControl=new d.NI,this._tipoAvaliacao=void 0}set tipoAvaliacao(p){this._tipoAvaliacao!=p&&(this._tipoAvaliacao=p,this.items=(this._tipoAvaliacao?.notas||[]).map(r=>Object.assign({},{key:r.nota,value:r.nota,hint:r.descricao,icon:r.icone})),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(r=>r.nota==this.nota))}get tipoAvaliacao(){return this._tipoAvaliacao}set nota(p){p!=this.fakeControl.value&&(this.fakeControl.setValue(p),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(r=>r.nota==this.nota))}get nota(){return this.fakeControl.value}get isQuantitativo(){return"QUANTITATIVO"==this.tipoAvaliacao?.tipo}get isQualitativo(){return"QUALITATIVO"==this.tipoAvaliacao?.tipo}}(g=I).\u0275fac=function(p){return new(p||g)},g.\u0275cmp=l.Xpm({type:g,selectors:[["avaliar-nota-badge"]],inputs:{align:"align",tipoAvaliacao:"tipoAvaliacao",nota:"nota"},decls:3,vars:2,consts:[["class","row",4,"ngIf","ngIfElse"],["qualitativo",""],[1,"row"],["small","","disabled","",3,"starMargin","align","size","control"],["disabled","",3,"icon","label",4,"ngIf"],["disabled","",3,"icon","label"]],template:function(p,r){if(1&p&&(l.YNc(0,Z,2,4,"div",0),l.YNc(1,x,1,1,"ng-template",null,1,l.W1O)),2&p){const O=l.MAs(2);l.Q6J("ngIf",r.isQuantitativo)("ngIfElse",O)}},dependencies:[C.O5,v.i,T.F]})},90038:(y,m,i)=>{i.d(m,{w:()=>w});var d=i(8239),l=i(74040),C=i(1184),v=i(20207),T=i(31313),g=i(41095),Z=i(17046),N=i(39190),x=i(92307),I=i(77447),u=i(31021),p=i(59173),r=i(64368);class O extends r.X{constructor(e){super(),this.checklist=[],this.avaliacao_id="",this.plano_trabalho_entrega_id=null,this.plano_entrega_entrega_id=null,this.initialization(e)}}var f,b,j=i(92214),a=i(20755),h=i(76733),D=i(73150),U=i(57224),z=i(83351),Y=i(88820),F=i(74508),k=i(42984),R=i(25560),V=i(95489),B=i(2729),W=i(69756),H=i(40052),Q=i(72133),q=i(70645),G=i(38544);function L(n,e){if(1&n&&a._UZ(0,"i"),2&n){const t=a.oxw().$implicit;a.Gre("bi ",t.icon,"")}}function S(n,e){if(1&n){const t=a.EpF();a.ynx(0),a.TgZ(1,"div",3),a.NdJ("click",function(){const c=a.CHM(t).$implicit,_=a.oxw();return a.KtG(_.onClick(c))}),a.YNc(2,L,1,3,"i",4),a.TgZ(3,"span"),a._uU(4),a.qZA()(),a.BQk()}if(2&n){const t=e.$implicit,o=a.oxw();a.xp6(1),a.Udp("border-color",t.color)("background-color",o.isChecked(t)?t.color:"")("color",t.color&&o.isChecked(t)?o.util.contrastColor(t.color):t.color),a.ekj("button_avaliation_disabled",o.isDisabled),a.Q6J("id",o.generatedId(o.controlName)+"_"+t.key),a.xp6(1),a.Q6J("ngIf",t.icon),a.xp6(2),a.Oqu(t.value)}}class J extends q.M{set value(e){e!=this._value&&(this._value=e,this.detectChanges(),this.control?.setValue(e),this.change&&this.change(e))}get value(){return this._value}set control(e){this._control=e}get control(){return this.getControl()}set size(e){this.setSize(e)}get size(){return this.getSize()}constructor(e){super(e),this.injector=e,this.class="form-group",this.hostClass="",this.labelPosition="top",this.controlName=null,this.icon="bi bi-toggle-on",this.label="",this.labelInfo="",this.bold=!1,this.loading=!1,this.items=[],this._value=""}ngOnInit(){super.ngOnInit()}isChecked(e){return this.value==e.key}onClick(e){this.isDisabled||(this.value=e.key)}ngAfterViewInit(){super.ngAfterViewInit(),this.control&&(this.value=this.control.value,this.control.valueChanges.subscribe(e=>{this.value=e}))}}function K(n,e){if(1&n){const t=a.EpF();a.TgZ(0,"input-rate",2),a.NdJ("change",function(s){a.CHM(t);const c=a.oxw();return a.KtG(c.onValueChange(s))}),a.qZA()}if(2&n){const t=a.oxw();a.Q6J("disabled",t.disabled)("size",12)("label",t.label)("control",t.control)}}function X(n,e){if(1&n&&a._UZ(0,"input-choose",3),2&n){const t=a.oxw();a.Q6J("label",t.label)("control",t.control)("disabled",t.disabled)("items",t.items)("change",t.onValueChange.bind(t))}}(f=J).\u0275fac=function(e){return new(e||f)(a.Y36(a.zs3))},f.\u0275cmp=a.Xpm({type:f,selectors:[["input-choose"]],hostVars:2,hostBindings:function(e,t){2&e&&a.Tol(t.class)},inputs:{hostClass:"hostClass",labelPosition:"labelPosition",controlName:"controlName",disabled:"disabled",icon:"icon",label:"label",labelInfo:"labelInfo",labelClass:"labelClass",bold:"bold",loading:"loading",items:"items",form:"form",source:"source",path:"path",required:"required",change:"change",value:"value",control:"control",size:"size"},features:[a._Bn([],[{provide:Q.gN,useExisting:Q.sg}]),a.qOj],decls:3,vars:13,consts:[[3,"labelPosition","labelClass","controlName","required","control","loading","disabled","label","labelInfo","icon","bold","isRadio"],[1,"d-flex","flex-wrap","justify-content-center","mt-3"],[4,"ngFor","ngForOf"],[1,"button_avaliation","text-center","mb-3",3,"id","click"],[3,"class",4,"ngIf"]],template:function(e,t){1&e&&(a.TgZ(0,"input-container",0)(1,"div",1),a.YNc(2,S,5,11,"ng-container",2),a.qZA()()),2&e&&(a.Q6J("labelPosition",t.labelPosition)("labelClass",t.labelClass)("controlName",t.controlName)("required",t.required)("control",t.control)("loading",t.loading)("disabled",t.disabled)("label",t.label)("labelInfo",t.labelInfo)("icon",t.icon)("bold",t.bold)("isRadio",!0),a.xp6(2),a.Q6J("ngForOf",t.items))},dependencies:[h.sg,h.O5,G.h],styles:[".label-input-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.button_avaliation_disabled[_ngcontent-%COMP%]{cursor:default!important}.button_avaliation_disabled[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]:before{animation:none!important}.button_avaliation[_ngcontent-%COMP%]{border:3px solid;padding:5px 10px;cursor:pointer;border-radius:4px;margin-right:10px;max-width:150px;min-width:100px}.button_avaliation[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.8rem}.button_avaliation[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px}.button_avaliation[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_bouncetop .3s alternate ease infinite}@keyframes _ngcontent-%COMP%_bouncetop{0%{-webkit-transform:translateY(0)}to{-webkit-transform:translateY(3px)}}"]});class P{constructor(){this.class="form-group",this.label="Qual nota?",this.items=[],this._size=0,this._control=void 0,this._tipoAvaliacao=void 0}set tipoAvaliacao(e){if(this._tipoAvaliacao!=e){this._tipoAvaliacao=e;let t=this._tipoAvaliacao?.notas;t.sort((o,s)=>s.sequencia-o.sequencia),this.items=(t||[]).map(o=>Object.assign({},{key:o.nota,value:o.nota,hint:o.descricao,icon:o.icone,color:o.cor}))}}get tipoAvaliacao(){return this._tipoAvaliacao}set control(e){this._control!=e&&(this._control=e,e&&(e.valueChanges.subscribe(this.updateNota.bind(this)),this.updateNota()))}get control(){return this._control}set size(e){e!=this._size&&(this._size=e,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+e)}get size(){return this._size||12}get isQuantitativo(){return"QUANTITATIVO"==this.tipoAvaliacao?.tipo}get isQualitativo(){return"QUALITATIVO"==this.tipoAvaliacao?.tipo}updateNota(){this.nota=this.tipoAvaliacao?.notas.find(e=>e.nota==this.control?.value)}onValueChange(e){this.control?.updateValueAndValidity(),this.change&&this.change(this.control?.value)}}(b=P).\u0275fac=function(e){return new(e||b)},b.\u0275cmp=a.Xpm({type:b,selectors:[["avaliar-nota-input"]],hostVars:2,hostBindings:function(e,t){2&e&&a.Tol(t.class)},inputs:{label:"label",disabled:"disabled",change:"change",tipoAvaliacao:"tipoAvaliacao",control:"control",size:"size"},decls:3,vars:2,consts:[[3,"disabled","size","label","control","change",4,"ngIf","ngIfElse"],["qualitativo",""],[3,"disabled","size","label","control","change"],[3,"label","control","disabled","items","change"]],template:function(e,t){if(1&e&&(a.YNc(0,K,1,4,"input-rate",0),a.YNc(1,X,1,5,"ng-template",null,1,a.W1O)),2&e){const o=a.MAs(2);a.Q6J("ngIf",t.isQuantitativo)("ngIfElse",o)}},dependencies:[h.O5,H.i,J]});var A,$=i(56486);const aa=["notaInput"],ta=["justificativas"];function oa(n,e){if(1&n&&(a.TgZ(0,"separator",10),a._UZ(1,"input-textarea",11),a.qZA()),2&n){const t=a.oxw();a.xp6(1),a.Q6J("size",12)("disabled",t.recurso?void 0:"true")("rows",2)("control",t.form.controls.recurso)}}function ea(n,e){if(1&n&&(a.TgZ(0,"div",12)(1,"button",13),a._UZ(2,"i"),a.TgZ(3,"strong",14),a._uU(4),a.qZA(),a._uU(5),a.qZA()()),2&n){const t=a.oxw();a.xp6(1),a.Akn(t.styleButtonNota),a.xp6(1),a.Tol(t.nota.icone),a.Udp("color",t.nota.cor||"black"),a.xp6(2),a.Oqu(t.nota.nota),a.xp6(1),a.hij(" - ",t.nota.descricao," ")}}function na(n,e){if(1&n&&(a.TgZ(0,"div",2),a._UZ(1,"input-multitoggle",15,16),a.qZA()),2&n){const t=a.oxw();a.xp6(1),a.Q6J("disabled",t.recurso?"true":void 0)("control",t.form.controls.justificativas)("label",t.nota.pergunta)("items",t.tiposJustificativas)}}function ia(n,e){if(1&n&&(a.TgZ(0,"separator",17),a._UZ(1,"input-textarea",18),a.qZA()),2&n){const t=a.oxw();a.xp6(1),a.Q6J("disabled",t.recurso?"true":void 0)("size",12)("rows",2)("control",t.form.controls.justificativa)}}function la(n,e){if(1&n&&a._uU(0),2&n){const t=e.row,o=a.oxw(2);a.hij(" ",o.util.getDateFormatted(o.isPlanoEntrega?t.data_inicio:null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)," ")}}function sa(n,e){if(1&n&&a._uU(0),2&n){const t=e.row,o=a.oxw(2);a.hij(" ",o.util.getDateFormatted(o.isPlanoEntrega?t.data_fim:null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim)," ")}}function ra(n,e){if(1&n&&a._UZ(0,"badge",32),2&n){const t=e.row,o=a.oxw(2);a.Q6J("icon",o.entityService.getIcon("Entrega"))("label",t.descricao)}}function ca(n,e){if(1&n&&a._UZ(0,"badge",35),2&n){const t=e.row;a.Q6J("label",t.forca_trabalho+"%")}}function pa(n,e){if(1&n&&(a.TgZ(0,"column",33),a.YNc(1,ca,1,1,"ng-template",null,34,a.W1O),a.qZA()),2&n){const t=a.MAs(2);a.Q6J("template",t)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada")}}function ua(n,e){if(1&n&&a._UZ(0,"badge",38)(1,"br")(2,"badge",39),2&n){const t=e.row,o=a.oxw(3);a.Q6J("textValue",o.planoEntregaService.getValorMeta(t)),a.xp6(2),a.Q6J("textValue",o.planoEntregaService.getValorRealizado(t))}}function da(n,e){if(1&n&&(a.TgZ(0,"column",36),a.YNc(1,ua,3,2,"ng-template",null,37,a.W1O),a.qZA()),2&n){const t=a.MAs(2);a.Q6J("title","Meta\nRealizado")("width",200)("template",t)}}function ga(n,e){if(1&n&&a._UZ(0,"progress-bar",42),2&n){const t=e.row;a.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}function _a(n,e){if(1&n&&(a.TgZ(0,"column",40),a.YNc(1,ga,1,2,"ng-template",null,41,a.W1O),a.qZA()),2&n){const t=a.MAs(2);a.Q6J("width",200)("template",t)}}function ma(n,e){if(1&n&&a._UZ(0,"input-switch",45),2&n){const t=e.row,o=e.column,s=a.oxw(3);a.Q6J("source",t._metadata)("path",o.metadata.key)("disabled",s.recurso?"true":void 0)}}function va(n,e){if(1&n&&(a.TgZ(0,"column",43),a.YNc(1,ma,1,3,"ng-template",null,44,a.W1O),a.qZA()),2&n){const t=e.$implicit,o=a.MAs(2);a.Q6J("title",t.value)("template",o)("metadata",t)}}function ha(n,e){if(1&n&&(a.TgZ(0,"separator",19)(1,"grid",20,21)(3,"columns")(4,"column",22),a.YNc(5,la,1,1,"ng-template",null,23,a.W1O),a.qZA(),a.TgZ(7,"column",24),a.YNc(8,sa,1,1,"ng-template",null,25,a.W1O),a.qZA(),a.TgZ(10,"column",26),a.YNc(11,ra,1,2,"ng-template",null,27,a.W1O),a.qZA(),a.YNc(13,pa,3,2,"column",28),a.YNc(14,da,3,3,"column",29),a.YNc(15,_a,3,2,"column",30),a.YNc(16,va,3,3,"column",31),a.qZA()()()),2&n){const t=a.MAs(6),o=a.MAs(9),s=a.MAs(12),c=a.oxw();a.Q6J("title",c.lex.translate("Entregas"))("collapsed",!c.checklist.length),a.xp6(1),a.Q6J("items",c.entregas)("minHeight",0),a.xp6(3),a.Q6J("template",t),a.xp6(3),a.Q6J("template",o),a.xp6(3),a.Q6J("template",s),a.xp6(3),a.Q6J("ngIf",c.isConsolidacao),a.xp6(1),a.Q6J("ngIf",c.isPlanoEntrega),a.xp6(1),a.Q6J("ngIf",c.isPlanoEntrega),a.xp6(1),a.Q6J("ngForOf",c.checklist)}}function fa(n,e){if(1&n&&(a.TgZ(0,"div",56)(1,"div",57),a._UZ(2,"profile-picture",58),a.qZA(),a.TgZ(3,"div",59)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&n){const t=e.row;a.xp6(2),a.Q6J("url",t.avaliador.url_foto||"")("size",40)("hint",t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.apelido||"")}}function ba(n,e){if(1&n&&a._UZ(0,"badge",32),2&n){const t=e.$implicit,o=a.oxw(3);a.Q6J("icon",o.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function Aa(n,e){if(1&n&&(a._UZ(0,"avaliar-nota-badge",60),a.TgZ(1,"small"),a._uU(2),a.qZA(),a.TgZ(3,"div",61),a.YNc(4,ba,1,2,"badge",62),a.qZA()),2&n){const t=e.row;a.Q6J("align","left")("tipoAvaliacao",t.tipo_avaliacao)("nota",t.nota),a.xp6(2),a.Oqu(t.justificativa||""),a.xp6(2),a.Q6J("ngForOf",t.justificativas)}}function Ca(n,e){if(1&n&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&n){const t=e.row;a.xp6(1),a.Oqu(t.recurso||"")}}function Ta(n,e){1&n&&a._UZ(0,"badge",65)}function xa(n,e){1&n&&a._UZ(0,"badge",66)}function Ia(n,e){if(1&n&&(a.TgZ(0,"div",61),a.YNc(1,Ta,1,0,"badge",63),a.YNc(2,xa,1,0,"badge",64),a.qZA()),2&n){const t=e.row,o=a.oxw(2);a.xp6(1),a.Q6J("ngIf",null==t.recurso?null:t.recurso.length),a.xp6(1),a.Q6J("ngIf",t.id==(null==o.entity?null:o.entity.id))}}function Ea(n,e){if(1&n&&(a.TgZ(0,"separator",46)(1,"grid",20,21)(3,"columns"),a._UZ(4,"column",47),a.TgZ(5,"column",48),a.YNc(6,fa,9,5,"ng-template",null,49,a.W1O),a.qZA(),a.TgZ(8,"column",50),a.YNc(9,Aa,5,5,"ng-template",null,51,a.W1O),a.qZA(),a.TgZ(11,"column",52),a.YNc(12,Ca,2,1,"ng-template",null,53,a.W1O),a.qZA(),a.TgZ(14,"column",54),a.YNc(15,Ia,3,2,"ng-template",null,55,a.W1O),a.qZA()()()()),2&n){const t=a.MAs(7),o=a.MAs(10),s=a.MAs(13),c=a.MAs(16),_=a.oxw();a.xp6(1),a.Q6J("items",_.avaliacoes)("minHeight",0),a.xp6(4),a.Q6J("template",t),a.xp6(3),a.Q6J("title","Nota\nJustificativas")("template",o),a.xp6(3),a.Q6J("template",s),a.xp6(3),a.Q6J("template",c)}}class w extends C.F{constructor(e){super(e,T.g,g.w),this.injector=e,this.recurso=!1,this.tiposJustificativas=[],this.entregas=[],this.checklist=[],this.avaliacoes=[],this.modalWidth=900,this.joinConsolidacao=[],this.joinPlanoEntrega=[],this.joinPrograma=["tipo_avaliacao_plano_trabalho.notas.justificativas","tipo_avaliacao_plano_entrega.notas.justificativas"],this.joinPlanoEntregaEntrega=["entrega","objetivos.objetivo","processos.processo","unidade","comentarios.usuario:id,nome,apelido"],this.joinPlanoTrabalhoEntrega=["entrega","planoEntregaEntrega:id,descricao,data_inicio,data_fim,plano_entrega_id,entrega_id","planoEntregaEntrega.entrega:id,nome,tipo_indicador"],this.validate=(t,o)=>{let s=null;return this.recurso?"recurso"==o&&!t.value?.length&&(s="Obrigat\xf3rio"):"nota"==o&&([null,void 0].includes(t.value)||!this.nota)&&(s="Obrigat\xf3rio"),s},this.formValidation=t=>{const o=t.value;if(!this.recurso&&this.nota?.justifica&&!o.justificativa?.length&&!o.justificativas?.length)return"Para a nota seleciona ser\xe1 necess\xe1rio ao menos uma justificativa."},this.programaDao=e.get(j.w),this.planoTrabalhoEntregaDao=e.get(p.w),this.tipoAvaliacaoDao=e.get(v.r),this.consolidacaoDao=e.get(Z.E),this.planoEntregaDao=e.get(N.r),this.planoEntregaEntregaDao=e.get(u.K),this.planoEntregaService=e.get(I.f),this.join=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.form=this.fh.FormBuilder({nota:{default:null},recurso:{default:""},justificativas:{default:[]},justificativa:{default:""},arquivar:{default:!0}},this.cdRef,this.validate)}loadData(e,t){var o=this;return(0,d.Z)(function*(){let s=Object.assign({},t.value);o.loading=!0;try{o.consolidacao=o.urlParams?.has("consolidacaoId")||o.metadata?.consolidacao?o.metadata?.consolidacao||(yield o.consolidacaoDao.getById(o.urlParams.get("consolidacaoId"),o.joinConsolidacao)):void 0,o.planoEntrega=o.urlParams?.has("planoEntregaId")||o.metadata?.planoEntrega?o.metadata?.planoEntrega||(yield o.planoEntregaDao.getById(o.urlParams.get("planoEntregaId"),o.joinPlanoEntrega)):void 0,o.avaliacoes=yield o.dao.query({where:o.consolidacao?[["plano_trabalho_consolidacao_id","==",o.consolidacao.id]]:[["plano_entrega_id","==",o.planoEntrega?.id]],join:o.join,orderBy:[["data_avaliacao","desc"]]}).asPromise(),o.entity=o.avaliacoes.find(c=>c.id==(o.consolidacao||o.planoEntrega)?.avaliacao_id)||o.entity,o.programa=o.metadata?.programa||(yield o.programaDao.query({where:[["id","==",o.consolidacao?.plano_trabalho?.programa_id||o.planoEntrega?.programa_id]],join:o.joinPrograma}).firstOrDefault(o.consolidacao?.plano_trabalho?.programa||o.planoEntrega?.programa)),o.origem=o.consolidacao?"CONSOLIDACAO":"PLANO_ENTREGA",o.tipoAvaliacao=o.isConsolidacao?o.programa?.tipo_avaliacao_plano_trabalho:o.programa?.tipo_avaliacao_plano_entrega,o.checklist=(o.isConsolidacao?o.programa.checklist_avaliacao_entregas_plano_trabalho:o.programa.checklist_avaliacao_entregas_plano_entrega)||[],o.recurso=!!o.metadata?.recurso,o.entregas=o.metadata?.entregas||(o.isConsolidacao?yield o.planoTrabalhoEntregaDao.query({where:[["plano_trabalho_id","==",o.consolidacao.plano_trabalho_id]],join:o.joinPlanoTrabalhoEntrega}).asPromise():yield o.planoEntregaEntregaDao.query({where:[["plano_entrega_id","==",o.planoEntrega.id]],join:o.joinPlanoEntregaEntrega}).asPromise()),o.entregas.forEach(c=>{c._metadata={},o.checklist.forEach(_=>{let M=o.entity?.entregas_checklist.find(E=>c.id==(E.plano_entrega_entrega_id||E.plano_trabalho_entrega_id));c._metadata[_.key]=!M||!!M.checklist.find(E=>E.id==_.key)?.checked})}),o.usuario=o.consolidacao?.plano_trabalho?.usuario,s=o.util.fillForm(s,o.entity),o.form.controls.nota.setValue(s.nota),o.onNotaChange(new Event("change")),t.patchValue(s)}finally{o.loading=!1}})()}initializeData(e){var t=this;return(0,d.Z)(function*(){t.entity=new T.g,yield t.loadData(t.entity,e)})()}get nota(){return this.notaInput?.nota}get labelNota(){return"Como foi o trabalho "+(this.isConsolidacao?"de "+this.util.apelidoOuNome(this.usuario):"da "+this.planoEntrega?.unidade?.sigla)+"?"}get styleButtonNota(){const e=this.util.colorHexToRGB(this.nota?.cor||"#000000");return"background-color: rgba("+e.r+","+e.g+","+e.b+", 0.2);"}get isConsolidacao(){return"CONSOLIDACAO"==this.origem}get isPlanoEntrega(){return"PLANO_ENTREGA"==this.origem}onNotaChange(e){this.tiposJustificativas=this.nota?.justificativas?.map(t=>({key:t.tipo_justificativa_id,value:t.tipo_justificativa.nome||""}))||[]}saveData(e){var t=this;return(0,d.Z)(function*(){return t.recurso?(yield t.dao.recorrer(t.consolidacao.avaliacao,e.recurso),new x.R(t.consolidacao.avaliacao)):(t.entity.id="",t.entity.data_avaliacao=t.auth.hora,t.entity.nota=e.nota,t.entity.justificativa=e.justificativa,t.entity.justificativas=e.justificativas,t.entity.avaliador_id=t.auth.usuario.id,t.entity.plano_entrega_id=t.planoEntrega?.id||null,t.entity.plano_trabalho_consolidacao_id=t.consolidacao?.id||null,t.entity.tipo_avaliacao_id=t.tipoAvaliacao.id,t.checklist.length&&(t.entity.entregas_checklist=t.entregas.map(o=>new O({plano_trabalho_entrega_id:t.consolidacao?o.id:null,plano_entrega_entrega_id:t.planoEntrega?o.id:null,checklist:t.checklist.map(s=>({id:s.key,texto:s.value,checked:!!o._metadata[s.key]}))}))),new x.R(yield t.dao.save(t.entity,t.join)))})()}}(A=w).\u0275fac=function(e){return new(e||A)(a.Y36(a.zs3))},A.\u0275cmp=a.Xpm({type:A,selectors:[["avaliar"]],viewQuery:function(e,t){if(1&e&&(a.Gf(aa,5),a.Gf(ta,5),a.Gf(l.Q,5)),2&e){let o;a.iGM(o=a.CRH())&&(t.notaInput=o.first),a.iGM(o=a.CRH())&&(t.justificativas=o.first),a.iGM(o=a.CRH())&&(t.editableForm=o.first)}},features:[a.qOj],decls:10,vars:14,consts:[[3,"form","disabled","submit","cancel"],["title","Recurso",4,"ngIf"],[1,"row"],[3,"size","disabled","tipoAvaliacao","label","change","control"],["notaInput",""],["class","d-flex justify-content-center",4,"ngIf"],["class","row",4,"ngIf"],["title","Justificativa adicional?","icon","bi bi-chat-left-quote","collapse","",4,"ngIf"],["collapse","",3,"title","collapsed",4,"ngIf"],["title","Hist\xf3rico de avalia\xe7\xf5es","collapse","",4,"ngIf"],["title","Recurso"],["label","Texto do recurso","controlName","recurso",3,"size","disabled","rows","control"],[1,"d-flex","justify-content-center"],["type","button",1,"pe-none","btn"],[1,"ms-1"],[3,"disabled","control","label","items"],["justificativas",""],["title","Justificativa adicional?","icon","bi bi-chat-left-quote","collapse",""],["label","Justificativa","controlName","justificativa",3,"disabled","size","rows","control"],["collapse","",3,"title","collapsed"],[3,"items","minHeight"],["gridEntregas",""],["title","In\xedcio",3,"template"],["culumnDataInicio",""],["title","Fim",3,"template"],["columnDataFim",""],["title","Entrega",3,"template"],["columnEntrega",""],["title","% CHD Planejado",3,"template","titleHint",4,"ngIf"],[3,"title","width","template",4,"ngIf"],["title","Progresso",3,"width","template",4,"ngIf"],[3,"title","template","metadata",4,"ngFor","ngForOf"],[3,"icon","label"],["title","% CHD Planejado",3,"template","titleHint"],["columnForcaTrabalho",""],["color","light",3,"label"],[3,"title","width","template"],["columnMetaRealizado",""],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],["title","Progresso",3,"width","template"],["columnProgresso",""],["color","success",3,"value","goal"],[3,"title","template","metadata"],["columnCheck",""],[3,"source","path","disabled"],["title","Hist\xf3rico de avalia\xe7\xf5es","collapse",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],["columnAvaliador",""],[3,"title","template"],["columnNotaJustificativa",""],["title","Recurso",3,"template"],["columnRecurso",""],["title","Status",3,"template"],["columnStatus",""],[1,"avaliador"],[1,"avaliador-profile"],[3,"url","size","hint"],[1,"avaliador-nome"],[3,"align","tipoAvaliacao","nota"],[1,"one-per-line"],[3,"icon","label",4,"ngFor","ngForOf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(e,t){1&e&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),a.YNc(1,oa,2,4,"separator",1),a.TgZ(2,"div",2),a._UZ(3,"avaliar-nota-input",3,4),a.qZA(),a.YNc(5,ea,6,8,"div",5),a.YNc(6,na,3,4,"div",6),a.YNc(7,ia,2,4,"separator",7),a.YNc(8,ha,17,11,"separator",8),a.YNc(9,Ea,17,7,"separator",9),a.qZA()),2&e&&(a.Q6J("form",t.form)("disabled",t.formDisabled),a.xp6(1),a.Q6J("ngIf",t.recurso||(null==t.form.controls.recurso||null==t.form.controls.recurso.value?null:t.form.controls.recurso.value.length)),a.xp6(2),a.Q6J("size",12)("disabled",t.recurso?"true":void 0)("tipoAvaliacao",t.tipoAvaliacao)("label",t.labelNota)("change",t.onNotaChange.bind(t))("control",t.form.controls.nota),a.xp6(2),a.Q6J("ngIf",t.nota),a.xp6(1),a.Q6J("ngIf",t.nota),a.xp6(1),a.Q6J("ngIf",t.nota),a.xp6(1),a.Q6J("ngIf",t.entregas.length),a.xp6(1),a.Q6J("ngIf",t.avaliacoes.length))},dependencies:[h.sg,h.O5,D.M,U.a,z.b,l.Q,Y.a,F.Q,k.d,R.N,V.F,B.q,W.R,P,$.M],styles:[".avaliador[_ngcontent-%COMP%]{display:table}.avaliador-profile[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;display:table-cell}.avaliador-nome[_ngcontent-%COMP%]{display:table-cell;min-width:100px}"]})}}]);