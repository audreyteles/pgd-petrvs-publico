"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[38],{1313:(N,_,l)=>{l.d(_,{g:()=>r});var g=l(4368);class r extends g.X{constructor(m){super(),this.data_avaliacao=new Date,this.nota=0,this.justificativa=null,this.recurso=null,this.justificativas=[],this.entregas_checklist=[],this.avaliador_id="",this.plano_trabalho_consolidacao_id=null,this.plano_entrega_id=null,this.tipo_avaliacao_id="",this.tipo_avaliacao_nota_id="",this.initialization(m)}}},6486:(N,_,l)=>{l.d(_,{M:()=>b});var g=l(2133),r=l(755),v=l(6733),m=l(52),f=l(5489);function T(p,A){if(1&p&&(r.TgZ(0,"div",2),r._UZ(1,"input-rate",3),r.qZA()),2&p){const c=r.oxw();r.xp6(1),r.Q6J("starMargin",1)("align",c.align)("size",12)("control",c.fakeControl)}}function x(p,A){if(1&p&&r._UZ(0,"badge",5),2&p){const c=r.oxw(2);r.Q6J("icon",c.tipoAvaliacaoNota.icone)("label",c.tipoAvaliacaoNota.nota)}}function I(p,A){if(1&p&&r.YNc(0,x,1,2,"badge",4),2&p){const c=r.oxw();r.Q6J("ngIf",c.tipoAvaliacaoNota)}}let b=(()=>{class p{constructor(){this.align="center",this.items=[],this.fakeControl=new g.NI,this._tipoAvaliacao=void 0}set tipoAvaliacao(c){this._tipoAvaliacao!=c&&(this._tipoAvaliacao=c,this.items=(this._tipoAvaliacao?.notas||[]).map(d=>Object.assign({},{key:d.nota,value:d.nota,hint:d.descricao,icon:d.icone})),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(d=>d.nota==this.nota))}get tipoAvaliacao(){return this._tipoAvaliacao}set nota(c){c!=this.fakeControl.value&&(this.fakeControl.setValue(c),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(d=>d.nota==this.nota))}get nota(){return this.fakeControl.value}get isQuantitativo(){return"QUANTITATIVO"==this.tipoAvaliacao?.tipo}get isQualitativo(){return"QUALITATIVO"==this.tipoAvaliacao?.tipo}static#a=this.\u0275fac=function(d){return new(d||p)};static#t=this.\u0275cmp=r.Xpm({type:p,selectors:[["avaliar-nota-badge"]],inputs:{align:"align",tipoAvaliacao:"tipoAvaliacao",nota:"nota"},decls:3,vars:2,consts:[["class","row",4,"ngIf","ngIfElse"],["qualitativo",""],[1,"row"],["small","","disabled","",3,"starMargin","align","size","control"],["disabled","",3,"icon","label",4,"ngIf"],["disabled","",3,"icon","label"]],template:function(d,E){if(1&d&&(r.YNc(0,T,2,4,"div",0),r.YNc(1,I,1,1,"ng-template",null,1,r.W1O)),2&d){const Z=r.MAs(2);r.Q6J("ngIf",E.isQuantitativo)("ngIfElse",Z)}},dependencies:[v.O5,m.i,f.F]})}return p})()},38:(N,_,l)=>{l.d(_,{w:()=>Ta});var g=l(8239),r=l(4040),v=l(1184),m=l(207),f=l(1313),T=l(1095),x=l(4539),I=l(9190),b=l(2307),p=l(7447),A=l(1021),c=l(9173),d=l(4368);class E extends d.X{constructor(n){super(),this.checklist=[],this.avaliacao_id="",this.plano_trabalho_entrega_id=null,this.plano_entrega_entrega_id=null,this.initialization(n)}}var Z=l(2214),a=l(755),h=l(6733),P=l(3150),J=l(7224),w=l(3351),M=l(8820),j=l(4508),D=l(2984),U=l(5560),z=l(5489),Y=l(2729),F=l(9756),k=l(52),O=l(2133),R=l(645),V=l(8544);function B(i,n){if(1&i&&a._UZ(0,"i"),2&i){const t=a.oxw().$implicit;a.Gre("bi ",t.icon,"")}}function W(i,n){if(1&i){const t=a.EpF();a.ynx(0),a.TgZ(1,"div",3),a.NdJ("click",function(){const s=a.CHM(t).$implicit,u=a.oxw();return a.KtG(u.onClick(s))}),a.YNc(2,B,1,3,"i",4),a.TgZ(3,"span"),a._uU(4),a.qZA()(),a.BQk()}if(2&i){const t=n.$implicit,e=a.oxw();a.xp6(1),a.Udp("border-color",t.color)("background-color",e.isChecked(t)?t.color:"")("color",t.color&&e.isChecked(t)?e.util.contrastColor(t.color):t.color),a.ekj("button_avaliation_disabled",e.isDisabled),a.Q6J("id",e.generatedId(e.controlName)+"_"+t.key),a.xp6(1),a.Q6J("ngIf",t.icon),a.xp6(2),a.Oqu(t.value)}}let H=(()=>{class i extends R.M{set value(t){t!=this._value&&(this._value=t,this.detectChanges(),this.control?.setValue(t),this.change&&this.change(t))}get value(){return this._value}set control(t){this._control=t}get control(){return this.getControl()}set size(t){this.setSize(t)}get size(){return this.getSize()}constructor(t){super(t),this.injector=t,this.class="form-group",this.hostClass="",this.labelPosition="top",this.controlName=null,this.icon="bi bi-toggle-on",this.label="",this.labelInfo="",this.bold=!1,this.loading=!1,this.items=[],this._value=""}ngOnInit(){super.ngOnInit()}isChecked(t){return this.value==t.key}onClick(t){this.isDisabled||(this.value=t.key)}ngAfterViewInit(){super.ngAfterViewInit(),this.control&&(this.value=this.control.value,this.control.valueChanges.subscribe(t=>{this.value=t}))}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["input-choose"]],hostVars:2,hostBindings:function(e,o){2&e&&a.Tol(o.class)},inputs:{hostClass:"hostClass",labelPosition:"labelPosition",controlName:"controlName",disabled:"disabled",icon:"icon",label:"label",labelInfo:"labelInfo",labelClass:"labelClass",bold:"bold",loading:"loading",items:"items",form:"form",source:"source",path:"path",required:"required",change:"change",value:"value",control:"control",size:"size"},features:[a._Bn([],[{provide:O.gN,useExisting:O.sg}]),a.qOj],decls:3,vars:13,consts:[[3,"labelPosition","labelClass","controlName","required","control","loading","disabled","label","labelInfo","icon","bold","isRadio"],[1,"d-flex","flex-wrap","justify-content-center","mt-3"],[4,"ngFor","ngForOf"],[1,"button_avaliation","text-center","mb-3",3,"id","click"],[3,"class",4,"ngIf"]],template:function(e,o){1&e&&(a.TgZ(0,"input-container",0)(1,"div",1),a.YNc(2,W,5,11,"ng-container",2),a.qZA()()),2&e&&(a.Q6J("labelPosition",o.labelPosition)("labelClass",o.labelClass)("controlName",o.controlName)("required",o.required)("control",o.control)("loading",o.loading)("disabled",o.disabled)("label",o.label)("labelInfo",o.labelInfo)("icon",o.icon)("bold",o.bold)("isRadio",!0),a.xp6(2),a.Q6J("ngForOf",o.items))},dependencies:[h.sg,h.O5,V.h],styles:[".label-input-invalid[_ngcontent-%COMP%]{border-color:#dc3545}.button_avaliation_disabled[_ngcontent-%COMP%]{cursor:default!important}.button_avaliation_disabled[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]:before{animation:none!important}.button_avaliation[_ngcontent-%COMP%]{border:3px solid;padding:5px 10px;cursor:pointer;border-radius:4px;margin-right:10px;max-width:150px;min-width:100px}.button_avaliation[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.8rem}.button_avaliation[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:block;font-size:12px}.button_avaliation[_ngcontent-%COMP%]:hover   i[_ngcontent-%COMP%]:before{animation:_ngcontent-%COMP%_bouncetop .3s alternate ease infinite}@keyframes _ngcontent-%COMP%_bouncetop{0%{-webkit-transform:translateY(0)}to{-webkit-transform:translateY(3px)}}"]})}return i})();function q(i,n){if(1&i){const t=a.EpF();a.TgZ(0,"input-rate",2),a.NdJ("change",function(o){a.CHM(t);const s=a.oxw();return a.KtG(s.onValueChange(o))}),a.qZA()}if(2&i){const t=a.oxw();a.Q6J("disabled",t.disabled)("size",12)("label",t.label)("control",t.control)}}function G(i,n){if(1&i&&a._UZ(0,"input-choose",3),2&i){const t=a.oxw();a.Q6J("label",t.label)("control",t.control)("disabled",t.disabled)("items",t.items)("change",t.onValueChange.bind(t))}}let L=(()=>{class i{constructor(){this.class="form-group",this.label="Qual nota?",this.items=[],this._size=0,this._control=void 0,this._tipoAvaliacao=void 0}set tipoAvaliacao(t){if(this._tipoAvaliacao!=t){this._tipoAvaliacao=t;let e=this._tipoAvaliacao?.notas;e.sort((o,s)=>s.sequencia-o.sequencia),this.items=(e||[]).map(o=>Object.assign({},{key:o.nota,value:o.nota,hint:o.descricao,icon:o.icone,color:o.cor}))}}get tipoAvaliacao(){return this._tipoAvaliacao}set control(t){this._control!=t&&(this._control=t,t&&(t.valueChanges.subscribe(this.updateNota.bind(this)),this.updateNota()))}get control(){return this._control}set size(t){t!=this._size&&(this._size=t,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+t)}get size(){return this._size||12}get isQuantitativo(){return"QUANTITATIVO"==this.tipoAvaliacao?.tipo}get isQualitativo(){return"QUALITATIVO"==this.tipoAvaliacao?.tipo}updateNota(){this.nota=this.tipoAvaliacao?.notas.find(t=>t.nota==this.control?.value)}onValueChange(t){this.control?.updateValueAndValidity(),this.change&&this.change(this.control?.value)}static#a=this.\u0275fac=function(e){return new(e||i)};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["avaliar-nota-input"]],hostVars:2,hostBindings:function(e,o){2&e&&a.Tol(o.class)},inputs:{label:"label",disabled:"disabled",change:"change",tipoAvaliacao:"tipoAvaliacao",control:"control",size:"size"},decls:3,vars:2,consts:[[3,"disabled","size","label","control","change",4,"ngIf","ngIfElse"],["qualitativo",""],[3,"disabled","size","label","control","change"],[3,"label","control","disabled","items","change"]],template:function(e,o){if(1&e&&(a.YNc(0,q,1,4,"input-rate",0),a.YNc(1,G,1,5,"ng-template",null,1,a.W1O)),2&e){const s=a.MAs(2);a.Q6J("ngIf",o.isQuantitativo)("ngIfElse",s)}},dependencies:[h.O5,k.i,H]})}return i})();var S=l(6486);const K=["notaInput"],X=["justificativas"];function $(i,n){if(1&i&&(a.TgZ(0,"separator",10),a._UZ(1,"input-textarea",11),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("size",12)("disabled",t.recurso?void 0:"true")("rows",2)("control",t.form.controls.recurso)}}function aa(i,n){if(1&i&&(a.TgZ(0,"div",12)(1,"button",13),a._UZ(2,"i"),a.TgZ(3,"strong",14),a._uU(4),a.qZA(),a._uU(5),a.qZA()()),2&i){const t=a.oxw();a.xp6(1),a.Akn(t.styleButtonNota),a.xp6(1),a.Tol(t.nota.icone),a.Udp("color",t.nota.cor||"black"),a.xp6(2),a.Oqu(t.nota.nota),a.xp6(1),a.hij(" - ",t.nota.descricao," ")}}function ta(i,n){if(1&i&&(a.TgZ(0,"div",2),a._UZ(1,"input-multitoggle",15,16),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("disabled",t.recurso?"true":void 0)("control",t.form.controls.justificativas)("label",t.nota.pergunta)("items",t.tiposJustificativas)}}function oa(i,n){if(1&i&&a._uU(0),2&i){const t=n.row,e=a.oxw(2);a.hij(" ",e.util.getDateFormatted(e.isPlanoEntrega?t.data_inicio:null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)," ")}}function ea(i,n){if(1&i&&a._uU(0),2&i){const t=n.row,e=a.oxw(2);a.hij(" ",e.util.getDateFormatted(e.isPlanoEntrega?t.data_fim:null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim)," ")}}function ia(i,n){if(1&i&&a._UZ(0,"badge",30),2&i){const t=n.row,e=a.oxw(2);a.Q6J("icon",e.entityService.getIcon("Entrega"))("label",t.descricao)}}function na(i,n){1&i&&a._UZ(0,"badge",33),2&i&&a.Q6J("label",n.row.forca_trabalho+"%")}function la(i,n){if(1&i&&(a.TgZ(0,"column",31),a.YNc(1,na,1,1,"ng-template",null,32,a.W1O),a.qZA()),2&i){const t=a.MAs(2);a.Q6J("template",t)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada")}}function sa(i,n){if(1&i&&a._UZ(0,"badge",36)(1,"br")(2,"badge",37),2&i){const t=n.row,e=a.oxw(3);a.Q6J("textValue",e.planoEntregaService.getValorMeta(t)),a.xp6(2),a.Q6J("textValue",e.planoEntregaService.getValorRealizado(t))}}function ra(i,n){if(1&i&&(a.TgZ(0,"column",34),a.YNc(1,sa,3,2,"ng-template",null,35,a.W1O),a.qZA()),2&i){const t=a.MAs(2);a.Q6J("title","Meta\nRealizado")("width",200)("template",t)}}function ca(i,n){if(1&i&&a._UZ(0,"progress-bar",40),2&i){const t=n.row;a.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}function pa(i,n){if(1&i&&(a.TgZ(0,"column",38),a.YNc(1,ca,1,2,"ng-template",null,39,a.W1O),a.qZA()),2&i){const t=a.MAs(2);a.Q6J("width",200)("template",t)}}function da(i,n){if(1&i&&a._UZ(0,"input-switch",43),2&i){const t=n.row,e=n.column,o=a.oxw(3);a.Q6J("source",t._metadata)("path",e.metadata.key)("disabled",o.recurso?"true":void 0)}}function ua(i,n){if(1&i&&(a.TgZ(0,"column",41),a.YNc(1,da,1,3,"ng-template",null,42,a.W1O),a.qZA()),2&i){const t=n.$implicit,e=a.MAs(2);a.Q6J("title",t.value)("template",e)("metadata",t)}}function ga(i,n){if(1&i&&(a.TgZ(0,"separator",17)(1,"grid",18,19)(3,"columns")(4,"column",20),a.YNc(5,oa,1,1,"ng-template",null,21,a.W1O),a.qZA(),a.TgZ(7,"column",22),a.YNc(8,ea,1,1,"ng-template",null,23,a.W1O),a.qZA(),a.TgZ(10,"column",24),a.YNc(11,ia,1,2,"ng-template",null,25,a.W1O),a.qZA(),a.YNc(13,la,3,2,"column",26),a.YNc(14,ra,3,3,"column",27),a.YNc(15,pa,3,2,"column",28),a.YNc(16,ua,3,3,"column",29),a.qZA()()()),2&i){const t=a.MAs(6),e=a.MAs(9),o=a.MAs(12),s=a.oxw();a.Q6J("title",s.lex.translate("Entregas"))("collapsed",!s.checklist.length),a.xp6(1),a.Q6J("items",s.entregas)("minHeight",0),a.xp6(3),a.Q6J("template",t),a.xp6(3),a.Q6J("template",e),a.xp6(3),a.Q6J("template",o),a.xp6(3),a.Q6J("ngIf",s.isConsolidacao),a.xp6(1),a.Q6J("ngIf",s.isPlanoEntrega),a.xp6(1),a.Q6J("ngIf",s.isPlanoEntrega),a.xp6(1),a.Q6J("ngForOf",s.checklist)}}function _a(i,n){if(1&i&&(a.TgZ(0,"div",54)(1,"div",55),a._UZ(2,"profile-picture",56),a.qZA(),a.TgZ(3,"div",57)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&i){const t=n.row;a.xp6(2),a.Q6J("url",t.avaliador.url_foto||"")("size",40)("hint",t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.apelido||"")}}function ma(i,n){if(1&i&&a._UZ(0,"badge",30),2&i){const t=n.$implicit,e=a.oxw(3);a.Q6J("icon",e.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function ha(i,n){if(1&i&&(a._UZ(0,"avaliar-nota-badge",58)(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA(),a.TgZ(4,"div",59),a.YNc(5,ma,1,2,"badge",60),a.qZA()),2&i){const t=n.row;a.Q6J("align","left")("tipoAvaliacao",t.tipo_avaliacao)("nota",t.nota),a.xp6(3),a.Oqu(t.justificativa||""),a.xp6(2),a.Q6J("ngForOf",t.justificativas)}}function va(i,n){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=n.row;a.xp6(1),a.Oqu(t.recurso||"")}}function fa(i,n){1&i&&a._UZ(0,"badge",63)}function ba(i,n){1&i&&a._UZ(0,"badge",64)}function Aa(i,n){if(1&i&&(a.TgZ(0,"div",59),a.YNc(1,fa,1,0,"badge",61),a.YNc(2,ba,1,0,"badge",62),a.qZA()),2&i){const t=n.row,e=a.oxw(2);a.xp6(1),a.Q6J("ngIf",null==t.recurso?null:t.recurso.length),a.xp6(1),a.Q6J("ngIf",t.id==(null==e.entity?null:e.entity.id))}}function Ca(i,n){if(1&i&&(a.TgZ(0,"separator",44)(1,"grid",18,19)(3,"columns"),a._UZ(4,"column",45),a.TgZ(5,"column",46),a.YNc(6,_a,9,5,"ng-template",null,47,a.W1O),a.qZA(),a.TgZ(8,"column",48),a.YNc(9,ha,6,5,"ng-template",null,49,a.W1O),a.qZA(),a.TgZ(11,"column",50),a.YNc(12,va,2,1,"ng-template",null,51,a.W1O),a.qZA(),a.TgZ(14,"column",52),a.YNc(15,Aa,3,2,"ng-template",null,53,a.W1O),a.qZA()()()()),2&i){const t=a.MAs(7),e=a.MAs(10),o=a.MAs(13),s=a.MAs(16),u=a.oxw();a.xp6(1),a.Q6J("items",u.avaliacoes)("minHeight",0),a.xp6(4),a.Q6J("template",t),a.xp6(3),a.Q6J("title","Nota\nJustificativas")("template",e),a.xp6(3),a.Q6J("template",o),a.xp6(3),a.Q6J("template",s)}}let Ta=(()=>{class i extends v.F{constructor(t){super(t,f.g,T.w),this.injector=t,this.recurso=!1,this.tiposJustificativas=[],this.entregas=[],this.checklist=[],this.avaliacoes=[],this.modalWidth=900,this.joinConsolidacao=[],this.joinPlanoEntrega=[],this.joinPrograma=["tipo_avaliacao_plano_trabalho.notas.justificativas","tipo_avaliacao_plano_entrega.notas.justificativas"],this.joinPlanoEntregaEntrega=["entrega","objetivos.objetivo","processos.processo","unidade","comentarios.usuario:id,nome,apelido"],this.joinPlanoTrabalhoEntrega=["entrega","planoEntregaEntrega:id,descricao,data_inicio,data_fim,plano_entrega_id,entrega_id","planoEntregaEntrega.entrega:id,nome,tipo_indicador"],this.validate=(e,o)=>{let s=null;return this.recurso?"recurso"==o&&!e.value?.length&&(s="Obrigat\xf3rio"):"nota"==o&&([null,void 0].includes(e.value)||!this.nota)&&(s="Obrigat\xf3rio"),s},this.formValidation=e=>{const o=e.value;if(!this.recurso&&this.nota?.justifica&&!o.justificativa?.length&&!o.justificativas?.length)return"Para a nota seleciona ser\xe1 necess\xe1rio ao menos uma justificativa."},this.programaDao=t.get(Z.w),this.planoTrabalhoEntregaDao=t.get(c.w),this.tipoAvaliacaoDao=t.get(m.r),this.consolidacaoDao=t.get(x.E),this.planoEntregaDao=t.get(I.r),this.planoEntregaEntregaDao=t.get(A.K),this.planoEntregaService=t.get(p.f),this.join=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.form=this.fh.FormBuilder({nota:{default:null},recurso:{default:""},justificativas:{default:[]},justificativa:{default:""},arquivar:{default:!0}},this.cdRef,this.validate)}loadData(t,e){var o=this;return(0,g.Z)(function*(){let s=Object.assign({},e.value);o.loading=!0;try{o.consolidacao=o.urlParams?.has("consolidacaoId")||o.metadata?.consolidacao?o.metadata?.consolidacao||(yield o.consolidacaoDao.getById(o.urlParams.get("consolidacaoId"),o.joinConsolidacao)):void 0,o.planoEntrega=o.urlParams?.has("planoEntregaId")||o.metadata?.planoEntrega?o.metadata?.planoEntrega||(yield o.planoEntregaDao.getById(o.urlParams.get("planoEntregaId"),o.joinPlanoEntrega)):void 0,o.avaliacoes=yield o.dao.query({where:o.consolidacao?[["plano_trabalho_consolidacao_id","==",o.consolidacao.id]]:[["plano_entrega_id","==",o.planoEntrega?.id]],join:o.join,orderBy:[["data_avaliacao","desc"]]}).asPromise(),o.entity=o.avaliacoes.find(u=>u.id==(o.consolidacao||o.planoEntrega)?.avaliacao_id)||o.entity,o.programa=o.metadata?.programa||(yield o.programaDao.query({where:[["id","==",o.consolidacao?.plano_trabalho?.programa_id||o.planoEntrega?.programa_id]],join:o.joinPrograma}).firstOrDefault(o.consolidacao?.plano_trabalho?.programa||o.planoEntrega?.programa)),o.origem=o.consolidacao?"CONSOLIDACAO":"PLANO_ENTREGA",o.tipoAvaliacao=o.isConsolidacao?o.programa?.tipo_avaliacao_plano_trabalho:o.programa?.tipo_avaliacao_plano_entrega,o.checklist=(o.isConsolidacao?o.programa?.checklist_avaliacao_entregas_plano_trabalho:o.programa?.checklist_avaliacao_entregas_plano_entrega)||[],o.recurso=!!o.metadata?.recurso,o.entregas=o.metadata?.entregas||(o.isConsolidacao?yield o.planoTrabalhoEntregaDao.query({where:[["plano_trabalho_id","==",o.consolidacao.plano_trabalho_id]],join:o.joinPlanoTrabalhoEntrega}).asPromise():yield o.planoEntregaEntregaDao.query({where:[["plano_entrega_id","==",o.planoEntrega.id]],join:o.joinPlanoEntregaEntrega}).asPromise()),o.entregas.forEach(u=>{u._metadata={},o.checklist.forEach(y=>{let Q=o.entity?.entregas_checklist.find(C=>u.id==(C.plano_entrega_entrega_id||C.plano_trabalho_entrega_id));u._metadata[y.key]=!Q||!!Q.checklist.find(C=>C.id==y.key)?.checked})}),o.usuario=o.consolidacao?.plano_trabalho?.usuario,s=o.util.fillForm(s,o.entity),o.form.controls.nota.setValue(s.nota),o.onNotaChange(new Event("change")),e.patchValue(s)}finally{o.loading=!1}})()}initializeData(t){var e=this;return(0,g.Z)(function*(){e.entity=new f.g,yield e.loadData(e.entity,t)})()}get nota(){return this.notaInput?.nota}get labelNota(){return"Como foi o trabalho "+(this.isConsolidacao?"de "+this.util.apelidoOuNome(this.usuario):"da "+this.planoEntrega?.unidade?.sigla)+"?"}get styleButtonNota(){const t=this.util.colorHexToRGB(this.nota?.cor||"#000000");return"background-color: rgba("+t.r+","+t.g+","+t.b+", 0.2);"}get isConsolidacao(){return"CONSOLIDACAO"==this.origem}get isPlanoEntrega(){return"PLANO_ENTREGA"==this.origem}onNotaChange(t){this.tiposJustificativas=this.nota?.justificativas?.map(e=>({key:e.tipo_justificativa_id,value:e.tipo_justificativa.nome||""}))||[]}saveData(t){var e=this;return(0,g.Z)(function*(){return e.recurso?(yield e.dao.recorrer(e.consolidacao.avaliacao,t.recurso),new b.R(e.consolidacao.avaliacao)):(e.entity.id="",e.entity.data_avaliacao=e.auth.hora,e.entity.nota=t.nota,e.entity.justificativa=t.justificativa,e.entity.justificativas=t.justificativas,e.entity.avaliador_id=e.auth.usuario.id,e.entity.plano_entrega_id=e.planoEntrega?.id||null,e.entity.plano_trabalho_consolidacao_id=e.consolidacao?.id||null,e.entity.tipo_avaliacao_id=e.tipoAvaliacao.id,e.entity.tipo_avaliacao_nota_id=e.nota.id,e.checklist.length&&(e.entity.entregas_checklist=e.entregas.map(o=>new E({plano_trabalho_entrega_id:e.consolidacao?o.id:null,plano_entrega_entrega_id:e.planoEntrega?o.id:null,checklist:e.checklist.map(s=>({id:s.key,texto:s.value,checked:!!o._metadata[s.key]}))}))),new b.R(yield e.dao.save(e.entity,e.join)))})()}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["avaliar"]],viewQuery:function(e,o){if(1&e&&(a.Gf(K,5),a.Gf(X,5),a.Gf(r.Q,5)),2&e){let s;a.iGM(s=a.CRH())&&(o.notaInput=s.first),a.iGM(s=a.CRH())&&(o.justificativas=s.first),a.iGM(s=a.CRH())&&(o.editableForm=s.first)}},features:[a.qOj],decls:10,vars:17,consts:[[3,"form","disabled","submit","cancel"],["title","Recurso",4,"ngIf"],[1,"row"],[3,"size","disabled","tipoAvaliacao","label","change","control"],["notaInput",""],["class","d-flex justify-content-center",4,"ngIf"],["class","row",4,"ngIf"],["label","Justificativa","controlName","justificativa",3,"disabled","size","rows","control"],["collapse","",3,"title","collapsed",4,"ngIf"],["title","Hist\xf3rico de avalia\xe7\xf5es","collapse","",4,"ngIf"],["title","Recurso"],["label","Texto do recurso","controlName","recurso",3,"size","disabled","rows","control"],[1,"d-flex","justify-content-center"],["type","button",1,"pe-none","btn"],[1,"ms-1"],[3,"disabled","control","label","items"],["justificativas",""],["collapse","",3,"title","collapsed"],[3,"items","minHeight"],["gridEntregas",""],["title","In\xedcio",3,"template"],["culumnDataInicio",""],["title","Fim",3,"template"],["columnDataFim",""],["title","Entrega",3,"template"],["columnEntrega",""],["title","% CHD Planejado",3,"template","titleHint",4,"ngIf"],[3,"title","width","template",4,"ngIf"],["title","Progresso",3,"width","template",4,"ngIf"],[3,"title","template","metadata",4,"ngFor","ngForOf"],[3,"icon","label"],["title","% CHD Planejado",3,"template","titleHint"],["columnForcaTrabalho",""],["color","light",3,"label"],[3,"title","width","template"],["columnMetaRealizado",""],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],["title","Progresso",3,"width","template"],["columnProgresso",""],["color","success",3,"value","goal"],[3,"title","template","metadata"],["columnCheck",""],[3,"source","path","disabled"],["title","Hist\xf3rico de avalia\xe7\xf5es","collapse",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],["columnAvaliador",""],[3,"title","template"],["columnNotaJustificativa",""],["title","Recurso",3,"template"],["columnRecurso",""],["title","Status",3,"template"],["columnStatus",""],[1,"avaliador"],[1,"avaliador-profile"],[3,"url","size","hint"],[1,"avaliador-nome"],[3,"align","tipoAvaliacao","nota"],[1,"one-per-line"],[3,"icon","label",4,"ngFor","ngForOf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(e,o){1&e&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return o.onSaveData()})("cancel",function(){return o.onCancel()}),a.YNc(1,$,2,4,"separator",1),a.TgZ(2,"div",2),a._UZ(3,"avaliar-nota-input",3,4),a.qZA(),a.YNc(5,aa,6,8,"div",5),a.YNc(6,ta,3,4,"div",6),a._UZ(7,"input-textarea",7),a.YNc(8,ga,17,11,"separator",8),a.YNc(9,Ca,17,7,"separator",9),a.qZA()),2&e&&(a.Q6J("form",o.form)("disabled",o.formDisabled),a.xp6(1),a.Q6J("ngIf",o.recurso||(null==o.form.controls.recurso||null==o.form.controls.recurso.value?null:o.form.controls.recurso.value.length)),a.xp6(2),a.Q6J("size",12)("disabled",o.recurso?"true":void 0)("tipoAvaliacao",o.tipoAvaliacao)("label",o.labelNota)("change",o.onNotaChange.bind(o))("control",o.form.controls.nota),a.xp6(2),a.Q6J("ngIf",o.nota),a.xp6(1),a.Q6J("ngIf",!1),a.xp6(1),a.Q6J("disabled",o.recurso?"true":void 0)("size",12)("rows",2)("control",o.form.controls.justificativa),a.xp6(1),a.Q6J("ngIf",o.entregas.length),a.xp6(1),a.Q6J("ngIf",o.avaliacoes.length))},dependencies:[h.sg,h.O5,P.M,J.a,w.b,r.Q,M.a,j.Q,D.d,U.N,z.F,Y.q,F.R,L,S.M],styles:[".avaliador[_ngcontent-%COMP%]{display:table}.avaliador-profile[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;display:table-cell}.avaliador-nome[_ngcontent-%COMP%]{display:table-cell;min-width:100px}"]})}return i})()}}]);