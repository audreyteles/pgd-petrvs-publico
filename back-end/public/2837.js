"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[2837],{41095:(Ce,J,s)=>{s.d(J,{w:()=>A});var C,O=s(56976),Q=s(20755);class A extends O.B{constructor(d){super("Avaliacao",d),this.injector=d,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(d){return new Promise((h,Z)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:d}).subscribe(P=>{P?.error?Z(P?.error):h(!0)},P=>Z(P))})}recorrer(d,h){return new Promise((Z,P)=>{this.server.post("api/"+this.collection+"/recorrer",{id:d.id,recurso:h}).subscribe(I=>{I?.error?P(I?.error):(d.recurso=h,Z(!0))},I=>P(I))})}}(C=A).\u0275fac=function(d){return new(d||C)(Q.LFG(Q.zs3))},C.\u0275prov=Q.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"})},82837:(Ce,J,s)=>{s.r(J),s.d(J,{PlanoEntregaModule:()=>He});var O=s(76733),Q=s(58568),C=s(55579),A=s(1391),T=s(2314),d=s(8239),h=s(73150),Z=s(19520),P=s(5458),I=s(39190),D=s(81214),z=s(64368);class L extends z.X{constructor(a){super(),this.entregas=[],this.status_historico=[],this.data_inicio=new Date,this.data_fim=null,this.nome="",this.metadados=void 0,this.arquivar=!1,this.status="INCLUIDO",this.avaliacoes=[],this.unidade_id="",this.avaliacao_id=null,this.plano_entrega_id=null,this.planejamento_id=null,this.cadeia_valor_id=null,this.programa_id=null,this.initialization(a)}}var W,r=s(78509),c=s(77447),_=s(41095),E=s(20609),e=s(20755),m=s(57224),f=s(83351),p=s(57765),x=s(45512),j=s(42704),Pe=s(88820),R=s(32802),F=s(92392),w=s(84495),G=s(64603),ve=s(61915),N=s(95489),Ke=s(56486),y=s(74040),U=s(31021),k=s(32398),B=s(76298),Ie=s(17819),Y=s(25560),H=s(69756),_e=s(9224),De=s(64792),Xe=s(81419);function $e(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input-number",3),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onValueChange(i))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Porcentagem")("control",t.control)("labelInfo",t.labelInfo)}}function et(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input-number",4),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onValueChange(i))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Num\xe9rico")("control",t.control)("labelInfo",t.labelInfo)}}const tt=function(){return[]};function at(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input-select",5),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onValueChange(i))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Qualitativo")("control",t.control)("items",(null==t.entrega?null:t.entrega.lista_qualitativos)||e.DdM(6,tt))("labelInfo",t.labelInfo)}}const nt=function(){return["PORCENTAGEM"]},ot=function(){return["QUANTIDADE","VALOR"]},it=function(){return["QUALITATIVO"]};class pe{constructor(){this.class="form-group",this.icon="",this.labelInfo="",this._size=0}set size(a){a!=this._size&&(this._size=a,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+a)}get size(){return this._size||12}checkTipoIndicador(a){return a.includes(this.entrega?.tipo_indicador||"")}onValueChange(a){this.change&&this.change(this.control?.value,this.entrega)}}var K;(W=pe).\u0275fac=function(a){return new(a||W)},W.\u0275cmp=e.Xpm({type:W,selectors:[["plano-entrega-valor-meta-input"]],hostVars:2,hostBindings:function(a,t){2&a&&e.Tol(t.class)},inputs:{entrega:"entrega",icon:"icon",label:"label",labelInfo:"labelInfo",disabled:"disabled",control:"control",change:"change",size:"size"},decls:3,vars:6,consts:[["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","items","labelInfo","change",4,"ngIf"],["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change"],["required","",3,"disabled","icon","label","control","labelInfo","change"],["required","",3,"disabled","icon","label","control","items","labelInfo","change"]],template:function(a,t){1&a&&(e.YNc(0,$e,1,5,"input-number",0),e.YNc(1,et,1,5,"input-number",1),e.YNc(2,at,1,7,"input-select",2)),2&a&&(e.Q6J("ngIf",t.checkTipoIndicador(e.DdM(3,nt))),e.xp6(1),e.Q6J("ngIf",t.checkTipoIndicador(e.DdM(4,ot))),e.xp6(1),e.Q6J("ngIf",t.checkTipoIndicador(e.DdM(5,it))))},dependencies:[O.O5,G.p,_e.l]});const lt=["etiqueta"];function st(o,a){if(1&o&&(e.TgZ(0,"strong",14),e._uU(1,"Entregas: "),e.qZA(),e.TgZ(2,"span",15),e._UZ(3,"badge",16),e.qZA()),2&o){const t=a.separator;e.xp6(3),e.Q6J("label",null==t?null:t.text)}}function rt(o,a){if(1&o&&e._UZ(0,"badge",21),2&o){const t=e.oxw().row,n=e.oxw();e.Q6J("icon",n.entityService.getIcon("Unidade"))("label",t.unidade.sigla)}}function dt(o,a){if(1&o&&e._UZ(0,"badge",22),2&o){const t=e.oxw().row;e.Q6J("label",t.destinatario)}}function ct(o,a){if(1&o&&e._UZ(0,"reaction",23),2&o){const t=e.oxw().row;e.Q6J("entity",t)}}function ut(o,a){if(1&o&&(e.TgZ(0,"h6"),e._uU(1),e.qZA(),e.TgZ(2,"span",17),e.YNc(3,rt,1,2,"badge",18),e.YNc(4,dt,1,1,"badge",19),e.qZA(),e.YNc(5,ct,1,1,"reaction",20)),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.Oqu(t.descricao),e.xp6(2),e.Q6J("ngIf",t.unidade),e.xp6(1),e.Q6J("ngIf",null==t.destinatario?null:t.destinatario.length),e.xp6(1),e.Q6J("ngIf",n.execucao)}}function gt(o,a){if(1&o&&e._UZ(0,"badge",25),2&o){const t=a.$implicit;e.Q6J("lookup",t)}}function _t(o,a){if(1&o&&e.YNc(0,gt,1,1,"badge",24),2&o){const t=a.row;e.Q6J("ngForOf",t.etiquetas)}}function pt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input-multiselect",26)(1,"input-select",27,28),e.NdJ("details",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onEtiquetaConfigClick())}),e.qZA()()}if(2&o){const t=e.oxw();e.Q6J("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.xp6(1),e.Q6J("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function mt(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_inicio),"")}}function ht(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_fim),"")}}function ft(o,a){if(1&o&&(e.YNc(0,mt,2,1,"span",29),e._UZ(1,"br"),e.YNc(2,ht,2,1,"span",29)),2&o){const t=a.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function vt(o,a){if(1&o&&e._UZ(0,"badge",30)(1,"br")(2,"badge",31),2&o){const t=a.row,n=e.oxw();e.Q6J("textValue",n.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("textValue",n.planoEntregaService.getValorRealizado(t))}}function Et(o,a){if(1&o&&e._UZ(0,"plano-entrega-valor-meta-input",32)(1,"plano-entrega-valor-meta-input",33),2&o){const t=a.row,n=e.oxw();e.Q6J("entrega",t.entrega)("size",6)("control",n.form.controls.meta),e.xp6(1),e.Q6J("entrega",t.entrega)("size",6)("control",n.form.controls.realizado)("change",n.onRealizadaChange.bind(n))}}function bt(o,a){1&o&&e._UZ(0,"i",42)}function At(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,bt,1,0,"i",40),e.qZA(),e.TgZ(3,"td",41),e._uU(4),e.qZA()()),2&o){const t=a.$implicit;e.xp6(2),e.Q6J("ngIf",t.checked),e.xp6(2),e.Oqu(t.texto)}}function Tt(o,a){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,At,5,2,"tr",39),e.qZA()),2&o){const t=e.oxw(2).row;e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function Ot(o,a){if(1&o&&(e.TgZ(0,"separator",38),e.YNc(1,Tt,2,1,"table",29),e.qZA()),2&o){const t=e.oxw().row;e.Q6J("collapsed",!0),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function Ct(o,a){if(1&o&&(e._UZ(0,"progress-bar",36),e.YNc(1,Ot,2,2,"separator",37)),2&o){const t=a.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function Pt(o,a){1&o&&e._UZ(0,"separator",45)}function It(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input-switch",46),e.qZA(),e.TgZ(3,"td",41),e._uU(4),e.qZA()()),2&o){const t=a.$implicit,n=a.index,i=e.oxw(4);e.xp6(2),e.Q6J("size",12)("source",i.checklist)("path",n+".checked"),e.xp6(2),e.Oqu(t.texto)}}function Dt(o,a){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,It,5,4,"tr",39),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function Zt(o,a){if(1&o&&(e._UZ(0,"input-number",43),e.YNc(1,Pt,1,0,"separator",44),e.YNc(2,Dt,2,1,"table",29)),2&o){const t=a.row,n=e.oxw(2);e.Q6J("size",12)("control",n.formEdit.controls.progresso_realizado),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function xt(o,a){if(1&o&&(e.TgZ(0,"column",4),e.YNc(1,Ct,2,3,"ng-template",null,34,e.W1O),e.YNc(3,Zt,3,4,"ng-template",null,35,e.W1O),e.qZA()),2&o){const t=e.MAs(2),n=e.MAs(4),i=e.oxw();e.Q6J("title","Progresso\nChecklist")("width",200)("template",t)("editTemplate",t)("columnEditTemplate",i.selectable?void 0:n)("edit",i.selectable?void 0:i.onColumnChecklistEdit.bind(i))("save",i.selectable?void 0:i.onColumnChecklistSave.bind(i))}}function Nt(o,a){if(1&o&&e._UZ(0,"badge",49),2&o){const t=e.oxw().row;e.Q6J("label",null==t.entrega?null:t.entrega.nome)}}function yt(o,a){if(1&o&&(e.YNc(0,Nt,1,1,"badge",47),e._UZ(1,"comentarios-widget",48)),2&o){const t=a.row,n=e.oxw();e.Q6J("ngIf",t.entrega),e.xp6(1),e.Q6J("entity",t)("selectable",!n.execucao||!(null==n.grid||!n.grid.editing))("grid",n.grid)("save",n.refreshComentarios.bind(n))}}class Ee extends B.D{set noPersist(a){super.noPersist=a}get noPersist(){return super.noPersist}set control(a){super.control=a}get control(){return super.control}set entity(a){super.entity=a}get entity(){return super.entity}set planejamentoId(a){this._planejamentoId!=a&&(this._planejamentoId=a)}get planejamentoId(){return this._planejamentoId}set cadeiaValorId(a){this._cadeiaValorId!=a&&(this._cadeiaValorId=a)}get cadeiaValorId(){return this._cadeiaValorId}set unidadeId(a){this._unidadeId!=a&&(this._unidadeId=a)}get unidadeId(){return this._unidadeId}set dataFim(a){this._dataFim!=a&&(this._dataFim=a)}get dataFim(){return this._dataFim}get items(){return this.gridControl.value||this.gridControl.setValue([]),this.gridControl.value}constructor(a){super(a),this.injector=a,this.disabled=!1,this.execucao=!1,this.entityToControl=t=>t.entregas||[],this.options=[],this.planoEntregaId="",this.etiquetas=[],this.etiquetasAscendentes=[],this.selectable=!1,this.validate=(t,n)=>{let i=null;return["nome"].indexOf(n)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),i},this.filterWhere=t=>{let n=[];t.value;return n.push(["plano_entrega_id","==",this.planoEntregaId]),n},this.title=this.lex.translate("Entregas"),this.join=["unidade","entrega","reacoes.usuario:id,nome,apelido"],this.code="MOD_PENT",this.cdRef=a.get(e.sBO),this.dao=a.get(U.K),this.unidadeDao=a.get(D.J),this.planoEntregaService=a.get(c.f),this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:""},realizado:{default:null},entrega_id:{default:null},unidade_id:{default:null},progresso_esperado:{default:null},progresso_realizado:{default:null},destinatario:{default:null},etiquetas:{default:[]}},this.cdRef,this.validate),this.formEdit=this.fh.FormBuilder({progresso_realizado:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.addOption(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES),"MOD_PENT"),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_EXCL"),this.addOption(Object.assign({onClick:this.showLogs.bind(this)},this.OPTION_LOGS),"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.planoEntregaId=this.urlParams.get("id")||""}get isDisabled(){return this.formDisabled||this.disabled}add(){var a=this;return(0,d.Z)(function*(){let t=new k.O({_status:"ADD",id:a.dao.generateUuid(),plano_entrega_id:a.entity?.id});var n;a.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:a.entity,planejamento_id:a.planejamentoId,cadeia_valor_id:a.cadeiaValorId,unidade_id:a.unidadeId,data_fim:a.dataFim,entrega:t},modalClose:(n=(0,d.Z)(function*(i){if(i)try{a.isNoPersist?a.items.push(i):a.items.push(yield a.dao.save(i,a.join)),a.cdRef.detectChanges()}catch(l){a.error(l?.error||l?.message||l)}}),function(l){return n.apply(this,arguments)})})})()}dynamicOptions(a){return this.execucao||this.isDisabled?[]:this.options}dynamicButtons(a){const t=[];return this.isDisabled&&t.push(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES)),this.execucao&&t.push({label:"Hist\xf3rico de execu\xe7\xe3o",icon:"bi bi-activity",color:"btn-outline-info",onClick:this.showProgresso.bind(this)}),t.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),t}edit(a){var t=this;return(0,d.Z)(function*(){if(t.execucao)t.grid.edit(a);else{a._status="ADD"==a._status?"ADD":"EDIT";let n=t.items.indexOf(a);t.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,entrega:a},modalClose:(i=(0,d.Z)(function*(l){l&&(t.isNoPersist||(yield t.dao?.save(l)),t.items[n]=l)}),function(u){return i.apply(this,arguments)})})}var i})()}load(a,t){var n=this;return(0,d.Z)(function*(){n.form.patchValue(t),n.form.controls.meta.setValue(n.planoEntregaService.getValor(t.meta)),n.form.controls.realizado.setValue(n.planoEntregaService.getValor(t.realizado)),n.cdRef.detectChanges()})()}save(a,t){var n=this;return(0,d.Z)(function*(){let i;if(n.form.markAllAsTouched(),a.valid){n.submitting=!0;try{i=yield n.dao?.update(t.id,{realizado:n.planoEntregaService.getEntregaValor(t.entrega,a.controls.realizado.value),progresso_realizado:a.controls.progresso_realizado.value},n.join)}finally{n.submitting=!1}}return i})()}delete(a){var t=this;return(0,d.Z)(function*(){if(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?")){let i=t.items.indexOf(a);t.isNoPersist?a._status="DELETE":t.dao.delete(a).then(()=>{t.items.splice(i,1),t.cdRef.detectChanges(),t.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(l=>{t.dialog.alert("Erro","Erro ao excluir: "+(l?.message?l?.message:l))})}})()}consult(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega",a.id,"consult"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,entrega:a}})})()}showLogs(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["logs","change",a.id,"consult"]})})()}showPlanejamento(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",a]},{modal:!0})})()}showCadeiaValor(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","processos",a]},{modal:!0})})()}showProgresso(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","progresso",a.id]},{modal:!0,modalClose:n=>{t.parent?.refresh(t.entity?.id)}})})()}showDetalhes(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega",a.id,"detalhes"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,entrega:a}})})()}refreshComentarios(a){let t=this.items.find(n=>n.id==a.id);t&&(t.comentarios=a.comentarios||[])}onRealizadaChange(){const a=this.form?.controls.meta.value,t=this.form?.controls.realizado.value;if(a&&t){let n=isNaN(t)?0:(t/a*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}addItemHandleEtiquetas(){let a;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,n=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,n)&&(a={key:n,value:t.value,color:t.color,icon:t.icon},this.formEdit.controls.etiqueta.setValue(null))}return a}onColumnEtiquetasEdit(a){var t=this;return(0,d.Z)(function*(){if(!t.etiquetasAscendentes.filter(n=>n.data==a.unidade.id).length){let n=yield t.carregaEtiquetasUnidadesAscendentes(a.unidade);t.etiquetasAscendentes.push(...n)}t.formEdit.controls.etiquetas.setValue(a.etiquetas),t.formEdit.controls.etiqueta.setValue(null),t.etiquetas=t.util.merge(a.tipo_atividade?.etiquetas,a.unidade?.etiquetas,(n,i)=>n.key==i.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(n,i)=>n.key==i.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(n=>n.data==a.unidade.id),(n,i)=>n.key==i.key)})()}carregaEtiquetasUnidadesAscendentes(a){var t=this;return(0,d.Z)(function*(){let n=[],i=a.path.split("/");return(yield t.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(u=>{n=t.util.merge(n,u.etiquetas,(g,v)=>g.key==v.key)}),n.forEach(u=>u.data=a.id),n})()}onColumnEtiquetasSave(a){var t=this;return(0,d.Z)(function*(){try{const n=yield t.dao.update(a.id,{etiquetas:t.formEdit.controls.etiquetas.value});return a.etiquetas=t.formEdit.controls.etiquetas.value,!!n}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:a=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,n)=>t.key==n.key),this.cdRef.detectChanges()}})}onColumnChecklistEdit(a){var t=this;return(0,d.Z)(function*(){t.formEdit.controls.progresso_realizado.setValue(a.progresso_realizado),t.checklist=t.util.clone(a.checklist)})()}onColumnChecklistSave(a){var t=this;return(0,d.Z)(function*(){let n=Math.round(parseInt(t.planoEntregaService.getValorMeta(a))*t.formEdit.controls.progresso_realizado.value/100);try{const i=yield t.dao.update(a.id,{progresso_realizado:t.formEdit.controls.progresso_realizado.value,realizado:t.planoEntregaService.getEntregaValor(a.entrega,n),checklist:t.checklist});return a.progresso_realizado=t.formEdit.controls.progresso_realizado.value,a.checklist=t.checklist,typeof a.realizado.porcentagem<"u"?a.realizado.porcentagem=n:typeof a.realizado.quantitativo<"u"?a.realizado.quantitativo=n:typeof a.realizado.valor<"u"&&(a.realizado.valor=n),!!i}catch{return!1}})()}getObjetivos(a){return a.objetivos.filter(t=>"DELETE"!=t._status)}}var X;function Ut(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input-switch",24),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw(2);return e.KtG(l.onPrincipaisChange(i))}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("size",2)("control",t.filter.controls.principais)("labelInfo",t.lex.translate("Unidades")+" onde o "+t.lex.translate("usuario")+" \xe9 integrante, incluindo unidades superiores sob sua ger\xeancia.")}}function Lt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"toolbar",21)(1,"input-switch",22),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onAgruparChange(i))}),e.qZA(),e.YNc(2,Ut,1,3,"input-switch",23),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("buttons",t.toolbarButtons),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.agrupar),e.xp6(1),e.Q6J("ngIf",!t.avaliacao)}}function wt(o,a){if(1&o&&(e.TgZ(0,"div")(1,"div",25),e._UZ(2,"input-search",26,27)(4,"input-select",28)(5,"input-datetime",29)(6,"input-datetime",30),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("size",6)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}(K=Ee).\u0275fac=function(a){return new(a||K)(e.Y36(e.zs3))},K.\u0275cmp=e.Xpm({type:K,selectors:[["plano-entrega-list-entrega"]],viewQuery:function(a,t){if(1&a&&(e.Gf(y.Q,5),e.Gf(h.M,5),e.Gf(lt,5)),2&a){let n;e.iGM(n=e.CRH())&&(t.editableForm=n.first),e.iGM(n=e.CRH())&&(t.grid=n.first),e.iGM(n=e.CRH())&&(t.etiqueta=n.first)}},inputs:{cdRef:"cdRef",disabled:"disabled",parent:"parent",noPersist:"noPersist",control:"control",entity:"entity",planejamentoId:"planejamentoId",cadeiaValorId:"cadeiaValorId",unidadeId:"unidadeId",dataFim:"dataFim",execucao:"execucao"},features:[e.qOj],decls:25,vars:35,consts:[[3,"items","form","groupTemplate","minHeight","editable","hasAdd","add","hasEdit","load","save","selectable"],["groupEntregas",""],[3,"title","template","editTemplate"],["columnEntregaCliente",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],["columnEtiquetas",""],["columnEtiquetasEdit",""],["columnDatas",""],[3,"title","width","template","editTemplate"],["columnMetaRealizado",""],["editMetaRealizado",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save",4,"ngIf"],["columnEntregaCometario",""],["type","options",3,"onEdit","dynamicButtons","dynamicOptions"],[1,"grid-group-text"],[1,"text-wrap"],["color","primary",3,"label"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity"],[3,"lookup",4,"ngFor","ngForOf"],[3,"lookup"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],[4,"ngIf"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["icon","bi bi-graph-up-arrow","disabled","","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Realizada",3,"entrega","size","control","change"],["columnProgChecklist",""],["columnChecklistEdit",""],["color","success",3,"value","goal"],["small","","title","Checklist","collapse","",3,"collapsed",4,"ngIf"],["small","","title","Checklist","collapse","",3,"collapsed"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Realizado","sufix","%","icon","bi bi-clock","controlName","progresso_realizado","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","control"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["scale","small",3,"size","source","path"],["color","light","icon","bi bi-list-check",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity","selectable","grid","save"],["color","light","icon","bi bi-list-check",3,"label"]],template:function(a,t){if(1&a&&(e.TgZ(0,"grid",0),e.YNc(1,st,4,1,"ng-template",null,1,e.W1O),e.TgZ(3,"columns")(4,"column",2),e.YNc(5,ut,6,4,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(7,"column",4),e.YNc(8,_t,1,1,"ng-template",null,5,e.W1O),e.YNc(10,pt,3,6,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(12,"column",2),e.YNc(13,ft,3,2,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(15,"column",8),e.YNc(16,vt,3,2,"ng-template",null,9,e.W1O),e.YNc(18,Et,2,7,"ng-template",null,10,e.W1O),e.qZA(),e.YNc(20,xt,5,7,"column",11),e.TgZ(21,"column",2),e.YNc(22,yt,2,5,"ng-template",null,12,e.W1O),e.qZA(),e._UZ(24,"column",13),e.qZA()()),2&a){const n=e.MAs(2),i=e.MAs(6),l=e.MAs(9),u=e.MAs(11),g=e.MAs(14),v=e.MAs(17),b=e.MAs(19),q=e.MAs(23);e.Q6J("items",t.items)("form",t.form)("groupTemplate",n)("minHeight",300)("editable",t.isDisabled?void 0:"true")("hasAdd",!t.isDisabled&&t.auth.hasPermissionTo("MOD_PENT_ENTR_INCL")&&!t.execucao)("add",t.add.bind(t))("hasEdit",!t.isDisabled&&t.auth.hasPermissionTo("MOD_PENT_ENTR_EDT"))("load",t.load.bind(t))("save",t.save.bind(t))("selectable",t.selectable),e.xp6(4),e.Q6J("title","Entrega\nDemandante/Destinat\xe1rio")("template",i)("editTemplate",i),e.xp6(3),e.Q6J("title","Etiquetas")("width",100)("template",l)("editTemplate",l)("columnEditTemplate",t.selectable?void 0:u)("edit",t.selectable?void 0:t.onColumnEtiquetasEdit.bind(t))("save",t.selectable?void 0:t.onColumnEtiquetasSave.bind(t)),e.xp6(5),e.Q6J("title","Data In\xedcio\nData Fim")("template",g)("editTemplate",g),e.xp6(3),e.Q6J("title","Meta")("width",100)("template",v)("editTemplate",b),e.xp6(5),e.Q6J("ngIf",t.execucao),e.xp6(1),e.Q6J("title",t.lex.translate("Modelo de Entrega")+"\nComent\xe1rios")("template",q)("editTemplate",q),e.xp6(3),e.Q6J("onEdit",t.edit.bind(t))("dynamicButtons",t.dynamicButtons.bind(t))("dynamicOptions",t.dynamicOptions.bind(t))}},dependencies:[O.sg,O.O5,h.M,m.a,f.b,Pe.a,G.p,Ie.p,Y.N,N.F,H.R,_e.l,De.C,Xe.y,pe],styles:[".objetivo[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;padding:2px 0}"]});const qt=function(){return["CONCLUIDO","AVALIADO"]};function Qt(o,a){if(1&o&&(e.TgZ(0,"div",25),e._UZ(1,"input-switch",31)(2,"input-text",32)(3,"input-search",26,27)(5,"input-select",33)(6,"input-switch",34),e.qZA(),e.TgZ(7,"div",25),e._UZ(8,"input-search",35,36)(10,"input-search",37,38)(12,"input-select",28)(13,"input-datetime",29)(14,"input-datetime",30),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.meus_planos),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.nome)("placeholder","Nome do "+t.lex.translate("plano de entrega")),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.status)("items",t.lookup.PLANO_ENTREGA_STATUS)("filter",t.avaliacao?e.DdM(32,qt):void 0)("valueTodos",null),e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.arquivadas),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.planejamento_id)("dao",t.planejamentoDao),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.cadeia_valor_id)("dao",t.cadeiaValorDao),e.xp6(2),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function Rt(o,a){if(1&o&&(e.TgZ(0,"span",43),e._UZ(1,"i",44),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",null==t.entregas?null:t.entregas.length,"")}}function Jt(o,a){if(1&o&&e.YNc(0,Rt,3,1,"span",42),2&o){const t=a.row;e.Q6J("ngIf",null==t.entregas?null:t.entregas.length)}}function Mt(o,a){if(1&o&&e._UZ(0,"plano-entrega-list-entrega",45),2&o){const t=a.row,n=e.oxw(2);e.Q6J("parent",n)("disabled",n.avaliacao||!n.botaoAtendeCondicoes(n.BOTAO_ALTERAR,t))("entity",t)("execucao",n.execucao)("cdRef",n.cdRef)("planejamentoId",t.planejamento_id)("cadeiaValorId",t.cadeia_valor_id)("unidadeId",t.unidade_id)}}function St(o,a){if(1&o&&(e.TgZ(0,"column",39),e.YNc(1,Jt,1,1,"ng-template",null,40,e.W1O),e.YNc(3,Mt,1,8,"ng-template",null,41,e.W1O),e.qZA()),2&o){const t=e.MAs(2),n=e.MAs(4),i=e.oxw();e.Q6J("align","center")("hint",i.lex.translate("Entrega"))("template",t)("expandTemplate",n)}}function Vt(o,a){if(1&o&&(e.TgZ(0,"order",46),e._uU(1,"#ID"),e.qZA()),2&o){const t=a.header;e.Q6J("header",t)}}function zt(o,a){if(1&o&&(e.TgZ(0,"small",47),e._uU(1),e.qZA()),2&o){const t=a.row;e.xp6(1),e.hij("#",t.numero,"")}}function jt(o,a){if(1&o&&(e.TgZ(0,"order",48),e._uU(1,"Nome"),e.qZA(),e._UZ(2,"br"),e._uU(3)),2&o){const t=a.header,n=e.oxw();e.Q6J("header",t),e.xp6(3),e.hij(" Programa",n.filter.controls.agrupar.value?"":" - Unidade"," ")}}function Ft(o,a){if(1&o&&e._UZ(0,"badge",52),2&o){const t=e.oxw().row,n=e.oxw();e.Q6J("icon",n.entityService.getIcon("Programa"))("label",t.programa.nome)}}function Gt(o,a){if(1&o&&e._UZ(0,"badge",53),2&o){const t=e.oxw().row,n=e.oxw();e.Q6J("icon",n.entityService.getIcon(n.lex.translate("unidade")))("label",t.unidade.sigla)}}function kt(o,a){if(1&o&&(e.TgZ(0,"span",49),e._uU(1),e.qZA(),e._UZ(2,"br"),e.YNc(3,Ft,1,2,"badge",50),e.YNc(4,Gt,1,2,"badge",51)),2&o){const t=a.row,n=e.oxw();e.Udp("max-width",400,"px"),e.xp6(1),e.Oqu(t.nome||""),e.xp6(2),e.Q6J("ngIf",t.programa),e.xp6(1),e.Q6J("ngIf",!n.filter.controls.agrupar.value&&t.unidade)}}function Bt(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_inicio),"")}}function Yt(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_fim),"")}}function Ht(o,a){1&o&&(e._uU(0," Planejamento Institucional"),e._UZ(1,"br"),e._uU(2," Cadeia de Valor "))}function Wt(o,a){if(1&o&&e._UZ(0,"badge",55),2&o){const t=e.oxw().row,n=e.oxw();e.Q6J("maxWidth",300)("icon",n.entityService.getIcon("Planejamento"))("label",null==t.planejamento?null:t.planejamento.nome)}}function Kt(o,a){if(1&o&&e._UZ(0,"badge",55),2&o){const t=e.oxw().row,n=e.oxw();e.Q6J("maxWidth",300)("icon",n.entityService.getIcon("CadeiaValor"))("label",null==t.cadeia_valor?null:t.cadeia_valor.nome)}}function Xt(o,a){if(1&o&&(e.YNc(0,Wt,1,3,"badge",54),e.YNc(1,Kt,1,3,"badge",54)),2&o){const t=a.row;e.Q6J("ngIf",t.planejamento),e.xp6(1),e.Q6J("ngIf",t.cadeia_valor)}}function $t(o,a){1&o&&e._UZ(0,"badge",60)}function ea(o,a){1&o&&e._UZ(0,"badge",61)}function ta(o,a){if(1&o&&e._UZ(0,"avaliar-nota-badge",62),2&o){const t=e.oxw().row;e.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function aa(o,a){if(1&o&&(e._UZ(0,"badge",56)(1,"br"),e.YNc(2,$t,1,0,"badge",57),e.YNc(3,ea,1,0,"badge",58),e.YNc(4,ta,1,3,"avaliar-nota-badge",59)),2&o){const t=a.row,n=e.oxw();e.Q6J("color",n.lookup.getColor(n.lookup.PLANO_ENTREGA_STATUS,t.status))("icon",n.lookup.getIcon(n.lookup.PLANO_ENTREGA_STATUS,t.status))("label",n.lookup.getValue(n.lookup.PLANO_ENTREGA_STATUS,t.status)),e.xp6(2),e.Q6J("ngIf",t.data_arquivamento),e.xp6(1),e.Q6J("ngIf",t.deleted_at),e.xp6(1),e.Q6J("ngIf",t.avaliacao)}}class Ze extends r.E{constructor(a){super(a,L,I.r),this.injector=a,this.showFilter=!0,this.avaliacao=!1,this.execucao=!1,this.habilitarAdesaoToolbar=!1,this.toolbarButtons=[],this.botoes=[],this.routeStatus={route:["uteis","status"]},this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.storeFilter=t=>{const n=t?.value;return{meus_planos:n.meus_planos,arquivadas:n.arquivadas,unidade_id:n.unidade_id}},this.filterValidate=(t,n)=>{let i=null;return"data_filtro_inicio"==n&&t.value>this.filter?.controls.data_filtro_fim.value?i="Maior que fim":"data_filtro_fim"==n&&t.value<this.filter?.controls.data_filtro_inicio.value&&(i="Menor que in\xedcio"),i},this.filterWhere=t=>{let n=[],i=t.value;if(this.filter?.controls.principais.value){let l=["unidade_id","in",(this.auth.unidades||[]).map(u=>u.id)];if(this.auth.isGestorAlgumaAreaTrabalho()){let u=this.auth.unidades?.filter(b=>this.unidadeService.isGestorUnidade(b)),g=u?.map(b=>b.unidade_pai?.id||"").filter(b=>b.length);g?.length&&l[2].push(...g);let v=["unidade.unidade_pai_id","in",u?.map(b=>b.id)];n.push(["or",l,v])}else n.push(l)}if(this.filter?.controls.meus_planos.value){let l=["unidade_id","in",(this.auth.unidades||[]).map(u=>u.id)];n.push(l)}return i.nome?.length&&n.push(["nome","like","%"+i.nome.trim().replace(" ","%")+"%"]),i.data_filtro&&(n.push(["data_filtro","==",i.data_filtro]),n.push(["data_filtro_inicio","==",i.data_filtro_inicio]),n.push(["data_filtro_fim","==",i.data_filtro_fim])),i.unidade_id&&n.push(["unidade_id","==",i.unidade_id]),i.planejamento_id&&n.push(["planejamento_id","==",i.planejamento_id]),i.cadeia_valor_id&&n.push(["cadeia_valor_id","==",i.cadeia_valor_id]),this.isModal?n.push(["status","==","ATIVO"]):(i.status||this.avaliacao)&&n.push(["status","in",i.status?[i.status]:["CONCLUIDO","AVALIADO"]]),i.unidades_filhas&&n.push(["unidades_filhas","==",!0]),n.push(["incluir_arquivados","==",this.filter.controls.arquivadas.value]),n},this.avaliacaoDao=a.get(_.w),this.unidadeDao=a.get(D.J),this.planejamentoDao=a.get(P.U),this.cadeiaValorDao=a.get(Z.m),this.planoEntregaService=a.get(c.f),this.unidadeService=a.get(E.Z),this.unidadeSelecionada=this.auth.unidade,this.code="MOD_PLANE",this.title=this.lex.translate("Planos de Entregas"),this.filter=this.fh.FormBuilder({agrupar:{default:!0},principais:{default:!1},arquivadas:{default:!1},nome:{default:""},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date},status:{default:""},unidade_id:{default:null},unidades_filhas:{default:!1},planejamento_id:{default:null},cadeia_valor_id:{default:null},meus_planos:{default:!0}},this.cdRef,this.filterValidate),this.join=["planejamento:id,nome","programa:id,nome","cadeia_valor:id,nome","unidade:id,sigla,path","entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","entregas.comentarios.usuario:id,nome,apelido","entregas.reacoes.usuario:id,nome,apelido","unidade.gestor:id","unidade.gestores_substitutos:id","unidade.unidade_pai","avaliacao"],this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ADERIR_OPTION={label:"Aderir",icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{metadata:{planoEntrega:this.linha},modalClose:t=>{this.refresh()}})}).bind(this)},this.BOTAO_ADERIR_TOOLBAR={label:"Aderir",disabled:!this.habilitarAdesaoToolbar,icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{modalClose:t=>{this.refresh()}})}).bind(this)},this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:t=>this.go.navigate({route:["gestao","plano-entrega",t.id,"edit"]},this.modalRefreshId(t))},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_AVALIAR={label:"Avaliar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),onClick:this.avaliar.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_CANCELAR_AVALIACAO={label:"Cancelar avalia\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarAvaliacao.bind(this)},this.BOTAO_CANCELAR_CONCLUSAO={label:"Cancelar conclus\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.cancelarConclusao.bind(this)},this.BOTAO_CANCELAR_HOMOLOGACAO={label:"Cancelar homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.cancelarHomologacao.bind(this)},this.BOTAO_CONCLUIR={label:"Concluir",id:"CONCLUIDO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),onClick:this.concluir.bind(this)},this.BOTAO_CONSULTAR={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:t=>this.go.navigate({route:["gestao","plano-entrega",t.id,"consult"]},{modal:!0})},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_EXCLUIR={label:"Excluir",icon:"bi bi-trash",onClick:this.delete.bind(this)},this.BOTAO_HOMOLOGAR={label:"Homologar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.homologar.bind(this)},this.BOTAO_LIBERAR_HOMOLOGACAO={label:"Liberar para homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.liberarHomologacao.bind(this)},this.BOTAO_LOGS={label:"Logs",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:t=>this.go.navigate({route:["logs","change",t.id,"consult"]})},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_RETIRAR_HOMOLOGACAO={label:"Retirar de homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:this.retirarHomologacao.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",id:"PAUSADO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_AVALIAR,this.BOTAO_CANCELAR_PLANO,this.BOTAO_CANCELAR_AVALIACAO,this.BOTAO_CANCELAR_CONCLUSAO,this.BOTAO_CANCELAR_HOMOLOGACAO,this.BOTAO_CONCLUIR,this.BOTAO_CONSULTAR,this.BOTAO_DESARQUIVAR,this.BOTAO_EXCLUIR,this.BOTAO_HOMOLOGAR,this.BOTAO_LIBERAR_HOMOLOGACAO,this.BOTAO_LOGS,this.BOTAO_REATIVAR,this.BOTAO_RETIRAR_HOMOLOGACAO,this.BOTAO_SUSPENDER]}ngOnInit(){super.ngOnInit(),this.execucao=!!this.queryParams?.execucao,this.avaliacao=!!this.queryParams?.avaliacao,this.showFilter=!(typeof this.queryParams?.showFilter<"u")||"true"==this.queryParams.showFilter,this.selectable=this.metadata?.selectable||this.selectable,this.execucao&&(this.title=this.title+" (Execu\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.principais.setValue(!1)),this.avaliacao&&(this.title=this.title+" (Avalia\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.unidades_filhas.setValue(!0),this.filter.controls.principais.setValue(!1)),this.checaBotaoAderirToolbar()}ngAfterContentChecked(){this.auth.unidade!=this.unidadeSelecionada&&(this.unidadeSelecionada=this.auth.unidade,this.checaBotaoAderirToolbar(),this.cdRef.detectChanges())}onGridLoad(a){const t=(this.grid?.query||this.query).extra;a&&this.execucao&&a.forEach(n=>{["ATIVO","SUSPENSO"].includes(n.status)&&this.grid.expand(n.id)}),a?.forEach(n=>{let i=n;i.avaliacao&&(i.avaliacao.tipo_avaliacao=t?.tipos_avaliacoes?.find(l=>l.id==i.avaliacao.tipo_avaliacao_id))})}checaBotaoAderirToolbar(){}planosEntregasAtivosUnidadePai(){return this.auth.unidade?.unidade_pai?.planos_entrega?.filter(a=>this.planoEntregaService.isAtivo(a))||[]}planosEntregasAtivosUnidadeSelecionada(){return this.auth?.unidade?.planos_entrega?.filter(a=>this.planoEntregaService.isAtivo(a))||[]}filterClear(a){a.controls.nome.setValue(""),a.controls.data_filtro.setValue(null),a.controls.data_filtro_inicio.setValue(new Date),a.controls.data_filtro_fim.setValue(new Date),a.controls.unidade_id.setValue(null),a.controls.planejamento_id.setValue(null),a.controls.cadeia_valor_id.setValue(null),a.controls.status.setValue(null),a.controls.meus_planos.setValue(!1),super.filterClear(a)}onAgruparChange(a){const t=this.filter.controls.agrupar.value;(t&&!this.groupBy?.length||!t&&this.groupBy?.length)&&(this.groupBy=t?[{field:"unidade.sigla",label:"Unidade"}]:[],this.cdRef.detectChanges(),this.grid.reloadFilter())}onPrincipaisChange(a){this.filter.controls.principais.value?(this.filter.controls.unidade_id.setValue(null),this.filter.controls.meus_planos.setValue(!1)):this.filter.controls.meus_planos.setValue(!0),this.grid.reloadFilter()}dynamicButtons(a){let t=[],n=a;switch(this.planoEntregaService.situacaoPlano(n)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_LIBERAR_HOMOLOGACAO,a)?t.push(this.BOTAO_LIBERAR_HOMOLOGACAO):t.push(this.BOTAO_CONSULTAR);break;case"HOMOLOGANDO":this.botaoAtendeCondicoes(this.BOTAO_HOMOLOGAR,a)&&t.push(this.BOTAO_HOMOLOGAR);break;case"ATIVO":this.botaoAtendeCondicoes(this.BOTAO_CONCLUIR,a)&&t.push(this.BOTAO_CONCLUIR);break;case"CONCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_AVALIAR,a)&&t.push(this.BOTAO_AVALIAR);break;case"SUSPENSO":this.botaoAtendeCondicoes(this.BOTAO_REATIVAR,a)&&t.push(this.BOTAO_REATIVAR);break;case"AVALIADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,a)&&t.push(this.BOTAO_ARQUIVAR);break;case"ARQUIVADO":this.botaoAtendeCondicoes(this.BOTAO_DESARQUIVAR,a)&&t.push(this.BOTAO_DESARQUIVAR)}return t.length||t.push(this.BOTAO_CONSULTAR),t}dynamicOptions(a){let t=[];return this.linha=a,this.botoes.forEach(n=>{this.botaoAtendeCondicoes(n,a)&&t.push(n)}),t}botaoAtendeCondicoes(a,t){switch(a){case this.BOTAO_ADERIR_OPTION:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&t.unidade_id==this.auth.unidade?.unidade_pai_id&&(this.unidadeService.isGestorUnidade()||this.auth.isLotacaoUsuario(this.auth.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ADR"))&&0==this.planosEntregasAtivosUnidadeSelecionada().filter(We=>this.util.intersection([{start:We.data_inicio,end:We.data_fim},{start:t.data_inicio,end:t.data_fim}])).length;case this.BOTAO_ALTERAR:let n=["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(t)),i=["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)),l=this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id)&&this.auth.hasPermissionTo("MOD_PENT_EDT_FLH"),u=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",t.unidade.unidade_pai_id),g="ATIVO"==this.planoEntregaService.situacaoPlano(t)&&this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo(["MOD_PENT_EDT_ATV_HOMOL","MOD_PENT_EDT_ATV_ATV"]),v=this.auth.hasPermissionTo("MOD_PENT_QQR_UND");return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EDT")&&n&&this.planoEntregaService.isValido(t)&&(i||l||u||g||v);case this.BOTAO_ARQUIVAR:return["CONCLUIDO","AVALIADO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_AVALIAR:let b=this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id),q=this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",t.unidade.id),ue=this.auth.isLotacaoUsuario(t.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_AVAL"),ge=this.auth.isGestorLinhaAscendente(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(t)&&(b||q||ue||ge);case this.BOTAO_CANCELAR_AVALIACAO:return"AVALIADO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id)||this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",t.unidade.id));case this.BOTAO_CANCELAR_CONCLUSAO:return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CANC_CONCL"));case this.BOTAO_CANCELAR_HOMOLOGACAO:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id)||this.auth.isLotacaoUsuario(t.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_CANC_HOMOL")||this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",t.unidade.unidade_pai_id));case this.BOTAO_CANCELAR_PLANO:return this.auth.hasPermissionTo("MOD_PENT_CNC")&&["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade?.id)||this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id));case this.BOTAO_CONCLUIR:return"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CONC"));case this.BOTAO_CONSULTAR:return this.auth.hasPermissionTo("MOD_PENT");case this.BOTAO_DESARQUIVAR:return"ARQUIVADO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_EXCLUIR:return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EXCL")&&["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade));case this.BOTAO_HOMOLOGAR:let Lo="HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(t),wo=this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id),qo=this.auth.isLotacaoUsuario(t.unidade.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_HOMOL"),Qo=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",t.unidade.unidade_pai_id);return!this.execucao&&Lo&&(wo||qo||Qo);case this.BOTAO_LIBERAR_HOMOLOGACAO:return!this.execucao&&"INCLUIDO"==this.planoEntregaService.situacaoPlano(t)&&t.entregas.length>0&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_LIB_HOMOL"));case this.BOTAO_LOGS:return this.unidadeService.isGestorUnidade(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");case this.BOTAO_REATIVAR:return"SUSPENSO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RTV")||this.auth.isGestorLinhaAscendente(t.unidade));case this.BOTAO_RETIRAR_HOMOLOGACAO:return!this.execucao&&"HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RET_HOMOL"));case this.BOTAO_SUSPENDER:return"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_SUSP")||this.auth.isGestorLinhaAscendente(t.unidade))}return!1}arquivar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},a,{arquivar:!0}),novoStatus:a.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}avaliar(a){this.go.navigate({route:["gestao","plano-entrega",a.id,"avaliar"]},{modal:!0,metadata:{planoEntrega:a},modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id,["avaliacao.tipo_avaliacao.notas"]).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarAvaliacao(a){var t=this;return(0,d.Z)(function*(){t.submitting=!0;try{(yield t.avaliacaoDao.cancelarAvaliacao(a.avaliacao.id))&&(t.grid?.query||t.query).refreshId(a.id).then(()=>{t.checaBotaoAderirToolbar()})}catch(n){t.error(n.message||n)}finally{t.submitting=!1}})()}cancelarConclusao(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"ATIVO",onClick:this.dao.cancelarConclusao.bind(this.dao)},title:"Cancelar Conclus\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarHomologacao(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"HOMOLOGANDO",onClick:this.dao.cancelarHomologacao.bind(this.dao)},title:"Cancelar Homologa\xe7\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarPlano(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},a,{arquivar:!0}),novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}concluir(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"CONCLUIDO",onClick:this.dao.concluir.bind(this.dao)},title:"Concluir Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}desarquivar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},a,{arquivar:!1}),novoStatus:a.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}homologar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"ATIVO",onClick:this.dao.homologar.bind(this.dao)},title:"Homologar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}liberarHomologacao(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"HOMOLOGANDO",onClick:this.dao.liberarHomologacao.bind(this.dao)},title:"Liberar para Homologa\xe7\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}reativar(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}retirarHomologacao(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"INCLUIDO",onClick:this.dao.retirarHomologacao.bind(this.dao)},title:"Retirar de Homologa\xe7\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}suspender(a){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:a,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(a.id).then(()=>{this.checaBotaoAderirToolbar()})}})}canAdd(){return this.auth.hasPermissionTo("MOD_PENT_INCL")}}(X=Ze).\u0275fac=function(a){return new(a||X)(e.Y36(e.zs3))},X.\u0275cmp=e.Xpm({type:X,selectors:[["plano-entrega-list"]],viewQuery:function(a,t){if(1&a&&e.Gf(h.M,5),2&a){let n;e.iGM(n=e.CRH())&&(t.grid=n.first)}},features:[e.qOj],decls:34,vars:35,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList","select"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed","visible"],[4,"ngIf","ngIfElse"],["naoEModal",""],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template"],["titleIdNumeroStatus",""],["columnNumero",""],["titleNomeProgramaUnidade",""],["columnNome",""],["title","In\xedcio","orderBy","data_inicio",3,"template"],["columnInicio",""],["title","Fim","orderBy","data_fim",3,"template"],["columnFim",""],["titlePlanoCadeia",""],["columnPlanoCadeia",""],[3,"title","template"],["columnStatus",""],["type","options",3,"dynamicOptions","dynamicButtons"],[3,"rows"],[3,"buttons"],["labelPosition","left","label","Agrupar por Un.","controlName","agrupar",3,"size","control","change"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change",4,"ngIf"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["unidade",""],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["label","Meus","controlName","meus_planos","labelInfo","Planos de entrega das unidade da qual sou integrante (\xc1reas de trabalho)",3,"size","control"],["label","Nome","controlName","nome",3,"size","control","placeholder"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","control","items","filter","valueTodos"],["label","Arq.","controlName","arquivadas","labelInfo","Listar tamb\xe9m os planos de entregas arquivados",3,"size","control"],["controlName","planejamento_id",3,"size","control","dao"],["planejamento",""],["controlName","cadeia_valor_id",3,"size","control","dao"],["cadeiaValor",""],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["columnEntregas",""],["columnExpandedEntregas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"parent","disabled","entity","execucao","cdRef","planejamentoId","cadeiaValorId","unidadeId"],["by","numero",3,"header"],[1,"micro-text","fw-ligh"],["by","nome",3,"header"],[1,"text-break","text-wrap"],["color","light",3,"icon","label",4,"ngIf"],["color","secondary",3,"icon","label",4,"ngIf"],["color","light",3,"icon","label"],["color","secondary",3,"icon","label"],["color","light",3,"maxWidth","icon","label",4,"ngIf"],["color","light",3,"maxWidth","icon","label"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"],[3,"align","tipoAvaliacao","nota"]],template:function(a,t){if(1&a&&(e.TgZ(0,"grid",0),e.NdJ("select",function(i){return t.onSelect(i)}),e.YNc(1,Lt,3,4,"toolbar",1),e.TgZ(2,"filter",2),e.YNc(3,wt,7,13,"div",3),e.YNc(4,Qt,15,33,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"columns"),e.YNc(7,St,5,4,"column",5),e.TgZ(8,"column",6),e.YNc(9,Vt,2,1,"ng-template",null,7,e.W1O),e.YNc(11,zt,2,1,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"column",6),e.YNc(14,jt,4,2,"ng-template",null,9,e.W1O),e.YNc(16,kt,5,5,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(18,"column",11),e.YNc(19,Bt,2,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(21,"column",13),e.YNc(22,Yt,2,1,"ng-template",null,14,e.W1O),e.qZA(),e.TgZ(24,"column",6),e.YNc(25,Ht,3,0,"ng-template",null,15,e.W1O),e.YNc(27,Xt,2,2,"ng-template",null,16,e.W1O),e.qZA(),e.TgZ(29,"column",17),e.YNc(30,aa,5,6,"ng-template",null,18,e.W1O),e.qZA(),e._UZ(32,"column",19),e.qZA(),e._UZ(33,"pagination",20),e.qZA()),2&a){const n=e.MAs(5),i=e.MAs(10),l=e.MAs(12),u=e.MAs(15),g=e.MAs(17),v=e.MAs(20),b=e.MAs(23),q=e.MAs(26),ue=e.MAs(28),ge=e.MAs(31);e.Q6J("dao",t.dao)("add",t.add)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("selectable",t.selectable)("hasAdd",t.canAdd())("hasEdit",!1)("loadList",t.onGridLoad.bind(t)),e.xp6(1),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&t.filterCollapsed)("visible",t.showFilter),e.xp6(1),e.Q6J("ngIf",t.isModal)("ngIfElse",n),e.xp6(4),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("titleTemplate",i)("template",l),e.xp6(5),e.Q6J("titleTemplate",u)("template",g),e.xp6(5),e.Q6J("template",v),e.xp6(3),e.Q6J("template",b),e.xp6(3),e.Q6J("titleTemplate",q)("template",ue),e.xp6(5),e.Q6J("title","Status\nAvalia\xe7\xe3o")("template",ge),e.xp6(3),e.Q6J("dynamicOptions",t.dynamicOptions.bind(t))("dynamicButtons",t.dynamicButtons.bind(t)),e.xp6(1),e.Q6J("rows",t.rowsLimit)}},dependencies:[O.O5,h.M,m.a,f.b,p.z,x.n,j.Q,Pe.a,R.V,F.m,w.k,G.p,ve.l,N.F,Ke.M,Ee]});var $,xe=s(92214),me=s(1184);const na=["programa"],oa=["unidade"],ia=["nome"],la=["data_fim"];class he extends me.F{constructor(a){super(a,L,I.r),this.injector=a,this.validate=(t,n)=>{let i=null;return["nome","unidade_id","programa_id"].indexOf(n)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(t.value)&&(i="Inv\xe1lido"),["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(t.value)&&(i="Inv\xe1lido"),i},this.formValidation=t=>{const n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;if(!this.programa?.selectedEntity)return"Obrigat\xf3rio selecionar o programa";if(!this.dao?.validDateTime(n))return"Data de in\xedcio inv\xe1lida";if(!this.dao?.validDateTime(i))return"Data de fim inv\xe1lida";if(n>i)return"A data do fim n\xe3o pode ser menor que a data do in\xedcio!";{const u=this.form.controls.entregas.value||[];for(let g of u){if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_inicio<n)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data inicial anterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(n);if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_fim>i)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data fim posterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(i)}}},this.titleEdit=t=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(t?.nome||""),this.unidadeDao=a.get(D.J),this.programaDao=a.get(xe.w),this.cadeiaValorDao=a.get(Z.m),this.planoEntregaDao=a.get(I.r),this.planejamentoInstitucionalDao=a.get(P.U),this.join=["entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","unidade","entregas.reacoes.usuario:id,nome,apelido"],this.modalWidth=1200,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},unidade_id:{default:""},plano_entrega_id:{default:null},planejamento_id:{default:null},cadeia_valor_id:{default:null},programa_id:{default:null},entregas:{default:[]}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!0,vigentesUnidadeExecutora:!1}}loadData(a,t){var n=this;return(0,d.Z)(function*(){let i=Object.assign({},t.value);t.patchValue(n.util.fillForm(i,a)),n.cdRef.detectChanges()})()}initializeData(a){var t=this;return(0,d.Z)(function*(){t.entity=new L,t.entity.unidade_id=t.auth.unidade?.id||"",t.entity.unidade=t.auth.unidade;let n=yield t.programaDao.query({where:[["vigentesUnidadeExecutora","==",t.auth.unidade.id]]}).asPromise(),i=n[n.length-1];t.entity.programa=i,t.entity.programa_id=i.id;const l=new Date(t.entity.data_inicio).toLocaleDateString(),u=t.entity.data_fim?new Date(t.entity.data_fim).toLocaleDateString():(new Date).toLocaleDateString();t.entity.nome=t.auth.unidade.sigla+" - "+l+" - "+u,t.loadData(t.entity,t.form)})()}saveData(a){var t=this;return(0,d.Z)(function*(){return new Promise((n,i)=>{let l=t.util.fill(new L,t.entity);l=t.util.fillForm(l,t.form.value),l.entregas=l.entregas?.filter(u=>u._status)||[],n(l)})})()}dynamicButtons(a){return[]}onDataChange(){this.sugereNome()}onUnidadeChange(){var a=this;return(0,d.Z)(function*(){let n=a.form.controls.unidade_id.value||a.auth.unidade?.id;if(n)try{yield a.planoEntregaDao.permissaoIncluir(n)}catch(i){a.error(i)}a.sugereNome()})()}sugereNome(){const a=this.unidade?.selectedItem?this.unidade?.selectedItem?.entity.sigla:this.auth.unidade?.sigla,t=new Date(this.form.controls.data_inicio.value).toLocaleDateString(),n=this.form.controls.data_fim.value?" - "+new Date(this.form.controls.data_fim.value).toLocaleDateString():"";this.form.controls.nome.setValue(a+" - "+t+n)}somaDia(a,t){let n=new Date(a);return n.setDate(n.getDate()+t),n}onProgramaChange(){const a=this.programa?.selectedEntity?.prazo_max_plano_entrega,t=this.somaDia(this.entity.data_inicio,a);this.entity?.data_fim||(this.form.controls.data_fim.setValue(new Date(t)),this.dataFim?.change.emit())}}($=he).\u0275fac=function(a){return new(a||$)(e.Y36(e.zs3))},$.\u0275cmp=e.Xpm({type:$,selectors:[["app-plano-entrega-form"]],viewQuery:function(a,t){if(1&a&&(e.Gf(y.Q,5),e.Gf(h.M,7),e.Gf(na,7),e.Gf(oa,7),e.Gf(ia,7),e.Gf(la,7)),2&a){let n;e.iGM(n=e.CRH())&&(t.editableForm=n.first),e.iGM(n=e.CRH())&&(t.grid=n.first),e.iGM(n=e.CRH())&&(t.programa=n.first),e.iGM(n=e.CRH())&&(t.unidade=n.first),e.iGM(n=e.CRH())&&(t.nomePE=n.first),e.iGM(n=e.CRH())&&(t.dataFim=n.first)}},features:[e.qOj],decls:20,vars:28,consts:[["initialFocus","entregas",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","unidade_id","required","",3,"size","disabled","dao","change"],["unidade",""],["controlName","programa_id","required","",3,"size","disabled","dao","metadata","change"],["programa",""],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo","change"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo","change"],["data_fim",""],["label","Nome","controlName","nome","required","",3,"size"],["nome",""],["controlName","planejamento_id","label","Planejamento Institucional",3,"size","emptyValue","dao"],["planejamento",""],["controlName","cadeia_valor_id","label","Cadeia de Valor",3,"size","emptyValue","dao"],["cadeiaValor",""],["title","Entregas"],["noPersist","",3,"disabled","control","planejamentoId","cadeiaValorId","unidadeId","dataFim"],["entregas",""]],template:function(a,t){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"div")(2,"div",1)(3,"input-search",2,3),e.NdJ("change",function(){return t.onUnidadeChange()}),e.qZA(),e.TgZ(5,"input-search",4,5),e.NdJ("change",function(){return t.onProgramaChange()}),e.qZA(),e.TgZ(7,"input-datetime",6),e.NdJ("change",function(){return t.onDataChange()}),e.qZA(),e.TgZ(8,"input-datetime",7,8),e.NdJ("change",function(){return t.onDataChange()}),e.qZA()(),e.TgZ(10,"div",1),e._UZ(11,"input-text",9,10)(13,"input-search",11,12)(15,"input-search",13,14),e.qZA(),e._UZ(17,"separator",15)(18,"plano-entrega-list-entrega",16,17),e.qZA()()),2&a&&(e.Q6J("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),e.xp6(3),e.Q6J("size",4)("disabled",null!=t.entity&&t.entity.id?"disabled":void 0)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",4)("disabled",null!=t.entity&&t.entity.id?"disabled":void 0)("dao",t.programaDao)("metadata",t.programaMetadata),e.xp6(2),e.Q6J("size",2)("labelInfo","In\xedcio "+t.lex.translate("Plano de Entrega")),e.xp6(1),e.Q6J("size",2)("labelInfo","Fim "+t.lex.translate("Plano de Entrega")),e.xp6(3),e.Q6J("size",4),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",4)("emptyValue",null)("dao",t.planejamentoInstitucionalDao),e.xp6(2),e.Q6J("size",4)("emptyValue",null)("dao",t.cadeiaValorDao),e.xp6(3),e.Q6J("disabled",t.formDisabled)("control",t.form.controls.entregas)("planejamentoId",t.form.controls.planejamento_id.value)("cadeiaValorId",t.form.controls.cadeia_valor_id.value)("unidadeId",t.form.controls.unidade_id.value)("dataFim",t.form.controls.data_fim.value))},dependencies:[y.Q,R.V,F.m,w.k,Y.N,Ee]});var ee,Ne=s(67465),ye=s(91058),Ue=s(67501),sa=s(19108);const ra=["unidade"];function da(o,a){if(1&o&&e._UZ(0,"planejamento-show",18),2&o){const t=e.oxw(2);e.Q6J("planejamento",t.objetivo.planejamento)}}function ca(o,a){if(1&o&&(e.ynx(0),e.YNc(1,da,1,1,"planejamento-show",16),e.TgZ(2,"div",17)(3,"h5"),e._uU(4,"Objetivo:"),e.qZA(),e.TgZ(5,"h6"),e._uU(6),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.objetivo.planejamento),e.xp6(5),e.Oqu(t.objetivo.nome)}}function ua(o,a){if(1&o&&(e.TgZ(0,"div",21)(1,"h6"),e._uU(2,"Cadeia de valor:"),e.qZA(),e.TgZ(3,"h4"),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(4),e.Oqu(t.processo.cadeia_valor.nome)}}function ga(o,a){if(1&o&&(e.ynx(0),e.YNc(1,ua,5,1,"div",19),e.TgZ(2,"div",20)(3,"h5"),e._uU(4,"Processo:"),e.qZA(),e.TgZ(5,"h6"),e._uU(6),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.processo.cadeia_valor),e.xp6(5),e.Oqu(t.processo.nome)}}function _a(o,a){if(1&o&&e._UZ(0,"badge",25),2&o){const t=e.oxw().row,n=e.oxw();e.Q6J("icon",n.entityService.getIcon("Unidade"))("label",t.plano_entrega.unidade.sigla)}}function pa(o,a){if(1&o&&e._UZ(0,"badge",26),2&o){const t=e.oxw().row;e.Q6J("label",t.destinatario)}}function ma(o,a){if(1&o&&(e._uU(0),e._UZ(1,"br"),e.TgZ(2,"span",22),e.YNc(3,_a,1,2,"badge",23),e.YNc(4,pa,1,1,"badge",24),e.qZA()),2&o){const t=a.row;e.hij(" ",t.descricao,""),e.xp6(3),e.Q6J("ngIf",t.plano_entrega.unidade),e.xp6(1),e.Q6J("ngIf",null==t.destinatario?null:t.destinatario.length)}}function ha(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_inicio),"")}}function fa(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_fim),"")}}function va(o,a){if(1&o&&(e.YNc(0,ha,2,1,"span",0),e._UZ(1,"br"),e.YNc(2,fa,2,1,"span",0)),2&o){const t=a.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function Ea(o,a){if(1&o&&e._UZ(0,"progress-bar",27),2&o){const t=a.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}class be extends r.E{constructor(a){super(a,k.O,U.K),this.injector=a,this.filterWhere=t=>{let n=[],i=t.value;return this.objetivoId&&n.push(["objetivos.objetivo_id","==",this.objetivoId]),this.processoId&&n.push(["processos.processo_id","==",this.processoId]),i.unidade_id&&n.push(["plano_entrega.unidade_id","==",i.unidade_id]),i.entrega_id&&n.push(["entrega_id","==",i.entrega_id]),i.data_inicio&&n.push(["data_inicio",">=",i.data_inicio]),i.data_fim&&n.push(["data_fim","<=",i.data_fim]),n},this.unidadeDao=a.get(D.J),this.entregaDao=a.get(Ne.y),this.entregaService=a.get(c.f),this.objetivoDao=a.get(ye.e),this.processoDao=a.get(Ue.k),this.join=["plano_entrega.unidade"],this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({unidade_id:{default:null},entrega_id:{default:null},data_inicio:{default:null},data_fim:{default:null}})}ngOnInit(){super.ngOnInit(),this.objetivoId=this.urlParams.get("objetivo_id")||void 0,this.processoId=this.urlParams.get("processo_id")||void 0,this.objetivoId&&this.objetivoDao?.getById(this.objetivoId,["planejamento"]).then(a=>{this.objetivo=a}),this.processoId&&this.processoDao?.getById(this.processoId,["cadeia_valor"]).then(a=>{this.processo=a})}filterClear(a){a.controls.unidade_id.setValue(null),a.controls.entrega_id.setValue(null),a.controls.data_inicio.setValue(null),a.controls.data_fim.setValue(null),super.filterClear(a)}}var te;(ee=be).\u0275fac=function(a){return new(a||ee)(e.Y36(e.zs3))},ee.\u0275cmp=e.Xpm({type:ee,selectors:[["plano-entrega-mapa-entregas"]],viewQuery:function(a,t){if(1&a&&(e.Gf(h.M,5),e.Gf(ra,5)),2&a){let n;e.iGM(n=e.CRH())&&(t.grid=n.first),e.iGM(n=e.CRH())&&(t.unidade=n.first)}},features:[e.qOj],decls:23,vars:31,consts:[[4,"ngIf"],[3,"dao","title","orderBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["unidade",""],["controlName","entrega_id",3,"size","control","dao"],["entrega",""],["date","","noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data de in\xedcio do planejamento institucional",3,"size","control"],["date","","noIcon","","label","Fim","controlName","data_fim","labelInfo","Data do fim do planejamento institucional",3,"size","control"],[3,"title","template"],["columnEntregaCliente",""],["columnDatas",""],[3,"title","width","template"],["columnProgresso",""],[3,"rows"],[3,"planejamento",4,"ngIf"],[1,"objetivos","arrow_box","w-100"],[3,"planejamento"],["class","planejamento arrow_box first-box w-100",4,"ngIf"],[1,"procesos","arrow_box","w-100"],[1,"planejamento","arrow_box","first-box","w-100"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["color","success",3,"value","goal"]],template:function(a,t){if(1&a&&(e.YNc(0,ca,7,2,"ng-container",0),e.YNc(1,ga,7,2,"ng-container",0),e.TgZ(2,"grid",1),e._UZ(3,"toolbar"),e.TgZ(4,"filter",2)(5,"div",3),e._UZ(6,"input-search",4,5)(8,"input-search",6,7)(10,"input-datetime",8)(11,"input-datetime",9),e.qZA()(),e.TgZ(12,"columns")(13,"column",10),e.YNc(14,ma,5,3,"ng-template",null,11,e.W1O),e.qZA(),e.TgZ(16,"column",10),e.YNc(17,va,3,2,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(19,"column",13),e.YNc(20,Ea,1,2,"ng-template",null,14,e.W1O),e.qZA()(),e._UZ(22,"pagination",15),e.qZA()),2&a){const n=e.MAs(15),i=e.MAs(18),l=e.MAs(21);e.Q6J("ngIf",t.objetivo),e.xp6(1),e.Q6J("ngIf",t.processo),e.xp6(1),e.Q6J("dao",t.dao)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("join",t.join),e.xp6(2),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&t.filterCollapsed),e.xp6(2),e.Q6J("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",4)("control",t.filter.controls.entrega_id)("dao",t.entregaDao),e.xp6(2),e.Q6J("size",2)("control",t.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",2)("control",t.filter.controls.data_fim),e.xp6(2),e.Q6J("title","Entrega\nDemandante/Destinat\xe1rio")("template",n),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",i),e.xp6(3),e.Q6J("title","Progresso")("width",200)("template",l),e.xp6(3),e.Q6J("rows",t.rowsLimit)}},dependencies:[O.O5,h.M,m.a,f.b,p.z,x.n,j.Q,R.V,w.k,N.F,H.R,sa.W]});const ba=function(){return["gestao","plano-entrega"]},Aa=function(o){return{unidade_id:o,status:"ATIVO"}},Ta=function(o){return{showFilter:!1,filter:o}},Oa=function(o,a){return{route:o,params:a}},Ca=function(o){return["unidade_id","=",o]},Pa=function(){return["status","=","ATIVO"]},Ia=function(o,a){return[o,a]};class Le extends me.F{constructor(a){super(a,L,I.r),this.injector=a,this.validate=(t,n)=>{let i=null;return["nome","plano_entrega_id"].indexOf(n)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),i},this.titleEdit=t=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(t?.nome||""),this.unidadeDao=a.get(D.J),this.programaDao=a.get(xe.w),this.planoEntregaDao=a.get(I.r),this.cadeiaValorDao=a.get(Z.m),this.planejamentoInstitucionalDao=a.get(P.U),this.join=[],this.modalWidth=1e3,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:""},data_fim:{default:""},planejamento_id:{default:null},cadeia_valor_id:{default:null},unidade_id:{default:this.auth.unidade?.id},plano_entrega_id:{default:null},programa_id:{default:null},status:{default:"HOMOLOGANDO"}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();let a=this.metadata?.planoEntrega?this.metadata?.planoEntrega:null;a&&(this.form.controls.plano_entrega_id.setValue(a.id),this.form.controls.nome.setValue(a.nome),this.form.controls.data_inicio.setValue(a.data_inicio),this.form.controls.data_fim.setValue(a.data_fim),this.form.controls.planejamento_id.setValue(a.planejamento_id),this.form.controls.cadeia_valor_id.setValue(a.cadeia_valor_id))}loadData(a,t){var n=this;return(0,d.Z)(function*(){let i=Object.assign({},t.value);t.patchValue(n.util.fillForm(i,a)),n.cdRef.detectChanges()})()}initializeData(a){var t=this;return(0,d.Z)(function*(){t.loadData(t.entity,t.form)})()}saveData(a){var t=this;return(0,d.Z)(function*(){return new Promise((n,i)=>{let l=t.util.fill(new L,t.entity);l=t.util.fillForm(l,t.form.value),n(l)})})()}onPlanoEntregaChange(a){this.form.controls.plano_entrega_id.value&&(this.form.controls.nome.setValue(this.planoEntrega?.selectedEntity.nome),this.form.controls.data_inicio.setValue(this.planoEntrega?.selectedEntity.data_inicio),this.form.controls.data_fim.setValue(this.planoEntrega?.selectedEntity.data_fim),this.form.controls.planejamento_id.setValue(this.planoEntrega?.selectedEntity.planejamento_id),this.form.controls.cadeia_valor_id.setValue(this.planoEntrega?.selectedEntity.cadeia_valor_id),this.form.controls.programa_id.setValue(this.planoEntrega?.selectedEntity.programa_id))}}(te=Le).\u0275fac=function(a){return new(a||te)(e.Y36(e.zs3))},te.\u0275cmp=e.Xpm({type:te,selectors:[["plano-entrega-adesao"]],viewQuery:function(a,t){if(1&a&&(e.Gf(y.Q,5),e.Gf(h.M,7),e.Gf(R.V,7)),2&a){let n;e.iGM(n=e.CRH())&&(t.editableForm=n.first),e.iGM(n=e.CRH())&&(t.grid=n.first),e.iGM(n=e.CRH())&&(t.planoEntrega=n.first)}},features:[e.qOj],decls:21,vars:39,consts:[["initialFocus","plano_entrega_id",3,"form","disabled","title","submit","cancel"],[1,"row","mb-4"],["controlName","plano_entrega_id","label","Plano de Entregas da Unidade-pai","required","",3,"size","dao","selectRoute","where","change"],["planoEntrega",""],[1,"row"],["label","Nome deste Plano de Entregas","controlName","nome","required","",3,"size"],["disabled","","controlName","unidade_id",3,"size","label","dao"],["disabled","","label","Status","controlName","status",3,"size"],[1,"row","mt-4"],["title","Dados herdados do Plano de Entregas da Unidade-pai",3,"collapse"],["disabled","","label","Programa de Gest\xe3o","controlName","programa_id",3,"size","dao"],["disabled","","label","Planejamento Institucional","controlName","planejamento_id",3,"size","dao"],["disabled","","controlName","data_inicio","label","In\xedcio",3,"size","labelInfo"],["disabled","","label","Cadeia de Valor","controlName","cadeia_valor_id",3,"size","dao"],["disabled","","controlName","data_fim","label","Fim",3,"size","labelInfo"]],template:function(a,t){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"div")(2,"div",1)(3,"input-search",2,3),e.NdJ("change",function(i){return t.onPlanoEntregaChange(i)}),e.qZA(),e._UZ(5,"separator"),e.qZA(),e.TgZ(6,"div",4),e._UZ(7,"input-text",5),e.qZA(),e.TgZ(8,"div",4),e._UZ(9,"input-search",6)(10,"input-text",7),e.qZA(),e.TgZ(11,"div",8)(12,"separator",9)(13,"div",4),e._UZ(14,"input-search",10),e.qZA(),e.TgZ(15,"div",4),e._UZ(16,"input-search",11)(17,"input-datetime",12),e.qZA(),e.TgZ(18,"div",4),e._UZ(19,"input-search",13)(20,"input-datetime",14),e.qZA()()()()()),2&a&&(e.Q6J("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),e.xp6(3),e.Q6J("size",12)("dao",t.planoEntregaDao)("selectRoute",e.WLB(30,Oa,e.DdM(25,ba),e.VKq(28,Ta,e.VKq(26,Aa,t.auth.unidade.unidade_pai_id))))("where",e.WLB(36,Ia,e.VKq(33,Ca,t.auth.unidade.unidade_pai_id),e.DdM(35,Pa))),e.xp6(4),e.Q6J("size",12),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",9)("label",t.lex.translate("Unidade"))("dao",t.unidadeDao),e.xp6(1),e.Q6J("size",3),e.uIk("maxlength",250),e.xp6(2),e.Q6J("collapse","collapse"),e.xp6(2),e.Q6J("size",12)("dao",t.programaDao),e.xp6(2),e.Q6J("size",9)("dao",t.planejamentoInstitucionalDao),e.xp6(1),e.Q6J("size",3)("labelInfo","In\xedcio "+t.lex.translate("Plano de Entrega")),e.xp6(2),e.Q6J("size",9)("dao",t.cadeiaValorDao),e.xp6(1),e.Q6J("size",3)("labelInfo","Fim "+t.lex.translate("Plano de Entrega")))},dependencies:[y.Q,R.V,F.m,w.k,Y.N]});var ae,Da=s(92307),Za=s(74508),we=s(66384),qe=s(74978);const xa=["gridProcessos"],Na=["gridObjetivos"],ya=["entregas"],Ua=["planejamento"],La=["cadeiaValor"],wa=["inputObjetivo"],qa=["inputProcesso"],Qa=["entrega"],Ra=["unidade"],Ja=["tabs"],Ma=["etiqueta"];function Sa(o,a){if(1&o&&(e.TgZ(0,"div",4),e._UZ(1,"plano-entrega-valor-meta-input",29)(2,"input-number",30),e.TgZ(3,"div",4),e._UZ(4,"plano-entrega-valor-meta-input",31)(5,"input-number",32),e.qZA()()),2&o){const t=e.oxw(),n=e.MAs(31);e.xp6(1),e.Q6J("entrega",null==n?null:n.selectedEntity)("size",6)("control",t.form.controls.meta),e.xp6(1),e.Q6J("size",6),e.xp6(2),e.Q6J("entrega",null==n?null:n.selectedEntity)("size",6)("control",t.form.controls.realizado)("change",t.onRealizadoChange.bind(t)),e.xp6(1),e.Q6J("size",6)("stepValue",.01)}}function Va(o,a){1&o&&(e.TgZ(0,"div",4),e._UZ(1,"input-number",30)(2,"input-number",32),e.qZA()),2&o&&(e.xp6(1),e.Q6J("size",6),e.xp6(1),e.Q6J("size",6)("stepValue",.01))}function za(o,a){if(1&o&&(e.TgZ(0,"order",42),e._uU(1,"Objetivos"),e.qZA()),2&o){const t=a.header;e.Q6J("header",t)}}function ja(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.row;e.xp6(1),e.Oqu(null==t.objetivo?null:t.objetivo.nome)}}const Fa=function(o){return["planejamento_id","==",o]},Qe=function(o){return[o]},Ga=function(){return["gestao","planejamento","objetivoList"]},ka=function(o){return{planejamento_id:o}},Re=function(o){return{filter:o}},Je=function(o,a){return{route:o,params:a}};function Ba(o,a){if(1&o&&e._UZ(0,"input-search",43,44),2&o){const t=e.oxw(2);e.Q6J("size",12)("where",e.VKq(6,Qe,e.VKq(4,Fa,t.planejamentoId)))("dao",t.planejamentoObjetivoDao)("selectRoute",e.WLB(13,Je,e.DdM(8,Ga),e.VKq(11,Re,e.VKq(9,ka,t.planejamentoId))))}}function Ya(o,a){if(1&o&&(e.TgZ(0,"tab",33),e._UZ(1,"input-search",34,35),e.TgZ(3,"grid",36,37)(5,"columns")(6,"column",38),e.YNc(7,za,2,1,"ng-template",null,39,e.W1O),e.YNc(9,ja,2,1,"ng-template",null,40,e.W1O),e.YNc(11,Ba,2,16,"ng-template",null,41,e.W1O),e.qZA(),e._UZ(13,"column",12),e.qZA()()()),2&o){const t=e.MAs(8),n=e.MAs(10),i=e.MAs(12),l=e.oxw();e.xp6(1),e.Q6J("size",12)("dao",l.planejamentoDao),e.xp6(2),e.Q6J("control",l.form.controls.objetivos)("form",l.formObjetivos)("orderBy",l.orderBy)("hasDelete",!0)("hasEdit",!0)("add",l.addObjetivo.bind(l))("remove",l.removeObjetivo.bind(l))("save",l.saveObjetivo.bind(l)),e.xp6(3),e.Q6J("titleTemplate",t)("template",n)("editTemplate",i)}}function Ha(o,a){if(1&o&&(e.TgZ(0,"order",53),e._uU(1,"Processos"),e.qZA()),2&o){const t=a.header;e.Q6J("header",t)}}function Wa(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.row;e.xp6(1),e.Oqu(null==t.processo?null:t.processo.nome)}}const Ka=function(o){return["cadeia_valor_id","==",o]},Xa=function(){return["gestao","cadeia-valor","processoList"]},$a=function(o){return{cadeia_valor_id:o}};function en(o,a){if(1&o&&e._UZ(0,"input-search",54,55),2&o){const t=e.oxw(2);e.Q6J("size",12)("where",e.VKq(6,Qe,e.VKq(4,Ka,t.cadeiaValorId)))("dao",t.cadeiaValorProcessoDao)("selectRoute",e.WLB(13,Je,e.DdM(8,Xa),e.VKq(11,Re,e.VKq(9,$a,t.cadeiaValorId))))}}function tn(o,a){if(1&o&&(e.TgZ(0,"tab",45),e._UZ(1,"input-search",46,47),e.TgZ(3,"grid",36,48)(5,"columns")(6,"column",38),e.YNc(7,Ha,2,1,"ng-template",null,49,e.W1O),e.YNc(9,Wa,2,1,"ng-template",null,50,e.W1O),e.YNc(11,en,2,16,"ng-template",null,51,e.W1O),e.qZA(),e._UZ(13,"column",52),e.qZA()()()),2&o){const t=e.MAs(8),n=e.MAs(10),i=e.MAs(12),l=e.oxw();e.xp6(1),e.Q6J("size",12)("dao",l.cadeiaValorDao),e.xp6(2),e.Q6J("control",l.form.controls.processos)("form",l.formProcessos)("orderBy",l.orderBy)("hasDelete",!0)("hasEdit",!0)("add",l.addProcesso.bind(l))("remove",l.removeProcesso.bind(l))("save",l.saveProcesso.bind(l)),e.xp6(3),e.Q6J("titleTemplate",t)("template",n)("editTemplate",i),e.xp6(7),e.Q6J("dynamicButtons",l.dynamicButtonsProcessos.bind(l))}}const an=function(o){return["plano_entrega.unidade_id","in",o]},nn=function(){return["gestao","plano-entrega","entrega-list"]},on=function(o){return{route:o}},ln=function(o){return{idsUnidadesAscendentes:o}};class Ae extends me.F{constructor(a){super(a,k.O,U.K),this.injector=a,this.itensQualitativo=[],this.idsUnidadesAscendentes=[],this.checklist=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.validate=(t,n)=>{let i=null;return["descricao","destinatario"].indexOf(n)>=0?t.value?.length?this.entrega.selectedEntity&&this.entrega.selectedEntity.descricao==t.value&&(i="\xc9 necess\xe1rio incrementar ou modificar a descri\xe7\xe3o da entrega"):i="Obrigat\xf3rio":["progresso_realizado","realizado"].indexOf(n)>=0&&!(t.value>=0||t.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(t.value>0||t.value?.length>0)?i="Obrigat\xf3rio":["unidade_id"].indexOf(n)>=0&&!t.value?.length?i="A unidade demandante \xe9 obrigat\xf3ria":["entrega_id"].indexOf(n)>=0&&!t.value?.length?i="A entrega \xe9 obrigat\xf3ria":["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(t.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(t.value)?i="Inv\xe1lido":["planejamento_objetivo_id"].indexOf(n)>=0?(t.value?.length||(i="O objetivo do planejamento \xe9 obrigat\xf3rio"),t.value?.length&&this.gridObjetivos?.items.filter(l=>"ADD"==l._status).map(l=>l.planejamento_objetivo_id).includes(this.formObjetivos.controls.planejamento_objetivo_id.value)&&(i="Este objetivo est\xe1 em duplicidade!")):["cadeia_processo_id"].indexOf(n)>=0&&(t.value?.length||(i="O processo da cadeia de valor \xe9 obrigat\xf3rio"),t.value?.length&&this.gridProcessos?.items.map(l=>l.cadeia_processo_id).includes(this.formProcessos.controls.cadeia_processo_id.value)&&(i="Este processo est\xe1 em duplicidade!")),i},this.formValidation=t=>{let n=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;return this.gridObjetivos?.editing?(this.tabs.active="OBJETIVOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.gridProcessos?.editing?(this.tabs.active="PROCESSOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.dao?.validDateTime(n)?this.dao?.validDateTime(i)?n>i?"A data do fim n\xe3o pode ser anterior \xe0 data do in\xedcio!":!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&n<this.planoEntrega.data_inicio?"Data de inicio menor que a data de inicio "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_inicio):!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&this.planoEntrega.data_fim&&i>this.planoEntrega.data_fim?"Data de fim maior que a data de fim "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_fim):void 0:"Data de fim inv\xe1lida":"Data de in\xedcio inv\xe1lida"},this.planejamentoDao=a.get(P.U),this.unidadeDao=a.get(D.J),this.entregaDao=a.get(Ne.y),this.planoEntregaDao=a.get(I.r),this.planejamentoInstitucionalDao=a.get(P.U),this.planoEntregaEntregaDao=a.get(U.K),this.cadeiaValorDao=a.get(Z.m),this.cadeiaValorProcessoDao=a.get(Ue.k),this.planejamentoObjetivoDao=a.get(ye.e),this.planoEntregaService=a.get(c.f),this.modalWidth=700,this.join=["entrega","objetivos.objetivo","processos.processo"],this.form=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},descricao_meta:{default:""},realizado:{default:null},plano_entrega_id:{default:""},entrega_pai_id:{default:null},entrega_id:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},unidade_id:{default:null},destinatario:{default:null},objetivos:{default:[]},processos:{default:[]},listaQualitativo:{default:[]},planejamento_id:{default:null},cadeia_valor_id:{default:null},objetivo_id:{default:null},objetivo:{default:null},checklist:{default:[]},etiquetas:{default:[]},etiqueta:{default:""}},this.cdRef,this.validate),this.formObjetivos=this.fh.FormBuilder({planejamento_objetivo_id:{default:null}},this.cdRef,this.validate),this.formProcessos=this.fh.FormBuilder({cadeia_processo_id:{default:null}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef)}ngOnInit(){super.ngOnInit();this.planoEntrega=this.metadata?.plano_entrega,this.planejamentoId=this.metadata?.planejamento_id,this.cadeiaValorId=this.metadata?.cadeia_valor_id,this.unidadeId=this.metadata?.unidade_id,this.metadata?.data_fim&&(this.dataFim=this.metadata?.data_fim),this.entity=this.metadata?.entrega}loadData(a,t){var n=this;return(0,d.Z)(function*(){let i=Object.assign({},t.value);n.onEntregaChange(t.value);let{meta:l,realizado:u,...g}=a;yield n.entrega?.loadSearch(a.entrega||i.entrega_id,!1),yield n.unidade?.loadSearch(n.unidadeId),yield n.planejamento?.loadSearch(n.planejamentoId),yield n.cadeiaValor?.loadSearch(n.cadeiaValorId);let v=n.unidadeId?.length?yield n.unidadeDao.getById(n.unidadeId):null;n.idsUnidadesAscendentes=v?.path?.split("/").slice(1)||[],v&&n.idsUnidadesAscendentes.push(v.id),t.patchValue(n.util.fillForm(i,g)),t.controls.meta.setValue(n.planoEntregaService.getValor(a.meta)),t.controls.realizado.setValue(n.planoEntregaService.getValor(a.realizado)),t.controls.objetivos.setValue(a.objetivos),t.controls.processos.setValue(a.processos),n.dataFim&&t.controls.data_fim.setValue(n.dataFim)})()}initializeData(a){var t=this;return(0,d.Z)(function*(){t.entity.unidade_id=t.auth.unidade.id,t.entity.unidade=t.auth.unidade,yield t.loadData(t.entity,a)})()}onSaveEntrega(){var a=this;return(0,d.Z)(function*(){let t,n=!0;if(a.formValidation)try{t=yield a.formValidation(a.form)}catch(i){t=i}if(a.form.valid&&!t){if("edit"==a.action){let i=(yield a.saveData(a.form.value)).modalResult,l=[];i._status="EDIT",a.loading=!0;try{l=yield a.planoEntregaDao.planosImpactadosPorAlteracaoEntrega(i)}finally{a.loading=!1}if(l.length){let u=l.map(g=>a.util.getDateFormatted(g.data_inicio)+" - "+a.util.getDateFormatted(g.data_fim)+" - "+g.unidade?.sigla+": "+g.usuario?.nome+"\n");n=yield a.dialog.confirm("Altera assim mesmo?","Caso prossiga com essa modifica\xe7\xe3o os seguintes planos de trabalho ser\xe3o repactuados automaticamente:\n\n"+u+"\nDeseja prosseguir?")}}n&&(yield a.onSaveData())}else a.form.markAllAsTouched(),t&&a.error(t)})()}saveData(a){return new Promise((t,n)=>{let i=this.util.fill(new k.O,this.entity);this.gridObjetivos?.confirm(),this.gridProcessos?.confirm();let{meta:l,realizado:u,...g}=this.form.value;i=this.util.fillForm(i,g),i.unidade=this.unidade?.selectedEntity,i.entrega=this.entrega?.selectedEntity,i.meta=this.planoEntregaService.getEntregaValor(i.entrega,l),i.realizado=this.planoEntregaService.getEntregaValor(i.entrega,u),t(new Da.R(i))})}onRealizadoChange(a,t){this.calculaRealizado()}calculaRealizado(){const a=this.form?.controls.meta.value,t=this.form?.controls.realizado.value;if(a&&t){let n=isNaN(t)?0:(t/a*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(n)}}dynamicOptionsObjetivos(a){let t=[];return t.push({label:"Excluir",icon:"bi bi-trash",color:"btn-outline-danger",onClick:i=>{this.removeObjetivo(i)}}),t}dynamicButtonsObjetivos(a){return[]}dynamicButtonsProcessos(a){return[]}addObjetivo(){var a=this;return(0,d.Z)(function*(){return{id:a.dao.generateUuid(),_status:"ADD"}})()}removeObjetivo(a){var t=this;return(0,d.Z)(function*(){return(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(a._status="DELETE"),!1})()}saveObjetivo(a,t){var n=this;return(0,d.Z)(function*(){let i=t;if(a.controls.planejamento_objetivo_id.value.length&&n.inputObjetivo.selectedItem)return i.planejamento_objetivo_id=a.controls.planejamento_objetivo_id.value,i.objetivo=n.inputObjetivo.selectedItem.entity,i})()}addProcesso(){var a=this;return(0,d.Z)(function*(){return{id:a.dao.generateUuid(),_status:"ADD"}})()}removeProcesso(a){var t=this;return(0,d.Z)(function*(){return(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(a._status="DELETE"),!1})()}saveProcesso(a,t){var n=this;return(0,d.Z)(function*(){let i=t;if(a.controls.cadeia_processo_id.value.length&&n.inputProcesso.selectedItem)return i.cadeia_processo_id=a.controls.cadeia_processo_id.value,i.processo=n.inputProcesso.selectedItem.entity,i})()}onEntregaChange(a){var t=this;return(0,d.Z)(function*(){if(t.entrega&&t.entrega.selectedItem){const n=t.entrega?.selectedEntity;switch(n.tipo_indicador){case"QUALITATIVO":t.itensQualitativo=n.lista_qualitativos||[],t.form?.controls.meta.setValue(t.itensQualitativo.length?t.itensQualitativo[0].key:null),t.form?.controls.realizado.setValue(t.itensQualitativo.length?t.itensQualitativo[0].key:null);break;case"VALOR":case"QUANTIDADE":t.form?.controls.meta.setValue(""),t.form?.controls.realizado.setValue(0);break;case"PORCENTAGEM":t.form?.controls.meta.setValue(100),t.form?.controls.realizado.setValue(0)}t.loadEtiquetas(),n.checklist&&t.loadChecklist(),t.calculaRealizado()}})()}loadEtiquetas(){var a=this;return(0,d.Z)(function*(){if(!a.etiquetasAscendentes.filter(t=>t.data==a.unidade?.selectedEntity.id).length){let t=yield a.carregaEtiquetasUnidadesAscendentes(a.unidade?.selectedEntity);a.etiquetasAscendentes.push(...t)}a.etiquetas=a.util.merge(a.entrega?.selectedEntity.etiquetas,a.unidade?.selectedEntity.etiquetas,(t,n)=>t.key==n.key),a.etiquetas=a.util.merge(a.etiquetas,a.auth.usuario.config?.etiquetas,(t,n)=>t.key==n.key),a.etiquetas=a.util.merge(a.etiquetas,a.etiquetasAscendentes.filter(t=>t.data==a.unidade?.selectedEntity.id),(t,n)=>t.key==n.key)})()}carregaEtiquetasUnidadesAscendentes(a){var t=this;return(0,d.Z)(function*(){let n=[],i=a.path.split("/");return(yield t.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(u=>{n=t.util.merge(n,u.etiquetas,(g,v)=>g.key==v.key)}),n.forEach(u=>u.data=a.id),n})()}loadChecklist(){let t=(this.entrega?.selectedEntity).checklist.map(n=>({id:n.id,texto:n.texto,checked:!1}));this.checklist=t||[],this.form.controls.checklist.setValue(t)}addItemHandleEtiquetas(){let a;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,n=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,n)&&(a={key:n,value:t.value,color:t.color,icon:t.icon},this.form.controls.etiqueta.setValue(""))}return a}}(ae=Ae).\u0275fac=function(a){return new(a||ae)(e.Y36(e.zs3))},ae.\u0275cmp=e.Xpm({type:ae,selectors:[["plano-entrega-form-entrega"]],viewQuery:function(a,t){if(1&a&&(e.Gf(y.Q,5),e.Gf(xa,5),e.Gf(Na,5),e.Gf(ya,5),e.Gf(Ua,5),e.Gf(La,5),e.Gf(wa,5),e.Gf(qa,5),e.Gf(Qa,5),e.Gf(Ra,5),e.Gf(Ja,5),e.Gf(Ma,5)),2&a){let n;e.iGM(n=e.CRH())&&(t.editableForm=n.first),e.iGM(n=e.CRH())&&(t.gridProcessos=n.first),e.iGM(n=e.CRH())&&(t.gridObjetivos=n.first),e.iGM(n=e.CRH())&&(t.entregas=n.first),e.iGM(n=e.CRH())&&(t.planejamento=n.first),e.iGM(n=e.CRH())&&(t.cadeiaValor=n.first),e.iGM(n=e.CRH())&&(t.inputObjetivo=n.first),e.iGM(n=e.CRH())&&(t.inputProcesso=n.first),e.iGM(n=e.CRH())&&(t.entrega=n.first),e.iGM(n=e.CRH())&&(t.unidade=n.first),e.iGM(n=e.CRH())&&(t.tabs=n.first),e.iGM(n=e.CRH())&&(t.etiqueta=n.first)}},features:[e.qOj],decls:44,vars:57,consts:[["initialFocus","descricao",3,"form","disabled","title","submit","cancel"],["display","","right","",3,"title"],["tabs",""],["key","ENTREGAS","label","Entregas"],[1,"row"],["collapse","",3,"title","collapsed"],["label","T\xedtulo","controlName","descricao","required","",3,"size","placeholder"],["controlName","descricao_entrega",3,"size","label","placeholder"],["controlName","entrega_pai_id",3,"size","label","dao","where","selectRoute","metadata"],[1,"row","mt-4"],["editable","",3,"control","form","hasAdd","hasDelete"],["type","text","title","Texto","field","texto"],["type","options"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["label","Demandante","controlName","unidade_id","required","",3,"size","dao"],["unidade",""],["label","Destinat\xe1rio","controlName","destinatario","required","",3,"size"],["title","Planejamento"],["controlName","entrega_id","placeholder","Selecione ou cadastre uma meta do cat\xe1logo usando a lupa","required","",3,"size","label","dao","change"],["entrega",""],["label","Descri\xe7\xe3o da meta","controlName","descricao_meta","placeholder","Descreva a meta",3,"size"],["class","row",4,"ngIf","ngIfElse"],["naoSelecionou",""],["label","Etiquetas","controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta",3,"size","control","items"],["etiqueta",""],["key","OBJETIVOS","label","Objetivos",4,"ngIf"],["key","PROCESSOS","label","Processos",4,"ngIf"],["icon","bi bi-graph-up-arrow","label","Meta","labelInfo","Onde quero chegar ao final da entrega. Evolu\xe7\xe3o total da entrega, podendo ultrapassar o per\xedodo do plano de entregas",3,"entrega","size","control"],["label","Parcela da entrega no plano","controlName","progresso_esperado","sufix","%","labelInfo","Quanto vou caminhar nesse plano de entregas. Percentual do total da entrega que ser\xe1 realizado durante a vig\xeancia desse plano",3,"size"],["icon","bi bi-check-lg","label","Progresso ao in\xedcio do plano","labelInfo","De onde estou saindo nesse plano. Valor correspondente ao progresso verificado no planejamento do plano de entregas",3,"entrega","size","control","change"],["label","Progresso j\xe1 realizado","controlName","progresso_realizado","sufix","%","disabled","","labelInfo","Quanto caminhei no plano atual Evolu\xe7\xe3o j\xe1 realizada para a meta. No ato da cria\xe7\xe3o do plano, \xe9 o percentual de progresso ao in\xedcio do plano em rela\xe7\xe3o \xe0 meta",3,"size","stepValue"],["key","OBJETIVOS","label","Objetivos"],["controlName","planejamento_id","disabled","",3,"size","dao"],["planejamento",""],["editable","",3,"control","form","orderBy","hasDelete","hasEdit","add","remove","save"],["gridObjetivos",""],[3,"titleTemplate","template","editTemplate"],["titleObjetivo",""],["columnObjetivo",""],["editObjetivo",""],["by","objetivo.nome",3,"header"],["controlName","planejamento_objetivo_id",3,"size","where","dao","selectRoute"],["inputObjetivo",""],["key","PROCESSOS","label","Processos"],["controlName","cadeia_valor_id","disabled","",3,"size","dao"],["cadeiaValor",""],["gridProcessos",""],["titleProcessos",""],["processo",""],["editProcesso",""],["type","options",3,"dynamicButtons"],["by","processo.nome",3,"header"],["label","","icon","","controlName","cadeia_processo_id","label","",3,"size","where","dao","selectRoute"],["inputProcesso",""]],template:function(a,t){if(1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveEntrega()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"tabs",1,2)(3,"tab",3)(4,"div",4)(5,"separator",5)(6,"div",4),e._UZ(7,"input-text",6),e.qZA(),e.TgZ(8,"div",4),e._UZ(9,"input-textarea",7),e.qZA(),e.TgZ(10,"div",4),e._UZ(11,"input-search",8),e.qZA(),e.TgZ(12,"separator",5)(13,"div",9)(14,"h5"),e._uU(15,"Etapas"),e.qZA(),e.TgZ(16,"grid",10)(17,"columns"),e._UZ(18,"column",11)(19,"column",12),e.qZA()()()()(),e.TgZ(20,"separator",5)(21,"div",4),e._UZ(22,"input-datetime",13)(23,"input-datetime",14),e.qZA(),e.TgZ(24,"div",4),e._UZ(25,"input-search",15,16)(27,"input-text",17),e.qZA()(),e._UZ(28,"separator",18),e.TgZ(29,"div",4)(30,"input-search",19,20),e.NdJ("change",function(i){return t.onEntregaChange(i)}),e.qZA()(),e.TgZ(32,"div",4),e._UZ(33,"input-textarea",21),e.qZA(),e.YNc(34,Sa,6,10,"div",22),e.YNc(35,Va,3,3,"ng-template",null,23,e.W1O),e.TgZ(37,"separator",5)(38,"div",4)(39,"input-multiselect",24),e._UZ(40,"input-select",25,26),e.qZA()()()()(),e.YNc(42,Ya,14,13,"tab",27),e.YNc(43,tn,14,14,"tab",28),e.qZA()()),2&a){const n=e.MAs(31),i=e.MAs(36);e.Q6J("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),e.xp6(1),e.Q6J("title",t.isModal?"":t.title),e.xp6(4),e.Q6J("title","Informa\xe7\xf5es gerais da "+t.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",12)("placeholder","T\xedtulo da "+t.lex.translate("entrega")),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",12)("label","Descri\xe7\xe3o da "+t.lex.translate("entrega"))("placeholder","Descreva a "+t.lex.translate("entrega")),e.xp6(2),e.Q6J("size",12)("label","V\xednculo com "+t.lex.translate("entrega")+" de "+t.lex.translate("plano de entrega")+" superior")("dao",t.planoEntregaEntregaDao)("where",e.VKq(50,an,t.idsUnidadesAscendentes))("selectRoute",e.VKq(53,on,e.DdM(52,nn)))("metadata",e.VKq(55,ln,t.idsUnidadesAscendentes)),e.xp6(1),e.Q6J("title","Etapas da "+t.lex.translate("entrega"))("collapsed",!0),e.xp6(4),e.Q6J("control",t.form.controls.checklist)("form",t.formChecklist)("hasAdd",!0)("hasDelete",!0),e.xp6(4),e.Q6J("title","Especifica\xe7\xf5es da "+t.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",6)("labelInfo","In\xedcio "+t.lex.translate("Plano de Entregas")),e.xp6(1),e.Q6J("size",6)("labelInfo","Fim "+t.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.xp6(2),e.Q6J("size",6)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",6),e.uIk("maxlength",250),e.xp6(3),e.Q6J("size",12)("label",t.lex.translate("Tipo de Meta"))("dao",t.entregaDao),e.xp6(3),e.Q6J("size",12),e.xp6(1),e.Q6J("ngIf",null==n?null:n.selectedEntity)("ngIfElse",i),e.xp6(3),e.Q6J("title","Caracteriza\xe7\xe3o da "+t.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",12)("control",t.form.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.xp6(1),e.Q6J("size",12)("control",t.form.controls.etiqueta)("items",t.etiquetas),e.xp6(2),e.Q6J("ngIf",null==t.planejamentoId?null:t.planejamentoId.length),e.xp6(1),e.Q6J("ngIf",null==t.cadeiaValorId?null:t.cadeiaValorId.length)}},dependencies:[O.O5,h.M,m.a,f.b,y.Q,R.V,F.m,Za.Q,w.k,G.p,Ie.p,we.n,qe.i,Y.N,ve.l,_e.l,pe]});var ne,Me=s(38958),sn=s(60039);const rn=["selectResponsaveis"];function dn(o,a){1&o&&(e.TgZ(0,"strong"),e._uU(1,"Respons\xe1vel"),e.qZA())}function cn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.row;e.xp6(1),e.hij(" ",t.responsavel," ")}}function un(o,a){1&o&&(e.TgZ(0,"strong"),e._uU(1,"Criado em"),e.qZA())}function gn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.Oqu(n.util.getDateTimeFormatted(t.date_time))}}function _n(o,a){1&o&&(e.TgZ(0,"div",2)(1,"div",17)(2,"strong"),e._uU(3,"Atributos"),e.qZA()(),e.TgZ(4,"div",18)(5,"strong"),e._uU(6,"Valores"),e._UZ(7,"br"),e._uU(8,"Atuais"),e.qZA()(),e.TgZ(9,"div",18)(10,"strong"),e._uU(11,"Valores"),e._UZ(12,"br"),e._uU(13,"Anteriores"),e.qZA()()())}function pn(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td",21),e._uU(2),e.qZA(),e.TgZ(3,"td",22),e._uU(4),e.qZA(),e.TgZ(5,"td",22),e._uU(6),e.qZA()()),2&o){const t=a.$implicit,n=e.oxw(2);e.xp6(2),e.Oqu(t[0]),e.xp6(2),e.Oqu("EDIT"==n.action||"ADD"==n.action?t[1]:""),e.xp6(2),e.Oqu("EDIT"==n.action?t[2]:"ADD"==n.action?"":t[1])}}function mn(o,a){if(1&o&&(e.TgZ(0,"separator",19)(1,"table")(2,"tbody"),e.YNc(3,pn,7,3,"tr",20),e.qZA()()()),2&o){const t=a.row,n=e.oxw();e.Q6J("collapse","collapse")("collapsed",!0),e.xp6(3),e.Q6J("ngForOf",n.preparaDelta(t))}}class Se extends r.E{constructor(a,t){super(a,sn.R,Me.D),this.injector=a,this.responsaveis=[],this.planoId="",this.action="",this.filterWhere=n=>{let i=[],l=n.value;return i.push(["table_name","==","planos_entregas"]),i.push(["row_id","==",this.planoId]),l.responsavel_id?.length&&i.push(["user_id","==","null"==l.responsavel_id?null:l.responsavel_id]),l.data_inicio&&i.push(["date_time",">=",l.data_inicio]),l.data_fim&&i.push(["date_time","<=",l.data_fim]),l.tipo?.length&&i.push(["type","==",l.tipo]),i},this.planoEntregaDao=a.get(I.r),this.title="Logs de Planos de Entregas",this.filter=this.fh.FormBuilder({responsavel_id:{default:""},data_inicio:{default:""},data_fim:{default:""},tipo:{default:""}}),this.orderBy=[["id","desc"]]}ngOnInit(){super.ngOnInit(),this.planoId=this.urlParams?.get("id")||"",this.planoEntregaDao.getById(this.planoId).then(a=>this.planoEntrega=a)}ngAfterViewInit(){super.ngAfterViewInit()}filterClear(a){a.controls.responsavel_id.setValue(""),a.controls.data_inicio.setValue(""),a.controls.data_fim.setValue(""),a.controls.tipo.setValue(""),super.filterClear(a)}preparaDelta(a){this.action=a.type;let t=a.delta instanceof Array?a.delta:Object.entries(a.delta);return t.forEach(n=>{n[1]instanceof Date&&(n[1]=new Date(n[1]).toUTCString()),n.length>2&&n[2]instanceof Date&&(n[2]=new Date(n[2]).toUTCString())}),t}}var oe;function hn(o,a){if(1&o&&(e.TgZ(0,"h3",18),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.title)}}function fn(o,a){if(1&o&&e._UZ(0,"toolbar",19),2&o){const t=e.oxw();e.Q6J("buttons",t.buttons)}}function vn(o,a){if(1&o&&e._UZ(0,"badge",20)(1,"br")(2,"badge",21)(3,"br")(4,"badge",22),2&o){const t=a.row,n=e.oxw();e.Q6J("label",t.descricao||"(n\xe3o informado)"),e.xp6(2),e.Q6J("icon",n.entityService.getIcon("Unidade"))("label",t.unidade.sigla||"(n\xe3o informado)"),e.xp6(2),e.Q6J("label",t.destinatario||"(n\xe3o informado)")}}function En(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.Oqu(n.dao.getDateFormatted(t.data_inicio)),e.xp6(2),e.Oqu(n.dao.getDateFormatted(t.data_fim))}}function bn(o,a){if(1&o&&(e.TgZ(0,"span",24),e._UZ(1,"i",25),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",t.entrega.nome||t.entrega_pai.descricao," ")}}function An(o,a){if(1&o&&e.YNc(0,bn,3,1,"span",23),2&o){const t=a.row;e.Q6J("ngIf",t.entrega)}}function Tn(o,a){if(1&o&&e._UZ(0,"badge",26)(1,"br")(2,"badge",26),2&o){const t=a.row,n=e.oxw();e.Q6J("label",n.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("label",n.planoEntregaService.getValorRealizado(t))}}function On(o,a){if(1&o&&e._UZ(0,"progress-bar",27),2&o){const t=a.row;e.Q6J("value",t.progresso_realizado)}}(ne=Se).\u0275fac=function(a){return new(a||ne)(e.Y36(e.zs3),e.Y36(Me.D))},ne.\u0275cmp=e.Xpm({type:ne,selectors:[["plano-entrega-list-logs"]],viewQuery:function(a,t){if(1&a&&(e.Gf(h.M,5),e.Gf(rn,5)),2&a){let n;e.iGM(n=e.CRH())&&(t.grid=n.first),e.iGM(n=e.CRH())&&(t.selectResponsaveis=n.first)}},features:[e.qOj],decls:31,vars:30,consts:[[3,"dao","hasEdit","title","orderBy","groupBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xe1vel pelo registro","controlName","responsavel_id",3,"control","items"],["selectResponsaveis",""],["datetime","","label","In\xedcio","controlName","data_inicio","labelInfo","In\xedcio dos registros",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim dos registros",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","tipo","itemTodos","Todos","valueTodos","",3,"size","control","items"],[3,"titleTemplate","template"],["titleResponsavel",""],["columnResponsavel",""],["titleDataCriacao",""],["columnDataCriacao",""],["titleDiferenca",""],["columnDiferenca",""],["title","Tipo de Opera\xe7\xe3o","field","type"],[3,"rows"],["width","150",1,"col","align-bottom"],["width","250",1,"col"],["title","(ver detalhes)",3,"collapse","collapsed"],[4,"ngFor","ngForOf"],["width","150"],["width","250"]],template:function(a,t){if(1&a&&(e.TgZ(0,"grid",0)(1,"span")(2,"strong"),e._uU(3),e.qZA()(),e._UZ(4,"toolbar"),e.TgZ(5,"filter",1)(6,"div",2),e._UZ(7,"input-select",3,4),e.qZA(),e.TgZ(9,"div",2),e._UZ(10,"input-datetime",5)(11,"input-datetime",6)(12,"input-select",7),e.qZA()(),e.TgZ(13,"columns")(14,"column",8),e.YNc(15,dn,2,0,"ng-template",null,9,e.W1O),e.YNc(17,cn,2,1,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(19,"column",8),e.YNc(20,un,2,0,"ng-template",null,11,e.W1O),e.YNc(22,gn,2,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(24,"column",8),e.YNc(25,_n,14,0,"ng-template",null,13,e.W1O),e.YNc(27,mn,4,3,"ng-template",null,14,e.W1O),e.qZA(),e._UZ(29,"column",15),e.qZA(),e._UZ(30,"pagination",16),e.qZA()),2&a){const n=e.MAs(16),i=e.MAs(18),l=e.MAs(21),u=e.MAs(23),g=e.MAs(26),v=e.MAs(28);e.Q6J("dao",t.dao)("hasEdit",!1)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join),e.xp6(3),e.Oqu((null==t.planoEntrega?null:t.planoEntrega.numero)+" - "+(null==t.planoEntrega?null:t.planoEntrega.nome)),e.xp6(2),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&t.filterCollapsed),e.xp6(2),e.Q6J("control",t.filter.controls.responsavel_id)("items",t.responsaveis),e.xp6(3),e.Q6J("size",4)("control",t.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.data_fim),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.tipo)("items",t.lookup.TIPO_LOG_CHANGE),e.xp6(2),e.Q6J("titleTemplate",n)("template",i),e.xp6(5),e.Q6J("titleTemplate",l)("template",u),e.xp6(5),e.Q6J("titleTemplate",g)("template",v),e.xp6(6),e.Q6J("rows",t.rowsLimit)}},dependencies:[O.sg,h.M,m.a,f.b,p.z,x.n,j.Q,w.k,G.p,Y.N]});class Ve extends r.E{constructor(a){super(a,k.O,U.K),this.injector=a,this.buttons=[],this.idsUnidadesAscendentes=[],this.filterWhere=t=>{let n=t.value,i=[];return this.idsUnidadesAscendentes.length&&i.push(["plano_entrega.unidade_id","in",this.idsUnidadesAscendentes]),n.unidade_id?.length&&i.push(["unidade_id","==",n.unidade_id]),n.descricao?.length&&i.push(["descricao","like","%"+n.descricao.trim().replace(" ","%")+"%"]),n.descricao?.length&&i.push(["descricao_entrega","like","%"+n.descricao_entrega.trim().replace(" ","%")+"%"]),n.destinatario?.length&&i.push(["destinatario","like","%"+n.destinatario.trim().replace(" ","%")+"%"]),i},this.planoEntregaDao=a.get(U.K),this.unidadeDao=a.get(D.J),this.planoEntregaService=a.get(c.f),this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},unidade_id:{default:""},destinatario:{default:""}}),this.join=["entrega:id,nome","entrega_pai:id,descricao","unidade:id,sigla"]}ngOnInit(){super.ngOnInit(),this.idsUnidadesAscendentes=this.metadata?.idsUnidadesAscendentes||this.idsUnidadesAscendentes,this.filter?.controls.unidade_id.setValue(this.idsUnidadesAscendentes[0])}dynamicOptions(a){let t=[];return t.push({label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:n=>this.go.navigate({route:["gestao","planejamento","objetivo",n.id,"consult"]},{modal:!0})}),t}filterClear(a){super.filterClear(a)}}(oe=Ve).\u0275fac=function(a){return new(a||oe)(e.Y36(e.zs3))},oe.\u0275cmp=e.Xpm({type:oe,selectors:[["app-plano-entrega-list-entrega-list"]],viewQuery:function(a,t){if(1&a&&e.Gf(h.M,5),2&a){let n;e.iGM(n=e.CRH())&&(t.grid=n.first)}},features:[e.qOj],decls:26,vars:32,consts:[["class","my-2",4,"ngIf"],[3,"dao","orderBy","groupBy","join","selectable","select"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Unidade","controlName","unidade_id",3,"size","control","dao"],["label","T\xedtulo da entrega","controlName","descricao","placeholder","T\xedtulo",3,"size","control"],["label","Descri\xe7\xe3o da entrega","controlName","descricao_entrega","placeholder","Descri\xe7\xe3o",3,"size","control"],[3,"title","template"],["columnEntregaCliente",""],["columnDatas",""],["title","Entrega",3,"template"],["columnIndicador",""],["columnMetaRealizado",""],["title","Progresso",3,"template"],["columnProgresso",""],["type","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],["icon","bi bi-textarea-t","color","light",3,"label"],["color","success",3,"icon","label"],["icon","bi bi-mailbox","color","light",3,"label"],["class","badge bg-light text-dark",4,"ngIf"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-list-check"],["color","light",3,"label"],["color","success",3,"value"]],template:function(a,t){if(1&a&&(e.YNc(0,hn,2,1,"h3",0),e.TgZ(1,"grid",1),e.NdJ("select",function(i){return t.onSelect(i)}),e.YNc(2,fn,1,1,"toolbar",2),e.TgZ(3,"filter",3)(4,"div",4),e._UZ(5,"input-search",5)(6,"input-text",6)(7,"input-text",7),e.qZA()(),e.TgZ(8,"columns")(9,"column",8),e.YNc(10,vn,5,4,"ng-template",null,9,e.W1O),e.qZA(),e.TgZ(12,"column",8),e.YNc(13,En,4,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(15,"column",11),e.YNc(16,An,1,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(18,"column",8),e.YNc(19,Tn,3,2,"ng-template",null,13,e.W1O),e.qZA(),e.TgZ(21,"column",14),e.YNc(22,On,1,1,"ng-template",null,15,e.W1O),e.qZA(),e._UZ(24,"column",16),e.qZA(),e._UZ(25,"pagination",17),e.qZA()),2&a){const n=e.MAs(11),i=e.MAs(14),l=e.MAs(17),u=e.MAs(20),g=e.MAs(23);e.Q6J("ngIf",!t.isModal),e.xp6(1),e.Q6J("dao",t.dao)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("selectable",t.selectable),e.xp6(1),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&t.filterCollapsed),e.xp6(2),e.Q6J("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.descricao),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.descricao_entrega),e.uIk("maxlength",250),e.xp6(2),e.Q6J("title","Entrega\nDemandante\nDestinat\xe1rio")("template",n),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",i),e.xp6(3),e.Q6J("template",l),e.xp6(3),e.Q6J("title","Meta\nRealizado")("template",u),e.xp6(3),e.Q6J("template",g),e.xp6(4),e.Q6J("rows",t.rowsLimit)}},dependencies:[O.O5,h.M,m.a,f.b,p.z,x.n,j.Q,R.V,F.m,N.F,H.R]});var M,ie,le,Cn=s(90038),Pn=s(56976);class Te extends Pn.B{constructor(a){super("PlanoEntregaEntregaProgresso",a),this.injector=a,this.inputSearchConfig.searchFields=["data_progresso"]}}(M=Te).\u0275fac=function(a){return new(a||M)(e.LFG(e.zs3))},M.\u0275prov=e.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"});class fe extends z.X{constructor(a){super(),this.data_inicio=new Date,this.data_fim=null,this.data_progresso=null,this.homologado=!1,this.meta={},this.realizado={},this.progresso_esperado=100,this.progresso_realizado=0,this.plano_entrega_entrega_id="",this.usuario_id="",this.initialization(a)}}function In(o,a){1&o&&e._UZ(0,"toolbar")}function Dn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_progresso),"")}}function Zn(o,a){if(1&o&&e.YNc(0,Dn,2,1,"span",1),2&o){const t=a.row;e.Q6J("ngIf",t.data_progresso)}}function xn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_inicio),"")}}function Nn(o,a){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(1),e.hij(" ",n.dao.getDateFormatted(t.data_fim),"")}}function yn(o,a){if(1&o&&(e.YNc(0,xn,2,1,"span",1),e._UZ(1,"br"),e.YNc(2,Nn,2,1,"span",1)),2&o){const t=a.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function Un(o,a){if(1&o&&e._UZ(0,"badge",15)(1,"br")(2,"badge",16),2&o){const t=a.row,n=e.oxw();e.Q6J("textValue",n.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("textValue",n.planoEntregaService.getValorRealizado(t))}}function Ln(o,a){if(1&o&&e._UZ(0,"progress-bar",17),2&o){const t=a.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}class ze extends r.E{constructor(a){super(a,fe,Te),this.injector=a,this.planoEntregaEntregaId="",this.filterWhere=t=>{let n=[],i=t.value;return i.data_inicial_progresso&&n.push(["data_progresso",">=",i.data_inicial_progresso]),i.data_final_progresso&&n.push(["data_progresso","<=",i.data_final_progresso]),n.push(["plano_entrega_entrega_id","==",this.planoEntregaEntregaId]),n},this.planoEntregaService=a.get(c.f),this.title=this.lex.translate("Hist\xf3rico de execu\xe7\xe3o"),this.orderBy=[["data_progresso","desc"]],this.join=["plano_entrega_entrega.entrega"],this.filter=this.fh.FormBuilder({data_inicial_progresso:{default:null},data_final_progresso:{default:null}}),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_PRO_EXCL")}onGridLoad(a){a?.forEach(t=>t.entrega=t.plano_entrega_entrega?.entrega)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")||""}}(ie=ze).\u0275fac=function(a){return new(a||ie)(e.Y36(e.zs3))},ie.\u0275cmp=e.Xpm({type:ie,selectors:[["app-plano-entrega-list-progresso"]],viewQuery:function(a,t){if(1&a&&e.Gf(h.M,5),2&a){let n;e.iGM(n=e.CRH())&&(t.grid=n.first)}},features:[e.qOj],decls:21,vars:38,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList","select"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["noIcon","","label","Data inical do progresso","controlName","data_inicial_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],["noIcon","","label","Data final do progresso","controlName","data_final_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],[3,"title","template","editTemplate"],["columnProgressoData",""],["columnDatas",""],[3,"title","width","template"],["columnMetaRealizado",""],[3,"title","width","template","editTemplate","columnEditTemplate"],["columnProgresso",""],["type","options",3,"onEdit","options"],[3,"rows"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["color","success",3,"value","goal"]],template:function(a,t){if(1&a&&(e.TgZ(0,"grid",0),e.NdJ("select",function(i){return t.onSelect(i)}),e.YNc(1,In,1,0,"toolbar",1),e.TgZ(2,"filter",2)(3,"div",3),e._UZ(4,"input-datetime",4)(5,"input-datetime",5),e.qZA()(),e.TgZ(6,"columns")(7,"column",6),e.YNc(8,Zn,1,1,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(10,"column",6),e.YNc(11,yn,3,2,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"column",9),e.YNc(14,Un,3,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(16,"column",11),e.YNc(17,Ln,1,2,"ng-template",null,12,e.W1O),e.qZA(),e._UZ(19,"column",13),e.qZA(),e._UZ(20,"pagination",14),e.qZA()),2&a){const n=e.MAs(9),i=e.MAs(12),l=e.MAs(15),u=e.MAs(18);e.Q6J("dao",t.dao)("add",t.add)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("selectable",t.selectable)("hasAdd",t.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_INCL"))("hasEdit",t.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_EDT"))("loadList",t.onGridLoad.bind(t)),e.xp6(1),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&t.filterCollapsed),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.data_inicial_progresso),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.data_final_progresso),e.xp6(2),e.Q6J("title","Data progresso")("template",n)("editTemplate",n),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",i)("editTemplate",i),e.xp6(3),e.Q6J("title","Meta")("width",100)("template",l),e.xp6(3),e.Q6J("title","Progresso")("width",200)("template",u)("editTemplate",u)("columnEditTemplate",t.selectable?void 0:u),e.xp6(3),e.Q6J("onEdit",t.edit)("options",t.options),e.xp6(1),e.Q6J("rows",t.rowsLimit)}},dependencies:[O.O5,h.M,m.a,f.b,p.z,x.n,j.Q,w.k,N.F,H.R]});class Oe extends me.F{constructor(a){super(a,fe,Te),this.injector=a,this.validate=(t,n)=>{let i=null;return["progresso_realizado","realizado"].indexOf(n)>=0&&!(t.value>=0||t.value?.length>0)||["progresso_esperado","meta"].indexOf(n)>=0&&!(t.value>0||t.value?.length>0)?i="Obrigat\xf3rio":(["data_inicio"].indexOf(n)>=0&&!this.dao?.validDateTime(t.value)||["data_fim"].indexOf(n)>=0&&!this.dao?.validDateTime(t.value))&&(i="Inv\xe1lido"),i},this.titleEdit=t=>"Editando "+this.lex.translate("Progresso da entrega")+": "+(t?.entrega?.descricao||""),this.planoEntregaService=a.get(c.f),this.planoEntregaEntregaDao=a.get(U.K),this.join=["plano_entrega_entrega.entrega"],this.form=this.fh.FormBuilder({data_progresso:{default:new Date},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},realizado:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},usuario_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")}loadData(a,t){var n=this;return(0,d.Z)(function*(){let i=Object.assign({},t.value),{meta:l,realizado:u,...g}=a;t.patchValue(n.util.fillForm(i,g)),t.controls.meta.setValue(n.planoEntregaService.getValor(a.meta)),t.controls.realizado.setValue(n.planoEntregaService.getValor(a.realizado))})()}initializeData(a){var t=this;return(0,d.Z)(function*(){t.entity=new fe,t.planoEntregaEntrega=t.planoEntregaEntregaId?yield t.planoEntregaEntregaDao.getById(t.planoEntregaEntregaId,["entrega"]):void 0,t.entity.usuario_id=t.auth.usuario.id,t.entity.plano_entrega_entrega_id=t.planoEntregaEntrega?.id,t.entity.plano_entrega_entrega=t.planoEntregaEntrega,t.entity.meta=t.planoEntregaEntrega?.meta,t.entity.realizado=t.planoEntregaEntrega?.realizado,t.entity.progresso_esperado=t.planoEntregaEntrega?.progresso_esperado,t.entity.progresso_realizado=t.planoEntregaEntrega?.progresso_realizado,t.entity.data_inicio=t.planoEntregaEntrega?.data_inicio,t.entity.data_fim=t.planoEntregaEntrega?.data_fim,yield t.loadData(t.entity,a)})()}saveData(a){return new Promise((t,n)=>{let i=this.util.fill(new fe,this.entity),{meta:l,realizado:u,...g}=this.form.value;i=this.util.fillForm(i,g),i.meta=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,l),i.realizado=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,u),t(i)})}}(le=Oe).\u0275fac=function(a){return new(a||le)(e.Y36(e.zs3))},le.\u0275cmp=e.Xpm({type:le,selectors:[["plano-entrega-form-progresso"]],viewQuery:function(a,t){if(1&a&&e.Gf(y.Q,5),2&a){let n;e.iGM(n=e.CRH())&&(t.editableForm=n.first)}},features:[e.qOj],decls:11,vars:16,consts:[["initialFocus","data_progresso",3,"form","disabled","title","submit","cancel"],[1,"row"],["date","","label","Data do progresso","controlName","data_progresso","required","",3,"size"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["icon","bi bi-graph-up-arrow","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Valor Inicial","labelInfo","Valor da meta verificado no in\xedcio do plano de entrega",3,"entrega","size","control"],["label","Progresso Esperado","controlName","progresso_esperado","sufix","%",3,"size"],["label","Progresso Realizado","controlName","progresso_realizado","sufix","%",3,"size"]],template:function(a,t){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2)(3,"input-datetime",3)(4,"input-datetime",4),e.qZA(),e.TgZ(5,"div",1),e._UZ(6,"plano-entrega-valor-meta-input",5)(7,"plano-entrega-valor-meta-input",6),e.qZA(),e.TgZ(8,"div",1),e._UZ(9,"input-number",7)(10,"input-number",8),e.qZA()()),2&a&&(e.Q6J("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),e.xp6(2),e.Q6J("size",4),e.xp6(1),e.Q6J("size",4)("labelInfo","In\xedcio "+t.lex.translate("Plano de Entregas")),e.xp6(1),e.Q6J("size",4)("labelInfo","Fim "+t.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.xp6(2),e.Q6J("entrega",null==t.entity||null==t.entity.plano_entrega_entrega?null:t.entity.plano_entrega_entrega.entrega)("size",6)("control",t.form.controls.meta),e.xp6(1),e.Q6J("entrega",null==t.entity||null==t.entity.plano_entrega_entrega?null:t.entity.plano_entrega_entrega.entrega)("size",6)("control",t.form.controls.realizado),e.xp6(2),e.Q6J("size",6),e.xp6(1),e.Q6J("size",6))},dependencies:[y.Q,w.k,_e.l,pe]});var se,wn=s(87744),qn=s(59173),Qn=s(80684),Rn=s(84971);const Jn=["listaAtividades"];function Mn(o,a){1&o&&(e.TgZ(0,"b"),e._uU(1,"Descri\xe7\xe3o"),e.qZA())}function Sn(o,a){if(1&o&&(e.TgZ(0,"span",8),e._uU(1),e.qZA(),e._UZ(2,"reaction",9)),2&o){const t=a.row;e.xp6(1),e.Oqu(t.descricao),e.xp6(1),e.Q6J("entity",t)}}function Vn(o,a){if(1&o&&(e._uU(0," Un./"),e.TgZ(1,"order",10),e._uU(2,"Respons\xe1vel"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",11),e._uU(5,"Demandante"),e.qZA()),2&o){const t=a.header;e.xp6(1),e.Q6J("header",t),e.xp6(3),e.Q6J("header",t)}}function zn(o,a){if(1&o&&(e.TgZ(0,"div",12),e._UZ(1,"badge",13)(2,"badge",14),e.qZA(),e._UZ(3,"badge",15)),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.Q6J("label",t.unidade.sigla),e.xp6(1),e.Q6J("icon","bi "+(null!=t.usuario&&null!=t.usuario.nome&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",n.util.apelidoOuNome(t.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==t.usuario?null:t.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.xp6(1),e.Q6J("label",n.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==t.demandante?null:t.demandante.nome)||"Desconhecido"))}}function jn(o,a){if(1&o&&e._UZ(0,"progress-bar",16),2&o){const t=a.row;e.Q6J("value",t.progresso)}}class je extends B.D{set entregaId(a){this._entregaId!=a&&(this._entregaId=a)}get entregaId(){return this._entregaId}constructor(a){super(a),this.injector=a,this.items=[],this.loader=!1,this.AtividadeDao=a.get(Rn.P),this.join=["unidade","usuario","demandante","reacoes.usuario:id,nome,apelido"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.AtividadeDao.query({where:[["plano_trabalho_entrega_id","==",this._entregaId],["unidades_subordinadas","==",!0]],join:this.join}).asPromise().then(a=>{this.items=a}).finally(()=>{this.loader=!1})}}var re;(se=je).\u0275fac=function(a){return new(a||se)(e.Y36(e.zs3))},se.\u0275cmp=e.Xpm({type:se,selectors:[["plano-trabalho-entrega-atividades"]],viewQuery:function(a,t){if(1&a&&e.Gf(Jn,5),2&a){let n;e.iGM(n=e.CRH())&&(t.listaAtividades=n.first)}},inputs:{entregaId:"entregaId"},features:[e.qOj],decls:17,vars:10,consts:[[3,"items","loading"],[3,"titleTemplate","template"],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],[3,"title","width","template"],["columnProgressoEtiquetasChecklist",""],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["color","success",3,"value"]],template:function(a,t){if(1&a&&(e.TgZ(0,"h5"),e._uU(1),e.qZA(),e.TgZ(2,"grid",0)(3,"columns")(4,"column",1),e.YNc(5,Mn,2,0,"ng-template",null,2,e.W1O),e.YNc(7,Sn,3,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(9,"column",1),e.YNc(10,Vn,6,2,"ng-template",null,4,e.W1O),e.YNc(12,zn,4,6,"ng-template",null,5,e.W1O),e.qZA(),e.TgZ(14,"column",6),e.YNc(15,jn,1,1,"ng-template",null,7,e.W1O),e.qZA()()()),2&a){const n=e.MAs(6),i=e.MAs(8),l=e.MAs(11),u=e.MAs(13),g=e.MAs(16);e.xp6(1),e.hij("",t.lex.translate("Atividades"),":"),e.xp6(1),e.Q6J("items",t.items)("loading",t.loader),e.xp6(2),e.Q6J("titleTemplate",n)("template",i),e.xp6(5),e.Q6J("titleTemplate",l)("template",u),e.xp6(5),e.Q6J("title","Progresso")("width",200)("template",g)}},dependencies:[h.M,m.a,f.b,ve.l,N.F,H.R,De.C]});const Fn=["accordionUser"];function Gn(o,a){}function kn(o,a){if(1&o&&e._UZ(0,"plano-trabalho-entrega-atividades",29),2&o){const t=a.row;e.Q6J("entregaId",t.id)}}function Bn(o,a){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Plano de trabalho"),e.qZA()()())}function Yn(o,a){if(1&o&&(e.TgZ(0,"span",31),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.hij("",n.PlanoTrabalhoDao.getDateFormatted(t.data_inicio)," "),e.xp6(2),e.Oqu(" at\xe9 "+n.PlanoTrabalhoDao.getDateFormatted(t.data_fim))}}function Hn(o,a){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Origem"),e.qZA()()())}function Wn(o,a){if(1&o&&e._UZ(0,"badge",37),2&o){const t=e.oxw().row,n=e.oxw(3);e.Q6J("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"Desconhecido")("icon",n.entityService.getIcon("Unidade"))}}function Kn(o,a){if(1&o&&e._UZ(0,"badge",38),2&o){const t=e.oxw().row;e.Q6J("label",t.orgao)}}function Xn(o,a){if(1&o&&(e.TgZ(0,"div",32)(1,"div",33),e._UZ(2,"badge",34),e.YNc(3,Wn,1,2,"badge",35),e.YNc(4,Kn,1,1,"badge",36),e.qZA()()),2&o){const t=a.row,n=e.oxw(3);e.xp6(2),e.Q6J("label",n.planoTrabalhoService.tipoEntrega(t,n.entity).titulo)("color",n.planoTrabalhoService.tipoEntrega(t,n.entity).cor),e.xp6(1),e.Q6J("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),e.xp6(1),e.Q6J("ngIf",null==t.orgao?null:t.orgao.length)}}function $n(o,a){if(1&o&&(e.TgZ(0,"div",30)(1,"small"),e._UZ(2,"badge",39),e.qZA()()),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(2),e.Q6J("color",100==n.totalForcaTrabalho(t.entregas)?"success":"warning")("label",n.totalForcaTrabalho(t.entregas)+"%")}}function eo(o,a){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=a.row;e.xp6(1),e.Oqu(t.forca_trabalho+"%")}}function to(o,a){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Detalhamento/Descri\xe7\xe3o dos Trabalhos"),e.qZA()()())}function ao(o,a){if(1&o&&(e.TgZ(0,"small",30),e._uU(1),e.qZA()),2&o){const t=a.row;e.xp6(1),e.Oqu(t.descricao)}}function no(o,a){if(1&o&&e._UZ(0,"badge",40),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("color",n.lookup.getColor(n.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",n.lookup.getIcon(n.lookup.PLANO_TRABALHO_STATUS,t.status))("label",n.lookup.getValue(n.lookup.PLANO_TRABALHO_STATUS,t.status))}}function oo(o,a){if(1&o&&(e.TgZ(0,"div",12)(1,"div",13)(2,"grid",14)(3,"columns")(4,"column",15),e.YNc(5,kn,1,1,"ng-template",null,16,e.W1O),e.qZA(),e.TgZ(7,"column",17),e.YNc(8,Bn,4,0,"ng-template",null,18,e.W1O),e.YNc(10,Yn,4,2,"ng-template",null,19,e.W1O),e.qZA(),e.TgZ(12,"column",20),e.YNc(13,Hn,4,0,"ng-template",null,21,e.W1O),e.YNc(15,Xn,5,4,"ng-template",null,22,e.W1O),e.qZA(),e.TgZ(17,"column",23),e.YNc(18,$n,3,2,"ng-template",null,9,e.W1O),e.YNc(20,eo,2,1,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(22,"column",24),e.YNc(23,to,4,0,"ng-template",null,25,e.W1O),e.YNc(25,ao,2,1,"ng-template",null,26,e.W1O),e.qZA(),e.TgZ(27,"column",27),e.YNc(28,no,1,3,"ng-template",null,28,e.W1O),e.qZA()()()()()),2&o){const t=a.$implicit,n=e.MAs(6),i=e.MAs(9),l=e.MAs(11),u=e.MAs(14),g=e.MAs(16),v=e.MAs(19),b=e.MAs(21),q=e.MAs(24),ue=e.MAs(26),ge=e.MAs(29);e.xp6(2),e.Q6J("items",t.entregas),e.xp6(2),e.Akn("vertical-align:middle"),e.Q6J("expandTemplate",n),e.xp6(3),e.Q6J("template",l)("titleTemplate",i),e.xp6(5),e.Q6J("titleTemplate",u)("template",g)("verticalAlign","middle")("width",300)("align","center"),e.xp6(5),e.Q6J("titleTemplate",v)("title","% CHD")("template",b)("width",125)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),e.xp6(5),e.Q6J("maxWidth",250)("titleTemplate",q)("template",ue)("verticalAlign","middle")("align","center"),e.xp6(5),e.Q6J("template",ge)}}function io(o,a){if(1&o&&(e.TgZ(0,"h5"),e._uU(1,"Entregas do plano:"),e.qZA(),e._UZ(2,"hr"),e.YNc(3,oo,30,23,"div",11)),2&o){const t=a.row;e.xp6(3),e.Q6J("ngForOf",t.planos_trabalho)}}function lo(o,a){1&o&&(e.TgZ(0,"b"),e._uU(1,"Participante"),e.qZA())}function so(o,a){if(1&o&&(e.TgZ(0,"b"),e._uU(1),e.qZA(),e._UZ(2,"br"),e.TgZ(3,"small"),e._uU(4),e.qZA()),2&o){const t=a.row;e.xp6(1),e.Oqu(t.nome),e.xp6(3),e.Oqu(t.apelido||"")}}function ro(o,a){}function co(o,a){if(1&o&&(e.TgZ(0,"small"),e._UZ(1,"badge",39),e.qZA()),2&o){const t=a.row,n=e.oxw();e.xp6(1),e.Q6J("color",100==n.totalForcaTrabalho(n.planoAtivo(t.planos_trabalho).entregas)?"success":"warning")("label",n.totalForcaTrabalho(n.planoAtivo(t.planos_trabalho).entregas)+"%")}}class Fe extends B.D{set entregaId(a){this._entregaId!=a&&(this._entregaId=a)}get entregaId(){return this._entregaId}constructor(a){super(a),this.injector=a,this.items=[],this.loader=!1,this.PlanoTrabalhoDao=a.get(wn.t),this.PlanoTrabalhoEntregaDao=a.get(qn.w),this.planoTrabalhoService=a.get(Qn.p),this.join=["plano_trabalho.usuario","plano_entrega_entrega.plano_entrega.unidade"],this.groupBy=[{field:"plano_trabalho.usuario",label:"Usu\xe1rio"}]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.cdRef.detectChanges();try{this.PlanoTrabalhoEntregaDao.query({where:[["plano_entrega_entrega_id","==",this._entregaId],["planoTrabalho.status","in",["ATIVO","CONCLUIDO","AVALIADO"]]],join:this.join}).asPromise().then(a=>{a.forEach(t=>{const n=t.plano_trabalho.usuario;if(n){const i=n.id;let l=this.items.find(b=>b.id===i);l||(l={...n,planos_trabalho:[],initialization(b){}},this.items.push(l));const u=t.plano_trabalho.id;let g=l.planos_trabalho.find(b=>b.id===u);g||(g={...t.plano_trabalho,entregas:[],initialization(b){}},l.planos_trabalho.push(g));const v={...t,initialization(b){}};g.entregas.push(v)}})}).finally(()=>{this.loader=!1,this.cdRef.detectChanges()})}catch{console.log("Erro")}}totalForcaTrabalho(a=[]){const t=a.map(n=>1*n.forca_trabalho).reduce((n,i)=>n+i,0);return Math.round(100*t)/100}planoAtivo(a){return a.find(n=>"ATIVO"===n.status)||{}}}(re=Fe).\u0275fac=function(a){return new(a||re)(e.Y36(e.zs3))},re.\u0275cmp=e.Xpm({type:re,selectors:[["plano-entrega-entregas-plano-trabalho"]],viewQuery:function(a,t){if(1&a&&e.Gf(Fn,5),2&a){let n;e.iGM(n=e.CRH())&&(t.accordionUser=n.first)}},inputs:{entregaId:"entregaId"},features:[e.qOj],decls:18,vars:11,consts:[[3,"items","loading"],["accordionUser",""],["type","expand",3,"expandTemplate","template","width"],["usuarioSectionTitle",""],["columnExpandeEntregas",""],[3,"titleTemplate","template"],["titleParticipante",""],["columnParticipante",""],[3,"titleTemplate","template","title","titleHint"],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["class","card mb-2",4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"card-body"],[3,"items"],["type","expand",3,"expandTemplate"],["columnExpandedAtividades",""],[3,"template","titleTemplate"],["titlePlano",""],["columnPlano",""],[3,"titleTemplate","template","verticalAlign","width","align"],["titleOrigem",""],["columnOrigem",""],[3,"titleTemplate","title","template","width","align","titleHint"],[3,"maxWidth","titleTemplate","template","verticalAlign","align"],["titleDescricao",""],["columnDescricao",""],["title","Status",3,"template"],["columnStatus",""],[3,"entregaId"],[1,"text-center"],[1,"d-block","text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["icon","bi bi-calculator",3,"color","label"],[3,"color","icon","label"]],template:function(a,t){if(1&a&&(e.TgZ(0,"grid",0,1)(2,"columns")(3,"column",2),e.YNc(4,Gn,0,0,"ng-template",null,3,e.W1O),e.YNc(6,io,4,1,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(8,"column",5),e.YNc(9,lo,2,0,"ng-template",null,6,e.W1O),e.YNc(11,so,5,2,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(13,"column",8),e.YNc(14,ro,0,0,"ng-template",null,9,e.W1O),e.YNc(16,co,2,2,"ng-template",null,10,e.W1O),e.qZA()()()),2&a){const n=e.MAs(5),i=e.MAs(7),l=e.MAs(10),u=e.MAs(12),g=e.MAs(15),v=e.MAs(17);e.Q6J("items",t.items)("loading",t.loader),e.xp6(3),e.Q6J("expandTemplate",i)("template",n)("width",40),e.xp6(5),e.Q6J("titleTemplate",l)("template",u),e.xp6(5),e.Q6J("titleTemplate",g)("template",v)("title","% CHD")("titleHint","% Carga Hor\xe1ria Dispon\xedvel")}},dependencies:[O.sg,O.O5,h.M,m.a,f.b,N.F,je]});var de,ce,S,Ge=s(75471),uo=s(59838);function go(o,a){if(1&o&&e._UZ(0,"badge",8),2&o){const t=e.oxw().$implicit,n=e.oxw(2);e.Q6J("icon",n.entityService.getIcon("Unidade"))("label",null==t.data||null==t.data.unidade?null:t.data.unidade.sigla)}}function _o(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e._uU(1),e.qZA(),e.YNc(2,go,1,2,"badge",5),e._UZ(3,"br"),e.TgZ(4,"button",6),e.NdJ("click",function(){const l=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.showDetalhes(l.data))}),e._UZ(5,"i",7),e.qZA()}if(2&o){const t=a.$implicit;e.xp6(1),e.Oqu(t.label),e.xp6(1),e.Q6J("ngIf",null==t.data?null:t.data.unidade)}}function po(o,a){if(1&o&&(e.TgZ(0,"p-organizationChart",2),e.YNc(1,_o,6,2,"ng-template",3),e.qZA()),2&o){const t=e.oxw();e.Q6J("value",t.entregasVinculadas)}}function mo(o,a){1&o&&(e.TgZ(0,"div",9)(1,"div",10),e._UZ(2,"span",11),e.qZA()())}class ke extends B.D{set entregaId(a){this._entregaId!=a&&(this._entregaId=a)}get entregaId(){return this._entregaId}constructor(a){super(a),this.injector=a,this.loader=!1,this.entregasVinculadas=[],this.planoEntregaEntregaDao=a.get(U.K),this.join=["unidade"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){var a=this;return(0,d.Z)(function*(){a.loader=!0;try{a.entregasVinculadas=yield a.planoEntregaEntregaDao.hierarquia(a._entregaId),a.cdRef.detectChanges(),a.loader=!1}catch{console.log("Erro")}})()}showDetalhes(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega",a.id,"detalhes"]},{metadata:{entrega:a}})})()}}function ho(o,a){if(1&o&&e._UZ(0,"badge",19),2&o){const t=a.$implicit;e.Q6J("lookup",t)}}function fo(o,a){if(1&o&&e._UZ(0,"badge",20),2&o){const t=e.oxw(2);e.Q6J("icon",t.entityService.getIcon("Unidade"))("label",null==t.entrega||null==t.entrega.unidade?null:t.entrega.unidade.sigla)}}function vo(o,a){if(1&o&&e._UZ(0,"badge",21),2&o){const t=e.oxw(2);e.Q6J("label",null==t.entrega?null:t.entrega.destinatario)}}function Eo(o,a){if(1&o&&(e.TgZ(0,"div",22)(1,"div")(2,"b"),e._uU(3,"Planejada"),e.qZA(),e._UZ(4,"br")(5,"badge",23),e.qZA(),e._UZ(6,"div",24),e.TgZ(7,"div")(8,"b"),e._uU(9,"Executada"),e.qZA(),e._UZ(10,"br")(11,"badge",25),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(5),e.Q6J("textValue",t.planoEntregaService.getValorMeta(t.entrega)),e.xp6(6),e.Q6J("textValue",t.planoEntregaService.getValorRealizado(t.entrega))}}function bo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",33)(1,"small"),e._uU(2),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw(3);return e.KtG(l.showPlanejamento(i.objetivo.id))}),e._UZ(4,"i",35),e.qZA()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.objetivo.nome)}}function Ao(o,a){if(1&o&&(e.TgZ(0,"li",31),e.YNc(1,bo,5,1,"div",32),e.qZA()),2&o){const t=a.$implicit;e.xp6(1),e.Q6J("ngIf",t.objetivo)}}function To(o,a){if(1&o&&(e.TgZ(0,"div",26)(1,"h5",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"ul",29),e.YNc(5,Ao,2,1,"li",30),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lex.translate("Objetivos")),e.xp6(3),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.objetivos)}}function Oo(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",33)(1,"small"),e._uU(2),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw(3);return e.KtG(l.showCadeiaValor(i.processo.id))}),e._UZ(4,"i",35),e.qZA()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.processo.nome)}}function Co(o,a){if(1&o&&(e.TgZ(0,"li",31),e.YNc(1,Oo,5,1,"div",32),e.qZA()),2&o){const t=a.$implicit;e.xp6(1),e.Q6J("ngIf",t.processo)}}function Po(o,a){if(1&o&&(e.TgZ(0,"div",26)(1,"h5",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"ul",29),e.YNc(5,Co,2,1,"li",30),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lex.translate("Processos")),e.xp6(3),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.processos)}}function Io(o,a){if(1&o&&(e.TgZ(0,"div",8)(1,"div",9),e.YNc(2,ho,1,1,"badge",10),e.qZA(),e.TgZ(3,"h5"),e._uU(4),e.qZA(),e.TgZ(5,"small"),e._uU(6),e.qZA(),e._UZ(7,"hr"),e.TgZ(8,"p"),e._uU(9,"Per\xedodo: "),e.TgZ(10,"small"),e._uU(11),e.qZA()(),e.TgZ(12,"div",11)(13,"p",12),e._uU(14,"Demandante: "),e.YNc(15,fo,1,2,"badge",13),e.qZA(),e.TgZ(16,"p"),e._uU(17,"Destinat\xe1rio: "),e.YNc(18,vo,1,1,"badge",14),e.qZA()(),e.TgZ(19,"h5",15),e._uU(20),e.qZA(),e.TgZ(21,"small",16),e._uU(22),e.qZA(),e.YNc(23,Eo,12,2,"div",17),e.YNc(24,To,6,2,"div",18),e.YNc(25,Po,6,2,"div",18),e.qZA()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.etiquetas),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao_entrega),e.xp6(5),e.AsE("",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_inicio)," at\xe9 ",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_fim),""),e.xp6(4),e.Q6J("ngIf",null==t.entrega?null:t.entrega.unidade),e.xp6(3),e.Q6J("ngIf",null==t.entrega||null==t.entrega.destinatario?null:t.entrega.destinatario.length),e.xp6(2),e.Oqu(t.lex.translate("Meta")),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao_meta),e.xp6(1),e.Q6J("ngIf",t.entrega),e.xp6(1),e.Q6J("ngIf",null==t.entrega||null==t.entrega.objetivos?null:t.entrega.objetivos.length),e.xp6(1),e.Q6J("ngIf",null==t.entrega||null==t.entrega.processos?null:t.entrega.processos.length)}}function Do(o,a){if(1&o&&(e.TgZ(0,"div",36),e._UZ(1,"plano-entrega-entregas-vinculadas",37),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("entregaId",t.entrega.id)}}function Zo(o,a){if(1&o&&(e.TgZ(0,"div",38),e._UZ(1,"plano-entrega-entregas-plano-trabalho",37),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("entregaId",t.entrega.id)}}(de=ke).\u0275fac=function(a){return new(a||de)(e.Y36(e.zs3))},de.\u0275cmp=e.Xpm({type:de,selectors:[["plano-entrega-entregas-vinculadas"]],inputs:{entregaId:"entregaId"},features:[e.qOj],decls:2,vars:2,consts:[[3,"value",4,"ngIf"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"value"],["pTemplate","default"],[1,"p-2"],["color","light",3,"icon","label",4,"ngIf"],["title","Detalhes da entrega",1,"btn","btn-sm",3,"click"],[1,"bi","bi-eye"],["color","light",3,"icon","label"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(a,t){1&a&&(e.YNc(0,po,2,1,"p-organizationChart",0),e.YNc(1,mo,3,0,"div",1)),2&a&&(e.Q6J("ngIf",t.entregasVinculadas.length),e.xp6(1),e.Q6J("ngIf",t.loader))},dependencies:[O.O5,N.F,Ge.OE,uo.jx]});class Be extends B.D{constructor(a){super(a),this.injector=a,this.planoEntregaEntregaDao=a.get(U.K),this.planoEntregaService=a.get(c.f)}ngOnInit(){super.ngOnInit(),this.entrega=this.metadata?.entrega}showPlanejamento(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",a]},{modal:!0})})()}showCadeiaValor(a){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","processos",a]},{modal:!0})})()}}(ce=Be).\u0275fac=function(a){return new(a||ce)(e.Y36(e.zs3))},ce.\u0275cmp=e.Xpm({type:ce,selectors:[["plano-entrega-entrega-detalhes"]],features:[e.qOj],decls:8,vars:4,consts:[["right","",3,"title"],["detalhesEntrega",""],["key","INFOS","icon","bi bi-info-lg","label","Informa\xe7\xf5es"],["key","VINCULOS","icon","bi bi-arrow-down-up","label","V\xednculos"],["key","PARTICIPANTES","icon","bi bi-people","label","Participantes"],["class","","style","min-height: 400px;",4,"ngIf"],["style","min-height: 400px;",4,"ngIf"],["class","row","style","min-height: 400px;",4,"ngIf"],[1,"",2,"min-height","400px"],[1,"mb-2"],[3,"lookup",4,"ngFor","ngForOf"],[1,"d-flex"],[1,"me-2"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],[1,"text-center"],[1,"d-block","text-center","mb-2"],["class","d-flex justify-content-center",4,"ngIf"],["class","mt-3",4,"ngIf"],[3,"lookup"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],[1,"d-flex","justify-content-center"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],[1,"vr","mx-5"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],[1,"mt-3"],[1,"text-center","mb-2"],[1,"card"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","d-flex justify-content-between align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-info","me-2",3,"click"],[1,"bi","bi-eye"],[2,"min-height","400px"],[3,"entregaId"],[1,"row",2,"min-height","400px"]],template:function(a,t){if(1&a&&(e.TgZ(0,"tabs",0,1),e._UZ(2,"tab",2)(3,"tab",3)(4,"tab",4),e.qZA(),e.YNc(5,Io,26,12,"div",5),e.YNc(6,Do,2,1,"div",6),e.YNc(7,Zo,2,1,"div",7)),2&a){const n=e.MAs(1);e.Q6J("title",t.isModal?"":t.title),e.xp6(5),e.Q6J("ngIf","INFOS"==n.active),e.xp6(1),e.Q6J("ngIf","VINCULOS"==n.active&&t.entrega),e.xp6(1),e.Q6J("ngIf","PARTICIPANTES"==n.active&&t.entrega)}},dependencies:[O.sg,O.O5,we.n,qe.i,N.F,Fe,ke]});const xo=[{path:"",component:Ze,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Plano de Entregas"}},{path:"new",component:he,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Entregas",modal:!0}},{path:":id/edit",component:he,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Entregas",modal:!0}},{path:":id/consult",component:he,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Entregas",modal:!0}},{path:":id/logs",component:Se,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Logs de Altera\xe7\xf5es em Planos de Entregas",modal:!0}},{path:":planoEntregaId/avaliar",component:Cn.w,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Avaliar Plano de Entrega"}},{path:"entrega",component:Ae,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/:id/consult",component:Ae,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Consulta entrega do Plano de Entregas",modal:!0}},{path:"entrega/:id/detalhes",component:Be,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Detalhes da entrega do Plano de Entregas",modal:!0}},{path:"entrega-list",component:Ve,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/objetivos/:objetivo_id",component:be,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/processos/:processo_id",component:be,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"adesao",component:Le,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Ades\xe3o a Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id",component:ze,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Progressos da entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/new",component:Oe,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/:id/edit",component:Oe,canActivate:[A.a],resolve:{config:T.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}}];class Ye{}(S=Ye).\u0275fac=function(a){return new(a||S)},S.\u0275mod=e.oAB({type:S}),S.\u0275inj=e.cJS({imports:[C.Bz.forChild(xo),C.Bz]});var V,No=s(77024),yo=s(40588),Uo=s(32864);class He{}(V=He).\u0275fac=function(a){return new(a||V)},V.\u0275mod=e.oAB({type:V}),V.\u0275inj=e.cJS({imports:[O.ez,Q.K,Ye,No.PlanejamentoModule,yo.CadeiaValorModule,Ge.lC,Uo.UteisModule]})},80684:(Ce,J,s)=>{s.d(J,{p:()=>z});var D,O=s(8239),Q=s(43972),C=s(20755),A=s(32333),T=s(49193),d=s(92307),h=s(39702),Z=s(87744),P=s(41095),I=s(49367);class z{constructor(r,c,_,E,e,m,f,p){this.auth=r,this.util=c,this.go=_,this.lookup=E,this.dao=e,this.avaliacaoDao=m,this.templateService=f,this.planoTrabalhoDao=p}template(r){return r.programa?.template_tcr}metadados(r){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(r),template:r.programa?.template_tcr,template_id:r.programa?.template_tcr_id}}needSign(r,c){const _=r,E=c||(_?.documentos||[]).find(e=>_?.documento_id?.length&&e.id==_?.documento_id)||_?.documento;if(r&&E&&!E.assinaturas?.find(e=>e.usuario_id==this.auth.usuario.id)){const e=_.tipo_modalidade,m=_.programa,f=this.auth.entidade;let p=[];return m?.plano_trabalho_assinatura_participante&&p.push(_.usuario_id),m?.plano_trabalho_assinatura_gestor_lotacao&&p.push(...this.auth.gestoresLotacao.map(x=>x.id)),m?.plano_trabalho_assinatura_gestor_unidade&&p.push(_.unidade?.gestor?.id||"",..._.unidade?.gestores_substitutos?.map(x=>x.id)||""),m?.plano_trabalho_assinatura_gestor_entidade&&p.push(f.gestor_id||"",f.gestor_substituto_id||""),!!e&&p.includes(this.auth.usuario.id)}return!1}extraTags(r,c,_){const E=r;let e=[];return E?.documento_id==c.id&&e.push({key:c.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(_.tags)!=JSON.stringify(e)&&(_.tags=e),_.tags}tipoEntrega(r,c){let _=c||r.plano_trabalho,E=r.plano_entrega_entrega?.plano_entrega?.unidade_id==_.unidade_id?"PROPRIA_UNIDADE":r.plano_entrega_entrega?"OUTRA_UNIDADE":r.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",e=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(p=>p.key==E)||{key:"",value:"Desconhecido1"},m=_?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||r.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",f=_?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||r.plano_entrega_entrega?.descricao||"";return{titulo:e.value,cor:e.color||"danger",nome:m,tipo:E,descricao:f}}atualizarTcr(r,c,_,E){if(c.usuario&&c.unidade){let e=this.dao.datasource(r),m=this.dao.datasource(c),f=c.programa;if(m.usuario.texto_complementar_plano=_||c.usuario?.texto_complementar_plano||"",m.unidade.texto_complementar_plano=E||c.unidade?.texto_complementar_plano||"",(f?.termo_obrigatorio||c.documento_id?.length)&&JSON.stringify(m)!=JSON.stringify(e)&&f?.template_tcr){let p=c.documentos?.find(x=>x.id==c.documento_id);c.documento_id?.length&&p&&!p.assinaturas?.length&&"LINK"!=p.tipo?(p.conteudo=this.templateService.renderTemplate(f?.template_tcr?.conteudo||"",m),p.dataset=this.dao.dataset(),p.datasource=m,p._status="ADD"==p._status?"ADD":"EDIT"):(p=new Q.U({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(f?.template_tcr?.conteudo||"",m),status:"GERADO",_status:"ADD",template:f?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:m,entidade_id:this.auth.entidade?.id,plano_trabalho_id:c.id,template_id:f?.template_tcr_id}),c.documentos.push(p)),c.documento=p,c.documento_id=p?.id||null}}return c.documento}situacaoPlano(r){return r.deleted_at?"EXCLUIDO":r.data_arquivamento?"ARQUIVADO":r.status}isValido(r){return!r.deleted_at&&"CANCELADO"!=r.status&&!r.data_arquivamento}estaVigente(r){let c=new Date;return"ATIVO"==r.status&&r.data_inicio<=c&&r.data_fim>=c}diasParaConcluirConsolidacao(r,c){return r&&c?this.util.daystamp(r.data_fim)+c.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(r,c,_){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",r.id,"avaliar"]},{modal:!0,metadata:{consolidacao:r,programa:c},modalClose:E=>{E&&(r.status="AVALIADO",r.avaliacao_id=E.id,r.avaliacao=E,_(r))}})}fazerRecurso(r,c,_){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",r.id,"recurso"]},{modal:!0,metadata:{recurso:!0,consolidacao:r,programa:c},modalClose:E=>{E&&(r.avaliacao=E,_(r))}})}cancelarAvaliacao(r,c,_){var E=this;return(0,O.Z)(function*(){c.submitting=!0;try{(yield E.avaliacaoDao.cancelarAvaliacao(r.avaliacao.id))&&(r.status="CONCLUIDO",r.avaliacao_id=null,r.avaliacao=void 0,_(r))}catch(e){c.error(e.message||e)}finally{c.submitting=!1}})()}usuarioAssinou(r,c){return c=c||this.auth.usuario.id,Object.values(r).some(_=>(_||[]).includes(c))}assinaturasFaltantes(r,c){return{participante:r.participante.filter(_=>!c.participante.includes(_)),gestores_unidade_executora:r.gestores_unidade_executora.length?r.gestores_unidade_executora.filter(_=>c.gestores_unidade_executora.includes(_)).length?[]:r.gestores_unidade_executora:[],gestores_unidade_lotacao:r.gestores_unidade_lotacao.length?r.gestores_unidade_lotacao.filter(_=>c.gestores_unidade_lotacao.includes(_)).length?[]:r.gestores_unidade_lotacao:[],gestores_entidade:r.gestores_entidade.length?r.gestores_entidade.filter(_=>c.gestores_entidade.includes(_)).length?[]:r.gestores_entidade:[]}}}(D=z).\u0275fac=function(r){return new(r||D)(C.LFG(A.e),C.LFG(T.f),C.LFG(d.o),C.LFG(h.W),C.LFG(Z.t),C.LFG(P.w),C.LFG(I.E),C.LFG(Z.t))},D.\u0275prov=C.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"})}}]);