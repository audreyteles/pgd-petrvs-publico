"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[2837],{41095:(fe,J,s)=>{s.d(J,{w:()=>O});var T=s(56976),q=s(20755);class O extends T.B{constructor(h){super("Avaliacao",h),this.injector=h,this.inputSearchConfig.searchFields=[]}cancelarAvaliacao(h){return new Promise((u,b)=>{this.server.post("api/"+this.collection+"/cancelar-avaliacao",{id:h}).subscribe(I=>{I?.error?b(I?.error):u(!0)},I=>b(I))})}recorrer(h,u){return new Promise((b,I)=>{this.server.post("api/"+this.collection+"/recorrer",{id:h.id,recurso:u}).subscribe(Z=>{Z?.error?I(Z?.error):(h.recurso=u,b(!0))},Z=>I(Z))})}static#e=this.\u0275fac=function(u){return new(u||O)(q.LFG(q.zs3))};static#t=this.\u0275prov=q.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"})}},82837:(fe,J,s)=>{s.r(J),s.d(J,{PlanoEntregaModule:()=>pe});var T=s(76733),q=s(54218),O=s(55579),C=s(1391),h=s(2314),u=s(8239),b=s(73150),I=s(19520),Z=s(5458),x=s(39190),P=s(81214),be=s(64368);class r extends be.X{constructor(n){super(),this.entregas=[],this.status_historico=[],this.data_inicio=new Date,this.data_fim=null,this.nome="",this.metadados=void 0,this.arquivar=!1,this.status="INCLUIDO",this.avaliacoes=[],this.unidade_id="",this.avaliacao_id=null,this.plano_entrega_id=null,this.planejamento_id=null,this.cadeia_valor_id=null,this.programa_id=null,this.initialization(n)}}var d=s(78509),_=s(77447),E=s(41095),A=s(20609),e=s(20755),v=s(57224),p=s(83351),D=s(57765),z=s(45512),j=s(42704),ve=s(88820),Q=s(32802),G=s(92392),w=s(84495),F=s(64603),me=s(61915),N=s(95489),Le=s(56486),y=s(74040),U=s(31021),k=s(32398),B=s(76298),Ee=s(17819),Y=s(25560),H=s(69756),te=s(9224),Ae=s(64792),qe=s(81419);function Qe(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input-number",3),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onValueChange(i))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Porcentagem")("control",t.control)("labelInfo",t.labelInfo)}}function Re(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input-number",4),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onValueChange(i))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Num\xe9rico")("control",t.control)("labelInfo",t.labelInfo)}}const Je=function(){return[]};function Me(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input-select",5),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onValueChange(i))}),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)("icon",t.icon)("label",t.label||"Qualitativo")("control",t.control)("items",(null==t.entrega?null:t.entrega.lista_qualitativos)||e.DdM(6,Je))("labelInfo",t.labelInfo)}}const Ve=function(){return["PORCENTAGEM"]},Se=function(){return["QUANTIDADE","VALOR"]},ze=function(){return["QUALITATIVO"]};class M{constructor(){this.class="form-group",this.icon="",this.labelInfo="",this._size=0}set size(n){n!=this._size&&(this._size=n,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+n)}get size(){return this._size||12}checkTipoIndicador(n){return n.includes(this.entrega?.tipo_indicador||"")}onValueChange(n){this.change&&this.change(this.control?.value,this.entrega)}static#e=this.\u0275fac=function(t){return new(t||M)};static#t=this.\u0275cmp=e.Xpm({type:M,selectors:[["plano-entrega-valor-meta-input"]],hostVars:2,hostBindings:function(t,a){2&t&&e.Tol(a.class)},inputs:{entrega:"entrega",icon:"icon",label:"label",labelInfo:"labelInfo",disabled:"disabled",control:"control",change:"change",size:"size"},decls:3,vars:6,consts:[["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","labelInfo","change",4,"ngIf"],["required","",3,"disabled","icon","label","control","items","labelInfo","change",4,"ngIf"],["sufix","%","required","",3,"disabled","icon","label","control","labelInfo","change"],["required","",3,"disabled","icon","label","control","labelInfo","change"],["required","",3,"disabled","icon","label","control","items","labelInfo","change"]],template:function(t,a){1&t&&(e.YNc(0,Qe,1,5,"input-number",0),e.YNc(1,Re,1,5,"input-number",1),e.YNc(2,Me,1,7,"input-select",2)),2&t&&(e.Q6J("ngIf",a.checkTipoIndicador(e.DdM(3,Ve))),e.xp6(1),e.Q6J("ngIf",a.checkTipoIndicador(e.DdM(4,Se))),e.xp6(1),e.Q6J("ngIf",a.checkTipoIndicador(e.DdM(5,ze))))},dependencies:[T.O5,F.p,te.l]})}const je=["etiqueta"];function Ge(o,n){if(1&o&&(e.TgZ(0,"strong",14),e._uU(1,"Entregas: "),e.qZA(),e.TgZ(2,"span",15),e._UZ(3,"badge",16),e.qZA()),2&o){const t=n.separator;e.xp6(3),e.Q6J("label",null==t?null:t.text)}}function Fe(o,n){if(1&o&&e._UZ(0,"badge",21),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla)}}function ke(o,n){if(1&o&&e._UZ(0,"badge",22),2&o){const t=e.oxw().row;e.Q6J("label",t.destinatario)}}function Be(o,n){if(1&o&&e._UZ(0,"reaction",23),2&o){const t=e.oxw().row;e.Q6J("entity",t)}}function Ye(o,n){if(1&o&&(e.TgZ(0,"h6"),e._uU(1),e.qZA(),e.TgZ(2,"span",17),e.YNc(3,Fe,1,2,"badge",18),e.YNc(4,ke,1,1,"badge",19),e.qZA(),e.YNc(5,Be,1,1,"reaction",20)),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.Oqu(t.descricao),e.xp6(2),e.Q6J("ngIf",t.unidade),e.xp6(1),e.Q6J("ngIf",null==t.destinatario?null:t.destinatario.length),e.xp6(1),e.Q6J("ngIf",a.execucao)}}function He(o,n){if(1&o&&e._UZ(0,"badge",25),2&o){const t=n.$implicit;e.Q6J("lookup",t)}}function We(o,n){if(1&o&&e.YNc(0,He,1,1,"badge",24),2&o){const t=n.row;e.Q6J("ngForOf",t.etiquetas)}}function Ke(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input-multiselect",26)(1,"input-select",27,28),e.NdJ("details",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onEtiquetaConfigClick())}),e.qZA()()}if(2&o){const t=e.oxw();e.Q6J("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.xp6(1),e.Q6J("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function Xe(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function $e(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function et(o,n){if(1&o&&(e.YNc(0,Xe,2,1,"span",29),e._UZ(1,"br"),e.YNc(2,$e,2,1,"span",29)),2&o){const t=n.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function tt(o,n){if(1&o&&e._UZ(0,"badge",30)(1,"br")(2,"badge",31),2&o){const t=n.row,a=e.oxw();e.Q6J("textValue",a.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("textValue",a.planoEntregaService.getValorRealizado(t))}}function at(o,n){if(1&o&&e._UZ(0,"plano-entrega-valor-meta-input",32)(1,"plano-entrega-valor-meta-input",33),2&o){const t=n.row,a=e.oxw();e.Q6J("entrega",t.entrega)("size",6)("control",a.form.controls.meta),e.xp6(1),e.Q6J("entrega",t.entrega)("size",6)("control",a.form.controls.realizado)("change",a.onRealizadaChange.bind(a))}}function nt(o,n){1&o&&e._UZ(0,"i",42)}function ot(o,n){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,nt,1,0,"i",40),e.qZA(),e.TgZ(3,"td",41),e._uU(4),e.qZA()()),2&o){const t=n.$implicit;e.xp6(2),e.Q6J("ngIf",t.checked),e.xp6(2),e.Oqu(t.texto)}}function it(o,n){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,ot,5,2,"tr",39),e.qZA()),2&o){const t=e.oxw(2).row;e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function lt(o,n){if(1&o&&(e.TgZ(0,"separator",38),e.YNc(1,it,2,1,"table",29),e.qZA()),2&o){const t=e.oxw().row;e.Q6J("collapsed",!0),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function st(o,n){if(1&o&&(e._UZ(0,"progress-bar",36),e.YNc(1,lt,2,2,"separator",37)),2&o){const t=n.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function rt(o,n){1&o&&e._UZ(0,"separator",45)}function dt(o,n){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input-switch",46),e.qZA(),e.TgZ(3,"td",41),e._uU(4),e.qZA()()),2&o){const t=n.$implicit,a=n.index,i=e.oxw(4);e.xp6(2),e.Q6J("size",12)("source",i.checklist)("path",a+".checked"),e.xp6(2),e.Oqu(t.texto)}}function ct(o,n){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,dt,5,4,"tr",39),e.qZA()),2&o){const t=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function ut(o,n){if(1&o&&(e._UZ(0,"input-number",43),e.YNc(1,rt,1,0,"separator",44),e.YNc(2,ct,2,1,"table",29)),2&o){const t=n.row,a=e.oxw(2);e.Q6J("size",12)("control",a.formEdit.controls.progresso_realizado),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function gt(o,n){if(1&o&&(e.TgZ(0,"column",4),e.YNc(1,st,2,3,"ng-template",null,34,e.W1O),e.YNc(3,ut,3,4,"ng-template",null,35,e.W1O),e.qZA()),2&o){const t=e.MAs(2),a=e.MAs(4),i=e.oxw();e.Q6J("title","Progresso\nChecklist")("width",200)("template",t)("editTemplate",t)("columnEditTemplate",i.selectable?void 0:a)("edit",i.selectable?void 0:i.onColumnChecklistEdit.bind(i))("save",i.selectable?void 0:i.onColumnChecklistSave.bind(i))}}function _t(o,n){if(1&o&&e._UZ(0,"badge",49),2&o){const t=e.oxw().row;e.Q6J("label",null==t.entrega?null:t.entrega.nome)}}function pt(o,n){if(1&o&&(e.YNc(0,_t,1,1,"badge",47),e._UZ(1,"comentarios-widget",48)),2&o){const t=n.row,a=e.oxw();e.Q6J("ngIf",t.entrega),e.xp6(1),e.Q6J("entity",t)("selectable",!a.execucao||!(null==a.grid||!a.grid.editing))("grid",a.grid)("save",a.refreshComentarios.bind(a))}}class W extends B.D{set noPersist(n){super.noPersist=n}get noPersist(){return super.noPersist}set control(n){super.control=n}get control(){return super.control}set entity(n){super.entity=n}get entity(){return super.entity}set planejamentoId(n){this._planejamentoId!=n&&(this._planejamentoId=n)}get planejamentoId(){return this._planejamentoId}set cadeiaValorId(n){this._cadeiaValorId!=n&&(this._cadeiaValorId=n)}get cadeiaValorId(){return this._cadeiaValorId}set unidadeId(n){this._unidadeId!=n&&(this._unidadeId=n)}get unidadeId(){return this._unidadeId}set dataFim(n){this._dataFim!=n&&(this._dataFim=n)}get dataFim(){return this._dataFim}get items(){return this.gridControl.value||this.gridControl.setValue([]),this.gridControl.value}constructor(n){super(n),this.injector=n,this.disabled=!1,this.execucao=!1,this.entityToControl=t=>t.entregas||[],this.options=[],this.planoEntregaId="",this.etiquetas=[],this.etiquetasAscendentes=[],this.selectable=!1,this.validate=(t,a)=>{let i=null;return["nome"].indexOf(a)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),i},this.filterWhere=t=>{let a=[];t.value;return a.push(["plano_entrega_id","==",this.planoEntregaId]),a},this.title=this.lex.translate("Entregas"),this.join=["unidade","entrega","reacoes.usuario:id,nome,apelido"],this.code="MOD_PENT",this.cdRef=n.get(e.sBO),this.dao=n.get(U.K),this.unidadeDao=n.get(P.J),this.planoEntregaService=n.get(_.f),this.form=this.fh.FormBuilder({descricao:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:""},realizado:{default:null},entrega_id:{default:null},unidade_id:{default:null},progresso_esperado:{default:null},progresso_realizado:{default:null},destinatario:{default:null},etiquetas:{default:[]}},this.cdRef,this.validate),this.formEdit=this.fh.FormBuilder({progresso_realizado:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.addOption(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES),"MOD_PENT"),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_EXCL"),this.addOption(Object.assign({onClick:this.showLogs.bind(this)},this.OPTION_LOGS),"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.planoEntregaId=this.urlParams.get("id")||""}get isDisabled(){return this.formDisabled||this.disabled}add(){var n=this;return(0,u.Z)(function*(){let t=new k.O({_status:"ADD",id:n.dao.generateUuid(),plano_entrega_id:n.entity?.id});var a;n.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:n.entity,planejamento_id:n.planejamentoId,cadeia_valor_id:n.cadeiaValorId,unidade_id:n.unidadeId,data_fim:n.dataFim,entrega:t},modalClose:(a=(0,u.Z)(function*(i){if(i)try{n.isNoPersist?n.items.push(i):n.items.push(yield n.dao.save(i,n.join)),n.cdRef.detectChanges()}catch(l){n.error(l?.error||l?.message||l)}}),function(l){return a.apply(this,arguments)})})})()}dynamicOptions(n){return this.execucao||this.isDisabled?[]:this.options}dynamicButtons(n){const t=[];return this.isDisabled&&t.push(Object.assign({onClick:this.consult.bind(this)},this.OPTION_INFORMACOES)),this.execucao&&t.push({label:"Hist\xf3rico de execu\xe7\xe3o",icon:"bi bi-activity",color:"btn-outline-info",onClick:this.showProgresso.bind(this)}),t.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),t}edit(n){var t=this;return(0,u.Z)(function*(){if(t.execucao)t.grid.edit(n);else{n._status="ADD"==n._status?"ADD":"EDIT";let a=t.items.indexOf(n);t.go.navigate({route:["gestao","plano-entrega","entrega"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,entrega:n},modalClose:(i=(0,u.Z)(function*(l){l&&(t.isNoPersist||(yield t.dao?.save(l)),t.items[a]=l)}),function(c){return i.apply(this,arguments)})})}var i})()}load(n,t){var a=this;return(0,u.Z)(function*(){a.form.patchValue(t),a.form.controls.meta.setValue(a.planoEntregaService.getValor(t.meta)),a.form.controls.realizado.setValue(a.planoEntregaService.getValor(t.realizado)),a.cdRef.detectChanges()})()}save(n,t){var a=this;return(0,u.Z)(function*(){let i;if(a.form.markAllAsTouched(),n.valid){a.submitting=!0;try{i=yield a.dao?.update(t.id,{realizado:a.planoEntregaService.getEntregaValor(t.entrega,n.controls.realizado.value),progresso_realizado:n.controls.progresso_realizado.value},a.join)}finally{a.submitting=!1}}return i})()}delete(n){var t=this;return(0,u.Z)(function*(){if(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?")){let i=t.items.indexOf(n);t.isNoPersist?n._status="DELETE":t.dao.delete(n).then(()=>{t.items.splice(i,1),t.cdRef.detectChanges(),t.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(l=>{t.dialog.alert("Erro","Erro ao excluir: "+(l?.message?l?.message:l))})}})()}consult(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega",n.id,"consult"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,entrega:n}})})()}showLogs(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["logs","change",n.id,"consult"]})})()}showPlanejamento(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",n]},{modal:!0})})()}showCadeiaValor(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","processos",n]},{modal:!0})})()}showProgresso(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","progresso",n.id]},{modal:!0,modalClose:a=>{t.parent?.refresh(t.entity?.id)}})})()}showDetalhes(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega",n.id,"detalhes"]},{metadata:{plano_entrega:t.entity,planejamento_id:t.planejamentoId,cadeia_valor_id:t.cadeiaValorId,unidade_id:t.unidadeId,entrega:n}})})()}refreshComentarios(n){let t=this.items.find(a=>a.id==n.id);t&&(t.comentarios=n.comentarios||[])}onRealizadaChange(){const n=this.form?.controls.meta.value,t=this.form?.controls.realizado.value;if(n&&t){let a=isNaN(t)?0:(t/n*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(a)}}addItemHandleEtiquetas(){let n;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,a=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,a)&&(n={key:a,value:t.value,color:t.color,icon:t.icon},this.formEdit.controls.etiqueta.setValue(null))}return n}onColumnEtiquetasEdit(n){var t=this;return(0,u.Z)(function*(){if(!t.etiquetasAscendentes.filter(a=>a.data==n.unidade.id).length){let a=yield t.carregaEtiquetasUnidadesAscendentes(n.unidade);t.etiquetasAscendentes.push(...a)}t.formEdit.controls.etiquetas.setValue(n.etiquetas),t.formEdit.controls.etiqueta.setValue(null),t.etiquetas=t.util.merge(n.tipo_atividade?.etiquetas,n.unidade?.etiquetas,(a,i)=>a.key==i.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(a,i)=>a.key==i.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(a=>a.data==n.unidade.id),(a,i)=>a.key==i.key)})()}carregaEtiquetasUnidadesAscendentes(n){var t=this;return(0,u.Z)(function*(){let a=[],i=n.path.split("/");return(yield t.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(c=>{a=t.util.merge(a,c.etiquetas,(g,m)=>g.key==m.key)}),a.forEach(c=>c.data=n.id),a})()}onColumnEtiquetasSave(n){var t=this;return(0,u.Z)(function*(){try{const a=yield t.dao.update(n.id,{etiquetas:t.formEdit.controls.etiquetas.value});return n.etiquetas=t.formEdit.controls.etiquetas.value,!!a}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:n=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,a)=>t.key==a.key),this.cdRef.detectChanges()}})}onColumnChecklistEdit(n){var t=this;return(0,u.Z)(function*(){t.formEdit.controls.progresso_realizado.setValue(n.progresso_realizado),t.checklist=t.util.clone(n.checklist)})()}onColumnChecklistSave(n){var t=this;return(0,u.Z)(function*(){let a=Math.round(parseInt(t.planoEntregaService.getValorMeta(n))*t.formEdit.controls.progresso_realizado.value/100);try{const i=yield t.dao.update(n.id,{progresso_realizado:t.formEdit.controls.progresso_realizado.value,realizado:t.planoEntregaService.getEntregaValor(n.entrega,a),checklist:t.checklist});return n.progresso_realizado=t.formEdit.controls.progresso_realizado.value,n.checklist=t.checklist,typeof n.realizado.porcentagem<"u"?n.realizado.porcentagem=a:typeof n.realizado.quantitativo<"u"?n.realizado.quantitativo=a:typeof n.realizado.valor<"u"&&(n.realizado.valor=a),!!i}catch{return!1}})()}getObjetivos(n){return n.objetivos.filter(t=>"DELETE"!=t._status)}static#e=this.\u0275fac=function(t){return new(t||W)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:W,selectors:[["plano-entrega-list-entrega"]],viewQuery:function(t,a){if(1&t&&(e.Gf(y.Q,5),e.Gf(b.M,5),e.Gf(je,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.grid=i.first),e.iGM(i=e.CRH())&&(a.etiqueta=i.first)}},inputs:{cdRef:"cdRef",disabled:"disabled",parent:"parent",noPersist:"noPersist",control:"control",entity:"entity",planejamentoId:"planejamentoId",cadeiaValorId:"cadeiaValorId",unidadeId:"unidadeId",dataFim:"dataFim",execucao:"execucao"},features:[e.qOj],decls:25,vars:35,consts:[[3,"items","form","groupTemplate","minHeight","editable","hasAdd","add","hasEdit","load","save","selectable"],["groupEntregas",""],[3,"title","template","editTemplate"],["columnEntregaCliente",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],["columnEtiquetas",""],["columnEtiquetasEdit",""],["columnDatas",""],[3,"title","width","template","editTemplate"],["columnMetaRealizado",""],["editMetaRealizado",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save",4,"ngIf"],["columnEntregaCometario",""],["type","options",3,"onEdit","dynamicButtons","dynamicOptions"],[1,"grid-group-text"],[1,"text-wrap"],["color","primary",3,"label"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity"],[3,"lookup",4,"ngFor","ngForOf"],[3,"lookup"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],[4,"ngIf"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["icon","bi bi-graph-up-arrow","disabled","","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Realizada",3,"entrega","size","control","change"],["columnProgChecklist",""],["columnChecklistEdit",""],["color","success",3,"value","goal"],["small","","title","Checklist","collapse","",3,"collapsed",4,"ngIf"],["small","","title","Checklist","collapse","",3,"collapsed"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Realizado","sufix","%","icon","bi bi-clock","controlName","progresso_realizado","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","control"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["scale","small",3,"size","source","path"],["color","light","icon","bi bi-list-check",3,"label",4,"ngIf"],["origem","PLANO_ENTREGA_ENTREGA",3,"entity","selectable","grid","save"],["color","light","icon","bi bi-list-check",3,"label"]],template:function(t,a){if(1&t&&(e.TgZ(0,"grid",0),e.YNc(1,Ge,4,1,"ng-template",null,1,e.W1O),e.TgZ(3,"columns")(4,"column",2),e.YNc(5,Ye,6,4,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(7,"column",4),e.YNc(8,We,1,1,"ng-template",null,5,e.W1O),e.YNc(10,Ke,3,6,"ng-template",null,6,e.W1O),e.qZA(),e.TgZ(12,"column",2),e.YNc(13,et,3,2,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(15,"column",8),e.YNc(16,tt,3,2,"ng-template",null,9,e.W1O),e.YNc(18,at,2,7,"ng-template",null,10,e.W1O),e.qZA(),e.YNc(20,gt,5,7,"column",11),e.TgZ(21,"column",2),e.YNc(22,pt,2,5,"ng-template",null,12,e.W1O),e.qZA(),e._UZ(24,"column",13),e.qZA()()),2&t){const i=e.MAs(2),l=e.MAs(6),c=e.MAs(9),g=e.MAs(11),m=e.MAs(14),f=e.MAs(17),R=e.MAs(19),L=e.MAs(23);e.Q6J("items",a.items)("form",a.form)("groupTemplate",i)("minHeight",300)("editable",a.isDisabled?void 0:"true")("hasAdd",!a.isDisabled&&a.auth.hasPermissionTo("MOD_PENT_ENTR_INCL")&&!a.execucao)("add",a.add.bind(a))("hasEdit",!a.isDisabled&&a.auth.hasPermissionTo("MOD_PENT_ENTR_EDT"))("load",a.load.bind(a))("save",a.save.bind(a))("selectable",a.selectable),e.xp6(4),e.Q6J("title","Entrega\nDemandante/Destinat\xe1rio")("template",l)("editTemplate",l),e.xp6(3),e.Q6J("title","Etiquetas")("width",100)("template",c)("editTemplate",c)("columnEditTemplate",a.selectable?void 0:g)("edit",a.selectable?void 0:a.onColumnEtiquetasEdit.bind(a))("save",a.selectable?void 0:a.onColumnEtiquetasSave.bind(a)),e.xp6(5),e.Q6J("title","Data In\xedcio\nData Fim")("template",m)("editTemplate",m),e.xp6(3),e.Q6J("title","Meta")("width",100)("template",f)("editTemplate",R),e.xp6(5),e.Q6J("ngIf",a.execucao),e.xp6(1),e.Q6J("title",a.lex.translate("Modelo de Entrega")+"\nComent\xe1rios")("template",L)("editTemplate",L),e.xp6(3),e.Q6J("onEdit",a.edit.bind(a))("dynamicButtons",a.dynamicButtons.bind(a))("dynamicOptions",a.dynamicOptions.bind(a))}},dependencies:[T.sg,T.O5,b.M,v.a,p.b,ve.a,F.p,Ee.p,Y.N,N.F,H.R,te.l,Ae.C,qe.y,M],styles:[".objetivo[_ngcontent-%COMP%]{border-bottom:1px solid #ddd;padding:2px 0}"]})}function mt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"input-switch",24),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw(2);return e.KtG(l.onPrincipaisChange(i))}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("size",2)("control",t.filter.controls.principais)("labelInfo",t.lex.translate("Unidades")+" onde o "+t.lex.translate("usuario")+" \xe9 integrante, incluindo unidades superiores sob sua ger\xeancia.")}}function ht(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"toolbar",21)(1,"input-switch",22),e.NdJ("change",function(i){e.CHM(t);const l=e.oxw();return e.KtG(l.onAgruparChange(i))}),e.qZA(),e.YNc(2,mt,1,3,"input-switch",23),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("buttons",t.toolbarButtons),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.agrupar),e.xp6(1),e.Q6J("ngIf",!t.avaliacao)}}function ft(o,n){if(1&o&&(e.TgZ(0,"div")(1,"div",25),e._UZ(2,"input-search",26,27)(4,"input-select",28)(5,"input-datetime",29)(6,"input-datetime",30),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("size",6)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}const bt=function(){return["CONCLUIDO","AVALIADO"]};function vt(o,n){if(1&o&&(e.TgZ(0,"div",25),e._UZ(1,"input-switch",31)(2,"input-text",32)(3,"input-search",26,27)(5,"input-select",33)(6,"input-switch",34),e.qZA(),e.TgZ(7,"div",25),e._UZ(8,"input-search",35,36)(10,"input-search",37,38)(12,"input-select",28)(13,"input-datetime",29)(14,"input-datetime",30),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.meus_planos),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.nome)("placeholder","Nome do "+t.lex.translate("plano de entrega")),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.unidade_id)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.status)("items",t.lookup.PLANO_ENTREGA_STATUS)("filter",t.avaliacao?e.DdM(32,bt):void 0)("valueTodos",null),e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.arquivadas),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.planejamento_id)("dao",t.planejamentoDao),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.cadeia_valor_id)("dao",t.cadeiaValorDao),e.xp6(2),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_filtro_fim)}}function Et(o,n){if(1&o&&(e.TgZ(0,"span",43),e._UZ(1,"i",44),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",null==t.entregas?null:t.entregas.length,"")}}function At(o,n){if(1&o&&e.YNc(0,Et,3,1,"span",42),2&o){const t=n.row;e.Q6J("ngIf",null==t.entregas?null:t.entregas.length)}}function Tt(o,n){if(1&o&&e._UZ(0,"plano-entrega-list-entrega",45),2&o){const t=n.row,a=e.oxw(2);e.Q6J("parent",a)("disabled",a.avaliacao||!a.botaoAtendeCondicoes(a.BOTAO_ALTERAR,t))("entity",t)("execucao",a.execucao)("cdRef",a.cdRef)("planejamentoId",t.planejamento_id)("cadeiaValorId",t.cadeia_valor_id)("unidadeId",t.unidade_id)}}function Ot(o,n){if(1&o&&(e.TgZ(0,"column",39),e.YNc(1,At,1,1,"ng-template",null,40,e.W1O),e.YNc(3,Tt,1,8,"ng-template",null,41,e.W1O),e.qZA()),2&o){const t=e.MAs(2),a=e.MAs(4),i=e.oxw();e.Q6J("align","center")("hint",i.lex.translate("Entrega"))("template",t)("expandTemplate",a)}}function Ct(o,n){if(1&o&&(e.TgZ(0,"order",46),e._uU(1,"#ID"),e.qZA()),2&o){const t=n.header;e.Q6J("header",t)}}function It(o,n){if(1&o&&(e.TgZ(0,"small",47),e._uU(1),e.qZA()),2&o){const t=n.row;e.xp6(1),e.hij("#",t.numero,"")}}function Pt(o,n){if(1&o&&(e.TgZ(0,"order",48),e._uU(1,"Nome"),e.qZA(),e._UZ(2,"br"),e._uU(3)),2&o){const t=n.header,a=e.oxw();e.Q6J("header",t),e.xp6(3),e.hij(" Programa",a.filter.controls.agrupar.value?"":" - Unidade"," ")}}function Zt(o,n){if(1&o&&e._UZ(0,"badge",52),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Programa"))("label",t.programa.nome)}}function Dt(o,n){if(1&o&&e._UZ(0,"badge",53),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon(a.lex.translate("unidade")))("label",t.unidade.sigla)}}function xt(o,n){if(1&o&&(e.TgZ(0,"span",49),e._uU(1),e.qZA(),e._UZ(2,"br"),e.YNc(3,Zt,1,2,"badge",50),e.YNc(4,Dt,1,2,"badge",51)),2&o){const t=n.row,a=e.oxw();e.Udp("max-width",400,"px"),e.xp6(1),e.Oqu(t.nome||""),e.xp6(2),e.Q6J("ngIf",t.programa),e.xp6(1),e.Q6J("ngIf",!a.filter.controls.agrupar.value&&t.unidade)}}function Nt(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function yt(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function Ut(o,n){1&o&&(e._uU(0," Planejamento Institucional"),e._UZ(1,"br"),e._uU(2," Cadeia de Valor "))}function wt(o,n){if(1&o&&e._UZ(0,"badge",55),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("maxWidth",300)("icon",a.entityService.getIcon("Planejamento"))("label",null==t.planejamento?null:t.planejamento.nome)}}function Lt(o,n){if(1&o&&e._UZ(0,"badge",55),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("maxWidth",300)("icon",a.entityService.getIcon("CadeiaValor"))("label",null==t.cadeia_valor?null:t.cadeia_valor.nome)}}function qt(o,n){if(1&o&&(e.YNc(0,wt,1,3,"badge",54),e.YNc(1,Lt,1,3,"badge",54)),2&o){const t=n.row;e.Q6J("ngIf",t.planejamento),e.xp6(1),e.Q6J("ngIf",t.cadeia_valor)}}function Qt(o,n){1&o&&e._UZ(0,"badge",60)}function Rt(o,n){1&o&&e._UZ(0,"badge",61)}function Jt(o,n){if(1&o&&e._UZ(0,"avaliar-nota-badge",62),2&o){const t=e.oxw().row;e.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function Mt(o,n){if(1&o&&(e._UZ(0,"badge",56)(1,"br"),e.YNc(2,Qt,1,0,"badge",57),e.YNc(3,Rt,1,0,"badge",58),e.YNc(4,Jt,1,3,"avaliar-nota-badge",59)),2&o){const t=n.row,a=e.oxw();e.Q6J("color",a.lookup.getColor(a.lookup.PLANO_ENTREGA_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_ENTREGA_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_ENTREGA_STATUS,t.status)),e.xp6(2),e.Q6J("ngIf",t.data_arquivamento),e.xp6(1),e.Q6J("ngIf",t.deleted_at),e.xp6(1),e.Q6J("ngIf",t.avaliacao)}}class ae extends d.E{constructor(n){super(n,r,x.r),this.injector=n,this.showFilter=!0,this.avaliacao=!1,this.execucao=!1,this.habilitarAdesaoToolbar=!1,this.toolbarButtons=[],this.botoes=[],this.routeStatus={route:["uteis","status"]},this.DATAS_FILTRO=[{key:"VIGENTE",value:"Vigente"},{key:"NAOVIGENTE",value:"N\xe3o vigente"},{key:"INICIAM",value:"Iniciam"},{key:"FINALIZAM",value:"Finalizam"}],this.storeFilter=t=>{const a=t?.value;return{meus_planos:a.meus_planos,arquivadas:a.arquivadas,unidade_id:a.unidade_id}},this.filterValidate=(t,a)=>{let i=null;return"data_filtro_inicio"==a&&t.value>this.filter?.controls.data_filtro_fim.value?i="Maior que fim":"data_filtro_fim"==a&&t.value<this.filter?.controls.data_filtro_inicio.value&&(i="Menor que in\xedcio"),i},this.filterWhere=t=>{let a=[],i=t.value;if(this.filter?.controls.principais.value){let l=["unidade_id","in",(this.auth.unidades||[]).map(c=>c.id)];if(this.auth.isGestorAlgumaAreaTrabalho()){let c=this.auth.unidades?.filter(f=>this.unidadeService.isGestorUnidade(f)),g=c?.map(f=>f.unidade_pai?.id||"").filter(f=>f.length);g?.length&&l[2].push(...g);let m=["unidade.unidade_pai_id","in",c?.map(f=>f.id)];a.push(["or",l,m])}else a.push(l)}if(this.filter?.controls.meus_planos.value){let l=["unidade_id","in",(this.auth.unidades||[]).map(c=>c.id)];a.push(l)}return i.nome?.length&&a.push(["nome","like","%"+i.nome.trim().replace(" ","%")+"%"]),i.data_filtro&&(a.push(["data_filtro","==",i.data_filtro]),a.push(["data_filtro_inicio","==",i.data_filtro_inicio]),a.push(["data_filtro_fim","==",i.data_filtro_fim])),i.unidade_id&&a.push(["unidade_id","==",i.unidade_id]),i.planejamento_id&&a.push(["planejamento_id","==",i.planejamento_id]),i.cadeia_valor_id&&a.push(["cadeia_valor_id","==",i.cadeia_valor_id]),this.isModal?a.push(["status","==","ATIVO"]):(i.status||this.avaliacao)&&a.push(["status","in",i.status?[i.status]:["CONCLUIDO","AVALIADO"]]),i.unidades_filhas&&a.push(["unidades_filhas","==",!0]),a.push(["incluir_arquivados","==",this.filter.controls.arquivadas.value]),a},this.avaliacaoDao=n.get(E.w),this.unidadeDao=n.get(P.J),this.planejamentoDao=n.get(Z.U),this.cadeiaValorDao=n.get(I.m),this.planoEntregaService=n.get(_.f),this.unidadeService=n.get(A.Z),this.unidadeSelecionada=this.auth.unidade,this.code="MOD_PLANE",this.title=this.lex.translate("Planos de Entregas"),this.filter=this.fh.FormBuilder({agrupar:{default:!0},principais:{default:!1},arquivadas:{default:!1},nome:{default:""},data_filtro:{default:null},data_filtro_inicio:{default:new Date},data_filtro_fim:{default:new Date},status:{default:""},unidade_id:{default:null},unidades_filhas:{default:!1},planejamento_id:{default:null},cadeia_valor_id:{default:null},meus_planos:{default:!0}},this.cdRef,this.filterValidate),this.join=["planejamento:id,nome","programa:id,nome","cadeia_valor:id,nome","unidade:id,sigla,path","entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","entregas.comentarios.usuario:id,nome,apelido","entregas.reacoes.usuario:id,nome,apelido","unidade.gestor:id","unidade.gestores_substitutos:id","unidade.unidade_pai","avaliacao"],this.groupBy=[{field:"unidade.sigla",label:"Unidade"}],this.BOTAO_ADERIR_OPTION={label:"Aderir",icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{metadata:{planoEntrega:this.linha},modalClose:t=>{this.refresh()}})}).bind(this)},this.BOTAO_ADERIR_TOOLBAR={label:"Aderir",disabled:!this.habilitarAdesaoToolbar,icon:this.entityService.getIcon("Adesao"),onClick:(()=>{this.go.navigate({route:["gestao","plano-entrega","adesao"]},{modalClose:t=>{this.refresh()}})}).bind(this)},this.BOTAO_ALTERAR={label:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:t=>this.go.navigate({route:["gestao","plano-entrega",t.id,"edit"]},this.modalRefreshId(t))},this.BOTAO_ARQUIVAR={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this)},this.BOTAO_AVALIAR={label:"Avaliar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"AVALIADO"),onClick:this.avaliar.bind(this)},this.BOTAO_CANCELAR_PLANO={label:"Cancelar plano",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarPlano.bind(this)},this.BOTAO_CANCELAR_AVALIACAO={label:"Cancelar avalia\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CANCELADO"),onClick:this.cancelarAvaliacao.bind(this)},this.BOTAO_CANCELAR_CONCLUSAO={label:"Cancelar conclus\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.cancelarConclusao.bind(this)},this.BOTAO_CANCELAR_HOMOLOGACAO={label:"Cancelar homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.cancelarHomologacao.bind(this)},this.BOTAO_CONCLUIR={label:"Concluir",id:"CONCLUIDO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"CONCLUIDO"),onClick:this.concluir.bind(this)},this.BOTAO_CONSULTAR={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:t=>this.go.navigate({route:["gestao","plano-entrega",t.id,"consult"]},{modal:!0})},this.BOTAO_DESARQUIVAR={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this)},this.BOTAO_EXCLUIR={label:"Excluir",icon:"bi bi-trash",onClick:this.delete.bind(this)},this.BOTAO_HOMOLOGAR={label:"Homologar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.homologar.bind(this)},this.BOTAO_LIBERAR_HOMOLOGACAO={label:"Liberar para homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"HOMOLOGANDO"),onClick:this.liberarHomologacao.bind(this)},this.BOTAO_LOGS={label:"Logs",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:t=>this.go.navigate({route:["logs","change",t.id,"consult"]})},this.BOTAO_REATIVAR={label:"Reativar",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"ATIVO"),onClick:this.reativar.bind(this)},this.BOTAO_RETIRAR_HOMOLOGACAO={label:"Retirar de homologa\xe7\xe3o",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"INCLUIDO"),onClick:this.retirarHomologacao.bind(this)},this.BOTAO_SUSPENDER={label:"Suspender",id:"PAUSADO",icon:this.lookup.getIcon(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),color:this.lookup.getColor(this.lookup.PLANO_ENTREGA_STATUS,"SUSPENSO"),onClick:this.suspender.bind(this)},this.botoes=[this.BOTAO_ALTERAR,this.BOTAO_ARQUIVAR,this.BOTAO_AVALIAR,this.BOTAO_CANCELAR_PLANO,this.BOTAO_CANCELAR_AVALIACAO,this.BOTAO_CANCELAR_CONCLUSAO,this.BOTAO_CANCELAR_HOMOLOGACAO,this.BOTAO_CONCLUIR,this.BOTAO_CONSULTAR,this.BOTAO_DESARQUIVAR,this.BOTAO_EXCLUIR,this.BOTAO_HOMOLOGAR,this.BOTAO_LIBERAR_HOMOLOGACAO,this.BOTAO_LOGS,this.BOTAO_REATIVAR,this.BOTAO_RETIRAR_HOMOLOGACAO,this.BOTAO_SUSPENDER]}ngOnInit(){super.ngOnInit(),this.execucao=!!this.queryParams?.execucao,this.avaliacao=!!this.queryParams?.avaliacao,this.showFilter=!(typeof this.queryParams?.showFilter<"u")||"true"==this.queryParams.showFilter,this.selectable=this.metadata?.selectable||this.selectable,this.execucao&&(this.title=this.title+" (Execu\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.principais.setValue(!1)),this.avaliacao&&(this.title=this.title+" (Avalia\xe7\xe3o)",this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||null),this.filter.controls.unidades_filhas.setValue(!0),this.filter.controls.principais.setValue(!1)),this.checaBotaoAderirToolbar()}ngAfterContentChecked(){this.auth.unidade!=this.unidadeSelecionada&&(this.unidadeSelecionada=this.auth.unidade,this.checaBotaoAderirToolbar(),this.cdRef.detectChanges())}onGridLoad(n){const t=(this.grid?.query||this.query).extra;n&&this.execucao&&n.forEach(a=>{["ATIVO","SUSPENSO"].includes(a.status)&&this.grid.expand(a.id)}),n?.forEach(a=>{let i=a;i.avaliacao&&(i.avaliacao.tipo_avaliacao=t?.tipos_avaliacoes?.find(l=>l.id==i.avaliacao.tipo_avaliacao_id))})}checaBotaoAderirToolbar(){}planosEntregasAtivosUnidadePai(){return this.auth.unidade?.unidade_pai?.planos_entrega?.filter(n=>this.planoEntregaService.isAtivo(n))||[]}planosEntregasAtivosUnidadeSelecionada(){return this.auth?.unidade?.planos_entrega?.filter(n=>this.planoEntregaService.isAtivo(n))||[]}filterClear(n){n.controls.nome.setValue(""),n.controls.data_filtro.setValue(null),n.controls.data_filtro_inicio.setValue(new Date),n.controls.data_filtro_fim.setValue(new Date),n.controls.unidade_id.setValue(null),n.controls.planejamento_id.setValue(null),n.controls.cadeia_valor_id.setValue(null),n.controls.status.setValue(null),n.controls.meus_planos.setValue(!1),super.filterClear(n)}onAgruparChange(n){const t=this.filter.controls.agrupar.value;(t&&!this.groupBy?.length||!t&&this.groupBy?.length)&&(this.groupBy=t?[{field:"unidade.sigla",label:"Unidade"}]:[],this.cdRef.detectChanges(),this.grid.reloadFilter())}onPrincipaisChange(n){this.filter.controls.principais.value?(this.filter.controls.unidade_id.setValue(null),this.filter.controls.meus_planos.setValue(!1)):this.filter.controls.meus_planos.setValue(!0),this.grid.reloadFilter()}dynamicButtons(n){let t=[],a=n;switch(this.planoEntregaService.situacaoPlano(a)){case"INCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_LIBERAR_HOMOLOGACAO,n)?t.push(this.BOTAO_LIBERAR_HOMOLOGACAO):t.push(this.BOTAO_CONSULTAR);break;case"HOMOLOGANDO":this.botaoAtendeCondicoes(this.BOTAO_HOMOLOGAR,n)&&t.push(this.BOTAO_HOMOLOGAR);break;case"ATIVO":this.botaoAtendeCondicoes(this.BOTAO_CONCLUIR,n)&&t.push(this.BOTAO_CONCLUIR);break;case"CONCLUIDO":this.botaoAtendeCondicoes(this.BOTAO_AVALIAR,n)&&t.push(this.BOTAO_AVALIAR);break;case"SUSPENSO":this.botaoAtendeCondicoes(this.BOTAO_REATIVAR,n)&&t.push(this.BOTAO_REATIVAR);break;case"AVALIADO":this.botaoAtendeCondicoes(this.BOTAO_ARQUIVAR,n)&&t.push(this.BOTAO_ARQUIVAR);break;case"ARQUIVADO":this.botaoAtendeCondicoes(this.BOTAO_DESARQUIVAR,n)&&t.push(this.BOTAO_DESARQUIVAR)}return t.length||t.push(this.BOTAO_CONSULTAR),t}dynamicOptions(n){let t=[];return this.linha=n,this.botoes.forEach(a=>{this.botaoAtendeCondicoes(a,n)&&t.push(a)}),t}botaoAtendeCondicoes(n,t){switch(n){case this.BOTAO_ADERIR_OPTION:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&t.unidade_id==this.auth.unidade?.unidade_pai_id&&(this.unidadeService.isGestorUnidade()||this.auth.isLotacaoUsuario(this.auth.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ADR"))&&0==this.planosEntregasAtivosUnidadeSelecionada().filter(we=>this.util.intersection([{start:we.data_inicio,end:we.data_fim},{start:t.data_inicio,end:t.data_fim}])).length;case this.BOTAO_ALTERAR:let a=["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(t)),i=["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)),l=this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id)&&this.auth.hasPermissionTo("MOD_PENT_EDT_FLH"),c=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",t.unidade.unidade_pai_id),g="ATIVO"==this.planoEntregaService.situacaoPlano(t)&&this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo(["MOD_PENT_EDT_ATV_HOMOL","MOD_PENT_EDT_ATV_ATV"]),m=this.auth.hasPermissionTo("MOD_PENT_QQR_UND");return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EDT")&&a&&this.planoEntregaService.isValido(t)&&(i||l||c||g||m);case this.BOTAO_ARQUIVAR:return["CONCLUIDO","AVALIADO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_AVALIAR:let f=this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id),R=this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",t.unidade.id),L=this.auth.isLotacaoUsuario(t.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_AVAL"),ee=this.auth.isGestorLinhaAscendente(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(t)&&(f||R||L||ee);case this.BOTAO_CANCELAR_AVALIACAO:return"AVALIADO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id)||this.auth.isIntegrante("AVALIADOR_PLANO_ENTREGA",t.unidade.id));case this.BOTAO_CANCELAR_CONCLUSAO:return"CONCLUIDO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CANC_CONCL"));case this.BOTAO_CANCELAR_HOMOLOGACAO:return!this.execucao&&"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id)||this.auth.isLotacaoUsuario(t.unidade?.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_CANC_HOMOL")||this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",t.unidade.unidade_pai_id));case this.BOTAO_CANCELAR_PLANO:return this.auth.hasPermissionTo("MOD_PENT_CNC")&&["INCLUIDO","HOMOLOGANDO","ATIVO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade?.id)||this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id));case this.BOTAO_CONCLUIR:return"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_CONC"));case this.BOTAO_CONSULTAR:return this.auth.hasPermissionTo("MOD_PENT");case this.BOTAO_DESARQUIVAR:return"ARQUIVADO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_ARQ"));case this.BOTAO_EXCLUIR:return!this.execucao&&this.auth.hasPermissionTo("MOD_PENT_EXCL")&&["INCLUIDO","HOMOLOGANDO"].includes(this.planoEntregaService.situacaoPlano(t))&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade));case this.BOTAO_HOMOLOGAR:let he="HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(t),ho=this.unidadeService.isGestorUnidade(t.unidade?.unidade_pai_id),fo=this.auth.isLotacaoUsuario(t.unidade.unidade_pai)&&this.auth.hasPermissionTo("MOD_PENT_HOMOL"),bo=this.auth.isIntegrante("HOMOLOGADOR_PLANO_ENTREGA",t.unidade.unidade_pai_id);return!this.execucao&&he&&(ho||fo||bo);case this.BOTAO_LIBERAR_HOMOLOGACAO:return!this.execucao&&"INCLUIDO"==this.planoEntregaService.situacaoPlano(t)&&t.entregas.length>0&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_LIB_HOMOL"));case this.BOTAO_LOGS:return this.unidadeService.isGestorUnidade(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_AVAL_SUBORD");case this.BOTAO_REATIVAR:return"SUSPENSO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RTV")||this.auth.isGestorLinhaAscendente(t.unidade));case this.BOTAO_RETIRAR_HOMOLOGACAO:return!this.execucao&&"HOMOLOGANDO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_RET_HOMOL"));case this.BOTAO_SUSPENDER:return"ATIVO"==this.planoEntregaService.situacaoPlano(t)&&(this.unidadeService.isGestorUnidade(t.unidade)||this.auth.isLotacaoUsuario(t.unidade)&&this.auth.hasPermissionTo("MOD_PENT_SUSP")||this.auth.isGestorLinhaAscendente(t.unidade))}return!1}arquivar(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},n,{arquivar:!0}),novoStatus:n.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Arquivar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}avaliar(n){this.go.navigate({route:["gestao","plano-entrega",n.id,"avaliar"]},{modal:!0,metadata:{planoEntrega:n},modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id,["avaliacao.tipo_avaliacao.notas"]).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarAvaliacao(n){var t=this;return(0,u.Z)(function*(){t.submitting=!0;try{(yield t.avaliacaoDao.cancelarAvaliacao(n.avaliacao.id))&&(t.grid?.query||t.query).refreshId(n.id).then(()=>{t.checaBotaoAderirToolbar()})}catch(a){t.error(a.message||a)}finally{t.submitting=!1}})()}cancelarConclusao(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"ATIVO",onClick:this.dao.cancelarConclusao.bind(this.dao)},title:"Cancelar Conclus\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarHomologacao(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"HOMOLOGANDO",onClick:this.dao.cancelarHomologacao.bind(this.dao)},title:"Cancelar Homologa\xe7\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}cancelarPlano(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},n,{arquivar:!0}),novoStatus:"CANCELADO",onClick:this.dao.cancelarPlano.bind(this.dao)},title:"Cancelar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}concluir(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"CONCLUIDO",onClick:this.dao.concluir.bind(this.dao)},title:"Concluir Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}desarquivar(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:Object.assign({},n,{arquivar:!1}),novoStatus:n.status,onClick:this.dao.arquivar.bind(this.dao)},title:"Desarquivar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}homologar(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"ATIVO",onClick:this.dao.homologar.bind(this.dao)},title:"Homologar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}liberarHomologacao(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"HOMOLOGANDO",onClick:this.dao.liberarHomologacao.bind(this.dao)},title:"Liberar para Homologa\xe7\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}reativar(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"ATIVO",onClick:this.dao.reativar.bind(this.dao)},title:"Reativar Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}retirarHomologacao(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"INCLUIDO",onClick:this.dao.retirarHomologacao.bind(this.dao)},title:"Retirar de Homologa\xe7\xe3o",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}suspender(n){this.go.navigate(this.routeStatus,{metadata:{tipo:"PlanoEntrega",entity:n,novoStatus:"SUSPENSO",onClick:this.dao.suspender.bind(this.dao)},title:"Suspender Plano de Entregas",modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id).then(()=>{this.checaBotaoAderirToolbar()})}})}canAdd(){return this.auth.hasPermissionTo("MOD_PENT_INCL")}static#e=this.\u0275fac=function(t){return new(t||ae)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:ae,selectors:[["plano-entrega-list"]],viewQuery:function(t,a){if(1&t&&e.Gf(b.M,5),2&t){let i;e.iGM(i=e.CRH())&&(a.grid=i.first)}},features:[e.qOj],decls:34,vars:35,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList","select"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed","visible"],[4,"ngIf","ngIfElse"],["naoEModal",""],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","template"],["titleIdNumeroStatus",""],["columnNumero",""],["titleNomeProgramaUnidade",""],["columnNome",""],["title","In\xedcio","orderBy","data_inicio",3,"template"],["columnInicio",""],["title","Fim","orderBy","data_fim",3,"template"],["columnFim",""],["titlePlanoCadeia",""],["columnPlanoCadeia",""],[3,"title","template"],["columnStatus",""],["type","options",3,"dynamicOptions","dynamicButtons"],[3,"rows"],[3,"buttons"],["labelPosition","left","label","Agrupar por unidade","controlName","agrupar",3,"size","control","change"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change",4,"ngIf"],["labelPosition","left","label","Vinculados","controlName","principais",3,"size","control","labelInfo","change"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["unidade",""],["label","Data","itemTodos","- Nenhum -","controlName","data_filtro",3,"size","valueTodos","control","items"],["date","","label","In\xedcio","controlName","data_filtro_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["date","","label","Fim","controlName","data_filtro_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["label","Meus","controlName","meus_planos","labelInfo","Planos de entrega das unidade da qual sou integrante (\xc1reas de trabalho)",3,"size","control"],["label","Nome","controlName","nome",3,"size","control","placeholder"],["label","Status","controlName","status","itemTodos","- Todos -",3,"size","control","items","filter","valueTodos"],["label","Arquivados","controlName","arquivadas","labelInfo","Listar tamb\xe9m os planos de entregas arquivados",3,"size","control"],["controlName","planejamento_id",3,"size","control","dao"],["planejamento",""],["controlName","cadeia_valor_id",3,"size","control","dao"],["cadeiaValor",""],["type","expand","icon","bi bi-list-check",3,"align","hint","template","expandTemplate"],["columnEntregas",""],["columnExpandedEntregas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-list-check"],[3,"parent","disabled","entity","execucao","cdRef","planejamentoId","cadeiaValorId","unidadeId"],["by","numero",3,"header"],[1,"micro-text","fw-ligh"],["by","nome",3,"header"],[1,"text-break","text-wrap"],["color","light",3,"icon","label",4,"ngIf"],["color","secondary",3,"icon","label",4,"ngIf"],["color","light",3,"icon","label"],["color","secondary",3,"icon","label"],["color","light",3,"maxWidth","icon","label",4,"ngIf"],["color","light",3,"maxWidth","icon","label"],[3,"color","icon","label"],["color","warning","icon","bi bi-inboxes","label","Arquivado",4,"ngIf"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo",4,"ngIf"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["color","warning","icon","bi bi-inboxes","label","Arquivado"],["color","danger","icon","bi bi-trash3","label","Exclu\xeddo"],[3,"align","tipoAvaliacao","nota"]],template:function(t,a){if(1&t&&(e.TgZ(0,"grid",0),e.NdJ("select",function(l){return a.onSelect(l)}),e.YNc(1,ht,3,4,"toolbar",1),e.TgZ(2,"filter",2),e.YNc(3,ft,7,13,"div",3),e.YNc(4,vt,15,33,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(6,"columns"),e.YNc(7,Ot,5,4,"column",5),e.TgZ(8,"column",6),e.YNc(9,Ct,2,1,"ng-template",null,7,e.W1O),e.YNc(11,It,2,1,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"column",6),e.YNc(14,Pt,4,2,"ng-template",null,9,e.W1O),e.YNc(16,xt,5,5,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(18,"column",11),e.YNc(19,Nt,2,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(21,"column",13),e.YNc(22,yt,2,1,"ng-template",null,14,e.W1O),e.qZA(),e.TgZ(24,"column",6),e.YNc(25,Ut,3,0,"ng-template",null,15,e.W1O),e.YNc(27,qt,2,2,"ng-template",null,16,e.W1O),e.qZA(),e.TgZ(29,"column",17),e.YNc(30,Mt,5,6,"ng-template",null,18,e.W1O),e.qZA(),e._UZ(32,"column",19),e.qZA(),e._UZ(33,"pagination",20),e.qZA()),2&t){const i=e.MAs(5),l=e.MAs(10),c=e.MAs(12),g=e.MAs(15),m=e.MAs(17),f=e.MAs(20),R=e.MAs(23),L=e.MAs(26),ee=e.MAs(28),he=e.MAs(31);e.Q6J("dao",a.dao)("add",a.add)("title",a.isModal?"":a.title)("orderBy",a.orderBy)("groupBy",a.groupBy)("join",a.join)("selectable",a.selectable)("hasAdd",a.canAdd())("hasEdit",!1)("loadList",a.onGridLoad.bind(a)),e.xp6(1),e.Q6J("ngIf",!a.selectable),e.xp6(1),e.Q6J("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("clear",a.filterClear.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",!a.selectable&&a.filterCollapsed)("visible",a.showFilter),e.xp6(1),e.Q6J("ngIf",a.isModal)("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",!a.selectable),e.xp6(1),e.Q6J("titleTemplate",l)("template",c),e.xp6(5),e.Q6J("titleTemplate",g)("template",m),e.xp6(5),e.Q6J("template",f),e.xp6(3),e.Q6J("template",R),e.xp6(3),e.Q6J("titleTemplate",L)("template",ee),e.xp6(5),e.Q6J("title","Status\nAvalia\xe7\xe3o")("template",he),e.xp6(3),e.Q6J("dynamicOptions",a.dynamicOptions.bind(a))("dynamicButtons",a.dynamicButtons.bind(a)),e.xp6(1),e.Q6J("rows",a.rowsLimit)}},dependencies:[T.O5,b.M,v.a,p.b,D.z,z.n,j.Q,ve.a,Q.V,G.m,w.k,F.p,me.l,N.F,Le.M,W]})}var Te=s(92214),ne=s(1184);const Vt=["programa"],St=["unidade"],zt=["nome"],jt=["data_fim"];class V extends ne.F{constructor(n){super(n,r,x.r),this.injector=n,this.validate=(t,a)=>{let i=null;return["nome","unidade_id","programa_id"].indexOf(a)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),["data_inicio"].indexOf(a)>=0&&!this.dao?.validDateTime(t.value)&&(i="Inv\xe1lido"),["data_fim"].indexOf(a)>=0&&!this.dao?.validDateTime(t.value)&&(i="Inv\xe1lido"),i},this.formValidation=t=>{const a=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;if(!this.programa?.selectedEntity)return"Obrigat\xf3rio selecionar o programa";if(!this.dao?.validDateTime(a))return"Data de in\xedcio inv\xe1lida";if(!this.dao?.validDateTime(i))return"Data de fim inv\xe1lida";if(a>i)return"A data do fim n\xe3o pode ser menor que a data do in\xedcio!";{const c=this.form.controls.entregas.value||[];for(let g of c){if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_inicio<a)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data inicial anterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(a);if(!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&g.data_fim>i)return"A "+this.lex.translate("entrega")+" '"+g.descricao+"' possui data fim posterior \xe0 "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(i)}}},this.titleEdit=t=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(t?.nome||""),this.unidadeDao=n.get(P.J),this.programaDao=n.get(Te.w),this.cadeiaValorDao=n.get(I.m),this.planoEntregaDao=n.get(x.r),this.planejamentoInstitucionalDao=n.get(Z.U),this.join=["entregas.entrega","entregas.objetivos.objetivo","entregas.processos.processo","entregas.unidade","unidade","entregas.reacoes.usuario:id,nome,apelido"],this.modalWidth=1200,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},unidade_id:{default:""},plano_entrega_id:{default:null},planejamento_id:{default:null},cadeia_valor_id:{default:null},programa_id:{default:null},entregas:{default:[]}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!0,vigentesUnidadeExecutora:!1}}loadData(n,t){var a=this;return(0,u.Z)(function*(){let i=Object.assign({},t.value);t.patchValue(a.util.fillForm(i,n)),a.cdRef.detectChanges()})()}initializeData(n){var t=this;return(0,u.Z)(function*(){t.entity=new r,t.entity.unidade_id=t.auth.unidade?.id||"",t.entity.unidade=t.auth.unidade;let a=yield t.programaDao.query({where:[["vigentesUnidadeExecutora","==",t.auth.unidade.id]]}).asPromise(),i=a[a.length-1];t.entity.programa=i,t.entity.programa_id=i.id;const l=new Date(t.entity.data_inicio).toLocaleDateString(),c=t.entity.data_fim?new Date(t.entity.data_fim).toLocaleDateString():(new Date).toLocaleDateString();t.entity.nome=t.auth.unidade.sigla+" - "+l+" - "+c,t.loadData(t.entity,t.form)})()}saveData(n){var t=this;return(0,u.Z)(function*(){return new Promise((a,i)=>{let l=t.util.fill(new r,t.entity);l=t.util.fillForm(l,t.form.value),l.entregas=l.entregas?.filter(c=>c._status)||[],a(l)})})()}dynamicButtons(n){return[]}onDataChange(){this.sugereNome()}onUnidadeChange(){var n=this;return(0,u.Z)(function*(){let a=n.form.controls.unidade_id.value||n.auth.unidade?.id;if(a)try{yield n.planoEntregaDao.permissaoIncluir(a)}catch(i){n.error(i)}n.sugereNome()})()}sugereNome(){const n=this.unidade?.selectedItem?this.unidade?.selectedItem?.entity.sigla:this.auth.unidade?.sigla,t=new Date(this.form.controls.data_inicio.value).toLocaleDateString(),a=this.form.controls.data_fim.value?" - "+new Date(this.form.controls.data_fim.value).toLocaleDateString():"";this.form.controls.nome.setValue(n+" - "+t+a)}somaDia(n,t){let a=new Date(n);return a.setDate(a.getDate()+t),a}onProgramaChange(){const n=this.programa?.selectedEntity?.prazo_max_plano_entrega,t=this.somaDia(this.entity.data_inicio,n);this.entity?.data_fim||(this.form.controls.data_fim.setValue(new Date(t)),this.dataFim?.change.emit())}static#e=this.\u0275fac=function(t){return new(t||V)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:V,selectors:[["app-plano-entrega-form"]],viewQuery:function(t,a){if(1&t&&(e.Gf(y.Q,5),e.Gf(b.M,7),e.Gf(Vt,7),e.Gf(St,7),e.Gf(zt,7),e.Gf(jt,7)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.grid=i.first),e.iGM(i=e.CRH())&&(a.programa=i.first),e.iGM(i=e.CRH())&&(a.unidade=i.first),e.iGM(i=e.CRH())&&(a.nomePE=i.first),e.iGM(i=e.CRH())&&(a.dataFim=i.first)}},features:[e.qOj],decls:20,vars:28,consts:[["initialFocus","entregas",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","unidade_id","required","",3,"size","disabled","dao","change"],["unidade",""],["controlName","programa_id","required","",3,"size","disabled","dao","metadata","change"],["programa",""],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo","change"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo","change"],["data_fim",""],["label","Nome","controlName","nome","required","",3,"size"],["nome",""],["controlName","planejamento_id","label","Planejamento Institucional",3,"size","emptyValue","dao"],["planejamento",""],["controlName","cadeia_valor_id","label","Cadeia de Valor",3,"size","emptyValue","dao"],["cadeiaValor",""],["title","Entregas"],["noPersist","",3,"disabled","control","planejamentoId","cadeiaValorId","unidadeId","dataFim"],["entregas",""]],template:function(t,a){1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"div")(2,"div",1)(3,"input-search",2,3),e.NdJ("change",function(){return a.onUnidadeChange()}),e.qZA(),e.TgZ(5,"input-search",4,5),e.NdJ("change",function(){return a.onProgramaChange()}),e.qZA(),e.TgZ(7,"input-datetime",6),e.NdJ("change",function(){return a.onDataChange()}),e.qZA(),e.TgZ(8,"input-datetime",7,8),e.NdJ("change",function(){return a.onDataChange()}),e.qZA()(),e.TgZ(10,"div",1),e._UZ(11,"input-text",9,10)(13,"input-search",11,12)(15,"input-search",13,14),e.qZA(),e._UZ(17,"separator",15)(18,"plano-entrega-list-entrega",16,17),e.qZA()()),2&t&&(e.Q6J("form",a.form)("disabled",a.formDisabled)("title",a.isModal?"":a.title),e.xp6(3),e.Q6J("size",4)("disabled",null!=a.entity&&a.entity.id?"disabled":void 0)("dao",a.unidadeDao),e.xp6(2),e.Q6J("size",4)("disabled",null!=a.entity&&a.entity.id?"disabled":void 0)("dao",a.programaDao)("metadata",a.programaMetadata),e.xp6(2),e.Q6J("size",2)("labelInfo","In\xedcio "+a.lex.translate("Plano de Entrega")),e.xp6(1),e.Q6J("size",2)("labelInfo","Fim "+a.lex.translate("Plano de Entrega")),e.xp6(3),e.Q6J("size",4),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",4)("emptyValue",null)("dao",a.planejamentoInstitucionalDao),e.xp6(2),e.Q6J("size",4)("emptyValue",null)("dao",a.cadeiaValorDao),e.xp6(3),e.Q6J("disabled",a.formDisabled)("control",a.form.controls.entregas)("planejamentoId",a.form.controls.planejamento_id.value)("cadeiaValorId",a.form.controls.cadeia_valor_id.value)("unidadeId",a.form.controls.unidade_id.value)("dataFim",a.form.controls.data_fim.value))},dependencies:[y.Q,Q.V,G.m,w.k,Y.N,W]})}var Oe=s(67465),Ce=s(91058),Ie=s(67501),Gt=s(19108);const Ft=["unidade"];function kt(o,n){if(1&o&&e._UZ(0,"planejamento-show",18),2&o){const t=e.oxw(2);e.Q6J("planejamento",t.objetivo.planejamento)}}function Bt(o,n){if(1&o&&(e.ynx(0),e.YNc(1,kt,1,1,"planejamento-show",16),e.TgZ(2,"div",17)(3,"h5"),e._uU(4,"Objetivo:"),e.qZA(),e.TgZ(5,"h6"),e._uU(6),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.objetivo.planejamento),e.xp6(5),e.Oqu(t.objetivo.nome)}}function Yt(o,n){if(1&o&&(e.TgZ(0,"div",21)(1,"h6"),e._uU(2,"Cadeia de valor:"),e.qZA(),e.TgZ(3,"h4"),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(4),e.Oqu(t.processo.cadeia_valor.nome)}}function Ht(o,n){if(1&o&&(e.ynx(0),e.YNc(1,Yt,5,1,"div",19),e.TgZ(2,"div",20)(3,"h5"),e._uU(4,"Processo:"),e.qZA(),e.TgZ(5,"h6"),e._uU(6),e.qZA()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.processo.cadeia_valor),e.xp6(5),e.Oqu(t.processo.nome)}}function Wt(o,n){if(1&o&&e._UZ(0,"badge",25),2&o){const t=e.oxw().row,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",t.plano_entrega.unidade.sigla)}}function Kt(o,n){if(1&o&&e._UZ(0,"badge",26),2&o){const t=e.oxw().row;e.Q6J("label",t.destinatario)}}function Xt(o,n){if(1&o&&(e._uU(0),e._UZ(1,"br"),e.TgZ(2,"span",22),e.YNc(3,Wt,1,2,"badge",23),e.YNc(4,Kt,1,1,"badge",24),e.qZA()),2&o){const t=n.row;e.hij(" ",t.descricao,""),e.xp6(3),e.Q6J("ngIf",t.plano_entrega.unidade),e.xp6(1),e.Q6J("ngIf",null==t.destinatario?null:t.destinatario.length)}}function $t(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function ea(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function ta(o,n){if(1&o&&(e.YNc(0,$t,2,1,"span",0),e._UZ(1,"br"),e.YNc(2,ea,2,1,"span",0)),2&o){const t=n.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function aa(o,n){if(1&o&&e._UZ(0,"progress-bar",27),2&o){const t=n.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}class K extends d.E{constructor(n){super(n,k.O,U.K),this.injector=n,this.filterWhere=t=>{let a=[],i=t.value;return this.objetivoId&&a.push(["objetivos.objetivo_id","==",this.objetivoId]),this.processoId&&a.push(["processos.processo_id","==",this.processoId]),i.unidade_id&&a.push(["plano_entrega.unidade_id","==",i.unidade_id]),i.entrega_id&&a.push(["entrega_id","==",i.entrega_id]),i.data_inicio&&a.push(["data_inicio",">=",i.data_inicio]),i.data_fim&&a.push(["data_fim","<=",i.data_fim]),a},this.unidadeDao=n.get(P.J),this.entregaDao=n.get(Oe.y),this.entregaService=n.get(_.f),this.objetivoDao=n.get(Ce.e),this.processoDao=n.get(Ie.k),this.join=["plano_entrega.unidade"],this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({unidade_id:{default:null},entrega_id:{default:null},data_inicio:{default:null},data_fim:{default:null}})}ngOnInit(){super.ngOnInit(),this.objetivoId=this.urlParams.get("objetivo_id")||void 0,this.processoId=this.urlParams.get("processo_id")||void 0,this.objetivoId&&this.objetivoDao?.getById(this.objetivoId,["planejamento"]).then(n=>{this.objetivo=n}),this.processoId&&this.processoDao?.getById(this.processoId,["cadeia_valor"]).then(n=>{this.processo=n})}filterClear(n){n.controls.unidade_id.setValue(null),n.controls.entrega_id.setValue(null),n.controls.data_inicio.setValue(null),n.controls.data_fim.setValue(null),super.filterClear(n)}static#e=this.\u0275fac=function(t){return new(t||K)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:K,selectors:[["plano-entrega-mapa-entregas"]],viewQuery:function(t,a){if(1&t&&(e.Gf(b.M,5),e.Gf(Ft,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.grid=i.first),e.iGM(i=e.CRH())&&(a.unidade=i.first)}},features:[e.qOj],decls:23,vars:31,consts:[[4,"ngIf"],[3,"dao","title","orderBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id",3,"size","control","dao"],["unidade",""],["controlName","entrega_id",3,"size","control","dao"],["entrega",""],["date","","noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data de in\xedcio do planejamento institucional",3,"size","control"],["date","","noIcon","","label","Fim","controlName","data_fim","labelInfo","Data do fim do planejamento institucional",3,"size","control"],[3,"title","template"],["columnEntregaCliente",""],["columnDatas",""],[3,"title","width","template"],["columnProgresso",""],[3,"rows"],[3,"planejamento",4,"ngIf"],[1,"objetivos","arrow_box","w-100"],[3,"planejamento"],["class","planejamento arrow_box first-box w-100",4,"ngIf"],[1,"procesos","arrow_box","w-100"],[1,"planejamento","arrow_box","first-box","w-100"],[1,"d-block"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],["color","success",3,"value","goal"]],template:function(t,a){if(1&t&&(e.YNc(0,Bt,7,2,"ng-container",0),e.YNc(1,Ht,7,2,"ng-container",0),e.TgZ(2,"grid",1),e._UZ(3,"toolbar"),e.TgZ(4,"filter",2)(5,"div",3),e._UZ(6,"input-search",4,5)(8,"input-search",6,7)(10,"input-datetime",8)(11,"input-datetime",9),e.qZA()(),e.TgZ(12,"columns")(13,"column",10),e.YNc(14,Xt,5,3,"ng-template",null,11,e.W1O),e.qZA(),e.TgZ(16,"column",10),e.YNc(17,ta,3,2,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(19,"column",13),e.YNc(20,aa,1,2,"ng-template",null,14,e.W1O),e.qZA()(),e._UZ(22,"pagination",15),e.qZA()),2&t){const i=e.MAs(15),l=e.MAs(18),c=e.MAs(21);e.Q6J("ngIf",a.objetivo),e.xp6(1),e.Q6J("ngIf",a.processo),e.xp6(1),e.Q6J("dao",a.dao)("title",a.isModal?"":a.title)("orderBy",a.orderBy)("join",a.join),e.xp6(2),e.Q6J("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("clear",a.filterClear.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",!a.selectable&&a.filterCollapsed),e.xp6(2),e.Q6J("size",4)("control",a.filter.controls.unidade_id)("dao",a.unidadeDao),e.xp6(2),e.Q6J("size",4)("control",a.filter.controls.entrega_id)("dao",a.entregaDao),e.xp6(2),e.Q6J("size",2)("control",a.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",2)("control",a.filter.controls.data_fim),e.xp6(2),e.Q6J("title","Entrega\nDemandante/Destinat\xe1rio")("template",i),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",l),e.xp6(3),e.Q6J("title","Progresso")("width",200)("template",c),e.xp6(3),e.Q6J("rows",a.rowsLimit)}},dependencies:[T.O5,b.M,v.a,p.b,D.z,z.n,j.Q,Q.V,w.k,N.F,H.R,Gt.W]})}const na=function(){return["gestao","plano-entrega"]},oa=function(o){return{unidade_id:o,status:"ATIVO"}},ia=function(o){return{showFilter:!1,filter:o}},la=function(o,n){return{route:o,params:n}},sa=function(o){return["unidade_id","=",o]},ra=function(){return["status","=","ATIVO"]},da=function(o,n){return[o,n]};class oe extends ne.F{constructor(n){super(n,r,x.r),this.injector=n,this.validate=(t,a)=>{let i=null;return["nome","plano_entrega_id"].indexOf(a)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),i},this.titleEdit=t=>"Editando "+this.lex.translate("Plano de Entregas")+": "+(t?.nome||""),this.unidadeDao=n.get(P.J),this.programaDao=n.get(Te.w),this.planoEntregaDao=n.get(x.r),this.cadeiaValorDao=n.get(I.m),this.planejamentoInstitucionalDao=n.get(Z.U),this.join=[],this.modalWidth=1e3,this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:""},data_fim:{default:""},planejamento_id:{default:null},cadeia_valor_id:{default:null},unidade_id:{default:this.auth.unidade?.id},plano_entrega_id:{default:null},programa_id:{default:null},status:{default:"HOMOLOGANDO"}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();let n=this.metadata?.planoEntrega?this.metadata?.planoEntrega:null;n&&(this.form.controls.plano_entrega_id.setValue(n.id),this.form.controls.nome.setValue(n.nome),this.form.controls.data_inicio.setValue(n.data_inicio),this.form.controls.data_fim.setValue(n.data_fim),this.form.controls.planejamento_id.setValue(n.planejamento_id),this.form.controls.cadeia_valor_id.setValue(n.cadeia_valor_id))}loadData(n,t){var a=this;return(0,u.Z)(function*(){let i=Object.assign({},t.value);t.patchValue(a.util.fillForm(i,n)),a.cdRef.detectChanges()})()}initializeData(n){var t=this;return(0,u.Z)(function*(){t.loadData(t.entity,t.form)})()}saveData(n){var t=this;return(0,u.Z)(function*(){return new Promise((a,i)=>{let l=t.util.fill(new r,t.entity);l=t.util.fillForm(l,t.form.value),a(l)})})()}onPlanoEntregaChange(n){this.form.controls.plano_entrega_id.value&&(this.form.controls.nome.setValue(this.planoEntrega?.selectedEntity.nome),this.form.controls.data_inicio.setValue(this.planoEntrega?.selectedEntity.data_inicio),this.form.controls.data_fim.setValue(this.planoEntrega?.selectedEntity.data_fim),this.form.controls.planejamento_id.setValue(this.planoEntrega?.selectedEntity.planejamento_id),this.form.controls.cadeia_valor_id.setValue(this.planoEntrega?.selectedEntity.cadeia_valor_id),this.form.controls.programa_id.setValue(this.planoEntrega?.selectedEntity.programa_id))}static#e=this.\u0275fac=function(t){return new(t||oe)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:oe,selectors:[["plano-entrega-adesao"]],viewQuery:function(t,a){if(1&t&&(e.Gf(y.Q,5),e.Gf(b.M,7),e.Gf(Q.V,7)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.grid=i.first),e.iGM(i=e.CRH())&&(a.planoEntrega=i.first)}},features:[e.qOj],decls:21,vars:39,consts:[["initialFocus","plano_entrega_id",3,"form","disabled","title","submit","cancel"],[1,"row","mb-4"],["controlName","plano_entrega_id","label","Plano de Entregas da Unidade-pai","required","",3,"size","dao","selectRoute","where","change"],["planoEntrega",""],[1,"row"],["label","Nome deste Plano de Entregas","controlName","nome","required","",3,"size"],["disabled","","controlName","unidade_id",3,"size","label","dao"],["disabled","","label","Status","controlName","status",3,"size"],[1,"row","mt-4"],["title","Dados herdados do Plano de Entregas da Unidade-pai",3,"collapse"],["disabled","","label","Programa de Gest\xe3o","controlName","programa_id",3,"size","dao"],["disabled","","label","Planejamento Institucional","controlName","planejamento_id",3,"size","dao"],["disabled","","controlName","data_inicio","label","In\xedcio",3,"size","labelInfo"],["disabled","","label","Cadeia de Valor","controlName","cadeia_valor_id",3,"size","dao"],["disabled","","controlName","data_fim","label","Fim",3,"size","labelInfo"]],template:function(t,a){1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"div")(2,"div",1)(3,"input-search",2,3),e.NdJ("change",function(l){return a.onPlanoEntregaChange(l)}),e.qZA(),e._UZ(5,"separator"),e.qZA(),e.TgZ(6,"div",4),e._UZ(7,"input-text",5),e.qZA(),e.TgZ(8,"div",4),e._UZ(9,"input-search",6)(10,"input-text",7),e.qZA(),e.TgZ(11,"div",8)(12,"separator",9)(13,"div",4),e._UZ(14,"input-search",10),e.qZA(),e.TgZ(15,"div",4),e._UZ(16,"input-search",11)(17,"input-datetime",12),e.qZA(),e.TgZ(18,"div",4),e._UZ(19,"input-search",13)(20,"input-datetime",14),e.qZA()()()()()),2&t&&(e.Q6J("form",a.form)("disabled",a.formDisabled)("title",a.isModal?"":a.title),e.xp6(3),e.Q6J("size",12)("dao",a.planoEntregaDao)("selectRoute",e.WLB(30,la,e.DdM(25,na),e.VKq(28,ia,e.VKq(26,oa,a.auth.unidade.unidade_pai_id))))("where",e.WLB(36,da,e.VKq(33,sa,a.auth.unidade.unidade_pai_id),e.DdM(35,ra))),e.xp6(4),e.Q6J("size",12),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",9)("label",a.lex.translate("Unidade"))("dao",a.unidadeDao),e.xp6(1),e.Q6J("size",3),e.uIk("maxlength",250),e.xp6(2),e.Q6J("collapse","collapse"),e.xp6(2),e.Q6J("size",12)("dao",a.programaDao),e.xp6(2),e.Q6J("size",9)("dao",a.planejamentoInstitucionalDao),e.xp6(1),e.Q6J("size",3)("labelInfo","In\xedcio "+a.lex.translate("Plano de Entrega")),e.xp6(2),e.Q6J("size",9)("dao",a.cadeiaValorDao),e.xp6(1),e.Q6J("size",3)("labelInfo","Fim "+a.lex.translate("Plano de Entrega")))},dependencies:[y.Q,Q.V,G.m,w.k,Y.N]})}var ca=s(92307),ua=s(74508),Pe=s(66384),Ze=s(74978);const ga=["gridProcessos"],_a=["gridObjetivos"],pa=["entregas"],ma=["planejamento"],ha=["cadeiaValor"],fa=["inputObjetivo"],ba=["inputProcesso"],va=["entrega"],Ea=["unidade"],Aa=["tabs"],Ta=["etiqueta"];function Oa(o,n){if(1&o&&(e.TgZ(0,"div",4),e._UZ(1,"plano-entrega-valor-meta-input",29)(2,"input-number",30),e.TgZ(3,"div",4),e._UZ(4,"plano-entrega-valor-meta-input",31)(5,"input-number",32),e.qZA()()),2&o){const t=e.oxw(),a=e.MAs(31);e.xp6(1),e.Q6J("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.meta),e.xp6(1),e.Q6J("size",6),e.xp6(2),e.Q6J("entrega",null==a?null:a.selectedEntity)("size",6)("control",t.form.controls.realizado)("change",t.onRealizadoChange.bind(t)),e.xp6(1),e.Q6J("size",6)("stepValue",.01)}}function Ca(o,n){1&o&&(e.TgZ(0,"div",4),e._UZ(1,"input-number",30)(2,"input-number",32),e.qZA()),2&o&&(e.xp6(1),e.Q6J("size",6),e.xp6(1),e.Q6J("size",6)("stepValue",.01))}function Ia(o,n){if(1&o&&(e.TgZ(0,"order",42),e._uU(1,"Objetivos"),e.qZA()),2&o){const t=n.header;e.Q6J("header",t)}}function Pa(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=n.row;e.xp6(1),e.Oqu(null==t.objetivo?null:t.objetivo.nome)}}const Za=function(o){return["planejamento_id","==",o]},De=function(o){return[o]},Da=function(){return["gestao","planejamento","objetivoList"]},xa=function(o){return{planejamento_id:o}},xe=function(o){return{filter:o}},Ne=function(o,n){return{route:o,params:n}};function Na(o,n){if(1&o&&e._UZ(0,"input-search",43,44),2&o){const t=e.oxw(2);e.Q6J("size",12)("where",e.VKq(6,De,e.VKq(4,Za,t.planejamentoId)))("dao",t.planejamentoObjetivoDao)("selectRoute",e.WLB(13,Ne,e.DdM(8,Da),e.VKq(11,xe,e.VKq(9,xa,t.planejamentoId))))}}function ya(o,n){if(1&o&&(e.TgZ(0,"tab",33),e._UZ(1,"input-search",34,35),e.TgZ(3,"grid",36,37)(5,"columns")(6,"column",38),e.YNc(7,Ia,2,1,"ng-template",null,39,e.W1O),e.YNc(9,Pa,2,1,"ng-template",null,40,e.W1O),e.YNc(11,Na,2,16,"ng-template",null,41,e.W1O),e.qZA(),e._UZ(13,"column",12),e.qZA()()()),2&o){const t=e.MAs(8),a=e.MAs(10),i=e.MAs(12),l=e.oxw();e.xp6(1),e.Q6J("size",12)("dao",l.planejamentoDao),e.xp6(2),e.Q6J("control",l.form.controls.objetivos)("form",l.formObjetivos)("orderBy",l.orderBy)("hasDelete",!0)("hasEdit",!0)("add",l.addObjetivo.bind(l))("remove",l.removeObjetivo.bind(l))("save",l.saveObjetivo.bind(l)),e.xp6(3),e.Q6J("titleTemplate",t)("template",a)("editTemplate",i)}}function Ua(o,n){if(1&o&&(e.TgZ(0,"order",53),e._uU(1,"Processos"),e.qZA()),2&o){const t=n.header;e.Q6J("header",t)}}function wa(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=n.row;e.xp6(1),e.Oqu(null==t.processo?null:t.processo.nome)}}const La=function(o){return["cadeia_valor_id","==",o]},qa=function(){return["gestao","cadeia-valor","processoList"]},Qa=function(o){return{cadeia_valor_id:o}};function Ra(o,n){if(1&o&&e._UZ(0,"input-search",54,55),2&o){const t=e.oxw(2);e.Q6J("size",12)("where",e.VKq(6,De,e.VKq(4,La,t.cadeiaValorId)))("dao",t.cadeiaValorProcessoDao)("selectRoute",e.WLB(13,Ne,e.DdM(8,qa),e.VKq(11,xe,e.VKq(9,Qa,t.cadeiaValorId))))}}function Ja(o,n){if(1&o&&(e.TgZ(0,"tab",45),e._UZ(1,"input-search",46,47),e.TgZ(3,"grid",36,48)(5,"columns")(6,"column",38),e.YNc(7,Ua,2,1,"ng-template",null,49,e.W1O),e.YNc(9,wa,2,1,"ng-template",null,50,e.W1O),e.YNc(11,Ra,2,16,"ng-template",null,51,e.W1O),e.qZA(),e._UZ(13,"column",52),e.qZA()()()),2&o){const t=e.MAs(8),a=e.MAs(10),i=e.MAs(12),l=e.oxw();e.xp6(1),e.Q6J("size",12)("dao",l.cadeiaValorDao),e.xp6(2),e.Q6J("control",l.form.controls.processos)("form",l.formProcessos)("orderBy",l.orderBy)("hasDelete",!0)("hasEdit",!0)("add",l.addProcesso.bind(l))("remove",l.removeProcesso.bind(l))("save",l.saveProcesso.bind(l)),e.xp6(3),e.Q6J("titleTemplate",t)("template",a)("editTemplate",i),e.xp6(7),e.Q6J("dynamicButtons",l.dynamicButtonsProcessos.bind(l))}}const Ma=function(o){return["plano_entrega.unidade_id","in",o]},Va=function(){return["gestao","plano-entrega","entrega-list"]},Sa=function(o){return{route:o}},za=function(o){return{idsUnidadesAscendentes:o}};class X extends ne.F{constructor(n){super(n,k.O,U.K),this.injector=n,this.itensQualitativo=[],this.idsUnidadesAscendentes=[],this.checklist=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.validate=(t,a)=>{let i=null;return["descricao","destinatario"].indexOf(a)>=0?t.value?.length?this.entrega.selectedEntity&&this.entrega.selectedEntity.descricao==t.value&&(i="\xc9 necess\xe1rio incrementar ou modificar a descri\xe7\xe3o da entrega"):i="Obrigat\xf3rio":["progresso_realizado","realizado"].indexOf(a)>=0&&!(t.value>=0||t.value?.length>0)||["progresso_esperado","meta"].indexOf(a)>=0&&!(t.value>0||t.value?.length>0)?i="Obrigat\xf3rio":["unidade_id"].indexOf(a)>=0&&!t.value?.length?i="A unidade demandante \xe9 obrigat\xf3ria":["entrega_id"].indexOf(a)>=0&&!t.value?.length?i="A entrega \xe9 obrigat\xf3ria":["data_inicio"].indexOf(a)>=0&&!this.dao?.validDateTime(t.value)||["data_fim"].indexOf(a)>=0&&!this.dao?.validDateTime(t.value)?i="Inv\xe1lido":["planejamento_objetivo_id"].indexOf(a)>=0?(t.value?.length||(i="O objetivo do planejamento \xe9 obrigat\xf3rio"),t.value?.length&&this.gridObjetivos?.items.filter(l=>"ADD"==l._status).map(l=>l.planejamento_objetivo_id).includes(this.formObjetivos.controls.planejamento_objetivo_id.value)&&(i="Este objetivo est\xe1 em duplicidade!")):["cadeia_processo_id"].indexOf(a)>=0&&(t.value?.length||(i="O processo da cadeia de valor \xe9 obrigat\xf3rio"),t.value?.length&&this.gridProcessos?.items.map(l=>l.cadeia_processo_id).includes(this.formProcessos.controls.cadeia_processo_id.value)&&(i="Este processo est\xe1 em duplicidade!")),i},this.formValidation=t=>{let a=this.form?.controls.data_inicio.value,i=this.form?.controls.data_fim.value;return this.gridObjetivos?.editing?(this.tabs.active="OBJETIVOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.gridProcessos?.editing?(this.tabs.active="PROCESSOS","Salve ou cancele o registro atual em edi\xe7\xe3o"):this.dao?.validDateTime(a)?this.dao?.validDateTime(i)?a>i?"A data do fim n\xe3o pode ser anterior \xe0 data do in\xedcio!":!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&a<this.planoEntrega.data_inicio?"Data de inicio menor que a data de inicio "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_inicio):!this.auth.hasPermissionTo("MOD_PENT_ENTR_EXTRPL")&&this.planoEntrega&&this.planoEntrega.data_fim&&i>this.planoEntrega.data_fim?"Data de fim maior que a data de fim "+this.lex.translate("do Plano de Entrega")+": "+this.util.getDateFormatted(this.planoEntrega.data_fim):void 0:"Data de fim inv\xe1lida":"Data de in\xedcio inv\xe1lida"},this.planejamentoDao=n.get(Z.U),this.unidadeDao=n.get(P.J),this.entregaDao=n.get(Oe.y),this.planoEntregaDao=n.get(x.r),this.planejamentoInstitucionalDao=n.get(Z.U),this.planoEntregaEntregaDao=n.get(U.K),this.cadeiaValorDao=n.get(I.m),this.cadeiaValorProcessoDao=n.get(Ie.k),this.planejamentoObjetivoDao=n.get(Ce.e),this.planoEntregaService=n.get(_.f),this.modalWidth=700,this.join=["entrega","objetivos.objetivo","processos.processo"],this.form=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},descricao_meta:{default:""},realizado:{default:null},plano_entrega_id:{default:""},entrega_pai_id:{default:null},entrega_id:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},unidade_id:{default:null},destinatario:{default:null},objetivos:{default:[]},processos:{default:[]},listaQualitativo:{default:[]},planejamento_id:{default:null},cadeia_valor_id:{default:null},objetivo_id:{default:null},objetivo:{default:null},checklist:{default:[]},etiquetas:{default:[]},etiqueta:{default:""}},this.cdRef,this.validate),this.formObjetivos=this.fh.FormBuilder({planejamento_objetivo_id:{default:null}},this.cdRef,this.validate),this.formProcessos=this.fh.FormBuilder({cadeia_processo_id:{default:null}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef)}ngOnInit(){super.ngOnInit();this.planoEntrega=this.metadata?.plano_entrega,this.planejamentoId=this.metadata?.planejamento_id,this.cadeiaValorId=this.metadata?.cadeia_valor_id,this.unidadeId=this.metadata?.unidade_id,this.metadata?.data_fim&&(this.dataFim=this.metadata?.data_fim),this.entity=this.metadata?.entrega}loadData(n,t){var a=this;return(0,u.Z)(function*(){let i=Object.assign({},t.value);a.onEntregaChange(t.value);let{meta:l,realizado:c,...g}=n;yield a.entrega?.loadSearch(n.entrega||i.entrega_id,!1),yield a.unidade?.loadSearch(a.unidadeId),yield a.planejamento?.loadSearch(a.planejamentoId),yield a.cadeiaValor?.loadSearch(a.cadeiaValorId);let m=a.unidadeId?.length?yield a.unidadeDao.getById(a.unidadeId):null;a.idsUnidadesAscendentes=m?.path?.split("/").slice(1)||[],m&&a.idsUnidadesAscendentes.push(m.id),t.patchValue(a.util.fillForm(i,g)),t.controls.meta.setValue(a.planoEntregaService.getValor(n.meta)),t.controls.realizado.setValue(a.planoEntregaService.getValor(n.realizado)),t.controls.objetivos.setValue(n.objetivos),t.controls.processos.setValue(n.processos),a.dataFim&&t.controls.data_fim.setValue(a.dataFim),yield a.loadEtiquetas()})()}initializeData(n){var t=this;return(0,u.Z)(function*(){t.entity.unidade_id=t.auth.unidade.id,t.entity.unidade=t.auth.unidade,yield t.loadData(t.entity,n)})()}onSaveEntrega(){var n=this;return(0,u.Z)(function*(){let t,a=!0;if(n.formValidation)try{t=yield n.formValidation(n.form)}catch(i){t=i}if(n.form.valid&&!t){if("edit"==n.action){let i=(yield n.saveData(n.form.value)).modalResult,l=[];i._status="EDIT",n.loading=!0;try{l=yield n.planoEntregaDao.planosImpactadosPorAlteracaoEntrega(i)}finally{n.loading=!1}if(l.length){let c=l.map(g=>n.util.getDateFormatted(g.data_inicio)+" - "+n.util.getDateFormatted(g.data_fim)+" - "+g.unidade?.sigla+": "+g.usuario?.nome+"\n");a=yield n.dialog.confirm("Altera assim mesmo?","Caso prossiga com essa modifica\xe7\xe3o os seguintes planos de trabalho ser\xe3o repactuados automaticamente:\n\n"+c+"\nDeseja prosseguir?")}}a&&(yield n.onSaveData())}else n.form.markAllAsTouched(),t&&n.error(t)})()}saveData(n){return new Promise((t,a)=>{let i=this.util.fill(new k.O,this.entity);this.gridObjetivos?.confirm(),this.gridProcessos?.confirm();let{meta:l,realizado:c,...g}=this.form.value;i=this.util.fillForm(i,g),i.unidade=this.unidade?.selectedEntity,i.entrega=this.entrega?.selectedEntity,i.meta=this.planoEntregaService.getEntregaValor(i.entrega,l),i.realizado=this.planoEntregaService.getEntregaValor(i.entrega,c),t(new ca.R(i))})}onRealizadoChange(n,t){this.calculaRealizado()}calculaRealizado(){const n=this.form?.controls.meta.value,t=this.form?.controls.realizado.value;if(n&&t){let a=isNaN(t)?0:(t/n*100).toFixed(0)||0;this.form?.controls.progresso_realizado.setValue(a)}}dynamicOptionsObjetivos(n){let t=[];return t.push({label:"Excluir",icon:"bi bi-trash",color:"btn-outline-danger",onClick:i=>{this.removeObjetivo(i)}}),t}dynamicButtonsObjetivos(n){return[]}dynamicButtonsProcessos(n){return[]}addObjetivo(){var n=this;return(0,u.Z)(function*(){return{id:n.dao.generateUuid(),_status:"ADD"}})()}removeObjetivo(n){var t=this;return(0,u.Z)(function*(){return(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(n._status="DELETE"),!1})()}saveObjetivo(n,t){var a=this;return(0,u.Z)(function*(){let i=t;if(n.controls.planejamento_objetivo_id.value.length&&a.inputObjetivo.selectedItem)return i.planejamento_objetivo_id=n.controls.planejamento_objetivo_id.value,i.objetivo=a.inputObjetivo.selectedItem.entity,i})()}addProcesso(){var n=this;return(0,u.Z)(function*(){return{id:n.dao.generateUuid(),_status:"ADD"}})()}removeProcesso(n){var t=this;return(0,u.Z)(function*(){return(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?"))&&(n._status="DELETE"),!1})()}saveProcesso(n,t){var a=this;return(0,u.Z)(function*(){let i=t;if(n.controls.cadeia_processo_id.value.length&&a.inputProcesso.selectedItem)return i.cadeia_processo_id=n.controls.cadeia_processo_id.value,i.processo=a.inputProcesso.selectedItem.entity,i})()}onEntregaChange(n){var t=this;return(0,u.Z)(function*(){if(t.entrega&&t.entrega.selectedItem){const a=t.entrega?.selectedEntity;switch(a.tipo_indicador){case"QUALITATIVO":t.itensQualitativo=a.lista_qualitativos||[],t.form?.controls.meta.setValue(t.itensQualitativo.length?t.itensQualitativo[0].key:null),t.form?.controls.realizado.setValue(t.itensQualitativo.length?t.itensQualitativo[0].key:null);break;case"VALOR":case"QUANTIDADE":t.form?.controls.meta.setValue(""),t.form?.controls.realizado.setValue(0);break;case"PORCENTAGEM":t.form?.controls.meta.setValue(100),t.form?.controls.realizado.setValue(0)}yield t.loadEtiquetas(),a.checklist&&t.loadChecklist(),t.calculaRealizado()}})()}loadEtiquetas(){var n=this;return(0,u.Z)(function*(){if(!n.etiquetasAscendentes.filter(t=>t.data==n.unidade?.selectedEntity?.id).length){let t=yield n.carregaEtiquetasUnidadesAscendentes(n.unidade?.selectedEntity);n.etiquetasAscendentes.push(...t)}n.etiquetas=n.util.merge(n.entrega?.selectedEntity?.etiquetas,n.unidade?.selectedEntity?.etiquetas,(t,a)=>t.key==a.key),n.etiquetas=n.util.merge(n.etiquetas,n.auth.usuario.config?.etiquetas,(t,a)=>t.key==a.key),n.etiquetas=n.util.merge(n.etiquetas,n.etiquetasAscendentes.filter(t=>t.data==n.unidade?.selectedEntity?.id),(t,a)=>t.key==a.key)})()}carregaEtiquetasUnidadesAscendentes(n){var t=this;return(0,u.Z)(function*(){let a=[],i=(n=n||t.auth.unidade).path.split("/");return(yield t.unidadeDao.query({where:[["id","in",i]]}).asPromise()).forEach(c=>{a=t.util.merge(a,c.etiquetas,(g,m)=>g.key==m.key)}),a.forEach(c=>c.data=n.id),a})()}loadChecklist(){let t=(this.entrega?.selectedEntity).checklist.map(a=>({id:a.id,texto:a.texto,checked:!1}));this.checklist=t||[],this.form.controls.checklist.setValue(t)}addItemHandleEtiquetas(){let n;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,a=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,a)&&(n={key:a,value:t.value,color:t.color,icon:t.icon},this.form.controls.etiqueta.setValue(""))}return n}static#e=this.\u0275fac=function(t){return new(t||X)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:X,selectors:[["plano-entrega-form-entrega"]],viewQuery:function(t,a){if(1&t&&(e.Gf(y.Q,5),e.Gf(ga,5),e.Gf(_a,5),e.Gf(pa,5),e.Gf(ma,5),e.Gf(ha,5),e.Gf(fa,5),e.Gf(ba,5),e.Gf(va,5),e.Gf(Ea,5),e.Gf(Aa,5),e.Gf(Ta,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.gridProcessos=i.first),e.iGM(i=e.CRH())&&(a.gridObjetivos=i.first),e.iGM(i=e.CRH())&&(a.entregas=i.first),e.iGM(i=e.CRH())&&(a.planejamento=i.first),e.iGM(i=e.CRH())&&(a.cadeiaValor=i.first),e.iGM(i=e.CRH())&&(a.inputObjetivo=i.first),e.iGM(i=e.CRH())&&(a.inputProcesso=i.first),e.iGM(i=e.CRH())&&(a.entrega=i.first),e.iGM(i=e.CRH())&&(a.unidade=i.first),e.iGM(i=e.CRH())&&(a.tabs=i.first),e.iGM(i=e.CRH())&&(a.etiqueta=i.first)}},features:[e.qOj],decls:44,vars:57,consts:[["initialFocus","descricao",3,"form","disabled","title","submit","cancel"],["display","","right","",3,"title"],["tabs",""],["key","ENTREGAS","label","Entregas"],[1,"row"],["collapse","",3,"title","collapsed"],["label","T\xedtulo","controlName","descricao","required","",3,"size","placeholder"],["controlName","descricao_entrega",3,"size","label","placeholder"],["controlName","entrega_pai_id",3,"size","label","dao","where","selectRoute","metadata"],[1,"row","mt-4"],["editable","",3,"control","form","hasAdd","hasDelete"],["type","text","title","Texto","field","texto"],["type","options"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["label","Demandante","controlName","unidade_id","required","",3,"size","dao"],["unidade",""],["label","Destinat\xe1rio","controlName","destinatario","required","",3,"size"],["title","Planejamento"],["controlName","entrega_id","placeholder","Selecione ou cadastre uma meta do cat\xe1logo usando a lupa","required","",3,"size","label","dao","change"],["entrega",""],["label","Descri\xe7\xe3o da meta","controlName","descricao_meta","placeholder","Descreva a meta",3,"size"],["class","row",4,"ngIf","ngIfElse"],["naoSelecionou",""],["label","Etiquetas","controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta",3,"size","control","items"],["etiqueta",""],["key","OBJETIVOS","label","Objetivos",4,"ngIf"],["key","PROCESSOS","label","Processos",4,"ngIf"],["icon","bi bi-graph-up-arrow","label","Meta","labelInfo","Onde quero chegar ao final da entrega. Evolu\xe7\xe3o total da entrega, podendo ultrapassar o per\xedodo do plano de entregas",3,"entrega","size","control"],["label","Parcela da entrega no plano","controlName","progresso_esperado","sufix","%","labelInfo","Quanto vou caminhar nesse plano de entregas. Percentual do total da entrega que ser\xe1 realizado durante a vig\xeancia desse plano",3,"size"],["icon","bi bi-check-lg","label","Progresso ao in\xedcio do plano","labelInfo","De onde estou saindo nesse plano. Valor correspondente ao progresso verificado no planejamento do plano de entregas",3,"entrega","size","control","change"],["label","Progresso j\xe1 realizado","controlName","progresso_realizado","sufix","%","disabled","","labelInfo","Quanto caminhei no plano atual Evolu\xe7\xe3o j\xe1 realizada para a meta. No ato da cria\xe7\xe3o do plano, \xe9 o percentual de progresso ao in\xedcio do plano em rela\xe7\xe3o \xe0 meta",3,"size","stepValue"],["key","OBJETIVOS","label","Objetivos"],["controlName","planejamento_id","disabled","",3,"size","dao"],["planejamento",""],["editable","",3,"control","form","orderBy","hasDelete","hasEdit","add","remove","save"],["gridObjetivos",""],[3,"titleTemplate","template","editTemplate"],["titleObjetivo",""],["columnObjetivo",""],["editObjetivo",""],["by","objetivo.nome",3,"header"],["controlName","planejamento_objetivo_id",3,"size","where","dao","selectRoute"],["inputObjetivo",""],["key","PROCESSOS","label","Processos"],["controlName","cadeia_valor_id","disabled","",3,"size","dao"],["cadeiaValor",""],["gridProcessos",""],["titleProcessos",""],["processo",""],["editProcesso",""],["type","options",3,"dynamicButtons"],["by","processo.nome",3,"header"],["label","","icon","","controlName","cadeia_processo_id","label","",3,"size","where","dao","selectRoute"],["inputProcesso",""]],template:function(t,a){if(1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveEntrega()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"tabs",1,2)(3,"tab",3)(4,"div",4)(5,"separator",5)(6,"div",4),e._UZ(7,"input-text",6),e.qZA(),e.TgZ(8,"div",4),e._UZ(9,"input-textarea",7),e.qZA(),e.TgZ(10,"div",4),e._UZ(11,"input-search",8),e.qZA(),e.TgZ(12,"separator",5)(13,"div",9)(14,"h5"),e._uU(15,"Etapas"),e.qZA(),e.TgZ(16,"grid",10)(17,"columns"),e._UZ(18,"column",11)(19,"column",12),e.qZA()()()()(),e.TgZ(20,"separator",5)(21,"div",4),e._UZ(22,"input-datetime",13)(23,"input-datetime",14),e.qZA(),e.TgZ(24,"div",4),e._UZ(25,"input-search",15,16)(27,"input-text",17),e.qZA()(),e._UZ(28,"separator",18),e.TgZ(29,"div",4)(30,"input-search",19,20),e.NdJ("change",function(l){return a.onEntregaChange(l)}),e.qZA()(),e.TgZ(32,"div",4),e._UZ(33,"input-textarea",21),e.qZA(),e.YNc(34,Oa,6,10,"div",22),e.YNc(35,Ca,3,3,"ng-template",null,23,e.W1O),e.TgZ(37,"separator",5)(38,"div",4)(39,"input-multiselect",24),e._UZ(40,"input-select",25,26),e.qZA()()()()(),e.YNc(42,ya,14,13,"tab",27),e.YNc(43,Ja,14,14,"tab",28),e.qZA()()),2&t){const i=e.MAs(31),l=e.MAs(36);e.Q6J("form",a.form)("disabled",a.formDisabled)("title",a.isModal?"":a.title),e.xp6(1),e.Q6J("title",a.isModal?"":a.title),e.xp6(4),e.Q6J("title","Informa\xe7\xf5es gerais da "+a.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",12)("placeholder","T\xedtulo da "+a.lex.translate("entrega")),e.uIk("maxlength",250),e.xp6(2),e.Q6J("size",12)("label","Descri\xe7\xe3o da "+a.lex.translate("entrega"))("placeholder","Descreva a "+a.lex.translate("entrega")),e.xp6(2),e.Q6J("size",12)("label","V\xednculo com "+a.lex.translate("entrega")+" de "+a.lex.translate("plano de entrega")+" superior")("dao",a.planoEntregaEntregaDao)("where",e.VKq(50,Ma,a.idsUnidadesAscendentes))("selectRoute",e.VKq(53,Sa,e.DdM(52,Va)))("metadata",e.VKq(55,za,a.idsUnidadesAscendentes)),e.xp6(1),e.Q6J("title","Etapas da "+a.lex.translate("entrega"))("collapsed",!0),e.xp6(4),e.Q6J("control",a.form.controls.checklist)("form",a.formChecklist)("hasAdd",!0)("hasDelete",!0),e.xp6(4),e.Q6J("title","Especifica\xe7\xf5es da "+a.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",6)("labelInfo","In\xedcio "+a.lex.translate("Plano de Entregas")),e.xp6(1),e.Q6J("size",6)("labelInfo","Fim "+a.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.xp6(2),e.Q6J("size",6)("dao",a.unidadeDao),e.xp6(2),e.Q6J("size",6),e.uIk("maxlength",250),e.xp6(3),e.Q6J("size",12)("label",a.lex.translate("Tipo de Meta"))("dao",a.entregaDao),e.xp6(3),e.Q6J("size",12),e.xp6(1),e.Q6J("ngIf",null==i?null:i.selectedEntity)("ngIfElse",l),e.xp6(3),e.Q6J("title","Caracteriza\xe7\xe3o da "+a.lex.translate("entrega"))("collapsed",!1),e.xp6(2),e.Q6J("size",12)("control",a.form.controls.etiquetas)("addItemHandle",a.addItemHandleEtiquetas.bind(a)),e.xp6(1),e.Q6J("size",12)("control",a.form.controls.etiqueta)("items",a.etiquetas),e.xp6(2),e.Q6J("ngIf",null==a.planejamentoId?null:a.planejamentoId.length),e.xp6(1),e.Q6J("ngIf",null==a.cadeiaValorId?null:a.cadeiaValorId.length)}},dependencies:[T.O5,b.M,v.a,p.b,y.Q,Q.V,G.m,ua.Q,w.k,F.p,Ee.p,Pe.n,Ze.i,Y.N,me.l,te.l,M]})}var ye=s(38958),ja=s(60039);const Ga=["selectResponsaveis"];function Fa(o,n){1&o&&(e.TgZ(0,"strong"),e._uU(1,"Respons\xe1vel"),e.qZA())}function ka(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=n.row;e.xp6(1),e.hij(" ",t.responsavel," ")}}function Ba(o,n){1&o&&(e.TgZ(0,"strong"),e._uU(1,"Criado em"),e.qZA())}function Ya(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.Oqu(a.util.getDateTimeFormatted(t.date_time))}}function Ha(o,n){1&o&&(e.TgZ(0,"div",2)(1,"div",17)(2,"strong"),e._uU(3,"Atributos"),e.qZA()(),e.TgZ(4,"div",18)(5,"strong"),e._uU(6,"Valores"),e._UZ(7,"br"),e._uU(8,"Atuais"),e.qZA()(),e.TgZ(9,"div",18)(10,"strong"),e._uU(11,"Valores"),e._UZ(12,"br"),e._uU(13,"Anteriores"),e.qZA()()())}function Wa(o,n){if(1&o&&(e.TgZ(0,"tr")(1,"td",21),e._uU(2),e.qZA(),e.TgZ(3,"td",22),e._uU(4),e.qZA(),e.TgZ(5,"td",22),e._uU(6),e.qZA()()),2&o){const t=n.$implicit,a=e.oxw(2);e.xp6(2),e.Oqu(t[0]),e.xp6(2),e.Oqu("EDIT"==a.action||"ADD"==a.action?t[1]:""),e.xp6(2),e.Oqu("EDIT"==a.action?t[2]:"ADD"==a.action?"":t[1])}}function Ka(o,n){if(1&o&&(e.TgZ(0,"separator",19)(1,"table")(2,"tbody"),e.YNc(3,Wa,7,3,"tr",20),e.qZA()()()),2&o){const t=n.row,a=e.oxw();e.Q6J("collapse","collapse")("collapsed",!0),e.xp6(3),e.Q6J("ngForOf",a.preparaDelta(t))}}class ie extends d.E{constructor(n,t){super(n,ja.R,ye.D),this.injector=n,this.responsaveis=[],this.planoId="",this.action="",this.filterWhere=a=>{let i=[],l=a.value;return i.push(["table_name","==","planos_entregas"]),i.push(["row_id","==",this.planoId]),l.responsavel_id?.length&&i.push(["user_id","==","null"==l.responsavel_id?null:l.responsavel_id]),l.data_inicio&&i.push(["date_time",">=",l.data_inicio]),l.data_fim&&i.push(["date_time","<=",l.data_fim]),l.tipo?.length&&i.push(["type","==",l.tipo]),i},this.planoEntregaDao=n.get(x.r),this.title="Logs de Planos de Entregas",this.filter=this.fh.FormBuilder({responsavel_id:{default:""},data_inicio:{default:""},data_fim:{default:""},tipo:{default:""}}),this.orderBy=[["id","desc"]]}ngOnInit(){super.ngOnInit(),this.planoId=this.urlParams?.get("id")||"",this.planoEntregaDao.getById(this.planoId).then(n=>this.planoEntrega=n)}ngAfterViewInit(){super.ngAfterViewInit()}filterClear(n){n.controls.responsavel_id.setValue(""),n.controls.data_inicio.setValue(""),n.controls.data_fim.setValue(""),n.controls.tipo.setValue(""),super.filterClear(n)}preparaDelta(n){this.action=n.type;let t=n.delta instanceof Array?n.delta:Object.entries(n.delta);return t.forEach(a=>{a[1]instanceof Date&&(a[1]=new Date(a[1]).toUTCString()),a.length>2&&a[2]instanceof Date&&(a[2]=new Date(a[2]).toUTCString())}),t}static#e=this.\u0275fac=function(t){return new(t||ie)(e.Y36(e.zs3),e.Y36(ye.D))};static#t=this.\u0275cmp=e.Xpm({type:ie,selectors:[["plano-entrega-list-logs"]],viewQuery:function(t,a){if(1&t&&(e.Gf(b.M,5),e.Gf(Ga,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.grid=i.first),e.iGM(i=e.CRH())&&(a.selectResponsaveis=i.first)}},features:[e.qOj],decls:31,vars:30,consts:[[3,"dao","hasEdit","title","orderBy","groupBy","join"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xe1vel pelo registro","controlName","responsavel_id",3,"control","items"],["selectResponsaveis",""],["datetime","","label","In\xedcio","controlName","data_inicio","labelInfo","In\xedcio dos registros",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim dos registros",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","tipo","itemTodos","Todos","valueTodos","",3,"size","control","items"],[3,"titleTemplate","template"],["titleResponsavel",""],["columnResponsavel",""],["titleDataCriacao",""],["columnDataCriacao",""],["titleDiferenca",""],["columnDiferenca",""],["title","Tipo de Opera\xe7\xe3o","field","type"],[3,"rows"],["width","150",1,"col","align-bottom"],["width","250",1,"col"],["title","(ver detalhes)",3,"collapse","collapsed"],[4,"ngFor","ngForOf"],["width","150"],["width","250"]],template:function(t,a){if(1&t&&(e.TgZ(0,"grid",0)(1,"span")(2,"strong"),e._uU(3),e.qZA()(),e._UZ(4,"toolbar"),e.TgZ(5,"filter",1)(6,"div",2),e._UZ(7,"input-select",3,4),e.qZA(),e.TgZ(9,"div",2),e._UZ(10,"input-datetime",5)(11,"input-datetime",6)(12,"input-select",7),e.qZA()(),e.TgZ(13,"columns")(14,"column",8),e.YNc(15,Fa,2,0,"ng-template",null,9,e.W1O),e.YNc(17,ka,2,1,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(19,"column",8),e.YNc(20,Ba,2,0,"ng-template",null,11,e.W1O),e.YNc(22,Ya,2,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(24,"column",8),e.YNc(25,Ha,14,0,"ng-template",null,13,e.W1O),e.YNc(27,Ka,4,3,"ng-template",null,14,e.W1O),e.qZA(),e._UZ(29,"column",15),e.qZA(),e._UZ(30,"pagination",16),e.qZA()),2&t){const i=e.MAs(16),l=e.MAs(18),c=e.MAs(21),g=e.MAs(23),m=e.MAs(26),f=e.MAs(28);e.Q6J("dao",a.dao)("hasEdit",!1)("title",a.isModal?"":a.title)("orderBy",a.orderBy)("groupBy",a.groupBy)("join",a.join),e.xp6(3),e.Oqu((null==a.planoEntrega?null:a.planoEntrega.numero)+" - "+(null==a.planoEntrega?null:a.planoEntrega.nome)),e.xp6(2),e.Q6J("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("clear",a.filterClear.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",!a.selectable&&a.filterCollapsed),e.xp6(2),e.Q6J("control",a.filter.controls.responsavel_id)("items",a.responsaveis),e.xp6(3),e.Q6J("size",4)("control",a.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",a.filter.controls.data_fim),e.xp6(1),e.Q6J("size",4)("control",a.filter.controls.tipo)("items",a.lookup.TIPO_LOG_CHANGE),e.xp6(2),e.Q6J("titleTemplate",i)("template",l),e.xp6(5),e.Q6J("titleTemplate",c)("template",g),e.xp6(5),e.Q6J("titleTemplate",m)("template",f),e.xp6(6),e.Q6J("rows",a.rowsLimit)}},dependencies:[T.sg,b.M,v.a,p.b,D.z,z.n,j.Q,w.k,F.p,Y.N]})}function Xa(o,n){if(1&o&&(e.TgZ(0,"h3",18),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.title)}}function $a(o,n){if(1&o&&e._UZ(0,"toolbar",19),2&o){const t=e.oxw();e.Q6J("buttons",t.buttons)}}function en(o,n){if(1&o&&e._UZ(0,"badge",20)(1,"br")(2,"badge",21)(3,"br")(4,"badge",22),2&o){const t=n.row,a=e.oxw();e.Q6J("label",t.descricao||"(n\xe3o informado)"),e.xp6(2),e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",t.unidade.sigla||"(n\xe3o informado)"),e.xp6(2),e.Q6J("label",t.destinatario||"(n\xe3o informado)")}}function tn(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.Oqu(a.dao.getDateFormatted(t.data_inicio)),e.xp6(2),e.Oqu(a.dao.getDateFormatted(t.data_fim))}}function an(o,n){if(1&o&&(e.TgZ(0,"span",24),e._UZ(1,"i",25),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",t.entrega.nome||t.entrega_pai.descricao," ")}}function nn(o,n){if(1&o&&e.YNc(0,an,3,1,"span",23),2&o){const t=n.row;e.Q6J("ngIf",t.entrega)}}function on(o,n){if(1&o&&e._UZ(0,"badge",26)(1,"br")(2,"badge",26),2&o){const t=n.row,a=e.oxw();e.Q6J("label",a.planoEntregaService.getValorMeta(t)),e.xp6(2),e.Q6J("label",a.planoEntregaService.getValorRealizado(t))}}function ln(o,n){if(1&o&&e._UZ(0,"progress-bar",27),2&o){const t=n.row;e.Q6J("value",t.progresso_realizado)}}class le extends d.E{constructor(n){super(n,k.O,U.K),this.injector=n,this.buttons=[],this.idsUnidadesAscendentes=[],this.filterWhere=t=>{let a=t.value,i=[];return this.idsUnidadesAscendentes.length&&i.push(["plano_entrega.unidade_id","in",this.idsUnidadesAscendentes]),a.unidade_id?.length&&i.push(["unidade_id","==",a.unidade_id]),a.descricao?.length&&i.push(["descricao","like","%"+a.descricao.trim().replace(" ","%")+"%"]),a.descricao?.length&&i.push(["descricao_entrega","like","%"+a.descricao_entrega.trim().replace(" ","%")+"%"]),a.destinatario?.length&&i.push(["destinatario","like","%"+a.destinatario.trim().replace(" ","%")+"%"]),i},this.planoEntregaDao=n.get(U.K),this.unidadeDao=n.get(P.J),this.planoEntregaService=n.get(_.f),this.title=this.lex.translate("Entregas"),this.filter=this.fh.FormBuilder({descricao:{default:""},descricao_entrega:{default:""},unidade_id:{default:""},destinatario:{default:""}}),this.join=["entrega:id,nome","entrega_pai:id,descricao","unidade:id,sigla"]}ngOnInit(){super.ngOnInit(),this.idsUnidadesAscendentes=this.metadata?.idsUnidadesAscendentes||this.idsUnidadesAscendentes,this.filter?.controls.unidade_id.setValue(this.idsUnidadesAscendentes[0])}dynamicOptions(n){let t=[];return t.push({label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:a=>this.go.navigate({route:["gestao","planejamento","objetivo",a.id,"consult"]},{modal:!0})}),t}filterClear(n){super.filterClear(n)}static#e=this.\u0275fac=function(t){return new(t||le)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:le,selectors:[["app-plano-entrega-list-entrega-list"]],viewQuery:function(t,a){if(1&t&&e.Gf(b.M,5),2&t){let i;e.iGM(i=e.CRH())&&(a.grid=i.first)}},features:[e.qOj],decls:26,vars:32,consts:[["class","my-2",4,"ngIf"],[3,"dao","orderBy","groupBy","join","selectable","select"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Unidade","controlName","unidade_id",3,"size","control","dao"],["label","T\xedtulo da entrega","controlName","descricao","placeholder","T\xedtulo",3,"size","control"],["label","Descri\xe7\xe3o da entrega","controlName","descricao_entrega","placeholder","Descri\xe7\xe3o",3,"size","control"],[3,"title","template"],["columnEntregaCliente",""],["columnDatas",""],["title","Entrega",3,"template"],["columnIndicador",""],["columnMetaRealizado",""],["title","Progresso",3,"template"],["columnProgresso",""],["type","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],["icon","bi bi-textarea-t","color","light",3,"label"],["color","success",3,"icon","label"],["icon","bi bi-mailbox","color","light",3,"label"],["class","badge bg-light text-dark",4,"ngIf"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-list-check"],["color","light",3,"label"],["color","success",3,"value"]],template:function(t,a){if(1&t&&(e.YNc(0,Xa,2,1,"h3",0),e.TgZ(1,"grid",1),e.NdJ("select",function(l){return a.onSelect(l)}),e.YNc(2,$a,1,1,"toolbar",2),e.TgZ(3,"filter",3)(4,"div",4),e._UZ(5,"input-search",5)(6,"input-text",6)(7,"input-text",7),e.qZA()(),e.TgZ(8,"columns")(9,"column",8),e.YNc(10,en,5,4,"ng-template",null,9,e.W1O),e.qZA(),e.TgZ(12,"column",8),e.YNc(13,tn,4,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(15,"column",11),e.YNc(16,nn,1,1,"ng-template",null,12,e.W1O),e.qZA(),e.TgZ(18,"column",8),e.YNc(19,on,3,2,"ng-template",null,13,e.W1O),e.qZA(),e.TgZ(21,"column",14),e.YNc(22,ln,1,1,"ng-template",null,15,e.W1O),e.qZA(),e._UZ(24,"column",16),e.qZA(),e._UZ(25,"pagination",17),e.qZA()),2&t){const i=e.MAs(11),l=e.MAs(14),c=e.MAs(17),g=e.MAs(20),m=e.MAs(23);e.Q6J("ngIf",!a.isModal),e.xp6(1),e.Q6J("dao",a.dao)("orderBy",a.orderBy)("groupBy",a.groupBy)("join",a.join)("selectable",a.selectable),e.xp6(1),e.Q6J("ngIf",!a.selectable),e.xp6(1),e.Q6J("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("clear",a.filterClear.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",!a.selectable&&a.filterCollapsed),e.xp6(2),e.Q6J("size",4)("control",a.filter.controls.unidade_id)("dao",a.unidadeDao),e.xp6(1),e.Q6J("size",4)("control",a.filter.controls.descricao),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",4)("control",a.filter.controls.descricao_entrega),e.uIk("maxlength",250),e.xp6(2),e.Q6J("title","Entrega\nDemandante\nDestinat\xe1rio")("template",i),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",l),e.xp6(3),e.Q6J("template",c),e.xp6(3),e.Q6J("title","Meta\nRealizado")("template",g),e.xp6(3),e.Q6J("template",m),e.xp6(4),e.Q6J("rows",a.rowsLimit)}},dependencies:[T.O5,b.M,v.a,p.b,D.z,z.n,j.Q,Q.V,G.m,N.F,H.R]})}var sn=s(90038),rn=s(56976);class S extends rn.B{constructor(n){super("PlanoEntregaEntregaProgresso",n),this.injector=n,this.inputSearchConfig.searchFields=["data_progresso"]}static#e=this.\u0275fac=function(t){return new(t||S)(e.LFG(e.zs3))};static#t=this.\u0275prov=e.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"})}class se extends be.X{constructor(n){super(),this.data_inicio=new Date,this.data_fim=null,this.data_progresso=null,this.homologado=!1,this.meta={},this.realizado={},this.progresso_esperado=100,this.progresso_realizado=0,this.plano_entrega_entrega_id="",this.usuario_id="",this.initialization(n)}}function dn(o,n){1&o&&e._UZ(0,"toolbar")}function cn(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_progresso),"")}}function un(o,n){if(1&o&&e.YNc(0,cn,2,1,"span",1),2&o){const t=n.row;e.Q6J("ngIf",t.data_progresso)}}function gn(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_inicio),"")}}function _n(o,n){if(1&o&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&o){const t=e.oxw().row,a=e.oxw();e.xp6(1),e.hij(" ",a.dao.getDateFormatted(t.data_fim),"")}}function pn(o,n){if(1&o&&(e.YNc(0,gn,2,1,"span",1),e._UZ(1,"br"),e.YNc(2,_n,2,1,"span",1)),2&o){const t=n.row;e.Q6J("ngIf",t.data_inicio),e.xp6(2),e.Q6J("ngIf",t.data_fim)}}function mn(o,n){if(1&o&&e._UZ(0,"badge",15)(1,"br")(2,"badge",16),2&o){const t=n.row,a=e.oxw();e.Q6J("textValue",a.planoEntregaService.getValorMeta(t.plano_entrega_entrega)),e.xp6(2),e.Q6J("textValue",a.planoEntregaService.getValorRealizado(t.plano_entrega_entrega))}}function hn(o,n){if(1&o&&e._UZ(0,"progress-bar",17),2&o){const t=n.row;e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}class re extends d.E{constructor(n){super(n,se,S),this.injector=n,this.planoEntregaEntregaId="",this.filterWhere=t=>{let a=[],i=t.value;return i.data_inicial_progresso&&a.push(["data_progresso",">=",i.data_inicial_progresso]),i.data_final_progresso&&a.push(["data_progresso","<=",i.data_final_progresso]),a.push(["plano_entrega_entrega_id","==",this.planoEntregaEntregaId]),a},this.planoEntregaService=n.get(_.f),this.title=this.lex.translate("Hist\xf3rico de execu\xe7\xe3o"),this.orderBy=[["data_progresso","desc"]],this.join=["plano_entrega_entrega.entrega"],this.filter=this.fh.FormBuilder({data_inicial_progresso:{default:null},data_final_progresso:{default:null}}),this.addOption(Object.assign({onClick:this.delete.bind(this)},this.OPTION_EXCLUIR),"MOD_PENT_ENTR_PRO_EXCL")}onGridLoad(n){n?.forEach(t=>t.entrega=t.plano_entrega_entrega?.entrega)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")||""}static#e=this.\u0275fac=function(t){return new(t||re)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:re,selectors:[["app-plano-entrega-list-progresso"]],viewQuery:function(t,a){if(1&t&&e.Gf(b.M,5),2&t){let i;e.iGM(i=e.CRH())&&(a.grid=i.first)}},features:[e.qOj],decls:21,vars:38,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","loadList","select"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["noIcon","","label","Data inical do progresso","controlName","data_inicial_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],["noIcon","","label","Data final do progresso","controlName","data_final_progresso","labelInfo","Data que foi registrado o progresso",3,"size","control"],[3,"title","template","editTemplate"],["columnProgressoData",""],["columnDatas",""],[3,"title","width","template"],["columnMetaRealizado",""],[3,"title","width","template","editTemplate","columnEditTemplate"],["columnProgresso",""],["type","options",3,"onEdit","options"],[3,"rows"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],["color","success",3,"value","goal"]],template:function(t,a){if(1&t&&(e.TgZ(0,"grid",0),e.NdJ("select",function(l){return a.onSelect(l)}),e.YNc(1,dn,1,0,"toolbar",1),e.TgZ(2,"filter",2)(3,"div",3),e._UZ(4,"input-datetime",4)(5,"input-datetime",5),e.qZA()(),e.TgZ(6,"columns")(7,"column",6),e.YNc(8,un,1,1,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(10,"column",6),e.YNc(11,pn,3,2,"ng-template",null,8,e.W1O),e.qZA(),e.TgZ(13,"column",9),e.YNc(14,mn,3,2,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(16,"column",11),e.YNc(17,hn,1,2,"ng-template",null,12,e.W1O),e.qZA(),e._UZ(19,"column",13),e.qZA(),e._UZ(20,"pagination",14),e.qZA()),2&t){const i=e.MAs(9),l=e.MAs(12),c=e.MAs(15),g=e.MAs(18);e.Q6J("dao",a.dao)("add",a.add)("title",a.isModal?"":a.title)("orderBy",a.orderBy)("groupBy",a.groupBy)("join",a.join)("selectable",a.selectable)("hasAdd",a.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_INCL"))("hasEdit",a.auth.hasPermissionTo("MOD_PENT_ENTR_PRO_EDT"))("loadList",a.onGridLoad.bind(a)),e.xp6(1),e.Q6J("ngIf",!a.selectable),e.xp6(1),e.Q6J("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",!a.selectable&&a.filterCollapsed),e.xp6(2),e.Q6J("size",3)("control",a.filter.controls.data_inicial_progresso),e.xp6(1),e.Q6J("size",3)("control",a.filter.controls.data_final_progresso),e.xp6(2),e.Q6J("title","Data progresso")("template",i)("editTemplate",i),e.xp6(3),e.Q6J("title","Data In\xedcio\nData Fim")("template",l)("editTemplate",l),e.xp6(3),e.Q6J("title","Meta")("width",100)("template",c),e.xp6(3),e.Q6J("title","Progresso")("width",200)("template",g)("editTemplate",g)("columnEditTemplate",a.selectable?void 0:g),e.xp6(3),e.Q6J("onEdit",a.edit)("options",a.options),e.xp6(1),e.Q6J("rows",a.rowsLimit)}},dependencies:[T.O5,b.M,v.a,p.b,D.z,z.n,j.Q,w.k,N.F,H.R]})}class $ extends ne.F{constructor(n){super(n,se,S),this.injector=n,this.validate=(t,a)=>{let i=null;return["progresso_realizado","realizado"].indexOf(a)>=0&&!(t.value>=0||t.value?.length>0)||["progresso_esperado","meta"].indexOf(a)>=0&&!(t.value>0||t.value?.length>0)?i="Obrigat\xf3rio":(["data_inicio"].indexOf(a)>=0&&!this.dao?.validDateTime(t.value)||["data_fim"].indexOf(a)>=0&&!this.dao?.validDateTime(t.value))&&(i="Inv\xe1lido"),i},this.titleEdit=t=>"Editando "+this.lex.translate("Progresso da entrega")+": "+(t?.entrega?.descricao||""),this.planoEntregaService=n.get(_.f),this.planoEntregaEntregaDao=n.get(U.K),this.join=["plano_entrega_entrega.entrega"],this.form=this.fh.FormBuilder({data_progresso:{default:new Date},data_inicio:{default:new Date},data_fim:{default:new Date},meta:{default:100},realizado:{default:null},progresso_esperado:{default:100},progresso_realizado:{default:null},usuario_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.planoEntregaEntregaId=this.urlParams.get("entrega_id")}loadData(n,t){var a=this;return(0,u.Z)(function*(){let i=Object.assign({},t.value),{meta:l,realizado:c,...g}=n;t.patchValue(a.util.fillForm(i,g)),t.controls.meta.setValue(a.planoEntregaService.getValor(n.meta)),t.controls.realizado.setValue(a.planoEntregaService.getValor(n.realizado))})()}initializeData(n){var t=this;return(0,u.Z)(function*(){t.entity=new se,t.planoEntregaEntrega=t.planoEntregaEntregaId?yield t.planoEntregaEntregaDao.getById(t.planoEntregaEntregaId,["entrega"]):void 0,t.entity.usuario_id=t.auth.usuario.id,t.entity.plano_entrega_entrega_id=t.planoEntregaEntrega?.id,t.entity.plano_entrega_entrega=t.planoEntregaEntrega,t.entity.meta=t.planoEntregaEntrega?.meta,t.entity.realizado=t.planoEntregaEntrega?.realizado,t.entity.progresso_esperado=t.planoEntregaEntrega?.progresso_esperado,t.entity.progresso_realizado=t.planoEntregaEntrega?.progresso_realizado,t.entity.data_inicio=t.planoEntregaEntrega?.data_inicio,t.entity.data_fim=t.planoEntregaEntrega?.data_fim,yield t.loadData(t.entity,n)})()}saveData(n){return new Promise((t,a)=>{let i=this.util.fill(new se,this.entity),{meta:l,realizado:c,...g}=this.form.value;i=this.util.fillForm(i,g),i.meta=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,l),i.realizado=this.planoEntregaService.getEntregaValor(this.entity.plano_entrega_entrega?.entrega,c),t(i)})}static#e=this.\u0275fac=function(t){return new(t||$)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:$,selectors:[["plano-entrega-form-progresso"]],viewQuery:function(t,a){if(1&t&&e.Gf(y.Q,5),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first)}},features:[e.qOj],decls:11,vars:16,consts:[["initialFocus","data_progresso",3,"form","disabled","title","submit","cancel"],[1,"row"],["date","","label","Data do progresso","controlName","data_progresso","required","",3,"size"],["date","","label","In\xedcio","controlName","data_inicio","required","",3,"size","labelInfo"],["date","","label","Fim","controlName","data_fim","required","",3,"size","labelInfo"],["icon","bi bi-graph-up-arrow","label","Meta",3,"entrega","size","control"],["icon","bi bi-check-lg","label","Valor Inicial","labelInfo","Valor da meta verificado no in\xedcio do plano de entrega",3,"entrega","size","control"],["label","Progresso Esperado","controlName","progresso_esperado","sufix","%",3,"size"],["label","Progresso Realizado","controlName","progresso_realizado","sufix","%",3,"size"]],template:function(t,a){1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2)(3,"input-datetime",3)(4,"input-datetime",4),e.qZA(),e.TgZ(5,"div",1),e._UZ(6,"plano-entrega-valor-meta-input",5)(7,"plano-entrega-valor-meta-input",6),e.qZA(),e.TgZ(8,"div",1),e._UZ(9,"input-number",7)(10,"input-number",8),e.qZA()()),2&t&&(e.Q6J("form",a.form)("disabled",a.formDisabled)("title",a.isModal?"":a.title),e.xp6(2),e.Q6J("size",4),e.xp6(1),e.Q6J("size",4)("labelInfo","In\xedcio "+a.lex.translate("Plano de Entregas")),e.xp6(1),e.Q6J("size",4)("labelInfo","Fim "+a.lex.translate("Plano de Entregas")+"(Estimativa Inicial)"),e.xp6(2),e.Q6J("entrega",null==a.entity||null==a.entity.plano_entrega_entrega?null:a.entity.plano_entrega_entrega.entrega)("size",6)("control",a.form.controls.meta),e.xp6(1),e.Q6J("entrega",null==a.entity||null==a.entity.plano_entrega_entrega?null:a.entity.plano_entrega_entrega.entrega)("size",6)("control",a.form.controls.realizado),e.xp6(2),e.Q6J("size",6),e.xp6(1),e.Q6J("size",6))},dependencies:[y.Q,w.k,te.l,M]})}var fn=s(87744),bn=s(59173),vn=s(80684),En=s(84971);const An=["listaAtividades"];function Tn(o,n){1&o&&(e.TgZ(0,"b"),e._uU(1,"Descri\xe7\xe3o"),e.qZA())}function On(o,n){if(1&o&&(e.TgZ(0,"span",8),e._uU(1),e.qZA(),e._UZ(2,"reaction",9)),2&o){const t=n.row;e.xp6(1),e.Oqu(t.descricao),e.xp6(1),e.Q6J("entity",t)}}function Cn(o,n){if(1&o&&(e._uU(0," Un./"),e.TgZ(1,"order",10),e._uU(2,"Respons\xe1vel"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",11),e._uU(5,"Demandante"),e.qZA()),2&o){const t=n.header;e.xp6(1),e.Q6J("header",t),e.xp6(3),e.Q6J("header",t)}}function In(o,n){if(1&o&&(e.TgZ(0,"div",12),e._UZ(1,"badge",13)(2,"badge",14),e.qZA(),e._UZ(3,"badge",15)),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.Q6J("label",t.unidade.sigla),e.xp6(1),e.Q6J("icon","bi "+(null!=t.usuario&&null!=t.usuario.nome&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",a.util.apelidoOuNome(t.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==t.usuario?null:t.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.xp6(1),e.Q6J("label",a.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==t.demandante?null:t.demandante.nome)||"Desconhecido"))}}function Pn(o,n){if(1&o&&e._UZ(0,"progress-bar",16),2&o){const t=n.row;e.Q6J("value",t.progresso)}}class de extends B.D{set entregaId(n){this._entregaId!=n&&(this._entregaId=n)}get entregaId(){return this._entregaId}constructor(n){super(n),this.injector=n,this.items=[],this.loader=!1,this.AtividadeDao=n.get(En.P),this.join=["unidade","usuario","demandante","reacoes.usuario:id,nome,apelido"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.AtividadeDao.query({where:[["plano_trabalho_entrega_id","==",this._entregaId],["unidades_subordinadas","==",!0]],join:this.join}).asPromise().then(n=>{this.items=n}).finally(()=>{this.loader=!1})}static#e=this.\u0275fac=function(t){return new(t||de)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:de,selectors:[["plano-trabalho-entrega-atividades"]],viewQuery:function(t,a){if(1&t&&e.Gf(An,5),2&t){let i;e.iGM(i=e.CRH())&&(a.listaAtividades=i.first)}},inputs:{entregaId:"entregaId"},features:[e.qOj],decls:17,vars:10,consts:[[3,"items","loading"],[3,"titleTemplate","template"],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],[3,"title","width","template"],["columnProgressoEtiquetasChecklist",""],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["color","success",3,"value"]],template:function(t,a){if(1&t&&(e.TgZ(0,"h5"),e._uU(1),e.qZA(),e.TgZ(2,"grid",0)(3,"columns")(4,"column",1),e.YNc(5,Tn,2,0,"ng-template",null,2,e.W1O),e.YNc(7,On,3,2,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(9,"column",1),e.YNc(10,Cn,6,2,"ng-template",null,4,e.W1O),e.YNc(12,In,4,6,"ng-template",null,5,e.W1O),e.qZA(),e.TgZ(14,"column",6),e.YNc(15,Pn,1,1,"ng-template",null,7,e.W1O),e.qZA()()()),2&t){const i=e.MAs(6),l=e.MAs(8),c=e.MAs(11),g=e.MAs(13),m=e.MAs(16);e.xp6(1),e.hij("",a.lex.translate("Atividades"),":"),e.xp6(1),e.Q6J("items",a.items)("loading",a.loader),e.xp6(2),e.Q6J("titleTemplate",i)("template",l),e.xp6(5),e.Q6J("titleTemplate",c)("template",g),e.xp6(5),e.Q6J("title","Progresso")("width",200)("template",m)}},dependencies:[b.M,v.a,p.b,me.l,N.F,H.R,Ae.C]})}const Zn=["accordionUser"];function Dn(o,n){}function xn(o,n){if(1&o&&e._UZ(0,"plano-trabalho-entrega-atividades",29),2&o){const t=n.row;e.Q6J("entregaId",t.id)}}function Nn(o,n){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Plano de trabalho"),e.qZA()()())}function yn(o,n){if(1&o&&(e.TgZ(0,"span",31),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.xp6(1),e.hij("",a.PlanoTrabalhoDao.getDateFormatted(t.data_inicio)," "),e.xp6(2),e.Oqu(" at\xe9 "+a.PlanoTrabalhoDao.getDateFormatted(t.data_fim))}}function Un(o,n){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Origem"),e.qZA()()())}function wn(o,n){if(1&o&&e._UZ(0,"badge",37),2&o){const t=e.oxw().row,a=e.oxw(3);e.Q6J("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"Desconhecido")("icon",a.entityService.getIcon("Unidade"))}}function Ln(o,n){if(1&o&&e._UZ(0,"badge",38),2&o){const t=e.oxw().row;e.Q6J("label",t.orgao)}}function qn(o,n){if(1&o&&(e.TgZ(0,"div",32)(1,"div",33),e._UZ(2,"badge",34),e.YNc(3,wn,1,2,"badge",35),e.YNc(4,Ln,1,1,"badge",36),e.qZA()()),2&o){const t=n.row,a=e.oxw(3);e.xp6(2),e.Q6J("label",a.planoTrabalhoService.tipoEntrega(t,a.entity).titulo)("color",a.planoTrabalhoService.tipoEntrega(t,a.entity).cor),e.xp6(1),e.Q6J("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),e.xp6(1),e.Q6J("ngIf",null==t.orgao?null:t.orgao.length)}}function Qn(o,n){if(1&o&&(e.TgZ(0,"div",30)(1,"small"),e._UZ(2,"badge",39),e.qZA()()),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.xp6(2),e.Q6J("color",100==a.totalForcaTrabalho(t.entregas)?"success":"warning")("label",a.totalForcaTrabalho(t.entregas)+"%")}}function Rn(o,n){if(1&o&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&o){const t=n.row;e.xp6(1),e.Oqu(t.forca_trabalho+"%")}}function Jn(o,n){1&o&&(e.TgZ(0,"div",30)(1,"span")(2,"strong"),e._uU(3,"Detalhamento/Descri\xe7\xe3o dos Trabalhos"),e.qZA()()())}function Mn(o,n){if(1&o&&(e.TgZ(0,"small",30),e._uU(1),e.qZA()),2&o){const t=n.row;e.xp6(1),e.Oqu(t.descricao)}}function Vn(o,n){if(1&o&&e._UZ(0,"badge",40),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.Q6J("color",a.lookup.getColor(a.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",a.lookup.getIcon(a.lookup.PLANO_TRABALHO_STATUS,t.status))("label",a.lookup.getValue(a.lookup.PLANO_TRABALHO_STATUS,t.status))}}function Sn(o,n){if(1&o&&(e.TgZ(0,"div",12)(1,"div",13)(2,"grid",14)(3,"columns")(4,"column",15),e.YNc(5,xn,1,1,"ng-template",null,16,e.W1O),e.qZA(),e.TgZ(7,"column",17),e.YNc(8,Nn,4,0,"ng-template",null,18,e.W1O),e.YNc(10,yn,4,2,"ng-template",null,19,e.W1O),e.qZA(),e.TgZ(12,"column",20),e.YNc(13,Un,4,0,"ng-template",null,21,e.W1O),e.YNc(15,qn,5,4,"ng-template",null,22,e.W1O),e.qZA(),e.TgZ(17,"column",23),e.YNc(18,Qn,3,2,"ng-template",null,9,e.W1O),e.YNc(20,Rn,2,1,"ng-template",null,10,e.W1O),e.qZA(),e.TgZ(22,"column",24),e.YNc(23,Jn,4,0,"ng-template",null,25,e.W1O),e.YNc(25,Mn,2,1,"ng-template",null,26,e.W1O),e.qZA(),e.TgZ(27,"column",27),e.YNc(28,Vn,1,3,"ng-template",null,28,e.W1O),e.qZA()()()()()),2&o){const t=n.$implicit,a=e.MAs(6),i=e.MAs(9),l=e.MAs(11),c=e.MAs(14),g=e.MAs(16),m=e.MAs(19),f=e.MAs(21),R=e.MAs(24),L=e.MAs(26),ee=e.MAs(29);e.xp6(2),e.Q6J("items",t.entregas),e.xp6(2),e.Akn("vertical-align:middle"),e.Q6J("expandTemplate",a),e.xp6(3),e.Q6J("template",l)("titleTemplate",i),e.xp6(5),e.Q6J("titleTemplate",c)("template",g)("verticalAlign","middle")("width",300)("align","center"),e.xp6(5),e.Q6J("titleTemplate",m)("title","% CHD")("template",f)("width",125)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),e.xp6(5),e.Q6J("maxWidth",250)("titleTemplate",R)("template",L)("verticalAlign","middle")("align","center"),e.xp6(5),e.Q6J("template",ee)}}function zn(o,n){if(1&o&&(e.TgZ(0,"h5"),e._uU(1,"Entregas do plano:"),e.qZA(),e._UZ(2,"hr"),e.YNc(3,Sn,30,23,"div",11)),2&o){const t=n.row;e.xp6(3),e.Q6J("ngForOf",t.planos_trabalho)}}function jn(o,n){1&o&&(e.TgZ(0,"b"),e._uU(1,"Participante"),e.qZA())}function Gn(o,n){if(1&o&&(e.TgZ(0,"b"),e._uU(1),e.qZA(),e._UZ(2,"br"),e.TgZ(3,"small"),e._uU(4),e.qZA()),2&o){const t=n.row;e.xp6(1),e.Oqu(t.nome),e.xp6(3),e.Oqu(t.apelido||"")}}function Fn(o,n){}function kn(o,n){if(1&o&&(e.TgZ(0,"small"),e._UZ(1,"badge",39),e.qZA()),2&o){const t=n.row,a=e.oxw();e.xp6(1),e.Q6J("color",100==a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)?"success":"warning")("label",a.totalForcaTrabalho(a.planoAtivo(t.planos_trabalho).entregas)+"%")}}class ce extends B.D{set entregaId(n){this._entregaId!=n&&(this._entregaId=n)}get entregaId(){return this._entregaId}constructor(n){super(n),this.injector=n,this.items=[],this.loader=!1,this.PlanoTrabalhoDao=n.get(fn.t),this.PlanoTrabalhoEntregaDao=n.get(bn.w),this.planoTrabalhoService=n.get(vn.p),this.join=["plano_trabalho.usuario","plano_entrega_entrega.plano_entrega.unidade"],this.groupBy=[{field:"plano_trabalho.usuario",label:"Usu\xe1rio"}]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){this.loader=!0,this.cdRef.detectChanges();try{this.PlanoTrabalhoEntregaDao.query({where:[["plano_entrega_entrega_id","==",this._entregaId],["planoTrabalho.status","in",["ATIVO","CONCLUIDO","AVALIADO"]]],join:this.join}).asPromise().then(n=>{n.forEach(t=>{const a=t.plano_trabalho.usuario;if(a){const i=a.id;let l=this.items.find(f=>f.id===i);l||(l={...a,planos_trabalho:[],initialization(f){}},this.items.push(l));const c=t.plano_trabalho.id;let g=l.planos_trabalho.find(f=>f.id===c);g||(g={...t.plano_trabalho,entregas:[],initialization(f){}},l.planos_trabalho.push(g));const m={...t,initialization(f){}};g.entregas.push(m)}})}).finally(()=>{this.loader=!1,this.cdRef.detectChanges()})}catch{console.log("Erro")}}totalForcaTrabalho(n=[]){const t=n.map(a=>1*a.forca_trabalho).reduce((a,i)=>a+i,0);return Math.round(100*t)/100}planoAtivo(n){return n.find(a=>"ATIVO"===a.status)||{}}static#e=this.\u0275fac=function(t){return new(t||ce)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:ce,selectors:[["plano-entrega-entregas-plano-trabalho"]],viewQuery:function(t,a){if(1&t&&e.Gf(Zn,5),2&t){let i;e.iGM(i=e.CRH())&&(a.accordionUser=i.first)}},inputs:{entregaId:"entregaId"},features:[e.qOj],decls:18,vars:11,consts:[[3,"items","loading"],["accordionUser",""],["type","expand",3,"expandTemplate","template","width"],["usuarioSectionTitle",""],["columnExpandeEntregas",""],[3,"titleTemplate","template"],["titleParticipante",""],["columnParticipante",""],[3,"titleTemplate","template","title","titleHint"],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["class","card mb-2",4,"ngFor","ngForOf"],[1,"card","mb-2"],[1,"card-body"],[3,"items"],["type","expand",3,"expandTemplate"],["columnExpandedAtividades",""],[3,"template","titleTemplate"],["titlePlano",""],["columnPlano",""],[3,"titleTemplate","template","verticalAlign","width","align"],["titleOrigem",""],["columnOrigem",""],[3,"titleTemplate","title","template","width","align","titleHint"],[3,"maxWidth","titleTemplate","template","verticalAlign","align"],["titleDescricao",""],["columnDescricao",""],["title","Status",3,"template"],["columnStatus",""],[3,"entregaId"],[1,"text-center"],[1,"d-block","text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["icon","bi bi-calculator",3,"color","label"],[3,"color","icon","label"]],template:function(t,a){if(1&t&&(e.TgZ(0,"grid",0,1)(2,"columns")(3,"column",2),e.YNc(4,Dn,0,0,"ng-template",null,3,e.W1O),e.YNc(6,zn,4,1,"ng-template",null,4,e.W1O),e.qZA(),e.TgZ(8,"column",5),e.YNc(9,jn,2,0,"ng-template",null,6,e.W1O),e.YNc(11,Gn,5,2,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(13,"column",8),e.YNc(14,Fn,0,0,"ng-template",null,9,e.W1O),e.YNc(16,kn,2,2,"ng-template",null,10,e.W1O),e.qZA()()()),2&t){const i=e.MAs(5),l=e.MAs(7),c=e.MAs(10),g=e.MAs(12),m=e.MAs(15),f=e.MAs(17);e.Q6J("items",a.items)("loading",a.loader),e.xp6(3),e.Q6J("expandTemplate",l)("template",i)("width",40),e.xp6(5),e.Q6J("titleTemplate",c)("template",g),e.xp6(5),e.Q6J("titleTemplate",m)("template",f)("title","% CHD")("titleHint","% Carga Hor\xe1ria Dispon\xedvel")}},dependencies:[T.sg,T.O5,b.M,v.a,p.b,N.F,de]})}var Ue=s(75471),Bn=s(59838);function Yn(o,n){if(1&o&&e._UZ(0,"badge",8),2&o){const t=e.oxw().$implicit,a=e.oxw(2);e.Q6J("icon",a.entityService.getIcon("Unidade"))("label",null==t.data||null==t.data.unidade?null:t.data.unidade.sigla)}}function Hn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",4),e._uU(1),e.qZA(),e.YNc(2,Yn,1,2,"badge",5),e._UZ(3,"br"),e.TgZ(4,"button",6),e.NdJ("click",function(){const l=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.showDetalhes(l.data))}),e._UZ(5,"i",7),e.qZA()}if(2&o){const t=n.$implicit;e.xp6(1),e.Oqu(t.label),e.xp6(1),e.Q6J("ngIf",null==t.data?null:t.data.unidade)}}function Wn(o,n){if(1&o&&(e.TgZ(0,"p-organizationChart",2),e.YNc(1,Hn,6,2,"ng-template",3),e.qZA()),2&o){const t=e.oxw();e.Q6J("value",t.entregasVinculadas)}}function Kn(o,n){1&o&&(e.TgZ(0,"div",9)(1,"div",10),e._UZ(2,"span",11),e.qZA()())}class ue extends B.D{set entregaId(n){this._entregaId!=n&&(this._entregaId=n)}get entregaId(){return this._entregaId}constructor(n){super(n),this.injector=n,this.loader=!1,this.entregasVinculadas=[],this.planoEntregaEntregaDao=n.get(U.K),this.join=["unidade"]}ngOnInit(){super.ngOnInit(),this.loadData()}loadData(){var n=this;return(0,u.Z)(function*(){n.loader=!0;try{n.entregasVinculadas=yield n.planoEntregaEntregaDao.hierarquia(n._entregaId),n.cdRef.detectChanges(),n.loader=!1}catch{console.log("Erro")}})()}showDetalhes(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega",n.id,"detalhes"]},{metadata:{entrega:n}})})()}static#e=this.\u0275fac=function(t){return new(t||ue)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:ue,selectors:[["plano-entrega-entregas-vinculadas"]],inputs:{entregaId:"entregaId"},features:[e.qOj],decls:2,vars:2,consts:[[3,"value",4,"ngIf"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"value"],["pTemplate","default"],[1,"p-2"],["color","light",3,"icon","label",4,"ngIf"],["title","Detalhes da entrega",1,"btn","btn-sm",3,"click"],[1,"bi","bi-eye"],["color","light",3,"icon","label"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"]],template:function(t,a){1&t&&(e.YNc(0,Wn,2,1,"p-organizationChart",0),e.YNc(1,Kn,3,0,"div",1)),2&t&&(e.Q6J("ngIf",a.entregasVinculadas.length),e.xp6(1),e.Q6J("ngIf",a.loader))},dependencies:[T.O5,N.F,Ue.OE,Bn.jx]})}function Xn(o,n){if(1&o&&e._UZ(0,"badge",19),2&o){const t=n.$implicit;e.Q6J("lookup",t)}}function $n(o,n){if(1&o&&e._UZ(0,"badge",20),2&o){const t=e.oxw(2);e.Q6J("icon",t.entityService.getIcon("Unidade"))("label",null==t.entrega||null==t.entrega.unidade?null:t.entrega.unidade.sigla)}}function eo(o,n){if(1&o&&e._UZ(0,"badge",21),2&o){const t=e.oxw(2);e.Q6J("label",null==t.entrega?null:t.entrega.destinatario)}}function to(o,n){if(1&o&&(e.TgZ(0,"div",22)(1,"div")(2,"b"),e._uU(3,"Planejada"),e.qZA(),e._UZ(4,"br")(5,"badge",23),e.qZA(),e._UZ(6,"div",24),e.TgZ(7,"div")(8,"b"),e._uU(9,"Executada"),e.qZA(),e._UZ(10,"br")(11,"badge",25),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(5),e.Q6J("textValue",t.planoEntregaService.getValorMeta(t.entrega)),e.xp6(6),e.Q6J("textValue",t.planoEntregaService.getValorRealizado(t.entrega))}}function ao(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",33)(1,"small"),e._uU(2),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw(3);return e.KtG(l.showPlanejamento(i.objetivo.id))}),e._UZ(4,"i",35),e.qZA()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.objetivo.nome)}}function no(o,n){if(1&o&&(e.TgZ(0,"li",31),e.YNc(1,ao,5,1,"div",32),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.objetivo)}}function oo(o,n){if(1&o&&(e.TgZ(0,"div",26)(1,"h5",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"ul",29),e.YNc(5,no,2,1,"li",30),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lex.translate("Objetivos")),e.xp6(3),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.objetivos)}}function io(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",33)(1,"small"),e._uU(2),e.qZA(),e.TgZ(3,"button",34),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().$implicit,l=e.oxw(3);return e.KtG(l.showCadeiaValor(i.processo.id))}),e._UZ(4,"i",35),e.qZA()()}if(2&o){const t=e.oxw().$implicit;e.xp6(2),e.Oqu(t.processo.nome)}}function lo(o,n){if(1&o&&(e.TgZ(0,"li",31),e.YNc(1,io,5,1,"div",32),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.processo)}}function so(o,n){if(1&o&&(e.TgZ(0,"div",26)(1,"h5",27),e._uU(2),e.qZA(),e.TgZ(3,"div",28)(4,"ul",29),e.YNc(5,lo,2,1,"li",30),e.qZA()()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.lex.translate("Processos")),e.xp6(3),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.processos)}}function ro(o,n){if(1&o&&(e.TgZ(0,"div",8)(1,"div",9),e.YNc(2,Xn,1,1,"badge",10),e.qZA(),e.TgZ(3,"h5"),e._uU(4),e.qZA(),e.TgZ(5,"small"),e._uU(6),e.qZA(),e._UZ(7,"hr"),e.TgZ(8,"p"),e._uU(9,"Per\xedodo: "),e.TgZ(10,"small"),e._uU(11),e.qZA()(),e.TgZ(12,"div",11)(13,"p",12),e._uU(14,"Demandante: "),e.YNc(15,$n,1,2,"badge",13),e.qZA(),e.TgZ(16,"p"),e._uU(17,"Destinat\xe1rio: "),e.YNc(18,eo,1,1,"badge",14),e.qZA()(),e.TgZ(19,"h5",15),e._uU(20),e.qZA(),e.TgZ(21,"small",16),e._uU(22),e.qZA(),e.YNc(23,to,12,2,"div",17),e.YNc(24,oo,6,2,"div",18),e.YNc(25,so,6,2,"div",18),e.qZA()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",null==t.entrega?null:t.entrega.etiquetas),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao_entrega),e.xp6(5),e.AsE("",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_inicio)," at\xe9 ",t.planoEntregaEntregaDao.getDateFormatted(null==t.entrega?null:t.entrega.data_fim),""),e.xp6(4),e.Q6J("ngIf",null==t.entrega?null:t.entrega.unidade),e.xp6(3),e.Q6J("ngIf",null==t.entrega||null==t.entrega.destinatario?null:t.entrega.destinatario.length),e.xp6(2),e.Oqu(t.lex.translate("Meta")),e.xp6(2),e.Oqu(null==t.entrega?null:t.entrega.descricao_meta),e.xp6(1),e.Q6J("ngIf",t.entrega),e.xp6(1),e.Q6J("ngIf",null==t.entrega||null==t.entrega.objetivos?null:t.entrega.objetivos.length),e.xp6(1),e.Q6J("ngIf",null==t.entrega||null==t.entrega.processos?null:t.entrega.processos.length)}}function co(o,n){if(1&o&&(e.TgZ(0,"div",36),e._UZ(1,"plano-entrega-entregas-vinculadas",37),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("entregaId",t.entrega.id)}}function uo(o,n){if(1&o&&(e.TgZ(0,"div",38),e._UZ(1,"plano-entrega-entregas-plano-trabalho",37),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("entregaId",t.entrega.id)}}class ge extends B.D{constructor(n){super(n),this.injector=n,this.planoEntregaEntregaDao=n.get(U.K),this.planoEntregaService=n.get(_.f)}ngOnInit(){super.ngOnInit(),this.entrega=this.metadata?.entrega}showPlanejamento(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",n]},{modal:!0})})()}showCadeiaValor(n){var t=this;return(0,u.Z)(function*(){t.go.navigate({route:["gestao","plano-entrega","entrega","processos",n]},{modal:!0})})()}static#e=this.\u0275fac=function(t){return new(t||ge)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:ge,selectors:[["plano-entrega-entrega-detalhes"]],features:[e.qOj],decls:8,vars:4,consts:[["right","",3,"title"],["detalhesEntrega",""],["key","INFOS","icon","bi bi-info-lg","label","Informa\xe7\xf5es"],["key","VINCULOS","icon","bi bi-arrow-down-up","label","V\xednculos"],["key","PARTICIPANTES","icon","bi bi-people","label","Participantes"],["class","","style","min-height: 400px;",4,"ngIf"],["style","min-height: 400px;",4,"ngIf"],["class","row","style","min-height: 400px;",4,"ngIf"],[1,"",2,"min-height","400px"],[1,"mb-2"],[3,"lookup",4,"ngFor","ngForOf"],[1,"d-flex"],[1,"me-2"],["color","light",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-mailbox",3,"label",4,"ngIf"],[1,"text-center"],[1,"d-block","text-center","mb-2"],["class","d-flex justify-content-center",4,"ngIf"],["class","mt-3",4,"ngIf"],[3,"lookup"],["color","light",3,"icon","label"],["color","light","icon","bi bi-mailbox",3,"label"],[1,"d-flex","justify-content-center"],["icon","bi bi-graph-up-arrow","color","light","hint","Planejada",3,"textValue"],[1,"vr","mx-5"],["icon","bi bi-check-lg","color","light","hint","Realizada",3,"textValue"],[1,"mt-3"],[1,"text-center","mb-2"],[1,"card"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["class","d-flex justify-content-between align-items-center",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-sm","btn-outline-info","me-2",3,"click"],[1,"bi","bi-eye"],[2,"min-height","400px"],[3,"entregaId"],[1,"row",2,"min-height","400px"]],template:function(t,a){if(1&t&&(e.TgZ(0,"tabs",0,1),e._UZ(2,"tab",2)(3,"tab",3)(4,"tab",4),e.qZA(),e.YNc(5,ro,26,12,"div",5),e.YNc(6,co,2,1,"div",6),e.YNc(7,uo,2,1,"div",7)),2&t){const i=e.MAs(1);e.Q6J("title",a.isModal?"":a.title),e.xp6(5),e.Q6J("ngIf","INFOS"==i.active),e.xp6(1),e.Q6J("ngIf","VINCULOS"==i.active&&a.entrega),e.xp6(1),e.Q6J("ngIf","PARTICIPANTES"==i.active&&a.entrega)}},dependencies:[T.sg,T.O5,Pe.n,Ze.i,N.F,ce,ue]})}const go=[{path:"",component:ae,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Plano de Entregas"}},{path:"new",component:V,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Entregas",modal:!0}},{path:":id/edit",component:V,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Entregas",modal:!0}},{path:":id/consult",component:V,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Entregas",modal:!0}},{path:":id/logs",component:ie,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Logs de Altera\xe7\xf5es em Planos de Entregas",modal:!0}},{path:":planoEntregaId/avaliar",component:sn.w,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Avaliar Plano de Entrega"}},{path:"entrega",component:X,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/:id/consult",component:X,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Consulta entrega do Plano de Entregas",modal:!0}},{path:"entrega/:id/detalhes",component:ge,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Detalhes da entrega do Plano de Entregas",modal:!0}},{path:"entrega-list",component:le,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/objetivos/:objetivo_id",component:K,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"entrega/processos/:processo_id",component:K,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Entregas do Plano de Entregas",modal:!0}},{path:"adesao",component:oe,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Ades\xe3o a Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id",component:re,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Progressos da entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/new",component:$,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}},{path:"entrega/progresso/:entrega_id/:id/edit",component:$,canActivate:[C.a],resolve:{config:h.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Progresso entrega do Plano de Entregas",modal:!0}}];class _e{static#e=this.\u0275fac=function(t){return new(t||_e)};static#t=this.\u0275mod=e.oAB({type:_e});static#a=this.\u0275inj=e.cJS({imports:[O.Bz.forChild(go),O.Bz]})}var _o=s(77024),po=s(40588),mo=s(32864);class pe{static#e=this.\u0275fac=function(t){return new(t||pe)};static#t=this.\u0275mod=e.oAB({type:pe});static#a=this.\u0275inj=e.cJS({imports:[T.ez,q.K,_e,_o.PlanejamentoModule,po.CadeiaValorModule,Ue.lC,mo.UteisModule]})}},80684:(fe,J,s)=>{s.d(J,{p:()=>P});var T=s(8239),q=s(43972),O=s(20755),C=s(32333),h=s(49193),u=s(92307),b=s(39702),I=s(87744),Z=s(41095),x=s(49367);class P{constructor(r,d,_,E,A,e,v,p){this.auth=r,this.util=d,this.go=_,this.lookup=E,this.dao=A,this.avaliacaoDao=e,this.templateService=v,this.planoTrabalhoDao=p}template(r){return r.programa?.template_tcr}metadados(r){return{needSign:this.needSign.bind(this),extraTags:this.extraTags.bind(this),especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",dataset:this.planoTrabalhoDao.dataset(),datasource:this.planoTrabalhoDao.datasource(r),template:r.programa?.template_tcr,template_id:r.programa?.template_tcr_id}}needSign(r,d){const _=r,E=d||(_?.documentos||[]).find(A=>_?.documento_id?.length&&A.id==_?.documento_id)||_?.documento;if(r&&E&&!E.assinaturas?.find(A=>A.usuario_id==this.auth.usuario.id)){const A=_.tipo_modalidade,e=_.programa,v=this.auth.entidade;let p=[];return e?.plano_trabalho_assinatura_participante&&p.push(_.usuario_id),e?.plano_trabalho_assinatura_gestor_lotacao&&p.push(...this.auth.gestoresLotacao.map(D=>D.id)),e?.plano_trabalho_assinatura_gestor_unidade&&p.push(_.unidade?.gestor?.id||"",..._.unidade?.gestores_substitutos?.map(D=>D.id)||""),e?.plano_trabalho_assinatura_gestor_entidade&&p.push(v.gestor_id||"",v.gestor_substituto_id||""),!!A&&p.includes(this.auth.usuario.id)}return!1}extraTags(r,d,_){const E=r;let A=[];return E?.documento_id==d.id&&A.push({key:d.id,value:"Vigente",icon:"bi bi-check-all",color:"primary"}),JSON.stringify(_.tags)!=JSON.stringify(A)&&(_.tags=A),_.tags}tipoEntrega(r,d){let _=d||r.plano_trabalho,E=r.plano_entrega_entrega?.plano_entrega?.unidade_id==_.unidade_id?"PROPRIA_UNIDADE":r.plano_entrega_entrega?"OUTRA_UNIDADE":r.orgao?.length?"OUTRO_ORGAO":"SEM_ENTREGA",A=this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(p=>p.key==E)||{key:"",value:"Desconhecido1"},e=_?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome||r.plano_entrega_entrega?.entrega?.nome||"Desconhecido2",v=_?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao||r.plano_entrega_entrega?.descricao||"";return{titulo:A.value,cor:A.color||"danger",nome:e,tipo:E,descricao:v}}atualizarTcr(r,d,_,E){if(d.usuario&&d.unidade){let A=this.dao.datasource(r),e=this.dao.datasource(d),v=d.programa;if(e.usuario.texto_complementar_plano=_||d.usuario?.texto_complementar_plano||"",e.unidade.texto_complementar_plano=E||d.unidade?.texto_complementar_plano||"",(v?.termo_obrigatorio||d.documento_id?.length)&&JSON.stringify(e)!=JSON.stringify(A)&&v?.template_tcr){let p=d.documentos?.find(D=>D.id==d.documento_id);d.documento_id?.length&&p&&!p.assinaturas?.length&&"LINK"!=p.tipo?(p.conteudo=this.templateService.renderTemplate(v?.template_tcr?.conteudo||"",e),p.dataset=this.dao.dataset(),p.datasource=e,p._status="ADD"==p._status?"ADD":"EDIT"):(p=new q.U({id:this.dao?.generateUuid(),tipo:"HTML",especie:"TCR",titulo:"Termo de Ci\xeancia e Responsabilidade",conteudo:this.templateService.renderTemplate(v?.template_tcr?.conteudo||"",e),status:"GERADO",_status:"ADD",template:v?.template_tcr?.conteudo,dataset:this.dao.dataset(),datasource:e,entidade_id:this.auth.entidade?.id,plano_trabalho_id:d.id,template_id:v?.template_tcr_id}),d.documentos.push(p)),d.documento=p,d.documento_id=p?.id||null}}return d.documento}situacaoPlano(r){return r.deleted_at?"EXCLUIDO":r.data_arquivamento?"ARQUIVADO":r.status}isValido(r){return!r.deleted_at&&"CANCELADO"!=r.status&&!r.data_arquivamento}estaVigente(r){let d=new Date;return"ATIVO"==r.status&&r.data_inicio<=d&&r.data_fim>=d}diasParaConcluirConsolidacao(r,d){return r&&d?this.util.daystamp(r.data_fim)+d.dias_tolerancia_avaliacao-this.util.daystamp(this.auth.hora):-1}avaliar(r,d,_){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",r.id,"avaliar"]},{modal:!0,metadata:{consolidacao:r,programa:d},modalClose:E=>{E&&(r.status="AVALIADO",r.avaliacao_id=E.id,r.avaliacao=E,_(r))}})}fazerRecurso(r,d,_){this.go.navigate({route:["gestao","plano-trabalho","consolidacao",r.id,"recurso"]},{modal:!0,metadata:{recurso:!0,consolidacao:r,programa:d},modalClose:E=>{E&&(r.avaliacao=E,_(r))}})}cancelarAvaliacao(r,d,_){var E=this;return(0,T.Z)(function*(){d.submitting=!0;try{(yield E.avaliacaoDao.cancelarAvaliacao(r.avaliacao.id))&&(r.status="CONCLUIDO",r.avaliacao_id=null,r.avaliacao=void 0,_(r))}catch(A){d.error(A.message||A)}finally{d.submitting=!1}})()}usuarioAssinou(r,d){return d=d||this.auth.usuario.id,Object.values(r).some(_=>(_||[]).includes(d))}assinaturasFaltantes(r,d){return{participante:r.participante.filter(_=>!d.participante.includes(_)),gestores_unidade_executora:r.gestores_unidade_executora.length?r.gestores_unidade_executora.filter(_=>d.gestores_unidade_executora.includes(_)).length?[]:r.gestores_unidade_executora:[],gestores_unidade_lotacao:r.gestores_unidade_lotacao.length?r.gestores_unidade_lotacao.filter(_=>d.gestores_unidade_lotacao.includes(_)).length?[]:r.gestores_unidade_lotacao:[],gestores_entidade:r.gestores_entidade.length?r.gestores_entidade.filter(_=>d.gestores_entidade.includes(_)).length?[]:r.gestores_entidade:[]}}static#e=this.\u0275fac=function(d){return new(d||P)(O.LFG(C.e),O.LFG(h.f),O.LFG(u.o),O.LFG(b.W),O.LFG(I.t),O.LFG(Z.w),O.LFG(x.E),O.LFG(I.t))};static#t=this.\u0275prov=O.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})}}}]);