"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[557],{8543:(H,U,_)=>{_.d(U,{l:()=>k});var A=_(4368);class k extends A.X{constructor(e){super(),this.documento=null,this.comentarios=[],this.descricao=null,this.data_lancamento=new Date,this.tempo_estimado=0,this.data_conclusao=null,this.documento_id=null,this.atividade_id="",this.usuario_id="",this.tipo_tarefa_id=null,this.initialization(e)}}},4180:(H,U,_)=>{_.d(U,{x:()=>S});var A=_(8509),k=_(5255),E=_(1214),e=_(3101),Z=_(9084),L=_(6551),P=_(4971),N=_(361),y=_(2124),J=_(2981),G=_(7338),Q=_(7744);class S extends A.E{constructor(p){super(p,e.a,P.P),this.injector=p,this.etiquetas=[],this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.DATAS_FILTRO=[{key:"DISTRIBUICAO",value:"Distribui\xe7\xe3o",icon:"bi bi-file-earmark-plus",color:"badge rounded-pill bg-warning text-dark"},{key:"PRAZO",value:"Prazo",icon:"bi bi-calendar-check",color:"badge rounded-pill bg-info text-dark"},{key:"CONCLUSAO",value:"Conclus\xe3o",icon:"bi bi-check-circle",color:"badge rounded-pill bg-info text-dark"}],this.unidadeDao=p.get(E.J),this.usuarioDao=p.get(k.q),this.planoTrabalhoDao=p.get(Q.t),this.tipoAtividadeDao=p.get(J.Y),this.tipoProcessoDao=p.get(N.n),this.allPages=p.get(Z.T),this.atividadeService=p.get(G.s),this.calendar=p.get(L.o),this.comentario=p.get(y.K),this.join=["tipo_atividade","plano_trabalho_entrega.plano_entrega_entrega:id,descricao","demandante","pausas","usuario","unidade","comentarios.usuario:id,nome,apelido","tarefas.tipo_tarefa","tarefas.comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.extra={planos_trabalho:{},afastamentos:{}},this.optionsMetadata={refreshId:(n=>(this.grid?.query||this.query).refreshId(n)).bind(this),removeId:(n=>(this.grid?.query||this.query).removeId(n)).bind(this),refresh:this.refresh.bind(this)}}onGridLoad(p){p?.forEach(r=>{r.comentarios=this.comentario.orderComentarios(r.comentarios)});const n=(this.grid?.query||this.query).extra;if(n){this.extra.planos_trabalho=Object.assign(this.extra.planos_trabalho,n.planos||{});for(let[r,c]of Object.entries(n.afastamentos||{}))this.extra.afastamentos[r]=c.reduce((m,f)=>(m.find(D=>D.id==f.id)||m.push(f),m),this.extra.afastamentos[r]||[]);Object.entries(n.feriados||{}).forEach(([r,c])=>{this.calendar.feriadosCadastrados[r]||(this.calendar.feriadosCadastrados[r]=c)}),p?.forEach(r=>{r.planoTrabalho=n.planos_trabalho[r.plano_trabalho_id]}),this.cdRef.detectChanges()}}onAtribuidasParaMimChange(p){this.filter.controls.usuario_id.setValue(this.filter.controls.atribuidas_para_mim.value?this.auth.usuario.id:void 0)}onSomenteUnidadeAtualChange(p){this.filter.controls.unidade_id.setValue(this.filter.controls.somente_unidade_atual.value?this.auth.unidade.id:void 0)}onDespendidoClick(p){p.metadados&&!p.metadados.concluido&&(this.efemerides=this.calendar.calculaDataTempoUnidade(p.data_inicio,this.auth.hora,this.extra?.planos_trabalho[p.plano_trabalho_id]?.carga_horaria||0,p.unidade,"ENTREGA",p.pausas,this.extra?.afastamentos[p.usuario_id]||[]),this.dialog.template({title:"C\xe1lculos do tempo despendido"},this.calendarEfemerides,[]))}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:p=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(n,r)=>n.key==r.key),this.cdRef.detectChanges()}})}comentarioClick(p){const n=p.getAttribute("data-expanded");p.setAttribute("data-expanded","true"==n?"false":"true")}addComentarioClick(p){this.go.navigate({route:["gestao","atividade",p.id,"comentar"]},{modal:!0,modalClose:n=>{n&&(this.grid?.query||this.query).refreshId(p.id)}})}}},8644:(H,U,_)=>{_.d(U,{N:()=>se});var A=_(8239),k=_(3150),E=_(4180),e=_(755);const Z=["calendarEfemerides"],L=["unidade"],P=["usuario"],N=["tipoAtividade"],y=["etiqueta"],J=["planoEntrega"],G=["planoEntregaEntrega"];function Q(a,l){if(1&a&&e._UZ(0,"calendar-efemerides",53),2&a){const i=e.oxw();e.Q6J("efemerides",i.efemerides)}}function S(a,l){if(1&a&&(e.ynx(0),e.TgZ(1,"label",56),e._uU(2),e.TgZ(3,"b"),e._uU(4),e.qZA()(),e.BQk()),2&a){const i=l.$implicit;e.xp6(2),e.hij("",i.label,": "),e.xp6(2),e.Oqu(i.value)}}function q(a,l){if(1&a&&(e.TgZ(0,"div",54),e.YNc(1,S,5,2,"ng-container",55),e.qZA()),2&a){const i=l.group;e.xp6(1),e.Q6J("ngForOf",i)}}function p(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"toolbar")(1,"input-switch",57),e.NdJ("change",function(t){e.CHM(i);const s=e.oxw();return e.KtG(s.onAgruparChange(t))}),e.qZA(),e.TgZ(2,"input-switch",58),e.NdJ("change",function(t){e.CHM(i);const s=e.oxw();return e.KtG(s.onAgruparChange(t))}),e.qZA()()}if(2&a){const i=e.oxw();e.xp6(1),e.Q6J("size",3)("control",i.filter.controls.agrupar_entrega),e.xp6(1),e.Q6J("size",3)("control",i.filter.controls.agrupar)}}function n(a,l){if(1&a&&(e.TgZ(0,"span",63),e._UZ(1,"i",64),e._uU(2),e.qZA()),2&a){const i=e.oxw().row;e.xp6(2),e.hij(" ",null==i.tarefas?null:i.tarefas.length,"")}}function r(a,l){if(1&a&&e.YNc(0,n,3,1,"span",62),2&a){const i=l.row;e.Q6J("ngIf",null==i.tarefas?null:i.tarefas.length)}}function c(a,l){if(1&a&&e._UZ(0,"atividade-list-tarefa",65),2&a){const i=l.row,o=e.oxw(2);e.Q6J("selectable",o.selectable)("editable",!i.metadados.concluido)("atividade",i)}}function m(a,l){if(1&a&&(e.TgZ(0,"column",59),e.YNc(1,r,1,1,"ng-template",null,60,e.W1O),e.YNc(3,c,1,3,"ng-template",null,61,e.W1O),e.qZA()),2&a){const i=e.MAs(2),o=e.MAs(4),t=e.oxw();e.Q6J("align","center")("hint","Tarefas da "+t.lex.translate("atividade"))("template",i)("expandTemplate",o)}}function f(a,l){if(1&a&&(e.TgZ(0,"order",66),e._uU(1,"#ID"),e.qZA(),e._uU(2),e.TgZ(3,"order",67),e._uU(4),e.qZA(),e._UZ(5,"br"),e._uU(6," Descri\xe7\xe3o ")),2&a){const i=l.header,o=e.oxw();e.Q6J("header",i),e.xp6(2),e.hij("/Tipo de ",o.lex.translate("Atividade"),"/ "),e.xp6(1),e.Q6J("header",i),e.xp6(1),e.Oqu(o.lex.translate("Entrega"))}}function D(a,l){if(1&a&&e._UZ(0,"badge",74),2&a){const i=e.oxw().row,o=e.oxw();e.Q6J("icon",o.entityService.getIcon("TipoAtividade"))("label",i.tipo_atividade.nome)}}function C(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"badge",75),e.NdJ("click",function(){e.CHM(i);const t=e.oxw().row,s=e.oxw();return e.KtG(s.onEntregaClick(t))}),e.qZA()}if(2&a){const i=e.oxw().row,o=e.oxw();e.Q6J("icon",o.entityService.getIcon("Entrega"))("label",i.plano_trabalho_entrega.descricao)}}function x(a,l){if(1&a&&(e.TgZ(0,"span",68),e._UZ(1,"badge",69),e.YNc(2,D,1,2,"badge",70),e.YNc(3,C,1,2,"badge",71),e.qZA(),e.TgZ(4,"span",72),e._uU(5),e.qZA(),e._UZ(6,"reaction",73)),2&a){const i=l.row,o=e.oxw();e.xp6(1),e.Q6J("label",i.numero)("data",i.numero)("click",o.atividadeService.onIdClick.bind(o)),e.xp6(1),e.Q6J("ngIf",i.tipo_atividade),e.xp6(1),e.Q6J("ngIf",i.plano_trabalho_entrega),e.xp6(2),e.Oqu(i.descricao),e.xp6(1),e.Q6J("entity",i)}}function j(a,l){if(1&a&&e._UZ(0,"input-textarea",76)(1,"input-search",77,78),2&a){const i=e.oxw();e.Q6J("size",12)("rows",2)("control",i.formEdit.controls.descricao),e.xp6(1),e.Q6J("label","Tipo de "+i.lex.translate("atividade"))("size",12)("emptyValue",null)("control",i.formEdit.controls.tipo_atividade_id)("dao",i.tipoAtividadeDao)("labelInfo","Tipo de "+i.lex.translate("atividade")+" utilizado para classificar a "+i.lex.translate("atividade"))("required",i.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true")}}function v(a,l){if(1&a&&e._UZ(0,"badge",80),2&a){const i=l.$implicit,o=e.oxw(2);e.Q6J("lookup",i)("click",o.onEtiquetaClick.bind(o))}}function u(a,l){1&a&&e.YNc(0,v,1,2,"badge",79),2&a&&e.Q6J("ngForOf",l.row.etiquetas)}function d(a,l){if(1&a){const i=e.EpF();e.TgZ(0,"input-multiselect",81)(1,"input-select",82,83),e.NdJ("details",function(){e.CHM(i);const t=e.oxw();return e.KtG(t.onEtiquetaConfigClick())}),e.qZA()()}if(2&a){const i=e.oxw();e.Q6J("size",12)("control",i.formEdit.controls.etiquetas)("addItemHandle",i.addItemHandleEtiquetas.bind(i)),e.xp6(1),e.Q6J("size",12)("control",i.formEdit.controls.etiqueta)("items",i.etiquetas)}}function h(a,l){1&a&&e._uU(0," Plano de trabalho ")}function I(a,l){if(1&a&&(e.TgZ(0,"span",85),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&a){const i=e.oxw().row,o=e.oxw();e.xp6(1),e.hij("",o.dao.getDateFormatted(i.planoTrabalho.data_inicio)," "),e.xp6(2),e.Oqu(" at\xe9 "+o.dao.getDateFormatted(i.planoTrabalho.data_fim))}}function O(a,l){1&a&&e.YNc(0,I,4,2,"span",84),2&a&&e.Q6J("ngIf",l.row.planoTrabalho)}function T(a,l){if(1&a&&(e._uU(0," Un./"),e.TgZ(1,"order",86),e._uU(2),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",87),e._uU(5,"Demandante"),e.qZA()),2&a){const i=l.header,o=e.oxw();e.xp6(1),e.Q6J("header",i),e.xp6(1),e.Oqu(o.lex.translate("Respons\xe1vel")),e.xp6(2),e.Q6J("header",i)}}function M(a,l){if(1&a&&(e.TgZ(0,"div",88),e._UZ(1,"badge",89)(2,"badge",90),e.qZA(),e._UZ(3,"badge",91)),2&a){const i=l.row,o=e.oxw();e.xp6(1),e.Q6J("label",i.unidade.sigla),e.xp6(1),e.Q6J("icon","bi "+(null!=i.usuario&&null!=i.usuario.nome&&i.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",o.util.apelidoOuNome(i.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==i.usuario?null:i.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.xp6(1),e.Q6J("label",o.util.apelidoOuNome(i.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==i.demandante?null:i.demandante.nome)||"Desconhecido"))}}function B(a,l){if(1&a&&(e._uU(0," Tempos "),e.TgZ(1,"order",92),e._uU(2,"Distribui\xe7\xe3o"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",93),e._uU(5,"Prazo"),e.qZA(),e.TgZ(6,"order",94),e._uU(7,"Entrega"),e.qZA()),2&a){const i=l.header;e.xp6(1),e.Q6J("header",i),e.xp6(3),e.Q6J("header",i),e.xp6(2),e.Q6J("header",i)}}function F(a,l){1&a&&e._UZ(0,"badge",97),2&a&&e.Q6J("badge",l.$implicit)}function z(a,l){if(1&a&&(e.TgZ(0,"div",95),e.YNc(1,F,1,1,"badge",96),e.qZA()),2&a){const i=l.row,o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.atividadeService.temposAtividade(i,o.extra,o.onDespendidoClick.bind(o)))}}function V(a,l){1&a&&e._UZ(0,"separator",100)}function W(a,l){1&a&&e._UZ(0,"i",103)}function Y(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,W,1,0,"i",101),e.qZA(),e.TgZ(3,"td",102),e._uU(4),e.qZA()()),2&a){const i=l.$implicit;e.xp6(2),e.Q6J("ngIf",i.checked),e.xp6(2),e.Oqu(i.texto)}}function w(a,l){if(1&a&&(e.TgZ(0,"table"),e.YNc(1,Y,5,2,"tr",55),e.qZA()),2&a){const i=e.oxw().row;e.xp6(1),e.Q6J("ngForOf",i.checklist)}}function b(a,l){if(1&a&&(e._UZ(0,"progress-bar",98),e.YNc(1,V,1,0,"separator",99),e.YNc(2,w,2,1,"table",3)),2&a){const i=l.row;e.Q6J("value",i.progresso),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length)}}function X(a,l){1&a&&e._UZ(0,"separator",100)}function $(a,l){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input-switch",105),e.qZA(),e.TgZ(3,"td",102),e._uU(4),e.qZA()()),2&a){const i=l.$implicit,o=l.index,t=e.oxw(3);e.xp6(2),e.Q6J("size",12)("source",t.checklist)("path",o+".checked"),e.xp6(2),e.Oqu(i.texto)}}function ee(a,l){if(1&a&&(e.TgZ(0,"table"),e.YNc(1,$,5,4,"tr",55),e.qZA()),2&a){const i=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.checklist)}}function te(a,l){if(1&a&&(e._UZ(0,"input-number",104),e.YNc(1,X,1,0,"separator",99),e.YNc(2,ee,2,1,"table",3)),2&a){const i=l.row,o=e.oxw();e.Q6J("size",12)("decimals",2)("control",o.formEdit.controls.progresso),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length)}}function ie(a,l){if(1&a&&e._UZ(0,"badge",109),2&a){const i=l.$implicit,o=e.oxw(2);e.Q6J("data",i)("color",i.color)("icon",i.icon)("label",i.label)("click",null!=i.data&&i.data.filter?o.onStatusClick.bind(o):void 0)}}function ae(a,l){if(1&a&&(e._UZ(0,"documentos-badge",106),e.TgZ(1,"span",85),e.YNc(2,ie,1,5,"badge",107),e.qZA(),e._UZ(3,"comentarios-widget",108)),2&a){const i=l.row,o=e.oxw();e.Q6J("documento",i.documento_requisicao),e.xp6(2),e.Q6J("ngForOf",o.atividadeService.getStatus(i)),e.xp6(1),e.Q6J("entity",i)("selectable",o.selectable)("grid",o.grid)}}function oe(a,l){if(1&a&&e._UZ(0,"column",110),2&a){const i=e.oxw();e.Q6J("metadata",i.optionsMetadata)("dynamicOptions",i.atividadeService.dynamicOptions.bind(i))("dynamicButtons",i.atividadeService.dynamicButtons.bind(i))("options",i.options)}}let se=(()=>{class a extends E.x{static#e=this.selectRoute={route:["gestao","atividade","grid"]};constructor(i){super(i),this.injector=i,this.minhas=!1,this.planosEntregas=[],this.planosEntregasEntregas=[],this.etiquetasAscendentes=[],this.storeFilter=o=>{const t=o?.value;return{atribuidas_para_mim:t.atribuidas_para_mim,usuario_id:t.usuario_id,plano_trabalho_id:t.plano_trabalho_id,somente_unidade_atual:t.somente_unidade_atual,unidades_subordinadas:t.unidades_subordinadas,unidade_id:t.somente_unidade_atual?null:t.unidade_id}},this.filterWhere=o=>{let t=this.fixedFilter||[],s=o.value;if(s.somente_unidade_atual&&s.unidade_id!=this.auth.unidade?.id&&(o.controls.unidade_id.setValue(this.auth.unidade?.id),s.unidade_id=this.auth.unidade?.id),s.atribuidas_para_mim&&s.usuario_id!=this.auth.usuario?.id&&(o.controls.usuario_id.setValue(this.auth.usuario?.id),s.usuario_id=this.auth.usuario.id),s.usuario_id&&s.usuario_id.length&&t.push(["usuario_id","==",s.usuario_id]),s.plano_trabalho_id?.length&&t.push(["plano_trabalho_id","==",s.plano_trabalho_id]),s.unidade_id?.length&&t.push(["unidade_id","==",s.unidade_id]),s.unidades_subordinadas&&t.push(["unidades_subordinadas","==",!0]),s.etiquetas?.length&&t.push(["etiquetas","in",s.etiquetas.map(g=>g.value)]),s.numero_processo?.length&&t.push(["numero_processo","==",s.numero_processo]),s.numero?.length&&t.push(["numero","==",s.numero]),s.status?.length&&!t.find(g=>"status"==g[0])&&(t.push(["status","==",s.status]),"ARQUIVADO"==s.status&&this.filter.controls.arquivadas.setValue(!0)),this.filter.controls.arquivadas.value||t.push(["data_arquivamento","==",null]),s.tipo_atividade_id?.length&&t.push(["tipo_atividade_id","==",s.tipo_atividade_id]),s.tipo_processo_id?.length&&t.push(["tipo_processo_id","==",s.tipo_processo_id]),s.plano_entrega_id?.length&&t.push(["plano_entrega_id","==",s.plano_entrega_id]),s.plano_entrega_entrega_id?.length&&t.push(["plano_entrega_entrega_id","==",s.plano_entrega_entrega_id]),s.data_filtro?.length){const g="DISTRIBUICAO"==s.data_filtro?"data_distribuicao":"PRAZO"==s.data_filtro?"data_estipulada_entrega":"data_entrega";s.data_inicio&&t.push([g,">=",s.data_inicio]),s.data_fim&&t.push([g,"<=",s.data_fim])}return t},this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.modalWidth=1100,this.filter=this.fh.FormBuilder({agrupar:{default:!0},agrupar_entrega:{default:!0},atribuidas_para_mim:{default:this.minhas},usuario_id:{default:null},numero:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},plano_trabalho_id:{default:null},unidade_id:{default:null},numero_processo:{default:""},status:{default:null},etiquetas:{default:[]},arquivadas:{default:!1},tipo_atividade_id:{default:null},tipo_processo_id:{default:null},data_filtro:{default:null},data_inicio:{default:null},data_fim:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({descricao:{default:""},tipo_atividade_id:{default:null},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.groupBy=[{field:"unidade.sigla",label:"Unidade"},{field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"},{field:"plano_trabalho_entrega.descricao",label:"Descri\xe7\xe3o dos trabalhos"}],this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngAfterViewInit(){if(super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.fixedFilter){const i=this.fixedFilter.find(o=>"status"==o[0]);i&&this.filter?.controls.status.setValue(i[2])}}onAgruparChange(i){const t=this.filter.controls.agrupar_entrega.value,s=[];this.filter.controls.agrupar.value&&s.push({field:"unidade.sigla",label:"Unidade"}),t&&s.push({field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"}),this.groupBy=s,this.grid.reloadFilter()}onStatusClick(i){this.filter?.controls.status.setValue(i.data?.status),this.grid.showFilter(),this.grid.reloadFilter()}onEtiquetaClick(i){let o=this.filter.controls.etiquetas.value;o.push(i),this.filter?.controls.etiquetas.setValue(o),this.grid.showFilter(),this.grid.reloadFilter()}onEntregaClick(i){this.go.navigate({route:["gestao","atividade",i.id,"hierarquia"]},{metadata:{atividade:i}})}onColumnProgressoEtiquetasChecklistEdit(i){var o=this;return(0,A.Z)(function*(){o.formEdit.controls.progresso.setValue(i.progresso),o.checklist=o.util.clone(i.checklist)})()}onColumnProgressoEtiquetasChecklistSave(i){var o=this;return(0,A.Z)(function*(){try{const t=yield o.dao.update(i.id,{progresso:o.formEdit.controls.progresso.value,checklist:o.checklist});return i.progresso=o.formEdit.controls.progresso.value,i.checklist=o.checklist,!!t}catch{return!1}})()}filterClear(i){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(null),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(null),this.filter.controls.plano_trabalho_id.setValue(null),this.filter.controls.numero_processo.setValue(""),this.filter.controls.atividade_id.setValue(null),this.filter.controls.tipo_processo_id.setValue(null),this.filter.controls.data_filtro.setValue(null),this.filter.controls.data_inicio.setValue(null),this.filter.controls.data_fim.setValue(null),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(o=>"status"==o[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(i)}addItemHandleEtiquetas(){let i;if(this.etiqueta&&this.etiqueta.selectedItem){const o=this.etiqueta.selectedItem,t=o.key?.length?o.key:this.util.textHash(o.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,t)&&(i={key:t,value:o.value,color:o.color,icon:o.icon},this.formEdit.controls.etiqueta.setValue(null))}return i}onColumnEtiquetasEdit(i){var o=this;return(0,A.Z)(function*(){if(!o.etiquetasAscendentes.filter(t=>t.data==i.unidade_id).length){o.loading=!0;let t=[];try{t=yield o.carregaEtiquetasUnidadesAscendentes(i.unidade)}finally{o.loading=!1}o.etiquetasAscendentes.push(...t)}o.formEdit.controls.etiquetas.setValue(i.etiquetas),o.formEdit.controls.etiqueta.setValue(null),o.etiquetas=o.util.merge(i.tipo_atividade?.etiquetas,i.unidade?.etiquetas,(t,s)=>t.key==s.key),o.etiquetas=o.util.merge(o.etiquetas,o.auth.usuario.config?.etiquetas,(t,s)=>t.key==s.key),o.etiquetas=o.util.merge(o.etiquetas,o.etiquetasAscendentes.filter(t=>t.data==i.unidade_id),(t,s)=>t.key==s.key)})()}carregaEtiquetasUnidadesAscendentes(i){var o=this;return(0,A.Z)(function*(){let t=[],s=i.path.split("/").filter(R=>R?.length);return(yield o.unidadeDao.query({where:[["id","in",s]]}).asPromise()).forEach(R=>{t=o.util.merge(t,R.etiquetas,(ne,K)=>ne.key==K.key)}),t.forEach(R=>R.data=i.id),t})()}onColumnEtiquetasSave(i){var o=this;return(0,A.Z)(function*(){try{const t=yield o.dao.update(i.id,{etiquetas:o.formEdit.controls.etiquetas.value});return i.etiquetas=o.formEdit.controls.etiquetas.value,!!t}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:i=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(o,t)=>o.key==t.key),this.cdRef.detectChanges()}})}onUnidadeChange(i){var o=this;return(0,A.Z)(function*(){let t=yield o.unidadeDao.getById(o.filter?.controls.unidade_id.value,["planos_entrega"]);o.planosEntregas=t?.planos_entrega?.map(s=>Object.assign({key:s.id,value:s.nome}))||[]})()}onPlanoEntregaChange(i){var o=this;return(0,A.Z)(function*(){let t=[];(yield o.unidadeDao.getById(o.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(g=>{g.id==o.filter.controls.plano_entrega_id.value&&t.push(g.entregas)}),o.planosEntregasEntregas=t[0].map(g=>Object.assign({key:g.id,value:g.descricao}))||[]})()}onColumnAtividadeDescricaoEdit(i){var o=this;return(0,A.Z)(function*(){o.formEdit.controls.descricao.setValue(i.descricao),o.formEdit.controls.tipo_atividade_id.setValue(i.tipo_atividade_id),o.formEdit.controls.comentarios.setValue(i.comentarios)})()}onColumnAtividadeDescricaoSave(i){var o=this;return(0,A.Z)(function*(){try{o.atividadeService.comentarioAtividade(o.tipoAtividade?.selectedEntity,o.formEdit.controls.comentarios);const t=yield o.dao.update(i.id,{descricao:o.formEdit.controls.descricao.value,tipo_atividade_id:o.formEdit.controls.tipo_atividade_id.value,comentarios:(o.formEdit.controls.comentarios.value||[]).filter(s=>["ADD","EDIT","DELETE"].includes(s._status||""))});return i.descricao=o.formEdit.controls.descricao.value,i.tipo_atividade_id=o.formEdit.controls.tipo_atividade_id.value,i.tipo_atividade=o.tipoAtividade?.selectedEntity||null,i.comentarios=o.formEdit.controls.comentarios.value,!!t}catch{return!1}})()}canEditColumn(i){return i.usuario_id==this.auth.usuario.id}static#t=this.\u0275fac=function(o){return new(o||a)(e.Y36(e.zs3))};static#i=this.\u0275cmp=e.Xpm({type:a,selectors:[["atividade-list-grid"]],viewQuery:function(o,t){if(1&o&&(e.Gf(k.M,5),e.Gf(Z,5),e.Gf(L,5),e.Gf(P,5),e.Gf(N,5),e.Gf(y,5),e.Gf(J,5),e.Gf(G,5)),2&o){let s;e.iGM(s=e.CRH())&&(t.grid=s.first),e.iGM(s=e.CRH())&&(t.calendarEfemerides=s.first),e.iGM(s=e.CRH())&&(t.unidade=s.first),e.iGM(s=e.CRH())&&(t.usuario=s.first),e.iGM(s=e.CRH())&&(t.tipoAtividade=s.first),e.iGM(s=e.CRH())&&(t.etiqueta=s.first),e.iGM(s=e.CRH())&&(t.planoEntrega=s.first),e.iGM(s=e.CRH())&&(t.planoEntregaEntrega=s.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.qOj],decls:73,vars:122,consts:[["calendarEfemerides",""],[3,"dao","add","form","hasEdit","hasDelete","orderBy","groupBy","join","loadList","selectable","groupTemplate","select"],["groupAtividades",""],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"size","control","change"],["label","Usu\xe1rio","controlName","usuario_id",3,"size","control","disabled","dao"],["usuario",""],["label","Plano de trabalho","controlName","plano_trabalho_id",3,"size","control","dao"],["planoTrabalho",""],["label","Atual","controlName","somente_unidade_atual",3,"size","control","labelInfo","change"],["label","Unidade","controlName","unidade_id",3,"size","control","disabled","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"size","label","valueTodos","control","items","change"],["planoEntrega",""],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["planoEntregaEntrega",""],["label","#ID","controlName","numero","maskFormat","999999",3,"size","control","labelInfo"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["label","Arq.","controlName","arquivadas",3,"size","control","labelInfo"],["controlName","tipo_atividade_id",3,"size","label","control","dao"],["controlName","tipo_processo_id",3,"size","label","control","dao"],["label","Data","itemTodos","- Todos -","controlName","data_filtro",3,"size","valueTodos","control","items"],["noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["noIcon","","label","Fim","controlName","data_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","editable","maxWidth","template","editTemplate","columnEditTemplate","edit","save"],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["columnAtividadeDescricaoEdit",""],[3,"title","editable","maxWidth","width","template","editTemplate","columnEditTemplate","edit","save"],["columnEtiquetas",""],["columnEtiquetasEdit",""],[3,"titleTemplate","template"],["titlePlanoTrabalho",""],["columnPlanoTrabalho",""],[3,"titleTemplate","template","maxWidth","editable"],["titleUnResponsavelDemandante",""],["columnPessoas",""],[3,"titleTemplate","template","width"],["titleTempos",""],["columnTempos",""],[3,"title","maxWidth","editable","columnEditTemplate","template","edit","save"],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],[3,"title","width","template"],["columnNumero",""],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options",4,"ngIf"],[3,"rows"],[3,"efemerides"],[1,"d-flex","ps-3"],[4,"ngFor","ngForOf"],[1,"me-3"],["labelPosition","left","label","Agrupar por Entrega","controlName","agrupar_entrega",3,"size","control","change"],["labelPosition","left","label","Agrupar por Unidade","controlName","agrupar",3,"size","control","change"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["columnTarefas",""],["columnExpandedTarefas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["persist","",3,"selectable","editable","atividade"],["by","numero",3,"header"],["by","plano_trabalho_entrega.descricao",3,"header"],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],["color","light",3,"icon","label",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["color","light",3,"icon","label"],["color","info","role","button",3,"icon","label","click"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["relativeId","columnTipoAtividade","controlName","tipo_atividade_id",3,"label","size","emptyValue","control","dao","labelInfo","required"],["tipoAtividade",""],[3,"lookup","click",4,"ngFor","ngForOf"],[3,"lookup","click"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],["class","d-block",4,"ngIf"],[1,"d-block"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["by","data_distribuicao",3,"header"],["by","data_estipulada_entrega",3,"header"],["by","data_entrega",3,"header"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["color","success",3,"value"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["scale","small",3,"size","source","path"],[3,"documento"],[3,"data","color","icon","label","click",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"data","color","icon","label","click"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options"]],template:function(o,t){if(1&o&&(e.YNc(0,Q,1,1,"ng-template",null,0,e.W1O),e.TgZ(2,"grid",1),e.NdJ("select",function(g){return t.onSelect(g)}),e.YNc(3,q,2,1,"ng-template",null,2,e.W1O),e.YNc(5,p,3,4,"toolbar",3),e.TgZ(6,"filter",4)(7,"div",5)(8,"input-switch",6),e.NdJ("change",function(g){return t.onAtribuidasParaMimChange(g)}),e.qZA(),e._UZ(9,"input-search",7,8)(11,"input-search",9,10),e.qZA(),e.TgZ(13,"div",5)(14,"input-switch",11),e.NdJ("change",function(g){return t.onSomenteUnidadeAtualChange(g)}),e.qZA(),e.TgZ(15,"input-search",12,13),e.NdJ("change",function(g){return t.onUnidadeChange(g)}),e.qZA(),e._UZ(17,"input-switch",14),e.TgZ(18,"input-select",15,16),e.NdJ("change",function(g){return t.onPlanoEntregaChange(g)}),e.qZA(),e._UZ(20,"input-select",17,18),e.qZA(),e.TgZ(22,"div",5),e._UZ(23,"input-text",19)(24,"input-text",20)(25,"input-select",21)(26,"input-multiselect",22)(27,"input-switch",23),e.qZA(),e.TgZ(28,"div",5),e._UZ(29,"input-search",24)(30,"input-search",25)(31,"input-select",26)(32,"input-datetime",27)(33,"input-datetime",28),e.qZA()(),e.TgZ(34,"columns"),e.YNc(35,m,5,4,"column",29),e.TgZ(36,"column",30),e.YNc(37,f,7,4,"ng-template",null,31,e.W1O),e.YNc(39,x,7,7,"ng-template",null,32,e.W1O),e.YNc(41,j,3,10,"ng-template",null,33,e.W1O),e.qZA(),e.TgZ(43,"column",34),e.YNc(44,u,1,1,"ng-template",null,35,e.W1O),e.YNc(46,d,3,6,"ng-template",null,36,e.W1O),e.qZA(),e.TgZ(48,"column",37),e.YNc(49,h,1,0,"ng-template",null,38,e.W1O),e.YNc(51,O,1,1,"ng-template",null,39,e.W1O),e.qZA(),e.TgZ(53,"column",40),e.YNc(54,T,6,3,"ng-template",null,41,e.W1O),e.YNc(56,M,4,6,"ng-template",null,42,e.W1O),e.qZA(),e.TgZ(58,"column",43),e.YNc(59,B,8,3,"ng-template",null,44,e.W1O),e.YNc(61,z,2,1,"ng-template",null,45,e.W1O),e.qZA(),e.TgZ(63,"column",46),e.YNc(64,b,3,3,"ng-template",null,47,e.W1O),e.YNc(66,te,3,5,"ng-template",null,48,e.W1O),e.qZA(),e.TgZ(68,"column",49),e.YNc(69,ae,4,5,"ng-template",null,50,e.W1O),e.qZA(),e.YNc(71,oe,1,4,"column",51),e.qZA(),e._UZ(72,"pagination",52),e.qZA()),2&o){const s=e.MAs(4),g=e.MAs(38),R=e.MAs(40),ne=e.MAs(42),K=e.MAs(45),le=e.MAs(47),re=e.MAs(50),de=e.MAs(52),ue=e.MAs(55),ce=e.MAs(57),_e=e.MAs(60),he=e.MAs(62),pe=e.MAs(65),me=e.MAs(67),fe=e.MAs(70);e.xp6(2),e.Q6J("dao",t.dao)("add",t.add)("form",t.formEdit)("hasEdit",!1)("hasDelete",!1)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("loadList",t.onGridLoad.bind(t))("selectable",t.selectable)("groupTemplate",s),e.xp6(3),e.Q6J("ngIf",!t.fixedFilter&&!t.selectable),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&!(null!=t.queryParams&&t.queryParams.filter)&&t.filterCollapsed),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.atribuidas_para_mim),e.xp6(1),e.Q6J("size",6)("control",t.filter.controls.usuario_id)("disabled",t.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",t.usuarioDao),e.xp6(2),e.Q6J("size",5)("control",t.filter.controls.plano_trabalho_id)("dao",t.planoTrabalhoDao),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.somente_unidade_atual)("labelInfo","Somente as "+t.lex.translate("atividades")+" da unidade selecionada"),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.unidade_id)("disabled",t.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.unidades_subordinadas),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_id)("items",t.planosEntregas),e.xp6(2),e.Q6J("size",3)("label",t.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_entrega_id)("items",t.planosEntregasEntregas),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.numero)("labelInfo","N\xfamero "+t.lex.translate("atividade")),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("label","N\xba "+t.lex.translate("Processo")+" (Sei)")("control",t.filter.controls.numero_processo),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("valueTodos",null)("disabled",null!=t.fixedFilter&&t.fixedFilter.length&&"status"==t.fixedFilter[0][0]?"true":void 0)("control",t.filter.controls.status)("items",t.lookup.ATIVIDADE_STATUS_COM_ARQUIVADAS),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.etiquetas),e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.arquivadas)("labelInfo","Listar tamb\xe9m "+t.lex.translate("atividades")+" arquivadas"),e.xp6(2),e.Q6J("size",3)("label","Tipo de "+t.lex.translate("Atividade"))("control",t.filter.controls.tipo_atividade_id)("dao",t.tipoAtividadeDao),e.xp6(1),e.Q6J("size",3)("label","Tipo de "+t.lex.translate("Processo"))("control",t.filter.controls.tipo_processo_id)("dao",t.tipoProcessoDao),e.xp6(1),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_fim),e.xp6(2),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("titleTemplate",g)("editable",t.canEditColumn.bind(t))("maxWidth",250)("template",R)("editTemplate",R)("columnEditTemplate",t.selectable?void 0:ne)("edit",t.selectable?void 0:t.onColumnAtividadeDescricaoEdit.bind(t))("save",t.selectable?void 0:t.onColumnAtividadeDescricaoSave.bind(t)),e.xp6(7),e.Q6J("title","Etiquetas")("editable",t.canEditColumn.bind(t))("maxWidth",300)("width",100)("template",K)("editTemplate",K)("columnEditTemplate",t.selectable?void 0:le)("edit",t.selectable?void 0:t.onColumnEtiquetasEdit.bind(t))("save",t.selectable?void 0:t.onColumnEtiquetasSave.bind(t)),e.xp6(5),e.Q6J("titleTemplate",re)("template",de),e.xp6(5),e.Q6J("titleTemplate",ue)("template",ce)("maxWidth",150)("editable",t.canEditColumn.bind(t)),e.xp6(5),e.Q6J("titleTemplate",_e)("template",he)("width",250),e.xp6(5),e.Q6J("title","Progresso\nChecklist")("maxWidth",250)("editable",t.canEditColumn.bind(t))("columnEditTemplate",t.selectable?void 0:me)("template",pe)("edit",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistEdit.bind(t))("save",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistSave.bind(t)),e.xp6(5),e.Q6J("title","n\xba Processo/Status\nComent\xe1rios")("width",250)("template",fe),e.xp6(3),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("rows",t.rowsLimit)}},styles:[".atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}"]})}return a})()},7338:(H,U,_)=>{_.d(U,{s:()=>S});var A=_(8239),k=_(1597),E=_(755),e=_(9702),Z=_(5908),L=_(6551),P=_(2124),N=_(2333),y=_(9193),J=_(2307),G=_(5545),Q=_(4971);let S=(()=>{class q{constructor(n,r,c,m,f,D,C,x,j){this.lookup=n,this.lex=r,this.calendar=c,this.comentario=m,this.auth=f,this.util=D,this.go=C,this.dialog=x,this.dao=j,this.delete=(v,u)=>{this.dialog.confirm("Exclui ?","Deseja realmente excluir?").then(d=>{d&&this.dao.delete(u).then(()=>{v.removeId(u.id),this.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro","Erro ao excluir: "+(h?.message?h?.message:h)))})},this.cancelarInicio=(v,u)=>{this.dialog.confirm("Cancelar inicio ?","Deseja realmente cancelar a inicializa\xe7\xe3o?").then(d=>{d&&this.dao.cancelarInicio(u.id).then(()=>{v.refreshId(u.id),this.dialog.topAlert("Cancelado a inicializa\xe7\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",h?.message))})},this.cancelarConclusao=(v,u)=>{this.dialog.confirm("Cancelar conclus\xe3o ?","Deseja realmente cancelar a conclus\xe3o?").then(d=>{d&&this.dao.cancelarConclusao(u.id).then(()=>{v.refreshId(u.id),this.dialog.topAlert("Cancelado a conclus\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",h?.message))})},this.desarquivar=(v,u)=>{this.dao.arquivar(u.id,!1).then(()=>{v.refreshId(u.id)}).catch(d=>this.dialog.alert("Erro",d?.message))},this.arquivar=(v,u)=>{this.dialog.confirm("Arquivar?","Deseja realmente arquivar a atividade?").then(d=>{d&&this.dao.arquivar(u.id,!0).then(()=>{v.refreshId(u.id)}).catch(h=>this.dialog.alert("Erro",h?.message))})},this.dynamicOptions=(v,u)=>{let d=[],h=v;const I=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(a=>a.id).includes(this.auth.usuario?.id||""),O=this.auth.usuario?.id==h.demandante_id,T=this.auth.usuario?.id==h.usuario_id,M=this.lastConsolidacao(v.metadados?.consolidacoes),B={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"consult"]},{modal:!0})},F={label:"Coment\xe1rios",icon:"bi bi-chat-left-quote",onClick:a=>this.go.navigate({route:["uteis","comentarios","ATIVIDADE",a.id,"new"]},this.modalRefreshId(u,a))},z={label:"Clonar",icon:"bi bi-stickies",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"clonar"]},this.modalRefresh(u))},V={label:"Alterar atividade",icon:"bi bi-pencil-square",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"edit"]},this.modalRefreshId(u,a))},W={label:"Excluir atividade",icon:"bi bi-trash",onClick:this.delete.bind(this,u)},Y={label:"Prorrogar prazo",icon:"bi bi-skip-end-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"prorrogar"]},this.modalRefreshId(u,a))},w={label:"Iniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"iniciar"]},this.modalRefreshId(u,a))},b={label:"Cancelar inicio",id:"NAOINICIADO",icon:"bi bi-backspace",onClick:this.cancelarInicio.bind(this,u)},X={label:"Alterar inicio",icon:"bi bi-play-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"iniciar"]},this.modalRefreshId(u,a))},$={label:"Pausar",id:"PAUSADO",icon:"bi bi-pause-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"pausar"]},this.modalRefreshId(u,a))},ee={label:"Reiniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(u,a))},te={label:"Concluir",id:"CONCLUIDO",icon:"bi bi-check-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"concluir"]},this.modalRefreshId(u,a))},ie={label:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"concluir"]},this.modalRefreshId(u,a))},ae={label:"Cancelar conclus\xe3o",id:"INICIADO",icon:"bi bi-backspace",onClick:this.cancelarConclusao.bind(this,u)},oe={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,u)},se={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,u)};return u?.disabled||(d.push(B),(T||I||O)&&d.push(F),d.push(z),h.metadados?.arquivado?(I||T)&&d.push(se):h.metadados?.iniciado?h.metadados?.concluido?((I||T)&&d.push(oe),"CONCLUIDO"!=M?.status&&((T||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&d.push(ie),(T||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_CONCL"))&&(d.length&&d.push({divider:!0}),d.push(ae)))):h.metadados?.iniciado&&(h.metadados?.pausado?(T||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(ee):((T||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&d.push(te),(T||this.auth.hasPermissionTo("MOD_DMD_USERS_PAUSA"))&&d.push($),(!M||"INCLUIDO"==M?.status)&&((T||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_INICIAR"))&&d.push(b),(T||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(X))),(I||O||this.auth.hasPermissionTo("MOD_DMD_USERS_PPRZO"))&&d.push(Y)):((T||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(w),(I||O||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT"))&&d.push(V),(I||O||this.auth.hasPermissionTo("MOD_DMD_USERS_EXCL")||this.auth.hasPermissionTo("MOD_DMD_NI_EXCL"))&&(d.length&&d.push({divider:!0}),d.push(W)))),d},this.dynamicButtons=(v,u)=>{let d=[],h=v;const I=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(b=>b.usuario_id).includes(this.auth.usuario?.id||""),O=this.auth.usuario?.id==h.usuario_id,T=this.lastConsolidacao(v.metadados?.consolidacoes),B={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:b=>this.go.navigate({route:["gestao","atividade",b.id,"consult"]},{modal:!0})},F={hint:"Iniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:b=>this.go.navigate({route:["gestao","atividade",b.id,"iniciar"]},this.modalRefreshId(u,b))},z={hint:"Reiniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:b=>this.go.navigate({route:["gestao","atividade",b.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(u,b))},V={hint:"Concluir",icon:"bi bi-check",color:"btn-outline-success",onClick:b=>this.go.navigate({route:["gestao","atividade",b.id,"concluir"]},this.modalRefreshId(u,b))},W={hint:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,u)},Y={hint:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,u)},w={hint:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:b=>this.go.navigate({route:["gestao","atividade",b.id,"concluir"]},this.modalRefreshId(u,b))};return u?.disabled||(h.metadados?.iniciado?h.metadados?.concluido?I||O?d.push(h.metadados?.arquivado?Y:W):"CONCLUIDO"!=T?.status&&(O||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&d.push(w):h.metadados?.iniciado&&(h.metadados?.pausado&&O?d.push(z):(O||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&d.push(V)):(O||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(F)),d.length||d.push(B),d}}getStatus(n,r){const c=n,m=this.lookup.ATIVIDADE_STATUS.find(x=>x.key==c.status)||{key:"DESCONHECIDO",value:"Desconhecido",icon:"bi bi-question-circle",color:"light"},f=this.util.setTime(r?.data_inicio||new Date,0,0,0),D=this.util.setTime(r?.data_fim||new Date,23,59,59);let C=[{data:{status:m.key,filter:!0},label:m.value,icon:m.icon,color:m.color}];return c.metadados?.atrasado&&C.push({data:{status:"ATRASADO",filter:!1},label:"Atrasado",icon:"bi bi-alarm",color:"danger"}),r&&(c.data_inicio&&this.util.asTimestamp(c.data_inicio)<this.util.asTimestamp(f)||c.data_entrega&&this.util.asTimestamp(c.data_entrega)>this.util.asTimestamp(D))&&C.push({data:{status:"EXTRAPOLADO",filter:!1},label:"Extrapolado",icon:"bi bi-arrow-left-right",color:"danger",hint:"Data de in\xedcio ou conclus\xe3o "+this.lex.translate("da Atividade")+" extrapola os da consolida\xe7\xe3o"}),c.metadados?.arquivado&&C.push({data:{status:"ARQUIVADO",filter:!1},label:"Arquivado",icon:"bi bi-inboxes",color:"danger"}),c.metadados&&JSON.stringify(c.metadados._status)!=JSON.stringify(C)&&(c.metadados._status=C),c.metadados?._status||C}temposAtividade(n,r,c){if(n.metadados&&n.metadados.extra?.lastUpdate!=this.auth.unidadeHora){let m=r?.planos_trabalho[n.plano_trabalho_id]||n.plano_trabalho,f=[{color:"light",hint:this.lex.translate("Data de distribui\xe7\xe3o"),icon:"bi bi-file-earmark-plus",label:this.dao.getDateTimeFormatted(n.data_distribuicao)},{color:"light",hint:this.lex.translate("Prazo de entrega"),icon:"bi bi-calendar-check",label:this.dao.getDateTimeFormatted(n.data_estipulada_entrega)}];if(m?.tipo_modalidade?.atividade_esforco&&f.push({color:"light",hint:this.lex.translate("Esfor\xe7o"),icon:"bi bi-stopwatch",label:n.esforco?this.util.decimalToTimerFormated(n.esforco,!0)+" "+this.lex.translate("esfor\xe7o"):"Sem "+this.lex.translate("esfor\xe7o")}),n.metadados.concluido&&f.push({color:"light",hint:"Data de entrega realizada",icon:"bi bi-check-circle",label:this.dao.getDateTimeFormatted(n.data_entrega)}),n.metadados.iniciado&&m?.tipo_modalidade?.atividade_tempo_despendido){const x=n.metadados.concluido?n.tempo_despendido||0:this.calendar.horasUteis(n.data_inicio,this.auth.hora,m?.carga_horaria||0,n.unidade,"ENTREGA",n.pausas,r?.afastamentos[n.usuario_id]||[]);f.push({color:x>n.esforco?"warning":"light",hint:"Tempo despendido",icon:"bi bi-hourglass-split",label:this.util.decimalToTimerFormated(x,!0)+" despendido",click:n.metadados.concluido?void 0:c,data:n})}if(!n.metadados.concluido&&this.util.asTimestamp(n.data_estipulada_entrega)<this.auth.hora.getTime()){const D=this.calendar.horasAtraso(n.data_estipulada_entrega,n.unidade);f.push({color:"danger",hint:"Tempo de atraso",icon:"bi bi-alarm",label:this.util.decimalToTimerFormated(D,!0)+" atrasado"})}n.metadados.extra=n.metadados.extra||{},n.metadados.extra.lastUpdate=this.auth.unidadeHora,n.metadados.extra.tempos=f}return n.metadados?.extra?.tempos||[]}onIdClick(n){this.util.copyToClipboard(n.toString())}buildEtiquetas(n,r){return this.util.merge(r?.etiquetas,n?.etiquetas,(c,m)=>c.key==m.key)}buildChecklist(n,r){let c=this.util.merge((n?.checklist||[]).map(m=>({id:m.key,texto:m.value,checked:!1})),(r?.value||[]).filter(m=>m.checked),(m,f)=>m.id==f.id&&(m.checked=f.checked,!0));return r&&r.setValue(c),c}comentarioAtividade(n,r){let c=r?.value||[];const m=c.findIndex(f=>"TIPO_ATIVIDADE"==f.tipo);if(m>=0&&"ADD"==c[m]._status&&c.splice(m,1),n?.comentario?.length){const f=new k.Z;f.id=this.dao.generateUuid(),f.path="",f.texto=n.comentario,f.data_comentario=this.auth.hora,f.usuario_id=this.auth.usuario.id,f.comentario_id=null,f.tipo="TIPO_ATIVIDADE",f.usuario=this.auth.usuario,f._status="ADD",c.push(f),c=this.comentario.orderComentarios(c),r&&r.setValue(c)}}modalRefreshId(n,r){return{modal:!0,modalClose:(c=(0,A.Z)(function*(m){return n.refreshId(r.id)}),function(f){return c.apply(this,arguments)})};var c}modalRefresh(n){return{modal:!0,modalClose:n.refresh}}lastConsolidacao(n){return n?.reduce((r,c)=>!r||this.util.asTimestamp(c.data_conclusao)>this.util.asTimestamp(r.data_conclusao)?c:r,void 0)}static#e=this.\u0275fac=function(r){return new(r||q)(E.LFG(e.W),E.LFG(Z.E),E.LFG(L.o),E.LFG(P.K),E.LFG(N.e),E.LFG(y.f),E.LFG(J.o),E.LFG(G.x),E.LFG(Q.P))};static#t=this.\u0275prov=E.Yz7({token:q,factory:q.\u0275fac,providedIn:"root"})}return q})()}}]);