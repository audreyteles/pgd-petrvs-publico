<<<<<<< HEAD
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[5557],{88543:(w,R,_)=>{_.d(R,{l:()=>U});var v=_(64368);class U extends v.X{constructor(e){super(),this.documento=null,this.comentarios=[],this.descricao=null,this.data_lancamento=new Date,this.tempo_estimado=0,this.data_conclusao=null,this.documento_id=null,this.atividade_id="",this.usuario_id="",this.tipo_tarefa_id=null,this.initialization(e)}}},94180:(w,R,_)=>{_.d(R,{x:()=>I});var v=_(78509),U=_(35255),A=_(81214),e=_(73101),M=_(79084),Z=_(6551),L=_(84971),P=_(70361),N=_(2124),y=_(22981),J=_(57338),Q=_(87744);class I extends v.E{constructor(n){super(n,e.a,L.P),this.injector=n,this.etiquetas=[],this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.DATAS_FILTRO=[{key:"DISTRIBUICAO",value:"Distribui\xe7\xe3o",icon:"bi bi-file-earmark-plus",color:"badge rounded-pill bg-warning text-dark"},{key:"PRAZO",value:"Prazo",icon:"bi bi-calendar-check",color:"badge rounded-pill bg-info text-dark"},{key:"CONCLUSAO",value:"Conclus\xe3o",icon:"bi bi-check-circle",color:"badge rounded-pill bg-info text-dark"}],this.unidadeDao=n.get(A.J),this.usuarioDao=n.get(U.q),this.planoTrabalhoDao=n.get(Q.t),this.tipoAtividadeDao=n.get(y.Y),this.tipoProcessoDao=n.get(P.n),this.allPages=n.get(M.T),this.atividadeService=n.get(J.s),this.calendar=n.get(Z.o),this.comentario=n.get(N.K),this.join=["tipo_atividade","plano_trabalho_entrega.plano_entrega_entrega:id,descricao","demandante","pausas","usuario","unidade","comentarios.usuario:id,nome,apelido","tarefas.tipo_tarefa","tarefas.comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.extra={planos_trabalho:{},afastamentos:{}},this.optionsMetadata={refreshId:(r=>(this.grid?.query||this.query).refreshId(r)).bind(this),removeId:(r=>(this.grid?.query||this.query).removeId(r)).bind(this),refresh:this.refresh.bind(this)}}onGridLoad(n){n?.forEach(l=>{l.comentarios=this.comentario.orderComentarios(l.comentarios)});const r=(this.grid?.query||this.query).extra;if(r){this.extra.planos_trabalho=Object.assign(this.extra.planos_trabalho,r.planos||{});for(let[l,p]of Object.entries(r.afastamentos||{}))this.extra.afastamentos[l]=p.reduce((m,C)=>(m.find(T=>T.id==C.id)||m.push(C),m),this.extra.afastamentos[l]||[]);Object.entries(r.feriados||{}).forEach(([l,p])=>{this.calendar.feriadosCadastrados[l]||(this.calendar.feriadosCadastrados[l]=p)}),n?.forEach(l=>{l.planoTrabalho=r.planos_trabalho[l.plano_trabalho_id]}),this.cdRef.detectChanges()}}onAtribuidasParaMimChange(n){this.filter.controls.atribuidas_para_mim.value?this.filter.controls.usuario_id.setValue(this.auth.usuario.id):this.filter.controls.usuario_id.setValue(void 0)}onSomenteUnidadeAtualChange(n){this.filter.controls.somente_unidade_atual.value?this.filter.controls.unidade_id.setValue(this.auth.unidade.id):this.filter.controls.unidade_id.setValue(void 0)}onDespendidoClick(n){if(n.metadados&&!n.metadados.concluido){const r=this.extra?.planos_trabalho[n.plano_trabalho_id]?.carga_horaria||0,l=this.extra?.afastamentos[n.usuario_id]||[];this.efemerides=this.calendar.calculaDataTempoUnidade(n.data_inicio,this.auth.hora,r,n.unidade,"ENTREGA",n.pausas,l),this.dialog.template({title:"C\xe1lculos do tempo despendido"},this.calendarEfemerides,[])}}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:n=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(r,l)=>r.key==l.key),this.cdRef.detectChanges()}})}comentarioClick(n){const r=n.getAttribute("data-expanded");n.setAttribute("data-expanded","true"==r?"false":"true")}addComentarioClick(n){this.go.navigate({route:["gestao","atividade",n.id,"comentar"]},{modal:!0,modalClose:r=>{r&&(this.grid?.query||this.query).refreshId(n.id)}})}}},48644:(w,R,_)=>{_.d(R,{N:()=>c});var v=_(8239),U=_(73150),A=_(94180),e=_(20755);const M=["calendarEfemerides"],Z=["unidade"],L=["usuario"],P=["tipoAtividade"],N=["etiqueta"],y=["planoEntrega"],J=["planoEntregaEntrega"];function Q(o,a){if(1&o&&e._UZ(0,"calendar-efemerides",53),2&o){const i=e.oxw();e.Q6J("efemerides",i.efemerides)}}function I(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"label",56),e._uU(2),e.TgZ(3,"b"),e._uU(4),e.qZA()(),e.BQk()),2&o){const i=a.$implicit;e.xp6(2),e.hij("",i.label,": "),e.xp6(2),e.Oqu(i.value)}}function se(o,a){if(1&o&&(e.TgZ(0,"div",54),e.YNc(1,I,5,2,"ng-container",55),e.qZA()),2&o){const i=a.group;e.xp6(1),e.Q6J("ngForOf",i)}}function n(o,a){if(1&o){const i=e.EpF();e.TgZ(0,"toolbar")(1,"input-switch",57),e.NdJ("change",function(s){e.CHM(i);const f=e.oxw();return e.KtG(f.onAgruparChange(s))}),e.qZA(),e.TgZ(2,"input-switch",58),e.NdJ("change",function(s){e.CHM(i);const f=e.oxw();return e.KtG(f.onAgruparChange(s))}),e.qZA()()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("size",3)("control",i.filter.controls.agrupar_entrega),e.xp6(1),e.Q6J("size",3)("control",i.filter.controls.agrupar)}}function r(o,a){if(1&o&&(e.TgZ(0,"span",63),e._UZ(1,"i",64),e._uU(2),e.qZA()),2&o){const i=e.oxw().row;e.xp6(2),e.hij(" ",null==i.tarefas?null:i.tarefas.length,"")}}function l(o,a){if(1&o&&e.YNc(0,r,3,1,"span",62),2&o){const i=a.row;e.Q6J("ngIf",null==i.tarefas?null:i.tarefas.length)}}function p(o,a){if(1&o&&e._UZ(0,"atividade-list-tarefa",65),2&o){const i=a.row,t=e.oxw(2);e.Q6J("selectable",t.selectable)("editable",!i.metadados.concluido)("atividade",i)}}function m(o,a){if(1&o&&(e.TgZ(0,"column",59),e.YNc(1,l,1,1,"ng-template",null,60,e.W1O),e.YNc(3,p,1,3,"ng-template",null,61,e.W1O),e.qZA()),2&o){const i=e.MAs(2),t=e.MAs(4),s=e.oxw();e.Q6J("align","center")("hint","Tarefas da "+s.lex.translate("atividade"))("template",i)("expandTemplate",t)}}function C(o,a){if(1&o&&(e.TgZ(0,"order",66),e._uU(1,"#ID"),e.qZA(),e._uU(2),e.TgZ(3,"order",67),e._uU(4),e.qZA(),e._UZ(5,"br"),e._uU(6," Descri\xe7\xe3o ")),2&o){const i=a.header,t=e.oxw();e.Q6J("header",i),e.xp6(2),e.hij("/Tipo de ",t.lex.translate("Atividade"),"/ "),e.xp6(1),e.Q6J("header",i),e.xp6(1),e.Oqu(t.lex.translate("Entrega"))}}function T(o,a){if(1&o&&e._UZ(0,"badge",74),2&o){const i=e.oxw().row,t=e.oxw();e.Q6J("icon",t.entityService.getIcon("TipoAtividade"))("label",i.tipo_atividade.nome)}}function q(o,a){if(1&o){const i=e.EpF();e.TgZ(0,"badge",75),e.NdJ("click",function(){e.CHM(i);const s=e.oxw().row,f=e.oxw();return e.KtG(f.onEntregaClick(s))}),e.qZA()}if(2&o){const i=e.oxw().row,t=e.oxw();e.Q6J("icon",t.entityService.getIcon("Entrega"))("label",i.plano_trabalho_entrega.descricao)}}function K(o,a){if(1&o&&(e.TgZ(0,"span",68),e._UZ(1,"badge",69),e.YNc(2,T,1,2,"badge",70),e.YNc(3,q,1,2,"badge",71),e.qZA(),e.TgZ(4,"span",72),e._uU(5),e.qZA(),e._UZ(6,"reaction",73)),2&o){const i=a.row,t=e.oxw();e.xp6(1),e.Q6J("label",i.numero)("data",i.numero)("click",t.atividadeService.onIdClick.bind(t)),e.xp6(1),e.Q6J("ngIf",i.tipo_atividade),e.xp6(1),e.Q6J("ngIf",i.plano_trabalho_entrega),e.xp6(2),e.Oqu(i.descricao),e.xp6(1),e.Q6J("entity",i)}}function b(o,a){if(1&o&&e._UZ(0,"input-textarea",76)(1,"input-search",77,78),2&o){const i=e.oxw();e.Q6J("size",12)("rows",2)("control",i.formEdit.controls.descricao),e.xp6(1),e.Q6J("label","Tipo de "+i.lex.translate("atividade"))("size",12)("emptyValue",null)("control",i.formEdit.controls.tipo_atividade_id)("dao",i.tipoAtividadeDao)("labelInfo","Tipo de "+i.lex.translate("atividade")+" utilizado para classificar a "+i.lex.translate("atividade"))("required",i.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true")}}function u(o,a){if(1&o&&e._UZ(0,"badge",80),2&o){const i=a.$implicit,t=e.oxw(2);e.Q6J("lookup",i)("click",t.onEtiquetaClick.bind(t))}}function d(o,a){if(1&o&&e.YNc(0,u,1,2,"badge",79),2&o){const i=a.row;e.Q6J("ngForOf",i.etiquetas)}}function h(o,a){if(1&o){const i=e.EpF();e.TgZ(0,"input-multiselect",81)(1,"input-select",82,83),e.NdJ("details",function(){e.CHM(i);const s=e.oxw();return e.KtG(s.onEtiquetaConfigClick())}),e.qZA()()}if(2&o){const i=e.oxw();e.Q6J("size",12)("control",i.formEdit.controls.etiquetas)("addItemHandle",i.addItemHandleEtiquetas.bind(i)),e.xp6(1),e.Q6J("size",12)("control",i.formEdit.controls.etiqueta)("items",i.etiquetas)}}function D(o,a){1&o&&e._uU(0," Plano de trabalho ")}function O(o,a){if(1&o&&(e.TgZ(0,"span",85),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const i=e.oxw().row,t=e.oxw();e.xp6(1),e.hij("",t.dao.getDateFormatted(i.planoTrabalho.data_inicio)," "),e.xp6(2),e.Oqu(" at\xe9 "+t.dao.getDateFormatted(i.planoTrabalho.data_fim))}}function E(o,a){if(1&o&&e.YNc(0,O,4,2,"span",84),2&o){const i=a.row;e.Q6J("ngIf",i.planoTrabalho)}}function k(o,a){if(1&o&&(e._uU(0," Un./"),e.TgZ(1,"order",86),e._uU(2),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",87),e._uU(5,"Demandante"),e.qZA()),2&o){const i=a.header,t=e.oxw();e.xp6(1),e.Q6J("header",i),e.xp6(1),e.Oqu(t.lex.translate("Respons\xe1vel")),e.xp6(2),e.Q6J("header",i)}}function G(o,a){if(1&o&&(e.TgZ(0,"div",88),e._UZ(1,"badge",89)(2,"badge",90),e.qZA(),e._UZ(3,"badge",91)),2&o){const i=a.row,t=e.oxw();e.xp6(1),e.Q6J("label",i.unidade.sigla),e.xp6(1),e.Q6J("icon","bi "+(null!=i.usuario&&null!=i.usuario.nome&&i.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",t.util.apelidoOuNome(i.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==i.usuario?null:i.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.xp6(1),e.Q6J("label",t.util.apelidoOuNome(i.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==i.demandante?null:i.demandante.nome)||"Desconhecido"))}}function S(o,a){if(1&o&&(e._uU(0," Tempos "),e.TgZ(1,"order",92),e._uU(2,"Distribui\xe7\xe3o"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",93),e._uU(5,"Prazo"),e.qZA(),e.TgZ(6,"order",94),e._uU(7,"Entrega"),e.qZA()),2&o){const i=a.header;e.xp6(1),e.Q6J("header",i),e.xp6(3),e.Q6J("header",i),e.xp6(2),e.Q6J("header",i)}}function B(o,a){if(1&o&&e._UZ(0,"badge",97),2&o){const i=a.$implicit;e.Q6J("badge",i)}}function F(o,a){if(1&o&&(e.TgZ(0,"div",95),e.YNc(1,B,1,1,"badge",96),e.qZA()),2&o){const i=a.row,t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.atividadeService.temposAtividade(i,t.extra,t.onDespendidoClick.bind(t)))}}function z(o,a){1&o&&e._UZ(0,"separator",100)}function V(o,a){1&o&&e._UZ(0,"i",103)}function W(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,V,1,0,"i",101),e.qZA(),e.TgZ(3,"td",102),e._uU(4),e.qZA()()),2&o){const i=a.$implicit;e.xp6(2),e.Q6J("ngIf",i.checked),e.xp6(2),e.Oqu(i.texto)}}function g(o,a){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,W,5,2,"tr",55),e.qZA()),2&o){const i=e.oxw().row;e.xp6(1),e.Q6J("ngForOf",i.checklist)}}function H(o,a){if(1&o&&(e._UZ(0,"progress-bar",98),e.YNc(1,z,1,0,"separator",99),e.YNc(2,g,2,1,"table",3)),2&o){const i=a.row;e.Q6J("value",i.progresso),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length)}}function j(o,a){1&o&&e._UZ(0,"separator",100)}function X(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input-switch",105),e.qZA(),e.TgZ(3,"td",102),e._uU(4),e.qZA()()),2&o){const i=a.$implicit,t=a.index,s=e.oxw(3);e.xp6(2),e.Q6J("size",12)("source",s.checklist)("path",t+".checked"),e.xp6(2),e.Oqu(i.texto)}}function $(o,a){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,X,5,4,"tr",55),e.qZA()),2&o){const i=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",i.checklist)}}function ee(o,a){if(1&o&&(e._UZ(0,"input-number",104),e.YNc(1,j,1,0,"separator",99),e.YNc(2,$,2,1,"table",3)),2&o){const i=a.row,t=e.oxw();e.Q6J("size",12)("decimals",2)("control",t.formEdit.controls.progresso),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length),e.xp6(1),e.Q6J("ngIf",null==i.checklist?null:i.checklist.length)}}function te(o,a){if(1&o&&e._UZ(0,"badge",109),2&o){const i=a.$implicit,t=e.oxw(2);e.Q6J("data",i)("color",i.color)("icon",i.icon)("label",i.label)("click",null!=i.data&&i.data.filter?t.onStatusClick.bind(t):void 0)}}function ie(o,a){if(1&o&&(e._UZ(0,"documentos-badge",106),e.TgZ(1,"span",85),e.YNc(2,te,1,5,"badge",107),e.qZA(),e._UZ(3,"comentarios-widget",108)),2&o){const i=a.row,t=e.oxw();e.Q6J("documento",i.documento_requisicao),e.xp6(2),e.Q6J("ngForOf",t.atividadeService.getStatus(i)),e.xp6(1),e.Q6J("entity",i)("selectable",t.selectable)("grid",t.grid)}}function ae(o,a){if(1&o&&e._UZ(0,"column",110),2&o){const i=e.oxw();e.Q6J("metadata",i.optionsMetadata)("dynamicOptions",i.atividadeService.dynamicOptions.bind(i))("dynamicButtons",i.atividadeService.dynamicButtons.bind(i))("options",i.options)}}class c extends A.x{static#e=this.selectRoute={route:["gestao","atividade","grid"]};constructor(a){super(a),this.injector=a,this.minhas=!1,this.planosEntregas=[],this.planosEntregasEntregas=[],this.etiquetasAscendentes=[],this.storeFilter=i=>{const t=i?.value;return{atribuidas_para_mim:t.atribuidas_para_mim,usuario_id:t.usuario_id,plano_trabalho_id:t.plano_trabalho_id,somente_unidade_atual:t.somente_unidade_atual,unidades_subordinadas:t.unidades_subordinadas,unidade_id:t.somente_unidade_atual?null:t.unidade_id}},this.filterWhere=i=>{let t=this.fixedFilter||[],s=i.value;if(s.somente_unidade_atual&&s.unidade_id!=this.auth.unidade?.id&&(i.controls.unidade_id.setValue(this.auth.unidade?.id),s.unidade_id=this.auth.unidade?.id),s.atribuidas_para_mim&&s.usuario_id!=this.auth.usuario?.id&&(i.controls.usuario_id.setValue(this.auth.usuario?.id),s.usuario_id=this.auth.usuario.id),s.usuario_id&&s.usuario_id.length&&t.push(["usuario_id","==",s.usuario_id]),s.plano_trabalho_id?.length&&t.push(["plano_trabalho_id","==",s.plano_trabalho_id]),s.unidade_id?.length&&t.push(["unidade_id","==",s.unidade_id]),s.unidades_subordinadas&&t.push(["unidades_subordinadas","==",!0]),s.etiquetas?.length&&t.push(["etiquetas","in",s.etiquetas.map(f=>f.value)]),s.numero_processo?.length&&t.push(["numero_processo","==",s.numero_processo]),s.numero?.length&&t.push(["numero","==",s.numero]),s.status?.length&&!t.find(f=>"status"==f[0])&&(t.push(["status","==",s.status]),"ARQUIVADO"==s.status&&this.filter.controls.arquivadas.setValue(!0)),this.filter.controls.arquivadas.value||t.push(["data_arquivamento","==",null]),s.tipo_atividade_id?.length&&t.push(["tipo_atividade_id","==",s.tipo_atividade_id]),s.tipo_processo_id?.length&&t.push(["tipo_processo_id","==",s.tipo_processo_id]),s.plano_entrega_id?.length&&t.push(["plano_entrega_id","==",s.plano_entrega_id]),s.plano_entrega_entrega_id?.length&&t.push(["plano_entrega_entrega_id","==",s.plano_entrega_entrega_id]),s.data_filtro?.length){const f="DISTRIBUICAO"==s.data_filtro?"data_distribuicao":"PRAZO"==s.data_filtro?"data_estipulada_entrega":"data_entrega";s.data_inicio&&t.push([f,">=",s.data_inicio]),s.data_fim&&t.push([f,"<=",s.data_fim])}return t},this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.modalWidth=1100,this.filter=this.fh.FormBuilder({agrupar:{default:!0},agrupar_entrega:{default:!0},atribuidas_para_mim:{default:this.minhas},usuario_id:{default:null},numero:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},plano_trabalho_id:{default:null},unidade_id:{default:null},numero_processo:{default:""},status:{default:null},etiquetas:{default:[]},arquivadas:{default:!1},tipo_atividade_id:{default:null},tipo_processo_id:{default:null},data_filtro:{default:null},data_inicio:{default:null},data_fim:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({descricao:{default:""},tipo_atividade_id:{default:null},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.groupBy=[{field:"unidade.sigla",label:"Unidade"},{field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"},{field:"plano_trabalho_entrega.descricao",label:"Descri\xe7\xe3o dos trabalhos"}],this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngAfterViewInit(){if(super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.fixedFilter){const a=this.fixedFilter.find(i=>"status"==i[0]);a&&this.filter?.controls.status.setValue(a[2])}}onAgruparChange(a){const i=this.filter.controls.agrupar.value,t=this.filter.controls.agrupar_entrega.value,s=[];i&&s.push({field:"unidade.sigla",label:"Unidade"}),t&&s.push({field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"}),this.groupBy=s,this.grid.reloadFilter()}onStatusClick(a){this.filter?.controls.status.setValue(a.data?.status),this.grid.showFilter(),this.grid.reloadFilter()}onEtiquetaClick(a){let i=this.filter.controls.etiquetas.value;i.push(a),this.filter?.controls.etiquetas.setValue(i),this.grid.showFilter(),this.grid.reloadFilter()}onEntregaClick(a){this.go.navigate({route:["gestao","atividade",a.id,"hierarquia"]},{metadata:{atividade:a}})}onColumnProgressoEtiquetasChecklistEdit(a){var i=this;return(0,v.Z)(function*(){i.formEdit.controls.progresso.setValue(a.progresso),i.checklist=i.util.clone(a.checklist)})()}onColumnProgressoEtiquetasChecklistSave(a){var i=this;return(0,v.Z)(function*(){try{const t=yield i.dao.update(a.id,{progresso:i.formEdit.controls.progresso.value,checklist:i.checklist});return a.progresso=i.formEdit.controls.progresso.value,a.checklist=i.checklist,!!t}catch{return!1}})()}filterClear(a){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(null),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(null),this.filter.controls.plano_trabalho_id.setValue(null),this.filter.controls.numero_processo.setValue(""),this.filter.controls.atividade_id.setValue(null),this.filter.controls.tipo_processo_id.setValue(null),this.filter.controls.data_filtro.setValue(null),this.filter.controls.data_inicio.setValue(null),this.filter.controls.data_fim.setValue(null),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(i=>"status"==i[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(a)}addItemHandleEtiquetas(){let a;if(this.etiqueta&&this.etiqueta.selectedItem){const i=this.etiqueta.selectedItem,t=i.key?.length?i.key:this.util.textHash(i.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,t)&&(a={key:t,value:i.value,color:i.color,icon:i.icon},this.formEdit.controls.etiqueta.setValue(null))}return a}onColumnEtiquetasEdit(a){var i=this;return(0,v.Z)(function*(){if(!i.etiquetasAscendentes.filter(t=>t.data==a.unidade_id).length){i.loading=!0;let t=[];try{t=yield i.carregaEtiquetasUnidadesAscendentes(a.unidade)}finally{i.loading=!1}i.etiquetasAscendentes.push(...t)}i.formEdit.controls.etiquetas.setValue(a.etiquetas),i.formEdit.controls.etiqueta.setValue(null),i.etiquetas=i.util.merge(a.tipo_atividade?.etiquetas,a.unidade?.etiquetas,(t,s)=>t.key==s.key),i.etiquetas=i.util.merge(i.etiquetas,i.auth.usuario.config?.etiquetas,(t,s)=>t.key==s.key),i.etiquetas=i.util.merge(i.etiquetas,i.etiquetasAscendentes.filter(t=>t.data==a.unidade_id),(t,s)=>t.key==s.key)})()}carregaEtiquetasUnidadesAscendentes(a){var i=this;return(0,v.Z)(function*(){let t=[],s=a.path.split("/").filter(x=>x?.length);return(yield i.unidadeDao.query({where:[["id","in",s]]}).asPromise()).forEach(x=>{t=i.util.merge(t,x.etiquetas,(oe,Y)=>oe.key==Y.key)}),t.forEach(x=>x.data=a.id),t})()}onColumnEtiquetasSave(a){var i=this;return(0,v.Z)(function*(){try{const t=yield i.dao.update(a.id,{etiquetas:i.formEdit.controls.etiquetas.value});return a.etiquetas=i.formEdit.controls.etiquetas.value,!!t}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:a=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(i,t)=>i.key==t.key),this.cdRef.detectChanges()}})}onUnidadeChange(a){var i=this;return(0,v.Z)(function*(){let t=yield i.unidadeDao.getById(i.filter?.controls.unidade_id.value,["planos_entrega"]);i.planosEntregas=t?.planos_entrega?.map(s=>Object.assign({key:s.id,value:s.nome}))||[]})()}onPlanoEntregaChange(a){var i=this;return(0,v.Z)(function*(){let t=[];(yield i.unidadeDao.getById(i.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(f=>{f.id==i.filter.controls.plano_entrega_id.value&&t.push(f.entregas)}),i.planosEntregasEntregas=t[0].map(f=>Object.assign({key:f.id,value:f.descricao}))||[]})()}onColumnAtividadeDescricaoEdit(a){var i=this;return(0,v.Z)(function*(){i.formEdit.controls.descricao.setValue(a.descricao),i.formEdit.controls.tipo_atividade_id.setValue(a.tipo_atividade_id),i.formEdit.controls.comentarios.setValue(a.comentarios)})()}onColumnAtividadeDescricaoSave(a){var i=this;return(0,v.Z)(function*(){try{i.atividadeService.comentarioAtividade(i.tipoAtividade?.selectedEntity,i.formEdit.controls.comentarios);const t=yield i.dao.update(a.id,{descricao:i.formEdit.controls.descricao.value,tipo_atividade_id:i.formEdit.controls.tipo_atividade_id.value,comentarios:(i.formEdit.controls.comentarios.value||[]).filter(s=>["ADD","EDIT","DELETE"].includes(s._status||""))});return a.descricao=i.formEdit.controls.descricao.value,a.tipo_atividade_id=i.formEdit.controls.tipo_atividade_id.value,a.tipo_atividade=i.tipoAtividade?.selectedEntity||null,a.comentarios=i.formEdit.controls.comentarios.value,!!t}catch{return!1}})()}canEditColumn(a){return a.usuario_id==this.auth.usuario.id}static#t=this.\u0275fac=function(i){return new(i||c)(e.Y36(e.zs3))};static#i=this.\u0275cmp=e.Xpm({type:c,selectors:[["atividade-list-grid"]],viewQuery:function(i,t){if(1&i&&(e.Gf(U.M,5),e.Gf(M,5),e.Gf(Z,5),e.Gf(L,5),e.Gf(P,5),e.Gf(N,5),e.Gf(y,5),e.Gf(J,5)),2&i){let s;e.iGM(s=e.CRH())&&(t.grid=s.first),e.iGM(s=e.CRH())&&(t.calendarEfemerides=s.first),e.iGM(s=e.CRH())&&(t.unidade=s.first),e.iGM(s=e.CRH())&&(t.usuario=s.first),e.iGM(s=e.CRH())&&(t.tipoAtividade=s.first),e.iGM(s=e.CRH())&&(t.etiqueta=s.first),e.iGM(s=e.CRH())&&(t.planoEntrega=s.first),e.iGM(s=e.CRH())&&(t.planoEntregaEntrega=s.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.qOj],decls:73,vars:122,consts:[["calendarEfemerides",""],[3,"dao","add","form","hasEdit","hasDelete","orderBy","groupBy","join","loadList","selectable","groupTemplate","select"],["groupAtividades",""],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"size","control","change"],["label","Usu\xe1rio","controlName","usuario_id",3,"size","control","disabled","dao"],["usuario",""],["label","Plano de trabalho","controlName","plano_trabalho_id",3,"size","control","dao"],["planoTrabalho",""],["label","Atual","controlName","somente_unidade_atual",3,"size","control","labelInfo","change"],["label","Unidade","controlName","unidade_id",3,"size","control","disabled","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"size","label","valueTodos","control","items","change"],["planoEntrega",""],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["planoEntregaEntrega",""],["label","#ID","controlName","numero","maskFormat","999999",3,"size","control","labelInfo"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["label","Arq.","controlName","arquivadas",3,"size","control","labelInfo"],["controlName","tipo_atividade_id",3,"size","label","control","dao"],["controlName","tipo_processo_id",3,"size","label","control","dao"],["label","Data","itemTodos","- Todos -","controlName","data_filtro",3,"size","valueTodos","control","items"],["noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["noIcon","","label","Fim","controlName","data_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","editable","maxWidth","template","editTemplate","columnEditTemplate","edit","save"],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["columnAtividadeDescricaoEdit",""],[3,"title","editable","maxWidth","width","template","editTemplate","columnEditTemplate","edit","save"],["columnEtiquetas",""],["columnEtiquetasEdit",""],[3,"titleTemplate","template"],["titlePlanoTrabalho",""],["columnPlanoTrabalho",""],[3,"titleTemplate","template","maxWidth","editable"],["titleUnResponsavelDemandante",""],["columnPessoas",""],[3,"titleTemplate","template","width"],["titleTempos",""],["columnTempos",""],[3,"title","maxWidth","editable","columnEditTemplate","template","edit","save"],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],[3,"title","width","template"],["columnNumero",""],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options",4,"ngIf"],[3,"rows"],[3,"efemerides"],[1,"d-flex","ps-3"],[4,"ngFor","ngForOf"],[1,"me-3"],["labelPosition","left","label","Agrupar por Entrega","controlName","agrupar_entrega",3,"size","control","change"],["labelPosition","left","label","Agrupar por Unidade","controlName","agrupar",3,"size","control","change"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["columnTarefas",""],["columnExpandedTarefas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["persist","",3,"selectable","editable","atividade"],["by","numero",3,"header"],["by","plano_trabalho_entrega.descricao",3,"header"],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],["color","light",3,"icon","label",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["color","light",3,"icon","label"],["color","info","role","button",3,"icon","label","click"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["relativeId","columnTipoAtividade","controlName","tipo_atividade_id",3,"label","size","emptyValue","control","dao","labelInfo","required"],["tipoAtividade",""],[3,"lookup","click",4,"ngFor","ngForOf"],[3,"lookup","click"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],["class","d-block",4,"ngIf"],[1,"d-block"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["by","data_distribuicao",3,"header"],["by","data_estipulada_entrega",3,"header"],["by","data_entrega",3,"header"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["color","success",3,"value"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["scale","small",3,"size","source","path"],[3,"documento"],[3,"data","color","icon","label","click",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"data","color","icon","label","click"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options"]],template:function(i,t){if(1&i&&(e.YNc(0,Q,1,1,"ng-template",null,0,e.W1O),e.TgZ(2,"grid",1),e.NdJ("select",function(f){return t.onSelect(f)}),e.YNc(3,se,2,1,"ng-template",null,2,e.W1O),e.YNc(5,n,3,4,"toolbar",3),e.TgZ(6,"filter",4)(7,"div",5)(8,"input-switch",6),e.NdJ("change",function(f){return t.onAtribuidasParaMimChange(f)}),e.qZA(),e._UZ(9,"input-search",7,8)(11,"input-search",9,10),e.qZA(),e.TgZ(13,"div",5)(14,"input-switch",11),e.NdJ("change",function(f){return t.onSomenteUnidadeAtualChange(f)}),e.qZA(),e.TgZ(15,"input-search",12,13),e.NdJ("change",function(f){return t.onUnidadeChange(f)}),e.qZA(),e._UZ(17,"input-switch",14),e.TgZ(18,"input-select",15,16),e.NdJ("change",function(f){return t.onPlanoEntregaChange(f)}),e.qZA(),e._UZ(20,"input-select",17,18),e.qZA(),e.TgZ(22,"div",5),e._UZ(23,"input-text",19)(24,"input-text",20)(25,"input-select",21)(26,"input-multiselect",22)(27,"input-switch",23),e.qZA(),e.TgZ(28,"div",5),e._UZ(29,"input-search",24)(30,"input-search",25)(31,"input-select",26)(32,"input-datetime",27)(33,"input-datetime",28),e.qZA()(),e.TgZ(34,"columns"),e.YNc(35,m,5,4,"column",29),e.TgZ(36,"column",30),e.YNc(37,C,7,4,"ng-template",null,31,e.W1O),e.YNc(39,K,7,7,"ng-template",null,32,e.W1O),e.YNc(41,b,3,10,"ng-template",null,33,e.W1O),e.qZA(),e.TgZ(43,"column",34),e.YNc(44,d,1,1,"ng-template",null,35,e.W1O),e.YNc(46,h,3,6,"ng-template",null,36,e.W1O),e.qZA(),e.TgZ(48,"column",37),e.YNc(49,D,1,0,"ng-template",null,38,e.W1O),e.YNc(51,E,1,1,"ng-template",null,39,e.W1O),e.qZA(),e.TgZ(53,"column",40),e.YNc(54,k,6,3,"ng-template",null,41,e.W1O),e.YNc(56,G,4,6,"ng-template",null,42,e.W1O),e.qZA(),e.TgZ(58,"column",43),e.YNc(59,S,8,3,"ng-template",null,44,e.W1O),e.YNc(61,F,2,1,"ng-template",null,45,e.W1O),e.qZA(),e.TgZ(63,"column",46),e.YNc(64,H,3,3,"ng-template",null,47,e.W1O),e.YNc(66,ee,3,5,"ng-template",null,48,e.W1O),e.qZA(),e.TgZ(68,"column",49),e.YNc(69,ie,4,5,"ng-template",null,50,e.W1O),e.qZA(),e.YNc(71,ae,1,4,"column",51),e.qZA(),e._UZ(72,"pagination",52),e.qZA()),2&i){const s=e.MAs(4),f=e.MAs(38),x=e.MAs(40),oe=e.MAs(42),Y=e.MAs(45),ne=e.MAs(47),le=e.MAs(50),re=e.MAs(52),de=e.MAs(55),ue=e.MAs(57),ce=e.MAs(60),_e=e.MAs(62),he=e.MAs(65),pe=e.MAs(67),me=e.MAs(70);e.xp6(2),e.Q6J("dao",t.dao)("add",t.add)("form",t.formEdit)("hasEdit",!1)("hasDelete",!1)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("loadList",t.onGridLoad.bind(t))("selectable",t.selectable)("groupTemplate",s),e.xp6(3),e.Q6J("ngIf",!t.fixedFilter&&!t.selectable),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&!(null!=t.queryParams&&t.queryParams.filter)&&t.filterCollapsed),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.atribuidas_para_mim),e.xp6(1),e.Q6J("size",6)("control",t.filter.controls.usuario_id)("disabled",t.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",t.usuarioDao),e.xp6(2),e.Q6J("size",5)("control",t.filter.controls.plano_trabalho_id)("dao",t.planoTrabalhoDao),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.somente_unidade_atual)("labelInfo","Somente as "+t.lex.translate("atividades")+" da unidade selecionada"),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.unidade_id)("disabled",t.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.unidades_subordinadas),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_id)("items",t.planosEntregas),e.xp6(2),e.Q6J("size",3)("label",t.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_entrega_id)("items",t.planosEntregasEntregas),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.numero)("labelInfo","N\xfamero "+t.lex.translate("atividade")),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("label","N\xba "+t.lex.translate("Processo")+" (Sei)")("control",t.filter.controls.numero_processo),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("valueTodos",null)("disabled",null!=t.fixedFilter&&t.fixedFilter.length&&"status"==t.fixedFilter[0][0]?"true":void 0)("control",t.filter.controls.status)("items",t.lookup.ATIVIDADE_STATUS_COM_ARQUIVADAS),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.etiquetas),e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.arquivadas)("labelInfo","Listar tamb\xe9m "+t.lex.translate("atividades")+" arquivadas"),e.xp6(2),e.Q6J("size",3)("label","Tipo de "+t.lex.translate("Atividade"))("control",t.filter.controls.tipo_atividade_id)("dao",t.tipoAtividadeDao),e.xp6(1),e.Q6J("size",3)("label","Tipo de "+t.lex.translate("Processo"))("control",t.filter.controls.tipo_processo_id)("dao",t.tipoProcessoDao),e.xp6(1),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_fim),e.xp6(2),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("titleTemplate",f)("editable",t.canEditColumn.bind(t))("maxWidth",250)("template",x)("editTemplate",x)("columnEditTemplate",t.selectable?void 0:oe)("edit",t.selectable?void 0:t.onColumnAtividadeDescricaoEdit.bind(t))("save",t.selectable?void 0:t.onColumnAtividadeDescricaoSave.bind(t)),e.xp6(7),e.Q6J("title","Etiquetas")("editable",t.canEditColumn.bind(t))("maxWidth",300)("width",100)("template",Y)("editTemplate",Y)("columnEditTemplate",t.selectable?void 0:ne)("edit",t.selectable?void 0:t.onColumnEtiquetasEdit.bind(t))("save",t.selectable?void 0:t.onColumnEtiquetasSave.bind(t)),e.xp6(5),e.Q6J("titleTemplate",le)("template",re),e.xp6(5),e.Q6J("titleTemplate",de)("template",ue)("maxWidth",150)("editable",t.canEditColumn.bind(t)),e.xp6(5),e.Q6J("titleTemplate",ce)("template",_e)("width",250),e.xp6(5),e.Q6J("title","Progresso\nChecklist")("maxWidth",250)("editable",t.canEditColumn.bind(t))("columnEditTemplate",t.selectable?void 0:pe)("template",he)("edit",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistEdit.bind(t))("save",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistSave.bind(t)),e.xp6(5),e.Q6J("title","n\xba Processo/Status\nComent\xe1rios")("width",250)("template",me),e.xp6(3),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("rows",t.rowsLimit)}},styles:[".atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}"]})}},57338:(w,R,_)=>{_.d(R,{s:()=>I});var v=_(8239),U=_(11597),A=_(20755),e=_(39702),M=_(15908),Z=_(6551),L=_(2124),P=_(32333),N=_(49193),y=_(92307),J=_(15545),Q=_(84971);class I{constructor(n,r,l,p,m,C,T,q,K){this.lookup=n,this.lex=r,this.calendar=l,this.comentario=p,this.auth=m,this.util=C,this.go=T,this.dialog=q,this.dao=K,this.delete=(b,u)=>{this.dialog.confirm("Exclui ?","Deseja realmente excluir?").then(d=>{d&&this.dao.delete(u).then(()=>{b.removeId(u.id),this.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro","Erro ao excluir: "+(h?.message?h?.message:h)))})},this.cancelarInicio=(b,u)=>{this.dialog.confirm("Cancelar inicio ?","Deseja realmente cancelar a inicializa\xe7\xe3o?").then(d=>{d&&this.dao.cancelarInicio(u.id).then(()=>{b.refreshId(u.id),this.dialog.topAlert("Cancelado a inicializa\xe7\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",(h?.message,h?.message)))})},this.cancelarConclusao=(b,u)=>{this.dialog.confirm("Cancelar conclus\xe3o ?","Deseja realmente cancelar a conclus\xe3o?").then(d=>{d&&this.dao.cancelarConclusao(u.id).then(()=>{b.refreshId(u.id),this.dialog.topAlert("Cancelado a conclus\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",(h?.message,h?.message)))})},this.desarquivar=(b,u)=>{this.dao.arquivar(u.id,!1).then(()=>{b.refreshId(u.id)}).catch(d=>this.dialog.alert("Erro",(d?.message,d?.message)))},this.arquivar=(b,u)=>{this.dialog.confirm("Arquivar?","Deseja realmente arquivar a atividade?").then(d=>{d&&this.dao.arquivar(u.id,!0).then(()=>{b.refreshId(u.id)}).catch(h=>this.dialog.alert("Erro",(h?.message,h?.message)))})},this.dynamicOptions=(b,u)=>{let d=[],h=b;const D=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(c=>c.id).includes(this.auth.usuario?.id||""),O=this.auth.usuario?.id==h.demandante_id,E=this.auth.usuario?.id==h.usuario_id,k=this.lastConsolidacao(b.metadados?.consolidacoes),G={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"consult"]},{modal:!0})},S={label:"Coment\xe1rios",icon:"bi bi-chat-left-quote",onClick:c=>this.go.navigate({route:["uteis","comentarios","ATIVIDADE",c.id,"new"]},this.modalRefreshId(u,c))},B={label:"Clonar",icon:"bi bi-stickies",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"clonar"]},this.modalRefresh(u))},F={label:"Alterar atividade",icon:"bi bi-pencil-square",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"edit"]},this.modalRefreshId(u,c))},z={label:"Excluir atividade",icon:"bi bi-trash",onClick:this.delete.bind(this,u)},V={label:"Prorrogar prazo",icon:"bi bi-skip-end-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"prorrogar"]},this.modalRefreshId(u,c))},W={label:"Iniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"iniciar"]},this.modalRefreshId(u,c))},g={label:"Cancelar inicio",id:"NAOINICIADO",icon:"bi bi-backspace",onClick:this.cancelarInicio.bind(this,u)},H={label:"Alterar inicio",icon:"bi bi-play-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"iniciar"]},this.modalRefreshId(u,c))},j={label:"Pausar",id:"PAUSADO",icon:"bi bi-pause-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"pausar"]},this.modalRefreshId(u,c))},X={label:"Reiniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(u,c))},$={label:"Concluir",id:"CONCLUIDO",icon:"bi bi-check-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"concluir"]},this.modalRefreshId(u,c))},ee={label:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:c=>this.go.navigate({route:["gestao","atividade",c.id,"concluir"]},this.modalRefreshId(u,c))},te={label:"Cancelar conclus\xe3o",id:"INICIADO",icon:"bi bi-backspace",onClick:this.cancelarConclusao.bind(this,u)},ie={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,u)},ae={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,u)};return u?.disabled||(d.push(G),(E||D||O)&&d.push(S),d.push(B),h.metadados?.arquivado?(D||E)&&d.push(ae):h.metadados?.iniciado?h.metadados?.concluido?((D||E)&&d.push(ie),"CONCLUIDO"!=k?.status&&((E||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&d.push(ee),(E||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_CONCL"))&&(d.length&&d.push({divider:!0}),d.push(te)))):h.metadados?.iniciado&&(h.metadados?.pausado?(E||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(X):((E||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&d.push($),(E||this.auth.hasPermissionTo("MOD_DMD_USERS_PAUSA"))&&d.push(j),(!k||"INCLUIDO"==k?.status)&&((E||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_INICIAR"))&&d.push(g),(E||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(H))),(D||O||this.auth.hasPermissionTo("MOD_DMD_USERS_PPRZO"))&&d.push(V)):((E||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(W),(D||O||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT"))&&d.push(F),(D||O||this.auth.hasPermissionTo("MOD_DMD_USERS_EXCL")||this.auth.hasPermissionTo("MOD_DMD_NI_EXCL"))&&(d.length&&d.push({divider:!0}),d.push(z)))),d},this.dynamicButtons=(b,u)=>{let d=[],h=b;const D=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(g=>g.usuario_id).includes(this.auth.usuario?.id||""),O=this.auth.usuario?.id==h.usuario_id,E=this.lastConsolidacao(b.metadados?.consolidacoes),G={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"consult"]},{modal:!0})},S={hint:"Iniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"iniciar"]},this.modalRefreshId(u,g))},B={hint:"Reiniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(u,g))},F={hint:"Concluir",icon:"bi bi-check",color:"btn-outline-success",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"concluir"]},this.modalRefreshId(u,g))},z={hint:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,u)},V={hint:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,u)},W={hint:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"concluir"]},this.modalRefreshId(u,g))};return u?.disabled||(h.metadados?.iniciado?h.metadados?.concluido?D||O?d.push(h.metadados?.arquivado?V:z):"CONCLUIDO"!=E?.status&&(O||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&d.push(W):h.metadados?.iniciado&&(h.metadados?.pausado&&O?d.push(B):(O||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&d.push(F)):(O||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(S)),d.length||d.push(G),d}}getStatus(n,r){const l=n,p=this.lookup.ATIVIDADE_STATUS.find(q=>q.key==l.status)||{key:"DESCONHECIDO",value:"Desconhecido",icon:"bi bi-question-circle",color:"light"},m=this.util.setTime(r?.data_inicio||new Date,0,0,0),C=this.util.setTime(r?.data_fim||new Date,23,59,59);let T=[{data:{status:p.key,filter:!0},label:p.value,icon:p.icon,color:p.color}];return l.metadados?.atrasado&&T.push({data:{status:"ATRASADO",filter:!1},label:"Atrasado",icon:"bi bi-alarm",color:"danger"}),r&&(l.data_inicio&&this.util.asTimestamp(l.data_inicio)<this.util.asTimestamp(m)||l.data_entrega&&this.util.asTimestamp(l.data_entrega)>this.util.asTimestamp(C))&&T.push({data:{status:"EXTRAPOLADO",filter:!1},label:"Extrapolado",icon:"bi bi-arrow-left-right",color:"danger",hint:"Data de in\xedcio ou conclus\xe3o "+this.lex.translate("da Atividade")+" extrapola os da consolida\xe7\xe3o"}),l.metadados?.arquivado&&T.push({data:{status:"ARQUIVADO",filter:!1},label:"Arquivado",icon:"bi bi-inboxes",color:"danger"}),l.metadados&&JSON.stringify(l.metadados._status)!=JSON.stringify(T)&&(l.metadados._status=T),l.metadados?._status||T}temposAtividade(n,r,l){if(n.metadados&&n.metadados.extra?.lastUpdate!=this.auth.unidadeHora){let p=r?.planos_trabalho[n.plano_trabalho_id]||n.plano_trabalho,m=[{color:"light",hint:this.lex.translate("Data de distribui\xe7\xe3o"),icon:"bi bi-file-earmark-plus",label:this.dao.getDateTimeFormatted(n.data_distribuicao)},{color:"light",hint:this.lex.translate("Prazo de entrega"),icon:"bi bi-calendar-check",label:this.dao.getDateTimeFormatted(n.data_estipulada_entrega)}];if(p?.tipo_modalidade?.atividade_esforco&&m.push({color:"light",hint:this.lex.translate("Esfor\xe7o"),icon:"bi bi-stopwatch",label:n.esforco?this.util.decimalToTimerFormated(n.esforco,!0)+" "+this.lex.translate("esfor\xe7o"):"Sem "+this.lex.translate("esfor\xe7o")}),n.metadados.concluido&&m.push({color:"light",hint:"Data de entrega realizada",icon:"bi bi-check-circle",label:this.dao.getDateTimeFormatted(n.data_entrega)}),n.metadados.iniciado&&p?.tipo_modalidade?.atividade_tempo_despendido){const C=p?.carga_horaria||0,T=r?.afastamentos[n.usuario_id]||[],q=n.metadados.concluido?n.tempo_despendido||0:this.calendar.horasUteis(n.data_inicio,this.auth.hora,C,n.unidade,"ENTREGA",n.pausas,T);m.push({color:q>n.esforco?"warning":"light",hint:"Tempo despendido",icon:"bi bi-hourglass-split",label:this.util.decimalToTimerFormated(q,!0)+" despendido",click:n.metadados.concluido?void 0:l,data:n})}if(!n.metadados.concluido&&this.util.asTimestamp(n.data_estipulada_entrega)<this.auth.hora.getTime()){const C=this.calendar.horasAtraso(n.data_estipulada_entrega,n.unidade);m.push({color:"danger",hint:"Tempo de atraso",icon:"bi bi-alarm",label:this.util.decimalToTimerFormated(C,!0)+" atrasado"})}n.metadados.extra=n.metadados.extra||{},n.metadados.extra.lastUpdate=this.auth.unidadeHora,n.metadados.extra.tempos=m}return n.metadados?.extra?.tempos||[]}onIdClick(n){this.util.copyToClipboard(n.toString())}buildEtiquetas(n,r){return this.util.merge(r?.etiquetas,n?.etiquetas,(l,p)=>l.key==p.key)}buildChecklist(n,r){let l=this.util.merge((n?.checklist||[]).map(p=>({id:p.key,texto:p.value,checked:!1})),(r?.value||[]).filter(p=>p.checked),(p,m)=>p.id==m.id&&(p.checked=m.checked,!0));return r&&r.setValue(l),l}comentarioAtividade(n,r){let l=r?.value||[];const p=l.findIndex(m=>"TIPO_ATIVIDADE"==m.tipo);if(p>=0&&("ADD"==l[p]._status?l.splice(p,1):l[p]._status),n?.comentario?.length){const m=new U.Z;m.id=this.dao.generateUuid(),m.path="",m.texto=n.comentario,m.data_comentario=this.auth.hora,m.usuario_id=this.auth.usuario.id,m.comentario_id=null,m.tipo="TIPO_ATIVIDADE",m.usuario=this.auth.usuario,m._status="ADD",l.push(m),l=this.comentario.orderComentarios(l),r&&r.setValue(l)}}modalRefreshId(n,r){return{modal:!0,modalClose:(l=(0,v.Z)(function*(p){return n.refreshId(r.id)}),function(m){return l.apply(this,arguments)})};var l}modalRefresh(n){return{modal:!0,modalClose:n.refresh}}lastConsolidacao(n){return n?.reduce((r,l)=>!r||this.util.asTimestamp(l.data_conclusao)>this.util.asTimestamp(r.data_conclusao)?l:r,void 0)}static#e=this.\u0275fac=function(r){return new(r||I)(A.LFG(e.W),A.LFG(M.E),A.LFG(Z.o),A.LFG(L.K),A.LFG(P.e),A.LFG(N.f),A.LFG(y.o),A.LFG(J.x),A.LFG(Q.P))};static#t=this.\u0275prov=A.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"})}}}]);
=======
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[5557],{88543:(H,U,c)=>{c.d(U,{l:()=>k});var A=c(64368);class k extends A.X{constructor(e){super(),this.documento=null,this.comentarios=[],this.descricao=null,this.data_lancamento=new Date,this.tempo_estimado=0,this.data_conclusao=null,this.documento_id=null,this.atividade_id="",this.usuario_id="",this.tipo_tarefa_id=null,this.initialization(e)}}},94180:(H,U,c)=>{c.d(U,{x:()=>q});var A=c(78509),k=c(35255),E=c(81214),e=c(73101),I=c(79084),L=c(6551),P=c(84971),N=c(70361),y=c(2124),J=c(22981),G=c(57338),Q=c(87744);class q extends A.E{constructor(_){super(_,e.a,P.P),this.injector=_,this.etiquetas=[],this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.DATAS_FILTRO=[{key:"DISTRIBUICAO",value:"Distribui\xe7\xe3o",icon:"bi bi-file-earmark-plus",color:"badge rounded-pill bg-warning text-dark"},{key:"PRAZO",value:"Prazo",icon:"bi bi-calendar-check",color:"badge rounded-pill bg-info text-dark"},{key:"CONCLUSAO",value:"Conclus\xe3o",icon:"bi bi-check-circle",color:"badge rounded-pill bg-info text-dark"}],this.unidadeDao=_.get(E.J),this.usuarioDao=_.get(k.q),this.planoTrabalhoDao=_.get(Q.t),this.tipoAtividadeDao=_.get(J.Y),this.tipoProcessoDao=_.get(N.n),this.allPages=_.get(I.T),this.atividadeService=_.get(G.s),this.calendar=_.get(L.o),this.comentario=_.get(y.K),this.join=["tipo_atividade","plano_trabalho_entrega.plano_entrega_entrega:id,descricao","demandante","pausas","usuario","unidade","comentarios.usuario:id,nome,apelido","tarefas.tipo_tarefa","tarefas.comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.extra={planos_trabalho:{},afastamentos:{}},this.optionsMetadata={refreshId:(n=>(this.grid?.query||this.query).refreshId(n)).bind(this),removeId:(n=>(this.grid?.query||this.query).removeId(n)).bind(this),refresh:this.refresh.bind(this)}}onGridLoad(_){_?.forEach(l=>{l.comentarios=this.comentario.orderComentarios(l.comentarios)});const n=(this.grid?.query||this.query).extra;if(n){this.extra.planos_trabalho=Object.assign(this.extra.planos_trabalho,n.planos||{});for(let[l,u]of Object.entries(n.afastamentos||{}))this.extra.afastamentos[l]=u.reduce((m,f)=>(m.find(D=>D.id==f.id)||m.push(f),m),this.extra.afastamentos[l]||[]);Object.entries(n.feriados||{}).forEach(([l,u])=>{this.calendar.feriadosCadastrados[l]||(this.calendar.feriadosCadastrados[l]=u)}),_?.forEach(l=>{l.planoTrabalho=n.planos_trabalho[l.plano_trabalho_id]}),this.cdRef.detectChanges()}}onAtribuidasParaMimChange(_){this.filter.controls.atribuidas_para_mim.value?this.filter.controls.usuario_id.setValue(this.auth.usuario.id):this.filter.controls.usuario_id.setValue(void 0)}onSomenteUnidadeAtualChange(_){this.filter.controls.somente_unidade_atual.value?this.filter.controls.unidade_id.setValue(this.auth.unidade.id):this.filter.controls.unidade_id.setValue(void 0)}onDespendidoClick(_){if(_.metadados&&!_.metadados.concluido){const n=this.extra?.planos_trabalho[_.plano_trabalho_id]?.carga_horaria||0,l=this.extra?.afastamentos[_.usuario_id]||[];this.efemerides=this.calendar.calculaDataTempoUnidade(_.data_inicio,this.auth.hora,n,_.unidade,"ENTREGA",_.pausas,l),this.dialog.template({title:"C\xe1lculos do tempo despendido"},this.calendarEfemerides,[])}}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:_=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(n,l)=>n.key==l.key),this.cdRef.detectChanges()}})}comentarioClick(_){const n=_.getAttribute("data-expanded");_.setAttribute("data-expanded","true"==n?"false":"true")}addComentarioClick(_){this.go.navigate({route:["gestao","atividade",_.id,"comentar"]},{modal:!0,modalClose:n=>{n&&(this.grid?.query||this.query).refreshId(_.id)}})}}},48644:(H,U,c)=>{c.d(U,{N:()=>p});var I,A=c(8239),k=c(73150),E=c(94180),e=c(20755);const L=["calendarEfemerides"],P=["unidade"],N=["usuario"],y=["tipoAtividade"],J=["etiqueta"],G=["planoEntrega"],Q=["planoEntregaEntrega"];function q(o,a){if(1&o&&e._UZ(0,"calendar-efemerides",53),2&o){const t=e.oxw();e.Q6J("efemerides",t.efemerides)}}function S(o,a){if(1&o&&(e.ynx(0),e.TgZ(1,"label",56),e._uU(2),e.TgZ(3,"b"),e._uU(4),e.qZA()(),e.BQk()),2&o){const t=a.$implicit;e.xp6(2),e.hij("",t.label,": "),e.xp6(2),e.Oqu(t.value)}}function _(o,a){if(1&o&&(e.TgZ(0,"div",54),e.YNc(1,S,5,2,"ng-container",55),e.qZA()),2&o){const t=a.group;e.xp6(1),e.Q6J("ngForOf",t)}}function n(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"toolbar")(1,"input-switch",57),e.NdJ("change",function(s){e.CHM(t);const b=e.oxw();return e.KtG(b.onAgruparChange(s))}),e.qZA(),e.TgZ(2,"input-switch",58),e.NdJ("change",function(s){e.CHM(t);const b=e.oxw();return e.KtG(b.onAgruparChange(s))}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.agrupar_entrega),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.agrupar)}}function l(o,a){if(1&o&&(e.TgZ(0,"span",63),e._UZ(1,"i",64),e._uU(2),e.qZA()),2&o){const t=e.oxw().row;e.xp6(2),e.hij(" ",null==t.tarefas?null:t.tarefas.length,"")}}function u(o,a){if(1&o&&e.YNc(0,l,3,1,"span",62),2&o){const t=a.row;e.Q6J("ngIf",null==t.tarefas?null:t.tarefas.length)}}function m(o,a){if(1&o&&e._UZ(0,"atividade-list-tarefa",65),2&o){const t=a.row,i=e.oxw(2);e.Q6J("selectable",i.selectable)("editable",!t.metadados.concluido)("atividade",t)}}function f(o,a){if(1&o&&(e.TgZ(0,"column",59),e.YNc(1,u,1,1,"ng-template",null,60,e.W1O),e.YNc(3,m,1,3,"ng-template",null,61,e.W1O),e.qZA()),2&o){const t=e.MAs(2),i=e.MAs(4),s=e.oxw();e.Q6J("align","center")("hint","Tarefas da "+s.lex.translate("atividade"))("template",t)("expandTemplate",i)}}function D(o,a){if(1&o&&(e.TgZ(0,"order",66),e._uU(1,"#ID"),e.qZA(),e._uU(2),e.TgZ(3,"order",67),e._uU(4),e.qZA(),e._UZ(5,"br"),e._uU(6," Descri\xe7\xe3o ")),2&o){const t=a.header,i=e.oxw();e.Q6J("header",t),e.xp6(2),e.hij("/Tipo de ",i.lex.translate("Atividade"),"/ "),e.xp6(1),e.Q6J("header",t),e.xp6(1),e.Oqu(i.lex.translate("Entrega"))}}function C(o,a){if(1&o&&e._UZ(0,"badge",74),2&o){const t=e.oxw().row,i=e.oxw();e.Q6J("icon",i.entityService.getIcon("TipoAtividade"))("label",t.tipo_atividade.nome)}}function R(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"badge",75),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().row,b=e.oxw();return e.KtG(b.onEntregaClick(s))}),e.qZA()}if(2&o){const t=e.oxw().row,i=e.oxw();e.Q6J("icon",i.entityService.getIcon("Entrega"))("label",t.plano_trabalho_entrega.descricao)}}function j(o,a){if(1&o&&(e.TgZ(0,"span",68),e._UZ(1,"badge",69),e.YNc(2,C,1,2,"badge",70),e.YNc(3,R,1,2,"badge",71),e.qZA(),e.TgZ(4,"span",72),e._uU(5),e.qZA(),e._UZ(6,"reaction",73)),2&o){const t=a.row,i=e.oxw();e.xp6(1),e.Q6J("label",t.numero)("data",t.numero)("click",i.atividadeService.onIdClick.bind(i)),e.xp6(1),e.Q6J("ngIf",t.tipo_atividade),e.xp6(1),e.Q6J("ngIf",t.plano_trabalho_entrega),e.xp6(2),e.Oqu(t.descricao),e.xp6(1),e.Q6J("entity",t)}}function v(o,a){if(1&o&&e._UZ(0,"input-textarea",76)(1,"input-search",77,78),2&o){const t=e.oxw();e.Q6J("size",12)("rows",2)("control",t.formEdit.controls.descricao),e.xp6(1),e.Q6J("label","Tipo de "+t.lex.translate("atividade"))("size",12)("emptyValue",null)("control",t.formEdit.controls.tipo_atividade_id)("dao",t.tipoAtividadeDao)("labelInfo","Tipo de "+t.lex.translate("atividade")+" utilizado para classificar a "+t.lex.translate("atividade"))("required",t.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true")}}function d(o,a){if(1&o&&e._UZ(0,"badge",80),2&o){const t=a.$implicit,i=e.oxw(2);e.Q6J("lookup",t)("click",i.onEtiquetaClick.bind(i))}}function r(o,a){if(1&o&&e.YNc(0,d,1,2,"badge",79),2&o){const t=a.row;e.Q6J("ngForOf",t.etiquetas)}}function h(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"input-multiselect",81)(1,"input-select",82,83),e.NdJ("details",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onEtiquetaConfigClick())}),e.qZA()()}if(2&o){const t=e.oxw();e.Q6J("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),e.xp6(1),e.Q6J("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function x(o,a){1&o&&e._uU(0," Plano de trabalho ")}function O(o,a){if(1&o&&(e.TgZ(0,"span",85),e._uU(1),e._UZ(2,"br"),e._uU(3),e.qZA()),2&o){const t=e.oxw().row,i=e.oxw();e.xp6(1),e.hij("",i.dao.getDateFormatted(t.planoTrabalho.data_inicio)," "),e.xp6(2),e.Oqu(" at\xe9 "+i.dao.getDateFormatted(t.planoTrabalho.data_fim))}}function T(o,a){if(1&o&&e.YNc(0,O,4,2,"span",84),2&o){const t=a.row;e.Q6J("ngIf",t.planoTrabalho)}}function Z(o,a){if(1&o&&(e._uU(0," Un./"),e.TgZ(1,"order",86),e._uU(2),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",87),e._uU(5,"Demandante"),e.qZA()),2&o){const t=a.header,i=e.oxw();e.xp6(1),e.Q6J("header",t),e.xp6(1),e.Oqu(i.lex.translate("Respons\xe1vel")),e.xp6(2),e.Q6J("header",t)}}function B(o,a){if(1&o&&(e.TgZ(0,"div",88),e._UZ(1,"badge",89)(2,"badge",90),e.qZA(),e._UZ(3,"badge",91)),2&o){const t=a.row,i=e.oxw();e.xp6(1),e.Q6J("label",t.unidade.sigla),e.xp6(1),e.Q6J("icon","bi "+(null!=t.usuario&&null!=t.usuario.nome&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",i.util.apelidoOuNome(t.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==t.usuario?null:t.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.xp6(1),e.Q6J("label",i.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==t.demandante?null:t.demandante.nome)||"Desconhecido"))}}function F(o,a){if(1&o&&(e._uU(0," Tempos "),e.TgZ(1,"order",92),e._uU(2,"Distribui\xe7\xe3o"),e.qZA(),e._UZ(3,"br"),e.TgZ(4,"order",93),e._uU(5,"Prazo"),e.qZA(),e.TgZ(6,"order",94),e._uU(7,"Entrega"),e.qZA()),2&o){const t=a.header;e.xp6(1),e.Q6J("header",t),e.xp6(3),e.Q6J("header",t),e.xp6(2),e.Q6J("header",t)}}function z(o,a){if(1&o&&e._UZ(0,"badge",97),2&o){const t=a.$implicit;e.Q6J("badge",t)}}function V(o,a){if(1&o&&(e.TgZ(0,"div",95),e.YNc(1,z,1,1,"badge",96),e.qZA()),2&o){const t=a.row,i=e.oxw();e.xp6(1),e.Q6J("ngForOf",i.atividadeService.temposAtividade(t,i.extra,i.onDespendidoClick.bind(i)))}}function W(o,a){1&o&&e._UZ(0,"separator",100)}function Y(o,a){1&o&&e._UZ(0,"i",103)}function w(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,Y,1,0,"i",101),e.qZA(),e.TgZ(3,"td",102),e._uU(4),e.qZA()()),2&o){const t=a.$implicit;e.xp6(2),e.Q6J("ngIf",t.checked),e.xp6(2),e.Oqu(t.texto)}}function g(o,a){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,w,5,2,"tr",55),e.qZA()),2&o){const t=e.oxw().row;e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function X(o,a){if(1&o&&(e._UZ(0,"progress-bar",98),e.YNc(1,W,1,0,"separator",99),e.YNc(2,g,2,1,"table",3)),2&o){const t=a.row;e.Q6J("value",t.progresso),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function $(o,a){1&o&&e._UZ(0,"separator",100)}function ee(o,a){if(1&o&&(e.TgZ(0,"tr")(1,"td"),e._UZ(2,"input-switch",105),e.qZA(),e.TgZ(3,"td",102),e._uU(4),e.qZA()()),2&o){const t=a.$implicit,i=a.index,s=e.oxw(3);e.xp6(2),e.Q6J("size",12)("source",s.checklist)("path",i+".checked"),e.xp6(2),e.Oqu(t.texto)}}function te(o,a){if(1&o&&(e.TgZ(0,"table"),e.YNc(1,ee,5,4,"tr",55),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",t.checklist)}}function ie(o,a){if(1&o&&(e._UZ(0,"input-number",104),e.YNc(1,$,1,0,"separator",99),e.YNc(2,te,2,1,"table",3)),2&o){const t=a.row,i=e.oxw();e.Q6J("size",12)("decimals",2)("control",i.formEdit.controls.progresso),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function ae(o,a){if(1&o&&e._UZ(0,"badge",109),2&o){const t=a.$implicit,i=e.oxw(2);e.Q6J("data",t)("color",t.color)("icon",t.icon)("label",t.label)("click",null!=t.data&&t.data.filter?i.onStatusClick.bind(i):void 0)}}function oe(o,a){if(1&o&&(e._UZ(0,"documentos-badge",106),e.TgZ(1,"span",85),e.YNc(2,ae,1,5,"badge",107),e.qZA(),e._UZ(3,"comentarios-widget",108)),2&o){const t=a.row,i=e.oxw();e.Q6J("documento",t.documento_requisicao),e.xp6(2),e.Q6J("ngForOf",i.atividadeService.getStatus(t)),e.xp6(1),e.Q6J("entity",t)("selectable",i.selectable)("grid",i.grid)}}function se(o,a){if(1&o&&e._UZ(0,"column",110),2&o){const t=e.oxw();e.Q6J("metadata",t.optionsMetadata)("dynamicOptions",t.atividadeService.dynamicOptions.bind(t))("dynamicButtons",t.atividadeService.dynamicButtons.bind(t))("options",t.options)}}class p extends E.x{constructor(a){super(a),this.injector=a,this.minhas=!1,this.planosEntregas=[],this.planosEntregasEntregas=[],this.etiquetasAscendentes=[],this.storeFilter=t=>{const i=t?.value;return{atribuidas_para_mim:i.atribuidas_para_mim,usuario_id:i.usuario_id,plano_trabalho_id:i.plano_trabalho_id,somente_unidade_atual:i.somente_unidade_atual,unidades_subordinadas:i.unidades_subordinadas,unidade_id:i.somente_unidade_atual?null:i.unidade_id}},this.filterWhere=t=>{let i=this.fixedFilter||[],s=t.value;if(s.somente_unidade_atual&&s.unidade_id!=this.auth.unidade?.id&&(t.controls.unidade_id.setValue(this.auth.unidade?.id),s.unidade_id=this.auth.unidade?.id),s.atribuidas_para_mim&&s.usuario_id!=this.auth.usuario?.id&&(t.controls.usuario_id.setValue(this.auth.usuario?.id),s.usuario_id=this.auth.usuario.id),s.usuario_id&&s.usuario_id.length&&i.push(["usuario_id","==",s.usuario_id]),s.plano_trabalho_id?.length&&i.push(["plano_trabalho_id","==",s.plano_trabalho_id]),s.unidade_id?.length&&i.push(["unidade_id","==",s.unidade_id]),s.unidades_subordinadas&&i.push(["unidades_subordinadas","==",!0]),s.etiquetas?.length&&i.push(["etiquetas","in",s.etiquetas.map(b=>b.value)]),s.numero_processo?.length&&i.push(["numero_processo","==",s.numero_processo]),s.numero?.length&&i.push(["numero","==",s.numero]),s.status?.length&&!i.find(b=>"status"==b[0])&&(i.push(["status","==",s.status]),"ARQUIVADO"==s.status&&this.filter.controls.arquivadas.setValue(!0)),this.filter.controls.arquivadas.value||i.push(["data_arquivamento","==",null]),s.tipo_atividade_id?.length&&i.push(["tipo_atividade_id","==",s.tipo_atividade_id]),s.tipo_processo_id?.length&&i.push(["tipo_processo_id","==",s.tipo_processo_id]),s.plano_entrega_id?.length&&i.push(["plano_entrega_id","==",s.plano_entrega_id]),s.plano_entrega_entrega_id?.length&&i.push(["plano_entrega_entrega_id","==",s.plano_entrega_entrega_id]),s.data_filtro?.length){const b="DISTRIBUICAO"==s.data_filtro?"data_distribuicao":"PRAZO"==s.data_filtro?"data_estipulada_entrega":"data_entrega";s.data_inicio&&i.push([b,">=",s.data_inicio]),s.data_fim&&i.push([b,"<=",s.data_fim])}return i},this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.modalWidth=1100,this.filter=this.fh.FormBuilder({agrupar:{default:!0},agrupar_entrega:{default:!0},atribuidas_para_mim:{default:this.minhas},usuario_id:{default:null},numero:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},plano_trabalho_id:{default:null},unidade_id:{default:null},numero_processo:{default:""},status:{default:null},etiquetas:{default:[]},arquivadas:{default:!1},tipo_atividade_id:{default:null},tipo_processo_id:{default:null},data_filtro:{default:null},data_inicio:{default:null},data_fim:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({descricao:{default:""},tipo_atividade_id:{default:null},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.groupBy=[{field:"unidade.sigla",label:"Unidade"},{field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"},{field:"plano_trabalho_entrega.descricao",label:"Descri\xe7\xe3o dos trabalhos"}],this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngAfterViewInit(){if(super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.fixedFilter){const a=this.fixedFilter.find(t=>"status"==t[0]);a&&this.filter?.controls.status.setValue(a[2])}}onAgruparChange(a){const t=this.filter.controls.agrupar.value,i=this.filter.controls.agrupar_entrega.value,s=[];t&&s.push({field:"unidade.sigla",label:"Unidade"}),i&&s.push({field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"}),this.groupBy=s,this.grid.reloadFilter()}onStatusClick(a){this.filter?.controls.status.setValue(a.data?.status),this.grid.showFilter(),this.grid.reloadFilter()}onEtiquetaClick(a){let t=this.filter.controls.etiquetas.value;t.push(a),this.filter?.controls.etiquetas.setValue(t),this.grid.showFilter(),this.grid.reloadFilter()}onEntregaClick(a){this.go.navigate({route:["gestao","atividade",a.id,"hierarquia"]},{metadata:{atividade:a}})}onColumnProgressoEtiquetasChecklistEdit(a){var t=this;return(0,A.Z)(function*(){t.formEdit.controls.progresso.setValue(a.progresso),t.checklist=t.util.clone(a.checklist)})()}onColumnProgressoEtiquetasChecklistSave(a){var t=this;return(0,A.Z)(function*(){try{const i=yield t.dao.update(a.id,{progresso:t.formEdit.controls.progresso.value,checklist:t.checklist});return a.progresso=t.formEdit.controls.progresso.value,a.checklist=t.checklist,!!i}catch{return!1}})()}filterClear(a){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(null),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(null),this.filter.controls.plano_trabalho_id.setValue(null),this.filter.controls.numero_processo.setValue(""),this.filter.controls.atividade_id.setValue(null),this.filter.controls.tipo_processo_id.setValue(null),this.filter.controls.data_filtro.setValue(null),this.filter.controls.data_inicio.setValue(null),this.filter.controls.data_fim.setValue(null),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(t=>"status"==t[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(a)}addItemHandleEtiquetas(){let a;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,i=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,i)&&(a={key:i,value:t.value,color:t.color,icon:t.icon},this.formEdit.controls.etiqueta.setValue(null))}return a}onColumnEtiquetasEdit(a){var t=this;return(0,A.Z)(function*(){if(!t.etiquetasAscendentes.filter(i=>i.data==a.unidade_id).length){t.loading=!0;let i=[];try{i=yield t.carregaEtiquetasUnidadesAscendentes(a.unidade)}finally{t.loading=!1}t.etiquetasAscendentes.push(...i)}t.formEdit.controls.etiquetas.setValue(a.etiquetas),t.formEdit.controls.etiqueta.setValue(null),t.etiquetas=t.util.merge(a.tipo_atividade?.etiquetas,a.unidade?.etiquetas,(i,s)=>i.key==s.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(i,s)=>i.key==s.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(i=>i.data==a.unidade_id),(i,s)=>i.key==s.key)})()}carregaEtiquetasUnidadesAscendentes(a){var t=this;return(0,A.Z)(function*(){let i=[],s=a.path.split("/").filter(M=>M?.length);return(yield t.unidadeDao.query({where:[["id","in",s]]}).asPromise()).forEach(M=>{i=t.util.merge(i,M.etiquetas,(K,ne)=>K.key==ne.key)}),i.forEach(M=>M.data=a.id),i})()}onColumnEtiquetasSave(a){var t=this;return(0,A.Z)(function*(){try{const i=yield t.dao.update(a.id,{etiquetas:t.formEdit.controls.etiquetas.value});return a.etiquetas=t.formEdit.controls.etiquetas.value,!!i}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:a=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,i)=>t.key==i.key),this.cdRef.detectChanges()}})}onUnidadeChange(a){var t=this;return(0,A.Z)(function*(){let i=yield t.unidadeDao.getById(t.filter?.controls.unidade_id.value,["planos_entrega"]);t.planosEntregas=i?.planos_entrega?.map(s=>Object.assign({key:s.id,value:s.nome}))||[]})()}onPlanoEntregaChange(a){var t=this;return(0,A.Z)(function*(){let i=[];(yield t.unidadeDao.getById(t.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(b=>{b.id==t.filter.controls.plano_entrega_id.value&&i.push(b.entregas)}),t.planosEntregasEntregas=i[0].map(b=>Object.assign({key:b.id,value:b.descricao}))||[]})()}onColumnAtividadeDescricaoEdit(a){var t=this;return(0,A.Z)(function*(){t.formEdit.controls.descricao.setValue(a.descricao),t.formEdit.controls.tipo_atividade_id.setValue(a.tipo_atividade_id),t.formEdit.controls.comentarios.setValue(a.comentarios)})()}onColumnAtividadeDescricaoSave(a){var t=this;return(0,A.Z)(function*(){try{t.atividadeService.comentarioAtividade(t.tipoAtividade?.selectedEntity,t.formEdit.controls.comentarios);const i=yield t.dao.update(a.id,{descricao:t.formEdit.controls.descricao.value,tipo_atividade_id:t.formEdit.controls.tipo_atividade_id.value,comentarios:(t.formEdit.controls.comentarios.value||[]).filter(s=>["ADD","EDIT","DELETE"].includes(s._status||""))});return a.descricao=t.formEdit.controls.descricao.value,a.tipo_atividade_id=t.formEdit.controls.tipo_atividade_id.value,a.tipo_atividade=t.tipoAtividade?.selectedEntity||null,a.comentarios=t.formEdit.controls.comentarios.value,!!i}catch{return!1}})()}canEditColumn(a){return a.usuario_id==this.auth.usuario.id}}(I=p).selectRoute={route:["gestao","atividade","grid"]},I.\u0275fac=function(a){return new(a||I)(e.Y36(e.zs3))},I.\u0275cmp=e.Xpm({type:I,selectors:[["atividade-list-grid"]],viewQuery:function(a,t){if(1&a&&(e.Gf(k.M,5),e.Gf(L,5),e.Gf(P,5),e.Gf(N,5),e.Gf(y,5),e.Gf(J,5),e.Gf(G,5),e.Gf(Q,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.grid=i.first),e.iGM(i=e.CRH())&&(t.calendarEfemerides=i.first),e.iGM(i=e.CRH())&&(t.unidade=i.first),e.iGM(i=e.CRH())&&(t.usuario=i.first),e.iGM(i=e.CRH())&&(t.tipoAtividade=i.first),e.iGM(i=e.CRH())&&(t.etiqueta=i.first),e.iGM(i=e.CRH())&&(t.planoEntrega=i.first),e.iGM(i=e.CRH())&&(t.planoEntregaEntrega=i.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.qOj],decls:73,vars:122,consts:[["calendarEfemerides",""],[3,"dao","add","form","hasEdit","hasDelete","orderBy","groupBy","join","loadList","selectable","groupTemplate","select"],["groupAtividades",""],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"size","control","change"],["label","Usu\xe1rio","controlName","usuario_id",3,"size","control","disabled","dao"],["usuario",""],["label","Plano de trabalho","controlName","plano_trabalho_id",3,"size","control","dao"],["planoTrabalho",""],["label","Atual","controlName","somente_unidade_atual",3,"size","control","labelInfo","change"],["label","Unidade","controlName","unidade_id",3,"size","control","disabled","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"size","label","valueTodos","control","items","change"],["planoEntrega",""],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["planoEntregaEntrega",""],["label","#ID","controlName","numero","maskFormat","999999",3,"size","control","labelInfo"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["label","Arq.","controlName","arquivadas",3,"size","control","labelInfo"],["controlName","tipo_atividade_id",3,"size","label","control","dao"],["controlName","tipo_processo_id",3,"size","label","control","dao"],["label","Data","itemTodos","- Todos -","controlName","data_filtro",3,"size","valueTodos","control","items"],["noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["noIcon","","label","Fim","controlName","data_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","editable","maxWidth","template","editTemplate","columnEditTemplate","edit","save"],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["columnAtividadeDescricaoEdit",""],[3,"title","editable","maxWidth","width","template","editTemplate","columnEditTemplate","edit","save"],["columnEtiquetas",""],["columnEtiquetasEdit",""],[3,"titleTemplate","template"],["titlePlanoTrabalho",""],["columnPlanoTrabalho",""],[3,"titleTemplate","template","maxWidth","editable"],["titleUnResponsavelDemandante",""],["columnPessoas",""],[3,"titleTemplate","template","width"],["titleTempos",""],["columnTempos",""],[3,"title","maxWidth","editable","columnEditTemplate","template","edit","save"],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],[3,"title","width","template"],["columnNumero",""],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options",4,"ngIf"],[3,"rows"],[3,"efemerides"],[1,"d-flex","ps-3"],[4,"ngFor","ngForOf"],[1,"me-3"],["labelPosition","left","label","Agrupar por Entrega","controlName","agrupar_entrega",3,"size","control","change"],["labelPosition","left","label","Agrupar por Unidade","controlName","agrupar",3,"size","control","change"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["columnTarefas",""],["columnExpandedTarefas",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["persist","",3,"selectable","editable","atividade"],["by","numero",3,"header"],["by","plano_trabalho_entrega.descricao",3,"header"],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],["color","light",3,"icon","label",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["color","light",3,"icon","label"],["color","info","role","button",3,"icon","label","click"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["relativeId","columnTipoAtividade","controlName","tipo_atividade_id",3,"label","size","emptyValue","control","dao","labelInfo","required"],["tipoAtividade",""],[3,"lookup","click",4,"ngFor","ngForOf"],[3,"lookup","click"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],["class","d-block",4,"ngIf"],[1,"d-block"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["by","data_distribuicao",3,"header"],["by","data_estipulada_entrega",3,"header"],["by","data_entrega",3,"header"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["color","success",3,"value"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["scale","small",3,"size","source","path"],[3,"documento"],[3,"data","color","icon","label","click",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"data","color","icon","label","click"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options"]],template:function(a,t){if(1&a&&(e.YNc(0,q,1,1,"ng-template",null,0,e.W1O),e.TgZ(2,"grid",1),e.NdJ("select",function(s){return t.onSelect(s)}),e.YNc(3,_,2,1,"ng-template",null,2,e.W1O),e.YNc(5,n,3,4,"toolbar",3),e.TgZ(6,"filter",4)(7,"div",5)(8,"input-switch",6),e.NdJ("change",function(s){return t.onAtribuidasParaMimChange(s)}),e.qZA(),e._UZ(9,"input-search",7,8)(11,"input-search",9,10),e.qZA(),e.TgZ(13,"div",5)(14,"input-switch",11),e.NdJ("change",function(s){return t.onSomenteUnidadeAtualChange(s)}),e.qZA(),e.TgZ(15,"input-search",12,13),e.NdJ("change",function(s){return t.onUnidadeChange(s)}),e.qZA(),e._UZ(17,"input-switch",14),e.TgZ(18,"input-select",15,16),e.NdJ("change",function(s){return t.onPlanoEntregaChange(s)}),e.qZA(),e._UZ(20,"input-select",17,18),e.qZA(),e.TgZ(22,"div",5),e._UZ(23,"input-text",19)(24,"input-text",20)(25,"input-select",21)(26,"input-multiselect",22)(27,"input-switch",23),e.qZA(),e.TgZ(28,"div",5),e._UZ(29,"input-search",24)(30,"input-search",25)(31,"input-select",26)(32,"input-datetime",27)(33,"input-datetime",28),e.qZA()(),e.TgZ(34,"columns"),e.YNc(35,f,5,4,"column",29),e.TgZ(36,"column",30),e.YNc(37,D,7,4,"ng-template",null,31,e.W1O),e.YNc(39,j,7,7,"ng-template",null,32,e.W1O),e.YNc(41,v,3,10,"ng-template",null,33,e.W1O),e.qZA(),e.TgZ(43,"column",34),e.YNc(44,r,1,1,"ng-template",null,35,e.W1O),e.YNc(46,h,3,6,"ng-template",null,36,e.W1O),e.qZA(),e.TgZ(48,"column",37),e.YNc(49,x,1,0,"ng-template",null,38,e.W1O),e.YNc(51,T,1,1,"ng-template",null,39,e.W1O),e.qZA(),e.TgZ(53,"column",40),e.YNc(54,Z,6,3,"ng-template",null,41,e.W1O),e.YNc(56,B,4,6,"ng-template",null,42,e.W1O),e.qZA(),e.TgZ(58,"column",43),e.YNc(59,F,8,3,"ng-template",null,44,e.W1O),e.YNc(61,V,2,1,"ng-template",null,45,e.W1O),e.qZA(),e.TgZ(63,"column",46),e.YNc(64,X,3,3,"ng-template",null,47,e.W1O),e.YNc(66,ie,3,5,"ng-template",null,48,e.W1O),e.qZA(),e.TgZ(68,"column",49),e.YNc(69,oe,4,5,"ng-template",null,50,e.W1O),e.qZA(),e.YNc(71,se,1,4,"column",51),e.qZA(),e._UZ(72,"pagination",52),e.qZA()),2&a){const i=e.MAs(4),s=e.MAs(38),b=e.MAs(40),M=e.MAs(42),K=e.MAs(45),ne=e.MAs(47),le=e.MAs(50),re=e.MAs(52),de=e.MAs(55),ue=e.MAs(57),ce=e.MAs(60),_e=e.MAs(62),he=e.MAs(65),pe=e.MAs(67),me=e.MAs(70);e.xp6(2),e.Q6J("dao",t.dao)("add",t.add)("form",t.formEdit)("hasEdit",!1)("hasDelete",!1)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("loadList",t.onGridLoad.bind(t))("selectable",t.selectable)("groupTemplate",i),e.xp6(3),e.Q6J("ngIf",!t.fixedFilter&&!t.selectable),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&!(null!=t.queryParams&&t.queryParams.filter)&&t.filterCollapsed),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.atribuidas_para_mim),e.xp6(1),e.Q6J("size",6)("control",t.filter.controls.usuario_id)("disabled",t.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",t.usuarioDao),e.xp6(2),e.Q6J("size",5)("control",t.filter.controls.plano_trabalho_id)("dao",t.planoTrabalhoDao),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.somente_unidade_atual)("labelInfo","Somente as "+t.lex.translate("atividades")+" da unidade selecionada"),e.xp6(1),e.Q6J("size",3)("control",t.filter.controls.unidade_id)("disabled",t.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.unidades_subordinadas),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_id)("items",t.planosEntregas),e.xp6(2),e.Q6J("size",3)("label",t.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_entrega_id)("items",t.planosEntregasEntregas),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.numero)("labelInfo","N\xfamero "+t.lex.translate("atividade")),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("label","N\xba "+t.lex.translate("Processo")+" (Sei)")("control",t.filter.controls.numero_processo),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("valueTodos",null)("disabled",null!=t.fixedFilter&&t.fixedFilter.length&&"status"==t.fixedFilter[0][0]?"true":void 0)("control",t.filter.controls.status)("items",t.lookup.ATIVIDADE_STATUS_COM_ARQUIVADAS),e.xp6(1),e.Q6J("size",4)("control",t.filter.controls.etiquetas),e.xp6(1),e.Q6J("size",1)("control",t.filter.controls.arquivadas)("labelInfo","Listar tamb\xe9m "+t.lex.translate("atividades")+" arquivadas"),e.xp6(2),e.Q6J("size",3)("label","Tipo de "+t.lex.translate("Atividade"))("control",t.filter.controls.tipo_atividade_id)("dao",t.tipoAtividadeDao),e.xp6(1),e.Q6J("size",3)("label","Tipo de "+t.lex.translate("Processo"))("control",t.filter.controls.tipo_processo_id)("dao",t.tipoProcessoDao),e.xp6(1),e.Q6J("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_inicio),e.xp6(1),e.Q6J("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_fim),e.xp6(2),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("titleTemplate",s)("editable",t.canEditColumn.bind(t))("maxWidth",250)("template",b)("editTemplate",b)("columnEditTemplate",t.selectable?void 0:M)("edit",t.selectable?void 0:t.onColumnAtividadeDescricaoEdit.bind(t))("save",t.selectable?void 0:t.onColumnAtividadeDescricaoSave.bind(t)),e.xp6(7),e.Q6J("title","Etiquetas")("editable",t.canEditColumn.bind(t))("maxWidth",300)("width",100)("template",K)("editTemplate",K)("columnEditTemplate",t.selectable?void 0:ne)("edit",t.selectable?void 0:t.onColumnEtiquetasEdit.bind(t))("save",t.selectable?void 0:t.onColumnEtiquetasSave.bind(t)),e.xp6(5),e.Q6J("titleTemplate",le)("template",re),e.xp6(5),e.Q6J("titleTemplate",de)("template",ue)("maxWidth",150)("editable",t.canEditColumn.bind(t)),e.xp6(5),e.Q6J("titleTemplate",ce)("template",_e)("width",250),e.xp6(5),e.Q6J("title","Progresso\nChecklist")("maxWidth",250)("editable",t.canEditColumn.bind(t))("columnEditTemplate",t.selectable?void 0:pe)("template",he)("edit",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistEdit.bind(t))("save",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistSave.bind(t)),e.xp6(5),e.Q6J("title","n\xba Processo/Status\nComent\xe1rios")("width",250)("template",me),e.xp6(3),e.Q6J("ngIf",!t.selectable),e.xp6(1),e.Q6J("rows",t.rowsLimit)}},styles:[".atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}"]})},57338:(H,U,c)=>{c.d(U,{s:()=>S});var q,A=c(8239),k=c(11597),E=c(20755),e=c(39702),I=c(15908),L=c(6551),P=c(2124),N=c(32333),y=c(49193),J=c(92307),G=c(15545),Q=c(84971);class S{constructor(n,l,u,m,f,D,C,R,j){this.lookup=n,this.lex=l,this.calendar=u,this.comentario=m,this.auth=f,this.util=D,this.go=C,this.dialog=R,this.dao=j,this.delete=(v,d)=>{this.dialog.confirm("Exclui ?","Deseja realmente excluir?").then(r=>{r&&this.dao.delete(d).then(()=>{v.removeId(d.id),this.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro","Erro ao excluir: "+(h?.message?h?.message:h)))})},this.cancelarInicio=(v,d)=>{this.dialog.confirm("Cancelar inicio ?","Deseja realmente cancelar a inicializa\xe7\xe3o?").then(r=>{r&&this.dao.cancelarInicio(d.id).then(()=>{v.refreshId(d.id),this.dialog.topAlert("Cancelado a inicializa\xe7\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",(h?.message,h?.message)))})},this.cancelarConclusao=(v,d)=>{this.dialog.confirm("Cancelar conclus\xe3o ?","Deseja realmente cancelar a conclus\xe3o?").then(r=>{r&&this.dao.cancelarConclusao(d.id).then(()=>{v.refreshId(d.id),this.dialog.topAlert("Cancelado a conclus\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",(h?.message,h?.message)))})},this.desarquivar=(v,d)=>{this.dao.arquivar(d.id,!1).then(()=>{v.refreshId(d.id)}).catch(r=>this.dialog.alert("Erro",(r?.message,r?.message)))},this.arquivar=(v,d)=>{this.dialog.confirm("Arquivar?","Deseja realmente arquivar a atividade?").then(r=>{r&&this.dao.arquivar(d.id,!0).then(()=>{v.refreshId(d.id)}).catch(h=>this.dialog.alert("Erro",(h?.message,h?.message)))})},this.dynamicOptions=(v,d)=>{let r=[],h=v;const x=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(p=>p.id).includes(this.auth.usuario?.id||""),O=this.auth.usuario?.id==h.demandante_id,T=this.auth.usuario?.id==h.usuario_id,Z=this.lastConsolidacao(v.metadados?.consolidacoes),B={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"consult"]},{modal:!0})},F={label:"Coment\xe1rios",icon:"bi bi-chat-left-quote",onClick:p=>this.go.navigate({route:["uteis","comentarios","ATIVIDADE",p.id,"new"]},this.modalRefreshId(d,p))},z={label:"Clonar",icon:"bi bi-stickies",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"clonar"]},this.modalRefresh(d))},V={label:"Alterar atividade",icon:"bi bi-pencil-square",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"edit"]},this.modalRefreshId(d,p))},W={label:"Excluir atividade",icon:"bi bi-trash",onClick:this.delete.bind(this,d)},Y={label:"Prorrogar prazo",icon:"bi bi-skip-end-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"prorrogar"]},this.modalRefreshId(d,p))},w={label:"Iniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"iniciar"]},this.modalRefreshId(d,p))},g={label:"Cancelar inicio",id:"NAOINICIADO",icon:"bi bi-backspace",onClick:this.cancelarInicio.bind(this,d)},X={label:"Alterar inicio",icon:"bi bi-play-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"iniciar"]},this.modalRefreshId(d,p))},$={label:"Pausar",id:"PAUSADO",icon:"bi bi-pause-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"pausar"]},this.modalRefreshId(d,p))},ee={label:"Reiniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(d,p))},te={label:"Concluir",id:"CONCLUIDO",icon:"bi bi-check-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"concluir"]},this.modalRefreshId(d,p))},ie={label:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:p=>this.go.navigate({route:["gestao","atividade",p.id,"concluir"]},this.modalRefreshId(d,p))},ae={label:"Cancelar conclus\xe3o",id:"INICIADO",icon:"bi bi-backspace",onClick:this.cancelarConclusao.bind(this,d)},oe={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,d)},se={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,d)};return d?.disabled||(r.push(B),(T||x||O)&&r.push(F),r.push(z),h.metadados?.arquivado?(x||T)&&r.push(se):h.metadados?.iniciado?h.metadados?.concluido?((x||T)&&r.push(oe),"CONCLUIDO"!=Z?.status&&((T||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&r.push(ie),(T||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_CONCL"))&&(r.length&&r.push({divider:!0}),r.push(ae)))):h.metadados?.iniciado&&(h.metadados?.pausado?(T||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&r.push(ee):((T||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&r.push(te),(T||this.auth.hasPermissionTo("MOD_DMD_USERS_PAUSA"))&&r.push($),(!Z||"INCLUIDO"==Z?.status)&&((T||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_INICIAR"))&&r.push(g),(T||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&r.push(X))),(x||O||this.auth.hasPermissionTo("MOD_DMD_USERS_PPRZO"))&&r.push(Y)):((T||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&r.push(w),(x||O||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT"))&&r.push(V),(x||O||this.auth.hasPermissionTo("MOD_DMD_USERS_EXCL")||this.auth.hasPermissionTo("MOD_DMD_NI_EXCL"))&&(r.length&&r.push({divider:!0}),r.push(W)))),r},this.dynamicButtons=(v,d)=>{let r=[],h=v;const x=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(g=>g.usuario_id).includes(this.auth.usuario?.id||""),O=this.auth.usuario?.id==h.usuario_id,T=this.lastConsolidacao(v.metadados?.consolidacoes),B={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"consult"]},{modal:!0})},F={hint:"Iniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"iniciar"]},this.modalRefreshId(d,g))},z={hint:"Reiniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(d,g))},V={hint:"Concluir",icon:"bi bi-check",color:"btn-outline-success",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"concluir"]},this.modalRefreshId(d,g))},W={hint:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,d)},Y={hint:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,d)},w={hint:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"concluir"]},this.modalRefreshId(d,g))};return d?.disabled||(h.metadados?.iniciado?h.metadados?.concluido?x||O?r.push(h.metadados?.arquivado?Y:W):"CONCLUIDO"!=T?.status&&(O||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&r.push(w):h.metadados?.iniciado&&(h.metadados?.pausado&&O?r.push(z):(O||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&r.push(V)):(O||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&r.push(F)),r.length||r.push(B),r}}getStatus(n,l){const u=n,m=this.lookup.ATIVIDADE_STATUS.find(R=>R.key==u.status)||{key:"DESCONHECIDO",value:"Desconhecido",icon:"bi bi-question-circle",color:"light"},f=this.util.setTime(l?.data_inicio||new Date,0,0,0),D=this.util.setTime(l?.data_fim||new Date,23,59,59);let C=[{data:{status:m.key,filter:!0},label:m.value,icon:m.icon,color:m.color}];return u.metadados?.atrasado&&C.push({data:{status:"ATRASADO",filter:!1},label:"Atrasado",icon:"bi bi-alarm",color:"danger"}),l&&(u.data_inicio&&this.util.asTimestamp(u.data_inicio)<this.util.asTimestamp(f)||u.data_entrega&&this.util.asTimestamp(u.data_entrega)>this.util.asTimestamp(D))&&C.push({data:{status:"EXTRAPOLADO",filter:!1},label:"Extrapolado",icon:"bi bi-arrow-left-right",color:"danger",hint:"Data de in\xedcio ou conclus\xe3o "+this.lex.translate("da Atividade")+" extrapola os da consolida\xe7\xe3o"}),u.metadados?.arquivado&&C.push({data:{status:"ARQUIVADO",filter:!1},label:"Arquivado",icon:"bi bi-inboxes",color:"danger"}),u.metadados&&JSON.stringify(u.metadados._status)!=JSON.stringify(C)&&(u.metadados._status=C),u.metadados?._status||C}temposAtividade(n,l,u){if(n.metadados&&n.metadados.extra?.lastUpdate!=this.auth.unidadeHora){let m=l?.planos_trabalho[n.plano_trabalho_id]||n.plano_trabalho,f=[{color:"light",hint:this.lex.translate("Data de distribui\xe7\xe3o"),icon:"bi bi-file-earmark-plus",label:this.dao.getDateTimeFormatted(n.data_distribuicao)},{color:"light",hint:this.lex.translate("Prazo de entrega"),icon:"bi bi-calendar-check",label:this.dao.getDateTimeFormatted(n.data_estipulada_entrega)}];if(m?.tipo_modalidade?.atividade_esforco&&f.push({color:"light",hint:this.lex.translate("Esfor\xe7o"),icon:"bi bi-stopwatch",label:n.esforco?this.util.decimalToTimerFormated(n.esforco,!0)+" "+this.lex.translate("esfor\xe7o"):"Sem "+this.lex.translate("esfor\xe7o")}),n.metadados.concluido&&f.push({color:"light",hint:"Data de entrega realizada",icon:"bi bi-check-circle",label:this.dao.getDateTimeFormatted(n.data_entrega)}),n.metadados.iniciado&&m?.tipo_modalidade?.atividade_tempo_despendido){const D=m?.carga_horaria||0,C=l?.afastamentos[n.usuario_id]||[],R=n.metadados.concluido?n.tempo_despendido||0:this.calendar.horasUteis(n.data_inicio,this.auth.hora,D,n.unidade,"ENTREGA",n.pausas,C);f.push({color:R>n.esforco?"warning":"light",hint:"Tempo despendido",icon:"bi bi-hourglass-split",label:this.util.decimalToTimerFormated(R,!0)+" despendido",click:n.metadados.concluido?void 0:u,data:n})}if(!n.metadados.concluido&&this.util.asTimestamp(n.data_estipulada_entrega)<this.auth.hora.getTime()){const D=this.calendar.horasAtraso(n.data_estipulada_entrega,n.unidade);f.push({color:"danger",hint:"Tempo de atraso",icon:"bi bi-alarm",label:this.util.decimalToTimerFormated(D,!0)+" atrasado"})}n.metadados.extra=n.metadados.extra||{},n.metadados.extra.lastUpdate=this.auth.unidadeHora,n.metadados.extra.tempos=f}return n.metadados?.extra?.tempos||[]}onIdClick(n){this.util.copyToClipboard(n.toString())}buildEtiquetas(n,l){return this.util.merge(l?.etiquetas,n?.etiquetas,(u,m)=>u.key==m.key)}buildChecklist(n,l){let u=this.util.merge((n?.checklist||[]).map(m=>({id:m.key,texto:m.value,checked:!1})),(l?.value||[]).filter(m=>m.checked),(m,f)=>m.id==f.id&&(m.checked=f.checked,!0));return l&&l.setValue(u),u}comentarioAtividade(n,l){let u=l?.value||[];const m=u.findIndex(f=>"TIPO_ATIVIDADE"==f.tipo);if(m>=0&&("ADD"==u[m]._status?u.splice(m,1):u[m]._status),n?.comentario?.length){const f=new k.Z;f.id=this.dao.generateUuid(),f.path="",f.texto=n.comentario,f.data_comentario=this.auth.hora,f.usuario_id=this.auth.usuario.id,f.comentario_id=null,f.tipo="TIPO_ATIVIDADE",f.usuario=this.auth.usuario,f._status="ADD",u.push(f),u=this.comentario.orderComentarios(u),l&&l.setValue(u)}}modalRefreshId(n,l){return{modal:!0,modalClose:(u=(0,A.Z)(function*(m){return n.refreshId(l.id)}),function(f){return u.apply(this,arguments)})};var u}modalRefresh(n){return{modal:!0,modalClose:n.refresh}}lastConsolidacao(n){return n?.reduce((l,u)=>!l||this.util.asTimestamp(u.data_conclusao)>this.util.asTimestamp(l.data_conclusao)?u:l,void 0)}}(q=S).\u0275fac=function(n){return new(n||q)(E.LFG(e.W),E.LFG(I.E),E.LFG(L.o),E.LFG(P.K),E.LFG(N.e),E.LFG(y.f),E.LFG(J.o),E.LFG(G.x),E.LFG(Q.P))},q.\u0275prov=E.Yz7({token:q,factory:q.\u0275fac,providedIn:"root"})}}]);
>>>>>>> develop
