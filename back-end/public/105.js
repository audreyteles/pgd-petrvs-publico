"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[105],{3164:(O,f,s)=>{s.d(f,{O:()=>h});var c=s(4368);class h extends c.X{constructor(m){super(),this.perfil_id=null,this.tipo_capacidade_id="",this.initialization(m)}}},4105:(O,f,s)=>{s.r(f),s.d(f,{PerfilModule:()=>et});var c=s(6733),h=s(5579),p=s(1391),m=s(2314),x=s(8239),A=s(4040),g=s(3150),T=s(5298);class E{constructor(l){l&&Object.assign(this,l)}}var D=s(6150),v=s(3164),F=s(4368);class _ extends F.X{constructor(l){super(),this.capacidades=[],this.nivel=0,this.nome="",this.descricao="",this.initialization(l)}}var M=s(1184),t=s(755),w=s(9702);let I=(()=>{class a{constructor(i){this.lookup=i}ordenarTiposCapacidade(i){return i.sort((o,e)=>o.codigo.toUpperCase()<e.codigo.toUpperCase()?-1:1)}static#t=this.\u0275fac=function(o){return new(o||a)(t.LFG(w.W))};static#i=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var y=s(7224),P=s(3351),N=s(8820),Z=s(2392),Q=s(6384),J=s(4978);function U(a,l){if(1&a&&(t.TgZ(0,"h3",9),t._uU(1),t.qZA()),2&a){const i=t.oxw();t.xp6(1),t.Oqu(i.title)}}function L(a,l){if(1&a&&(t.TgZ(0,"span",24),t._UZ(1,"i",25),t._uU(2),t.qZA()),2&a){const i=t.oxw().row;t.xp6(2),t.hij(" ",null==i.filhos?null:i.filhos.length,"")}}function z(a,l){if(1&a&&t.YNc(0,L,3,1,"span",23),2&a){const i=l.row;t.Q6J("ngIf",null==i.filhos?null:i.filhos.length)}}function j(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"div",28)(3,"span",29)(4,"small",30),t._UZ(5,"i",31),t._uU(6),t.qZA(),t._UZ(7,"span",32),t.qZA()()(),t.TgZ(8,"td")(9,"div",33)(10,"span",34),t._uU(11),t.qZA()()(),t.TgZ(12,"td",35)(13,"div",36)(14,"span",37)(15,"input-switch",38,39),t.NdJ("change",function(){const n=t.CHM(i).$implicit,d=t.MAs(16),r=t.oxw(3);return t.KtG(r.onHabilitadoChangeFilha(n,d.value))}),t.qZA()()()()()}if(2&a){const i=l.$implicit,o=t.oxw(3);t.xp6(6),t.hij(" ",i.codigo,""),t.xp6(5),t.Oqu(i.descricao),t.xp6(4),t.Q6J("size",1)("size",2)("disabled","consult"==o.action?"true":void 0)("source",i)}}function R(a,l){if(1&a&&(t.TgZ(0,"table",26)(1,"tbody"),t.YNc(2,j,17,6,"tr",27),t.qZA()()),2&a){const i=l.row;t.xp6(2),t.Q6J("ngForOf",i.filhos)}}function W(a,l){if(1&a&&(t.TgZ(0,"span",40)(1,"strong",41),t._uU(2),t.qZA()()),2&a){const i=l.row;t.xp6(2),t.Oqu(i.codigo)}}function B(a,l){if(1&a&&(t.TgZ(0,"span",32),t._uU(1),t.qZA()),2&a){const i=l.row;t.xp6(1),t.hij(" ",i.descricao,"")}}function G(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"input-switch",42,39),t.NdJ("change",function(){const n=t.CHM(i).row,d=t.MAs(1),r=t.oxw(2);return t.KtG(r.onHabilitadoChange(n,d.value))}),t.qZA()}if(2&a){const i=l.row,o=t.oxw(2);t.Q6J("disabled","consult"==o.action?"true":void 0)("source",i)}}function Y(a,l){if(1&a&&(t.TgZ(0,"tab",10)(1,"grid",11,12)(3,"columns")(4,"column",13),t.YNc(5,z,1,1,"ng-template",null,14,t.W1O),t.YNc(7,R,3,1,"ng-template",15,16,t.W1O),t.qZA(),t.TgZ(9,"column",17),t.YNc(10,W,3,1,"ng-template",null,18,t.W1O),t.qZA(),t.TgZ(12,"column",19),t.YNc(13,B,2,1,"ng-template",null,20,t.W1O),t.qZA(),t.TgZ(15,"column",21),t.YNc(16,G,2,2,"ng-template",null,22,t.W1O),t.qZA()()()()),2&a){const i=t.MAs(6),o=t.MAs(8),e=t.MAs(11),n=t.MAs(14),d=t.MAs(17),r=t.oxw();t.Q6J("label",r.lex.translate("Capacidades")),t.xp6(1),t.Q6J("items",r.tiposCapacidades)("scrollable",!0),t.xp6(3),t.Q6J("align","center")("hint","Lista das capacidades com status m\xf3dulo")("template",i)("expandTemplate",o)("minWidth",50),t.xp6(5),t.Q6J("template",e)("minWidth",160)("maxWidth",160),t.xp6(3),t.Q6J("title",r.lex.translate("M\xf3dulo/Capacidade"))("template",n)("minWidth",600),t.xp6(3),t.Q6J("template",d)}}let b=(()=>{class a extends M.F{constructor(i){super(i,_,T.r),this.injector=i,this.tiposCapacidades=[],this.validate=(o,e)=>{let n=null;return["nome","descricao"].indexOf(e)>=0&&!o.value?.length&&(n="Obrigat\xf3rio"),n},this.titleEdit=o=>"Editando "+this.lex.translate("Perfil")+": "+(o?.nome||""),this.tipoCapacidadeDao=i.get(D.r),this.perfilService=i.get(I),this.form=this.fh.FormBuilder({nome:{default:""},capacidades:{default:[]},descricao:{default:""},nivel:{default:""},data_inicio:{default:""},data_fim:{default:""}},this.cdRef,this.validate),this.join=["capacidades.tipo_capacidade"]}loadData(i,o){var e=this;return(0,x.Z)(function*(){let n=Object.assign({},o.value);e.entity=i;var d=new E({where:[["grupo_id","==",null]],orderBy:[["codigo","asc"]],join:["filhos"]});yield e.tipoCapacidadeDao.query(d).asPromise().then(r=>{r.forEach(C=>{e.perfilService.ordenarTiposCapacidade(C.filhos),e.tiposCapacidades.push(C)})}),n=e.util.fillForm(n,i);for(let r of e.tiposCapacidades){const C=i.capacidades?.find(u=>u.tipo_capacidade?.codigo==r.codigo);r._metadata=Object.assign(r._metadata||{},{habilitado:!!C});for(let u of r.filhos){const at=i.capacidades?.find(ot=>ot.tipo_capacidade?.codigo==u.codigo);u._metadata=Object.assign(u._metadata||{},{habilitado:!!at})}}o.patchValue(n)})()}onHabilitadoChange(i,o){let e=this.entity.capacidades?.find(n=>n.tipo_capacidade_id==i.id);if(o)e&&"DELETE"==e._status&&(e._status=void 0),e||this.entity.capacidades.push(new v.O({tipo_capacidade_id:i.id,perfil_id:this.entity.id,_status:"ADD"}));else{e&&!e._status&&(e._status="DELETE"),e&&"ADD"==e._status&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(n=>n.tipo_capacidade_id==i.id),1);for(let n of i.filhos){n._metadata=Object.assign(n._metadata||{},{habilitado:!1});let d=this.entity.capacidades?.find(r=>r.tipo_capacidade_id==n.id);d&&!d._status&&(d._status="DELETE"),d&&"ADD"==d._status&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(r=>r.tipo_capacidade_id==n.id),1)}}this.refreshCapacidadesHabilitadas()}refreshCapacidadesHabilitadas(){var i=this;return(0,x.Z)(function*(){let o=Object.assign({},i.form.value);o=i.util.fillForm(o,i.entity),i.form.patchValue(o),i.cdRef.detectChanges()})()}onHabilitadoChangeFilha(i,o){let e=this.entity.capacidades?.find(d=>d.tipo_capacidade_id==i.id),n=this.tiposCapacidades.find(d=>d.id==i.grupo_id);if(o){if(!n._metadata.habilitado){n._metadata=Object.assign(n._metadata||{},{habilitado:!0});let d=this.entity.capacidades?.find(r=>r.tipo_capacidade_id==n.id);d&&"DELETE"==d._status&&(d._status=void 0),d||this.entity.capacidades.push(new v.O({tipo_capacidade_id:n.id,perfil_id:this.entity.id,_status:"ADD"}))}e&&"DELETE"==e._status&&(e._status=void 0),e||this.entity.capacidades.push(new v.O({tipo_capacidade_id:i.id,perfil_id:this.entity.id,_status:"ADD"}))}else e&&!e._status&&(e._status="DELETE"),e&&"ADD"==e._status&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(d=>d.tipo_capacidade_id==i.id),1);this.refreshCapacidadesHabilitadas()}initializeData(i){i.patchValue(new _)}saveData(i){return new Promise((o,e)=>{let n=this.util.fill(new _,this.entity);n=this.util.fillForm(n,this.form.value),n.capacidades=n.capacidades.filter(d=>["ADD","DELETE"].includes(d._status||"")),o(n)})}static#t=this.\u0275fac=function(o){return new(o||a)(t.Y36(t.zs3))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-perfil-form"]],viewQuery:function(o,e){if(1&o&&(t.Gf(A.Q,5),t.Gf(g.M,5)),2&o){let n;t.iGM(n=t.CRH())&&(e.editableForm=n.first),t.iGM(n=t.CRH())&&(e.gridPai=n.first)}},features:[t.qOj],decls:10,vars:11,consts:[["class","my-2",4,"ngIf"],["initialFocus","nome",3,"form","disabled","submit","cancel"],["display","","right",""],["key","PRINCIPAL","label","Principal"],[1,"row"],["label","Nome","controlName","nome","required","",3,"size"],["numbers","","label","N\xedvel","controlName","nivel",3,"size","disabled"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size"],["key","CAPACIDADES",3,"label",4,"ngIf"],[1,"my-2"],["key","CAPACIDADES",3,"label"],[3,"items","scrollable"],["gridPai",""],["type","expand","icon","bi bi-shield-lock",3,"align","hint","template","expandTemplate","minWidth"],["columnCapacidades",""],["style","justify-content: inherit;"],["columnExpandedCapacidades",""],["title","C\xf3digo","orderBy","codigo",3,"template","minWidth","maxWidth"],["columnCodCapacidade",""],[3,"title","template","minWidth"],["columnTipoCapacidade",""],["title","Habilitado",3,"template"],["columnSelecionado",""],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-grid"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[2,"width","220px"],[1,"text-wrap","text-center"],[1,"micro-text","fw-light"],[1,"bi","bi-key"],[1,"badge","bg-light","text-dark"],[2,"width","450px"],[1,"badge","bg-light","text-dark","text-wrap"],[2,"text-align","right"],[2,"width","60px","margin-left","40px"],[1,"text-align"],["scale","medium","path","_metadata.habilitado",1,"text-align",2,"right","10px",3,"size","disabled","source","change"],["habilitado",""],[1,"text-wrap"],[1,"grid-group-text"],["path","_metadata.habilitado",2,"width","45px","margin-right","70px",3,"disabled","source","change"]],template:function(o,e){1&o&&(t.YNc(0,U,2,1,"h3",0),t.TgZ(1,"editable-form",1),t.NdJ("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),t.TgZ(2,"tabs",2)(3,"tab",3)(4,"div",4),t._UZ(5,"input-text",5)(6,"input-text",6),t.qZA(),t.TgZ(7,"div",4),t._UZ(8,"input-text",7),t.qZA()(),t.YNc(9,Y,18,15,"tab",8),t.qZA()()),2&o&&(t.Q6J("ngIf",!e.isModal),t.xp6(1),t.Q6J("form",e.form)("disabled",e.formDisabled),t.xp6(4),t.Q6J("size",10),t.uIk("maxlength",250),t.xp6(1),t.Q6J("size",2)("disabled",e.entity?"disabled":void 0),t.uIk("maxlength",250),t.xp6(2),t.Q6J("size",12),t.uIk("maxlength",250),t.xp6(1),t.Q6J("ngIf",e.auth.hasPermissionTo("MOD_TIPO_CAP")))},dependencies:[c.sg,c.O5,g.M,y.a,P.b,A.Q,N.a,Z.m,Q.n,J.i]})}return a})();var H=s(8509),S=s(7765),X=s(5512),V=s(2704);function K(a,l){if(1&a&&(t.TgZ(0,"h3",11),t._uU(1),t.qZA()),2&a){const i=t.oxw();t.xp6(1),t.Oqu(i.title)}}function q(a,l){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&a){const i=l.row;t.xp6(1),t.Oqu(i.nivel)}}const $=[{path:"",component:(()=>{class a extends H.E{constructor(i){super(i,_,T.r),this.injector=i,this.options=[],this.filterWhere=o=>{let e=[],n=o.value;return n.nome?.length&&e.push(["nome","like","%"+n.nome.trim().replace(" ","%")+"%"]),e},this.title=this.lex.translate("Perfis"),this.code="MOD_CFG_PERFS",this.orderBy=[["nome","asc"]],this.filter=this.fh.FormBuilder({nome:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_PERF_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}static#t=this.\u0275fac=function(o){return new(o||a)(t.Y36(t.zs3))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-perfil-list"]],viewQuery:function(o,e){if(1&o&&t.Gf(g.M,5),2&o){let n;t.iGM(n=t.CRH())&&(e.grid=n.first)}},features:[t.qOj],decls:14,vars:22,consts:[["class","my-2",4,"ngIf"],[3,"dao","add","orderBy","groupBy","join","hasAdd","hasEdit"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","nome","placeholder","Nome...",3,"size","label","control"],["title","Nome","field","nome"],["title","Descri\xe7\xe3o","field","descricao"],["title","N\xedvel de acesso",3,"template"],["columnNivel",""],["type","options",3,"onEdit","options"],[3,"rows"],[1,"my-2"]],template:function(o,e){if(1&o&&(t.YNc(0,K,2,1,"h3",0),t.TgZ(1,"grid",1),t._UZ(2,"toolbar"),t.TgZ(3,"filter",2)(4,"div",3),t._UZ(5,"input-text",4),t.qZA()(),t.TgZ(6,"columns"),t._UZ(7,"column",5)(8,"column",6),t.TgZ(9,"column",7),t.YNc(10,q,2,1,"ng-template",null,8,t.W1O),t.qZA(),t._UZ(12,"column",9),t.qZA(),t._UZ(13,"pagination",10),t.qZA()),2&o){const n=t.MAs(11);t.Q6J("ngIf",!e.isModal),t.xp6(1),t.Q6J("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("hasAdd",e.auth.hasPermissionTo("MOD_PERF_INCL"))("hasEdit",e.auth.hasPermissionTo("MOD_PERF_EDT")),t.xp6(2),t.Q6J("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",e.filterCollapsed),t.xp6(2),t.Q6J("size",12)("label","Nome "+e.lex.translate("Perfil"))("control",e.filter.controls.nome),t.uIk("maxlength",250),t.xp6(4),t.Q6J("template",n),t.xp6(3),t.Q6J("onEdit",e.edit)("options",e.options),t.xp6(1),t.Q6J("rows",e.rowsLimit)}},dependencies:[c.O5,g.M,y.a,P.b,S.z,X.n,V.Q,Z.m]})}return a})(),canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Perfils"}},{path:"new",component:b,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Perfil",modal:!0}},{path:":id/edit",component:b,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Perfil",modal:!0}},{path:":perfil_id/capacidade",loadChildren:()=>s.e(472).then(s.bind(s,7472)).then(a=>a.CapacidadeModule),canActivate:[p.a]},{path:":id/consult",component:b,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Perfil",modal:!0}}];let k=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[h.Bz.forChild($),h.Bz]})}return a})();var tt=s(2662),it=s(2133);let et=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[c.ez,tt.K,it.UX,k]})}return a})()}}]);