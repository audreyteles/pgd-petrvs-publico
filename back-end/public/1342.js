"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[1342],{41342:(ci,da,r)=>{r.r(da),r.d(da,{PlanoTrabalhoModule:()=>j});var g=r(76733),ca=r(55579),b=r(1391),v=r(2314),d=r(8239),E=r(74040),ua=r(25026),U=r(87744),ma=r(92214),Qa=r(88340),pa=r(66075),w=r(81214),K=r(35255),_a=r(79084),Z=r(20762),ga=r(1184),Na=r(92307),a=r(20755),J=r(88820),Sa=r(51823),T=r(32802),X=r(92392),L=r(84495),D=r(25560),ha=r(43417);const qa=["usuario"],Ma=["unidade"],Fa=["programa"],Ra=["tipoDocumento"],Va=["tipoModalidade"];class G extends ga.F{constructor(o){super(o,Z.p,U.t),this.injector=o,this.validate=(t,e)=>{let n=null;return"tipo_documento_id"==e&&!t?.value?.length&&this.form?.controls?.numero_processo?.value?.length&&(n="Obrigat\xf3rio"),n},this.formValidation=t=>{if(!this.tipoDocumento?.selectedEntity&&t?.controls.tipo_documento_id.value?.length)return"Aguarde o carregamento do tipo de documento"},this.titleEdit=t=>"Editando "+this.lex.translate("TCR")+" "+this.lex.translate("do Plano de Trabalho")+": "+(t?.usuario?.nome||""),this.join=["unidade","usuario","programa.template_tcr","tipo_modalidade","documento","documentos","atividades.atividade"],this.unidadeDao=o.get(w.J),this.programaDao=o.get(ma.w),this.usuarioDao=o.get(K.q),this.tipoDocumentoDao=o.get(Qa.Q),this.allPages=o.get(_a.T),this.tipoModalidadeDao=o.get(pa.D),this.documentoDao=o.get(ua.d),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},programa_id:{default:""},usuario_id:{default:""},unidade_id:{default:""},documento_id:{default:""},documentos:{default:[]},tipo_documento_id:{default:""},numero_processo:{default:""},vinculadas:{default:!0},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"}},this.cdRef,this.validate)}onVinculadasChange(o){this.cdRef.detectChanges()}loadData(o,t){var e=this;return(0,d.Z)(function*(){let n=Object.assign({},t.value);n=e.util.fillForm(n,o),yield Promise.all([e.unidade.loadSearch(o.unidade||o.unidade_id),e.usuario.loadSearch(o.usuario||o.usuario_id),e.programa.loadSearch(o.programa||o.programa_id),e.tipoModalidade.loadSearch(o.tipo_modalidade||o.tipo_modalidade_id)]),e.processo&&(n.id_processo=e.processo.id_processo,n.numero_processo=e.processo.numero_processo),n.data_inicio=e.auth.hora,t.patchValue(n)})()}initializeData(o){var t=this;return(0,d.Z)(function*(){t.entity=yield t.dao.getById(t.metadata.plano_trabalho.id,t.join),t.processo=t.metadata?.processo,yield t.loadData(t.entity,o)})()}saveData(o){return new Promise((t,e)=>{t(new Na.R(Object.assign(this.form.value,{codigo_tipo_documento:this.tipoDocumento?.selectedEntity?.codigo})))})}get formaContagemCargaHoraria(){const o=this.form?.controls.forma_contagem_carga_horaria?.value||"DIA";return"DIA"==o?"day":"SEMANA"==o?"week":"mouth"}static#a=this.\u0275fac=function(t){return new(t||G)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:G,selectors:[["plano-trabalho-form-termo"]],viewQuery:function(t,e){if(1&t&&(a.Gf(E.Q,5),a.Gf(qa,5),a.Gf(Ma,5),a.Gf(Fa,5),a.Gf(Ra,5),a.Gf(Va,5)),2&t){let n;a.iGM(n=a.CRH())&&(e.editableForm=n.first),a.iGM(n=a.CRH())&&(e.usuario=n.first),a.iGM(n=a.CRH())&&(e.unidade=n.first),a.iGM(n=a.CRH())&&(e.programa=n.first),a.iGM(n=a.CRH())&&(e.tipoDocumento=n.first),a.iGM(n=a.CRH())&&(e.tipoModalidade=n.first)}},features:[a.qOj],decls:25,vars:41,consts:[["initialFocus","programa_id",3,"form","disabled","title","submit","cancel"],["collapse","",3,"title","collapsed"],[1,"row"],["disabled","","controlName","programa_id",3,"size","dao"],["programa",""],["disabled","","controlName","usuario_id",3,"size","dao"],["usuario",""],["disabled","","controlName","unidade_id",3,"size","dao"],["unidade",""],["disabled","","controlName","tipo_modalidade_id",3,"size","dao"],["tipoModalidade",""],["numbers","","disabled","","label","% prod.","icon","bi bi-hourglass-split","controlName","ganho_produtividade",3,"size","control","labelInfo"],["label","H. Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["disabled","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","In\xedcio da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","Final","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Final da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","C. Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria",3,"size","unit","control","labelInfo"],["label","H. Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["disabled","","label","Data e hora","controlName","data_inicio","labelInfo","Data de cadastro do termo",3,"size","control"],["controlName","numero_processo","disabled","","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"label","size","control"],["controlName","tipo_documento_id","required","",3,"size","disabled","dao"],["tipoDocumento",""],["label","Vinculadas","controlName","vinculadas","labelInfo","Se inclui as atividades das unidades vinculadas a unidade do plano",3,"disabled","size","control","change"]],template:function(t,e){1&t&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),a.TgZ(1,"separator",1)(2,"div",2),a._UZ(3,"input-search",3,4)(5,"input-search",5,6),a.qZA(),a.TgZ(7,"div",2),a._UZ(8,"input-search",7,8)(10,"input-search",9,10)(12,"input-text",11)(13,"input-display",12),a.qZA(),a.TgZ(14,"div",2),a._UZ(15,"input-datetime",13)(16,"input-datetime",14)(17,"input-workload",15)(18,"input-display",16),a.qZA()(),a.TgZ(19,"div",2),a._UZ(20,"input-datetime",17)(21,"input-text",18)(22,"input-search",19,20),a.TgZ(24,"input-switch",21),a.NdJ("change",function(l){return e.onVinculadasChange(l)}),a.qZA()()()),2&t&&(a.Q6J("form",e.form)("disabled",e.formDisabled)("title",e.isModal?"":e.title),a.xp6(1),a.Q6J("title",e.lex.translate("Plano de trabalho"))("collapsed",!1),a.xp6(2),a.Q6J("size",6)("dao",e.programaDao),a.xp6(2),a.Q6J("size",6)("dao",e.usuarioDao),a.xp6(3),a.Q6J("size",5)("dao",e.unidadeDao),a.xp6(2),a.Q6J("size",3)("dao",e.tipoModalidadeDao),a.xp6(2),a.Q6J("size",2)("control",e.form.controls.ganho_produtividade)("labelInfo","Percentual de ganho de produtividade (Ser\xe1 descontado do "+e.lex.translate("tempo pactuado")+")"),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",2)("control",e.form.controls.tempo_proporcional),a.xp6(2),a.Q6J("size",3)("control",e.form.controls.data_inicio),a.xp6(1),a.Q6J("size",3)("control",e.form.controls.data_fim),a.xp6(1),a.Q6J("size",3)("unit",e.formaContagemCargaHoraria)("control",e.form.controls.carga_horaria)("labelInfo","Carga hor\xe1ria"+e.lex.translate("do usu\xe1rio")),a.xp6(1),a.Q6J("size",3)("control",e.form.controls.tempo_total),a.xp6(2),a.Q6J("size",3)("control",e.form.controls.data_inicio),a.xp6(1),a.Q6J("label","N\xfamero "+e.lex.translate("Processo"))("size",3)("control",e.form.controls.numero_processo),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",4)("disabled",null!=e.form.controls.numero_processo.value&&e.form.controls.numero_processo.value.length?void 0:"true")("dao",e.tipoDocumentoDao),a.xp6(2),a.Q6J("disabled",null!=e.entity&&null!=e.entity.atividades&&e.entity.atividades.length?"true":void 0)("size",2)("control",e.form.controls.vinculadas))},dependencies:[E.Q,J.a,Sa.B,T.V,X.m,L.k,D.N,ha.S]})}var La=r(22702),fa=r(6551),Q=r(80684),Ga=r(49367),za=r(49193),Ya=r(53085),z=r(66384),$=r(74978),Ha=r(50933),Ba=r(55795),ka=r(60785),Wa=r(6601),A=r(73150),N=r(76298),ja=r(75754),Ka=r(59173),Xa=r(39190),ba=r(31021),aa=r(20609),S=r(57224),q=r(83351),va=r(74508),ta=r(64603),O=r(95489),Ta=r(64792);const $a=["origem"],at=["planoEntrega"],tt=["entrega"];function et(i,o){1&i&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3,"Origem"),a.qZA()()())}function ot(i,o){if(1&i&&a._UZ(0,"badge",27),2&i){const t=a.oxw().row,e=a.oxw();a.Q6J("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"DESCONHECIDO")("icon",e.entityService.getIcon("Unidade"))}}function it(i,o){if(1&i&&a._UZ(0,"badge",28),2&i){const t=a.oxw().row;a.Q6J("label",t.orgao)}}function nt(i,o){if(1&i&&(a.TgZ(0,"div",22)(1,"div",23),a._UZ(2,"badge",24),a.YNc(3,ot,1,2,"badge",25),a.YNc(4,it,1,1,"badge",26),a.qZA()()),2&i){const t=o.row,e=a.oxw();a.xp6(2),a.Q6J("label",e.planoTrabalhoService.tipoEntrega(t,e.entity).titulo)("color",e.planoTrabalhoService.tipoEntrega(t,e.entity).cor),a.xp6(1),a.Q6J("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),a.xp6(1),a.Q6J("ngIf",null==t.orgao?null:t.orgao.length)}}const lt=function(){return["entregas.entrega:id,nome","unidade"]},rt=function(i){return["unidade_id","==",i]},Aa=function(){return["status","==","ATIVO"]},st=function(i,o){return[i,o]},dt=function(i){return[i]},ct=function(i){return{unidade_id:i,status:"ATIVO"}},Ca=function(i){return{filter:i}},ut=function(){return{status:"ATIVO"}};function mt(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"input-search",33,34),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw(2);return a.KtG(l.onPlanoEntregaChange(n))}),a.qZA()}if(2&i){a.oxw();const t=a.MAs(1),e=a.oxw();a.Q6J("placeholder","Selecione o "+e.lex.translate("Plano de entrega"))("join",a.DdM(5,lt))("where","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.WLB(9,st,a.VKq(6,rt,null==e.entity?null:e.entity.unidade_id),a.DdM(8,Aa)):a.VKq(13,dt,a.DdM(12,Aa)))("selectParams","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.VKq(17,Ca,a.VKq(15,ct,null==e.entity?null:e.entity.unidade_id)):a.VKq(20,Ca,a.DdM(19,ut)))("dao",e.planoEntregaDao)}}function pt(i,o){1&i&&a._UZ(0,"input-text",35,36),2&i&&a.uIk("maxlength",250)}const ea=function(){return["PROPRIA_UNIDADE","OUTRA_UNIDADE"]};function _t(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"input-select",29,30),a.NdJ("change",function(){const l=a.CHM(t).row,c=a.oxw();return a.KtG(c.onOrigemChange(l))}),a.qZA(),a.YNc(2,mt,2,22,"input-search",31),a.YNc(3,pt,2,1,"input-text",32)}if(2&i){const t=a.MAs(1),e=a.oxw();a.Q6J("control",e.form.controls.origem)("items",e.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO),a.xp6(2),a.Q6J("ngIf",a.DdM(4,ea).includes(null==t?null:t.value)),a.xp6(1),a.Q6J("ngIf","OUTRO_ORGAO"==(null==t?null:t.value))}}function gt(i,o){1&i&&(a.TgZ(0,"span")(1,"strong"),a._uU(2,"Entrega"),a.qZA()())}function ht(i,o){if(1&i&&(a.TgZ(0,"div",39),a._UZ(1,"badge",40)(2,"badge",41),a.qZA()),2&i){const t=a.oxw().row,e=a.oxw();a.xp6(1),a.Q6J("label",e.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)),a.xp6(1),a.Q6J("label",e.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim))}}function ft(i,o){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA(),a.YNc(2,ht,3,2,"div",37),a._UZ(3,"reaction",38)),2&i){const t=o.row,e=a.oxw();a.xp6(1),a.Oqu(e.planoTrabalhoService.tipoEntrega(t,e.entity).descricao),a.xp6(1),a.Q6J("ngIf",a.DdM(3,ea).includes(e.planoTrabalhoService.tipoEntrega(t,e.entity).tipo)),a.xp6(1),a.Q6J("entity",t)}}function bt(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"input-select",43,44),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw(2);return a.KtG(l.onEntregaChange(n))}),a.qZA()}if(2&i){const t=a.oxw(2);a.Q6J("control",t.form.controls.plano_entrega_entrega_id)("items",t.entregas)}}function vt(i,o){if(1&i&&(a.TgZ(0,"div",39),a._UZ(1,"badge",40)(2,"badge",41),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_inicio)),a.xp6(1),a.Q6J("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_fim))}}function Tt(i,o){if(1&i&&(a.YNc(0,bt,2,2,"input-select",42),a.YNc(1,vt,3,2,"div",37)),2&i){const t=a.oxw();a.Q6J("ngIf",a.DdM(2,ea).includes(null==t.origem?null:t.origem.value)),a.xp6(1),a.Q6J("ngIf",null==t.entrega?null:t.entrega.selectedItem)}}function At(i,o){if(1&i&&(a.TgZ(0,"div")(1,"small"),a._UZ(2,"badge",47),a.qZA(),a.TgZ(3,"small"),a._UZ(4,"badge",48),a.qZA()()),2&i){const t=a.oxw(2);a.xp6(2),a.Q6J("color","warning")("label",t.totalForcaTrabalho+"%"),a.xp6(2),a.Q6J("color","secondary")("label",t.totalForcaTrabalho-100+"%")}}function Ct(i,o){if(1&i&&(a.TgZ(0,"small"),a._UZ(1,"badge",47),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("color",100==t.totalForcaTrabalho?"success":"warning")("label",t.totalForcaTrabalho+"%")}}function xt(i,o){if(1&i&&(a.TgZ(0,"div",21),a.YNc(1,At,5,4,"div",45),a.YNc(2,Ct,2,2,"ng-template",null,46,a.W1O),a.qZA()),2&i){const t=a.MAs(3),e=a.oxw();a.xp6(1),a.Q6J("ngIf",e.totalForcaTrabalho>100)("ngIfElse",t)}}function yt(i,o){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=o.row;a.xp6(1),a.Oqu(t.forca_trabalho+"%")}}function Et(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"input-text",49),a.NdJ("change",function(){const l=a.CHM(t).row,c=a.oxw();return a.KtG(c.onForcaTrabalhoChange(l))}),a.qZA()}if(2&i){const t=a.oxw();a.Q6J("control",t.form.controls.forca_trabalho),a.uIk("maxlength",250)}}function Zt(i,o){1&i&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3,"Descri\xe7\xe3o dos Trabalhos"),a.qZA()()())}function Dt(i,o){if(1&i&&(a.TgZ(0,"div")(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.xp6(2),a.Oqu(t.descricao)}}function Ot(i,o){if(1&i&&a.YNc(0,Dt,3,1,"div",45),2&i){const t=o.row,e=a.oxw(),n=a.MAs(30);a.Q6J("ngIf",t.descricao!=e.planoTrabalhoService.tipoEntrega(t,e.entity).descricao)("ngIfElse",n)}}function It(i,o){1&i&&(a.TgZ(0,"small"),a._uU(1,"Detalhe/Descreva os trabalhos"),a.qZA())}function Pt(i,o){if(1&i&&a._UZ(0,"input-textarea",50),2&i){const t=a.oxw();a.Q6J("rows",2)("control",t.form.controls.descricao)}}class I extends N.D{set control(o){super.control=o}get control(){return super.control}set entity(o){super.entity=o}get entity(){return super.entity}set disabled(o){this._disabled!=o&&(this._disabled=o)}get disabled(){return this._disabled}set noPersist(o){super.noPersist=o}get noPersist(){return super.noPersist}set planoTrabalhoEditavel(o){this._planoTrabalhoEditavel!=o&&(this._planoTrabalhoEditavel=o)}get planoTrabalhoEditavel(){return this._planoTrabalhoEditavel}get items(){return this.gridControl.value||this.gridControl.setValue(new Z.p),this.gridControl.value.entregas||(this.gridControl.value.entregas=[]),this.gridControl.value.entregas}constructor(o){super(o),this.injector=o,this.atualizaPlanoTrabalhoEvent=new a.vpe,this.options=[],this.totalForcaTrabalho=0,this.entregas=[],this._disabled=!1,this._planoTrabalhoEditavel=!0,this.validate=(t,e)=>{let n=null;return["forca_trabalho"].indexOf(e)>=0&&1==t.value||(["forca_trabalho"].indexOf(e)>=0&&!t.value&&(n="Obrigat\xf3rio!"),["descricao"].indexOf(e)>=0&&!t.value?.length&&(n="Obrigat\xf3rio!"),["forca_trabalho"].indexOf(e)>=0&&(t.value<1||t.value>100)&&(n="Deve estar entre 1 e 100"),["plano_entrega_entrega_id"].indexOf(e)>=0&&(["PROPRIA_UNIDADE","OUTRA_UNIDADE"].includes(this.form?.controls.origem.value)&&!t.value&&(n="Obrigat\xf3rio!"),this.entity?.entregas?.filter(l=>!!l.plano_entrega_entrega_id&&l.id!=this.grid?.editing?.id).find(l=>l.plano_entrega_entrega_id==t.value)&&(n="Esta entrega est\xe1 em duplicidade!"))),n},this.dao=o.get(Ka.w),this.cdRef=o.get(a.sBO),this.planoTrabalhoDao=o.get(U.t),this.planoEntregaDao=o.get(Xa.r),this.planoTrabalhoService=o.get(Q.p),this.peeDao=o.get(ba.K),this.unidadeService=o.get(aa.Z),this.join=["entrega","plano_entrega_entrega.entrega","plano_entrega_entrega.plano_entrega:id,unidade_id","plano_entrega_entrega.plano_entrega.unidade:id,sigla"],this.form=this.fh.FormBuilder({origem:{default:null},orgao:{default:null},descricao:{default:""},forca_trabalho:{default:1},plano_trabalho_id:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}validateEntregas(){let o={start:this.entity.data_inicio,end:this.entity.data_fim};for(let t of this.items){let e=t.plano_entrega_entrega;if(e){let n=e.data_fim?e.data_fim:e.data_inicio.getTime()<=this.entity.data_fim.getTime()?this.entity.data_fim:void 0,l={start:e.data_inicio,end:e.data_fim||e.data_inicio};if(!n||!this.util.intersection([l,o]))return this.lex.translate("Entrega")+" "+e.descricao+" possui datas incompat\xedveis (in\xedcio "+this.util.getDateFormatted(e.data_inicio)+(e.data_fim?"e fim "+this.util.getDateFormatted(e.data_fim):"")+")"}}}ngOnInit(){var o=()=>super.ngOnInit,t=this;return(0,d.Z)(function*(){o().call(t),t.entity=t.metadata?.entity||t.entity,t.totalForcaTrabalho=Math.round(100*t.somaForcaTrabalho(t.entity?.entregas))/100,t.entity._metadata=t.entity._metadata||{},t.entity._metadata.novaEntrega=void 0})()}addEntrega(){var o=this;return(0,d.Z)(function*(){return Object.assign(new ja.U,{_status:"ADD",id:o.dao.generateUuid(),plano_trabalho_id:o.entity?.id})})()}loadEntrega(o,t){var e=this;return(0,d.Z)(function*(){let n=t;if(o.controls.descricao.setValue(t.descricao),o.controls.forca_trabalho.setValue(t.forca_trabalho),o.controls.plano_trabalho_id.setValue(t.plano_trabalho_id),o.controls.orgao.setValue(null),o.controls.plano_entrega_entrega_id.setValue(null),t.plano_entrega_entrega&&(o.controls.plano_entrega_id.setValue(t.plano_entrega_entrega.plano_entrega.id),o.controls.plano_entrega_entrega_id.setValue(t.plano_entrega_entrega_id)),"ADD"!=n._status||o.controls.plano_entrega_id.value)n.plano_entrega_entrega?.plano_entrega?.unidade_id==e.entity.unidade_id?(o.controls.origem.setValue("PROPRIA_UNIDADE"),yield e.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),o.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.plano_entrega_entrega?(o.controls.origem.setValue("OUTRA_UNIDADE"),yield e.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),o.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.orgao?.length?(o.controls.origem.setValue("OUTRO_ORGAO"),o.controls.orgao.setValue(n.orgao)):o.controls.origem.setValue("SEM_ENTREGA");else{o.controls.origem.setValue("PROPRIA_UNIDADE");let l=yield e.planoEntregaDao.query({where:[["unidade_id","==",e.entity.unidade_id],["status","==","ATIVO"]]}).asPromise();o.controls.plano_entrega_id.setValue(l[0].id)}})()}removeEntrega(o){var t=this;return(0,d.Z)(function*(){if(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?")){t.loading=!0;try{t.isNoPersist?Object.assign(o,{_status:"DELETE"}):yield t.dao?.delete(o.id)}finally{t.loading=!1,t.atualizaPlanoTrabalhoEvent.emit(t.entity.id)}return t.totalForcaTrabalho=Math.round(100*(t.totalForcaTrabalho-1*o.forca_trabalho))/100,!t.isNoPersist}return!1})()}saveEntrega(o,t){var e=this;return(0,d.Z)(function*(){e.entity._metadata=e.entity._metadata||{},e.entity._metadata.novaEntrega=t,e.entity._metadata.novaEntrega.plano_entrega_entrega_id=e.form?.controls.plano_entrega_entrega_id.value,e.entity._metadata.novaEntrega.orgao=e.form?.controls.orgao.value,e.entity._metadata.novaEntrega.descricao=e.form?.controls.descricao.value,e.entity._metadata.novaEntrega.forca_trabalho=e.form?.controls.forca_trabalho.value,e.loading=!0;try{e.isNoPersist||(yield e.dao.save(e.entity._metadata.novaEntrega,e.join))}catch(n){e.error(n.message?n.message:n.toString()||n)}finally{t.forca_trabalho=1*e.form?.controls.forca_trabalho.value,t.plano_entrega_entrega=e.entrega?.selectedItem?.data||null,e.totalForcaTrabalho=Math.round(100*e.somaForcaTrabalho(e.entity?.entregas))/100,e.loading=!1}return e.entity._metadata.novaEntrega})()}saveEndEntrega(o){this.entity._metadata=null,this.atualizaPlanoTrabalhoEvent.emit(this.entity.id)}somaForcaTrabalho(o=[]){return o.map(t=>1*t.forca_trabalho).reduce((t,e)=>t+e,0)}carregarEntregas(o){var t=this;return(0,d.Z)(function*(){let e="string"==typeof o?yield t.planoEntregaDao.getById(o,["entregas.entrega:id,nome","unidade"]):o,n={id:e?.id,unidade_id:e?.unidade_id,unidade:e?.unidade};t.entregas=e?.entregas.map(l=>Object.assign({},{key:l.id,value:l.descricao||l.entrega?.nome||"Desconhecido",data:Object.assign(l,{plano_entrega:n})}))||[],t.entregas.sort((l,c)=>l.value>c.value?1:-1),t.entregas.find(l=>l.key==t.form.controls.plano_entrega_entrega_id.value)||t.form.controls.plano_entrega_entrega_id.setValue(null)})()}onOrigemChange(o){var t=this;return(0,d.Z)(function*(){let e=t.form.controls.origem.value;t.cdRef.detectChanges(),"OUTRO_ORGAO"==e?t.form?.controls.plano_entrega_entrega_id.setValue(null):"SEM_ENTREGA"==e?(t.form?.controls.orgao.setValue(null),t.form?.controls.plano_entrega_entrega_id.setValue(null)):"OUTRA_UNIDADE"==e&&(t.form?.controls.orgao.setValue(null),t.form?.controls.plano_entrega_id.value||(t.loading=!0,t.planoEntrega?.onSelectClick(new Event("SELECT")),t.loading=!1))})()}onPlanoEntregaChange(o){let t=this.planoEntrega?.selectedEntity;this.carregarEntregas(t)}onEntregaChange(o){}onForcaTrabalhoChange(o){let t=this.items.findIndex(e=>e.id==o.id);this.totalForcaTrabalho=Math.round(100*(this.somaForcaTrabalho(this.grid?.items)-1*this.items[t].forca_trabalho+1*this.form?.controls.forca_trabalho.value))/100}static#a=this.\u0275fac=function(t){return new(t||I)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:I,selectors:[["plano-trabalho-list-entrega"]],viewQuery:function(t,e){if(1&t&&(a.Gf(E.Q,5),a.Gf(A.M,5),a.Gf($a,5),a.Gf(at,5),a.Gf(tt,5)),2&t){let n;a.iGM(n=a.CRH())&&(e.editableForm=n.first),a.iGM(n=a.CRH())&&(e.grid=n.first),a.iGM(n=a.CRH())&&(e.origem=n.first),a.iGM(n=a.CRH())&&(e.planoEntrega=n.first),a.iGM(n=a.CRH())&&(e.entrega=n.first)}},inputs:{control:"control",entity:"entity",disabled:"disabled",noPersist:"noPersist",cdRef:"cdRef",planoTrabalhoEditavel:"planoTrabalhoEditavel"},outputs:{atualizaPlanoTrabalhoEvent:"atualizaPlanoTrabalhoEvent"},features:[a.qOj],decls:34,vars:39,consts:[["noMargin","","editable","",3,"items","form","selectable","minHeight","join","groupBy","add","remove","save","load","saveEnd","hasDelete","hasEdit","hasAdd"],["gridEntregas",""],[3,"titleTemplate","template","editTemplate","verticalAlign","width","align"],["titleOrigem",""],["columnOrigem",""],["editOrigem",""],[3,"width","titleTemplate","template","editTemplate","verticalAlign"],["class","text-center"],["titleEntrega",""],["columnEntrega",""],["editEntrega",""],[3,"titleTemplate","title","template","editTemplate","width","align","titleHint"],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["editForcaTrabalho",""],[3,"minWidth","maxWidth","titleTemplate","template","editTemplate","verticalAlign","align"],["titleDescricao",""],["columnDescricao",""],["solicitarDescricao",""],["editDescricao",""],["type","options"],[1,"text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["controlName","origem","controlName","origem",3,"control","items","change"],["origem",""],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change",4,"ngIf"],["controlName","orgao","placeholder","\xd3rg\xe3o",4,"ngIf"],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change"],["planoEntrega",""],["controlName","orgao","placeholder","\xd3rg\xe3o"],["orgao",""],["class","w-100",4,"ngIf"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],[1,"w-100"],["color","light","icon","bi bi-box-arrow-in-right","hint","Data de in\xedcio",3,"label"],["color","light","icon","bi bi-box-arrow-right","hint","Data de t\xe9rmino",3,"label"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change",4,"ngIf"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change"],["entrega",""],[4,"ngIf","ngIfElse"],["umCHD",""],["icon","bi bi-calculator",3,"color","label"],["icon","bi bi-intersect",3,"color","label"],["number","","sufix","%","controlName","forca_trabalho",3,"control","change"],["controlName","descricao",3,"rows","control"]],template:function(t,e){if(1&t&&(a.TgZ(0,"grid",0,1)(2,"columns")(3,"column",2),a.YNc(4,et,4,0,"ng-template",null,3,a.W1O),a.YNc(6,nt,5,4,"ng-template",null,4,a.W1O),a.YNc(8,_t,4,5,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(10,"column",6),a.YNc(11,gt,3,0,"ng-template",7,8,a.W1O),a.YNc(13,ft,4,4,"ng-template",null,9,a.W1O),a.YNc(15,Tt,2,3,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(17,"column",11),a.YNc(18,xt,4,2,"ng-template",null,12,a.W1O),a.YNc(20,yt,2,1,"ng-template",null,13,a.W1O),a.YNc(22,Et,1,2,"ng-template",null,14,a.W1O),a.qZA(),a.TgZ(24,"column",15),a.YNc(25,Zt,4,0,"ng-template",null,16,a.W1O),a.YNc(27,Ot,1,2,"ng-template",null,17,a.W1O),a.YNc(29,It,2,0,"ng-template",null,18,a.W1O),a.YNc(31,Pt,1,2,"ng-template",null,19,a.W1O),a.qZA(),a._UZ(33,"column",20),a.qZA()()),2&t){const n=a.MAs(5),l=a.MAs(7),c=a.MAs(9),m=a.MAs(12),s=a.MAs(14),_=a.MAs(16),u=a.MAs(19),h=a.MAs(21),p=a.MAs(23),C=a.MAs(26),V=a.MAs(28),x=a.MAs(32);a.Q6J("items",e.items)("form",e.form)("selectable",!1)("minHeight",e.items.length>2?0:300)("join",e.join)("groupBy",e.groupBy)("add",e.addEntrega.bind(e))("remove",e.removeEntrega.bind(e))("save",e.saveEntrega.bind(e))("load",e.loadEntrega.bind(e))("saveEnd",e.saveEndEntrega.bind(e))("hasDelete",!e.disabled&&e.planoTrabalhoEditavel)("hasEdit",!e.disabled&&e.planoTrabalhoEditavel)("hasAdd",!e.disabled&&e.planoTrabalhoEditavel),a.xp6(3),a.Q6J("titleTemplate",n)("template",l)("editTemplate",c)("verticalAlign","middle")("width",300)("align","center"),a.xp6(7),a.Q6J("width",350)("titleTemplate",m)("template",s)("editTemplate",_)("verticalAlign","middle"),a.xp6(7),a.Q6J("titleTemplate",u)("title","% CHD")("template",h)("editTemplate",p)("width",100)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),a.xp6(7),a.Q6J("minWidth",150)("maxWidth",250)("titleTemplate",C)("template",V)("editTemplate",x)("verticalAlign","middle")("align","center")}},dependencies:[g.O5,A.M,S.a,q.b,T.V,X.m,va.Q,ta.p,O.F,Ta.C]})}const Ut=["gridAtividades"],wt=["gridDocumentos"],Jt=["tabs"],Qt=["usuario"],Nt=["programa"],St=["unidade"],qt=["tipoModalidade"],Mt=["planoEntrega"],Ft=["atividade"],Rt=["entrega"],Vt=["documentos"];function Lt(i,o){if(1&i&&(a.TgZ(0,"separator",26),a._UZ(1,"calendar-efemerides",27),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("efemerides",t.horasTotais)("partial",!1)}}function Gt(i,o){if(1&i&&(a.TgZ(0,"separator",28),a._UZ(1,"calendar-efemerides",29),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("efemerides",t.horasParciais)}}function zt(i,o){if(1&i){const t=a.EpF();a.ynx(0),a.TgZ(1,"div",4)(2,"input-workload",21),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw();return a.KtG(l.onCargaHorariaChenge(n))}),a.qZA(),a._UZ(3,"input-timer",22)(4,"input-timer",23),a.qZA(),a.YNc(5,Lt,2,2,"separator",24),a.YNc(6,Gt,2,1,"separator",25),a.BQk()}if(2&i){const t=a.oxw();a.xp6(2),a.Q6J("size",4)("unit",t.formaContagemCargaHoraria)("control",t.form.controls.carga_horaria)("unitChange",t.onFormaContagemCargaHorariaChange.bind(t)),a.xp6(1),a.Q6J("size",4)("control",t.form.controls.tempo_total),a.xp6(1),a.Q6J("size",4)("control",t.form.controls.tempo_proporcional),a.xp6(1),a.Q6J("ngIf",t.horasTotais),a.xp6(1),a.Q6J("ngIf",t.horasParciais)}}function Yt(i,o){if(1&i&&a._UZ(0,"top-alert",30),2&i){const t=a.oxw();a.Q6J("message","Antes de incluir "+t.lex.translate("entrega")+" neste "+t.lex.translate("Plano de Trabalho")+", \xe9 necess\xe1rio selecionar "+t.lex.translate("a Unidade")+" e  o "+t.lex.translate("Programa")+"!")}}function Ht(i,o){if(1&i&&(a.TgZ(0,"div"),a._UZ(1,"plano-trabalho-list-entrega",31),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("disabled",t.formDisabled)("entity",t.entity)}}function Bt(i,o){if(1&i&&(a.TgZ(0,"tab",32)(1,"separator",17),a._UZ(2,"input-switch",33)(3,"input-editor",34),a.qZA(),a.TgZ(4,"separator",35),a._UZ(5,"input-switch",36)(6,"input-editor",37),a.qZA()()),2&i){const t=a.oxw();a.Q6J("label",t.lex.translate("Texto Complementar")),a.xp6(1),a.Q6J("title","Texto complementar da "+t.lex.translate("unidade")),a.xp6(1),a.Q6J("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("na unidade")),a.xp6(1),a.Q6J("disabled",t.form.controls.editar_texto_complementar_unidade.value?void 0:"true")("dataset",t.planoDataset),a.xp6(2),a.Q6J("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("do usu\xe1rio")),a.xp6(1),a.Q6J("disabled",t.form.controls.editar_texto_complementar_usuario.value?void 0:"true")("dataset",t.planoDataset)}}function kt(i,o){if(1&i&&(a.TgZ(0,"tab",38)(1,"div",39),a._UZ(2,"documentos",40,41),a.qZA()()),2&i){const t=a.oxw(),e=a.MAs(12);a.Q6J("label",t.lex.translate("Termo")),a.xp6(2),a.Q6J("entity",t.entity)("disabled",t.formDisabled)("cdRef",t.cdRef)("needSign",t.planoTrabalhoService.needSign)("extraTags",t.planoTrabalhoService.extraTags)("editingId",t.formDisabled?void 0:t.editingId)("datasource",t.datasource)("template",null==e||null==e.selectedEntity?null:e.selectedEntity.template_tcr)}}const Wt=function(){return["afastamentos","lotacao","unidades","participacoes_programas"]},jt=function(){return["usuario_id"]},Kt=function(){return["usuario_id","programa_id","tipo_modalidade_id"]};class P extends ga.F{constructor(o){super(o,Z.p,U.t),this.injector=o,this.entregas=[],this.gestoresUnidadeExecutora=[],this.validate=(t,e)=>{let n=null;return["unidade_id","programa_id","usuario_id","tipo_modalidade_id"].indexOf(e)>=0&&!t.value?.length?n="Obrigat\xf3rio":["carga_horaria"].indexOf(e)>=0&&!t.value?n="Valor n\xe3o pode ser zero.":["data_inicio","data_fim"].includes(e)&&!this.util.isDataValid(t.value)?n="Inv\xe1lido":"data_fim"==e&&this.util.isDataValid(this.form?.controls.data_inicio.value)&&this.util.asTimestamp(t.value)<=this.util.asTimestamp(this.form.controls.data_inicio.value)?n="Menor que o in\xedcio":this.programa&&"data_inicio"==e&&t.value.getTime()<this.programa.selectedEntity?.data_inicio.getTime()?n="Menor que programa":this.programa&&"data_fim"==e&&t.value.getTime()>this.programa.selectedEntity?.data_fim.getTime()&&(n="Maior que programa"),n},this.formValidation=function(){var t=(0,d.Z)(function*(e){return""});return function(e){return t.apply(this,arguments)}}(),this.titleEdit=t=>"Editando "+this.lex.translate("Plano de Trabalho")+": "+(t?.usuario?.apelido||""),this.join=["unidade.entidade","entregas.entrega","entregas.plano_entrega_entrega:id,plano_entrega_id","usuario","programa.template_tcr","tipo_modalidade","documento","documentos.assinaturas.usuario:id,nome,apelido","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega.unidade:id,nome,sigla","entregas.reacoes.usuario:id,nome,apelido"],this.joinPrograma=["template_tcr"],this.programaDao=o.get(ma.w),this.usuarioDao=o.get(K.q),this.unidadeDao=o.get(w.J),this.documentoService=o.get(La.t),this.templateService=o.get(Ga.E),this.utilService=o.get(za.f),this.calendar=o.get(fa.o),this.allPages=o.get(_a.T),this.tipoModalidadeDao=o.get(pa.D),this.documentoDao=o.get(ua.d),this.planoTrabalhoService=o.get(Q.p),this.modalWidth=1300,this.planoDataset=this.dao.dataset(),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},unidade_id:{default:""},programa_id:{default:""},documento_id:{default:null},documentos:{default:[]},atividades:{default:[]},entregas:{default:[]},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"},editar_texto_complementar_unidade:{default:!1},editar_texto_complementar_usuario:{default:!1},unidade_texto_complementar:{default:""},usuario_texto_complementar:{default:""},criterios_avaliacao:{default:[]},criterio_avaliacao:{default:""}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!0,vigentesUnidadeExecutora:!1}}ngOnInit(){super.ngOnInit();const o=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["termos"].includes(o)?o:this.action,this.buscaGestoresUnidadeExecutora(this.entity?.unidade??null)}atualizarTcr(){this.entity=this.loadEntity();let o=this.form.controls.usuario_texto_complementar.value,t=this.form.controls.unidade_texto_complementar.value,e=this.planoTrabalhoService.atualizarTcr(this.planoTrabalho,this.entity,o,t);this.form?.controls.documento_id.setValue(e?.id),this.form?.controls.documentos.setValue(this.entity.documentos),this.datasource=e?.datasource||{},this.template=this.entity.programa?.template_tcr,this.editingId=["ADD","EDIT"].includes(e?._status||"")?e.id:void 0,this.cdRef.detectChanges()}get isTermos(){return"termos"==this.action}onUnidadeSelect(o){let t=this.unidade?.selectedEntity;this.entity.unidade=t,this.entity.unidade_id=t.id,this.form.controls.forma_contagem_carga_horaria.setValue(t?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(t?.texto_complementar_plano||""),this.unidadeDao.getById(t.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(e=>{this.buscaGestoresUnidadeExecutora(e)})}podeEditarTextoComplementar(o){return o==this.auth.unidadeGestor()?.id?void 0:"true"}onProgramaSelect(o){let t=o.entity;this.entity.programa_id=t.id,this.entity.programa=t,this.form?.controls.criterios_avaliacao.setValue(t.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity(),this.calculaTempos(),this.cdRef.detectChanges()}onUsuarioSelect(o){var t=this;this.form.controls.usuario_texto_complementar.setValue(o.entity?.texto_complementar_plano||""),this.form?.controls.unidade_id.value||o.entity.unidades?.every(function(){var e=(0,d.Z)(function*(n){if(o.entity.lotacao.unidade_id==n.id){if(!t.form?.controls.programa_id.value){n.path.split("/").reverse();let m=0,s=0;for(;0==m;)yield t.programaDao.query({where:[["vigentesUnidadeExecutora","==",t.auth.unidade.id]]}).asPromise().then(_=>{_.length>0&&0==m&&(m=1,t.preencheUnidade(n),t.preenchePrograma(_[0]))}),s+=1}return!1}return!0});return function(n){return e.apply(this,arguments)}}()),this.calculaTempos(),this.cdRef.detectChanges()}preencheUnidade(o){this.form?.controls.unidade_id.setValue(o.id),this.entity.unidade=o,this.entity.unidade_id=o.id,this.form.controls.forma_contagem_carga_horaria.setValue(o?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(o?.texto_complementar_plano||""),this.unidadeDao.getById(o.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(t=>{this.buscaGestoresUnidadeExecutora(t)})}preenchePrograma(o){this.form?.controls.programa_id.setValue(o.id),this.entity.programa_id=o.id,this.entity.programa=o,this.form?.controls.criterios_avaliacao.setValue(o.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity()}onDataInicioChange(o){this.calculaTempos()}onDataFimChange(o){this.calculaTempos()}onCargaHorariaChenge(o){this.calculaTempos()}calculaTempos(){const o=this.form?.controls.data_inicio.value,t=this.form?.controls.data_fim.value,e=this.form?.controls.carga_horaria.value||8,n=this.usuario?.selectedEntity,l=this.unidade?.selectedEntity;n&&l&&this.util.isDataValid(o)&&this.util.isDataValid(t)&&this.util.asTimestamp(o)<this.util.asTimestamp(t)&&this.calendar.loadFeriadosCadastrados(l.id).then(c=>{this.horasTotais=this.calendar.calculaDataTempoUnidade(o,t,e,l,"ENTREGA",[],[]),this.horasParciais=this.calendar.calculaDataTempoUnidade(o,t,e,l,"ENTREGA",[],n.afastamentos),this.form?.controls.tempo_total.setValue(this.horasTotais.tempoUtil),this.form?.controls.tempo_proporcional.setValue(this.horasParciais.tempoUtil)})}loadData(o,t){var e=this;return(0,d.Z)(function*(){e.planoTrabalho=new Z.p(o),yield Promise.all([e.calendar.loadFeriadosCadastrados(o.unidade_id),e.usuario?.loadSearch(o.usuario||o.usuario_id),e.unidade?.loadSearch(o.unidade||o.unidade_id),e.programa?.loadSearch(o.programa||o.programa_id),e.tipoModalidade?.loadSearch(o.tipo_modalidade||o.tipo_modalidade_id)]);let n=Object.assign({},t.value);t.patchValue(e.util.fillForm(n,o)),e.calculaTempos(),e.atualizarTcr()})()}initializeData(o){var t=this;return(0,d.Z)(function*(){if(t.isTermos)t.entity=yield t.dao.getById(t.urlParams.get("id"),t.join);else{t.entity=new Z.p,t.entity.carga_horaria=t.auth.entidade?.carga_horaria_padrao||8,t.entity.forma_contagem_carga_horaria=t.auth.entidade?.forma_contagem_carga_horaria||"DIA",t.entity.unidade_id=t.auth.unidade.id;let n=yield t.programaDao.query({where:[["vigentesUnidadeExecutora","==",t.auth.unidade.id]],join:t.joinPrograma}).asPromise(),l=n[n.length-1];t.preenchePrograma(l),t.buscaGestoresUnidadeExecutora(t.auth.unidade),t.gestoresUnidadeExecutora.includes(t.auth.unidade.id)||(t.entity.usuario_id=t.auth.usuario.id)}yield t.loadData(t.entity,t.form);let e=new Date;e.setHours(0,0,0,0),t.form?.controls.data_inicio.setValue(e),t.form?.controls.data_fim.setValue("")})()}loadEntity(){let o=this.util.fill(new Z.p,this.entity);return o=this.util.fillForm(o,this.form.value),o.usuario=this.usuario.selectedEntity||this.entity?.usuario,o.unidade=this.unidade?.selectedEntity||this.entity?.unidade,o.programa=this.programa?.selectedEntity||this.entity?.programa,o.tipo_modalidade=this.tipoModalidade.selectedEntity||this.entity?.tipo_modalidade,o}saveData(o){var t=this;return(0,d.Z)(function*(){t.submitting=!0;try{t.atualizarTcr(),t.documentos?.saveData(),t.submitting=!0,t.entity.documentos=t.entity.documentos.filter(l=>["ADD","EDIT","DELETE"].includes(l._status||""));let e=[t.dao.save(t.entity,t.join)];t.form.controls.editar_texto_complementar_unidade.value&&e.push(t.unidadeDao.update(t.entity.unidade_id,{texto_complementar_plano:t.form.controls.unidade_texto_complementar.value})),t.form.controls.editar_texto_complementar_usuario.value&&e.push(t.usuarioDao.update(t.entity.usuario_id,{texto_complementar_plano:t.form.controls.usuario_texto_complementar.value}));let n=yield Promise.all(e);t.entity=n[0]}finally{t.submitting=!1}return!0})()}onTabSelect(o){"TERMO"==o.key&&this.atualizarTcr()}documentoDynamicButtons(o){let t=[],e=o;return this.isTermos&&this.planoTrabalhoService.needSign(this.entity,e)&&t.push({hint:"Assinar",icon:"bi bi-pen",onClick:this.signDocumento.bind(this)}),t.push({hint:"Preview",icon:"bi bi-zoom-in",onClick:(n=>{this.dialog.html({title:"Termo de ades\xe3o",modalWidth:1e3},n.conteudo||"")}).bind(this)}),t}signDocumento(o){var t=this;return(0,d.Z)(function*(){yield t.documentoService.sign([o]),t.cdRef.detectChanges()})()}get formaContagemCargaHoraria(){const o=this.form?.controls.forma_contagem_carga_horaria.value||"DIA";return"DIA"==o?"day":"SEMANA"==o?"week":"mouth"}onFormaContagemCargaHorariaChange(o){this.form.controls.forma_contagem_carga_horaria.setValue("day"==o?"DIA":"week"==o?"SEMANA":"MES")}isVigente(o){return this.form.controls.documento_id.value==o.id}buscaGestoresUnidadeExecutora(o){return o&&[o.gestor?.usuario_id,...o.gestores_substitutos?.map(t=>t.usuario_id),...o.gestores_delegados?.map(t=>t.usuario_id)].forEach(t=>{t&&this.gestoresUnidadeExecutora.push(t)}),this.gestoresUnidadeExecutora}static#a=this.\u0275fac=function(t){return new(t||P)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:P,selectors:[["plano-trabalho-form"]],viewQuery:function(t,e){if(1&t&&(a.Gf(E.Q,5),a.Gf(Ut,5),a.Gf(wt,5),a.Gf(Jt,5),a.Gf(Qt,5),a.Gf(Nt,5),a.Gf(St,5),a.Gf(qt,5),a.Gf(Mt,5),a.Gf(Ft,5),a.Gf(Rt,5),a.Gf(Vt,5)),2&t){let n;a.iGM(n=a.CRH())&&(e.editableForm=n.first),a.iGM(n=a.CRH())&&(e.gridAtividades=n.first),a.iGM(n=a.CRH())&&(e.gridDocumentos=n.first),a.iGM(n=a.CRH())&&(e.tabs=n.first),a.iGM(n=a.CRH())&&(e.usuario=n.first),a.iGM(n=a.CRH())&&(e.programa=n.first),a.iGM(n=a.CRH())&&(e.unidade=n.first),a.iGM(n=a.CRH())&&(e.tipoModalidade=n.first),a.iGM(n=a.CRH())&&(e.planoEntrega=n.first),a.iGM(n=a.CRH())&&(e.atividade=n.first),a.iGM(n=a.CRH())&&(e.entrega=n.first),a.iGM(n=a.CRH())&&(e.documentos=n.first)}},features:[a.qOj],decls:24,vars:36,consts:[["initialFocus","plano_entrega_id",3,"form","disabled","noButtons","submit","cancel"],["display","","right","",3,"hidden","title","select"],["tabs",""],["key","DADOS","label","Dados"],[1,"row"],[1,"col-md-12"],["required","","controlName","usuario_id",3,"size","disabled","dao","join","select"],["usuario",""],["required","","controlName","unidade_id",3,"size","disabled","dao","select"],["unidade",""],["icon","bi bi-file-bar-graph","required","","controlName","programa_id",3,"size","label","disabled","join","dao","metadata","select"],["programa",""],["label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","required","",3,"size","control","labelInfo","change"],["label","Final","icon","bi bi-calendar-date","controlName","data_fim","required","",3,"size","control","labelInfo","change"],["controlName","tipo_modalidade_id","required","",3,"size","dao"],["tipoModalidade",""],[4,"ngIf"],[3,"title"],["type","warning",3,"message",4,"ngIf"],["key","MENSAGENS",3,"label",4,"ngIf"],["key","TERMO",3,"label",4,"ngIf"],["label","Carga Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria","labelInfo","Carga hor\xe1ria do usu\xe1rio (M\xe1x.: di\xe1ria 24 horas; semana 24*5=240 horas; mensal 24*20=480 horas)","required","",3,"size","unit","control","unitChange","change"],["onlyHours","","disabled","","label","Horas Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["onlyHours","","disabled","","label","Horas Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["title","C\xe1lculos das horas totais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas parciais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas totais","collapse",""],[3,"efemerides","partial"],["title","C\xe1lculos das horas parciais","collapse",""],[3,"efemerides"],["type","warning",3,"message"],["noPersist","",3,"disabled","entity"],["key","MENSAGENS",3,"label"],["controlName","editar_texto_complementar_unidade","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","unidade_texto_complementar",3,"disabled","dataset"],["title","Texto complementar do usuario"],["controlName","editar_texto_complementar_usuario","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","usuario_texto_complementar",3,"disabled","dataset"],["key","TERMO",3,"label"],["clss","row"],["noPersist","","especie","TCR",3,"entity","disabled","cdRef","needSign","extraTags","editingId","datasource","template"],["documentos",""]],template:function(t,e){if(1&t&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),a.TgZ(1,"tabs",1,2)(3,"tab",3)(4,"div",4)(5,"div",5)(6,"div",4)(7,"input-search",6,7),a.NdJ("select",function(l){return e.onUsuarioSelect(l)}),a.qZA(),a.TgZ(9,"input-search",8,9),a.NdJ("select",function(l){return e.onUnidadeSelect(l)}),a.qZA(),a.TgZ(11,"input-search",10,11),a.NdJ("select",function(l){return e.onProgramaSelect(l)}),a.qZA()(),a.TgZ(13,"div",4)(14,"input-datetime",12),a.NdJ("change",function(l){return e.onDataInicioChange(l)}),a.qZA(),a.TgZ(15,"input-datetime",13),a.NdJ("change",function(l){return e.onDataFimChange(l)}),a.qZA(),a._UZ(16,"input-search",14,15),a.qZA(),a.YNc(18,zt,7,10,"ng-container",16),a.qZA()(),a.TgZ(19,"separator",17),a.YNc(20,Yt,1,1,"top-alert",18),a.YNc(21,Ht,2,2,"div",16),a.qZA()(),a.YNc(22,Bt,7,12,"tab",19),a.YNc(23,kt,4,9,"tab",20),a.qZA()()),2&t){const n=a.MAs(17);a.Q6J("form",e.form)("disabled",e.formDisabled)("noButtons",e.isTermos?"true":void 0),a.xp6(1),a.Q6J("hidden",e.isTermos?"true":void 0)("title",e.isModal?"":e.title)("select",e.onTabSelect.bind(e)),a.xp6(6),a.Q6J("size",4)("disabled","new"==e.action?void 0:"true")("dao",e.usuarioDao)("join",a.DdM(33,Wt)),a.xp6(2),a.Q6J("size",4)("disabled","new"==e.action?void 0:"true")("dao",e.unidadeDao),a.xp6(2),a.Q6J("size",4)("label",e.lex.translate("Programa de gest\xe3o"))("disabled","new"==e.action?void 0:"true")("join",e.joinPrograma)("dao",e.programaDao)("metadata",e.programaMetadata),a.xp6(3),a.Q6J("size",3)("control",e.form.controls.data_inicio)("labelInfo","In\xedcio da Vig\xeancia do "+e.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",3)("control",e.form.controls.data_fim)("labelInfo","Final da Vig\xeancia do "+e.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",6)("dao",e.tipoModalidadeDao),a.xp6(2),a.Q6J("ngIf",null==n.selectedEntity?null:n.selectedEntity.plano_trabalho_calcula_horas),a.xp6(1),a.Q6J("title",e.lex.translate("Entregas")+e.lex.translate(" do plano de trabalho")),a.xp6(1),a.Q6J("ngIf",!(null!=e.form.controls.programa_id.value&&e.form.controls.programa_id.value.length&&null!=e.form.controls.unidade_id.value&&e.form.controls.unidade_id.value.length)),a.xp6(1),a.Q6J("ngIf",(null==e.form.controls.programa_id.value?null:e.form.controls.programa_id.value.length)&&(null==e.form.controls.unidade_id.value?null:e.form.controls.unidade_id.value.length)),a.xp6(1),a.Q6J("ngIf",e.checkFilled(a.DdM(34,jt))),a.xp6(1),a.Q6J("ngIf",e.checkFilled(a.DdM(35,Kt)))}},dependencies:[g.O5,E.Q,J.a,T.V,L.k,Ya.u,z.n,$.i,D.N,Ha.o,ha.S,Ba.G,ka.Y,Wa.N,I]})}var xa=r(89997),oa=r(57765),ya=r(2729),Xt=r(55736);function $t(i,o){if(1&i&&a._UZ(0,"i"),2&i){const t=a.oxw();a.Tol(t.icon)}}const Ea=function(i){return{data:i}};function ae(i,o){if(1&i&&a.GkF(0,5),2&i){const t=a.oxw();a.Q6J("ngTemplateOutlet",t.titleTemplate)("ngTemplateOutletContext",a.VKq(2,Ea,t.data))}}function te(i,o){if(1&i&&a.GkF(0,5),2&i){const t=a.oxw(2);a.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",a.VKq(2,Ea,t.data))}}function ee(i,o){if(1&i&&(a.TgZ(0,"div",6),a.YNc(1,te,1,4,"ng-container",3),a.Hsn(2),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("ngIf",t.template)}}const oe=["*"];class Y extends Xt.V{set class(o){this._class!=o&&(this._class=o)}get class(){return"card m-3 "+this.getClassBorderColor(this.color)+this._class}constructor(o){super(o),this.injector=o,this.collapsed=!0}ngOnInit(){}onHeaderClick(){this.collapsed=!this.collapsed,this.cdRef.detectChanges()}get style(){return this.getStyleBgColor(this.color)}static#a=this.\u0275fac=function(t){return new(t||Y)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:Y,selectors:[["collapse-card"]],inputs:{title:"title",data:"data",icon:"icon",collapsed:"collapsed",color:"color",template:"template",titleTemplate:"titleTemplate",class:"class"},features:[a.qOj],ngContentSelectors:oe,decls:7,vars:6,consts:[[1,"card","border-primary","m-3"],["role","button",1,"card-header",3,"click"],[3,"class",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],["class","card-body text-primary",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"card-body","text-primary"]],template:function(t,e){1&t&&(a.F$t(),a.TgZ(0,"div",0)(1,"div",1),a.NdJ("click",function(){return e.onHeaderClick()}),a.YNc(2,$t,1,2,"i",2),a._uU(3),a.YNc(4,ae,1,4,"ng-container",3),a._UZ(5,"i"),a.qZA(),a.YNc(6,ee,3,1,"div",4),a.qZA()),2&t&&(a.xp6(2),a.Q6J("ngIf",e.icon),a.xp6(1),a.hij(" ",e.title||""," "),a.xp6(1),a.Q6J("ngIf",e.titleTemplate),a.xp6(1),a.Tol("collapse-card-toggle-icon "+(e.collapsed?"bi bi-chevron-down":"bi bi-chevron-up")),a.xp6(1),a.Q6J("ngIf",!e.collapsed))},dependencies:[g.O5,g.tP],styles:[".card-header[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transition:.3s transform ease-in-out}.card-header[_ngcontent-%COMP%]   .collapsed[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transform:rotate(90deg)}.collapse-card-toggle-icon[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}"]})}var ie=r(90058),ia=r(17046),ne=r(64368);class Za extends ne.X{constructor(o){super(),this.data_inicio=new Date,this.data_fim=new Date,this.status="INCLUIDO",this.avaliacoes=[],this.status_historico=[],this.plano_trabalho_id="",this.avaliacao_id=null,this.initialization(o)}}var Da=r(41095),Oa=r(56486),le=r(73101),re=r(22981),se=r(77447),de=r(84971),ce=r(57338),ue=r(39373),me=r(56976);class M extends me.B{constructor(o){super("Comparecimento",o),this.injector=o,this.inputSearchConfig.searchFields=["data_comparecimento"]}static#a=this.\u0275fac=function(t){return new(t||M)(a.LFG(a.zs3))};static#t=this.\u0275prov=a.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"})}var pe=r(25034),_e=r(17819),ge=r(69756),he=r(9224),fe=r(81419),Ia=r(72504),be=r(62095);const ve=["gridEntregas"],Te=["gridAtividades"],Ae=["etiqueta"],Ce=["tipoAtividade"],xe=["listTarefas"];function ye(i,o){if(1&i&&(a.TgZ(0,"span",34),a._UZ(1,"i",35),a._uU(2),a.qZA()),2&i){const t=a.oxw().row;a.xp6(2),a.hij(" ",null==t.atividades?null:t.atividades.length,"")}}function Ee(i,o){if(1&i&&a.YNc(0,ye,3,1,"span",33),2&i){const t=o.row;a.Q6J("ngIf",null==t.atividades?null:t.atividades.length)}}function Ze(i,o){if(1&i&&(a.TgZ(0,"span",34),a._UZ(1,"i",35),a._uU(2),a.qZA()),2&i){const t=a.oxw().row;a.xp6(2),a.hij(" ",null==t.tarefas?null:t.tarefas.length,"")}}function De(i,o){if(1&i&&a.YNc(0,Ze,3,1,"span",33),2&i){const t=o.row;a.Q6J("ngIf",null==t.tarefas?null:t.tarefas.length)}}function Oe(i,o){if(1&i&&a._UZ(0,"atividade-list-tarefa",52,53),2&i){const t=o.row;a.Q6J("atividade",t)("consolidacao",!1)}}function Ie(i,o){if(1&i&&(a.TgZ(0,"span",54),a._UZ(1,"badge",55),a.qZA(),a.TgZ(2,"span",56),a._uU(3),a.qZA(),a._UZ(4,"reaction",57)),2&i){const t=o.row,e=a.oxw(2);a.xp6(1),a.Q6J("label",t.numero)("data",t.numero)("click",e.atividadeService.onIdClick.bind(e)),a.xp6(2),a.Oqu(t.descricao),a.xp6(1),a.Q6J("entity",t)}}function Pe(i,o){if(1&i&&a._UZ(0,"input-textarea",58),2&i){const t=a.oxw(2);a.Q6J("size",12)("rows",2)("control",t.formAtividade.controls.descricao)}}function Ue(i,o){if(1&i&&a._UZ(0,"badge",61),2&i){const t=o.$implicit;a.Q6J("badge",t)}}function we(i,o){if(1&i&&(a.TgZ(0,"div",59),a.YNc(1,Ue,1,1,"badge",60),a.qZA()),2&i){const t=o.row,e=a.oxw(2);a.xp6(1),a.Q6J("ngForOf",e.tempoAtividade(t))}}function Je(i,o){if(1&i&&(a.TgZ(0,"separator",62),a._UZ(1,"input-datetime",63)(2,"input-datetime",64),a.qZA()),2&i){const t=a.oxw(2);a.Q6J("collapsed",!0),a.xp6(1),a.Q6J("control",t.formAtividade.controls.data_inicio),a.xp6(1),a.Q6J("control",t.formAtividade.controls.data_entrega)}}function Qe(i,o){if(1&i&&a._UZ(0,"badge",69),2&i){const t=o.$implicit;a.Q6J("lookup",t)}}function Ne(i,o){1&i&&a._UZ(0,"separator",70)}function Se(i,o){1&i&&a._UZ(0,"i",74)}function qe(i,o){if(1&i&&(a.TgZ(0,"tr")(1,"td"),a.YNc(2,Se,1,0,"i",72),a.qZA(),a.TgZ(3,"td",73),a._uU(4),a.qZA()()),2&i){const t=o.$implicit;a.xp6(2),a.Q6J("ngIf",t.checked),a.xp6(2),a.Oqu(t.texto)}}function Me(i,o){if(1&i&&(a.TgZ(0,"table"),a.YNc(1,qe,5,2,"tr",71),a.qZA()),2&i){const t=a.oxw().row;a.xp6(1),a.Q6J("ngForOf",t.checklist)}}function Fe(i,o){if(1&i&&(a._UZ(0,"progress-bar",65),a.YNc(1,Qe,1,1,"badge",66),a.YNc(2,Ne,1,0,"separator",67),a.YNc(3,Me,2,1,"table",68)),2&i){const t=o.row;a.Q6J("value",t.progresso),a.xp6(1),a.Q6J("ngForOf",t.etiquetas),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function Re(i,o){1&i&&a._UZ(0,"separator",70)}function Ve(i,o){if(1&i&&(a.TgZ(0,"tr")(1,"td"),a._UZ(2,"input-switch",79),a.qZA(),a.TgZ(3,"td",73),a._uU(4),a.qZA()()),2&i){const t=o.$implicit,e=o.index,n=a.oxw(4);a.xp6(2),a.Q6J("size",12)("source",n.checklist)("path",e+".checked"),a.xp6(2),a.Oqu(t.texto)}}function Le(i,o){if(1&i&&(a.TgZ(0,"table"),a.YNc(1,Ve,5,4,"tr",71),a.qZA()),2&i){const t=a.oxw(3);a.xp6(1),a.Q6J("ngForOf",t.checklist)}}function Ge(i,o){if(1&i){const t=a.EpF();a._UZ(0,"input-number",75),a.TgZ(1,"input-multiselect",76)(2,"input-select",77,78),a.NdJ("details",function(){a.CHM(t);const n=a.oxw(2);return a.KtG(n.onEtiquetaConfigClick())}),a.qZA()(),a.YNc(4,Re,1,0,"separator",67),a.YNc(5,Le,2,1,"table",68)}if(2&i){const t=o.row,e=a.oxw(2);a.Q6J("size",12)("decimals",2)("control",e.formEdit.controls.progresso),a.xp6(1),a.Q6J("size",12)("control",e.formEdit.controls.etiquetas)("addItemHandle",e.addItemHandleEtiquetas.bind(e)),a.xp6(1),a.Q6J("size",12)("control",e.formEdit.controls.etiqueta)("items",e.etiquetas),a.xp6(2),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function ze(i,o){if(1&i&&a._UZ(0,"badge",84),2&i){const t=o.$implicit;a.Q6J("data",t)("color",t.color)("icon",t.icon)("label",t.label)}}function Ye(i,o){if(1&i&&a._UZ(0,"comentarios-widget",85),2&i){const t=a.oxw().row;a.oxw();const e=a.MAs(1);a.Q6J("entity",t)("selectable",!1)("grid",e)}}function He(i,o){if(1&i&&(a._UZ(0,"documentos-badge",80),a.TgZ(1,"span",81),a.YNc(2,ze,1,4,"badge",82),a.qZA(),a.YNc(3,Ye,1,3,"comentarios-widget",83)),2&i){const t=o.row;a.oxw();const e=a.MAs(1),n=a.oxw();a.Q6J("documento",t.documento_requisicao),a.xp6(2),a.Q6J("ngForOf",n.atividadeService.getStatus(t,n.entity)),a.xp6(1),a.Q6J("ngIf",!e.editing)}}const Be=function(){return{abrirEmEdicao:!0}};function ke(i,o){if(1&i&&(a.TgZ(0,"grid",36,37)(2,"columns")(3,"column",38),a.YNc(4,De,1,1,"ng-template",null,39,a.W1O),a.YNc(6,Oe,2,2,"ng-template",null,40,a.W1O),a.qZA(),a.TgZ(8,"column",41),a.YNc(9,Ie,5,5,"ng-template",null,42,a.W1O),a.YNc(11,Pe,1,3,"ng-template",null,43,a.W1O),a.qZA(),a.TgZ(13,"column",44),a.YNc(14,we,2,1,"ng-template",null,45,a.W1O),a.YNc(16,Je,3,3,"ng-template",null,46,a.W1O),a.qZA(),a.TgZ(18,"column",47),a.YNc(19,Fe,4,4,"ng-template",null,48,a.W1O),a.YNc(21,Ge,6,11,"ng-template",null,49,a.W1O),a.qZA(),a.TgZ(23,"column",44),a.YNc(24,He,4,3,"ng-template",null,50,a.W1O),a.qZA(),a._UZ(26,"column",51),a.qZA()()),2&i){const t=o.row,e=a.MAs(5),n=a.MAs(7),l=a.MAs(10),c=a.MAs(12),m=a.MAs(15),s=a.MAs(17),_=a.MAs(20),u=a.MAs(22),h=a.MAs(25),p=a.oxw();a.Q6J("items",t.atividades)("minHeight",0)("form",p.formAtividade)("hasAdd",!p.disabled)("hasDelete",!1)("hasEdit",!1)("add",p.addAtividade.bind(p,t.entrega))("load",p.loadAtividade.bind(p))("remove",p.removeAtividade.bind(p,t.atividades))("save",p.saveAtividade.bind(p)),a.xp6(3),a.Q6J("width",50)("align","center")("hint","Tarefas da "+p.lex.translate("atividade"))("template",e)("expandTemplate",n),a.xp6(5),a.Q6J("title","#ID/Trabalho executado")("width",400)("template",l)("editTemplate",c)("columnEditTemplate",c)("edit",p.onColumnAtividadeDescricaoEdit.bind(p))("save",p.onColumnAtividadeDescricaoSave.bind(p))("metadata",a.DdM(41,Be)),a.xp6(5),a.Q6J("title","In\xedcio e Conclus\xe3o")("width",250)("template",m)("editTemplate",s),a.xp6(5),a.Q6J("title","Progresso\nEtiquetas/Checklist")("width",200)("template",_)("editTemplate",_)("columnEditTemplate",u)("edit",p.onColumnProgressoEtiquetasChecklistEdit.bind(p))("save",p.onColumnProgressoEtiquetasChecklistSave.bind(p)),a.xp6(5),a.Q6J("title","n\xba Processo/Status\nComent\xe1rios")("width",300)("template",h)("editTemplate",h),a.xp6(3),a.Q6J("metadata",p.atividadeOptionsMetadata)("dynamicOptions",p.atividadeService.dynamicOptions.bind(p))("dynamicButtons",p.atividadeService.dynamicButtons.bind(p))}}function We(i,o){if(1&i&&a._UZ(0,"badge",86),2&i){const t=o.row;a.Q6J("label",t.badge.titulo)("color",t.badge.cor)}}function je(i,o){if(1&i&&(a._uU(0),a._UZ(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA(),a._UZ(4,"reaction",87)),2&i){const t=o.row;a.hij(" ",t.badge.descricao||t.entrega.descricao,""),a.xp6(3),a.Oqu(t.entrega.descricao),a.xp6(1),a.Q6J("entity",t.entrega)}}function Ke(i,o){if(1&i&&a._UZ(0,"badge",88),2&i){const t=o.row;a.Q6J("label",t.entrega.forca_trabalho+"%")}}function Xe(i,o){if(1&i&&a._UZ(0,"badge",89)(1,"br")(2,"badge",90),2&i){const t=o.row;a.Q6J("textValue",t.meta),a.xp6(2),a.Q6J("textValue",t.metaRealizado)}}function $e(i,o){if(1&i&&a._UZ(0,"progress-bar",65),2&i){const t=o.row;a.Q6J("value",t.progresso_realizado)}}function ao(i,o){if(1&i&&(a._UZ(0,"badge",91),a._uU(1)),2&i){const t=o.row;a.Q6J("color",t.tipo_motivo_afastamento.cor)("icon",t.tipo_motivo_afastamento.icone)("label",t.tipo_motivo_afastamento.nome),a.xp6(1),a.hij(" ",t.observacao," ")}}function to(i,o){if(1&i&&a._UZ(0,"badge",92),2&i){const t=o.row,e=a.oxw();a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",t.unidade.sigla)("textValue",t.unidade.nome)}}function eo(i,o){if(1&i&&a._UZ(0,"input-search",93,94),2&i){const t=a.oxw();a.Q6J("size",6)("dao",t.unidadeDao)}}class F extends N.D{set noPersist(o){super.noPersist=o}get noPersist(){return super.noPersist}set control(o){super.control=o}get control(){return super.control}set entity(o){super.entity=o,this.bindEntity()}get entity(){return super.entity}set disabled(o){(this._disabled!=o||this.atividadeOptionsMetadata.disabled!==o)&&(this._disabled=o,this.atividadeOptionsMetadata.disabled=o,this.cdRef.detectChanges())}get disabled(){return this._disabled}constructor(o){super(o),this.injector=o,this.joinAtividade=["demandante","usuario","tipo_atividade","comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.itemsEntregas=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.itemsOcorrencias=[],this.itemsComparecimentos=[],this.itemsAfastamentos=[],this._disabled=!0,this.validateAtividade=(t,e)=>{let n=null;return["descricao"].indexOf(e)>=0&&!t.value?.length?n="Obrigat\xf3rio":["data_inicio","data_entrega"].includes(e)&&!this.util.isDataValid(t.value)?n="Inv\xe1lido":"data_inicio"==e&&t.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()||"data_entrega"==e&&t.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()?n="Menor que distribui\xe7\xe3o":"data_entrega"==e&&t.value.getTime()<this.formAtividade?.controls.data_inicio.value.getTime()&&(n="Menor que in\xedcio"),n},this.validateComparecimento=(t,e)=>{let n=null;return["detalhamento","unidade_id"].indexOf(e)>=0&&!t.value?.length?n="Obrigat\xf3rio":"data_comparecimento"==e&&this.entity&&!this.util.between(t.value,{start:this.entity.data_inicio,end:this.entity.data_fim})&&(n="Inv\xe1lido"),n},this.cdRef=o.get(a.sBO),this.dao=o.get(ia.E),this.unidadeDao=o.get(w.J),this.comparecimentoDao=o.get(M),this.atividadeDao=o.get(de.P),this.atividadeService=o.get(ce.s),this.calendar=o.get(fa.o),this.ocorrenciaDao=o.get(pe.u),this.tipoAtividadeDao=o.get(re.Y),this.planoTrabalhoService=o.get(Q.p),this.planoEntregaService=o.get(se.f),this.pEEDao=o.get(ba.K),this.formAtividade=this.fh.FormBuilder({descricao:{default:""},etiquetas:{default:[]},checklist:{default:[]},comentarios:{default:[]},esforco:{default:0},tempo_planejado:{default:0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},data_inicio:{default:new Date},data_entrega:{default:new Date}},this.cdRef,this.validateAtividade),this.formComparecimento=this.fh.FormBuilder({data_comparecimento:{default:new Date},unidade_id:{default:""},detalhamento:{default:""}},this.cdRef,this.validateComparecimento),this.formEdit=this.fh.FormBuilder({descricao:{default:""},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.atividadeOptionsMetadata={refreshId:this.atividadeRefreshId.bind(this),removeId:this.atividadeRemoveId.bind(this),refresh:this.refresh.bind(this)}}refresh(){this.loadData(this.entity,this.form)}bindEntity(){this.entity&&(this.entity._metadata=this.entity._metadata||{},this.entity._metadata.planoTrabalhoConsolidacaoFormComponent=this)}atividadeRefreshId(o,t){this.itemsEntregas.forEach(e=>{let n=e.atividades.findIndex(l=>l.id==o);n>=0&&(t?e.atividades[n]=t:this.atividadeDao.getById(o,this.joinAtividade).then(l=>{l&&(e.atividades[n]=l)}))}),this.cdRef.detectChanges()}atividadeRemoveId(o){this.itemsEntregas.forEach(t=>{let e=t.atividades.findIndex(n=>n.id==o);e>=0&&t.atividades.splice(e,1)}),this.cdRef.detectChanges()}ngAfterViewInit(){var o=this;super.ngAfterViewInit(),(0,d.Z)(function*(){yield o.loadData(o.entity,o.form)})()}loadConsolidacao(o){this.itemsEntregas=o.entregas.map(t=>(t.plano_entrega_entrega&&(t.plano_entrega_entrega.plano_entrega=o.planosEntregas.find(n=>n.id==t.plano_entrega_entrega?.plano_entrega_id)),{id:t.id,entrega:t,atividades:o.atividades.filter(n=>n.plano_trabalho_entrega_id==t.id),badge:this.planoTrabalhoService.tipoEntrega(t,o.planoTrabalho),meta:t.plano_entrega_entrega?this.planoEntregaService.getValorMeta(t.plano_entrega_entrega):"",metaRealizado:t.plano_entrega_entrega?this.planoEntregaService.getValorRealizado(t.plano_entrega_entrega):"",progresso_realizado:t.plano_entrega_entrega?t.plano_entrega_entrega.progresso_realizado:0,objetivos:t.plano_entrega_entrega?t.plano_entrega_entrega.objetivos:[],processos:t.plano_entrega_entrega?t.plano_entrega_entrega.processos:[]})),this.programa=o.programa,this.planoTrabalho=o.planoTrabalho,this.itemsOcorrencias=o.ocorrencias,this.itemsComparecimentos=o.comparecimentos,this.itemsAfastamentos=o.afastamentos,this.unidade=o.planoTrabalho.unidade||this.entity.plano_trabalho?.unidade,this.cdRef.detectChanges()}loadData(o,t){var e=this;return(0,d.Z)(function*(){e.gridEntregas.loading=!0,e.cdRef.detectChanges();try{let n=yield e.dao.dadosConsolidacao(o.id);e.loadConsolidacao(n)}finally{e.gridEntregas.loading=!1,e.cdRef.detectChanges()}})()}addAtividade(o){var t=this;return(0,d.Z)(function*(){let e=o.plano_trabalho||t.entity.plano_trabalho,n=t.calendar.calculaDataTempoUnidade(t.entity.data_inicio,t.entity.data_fim,e.carga_horaria,t.unidade,"ENTREGA");const l=t.calendar.horasUteis(t.entity.data_inicio,t.entity.data_fim,e.carga_horaria,t.unidade,"DISTRIBUICAO"),c=t.util.maxDate(t.util.setTime(t.entity.data_inicio,0,0,0),e.data_inicio),m=t.util.minDate(t.util.setTime(t.entity.data_fim,23,59,59),e.data_fim);let s=t.dao.generateUuid();return new le.a({id:s,plano_trabalho:e,plano_trabalho_entrega:o,plano_trabalho_consolidacao:t.entity,demandante:t.auth.usuario,usuario:t.auth.usuario,unidade:t.unidade,data_distribuicao:c,carga_horaria:e.carga_horaria,data_estipulada_entrega:m,data_inicio:c,data_entrega:m,tempo_planejado:l,tempo_despendido:n?.tempoUtil||0,status:"CONCLUIDO",progresso:100,plano_trabalho_id:t.entity.plano_trabalho_id,plano_trabalho_entrega_id:o.id,plano_trabalho_consolidacao_id:t.entity.id,demandante_id:t.auth.usuario.id,usuario_id:t.auth.usuario.id,unidade_id:t.unidade.id,metadados:{atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!0,concluido:!0,avaliado:!1,arquivado:!1,produtividade:0,extra:void 0,_status:[]}})})()}loadAtividade(o,t){var e=this;return(0,d.Z)(function*(){e.formAtividade.patchValue(t),e.cdRef.detectChanges()})()}removeAtividade(o,t){var e=this;return(0,d.Z)(function*(){if(!(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let l=t;return yield e.atividadeDao?.delete(l),o.splice(o.findIndex(c=>c.id==l.id),1),!0}catch{return!1}})()}saveAtividade(o,t){var e=this;return(0,d.Z)(function*(){let n;if(e.gridAtividades.error="",e.formAtividade.markAllAsTouched(),e.formAtividade.valid){t.id="NEW"==t.id?e.dao.generateUuid():t.id,e.util.fillForm(t,e.formAtividade.value),e.submitting=!0;try{n=yield e.atividadeDao?.save(t,e.joinAtividade,["etiquetas","checklist","comentarios","pausas","tarefas"]),e.atividadeRefreshId(t.id,n)}catch(l){n=!1,e.gridAtividades.error=l.message||l}finally{e.submitting=!1}}return n})()}onDataDistribuicaoChange(o){this.formAtividade.controls.data_inicio.setValue(this.formAtividade.controls.data_distribuicao.value)}onDataEstipuladaEntregaChange(o){this.formAtividade.controls.data_entrega.setValue(this.formAtividade.controls.data_estipulada_entrega.value)}atividadeDynamicButtons(o){let t=[];return t.push(Object.assign({},this.gridEntregas.BUTTON_EDIT,{})),t.push(Object.assign({},this.gridEntregas.BUTTON_DELETE,{})),t}onColumnProgressoEtiquetasChecklistEdit(o){var t=this;return(0,d.Z)(function*(){if(!t.etiquetasAscendentes.filter(e=>e.data==o.plano_trabalho.unidade.id).length){let e=yield t.carregaEtiquetasUnidadesAscendentes(o.plano_trabalho.unidade);t.etiquetasAscendentes.push(...e)}t.formEdit.controls.progresso.setValue(o.progresso),t.formEdit.controls.etiquetas.setValue(o.etiquetas),t.formEdit.controls.etiqueta.setValue(null),t.etiquetas=t.util.merge(o.tipo_atividade?.etiquetas,o.plano_trabalho.unidade?.etiquetas,(e,n)=>e.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(e,n)=>e.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(e=>e.data==o.plano_trabalho.unidade.id),(e,n)=>e.key==n.key),t.checklist=t.util.clone(o.checklist)})()}carregaEtiquetasUnidadesAscendentes(o){var t=this;return(0,d.Z)(function*(){let e=[];if((o=o||t.auth.unidade).path){let n=o.path.split("/");(yield t.unidadeDao.query({where:[["id","in",n]]}).asPromise()).forEach(c=>{e=t.util.merge(e,c.etiquetas,(m,s)=>m.key==s.key)}),e.forEach(c=>c.data=o.id)}return e})()}onColumnProgressoEtiquetasChecklistSave(o){var t=this;return(0,d.Z)(function*(){try{const e=yield t.atividadeDao.update(o.id,{progresso:t.formEdit.controls.progresso.value,etiquetas:t.formEdit.controls.etiquetas.value,checklist:t.checklist});return o.progresso=t.formEdit.controls.progresso.value,o.checklist=t.checklist,!!e}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:o=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,e)=>t.key==e.key),this.cdRef.detectChanges()}})}addItemHandleEtiquetas(){let o;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,e=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.formEdit.controls.etiquetas.value,e)&&(o={key:e,value:t.value,color:t.color,icon:t.icon},this.formEdit.controls.etiqueta.setValue(null))}return o}loadTipoAtividade(o){o?(this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade,o),this.atividadeService.buildChecklist(o,this.formAtividade.controls.checklist),this.formAtividade.controls.esforco.setValue(o?.esforco||0)):(this.etiquetas=[],this.formAtividade.controls.esforco.setValue(0)),this.cdRef.detectChanges()}onTipoAtividadeSelect(o){const t=o.entity;this.loadTipoAtividade(t),this.atividadeService.comentarioAtividade(t,this.formAtividade.controls.comentarios),this.cdRef.detectChanges()}onColumnAtividadeDescricaoEdit(o){var t=this;return(0,d.Z)(function*(){t.formAtividade.controls.descricao.setValue(o.descricao),t.formAtividade.controls.comentarios.setValue(o.comentarios)})()}onColumnAtividadeDescricaoSave(o){var t=this;return(0,d.Z)(function*(){try{t.atividadeService.comentarioAtividade(t.tipoAtividade?.selectedEntity,t.formAtividade.controls.comentarios);const e=yield t.atividadeDao.update(o.id,{descricao:t.formAtividade.controls.descricao.value,comentarios:(t.formAtividade.controls.comentarios.value||[]).filter(n=>["ADD","EDIT","DELETE"].includes(n._status||""))});return o.descricao=t.formAtividade.controls.descricao.value,o.tipo_atividade=t.tipoAtividade?.selectedEntity||null,o.comentarios=t.formAtividade.controls.comentarios.value,!!e}catch{return!1}})()}tempoAtividade(o){let t=[{color:"light",hint:"In\xedcio",icon:"bi bi-file-earmark-play",label:this.dao.getDateTimeFormatted(o.data_inicio)}],e=this.atividadeService.temposAtividade(o);return e=e.filter(n=>"bi bi-file-earmark-plus"!=n.icon&&"bi bi-calendar-check"!=n.icon),t.push(...e),t}dynamicButtons(o){let t=[];return t.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),t}showDetalhes(o){var t=this;return(0,d.Z)(function*(){let e=yield t.pEEDao.getById(o.entrega.plano_entrega_entrega.id,["entrega","objetivos.objetivo"]);t.go.navigate({route:["gestao","plano-entrega","entrega",o.entrega.plano_entrega_entrega.id,"detalhes"]},{metadata:{plano_entrega:o.entrega.plano_entrega_entrega.plano_entrega,planejamento_id:o.entrega.plano_entrega_entrega.plano_entrega.planejamento_id,cadeia_valor_id:o.entrega.plano_entrega_entrega.plano_entrega.cadeia_valor_id,unidade_id:o.entrega.plano_entrega_entrega.plano_entrega.unidade_id,entrega:e}})})()}addOcorrencia(){var o=this;return(0,d.Z)(function*(){o.go.navigate({route:["gestao","ocorrencia","new"]},{metadata:{consolidacao:o.entity,planoTrabalho:o.planoTrabalho},modalClose:t=>{t&&o.refresh()}})})()}editOcorrencia(o){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","ocorrencia",o.id,"edit"]},{modalClose:e=>{e&&t.refresh()}})})()}removeOcorrencia(o){var t=this;return(0,d.Z)(function*(){if(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")){t.submitting=!0;try{let e=o;yield t.ocorrenciaDao?.delete(e),t.itemsOcorrencias.splice(t.itemsOcorrencias.findIndex(n=>n.id==e.id),1)}finally{t.submitting=!1}}})()}ocorrenciaDynamicButtons(o){let t=[];return!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EDT")&&t.push(Object.assign({},this.OPTION_ALTERAR,{onClick:this.editOcorrencia.bind(this)})),!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EXCL")&&t.push(Object.assign({},this.OPTION_EXCLUIR,{onClick:this.removeOcorrencia.bind(this)})),t}addComparecimento(){var o=this;return(0,d.Z)(function*(){return new ue.V({unidade_id:o.unidade?.id,unidade:o.unidade,plano_trabalho_consolidacao_id:o.entity.id})})()}loadComparecimento(o,t){var e=this;return(0,d.Z)(function*(){e.formComparecimento.patchValue({data_comparecimento:t.data_comparecimento,unidade_id:t.unidade_id,detalhamento:t.detalhamento}),e.cdRef.detectChanges()})()}removeComparecimento(o){var t=this;return(0,d.Z)(function*(){if(!(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=o;return yield t.comparecimentoDao?.delete(n),t.itemsComparecimentos.splice(t.itemsComparecimentos.findIndex(l=>l.id==n.id),1),!0}catch{return!1}})()}saveComparecimento(o,t){var e=this;return(0,d.Z)(function*(){let n;if(e.formComparecimento.markAllAsTouched(),e.formComparecimento.valid){t.id="NEW"==t.id?e.dao.generateUuid():t.id,t.data_comparecimento=o.controls.data_comparecimento.value,t.detalhamento=o.controls.detalhamento.value,t.plano_trabalho_consolidacao_id=e.entity.id,t.unidade_id=o.controls.unidade_id.value,e.submitting=!0;try{n=yield e.comparecimentoDao?.save(t)}finally{e.submitting=!1}}return n})()}comparecimentoDynamicButtons(o){return[]}addAfastamento(){var o=this;return(0,d.Z)(function*(){o.go.navigate({route:["gestao","afastamento","new"]},{metadata:{consolidacao:o.entity},filterSnapshot:void 0,querySnapshot:void 0,modalClose:t=>{t&&o.refresh()}})})()}afastamentoDynamicButtons(o){let t=[];return t.push(Object.assign({},this.OPTION_INFORMACOES,{onClick:e=>this.go.navigate({route:["cadastros","afastamento",e.id,"consult"]})})),t}showPlanejamento(o){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","planejamento",o,"consult"]},{modal:!0})})()}showCadeiaValor(o){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","cadeia-valor",o,"consult"]},{modal:!0})})()}static#a=this.\u0275fac=function(t){return new(t||F)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:F,selectors:[["plano-trabalho-consolidacao-form"]],viewQuery:function(t,e){if(1&t&&(a.Gf(E.Q,5),a.Gf(ve,5),a.Gf(Te,5),a.Gf(Ae,5),a.Gf(Ce,5),a.Gf(xe,5)),2&t){let n;a.iGM(n=a.CRH())&&(e.editableForm=n.first),a.iGM(n=a.CRH())&&(e.gridEntregas=n.first),a.iGM(n=a.CRH())&&(e.gridAtividades=n.first),a.iGM(n=a.CRH())&&(e.etiqueta=n.first),a.iGM(n=a.CRH())&&(e.tipoAtividade=n.first),a.iGM(n=a.CRH())&&(e.listTarefas=n.first)}},inputs:{cdRef:"cdRef",planoTrabalho:"planoTrabalho",noPersist:"noPersist",control:"control",entity:"entity",disabled:"disabled"},features:[a.qOj],decls:55,vars:66,consts:[["collapse","",3,"collapsed","title","icon"],[3,"items","minHeight","hasEdit"],["gridEntregas",""],["type","expand",3,"width","icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["title","Origem",3,"template","width"],["columnOrigem",""],["title","Entrega",3,"template"],["columnEntrega",""],["title","% CHD Planejado",3,"template","width","titleHint"],["columnForcaTrabalho",""],[3,"title","template","width"],["columnMetaRealizado",""],["title","Progresso",3,"template","width"],["columnProgresso",""],["type","options",3,"dynamicButtons"],["editable","",3,"items","minHeight","hasDelete","hasEdit","hasAdd","add"],["gridOcorrencia",""],["title","In\xedcio","type","datetime","field","data_inicio",3,"width"],["title","Fim","type","datetime","field","data_fim",3,"width"],["title","Descri\xe7\xe3o","type","textarea","field","descricao"],["editable","",3,"items","minHeight","hasEdit","hasDelete","hasAdd","add"],["gridAfastamento",""],["title","Motivo/Observa\xe7\xe3o",3,"template"],["columnMotivoObservacao",""],["editable","",3,"items","minHeight","form","hasDelete","hasAdd","hasEdit","add","load","remove","save"],["gridComparecimento",""],["title","Data","type","date","field","data_comparecimento",3,"width"],["title","Unidade",3,"template","editTemplate"],["columnUnidade",""],["editUnidade",""],["title","Detalhamento","type","text","field","detalhamento"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["editable","",3,"items","minHeight","form","hasAdd","hasDelete","hasEdit","add","load","remove","save"],["gridAtividades",""],["type","expand","icon","bi bi-boxes",3,"width","align","hint","template","expandTemplate"],["columnTarefas",""],["columnExpandedTarefas",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save","metadata"],["columnAtividadeDescricao",""],["editAtividadeDescricao",""],[3,"title","width","template","editTemplate"],["columnTempos",""],["editTempos",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],["columnNumero",""],["type","options",3,"metadata","dynamicOptions","dynamicButtons"],["persist","",3,"atividade","consolidacao"],["listTarefas",""],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["title","In\xedcio e Conclus\xe3o","collapse","",3,"collapsed"],["icon","bi bi-play-circle","label","In\xedcio","controlName","data_inicio","labelInfo","Data de inicializa\xe7\xe3o da atividade",3,"control"],["icon","bi bi-check-circle","label","Conclus\xe3o","controlName","data_entrega","labelInfo","Data da conclus\xe3o da atividade",3,"control"],["color","success",3,"value"],[3,"lookup",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],[4,"ngIf"],[3,"lookup"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["controlName","etiquetas",3,"size","control","addItemHandle"],["label","Etiqueta","controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],["scale","small",3,"size","source","path"],[3,"documento"],[1,"d-block"],[3,"data","color","icon","label",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid",4,"ngIf"],[3,"data","color","icon","label"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"label","color"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],["color","light",3,"label"],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],[3,"color","icon","label"],["color","success",3,"icon","label","textValue"],["label","","icon","","controlName","unidade_id",3,"size","dao"],["unidade",""]],template:function(t,e){if(1&t&&(a.TgZ(0,"separator",0)(1,"grid",1,2)(3,"columns")(4,"column",3),a.YNc(5,Ee,1,1,"ng-template",null,4,a.W1O),a.YNc(7,ke,27,42,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(9,"column",6),a.YNc(10,We,1,2,"ng-template",null,7,a.W1O),a.qZA(),a.TgZ(12,"column",8),a.YNc(13,je,5,3,"ng-template",null,9,a.W1O),a.qZA(),a.TgZ(15,"column",10),a.YNc(16,Ke,1,1,"ng-template",null,11,a.W1O),a.qZA(),a.TgZ(18,"column",12),a.YNc(19,Xe,3,2,"ng-template",null,13,a.W1O),a.qZA(),a.TgZ(21,"column",14),a.YNc(22,$e,1,1,"ng-template",null,15,a.W1O),a.qZA(),a._UZ(24,"column",16),a.qZA()()(),a.TgZ(25,"separator",0)(26,"grid",17,18)(28,"columns"),a._UZ(29,"column",19)(30,"column",20)(31,"column",21)(32,"column",16),a.qZA()()(),a.TgZ(33,"separator",0)(34,"grid",22,23)(36,"columns"),a._UZ(37,"column",19)(38,"column",20),a.TgZ(39,"column",24),a.YNc(40,ao,2,4,"ng-template",null,25,a.W1O),a.qZA(),a._UZ(42,"column",16),a.qZA()()(),a.TgZ(43,"separator",0)(44,"grid",26,27)(46,"columns"),a._UZ(47,"column",28),a.TgZ(48,"column",29),a.YNc(49,to,1,3,"ng-template",null,30,a.W1O),a.YNc(51,eo,2,2,"ng-template",null,31,a.W1O),a.qZA(),a._UZ(53,"column",32)(54,"column",16),a.qZA()()()),2&t){const n=a.MAs(6),l=a.MAs(8),c=a.MAs(11),m=a.MAs(14),s=a.MAs(17),_=a.MAs(20),u=a.MAs(23),h=a.MAs(41),p=a.MAs(50),C=a.MAs(52);a.Q6J("collapsed",!1)("title",e.lex.translate("Atividades"))("icon",e.entityService.getIcon("Atividade")),a.xp6(1),a.Q6J("items",e.itemsEntregas)("minHeight",0)("hasEdit",!1),a.xp6(3),a.Q6J("width",50)("icon",e.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",e.lex.translate("Consolida\xe7\xe3o"))("template",n)("expandTemplate",l),a.xp6(5),a.Q6J("template",c)("width",200),a.xp6(3),a.Q6J("template",m),a.xp6(3),a.Q6J("template",s)("width",100)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada"),a.xp6(3),a.Q6J("title","Meta")("template",_)("width",100),a.xp6(3),a.Q6J("template",u)("width",150),a.xp6(3),a.Q6J("dynamicButtons",e.dynamicButtons.bind(e)),a.xp6(1),a.Q6J("collapsed",!1)("title",e.lex.translate("Ocorr\xeancias"))("icon",e.entityService.getIcon("PlanoTrabalhoConsolidacao")),a.xp6(1),a.Q6J("items",e.itemsOcorrencias)("minHeight",0)("hasDelete",!1)("hasEdit",!1)("hasAdd",!e.disabled)("add",e.addOcorrencia.bind(e)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("width",300),a.xp6(2),a.Q6J("dynamicButtons",e.ocorrenciaDynamicButtons.bind(e)),a.xp6(1),a.Q6J("collapsed",!1)("title",e.lex.translate("Afastamentos"))("icon",e.entityService.getIcon("Afastamento")),a.xp6(1),a.Q6J("items",e.itemsAfastamentos)("minHeight",0)("hasEdit",!1)("hasDelete",!1)("hasAdd",!e.disabled)("add",e.addAfastamento.bind(e)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("width",300),a.xp6(1),a.Q6J("template",h),a.xp6(3),a.Q6J("dynamicButtons",e.afastamentoDynamicButtons.bind(e)),a.xp6(1),a.Q6J("collapsed",!1)("title",e.lex.translate("Comparecimentos"))("icon",e.entityService.getIcon("Comparecimento")),a.xp6(1),a.Q6J("items",e.itemsComparecimentos)("minHeight",0)("form",e.formComparecimento)("hasDelete",!e.disabled)("hasAdd",!e.disabled)("hasEdit",!e.disabled)("add",e.addComparecimento.bind(e))("load",e.loadComparecimento.bind(e))("remove",e.removeComparecimento.bind(e))("save",e.saveComparecimento.bind(e)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("template",p)("editTemplate",C),a.xp6(6),a.Q6J("dynamicButtons",e.comparecimentoDynamicButtons.bind(e))}},dependencies:[g.sg,g.O5,A.M,S.a,q.b,J.a,T.V,va.Q,L.k,ta.p,_e.p,D.N,O.F,ge.R,he.l,Ta.C,fe.y,Ia.h,be.u]})}function oo(i,o){}function io(i,o){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-form",16,17),2&i){const t=o.row,e=a.oxw();a.Q6J("disabled",e.isDisabled(t))("entity",t)("planoTrabalho",e.entity)("cdRef",e.cdRef)}}function no(i,o){if(1&i&&a._uU(0),2&i){const t=o.row,e=a.oxw();a.hij(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function lo(i,o){if(1&i&&a._uU(0),2&i){const t=o.row,e=a.oxw();a.hij(" ",e.util.getDateFormatted(t.data_fim)," ")}}function ro(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"avaliar-nota-badge",20),a.NdJ("click",function(){a.CHM(t);const n=a.oxw().row,l=a.oxw();return a.KtG(l.mostrarAvaliacao(n))}),a.qZA()}if(2&i){const t=a.oxw().row,e=a.oxw();a.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao||e.entity.programa.tipo_avaliacao_plano_trabalho)("nota",t.avaliacao.nota)}}function so(i,o){if(1&i&&(a.TgZ(0,"separator",21)(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.Q6J("collapsed",!1),a.xp6(2),a.Oqu(t.avaliacao.recurso)}}function co(i,o){if(1&i&&(a.YNc(0,ro,1,3,"avaliar-nota-badge",18),a.YNc(1,so,3,2,"separator",19)),2&i){const t=o.row;a.Q6J("ngIf",t.avaliacao),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function uo(i,o){1&i&&a._UZ(0,"badge",25)}function mo(i,o){if(1&i&&(a.TgZ(0,"div",22),a._UZ(1,"badge",23),a.YNc(2,uo,1,0,"badge",24),a.qZA()),2&i){const t=o.row,e=a.oxw();a.xp6(1),a.Q6J("color",e.lookup.getColor(e.lookup.CONSOLIDACAO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.CONSOLIDACAO_STATUS,t.status))("label",e.lookup.getValue(e.lookup.CONSOLIDACAO_STATUS,t.status)),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}class R extends N.D{set entity(o){super.entity=o}get entity(){return super.entity}get items(){return this.entity?.consolidacoes||[]}constructor(o){super(o),this.injector=o,this.validate=(t,e)=>null,this.dao=o.get(ia.E),this.avaliacaoDao=o.get(Da.w),this.planoTrabalhoService=o.get(Q.p),this.unidadeService=o.get(aa.Z),this.planoTrabalhoDao=o.get(U.t),this.title=this.lex.translate("Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD",this.modalWidth=1200,this.form=this.fh.FormBuilder({data_inicio:{default:new Date},data_fim:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){var o=this;super.ngAfterViewInit(),(0,d.Z)(function*(){if(o.urlParams?.has("usuarioId")&&o.urlParams?.has("planoTrabalhoId")){let e=yield o.planoTrabalhoDao.getByUsuario(o.urlParams.get("usuarioId"),!0,o.urlParams.get("planoTrabalhoId"));1==e.planos.length&&(o.entity=e.planos[0])}let t=(new Date).getTime();o.items.forEach(e=>{e.plano_trabalho||(e.plano_trabalho=o.entity),o.util.asTimestamp(e.data_inicio)<=t&&t<=o.util.asTimestamp(e.data_fim)&&o.grid.expand(e.id)})})()}addConsolidacao(){var o=this;return(0,d.Z)(function*(){return new Za({id:o.dao.generateUuid(),plano_trabalho_id:o.entity.id})})()}loadConsolidacao(o,t){var e=this;return(0,d.Z)(function*(){e.form.patchValue({data_inicio:t.data_inicio,data_fim:t.data_fim}),e.cdRef.detectChanges()})()}removeConsolidacao(o){var t=this;return(0,d.Z)(function*(){if(!(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=o;return yield t.dao?.delete(n),t.items.splice(t.items.findIndex(l=>l.id==n.id),1),!0}catch{return!1}})()}saveConsolidacao(o,t){var e=this;return(0,d.Z)(function*(){let n;return e.form.markAllAsTouched(),e.form.valid&&(t.id="NEW"==t.id?e.dao.generateUuid():t.id,t.data_inicio=o.controls.data_inicio.value,t.data_fim=o.controls.data_fim.value,n=yield e.dao?.save(t)),n})()}refreshConsolidacao(o,t){t&&o._metadata?.planoTrabalhoConsolidacaoFormComponent?(o._metadata?.planoTrabalhoConsolidacaoFormComponent).loadConsolidacao(t):this.grid.refreshExpanded(o.id),this.grid.refreshRows()}concluir(o){var t=this;return(0,d.Z)(function*(){t.submitting=!0;try{let e=yield t.dao.concluir(o.id);o.status=e.status,t.refreshConsolidacao(o,e)}catch(e){t.error(e.message||e)}finally{t.submitting=!1}})()}cancelarConclusao(o){var t=this;return(0,d.Z)(function*(){t.submitting=!0;try{let e=yield t.dao.cancelarConclusao(o.id);o.status=e.status,t.refreshConsolidacao(o,e)}catch(e){t.error(e.message||e)}finally{t.submitting=!1}})()}anterior(o){return this.entity.consolidacoes.reduce((t,e)=>this.util.asTimestamp(e.data_inicio)<this.util.asTimestamp(o.data_inicio)&&(!t||this.util.asTimestamp(t.data_inicio)<this.util.asTimestamp(e.data_inicio))?e:t,void 0)}proximo(o){return this.entity.consolidacoes.reduce((t,e)=>this.util.asTimestamp(e.data_fim)>this.util.asTimestamp(o.data_fim)&&(!t||this.util.asTimestamp(t.data_fim)>this.util.asTimestamp(e.data_fim))?e:t,void 0)}isDisabled(o){return o&&"INCLUIDO"!=o.status||"ATIVO"!=this.entity?.status}podeInserir(){return this.auth.hasPermissionTo("MOD_PTR_CSLD_INCL")}dynamicButtons(o){let t=[],e=o;const n=e.plano_trabalho?.usuario_id,l=this.entity.unidade_id,c=this.anterior(o),m=this.proximo(o),s=this.auth.usuario.id==n,_={gestor:!1,gestorSubstituto:!1,gestorDelegado:!1},u=this.entity?._metadata.atribuicoesGestorUsuarioLogado||_,h=this.entity?._metadata.atribuicoesGestorUsuario||_,p=this.entity?._metadata.gestorUnidadeSuperior||_,C=!s&&this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL")&&(this.auth.isIntegrante("AVALIADOR_PLANO_TRABALHO",l)||h.gestor&&(p.gestor||p.gestorSubstituto)||h.gestorSubstituto&&(u.gestor||p.gestor||p.gestorSubstituto)||!h.gestor&&!h.gestorSubstituto&&(u.gestor||u.gestorSubstituto)),V={hint:"Concluir",icon:"bi bi-check-circle",color:"btn-outline-success",onClick:this.concluir.bind(this)},x={hint:"Cancelar conclus\xe3o",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:this.cancelarConclusao.bind(this)},na={hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-warning",onClick:y=>this.planoTrabalhoService.avaliar(y,this.entity.programa,this.refreshConsolidacao.bind(this))},la={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:y=>this.planoTrabalhoService.avaliar(y,this.entity.programa,this.refreshConsolidacao.bind(this))},ra={hint:"Fazer recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:y=>this.planoTrabalhoService.fazerRecurso(y,this.entity.programa,this.refreshConsolidacao.bind(this))},sa={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:y=>this.planoTrabalhoService.cancelarAvaliacao(y,this,this.refreshConsolidacao.bind(this))},f=!c||["CONCLUIDO","AVALIADO"].includes(c.status),si=!m||["INCLUIDO"].includes(m.status),Ja=!c||["AVALIADO"].includes(c.status),di=!m||["INCLUIDO","CONCLUIDO"].includes(m.status);return this.isDisabled()||("INCLUIDO"==e.status&&f&&(s||this.auth.hasPermissionTo("MOD_PTR_CSLD_CONCL"))&&t.push(V),"CONCLUIDO"==e.status&&si&&this.planoTrabalhoService.diasParaConcluirConsolidacao(o,this.entity.programa)>=0&&(s||this.auth.hasPermissionTo("MOD_PTR_CSLD_DES_CONCL"))&&t.push(x),"CONCLUIDO"==e.status&&Ja&&C&&t.push(na),"AVALIADO"==e.status&&e.avaliacao&&(s&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&e.avaliacao?.data_avaliacao&&(!this.entity.programa.dias_tolerancia_recurso_avaliacao||this.util.daystamp(e.avaliacao.data_avaliacao)+this.entity.programa.dias_tolerancia_recurso_avaliacao>this.util.daystamp(this.auth.hora))&&t.push(ra),Ja&&C&&(t.push(la),di&&t.push(sa)))),t}mostrarAvaliacao(o){this.planoTrabalhoService.fazerRecurso(o,this.entity.programa,this.refreshConsolidacao.bind(this))}static#a=this.\u0275fac=function(t){return new(t||R)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:R,selectors:[["plano-trabalho-consolidacao-list"]],viewQuery:function(t,e){if(1&t&&a.Gf(A.M,5),2&t){let n;a.iGM(n=a.CRH())&&(e.grid=n.first)}},inputs:{entity:"entity"},features:[a.qOj],decls:24,vars:20,consts:[["editable","",3,"items","form","hasDelete","minHeight","add","hasAdd","hasEdit"],["grid",""],[1,"my-2"],[1,"bi","bi-arrow-down"],["type","expand",3,"icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["title","Data in\xedcio",3,"template"],["columnDataInicio",""],["title","Data fim",3,"template"],["columnDataFim",""],["title","Estat\xedsticas/Avalia\xe7\xf5es",3,"template","width"],["columnEstatisticas",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicButtons"],[3,"disabled","entity","planoTrabalho","cdRef"],["consolidacao",""],[3,"align","tipoAvaliacao","nota","click",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota","click"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"]],template:function(t,e){if(1&t&&(a.TgZ(0,"grid",0,1)(2,"h5",2),a._uU(3),a._UZ(4,"i",3),a.qZA(),a.TgZ(5,"columns")(6,"column",4),a.YNc(7,oo,0,0,"ng-template",null,5,a.W1O),a.YNc(9,io,2,4,"ng-template",null,6,a.W1O),a.qZA(),a.TgZ(11,"column",7),a.YNc(12,no,1,1,"ng-template",null,8,a.W1O),a.qZA(),a.TgZ(14,"column",9),a.YNc(15,lo,1,1,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(17,"column",11),a.YNc(18,co,2,2,"ng-template",null,12,a.W1O),a.qZA(),a.TgZ(20,"column",13),a.YNc(21,mo,3,4,"ng-template",null,14,a.W1O),a.qZA(),a._UZ(23,"column",15),a.qZA()()),2&t){const n=a.MAs(8),l=a.MAs(10),c=a.MAs(13),m=a.MAs(16),s=a.MAs(19),_=a.MAs(22);a.Q6J("items",e.items)("form",e.form)("hasDelete",!0)("minHeight",0)("add",e.addConsolidacao.bind(e))("hasAdd",e.podeInserir())("hasEdit",!1)("hasDelete",!1),a.xp6(3),a.hij("",e.lex.translate("Consolida\xe7\xf5es")," "),a.xp6(3),a.Q6J("icon",e.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",e.lex.translate("Consolida\xe7\xe3o"))("template",n)("expandTemplate",l),a.xp6(5),a.Q6J("template",c),a.xp6(3),a.Q6J("template",m),a.xp6(3),a.Q6J("template",s)("width",300),a.xp6(3),a.Q6J("template",_),a.xp6(3),a.Q6J("dynamicButtons",e.dynamicButtons.bind(e))}},dependencies:[g.O5,A.M,S.a,q.b,D.N,O.F,Oa.M,F]})}const po=["accordion"];function _o(i,o){if(1&i&&a._UZ(0,"badge",13),2&i){const t=o.$implicit;a.Q6J("badge",t)}}function go(i,o){if(1&i&&(a.TgZ(0,"div",1)(1,"div",2),a._uU(2),a.qZA(),a.TgZ(3,"div",3),a._UZ(4,"badge",10)(5,"badge",10)(6,"badge",10)(7,"badge",10),a.qZA(),a.TgZ(8,"div",4),a._uU(9),a.qZA(),a.TgZ(10,"div",5),a.YNc(11,_o,1,1,"badge",11),a.qZA(),a.TgZ(12,"div",5),a._UZ(13,"badge",12),a.qZA()()),2&i){const t=o.item,e=a.oxw();a.xp6(2),a.Oqu("#"+t.numero),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Usuario"))("label",null==t.usuario?null:t.usuario.nome)("hint",e.lex.translate("Participante")+": "+(null==t.usuario?null:t.usuario.nome)),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",null==t.unidade?null:t.unidade.sigla)("hint",e.lex.translate("Unidade")+": "+(null==t.unidade?null:t.unidade.nome)),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("Programa"))("label",null==t.programa?null:t.programa.nome)("hint",e.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.tipo_modalidade?null:t.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade")),a.xp6(2),a.hij(" ",e.dao.getDateFormatted(t.data_inicio)+" at\xe9 "+e.dao.getDateFormatted(t.data_fim)," "),a.xp6(2),a.Q6J("ngForOf",e.getPlanoBadges(t)),a.xp6(2),a.Q6J("label",e.lookup.getValue(e.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.PLANO_TRABALHO_STATUS,t.status))("color",e.lookup.getColor(e.lookup.PLANO_TRABALHO_STATUS,t.status))}}function ho(i,o){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-list",14),2&i){const t=o.item;a.Q6J("entity",t)}}class H extends N.D{set arquivados(o){this._arquivados!=o&&(this._arquivados=o,this.viewInit&&this.loadData(this.entity,this.form))}get arquivados(){return this._arquivados}constructor(o){super(o),this.injector=o,this.selectedIndex=-1,this.planos=[],this._arquivados=!1,this.dao=o.get(U.t)}ngAfterViewInit(){var o=this;super.ngAfterViewInit(),(0,d.Z)(function*(){yield o.loadData(o.entity,o.form)})()}loadData(o,t){var e=this;return(0,d.Z)(function*(){e.accordion.loading=!0;try{let l=yield e.dao.getByUsuario(e.usuarioId,e.arquivados),c=(new Date).getTime();e.planos=l.planos;for(var n=0;n<e.planos.length;n++)e.util.asTimestamp(e.planos[n].data_inicio)<=c&&c<=e.util.asTimestamp(e.planos[n].data_fim)&&["ATIVO","CONCLUIDO"].includes(e.planos[n].status)&&(e.selectedIndex=n)}finally{e.accordion.loading=!1,e.cdRef.detectChanges()}})()}getPlanoBadges(o){let t=[],e=o.consolidacoes.filter(l=>"CONCLUIDO"==l.status),n=o.consolidacoes.filter(l=>"AVALIADO"==l.status);if(e.length){const l=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"CONCLUIDO");t.push({icon:l?.icon,label:l?.value,color:l?.color,textValue:e.length.toString()})}if(n.length){const l=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"AVALIADO");t.push({icon:l?.icon,label:l?.value,color:l?.color,textValue:n.length.toString()})}return JSON.stringify(o._metadata?.badges)!=this.JSON.stringify(t)&&(o._metadata=Object.assign(o._metadata||{},{badges:t})),o._metadata.badges}static#a=this.\u0275fac=function(t){return new(t||H)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:H,selectors:[["plano-trabalho-list-accordeon"]],viewQuery:function(t,e){if(1&t&&a.Gf(po,5),2&t){let n;a.iGM(n=a.CRH())&&(e.accordion=n.first)}},inputs:{usuarioId:"usuarioId",arquivados:"arquivados"},features:[a.qOj],decls:17,vars:8,consts:[[1,"p-3","bg-body-secondary","mb-3"],[1,"row","w-100"],[1,"col-md-1"],[1,"col-md-4"],[1,"col-md-3"],[1,"col-md-2"],[3,"items","selectedIndex","titleTemplate","template"],["accordion",""],["planoTrabalhoSectionTitle",""],["planoTrabalhoSection",""],["color","light",3,"icon","label","hint"],[3,"badge",4,"ngFor","ngForOf"],[3,"label","icon","color"],[3,"badge"],[3,"entity"]],template:function(t,e){if(1&t&&(a.TgZ(0,"div",0)(1,"div",1)(2,"div",2),a._uU(3,"#ID"),a.qZA(),a.TgZ(4,"div",3),a._uU(5),a.qZA(),a.TgZ(6,"div",4),a._uU(7,"Vig\xeancia"),a.qZA(),a._UZ(8,"div",5),a.TgZ(9,"div",5),a._uU(10,"Status"),a.qZA()()(),a.TgZ(11,"accordion",6,7),a.YNc(13,go,14,18,"ng-template",null,8,a.W1O),a.YNc(15,ho,1,1,"ng-template",null,9,a.W1O),a.qZA()),2&t){const n=a.MAs(14),l=a.MAs(16);a.xp6(5),a.HOy("",e.lex.translate("Participante"),"/",e.lex.translate("Unidade"),"/",e.lex.translate("Programa"),"/",e.lex.translate("Tipo de modalidade"),""),a.xp6(6),a.Q6J("items",e.planos)("selectedIndex",e.selectedIndex)("titleTemplate",n)("template",l)}},dependencies:[g.sg,O.F,ie.Z,R]})}function fo(i,o){1&i&&(a.TgZ(0,"div",15)(1,"div",16),a._UZ(2,"span",17),a.qZA()())}function bo(i,o){if(1&i&&(a.TgZ(0,"div",21)(1,"div",22),a._UZ(2,"profile-picture",23),a.qZA(),a.TgZ(3,"div",24)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&i){const t=o.data;a.xp6(2),a.Q6J("url",t.url_foto)("size",40)("hint",t.nome),a.xp6(3),a.Oqu(t.nome||""),a.xp6(3),a.Oqu(t.apelido||"")}}function vo(i,o){if(1&i&&a._UZ(0,"plano-trabalho-list-accordeon",25),2&i){const t=o.data;a.Q6J("usuarioId",t.id)}}function To(i,o){if(1&i&&(a.TgZ(0,"collapse-card",18),a.YNc(1,bo,9,5,"ng-template",null,19,a.W1O),a.YNc(3,vo,1,1,"ng-template",null,20,a.W1O),a.qZA()),2&i){const t=o.$implicit,e=a.MAs(2),n=a.MAs(4);a.Q6J("data",t)("titleTemplate",e)("template",n)}}function Ao(i,o){if(1&i&&(a.TgZ(0,"filter",7)(1,"div",8),a._UZ(2,"input-search",9,10),a.qZA()(),a.TgZ(4,"div",11)(5,"h5"),a._uU(6),a.qZA(),a.TgZ(7,"h4"),a._uU(8),a._UZ(9,"i",12),a.qZA()(),a.YNc(10,fo,3,0,"div",13),a.YNc(11,To,5,3,"collapse-card",14)),2&i){const t=a.MAs(3),e=a.oxw(2);a.Q6J("form",e.filter)("filter",e.filterWhere)("collapsed",!1),a.xp6(2),a.Q6J("size",12)("control",e.filter.controls.unidade_id)("dao",e.unidadeDao),a.xp6(4),a.lnq("",e.lex.translate("Unidade")," selecionada: ",null==t||null==t.selectedItem?null:t.selectedItem.entity.sigla," - ",null==t||null==t.selectedItem?null:t.selectedItem.entity.nome,""),a.xp6(2),a.hij("",e.lex.translate("Participantes")," "),a.xp6(2),a.Q6J("ngIf",e.loading),a.xp6(1),a.Q6J("ngForOf",e.usuarios)}}function Co(i,o){if(1&i&&(a.TgZ(0,"tab",5),a.YNc(1,Ao,12,12,"ng-template",null,6,a.W1O),a.qZA()),2&i){const t=a.MAs(2),e=a.oxw();a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",e.lex.translate("Unidade"))("template",t)}}function xo(i,o){if(1&i&&(a.TgZ(0,"div",26)(1,"h5",27),a._uU(2),a._UZ(3,"i",12),a.qZA(),a._UZ(4,"separator",28),a.qZA(),a._UZ(5,"plano-trabalho-list-accordeon",29)),2&i){const t=a.oxw();a.xp6(2),a.hij("",t.lex.translate("Planos de Trabalho")," "),a.xp6(2),a.Q6J("control",t.form.controls.arquivados)("title","Mostrar "+t.lex.translate("Planos de trabalho")+" arquivados?"),a.xp6(1),a.Q6J("usuarioId",t.auth.usuario.id)("arquivados",t.form.controls.arquivados.value)}}class B extends N.D{constructor(o){super(o),this.injector=o,this.usuarios=[],this.loadingUnidade=!1,this.filterWhere=t=>{let e=t.value;this.loadUsuarios(e.unidade_id)},this.unidadeDao=o.get(w.J),this.form=this.fh.FormBuilder({arquivados:{default:!1}}),this.filter=this.fh.FormBuilder({unidade_id:{default:!1}})}ngAfterViewInit(){var o=this;super.ngAfterViewInit(),this.tabs.active=this.queryParams?.tab||"USUARIO",this.tabs.title=this.lex.translate("Consolida\xe7\xf5es"),(0,d.Z)(function*(){yield o.loadData(o.entity,o.form)})()}loadData(o,t){var e=this;return(0,d.Z)(function*(){e.unidade=e.auth.unidadeGestor(),e.filter.controls.unidade_id.setValue(e.unidade?.id||e.auth.lotacao||null),e.unidade&&(yield e.loadUsuarios(e.unidade.id))})()}loadUsuarios(o){var t=this;return(0,d.Z)(function*(){t.usuarios=[],t.loadingUnidade=!0,t.loading=!0,t.cdRef.detectChanges();try{t.usuarios=yield t.unidadeDao.lotados(o)}finally{t.loading=!1,t.loadingUnidade=!1,t.cdRef.detectChanges()}})()}static#a=this.\u0275fac=function(t){return new(t||B)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:B,selectors:[["app-plano-trabalho-consolidacao"]],viewQuery:function(t,e){if(1&t&&(a.Gf(z.n,5),a.Gf(T.V,5)),2&t){let n;a.iGM(n=a.CRH())&&(e.tabs=n.first),a.iGM(n=a.CRH())&&(e.unidadeSelecionada=n.first)}},features:[a.qOj],decls:6,vars:5,consts:[["right","",3,"title"],["tabs",""],["key","UNIDADE",3,"icon","label","template",4,"ngIf"],["key","USUARIO",3,"icon","label","template"],["tabUsuario",""],["key","UNIDADE",3,"icon","label","template"],["tabUnidade",""],[3,"form","filter","collapsed"],[1,"row"],["label","Selecione a unidade","controlName","unidade_id",3,"size","control","dao"],["unidadeSelecionada",""],[1,"p-3","mb-3","bg-body-secondary"],[1,"bi","bi-arrow-down"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"data","titleTemplate","template",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[3,"data","titleTemplate","template"],["usuarioCardTitle",""],["usuarioCard",""],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],[3,"usuarioId"],[1,"d-flex","justify-content-between"],[1,"mt-2"],[3,"control","title"],[3,"usuarioId","arquivados"]],template:function(t,e){if(1&t&&(a.TgZ(0,"tabs",0,1),a.YNc(2,Co,3,3,"tab",2),a.TgZ(3,"tab",3),a.YNc(4,xo,6,5,"ng-template",null,4,a.W1O),a.qZA()()),2&t){const n=a.MAs(5);a.Q6J("title",e.isModal?"":e.title),a.xp6(2),a.Q6J("ngIf",e.unidade),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("Usuario"))("label",e.lex.translate("Usu\xe1rio"))("template",n)}},dependencies:[g.sg,g.O5,oa.z,T.V,z.n,$.i,D.N,ya.q,Y,H]})}var Pa=r(90038),yo=r(78509),Eo=r(31313),Ua=r(45512),wa=r(42704);function Zo(i,o){if(1&i&&(a.TgZ(0,"div",33)(1,"div",34),a._UZ(2,"profile-picture",35),a.qZA(),a.TgZ(3,"div",36)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br")(7,"badge",37),a.qZA()()),2&i){const t=o.separator,e=a.oxw(2);let n,l,c,m;a.xp6(2),a.Q6J("url",null==(n=e.usuarioSeparator(t))?null:n.url_foto)("size",40)("hint",null==(l=e.usuarioSeparator(t))?null:l.nome),a.xp6(3),a.Oqu((null==(c=e.usuarioSeparator(t))?null:c.nome)||"Desconhecido"),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",(null==(m=e.unidadeSeparator(t))?null:m.sigla)||"Desconhecido")}}function Do(i,o){1&i&&a._UZ(0,"toolbar")}function Oo(i,o){}function Io(i,o){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-form",38,39),2&i){const t=o.row,e=a.oxw(2);a.Q6J("disabled",!0)("entity",t)("planoTrabalho",t.plano_trabalho)("cdRef",e.cdRef)}}function Po(i,o){if(1&i&&(a._uU(0),a._UZ(1,"badge",40)(2,"badge",41)(3,"br")(4,"badge",42)(5,"badge",42)(6,"badge",42)),2&i){const t=o.row,e=a.oxw(2);a.hij(" ",t.plano_trabalho.usuario.nome," "),a.xp6(1),a.Q6J("textValue",e.util.getDateFormatted(t.plano_trabalho.data_inicio)),a.xp6(1),a.Q6J("textValue",e.util.getDateFormatted(t.plano_trabalho.data_fim)),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",null==t.plano_trabalho.unidade?null:t.plano_trabalho.unidade.sigla)("hint",e.lex.translate("Unidade")+": "+(null==t.plano_trabalho.unidade?null:t.plano_trabalho.unidade.nome)),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("Programa"))("label",null==t.plano_trabalho.programa?null:t.plano_trabalho.programa.nome)("hint",e.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade"))}}function Uo(i,o){if(1&i&&a._uU(0),2&i){const t=o.row,e=a.oxw(2);a.hij(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function wo(i,o){if(1&i&&(a.TgZ(0,"strong"),a._uU(1),a.qZA()),2&i){const t=o.row,e=a.oxw(2);a.xp6(1),a.Oqu(e.util.getDateFormatted(t.data_fim))}}function Jo(i,o){if(1&i&&a._UZ(0,"avaliar-nota-badge",45),2&i){const t=a.oxw().row;a.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function Qo(i,o){if(1&i&&(a.TgZ(0,"separator",46)(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.Q6J("collapsed",!1),a.xp6(2),a.Oqu(t.avaliacao.recurso)}}function No(i,o){if(1&i&&(a.YNc(0,Jo,1,3,"avaliar-nota-badge",43),a.YNc(1,Qo,3,2,"separator",44)),2&i){const t=o.row;a.Q6J("ngIf",t.avaliacao),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function So(i,o){1&i&&a._UZ(0,"badge",50)}function qo(i,o){if(1&i&&(a.TgZ(0,"div",47),a._UZ(1,"badge",48),a.YNc(2,So,1,0,"badge",49),a.qZA()),2&i){const t=o.row,e=a.oxw(2);a.xp6(1),a.Q6J("color",e.lookup.getColor(e.lookup.CONSOLIDACAO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.CONSOLIDACAO_STATUS,t.status))("label",e.lookup.getValue(e.lookup.CONSOLIDACAO_STATUS,t.status)),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function Mo(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"grid",5),a.YNc(1,Zo,8,6,"ng-template",null,6,a.W1O),a.YNc(3,Do,1,0,"toolbar",7),a.TgZ(4,"filter",8)(5,"div",9),a._UZ(6,"input-search",10,11),a.TgZ(8,"input-search",12,13),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw();return a.KtG(l.onUnidadeChange(n))}),a.qZA(),a._UZ(10,"input-switch",14,15)(12,"input-switch",16,17),a.qZA()(),a.TgZ(14,"columns")(15,"column",18),a.YNc(16,Oo,0,0,"ng-template",null,19,a.W1O),a.YNc(18,Io,2,4,"ng-template",null,20,a.W1O),a.qZA(),a.TgZ(20,"column",21),a.YNc(21,Po,7,12,"ng-template",null,22,a.W1O),a.qZA(),a.TgZ(23,"column",23),a.YNc(24,Uo,1,1,"ng-template",null,24,a.W1O),a.qZA(),a.TgZ(26,"column",25),a.YNc(27,wo,2,1,"ng-template",null,26,a.W1O),a.qZA(),a.TgZ(29,"column",27),a.YNc(30,No,2,2,"ng-template",null,28,a.W1O),a.qZA(),a.TgZ(32,"column",29),a.YNc(33,qo,3,4,"ng-template",null,30,a.W1O),a.qZA(),a._UZ(35,"column",31),a.qZA(),a._UZ(36,"pagination",32),a.qZA()}if(2&i){const t=a.MAs(2),e=a.MAs(17),n=a.MAs(19),l=a.MAs(22),c=a.MAs(25),m=a.MAs(28),s=a.MAs(31),_=a.MAs(34),u=a.oxw();a.Q6J("dao",u.dao)("orderBy",u.orderBy)("groupBy",u.groupBy)("join",u.join)("init",u.initGrid.bind(u))("hasAdd",!1)("hasEdit",!1)("loadList",u.onGridLoad.bind(u))("groupTemplate",t),a.xp6(3),a.Q6J("ngIf",!u.selectable),a.xp6(1),a.Q6J("form",u.filter)("where",u.filterWhere)("submit",u.filterSubmit.bind(u))("collapseChange",u.filterCollapseChange.bind(u))("collapsed",u.filterCollapsed)("deleted",u.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",5)("control",u.filter.controls.usuario_id)("dao",u.usuarioDao),a.xp6(2),a.Q6J("size",5)("control",u.filter.controls.unidade_id)("dao",u.unidadeDao),a.xp6(2),a.Q6J("size",1)("disabled",u.canFilterSubordinadas)("control",u.filter.controls.unidades_subordinadas),a.xp6(2),a.Q6J("size",1)("control",u.filter.controls.incluir_arquivados),a.xp6(3),a.Q6J("icon",u.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",u.lex.translate("Consolida\xe7\xe3o"))("template",e)("expandTemplate",n),a.xp6(5),a.Q6J("title","Plano de trabalho/Vig\xeancia\nUnidade/Programa/Modalidade")("template",l),a.xp6(3),a.Q6J("template",c),a.xp6(3),a.Q6J("template",m),a.xp6(3),a.Q6J("title","Estat\xedsticas\nAvalia\xe7\xf5es")("template",s)("width",300),a.xp6(3),a.Q6J("template",_),a.xp6(3),a.Q6J("dynamicButtons",u.dynamicButtons.bind(u)),a.xp6(1),a.Q6J("rows",u.rowsLimit)}}function Fo(i,o){if(1&i&&(a.TgZ(0,"div",33)(1,"div",34),a._UZ(2,"profile-picture",35),a.qZA(),a.TgZ(3,"div",36)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br")(7,"badge",37),a.qZA()()),2&i){const t=o.separator,e=a.oxw(2);let n,l,c,m;a.xp6(2),a.Q6J("url",null==(n=e.usuarioSeparator(t))?null:n.url_foto)("size",40)("hint",null==(l=e.usuarioSeparator(t))?null:l.nome),a.xp6(3),a.Oqu((null==(c=e.usuarioSeparator(t))?null:c.nome)||"Desconhecido"),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",(null==(m=e.unidadeSeparator(t))?null:m.sigla)||"Desconhecido")}}function Ro(i,o){1&i&&a._UZ(0,"toolbar")}function Vo(i,o){}function Lo(i,o){if(1&i&&(a.TgZ(0,"div",64)(1,"div",65),a._UZ(2,"profile-picture",35),a.qZA(),a.TgZ(3,"div",66)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&i){const t=o.row;a.xp6(2),a.Q6J("url",t.avaliador.url_foto||"")("size",40)("hint",t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.apelido||"")}}function Go(i,o){if(1&i&&(a._UZ(0,"badge",67)(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA()),2&i){const t=o.row,e=a.oxw(3);a.Q6J("label",e.getNota(t).nota)("icon",e.getNota(t).icone)("color",e.getNota(t).cor),a.xp6(3),a.Oqu(e.getNota(t).descricao)}}function zo(i,o){if(1&i&&a._UZ(0,"badge",69),2&i){const t=o.$implicit,e=a.oxw(4);a.Q6J("icon",e.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function Yo(i,o){if(1&i&&(a._uU(0),a.TgZ(1,"div",47),a.YNc(2,zo,1,2,"badge",68),a.qZA()),2&i){const t=o.row;a.hij(" ",t.justificativa||""," "),a.xp6(2),a.Q6J("ngForOf",t.justificativas)}}function Ho(i,o){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=o.row;a.xp6(1),a.Oqu(t.recurso||"")}}function Bo(i,o){1&i&&a._UZ(0,"badge",50)}function ko(i,o){1&i&&a._UZ(0,"badge",71)}function Wo(i,o){if(1&i&&(a.TgZ(0,"div",47),a.YNc(1,Bo,1,0,"badge",49),a.YNc(2,ko,1,0,"badge",70),a.qZA()),2&i){const t=o.row,e=a.oxw(3);a.xp6(1),a.Q6J("ngIf",null==t.recurso?null:t.recurso.length),a.xp6(1),a.Q6J("ngIf",t.id==(null==e.avaliacao?null:e.avaliacao.id))}}function jo(i,o){if(1&i&&(a.TgZ(0,"grid",55,56)(2,"columns"),a._UZ(3,"column",57),a.TgZ(4,"column",58),a.YNc(5,Lo,9,5,"ng-template",null,59,a.W1O),a.qZA(),a.TgZ(7,"column",21),a.YNc(8,Go,4,4,"ng-template",null,60,a.W1O),a.qZA(),a.TgZ(10,"column",21),a.YNc(11,Yo,3,2,"ng-template",null,61,a.W1O),a.qZA(),a.TgZ(13,"column",62),a.YNc(14,Ho,2,1,"ng-template",null,63,a.W1O),a.qZA(),a.TgZ(16,"column",29),a.YNc(17,Wo,3,2,"ng-template",null,30,a.W1O),a.qZA()()()),2&i){const t=o.row,e=a.MAs(6),n=a.MAs(9),l=a.MAs(12),c=a.MAs(15),m=a.MAs(18),s=a.oxw(2);a.Q6J("items",s.getAvaliacoes(t))("minHeight",0),a.xp6(4),a.Q6J("template",e),a.xp6(3),a.Q6J("title","Nota")("template",n),a.xp6(3),a.Q6J("title","Justificativas")("template",l),a.xp6(3),a.Q6J("template",c),a.xp6(3),a.Q6J("template",m)}}function Ko(i,o){if(1&i&&(a._uU(0),a._UZ(1,"badge",40)(2,"badge",41)(3,"br")(4,"badge",42)(5,"badge",42)),2&i){const t=o.row,e=a.oxw(2);a.hij(" ",t.plano_trabalho.usuario.nome," "),a.xp6(1),a.Q6J("textValue",e.util.getDateFormatted(t.plano_trabalho.data_inicio)),a.xp6(1),a.Q6J("textValue",e.util.getDateFormatted(t.plano_trabalho.data_fim)),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Programa"))("label",null==t.plano_trabalho.programa?null:t.plano_trabalho.programa.nome)("hint",e.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade"))}}function Xo(i,o){if(1&i&&a._uU(0),2&i){const t=o.row,e=a.oxw(2);a.hij(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function $o(i,o){if(1&i&&a._uU(0),2&i){const t=o.row,e=a.oxw(2);a.hij(" ",e.util.getDateFormatted(t.data_fim)," ")}}function ai(i,o){if(1&i){const t=a.EpF();a.TgZ(0,"grid",5),a.YNc(1,Fo,8,6,"ng-template",null,51,a.W1O),a.YNc(3,Ro,1,0,"toolbar",7),a.TgZ(4,"filter",8)(5,"div",9),a._UZ(6,"input-search",10,11),a.TgZ(8,"input-search",12,13),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw();return a.KtG(l.onUnidadeChange(n))}),a.qZA(),a._UZ(10,"input-switch",14,15)(12,"input-switch",16,17),a.qZA()(),a.TgZ(14,"columns")(15,"column",52),a.YNc(16,Vo,0,0,"ng-template",null,53,a.W1O),a.YNc(18,jo,19,9,"ng-template",null,54,a.W1O),a.qZA(),a.TgZ(20,"column",21),a.YNc(21,Ko,6,9,"ng-template",null,22,a.W1O),a.qZA(),a.TgZ(23,"column",23),a.YNc(24,Xo,1,1,"ng-template",null,24,a.W1O),a.qZA(),a.TgZ(26,"column",25),a.YNc(27,$o,1,1,"ng-template",null,26,a.W1O),a.qZA()(),a._UZ(29,"pagination",32),a.qZA()}if(2&i){const t=a.MAs(2),e=a.MAs(17),n=a.MAs(19),l=a.MAs(22),c=a.MAs(25),m=a.MAs(28),s=a.oxw();a.Q6J("dao",s.dao)("orderBy",s.orderBy)("groupBy",s.groupBy)("join",s.join)("init",s.initGrid.bind(s))("hasAdd",!1)("hasEdit",!1)("loadList",s.onGridLoadHistorico.bind(s))("groupTemplate",t),a.xp6(3),a.Q6J("ngIf",!s.selectable),a.xp6(1),a.Q6J("form",s.filter)("where",s.filterWhereHistorico)("submit",s.filterSubmit.bind(s))("collapseChange",s.filterCollapseChange.bind(s))("collapsed",s.filterCollapsed)("deleted",s.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",5)("control",s.filter.controls.usuario_id)("dao",s.usuarioDao),a.xp6(2),a.Q6J("size",5)("control",s.filter.controls.unidade_id)("dao",s.unidadeDao),a.xp6(2),a.Q6J("size",1)("disabled",s.canFilterSubordinadas)("control",s.filter.controls.unidades_subordinadas),a.xp6(2),a.Q6J("size",1)("control",s.filter.controls.incluir_arquivados),a.xp6(3),a.Q6J("icon",s.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("template",e)("expandTemplate",n),a.xp6(5),a.Q6J("title","Plano de trabalho/Vig\xeancia\nPrograma/Modalidade")("template",l),a.xp6(3),a.Q6J("template",c),a.xp6(3),a.Q6J("template",m),a.xp6(3),a.Q6J("rows",s.rowsLimit)}}class k extends yo.E{constructor(o){super(o,Za,ia.E),this.injector=o,this.avaliacoes=[],this.avaliacao=new Eo.g,this.consolidacaoId=[],this.joinAvaliacao=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.filterWhere=t=>{let e=[],n=t.value;return e.push(["status","in",["CONCLUIDO","AVALIADO"]]),n.usuario_id?.length&&e.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&e.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&e.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&e.push(["incluir_arquivados","==",!0]),e},this.filterWhereHistorico=t=>{let e=[],n=t.value;return e.push(["status","in",["AVALIADO"]]),n.usuario_id?.length&&e.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&e.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&e.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&e.push(["incluir_arquivados","==",!0]),e},this.unidadeService=o.get(aa.Z),this.join=["avaliacao","plano_trabalho:id"],this.extraJoin=["avaliacao.tipoAvaliacao.notas","planoTrabalho.unidade:id,sigla,nome","planoTrabalho.unidade.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.unidadePai.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.unidade.unidadePai.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.tipoModalidade:id,nome","planoTrabalho.usuario:id,nome,apelido,foto_perfil,url_foto"],this.groupBy=[{field:"plano_trabalho.unidade.sigla",label:this.lex.translate("Unidade")},{field:"plano_trabalho.unidade.id",label:"Unidade Id"},{field:"plano_trabalho.usuario.nome",label:this.lex.translate("Participante")},{field:"plano_trabalho.usuario.id",label:"Usu\xe1rio Id"}],this.usuarioDao=o.get(K.q),this.unidadeDao=o.get(w.J),this.avaliacaoDao=o.get(Da.w),this.planoTrabalhoService=o.get(Q.p),this.title="Avalia\xe7\xf5es "+this.lex.translate("das Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD_AVAL",this.filter=this.fh.FormBuilder({usuario_id:{default:""},unidade_id:{default:""},unidades_subordinadas:{default:!1},incluir_arquivados:{default:!1}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||this.auth.lotacao||null)}get canFilterSubordinadas(){return this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)?void 0:"true"}usuarioSeparator(o){let t=o.group[3].value;return o.metadata=o.metadata||{},o.metadata.usuario=o.metadata.usuario||this.extra?.planos_trabalhos?.find(e=>e.usuario_id==t)?.usuario,o.metadata.usuario}unidadeSeparator(o){let t=o.group[1].value;return o.metadata=o.metadata||{},o.metadata.unidade=o.metadata.unidade||this.extra?.planos_trabalhos?.find(e=>e.unidade_id==t)?.unidade,o.metadata.unidade}onUnidadeChange(o){this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)||this.filter.controls.unidades_subordinadas.setValue(!1)}onGridLoad(o){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(e=>{let n=e;n.programa=this.extra?.programas?.find(l=>l.id==n.programa_id)}),o?.forEach(e=>{let n=e;n.plano_trabalho=this.extra?.planos_trabalhos?.find(l=>l.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(l=>l.id==n.avaliacao.tipo_avaliacao_id))})}refreshConsolidacao(o){var t=this;(0,d.Z)(function*(){yield t.grid.query.refreshId(o.id,t.extraJoin),t.grid.refreshRows()})()}dynamicButtons(o){let t=[],e=o,n=e.plano_trabalho.programa,l=!1;const c=e.plano_trabalho.usuario_id,m=e.plano_trabalho.unidade_id,s=e.plano_trabalho.unidade,_=c==this.auth.usuario?.id,u=s?.gestor?.usuario_id==c,h=s?.gestores_substitutos.map(f=>f.usuario_id).includes(c),p=s?.gestores_delegados.map(f=>f.usuario_id).includes(c),C=!u&&!h&&!p,V=this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL"),x=this.unidadeService.isGestorUnidadeSuperior(e.plano_trabalho?.unidade);u?l=x:h?l=x||this.unidadeService.isGestorTitularUnidade(m):p?l=x||this.unidadeService.isGestorUnidade(m,!1):C&&(l=x||this.unidadeService.isGestorUnidade(m));const na={hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-info",onClick:f=>this.planoTrabalhoService.avaliar(f,n,this.refreshConsolidacao.bind(this))},la={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:f=>this.planoTrabalhoService.avaliar(f,n,this.refreshConsolidacao.bind(this))},ra={hint:"Fazer recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:f=>this.planoTrabalhoService.fazerRecurso(f,n,this.refreshConsolidacao.bind(this))},sa={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:f=>this.planoTrabalhoService.cancelarAvaliacao(f,this,this.refreshConsolidacao.bind(this))};return"CONCLUIDO"==e.status&&!_&&l&&V&&t.push(na),"AVALIADO"==e.status&&e.avaliacao&&(_&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&e.avaliacao?.data_avaliacao&&(!n.dias_tolerancia_recurso_avaliacao||this.util.daystamp(e.avaliacao.data_avaliacao)+n.dias_tolerancia_recurso_avaliacao>this.util.daystamp(this.auth.hora))&&t.push(ra),l&&(t.push(la),t.push(sa))),t}onSelectTab(o){var t=this;return(0,d.Z)(function*(){t.viewInit&&t.saveUsuarioConfig({active_tab:o.key})})()}initGrid(o){o.queryInit()}getAvaliacoes(o){return this.avaliacoes.filter(t=>t.plano_trabalho_consolidacao_id==o.id)}loadData(){var o=this;return(0,d.Z)(function*(){o.loading=!0;try{o.avaliacoes=yield o.avaliacaoDao.query({where:[["plano_trabalho_consolidacao_id","in",o.consolidacaoId]],join:o.joinAvaliacao,orderBy:[["data_avaliacao","desc"]]}).asPromise(),o.avaliacao=o.avaliacoes[0]||o.avaliacao}finally{o.loading=!1}})()}onGridLoadHistorico(o){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(e=>{let n=e;n.programa=this.extra?.programas?.find(l=>l.id==n.programa_id)}),o?.forEach(e=>{this.consolidacaoId?.push(e.id);let n=e;n.plano_trabalho=this.extra?.planos_trabalhos?.find(l=>l.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(l=>l.id==n.avaliacao.tipo_avaliacao_id))}),this.loadData()}getNota(o){return o.tipo_avaliacao.notas.find(t=>t.codigo==o.nota)}static#a=this.\u0275fac=function(t){return new(t||k)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:k,selectors:[["app-plano-trabalho-consolidacao-avaliacao"]],viewQuery:function(t,e){if(1&t&&a.Gf(A.M,5),2&t){let n;a.iGM(n=a.CRH())&&(e.grid=n.first)}},features:[a.qOj],decls:7,vars:5,consts:[["right","",3,"title","select"],["key","CONSOLIDACOES","icon","bi bi-clipboard-check",3,"label","template"],["consolidacoes",""],["key","HISTORICO","icon","bi bi-clipboard-pulse","label","Hist\xf3rico de Avalia\xe7\xf5es",3,"template"],["historico",""],[3,"dao","orderBy","groupBy","join","init","hasAdd","hasEdit","loadList","groupTemplate"],["groupUnidadeUsuario",""],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","unidade_id",3,"size","control","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","disabled","control"],["subordinadas",""],["label","Arq.","controlName","incluir_arquivados","labelInfo","Incluir os planos de trabalhos arquivados",3,"size","control"],["arquivadas",""],["type","expand",3,"icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],[3,"title","template"],["columnPlanoTrabalho",""],["title","Data in\xedcio",3,"template"],["columnDataInicio",""],["title","Data fim",3,"template"],["columnDataFim",""],[3,"title","template","width"],["columnEstatisticas",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicButtons"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","primary",3,"icon","label"],[3,"disabled","entity","planoTrabalho","cdRef"],["consolidacao",""],["label","In\xedcio","color","light","icon","bi bi-calendar2",3,"textValue"],["label","T\xe9rmino","color","light","icon","bi bi-calendar2-check",3,"textValue"],["color","light",3,"icon","label","hint"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["groupHistorico",""],["type","expand",3,"icon","align","template","expandTemplate"],["columnHistorico",""],["columnExpandedHistorico",""],[3,"items","minHeight"],["gridEntregas",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],["columnAvaliador",""],["columnNota",""],["columnJustificativa",""],["title","Recurso",3,"template"],["columnRecurso",""],[1,"avaliador"],[1,"avaliador-profile"],[1,"avaliador-nome"],[3,"label","icon","color"],[3,"icon","label",4,"ngFor","ngForOf"],[3,"icon","label"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(t,e){if(1&t&&(a.TgZ(0,"tabs",0)(1,"tab",1),a.YNc(2,Mo,37,42,"ng-template",null,2,a.W1O),a.qZA(),a.TgZ(4,"tab",3),a.YNc(5,ai,30,36,"ng-template",null,4,a.W1O),a.qZA()()),2&t){const n=a.MAs(3),l=a.MAs(6);a.Q6J("title",e.isModal?"":e.title)("select",e.onSelectTab.bind(e)),a.xp6(1),a.Q6J("label",e.lex.translate("Consolida\xe7\xf5es"))("template",n),a.xp6(3),a.Q6J("template",l)}},dependencies:[g.sg,g.O5,A.M,S.a,q.b,oa.z,Ua.n,wa.Q,J.a,T.V,z.n,$.i,D.N,O.F,ya.q,Oa.M,F]})}const ti=[{path:"",component:xa.H,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Planos de Trabalho"}},{path:"new",component:P,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Trabalho",modal:!0}},{path:"termo",component:G,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Termo de ades\xe3o",modal:!0}},{path:"consolidacao/avaliacao",component:k,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Avalia\xe7\xe3o das Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/avaliar",component:Pa.w,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Avaliar Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/recurso",component:Pa.w,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Recurso da Avalia\xe7\xe3o da Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:usuarioId/:planoTrabalhoId",component:R,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao",component:B,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es"}},{path:":id/edit",component:P,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Trabalho",modal:!0}},{path:":id/consult",component:P,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Trabalho",modal:!0}},{path:"entrega-list",component:I,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Lista de Entregas do Plano de Trabalho",modal:!0}}];class W{static#a=this.\u0275fac=function(t){return new(t||W)};static#t=this.\u0275mod=a.oAB({type:W});static#e=this.\u0275inj=a.cJS({imports:[ca.Bz.forChild(ti),ca.Bz]})}var ei=r(54218),oi=r(72133),ii=r(32864),ni=r(59013),li=r(58252),ri=r(61915);class j{static#a=this.\u0275fac=function(t){return new(t||j)};static#t=this.\u0275mod=a.oAB({type:j});static#e=this.\u0275inj=a.cJS({imports:[g.ez,ei.K,oi.UX,W,ii.UteisModule,ni.AtividadeModule]})}a.B6R(xa.H,[g.O5,A.M,S.a,q.b,oa.z,Ua.n,wa.Q,J.a,T.V,X.m,L.k,ta.p,li.Y,ri.l,O.F,Ia.h,I],[])}}]);