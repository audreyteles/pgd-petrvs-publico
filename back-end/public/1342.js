"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[1342],{41342:(fi,ca,r)=>{r.r(ca),r.d(ca,{PlanoTrabalhoModule:()=>Va});var Q,g=r(76733),ua=r(55579),h=r(1391),f=r(2314),s=r(8239),x=r(74040),ma=r(25026),P=r(87744),pa=r(92214),za=r(88340),_a=r(66075),U=r(81214),$=r(35255),ga=r(79084),y=r(20762),ha=r(1184),Ga=r(92307),a=r(20755),J=r(88820),Ya=r(51823),T=r(32802),aa=r(92392),k=r(84495),Z=r(25560),fa=r(43417);const Ha=["usuario"],Ba=["unidade"],ka=["programa"],Wa=["tipoDocumento"],ja=["tipoModalidade"];class ba extends ha.F{constructor(e){super(e,y.p,P.t),this.injector=e,this.validate=(t,o)=>{let n=null;return"tipo_documento_id"==o&&!t?.value?.length&&this.form?.controls?.numero_processo?.value?.length&&(n="Obrigat\xf3rio"),n},this.formValidation=t=>{if(!this.tipoDocumento?.selectedEntity&&t?.controls.tipo_documento_id.value?.length)return"Aguarde o carregamento do tipo de documento"},this.titleEdit=t=>"Editando "+this.lex.translate("TCR")+" "+this.lex.translate("do Plano de Trabalho")+": "+(t?.usuario?.nome||""),this.join=["unidade","usuario","programa.template_tcr","tipo_modalidade","documento","documentos","atividades.atividade"],this.unidadeDao=e.get(U.J),this.programaDao=e.get(pa.w),this.usuarioDao=e.get($.q),this.tipoDocumentoDao=e.get(za.Q),this.allPages=e.get(ga.T),this.tipoModalidadeDao=e.get(_a.D),this.documentoDao=e.get(ma.d),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},programa_id:{default:""},usuario_id:{default:""},unidade_id:{default:""},documento_id:{default:""},documentos:{default:[]},tipo_documento_id:{default:""},numero_processo:{default:""},vinculadas:{default:!0},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"}},this.cdRef,this.validate)}onVinculadasChange(e){this.cdRef.detectChanges()}loadData(e,t){var o=this;return(0,s.Z)(function*(){let n=Object.assign({},t.value);n=o.util.fillForm(n,e),yield Promise.all([o.unidade.loadSearch(e.unidade||e.unidade_id),o.usuario.loadSearch(e.usuario||e.usuario_id),o.programa.loadSearch(e.programa||e.programa_id),o.tipoModalidade.loadSearch(e.tipo_modalidade||e.tipo_modalidade_id)]),o.processo&&(n.id_processo=o.processo.id_processo,n.numero_processo=o.processo.numero_processo),n.data_inicio=o.auth.hora,t.patchValue(n)})()}initializeData(e){var t=this;return(0,s.Z)(function*(){t.entity=yield t.dao.getById(t.metadata.plano_trabalho.id,t.join),t.processo=t.metadata?.processo,yield t.loadData(t.entity,e)})()}saveData(e){return new Promise((t,o)=>{t(new Ga.R(Object.assign(this.form.value,{codigo_tipo_documento:this.tipoDocumento?.selectedEntity?.codigo})))})}get formaContagemCargaHoraria(){const e=this.form?.controls.forma_contagem_carga_horaria?.value||"DIA";return"DIA"==e?"day":"SEMANA"==e?"week":"mouth"}}(Q=ba).\u0275fac=function(e){return new(e||Q)(a.Y36(a.zs3))},Q.\u0275cmp=a.Xpm({type:Q,selectors:[["plano-trabalho-form-termo"]],viewQuery:function(e,t){if(1&e&&(a.Gf(x.Q,5),a.Gf(Ha,5),a.Gf(Ba,5),a.Gf(ka,5),a.Gf(Wa,5),a.Gf(ja,5)),2&e){let o;a.iGM(o=a.CRH())&&(t.editableForm=o.first),a.iGM(o=a.CRH())&&(t.usuario=o.first),a.iGM(o=a.CRH())&&(t.unidade=o.first),a.iGM(o=a.CRH())&&(t.programa=o.first),a.iGM(o=a.CRH())&&(t.tipoDocumento=o.first),a.iGM(o=a.CRH())&&(t.tipoModalidade=o.first)}},features:[a.qOj],decls:25,vars:41,consts:[["initialFocus","programa_id",3,"form","disabled","title","submit","cancel"],["collapse","",3,"title","collapsed"],[1,"row"],["disabled","","controlName","programa_id",3,"size","dao"],["programa",""],["disabled","","controlName","usuario_id",3,"size","dao"],["usuario",""],["disabled","","controlName","unidade_id",3,"size","dao"],["unidade",""],["disabled","","controlName","tipo_modalidade_id",3,"size","dao"],["tipoModalidade",""],["numbers","","disabled","","label","% prod.","icon","bi bi-hourglass-split","controlName","ganho_produtividade",3,"size","control","labelInfo"],["label","H. Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["disabled","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","In\xedcio da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","Final","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Final da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","C. Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria",3,"size","unit","control","labelInfo"],["label","H. Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["disabled","","label","Data e hora","controlName","data_inicio","labelInfo","Data de cadastro do termo",3,"size","control"],["controlName","numero_processo","disabled","","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"label","size","control"],["controlName","tipo_documento_id","required","",3,"size","disabled","dao"],["tipoDocumento",""],["label","Vinculadas","controlName","vinculadas","labelInfo","Se inclui as atividades das unidades vinculadas a unidade do plano",3,"disabled","size","control","change"]],template:function(e,t){1&e&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),a.TgZ(1,"separator",1)(2,"div",2),a._UZ(3,"input-search",3,4)(5,"input-search",5,6),a.qZA(),a.TgZ(7,"div",2),a._UZ(8,"input-search",7,8)(10,"input-search",9,10)(12,"input-text",11)(13,"input-display",12),a.qZA(),a.TgZ(14,"div",2),a._UZ(15,"input-datetime",13)(16,"input-datetime",14)(17,"input-workload",15)(18,"input-display",16),a.qZA()(),a.TgZ(19,"div",2),a._UZ(20,"input-datetime",17)(21,"input-text",18)(22,"input-search",19,20),a.TgZ(24,"input-switch",21),a.NdJ("change",function(n){return t.onVinculadasChange(n)}),a.qZA()()()),2&e&&(a.Q6J("form",t.form)("disabled",t.formDisabled)("title",t.isModal?"":t.title),a.xp6(1),a.Q6J("title",t.lex.translate("Plano de trabalho"))("collapsed",!1),a.xp6(2),a.Q6J("size",6)("dao",t.programaDao),a.xp6(2),a.Q6J("size",6)("dao",t.usuarioDao),a.xp6(3),a.Q6J("size",5)("dao",t.unidadeDao),a.xp6(2),a.Q6J("size",3)("dao",t.tipoModalidadeDao),a.xp6(2),a.Q6J("size",2)("control",t.form.controls.ganho_produtividade)("labelInfo","Percentual de ganho de produtividade (Ser\xe1 descontado do "+t.lex.translate("tempo pactuado")+")"),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",2)("control",t.form.controls.tempo_proporcional),a.xp6(2),a.Q6J("size",3)("control",t.form.controls.data_inicio),a.xp6(1),a.Q6J("size",3)("control",t.form.controls.data_fim),a.xp6(1),a.Q6J("size",3)("unit",t.formaContagemCargaHoraria)("control",t.form.controls.carga_horaria)("labelInfo","Carga hor\xe1ria"+t.lex.translate("do usu\xe1rio")),a.xp6(1),a.Q6J("size",3)("control",t.form.controls.tempo_total),a.xp6(2),a.Q6J("size",3)("control",t.form.controls.data_inicio),a.xp6(1),a.Q6J("label","N\xfamero "+t.lex.translate("Processo"))("size",3)("control",t.form.controls.numero_processo),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",4)("disabled",null!=t.form.controls.numero_processo.value&&t.form.controls.numero_processo.value.length?void 0:"true")("dao",t.tipoDocumentoDao),a.xp6(2),a.Q6J("disabled",null!=t.entity&&null!=t.entity.atividades&&t.entity.atividades.length?"true":void 0)("size",2)("control",t.form.controls.vinculadas))},dependencies:[x.Q,J.a,Ya.B,T.V,aa.m,k.k,Z.N,fa.S]});var S,Ka=r(22702),va=r(6551),w=r(80684),Xa=r(49367),$a=r(49193),at=r(53085),W=r(66384),ta=r(74978),tt=r(50933),et=r(55795),ot=r(60785),it=r(6601),C=r(73150),N=r(76298),nt=r(75754),lt=r(59173),rt=r(39190),Ta=r(31021),ea=r(20609),M=r(57224),q=r(83351),Ca=r(74508),oa=r(64603),E=r(95489),Aa=r(64792);const st=["origem"],dt=["planoEntrega"],ct=["entrega"];function ut(i,e){1&i&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3,"Origem"),a.qZA()()())}function mt(i,e){if(1&i&&a._UZ(0,"badge",27),2&i){const t=a.oxw().row,o=a.oxw();a.Q6J("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"DESCONHECIDO")("icon",o.entityService.getIcon("Unidade"))}}function pt(i,e){if(1&i&&a._UZ(0,"badge",28),2&i){const t=a.oxw().row;a.Q6J("label",t.orgao)}}function _t(i,e){if(1&i&&(a.TgZ(0,"div",22)(1,"div",23),a._UZ(2,"badge",24),a.YNc(3,mt,1,2,"badge",25),a.YNc(4,pt,1,1,"badge",26),a.qZA()()),2&i){const t=e.row,o=a.oxw();a.xp6(2),a.Q6J("label",o.planoTrabalhoService.tipoEntrega(t,o.entity).titulo)("color",o.planoTrabalhoService.tipoEntrega(t,o.entity).cor),a.xp6(1),a.Q6J("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),a.xp6(1),a.Q6J("ngIf",null==t.orgao?null:t.orgao.length)}}const gt=function(){return["entregas.entrega:id,nome","unidade"]},ht=function(i){return["unidade_id","==",i]},xa=function(){return["status","==","ATIVO"]},ft=function(i,e){return[i,e]},bt=function(i){return[i]},vt=function(i){return{unidade_id:i,status:"ATIVO"}},ya=function(i){return{filter:i}},Tt=function(){return{status:"ATIVO"}};function Ct(i,e){if(1&i){const t=a.EpF();a.TgZ(0,"input-search",33,34),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw(2);return a.KtG(l.onPlanoEntregaChange(n))}),a.qZA()}if(2&i){a.oxw();const t=a.MAs(1),o=a.oxw();a.Q6J("placeholder","Selecione o "+o.lex.translate("Plano de entrega"))("join",a.DdM(5,gt))("where","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.WLB(9,ft,a.VKq(6,ht,null==o.entity?null:o.entity.unidade_id),a.DdM(8,xa)):a.VKq(13,bt,a.DdM(12,xa)))("selectParams","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.VKq(17,ya,a.VKq(15,vt,null==o.entity?null:o.entity.unidade_id)):a.VKq(20,ya,a.DdM(19,Tt)))("dao",o.planoEntregaDao)}}function At(i,e){1&i&&a._UZ(0,"input-text",35,36),2&i&&a.uIk("maxlength",250)}const ia=function(){return["PROPRIA_UNIDADE","OUTRA_UNIDADE"]};function xt(i,e){if(1&i){const t=a.EpF();a.TgZ(0,"input-select",29,30),a.NdJ("change",function(){const l=a.CHM(t).row,d=a.oxw();return a.KtG(d.onOrigemChange(l))}),a.qZA(),a.YNc(2,Ct,2,22,"input-search",31),a.YNc(3,At,2,1,"input-text",32)}if(2&i){const t=a.MAs(1),o=a.oxw();a.Q6J("control",o.form.controls.origem)("items",o.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO),a.xp6(2),a.Q6J("ngIf",a.DdM(4,ia).includes(null==t?null:t.value)),a.xp6(1),a.Q6J("ngIf","OUTRO_ORGAO"==(null==t?null:t.value))}}function yt(i,e){1&i&&(a.TgZ(0,"span")(1,"strong"),a._uU(2,"Entrega"),a.qZA()())}function Zt(i,e){if(1&i&&(a.TgZ(0,"div",39),a._UZ(1,"badge",40)(2,"badge",41),a.qZA()),2&i){const t=a.oxw().row,o=a.oxw();a.xp6(1),a.Q6J("label",o.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)),a.xp6(1),a.Q6J("label",o.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim))}}function Et(i,e){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA(),a.YNc(2,Zt,3,2,"div",37),a._UZ(3,"reaction",38)),2&i){const t=e.row,o=a.oxw();a.xp6(1),a.Oqu(o.planoTrabalhoService.tipoEntrega(t,o.entity).descricao),a.xp6(1),a.Q6J("ngIf",a.DdM(3,ia).includes(o.planoTrabalhoService.tipoEntrega(t,o.entity).tipo)),a.xp6(1),a.Q6J("entity",t)}}function Dt(i,e){if(1&i){const t=a.EpF();a.TgZ(0,"input-select",43,44),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw(2);return a.KtG(l.onEntregaChange(n))}),a.qZA()}if(2&i){const t=a.oxw(2);a.Q6J("control",t.form.controls.plano_entrega_entrega_id)("items",t.entregas)}}function Ot(i,e){if(1&i&&(a.TgZ(0,"div",39),a._UZ(1,"badge",40)(2,"badge",41),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_inicio)),a.xp6(1),a.Q6J("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_fim))}}function It(i,e){if(1&i&&(a.YNc(0,Dt,2,2,"input-select",42),a.YNc(1,Ot,3,2,"div",37)),2&i){const t=a.oxw();a.Q6J("ngIf",a.DdM(2,ia).includes(null==t.origem?null:t.origem.value)),a.xp6(1),a.Q6J("ngIf",null==t.entrega?null:t.entrega.selectedItem)}}function Pt(i,e){if(1&i&&(a.TgZ(0,"div")(1,"small"),a._UZ(2,"badge",47),a.qZA(),a.TgZ(3,"small"),a._UZ(4,"badge",48),a.qZA()()),2&i){const t=a.oxw(2);a.xp6(2),a.Q6J("color","warning")("label",t.totalForcaTrabalho+"%"),a.xp6(2),a.Q6J("color","secondary")("label",t.totalForcaTrabalho-100+"%")}}function Ut(i,e){if(1&i&&(a.TgZ(0,"small"),a._UZ(1,"badge",47),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("color",100==t.totalForcaTrabalho?"success":"warning")("label",t.totalForcaTrabalho+"%")}}function Jt(i,e){if(1&i&&(a.TgZ(0,"div",21),a.YNc(1,Pt,5,4,"div",45),a.YNc(2,Ut,2,2,"ng-template",null,46,a.W1O),a.qZA()),2&i){const t=a.MAs(3),o=a.oxw();a.xp6(1),a.Q6J("ngIf",o.totalForcaTrabalho>100)("ngIfElse",t)}}function Qt(i,e){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=e.row;a.xp6(1),a.Oqu(t.forca_trabalho+"%")}}function wt(i,e){if(1&i){const t=a.EpF();a.TgZ(0,"input-text",49),a.NdJ("change",function(){const l=a.CHM(t).row,d=a.oxw();return a.KtG(d.onForcaTrabalhoChange(l))}),a.qZA()}if(2&i){const t=a.oxw();a.Q6J("control",t.form.controls.forca_trabalho),a.uIk("maxlength",250)}}function Nt(i,e){1&i&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3,"Descri\xe7\xe3o dos Trabalhos"),a.qZA()()())}function Mt(i,e){if(1&i&&(a.TgZ(0,"div")(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.xp6(2),a.Oqu(t.descricao)}}function qt(i,e){if(1&i&&a.YNc(0,Mt,3,1,"div",45),2&i){const t=e.row,o=a.oxw(),n=a.MAs(30);a.Q6J("ngIf",t.descricao!=o.planoTrabalhoService.tipoEntrega(t,o.entity).descricao)("ngIfElse",n)}}function St(i,e){1&i&&(a.TgZ(0,"small"),a._uU(1,"Detalhe/Descreva os trabalhos"),a.qZA())}function Ft(i,e){if(1&i&&a._UZ(0,"input-textarea",50),2&i){const t=a.oxw();a.Q6J("rows",2)("control",t.form.controls.descricao)}}class j extends N.D{set control(e){super.control=e}get control(){return super.control}set entity(e){super.entity=e}get entity(){return super.entity}set disabled(e){this._disabled!=e&&(this._disabled=e)}get disabled(){return this._disabled}set noPersist(e){super.noPersist=e}get noPersist(){return super.noPersist}set planoTrabalhoEditavel(e){this._planoTrabalhoEditavel!=e&&(this._planoTrabalhoEditavel=e)}get planoTrabalhoEditavel(){return this._planoTrabalhoEditavel}get items(){return this.gridControl.value||this.gridControl.setValue(new y.p),this.gridControl.value.entregas||(this.gridControl.value.entregas=[]),this.gridControl.value.entregas}constructor(e){super(e),this.injector=e,this.atualizaPlanoTrabalhoEvent=new a.vpe,this.options=[],this.totalForcaTrabalho=0,this.entregas=[],this._disabled=!1,this._planoTrabalhoEditavel=!0,this.validate=(t,o)=>{let n=null;return["forca_trabalho"].indexOf(o)>=0&&1==t.value||(["forca_trabalho"].indexOf(o)>=0&&!t.value&&(n="Obrigat\xf3rio!"),["descricao"].indexOf(o)>=0&&!t.value?.length&&(n="Obrigat\xf3rio!"),["forca_trabalho"].indexOf(o)>=0&&(t.value<1||t.value>100)&&(n="Deve estar entre 1 e 100"),["plano_entrega_entrega_id"].indexOf(o)>=0&&(["PROPRIA_UNIDADE","OUTRA_UNIDADE"].includes(this.form?.controls.origem.value)&&!t.value&&(n="Obrigat\xf3rio!"),this.entity?.entregas?.filter(l=>!!l.plano_entrega_entrega_id&&l.id!=this.grid?.editing?.id).find(l=>l.plano_entrega_entrega_id==t.value)&&(n="Esta entrega est\xe1 em duplicidade!"))),n},this.dao=e.get(lt.w),this.cdRef=e.get(a.sBO),this.planoTrabalhoDao=e.get(P.t),this.planoEntregaDao=e.get(rt.r),this.planoTrabalhoService=e.get(w.p),this.peeDao=e.get(Ta.K),this.unidadeService=e.get(ea.Z),this.join=["entrega","plano_entrega_entrega.entrega","plano_entrega_entrega.plano_entrega:id,unidade_id","plano_entrega_entrega.plano_entrega.unidade:id,sigla"],this.form=this.fh.FormBuilder({origem:{default:null},orgao:{default:null},descricao:{default:""},forca_trabalho:{default:1},plano_trabalho_id:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}validateEntregas(){let e={start:this.entity.data_inicio,end:this.entity.data_fim};for(let t of this.items){let o=t.plano_entrega_entrega;if(o){let n=o.data_fim?o.data_fim:o.data_inicio.getTime()<=this.entity.data_fim.getTime()?this.entity.data_fim:void 0,l={start:o.data_inicio,end:o.data_fim||o.data_inicio};if(!n||!this.util.intersection([l,e]))return this.lex.translate("Entrega")+" "+o.descricao+" possui datas incompat\xedveis (in\xedcio "+this.util.getDateFormatted(o.data_inicio)+(o.data_fim?"e fim "+this.util.getDateFormatted(o.data_fim):"")+")"}}}ngOnInit(){var e=()=>super.ngOnInit,t=this;return(0,s.Z)(function*(){e().call(t),t.entity=t.metadata?.entity||t.entity,t.totalForcaTrabalho=Math.round(100*t.somaForcaTrabalho(t.entity?.entregas))/100,t.entity._metadata=t.entity._metadata||{},t.entity._metadata.novaEntrega=void 0})()}addEntrega(){var e=this;return(0,s.Z)(function*(){return Object.assign(new nt.U,{_status:"ADD",id:e.dao.generateUuid(),plano_trabalho_id:e.entity?.id})})()}loadEntrega(e,t){var o=this;return(0,s.Z)(function*(){let n=t;if(e.controls.descricao.setValue(t.descricao),e.controls.forca_trabalho.setValue(t.forca_trabalho),e.controls.plano_trabalho_id.setValue(t.plano_trabalho_id),e.controls.orgao.setValue(null),e.controls.plano_entrega_entrega_id.setValue(null),t.plano_entrega_entrega&&(e.controls.plano_entrega_id.setValue(t.plano_entrega_entrega.plano_entrega.id),e.controls.plano_entrega_entrega_id.setValue(t.plano_entrega_entrega_id)),"ADD"!=n._status||e.controls.plano_entrega_id.value)n.plano_entrega_entrega?.plano_entrega?.unidade_id==o.entity.unidade_id?(e.controls.origem.setValue("PROPRIA_UNIDADE"),yield o.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),e.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.plano_entrega_entrega?(e.controls.origem.setValue("OUTRA_UNIDADE"),yield o.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),e.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.orgao?.length?(e.controls.origem.setValue("OUTRO_ORGAO"),e.controls.orgao.setValue(n.orgao)):e.controls.origem.setValue("SEM_ENTREGA");else{e.controls.origem.setValue("PROPRIA_UNIDADE");let l=yield o.planoEntregaDao.query({where:[["unidade_id","==",o.entity.unidade_id],["status","==","ATIVO"]]}).asPromise();e.controls.plano_entrega_id.setValue(l[0].id)}})()}removeEntrega(e){var t=this;return(0,s.Z)(function*(){if(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir?")){t.loading=!0;try{t.isNoPersist?Object.assign(e,{_status:"DELETE"}):yield t.dao?.delete(e.id)}finally{t.loading=!1,t.atualizaPlanoTrabalhoEvent.emit(t.entity.id)}return t.totalForcaTrabalho=Math.round(100*(t.totalForcaTrabalho-1*e.forca_trabalho))/100,!t.isNoPersist}return!1})()}saveEntrega(e,t){var o=this;return(0,s.Z)(function*(){o.entity._metadata=o.entity._metadata||{},o.entity._metadata.novaEntrega=t,o.entity._metadata.novaEntrega.plano_entrega_entrega_id=o.form?.controls.plano_entrega_entrega_id.value,o.entity._metadata.novaEntrega.orgao=o.form?.controls.orgao.value,o.entity._metadata.novaEntrega.descricao=o.form?.controls.descricao.value,o.entity._metadata.novaEntrega.forca_trabalho=o.form?.controls.forca_trabalho.value,o.loading=!0;try{o.isNoPersist||(yield o.dao.save(o.entity._metadata.novaEntrega,o.join))}catch(n){o.error(n.message?n.message:n.toString()||n)}finally{t.forca_trabalho=1*o.form?.controls.forca_trabalho.value,t.plano_entrega_entrega=o.entrega?.selectedItem?.data||null,o.totalForcaTrabalho=Math.round(100*o.somaForcaTrabalho(o.entity?.entregas))/100,o.loading=!1}return o.entity._metadata.novaEntrega})()}saveEndEntrega(e){this.entity._metadata=null,this.atualizaPlanoTrabalhoEvent.emit(this.entity.id)}somaForcaTrabalho(e=[]){return e.map(t=>1*t.forca_trabalho).reduce((t,o)=>t+o,0)}carregarEntregas(e){var t=this;return(0,s.Z)(function*(){let o="string"==typeof e?yield t.planoEntregaDao.getById(e,["entregas.entrega:id,nome","unidade"]):e,n={id:o?.id,unidade_id:o?.unidade_id,unidade:o?.unidade};t.entregas=o?.entregas.map(l=>Object.assign({},{key:l.id,value:l.descricao||l.entrega?.nome||"Desconhecido",data:Object.assign(l,{plano_entrega:n})}))||[],t.entregas.sort((l,d)=>l.value>d.value?1:-1),t.entregas.find(l=>l.key==t.form.controls.plano_entrega_entrega_id.value)||t.form.controls.plano_entrega_entrega_id.setValue(null)})()}onOrigemChange(e){var t=this;return(0,s.Z)(function*(){let o=t.form.controls.origem.value;t.cdRef.detectChanges(),"OUTRO_ORGAO"==o?t.form?.controls.plano_entrega_entrega_id.setValue(null):"SEM_ENTREGA"==o?(t.form?.controls.orgao.setValue(null),t.form?.controls.plano_entrega_entrega_id.setValue(null)):"OUTRA_UNIDADE"==o&&(t.form?.controls.orgao.setValue(null),t.form?.controls.plano_entrega_id.value||(t.loading=!0,t.planoEntrega?.onSelectClick(new Event("SELECT")),t.loading=!1))})()}onPlanoEntregaChange(e){let t=this.planoEntrega?.selectedEntity;this.carregarEntregas(t)}onEntregaChange(e){}onForcaTrabalhoChange(e){let t=this.items.findIndex(o=>o.id==e.id);this.totalForcaTrabalho=Math.round(100*(this.somaForcaTrabalho(this.grid?.items)-1*this.items[t].forca_trabalho+1*this.form?.controls.forca_trabalho.value))/100}}var F;(S=j).\u0275fac=function(e){return new(e||S)(a.Y36(a.zs3))},S.\u0275cmp=a.Xpm({type:S,selectors:[["plano-trabalho-list-entrega"]],viewQuery:function(e,t){if(1&e&&(a.Gf(x.Q,5),a.Gf(C.M,5),a.Gf(st,5),a.Gf(dt,5),a.Gf(ct,5)),2&e){let o;a.iGM(o=a.CRH())&&(t.editableForm=o.first),a.iGM(o=a.CRH())&&(t.grid=o.first),a.iGM(o=a.CRH())&&(t.origem=o.first),a.iGM(o=a.CRH())&&(t.planoEntrega=o.first),a.iGM(o=a.CRH())&&(t.entrega=o.first)}},inputs:{control:"control",entity:"entity",disabled:"disabled",noPersist:"noPersist",cdRef:"cdRef",planoTrabalhoEditavel:"planoTrabalhoEditavel"},outputs:{atualizaPlanoTrabalhoEvent:"atualizaPlanoTrabalhoEvent"},features:[a.qOj],decls:34,vars:39,consts:[["noMargin","","editable","",3,"items","form","selectable","minHeight","join","groupBy","add","remove","save","load","saveEnd","hasDelete","hasEdit","hasAdd"],["gridEntregas",""],[3,"titleTemplate","template","editTemplate","verticalAlign","width","align"],["titleOrigem",""],["columnOrigem",""],["editOrigem",""],[3,"width","titleTemplate","template","editTemplate","verticalAlign","align"],["class","text-center"],["titleEntrega",""],["columnEntrega",""],["editEntrega",""],[3,"titleTemplate","title","template","editTemplate","width","align","titleHint"],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["editForcaTrabalho",""],[3,"maxWidth","titleTemplate","template","editTemplate","verticalAlign","align"],["titleDescricao",""],["columnDescricao",""],["solicitarDescricao",""],["editDescricao",""],["type","options"],[1,"text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["controlName","origem","controlName","origem",3,"control","items","change"],["origem",""],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change",4,"ngIf"],["controlName","orgao","placeholder","\xd3rg\xe3o",4,"ngIf"],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change"],["planoEntrega",""],["controlName","orgao","placeholder","\xd3rg\xe3o"],["orgao",""],["class","w-100",4,"ngIf"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],[1,"w-100"],["color","light","icon","bi bi-box-arrow-in-right","hint","Data de in\xedcio",3,"label"],["color","light","icon","bi bi-box-arrow-right","hint","Data de t\xe9rmino",3,"label"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change",4,"ngIf"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change"],["entrega",""],[4,"ngIf","ngIfElse"],["umCHD",""],["icon","bi bi-calculator",3,"color","label"],["icon","bi bi-intersect",3,"color","label"],["number","","sufix","%","controlName","forca_trabalho",3,"control","change"],["controlName","descricao",3,"rows","control"]],template:function(e,t){if(1&e&&(a.TgZ(0,"grid",0,1)(2,"columns")(3,"column",2),a.YNc(4,ut,4,0,"ng-template",null,3,a.W1O),a.YNc(6,_t,5,4,"ng-template",null,4,a.W1O),a.YNc(8,xt,4,5,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(10,"column",6),a.YNc(11,yt,3,0,"ng-template",7,8,a.W1O),a.YNc(13,Et,4,4,"ng-template",null,9,a.W1O),a.YNc(15,It,2,3,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(17,"column",11),a.YNc(18,Jt,4,2,"ng-template",null,12,a.W1O),a.YNc(20,Qt,2,1,"ng-template",null,13,a.W1O),a.YNc(22,wt,1,2,"ng-template",null,14,a.W1O),a.qZA(),a.TgZ(24,"column",15),a.YNc(25,Nt,4,0,"ng-template",null,16,a.W1O),a.YNc(27,qt,1,2,"ng-template",null,17,a.W1O),a.YNc(29,St,2,0,"ng-template",null,18,a.W1O),a.YNc(31,Ft,1,2,"ng-template",null,19,a.W1O),a.qZA(),a._UZ(33,"column",20),a.qZA()()),2&e){const o=a.MAs(5),n=a.MAs(7),l=a.MAs(9),d=a.MAs(12),p=a.MAs(14),c=a.MAs(16),_=a.MAs(19),u=a.MAs(21),b=a.MAs(23),m=a.MAs(26),H=a.MAs(28),B=a.MAs(32);a.Q6J("items",t.items)("form",t.form)("selectable",!1)("minHeight",t.items.length>2?0:300)("join",t.join)("groupBy",t.groupBy)("add",t.addEntrega.bind(t))("remove",t.removeEntrega.bind(t))("save",t.saveEntrega.bind(t))("load",t.loadEntrega.bind(t))("saveEnd",t.saveEndEntrega.bind(t))("hasDelete",!t.disabled&&t.planoTrabalhoEditavel)("hasEdit",!t.disabled&&t.planoTrabalhoEditavel)("hasAdd",!t.disabled&&t.planoTrabalhoEditavel),a.xp6(3),a.Q6J("titleTemplate",o)("template",n)("editTemplate",l)("verticalAlign","middle")("width",300)("align","center"),a.xp6(7),a.Q6J("width",350)("titleTemplate",d)("template",p)("editTemplate",c)("verticalAlign","middle")("align","center"),a.xp6(7),a.Q6J("titleTemplate",_)("title","% CHD")("template",u)("editTemplate",b)("width",100)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),a.xp6(7),a.Q6J("maxWidth",250)("titleTemplate",m)("template",H)("editTemplate",B)("verticalAlign","middle")("align","center")}},dependencies:[g.O5,C.M,M.a,q.b,T.V,aa.m,Ca.Q,oa.p,E.F,Aa.C]});const Rt=["gridAtividades"],Vt=["gridDocumentos"],Lt=["tabs"],zt=["usuario"],Gt=["programa"],Yt=["unidade"],Ht=["tipoModalidade"],Bt=["planoEntrega"],kt=["atividade"],Wt=["entrega"],jt=["documentos"];function Kt(i,e){if(1&i&&(a.TgZ(0,"separator",26),a._UZ(1,"calendar-efemerides",27),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("efemerides",t.horasTotais)("partial",!1)}}function Xt(i,e){if(1&i&&(a.TgZ(0,"separator",28),a._UZ(1,"calendar-efemerides",29),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("efemerides",t.horasParciais)}}function $t(i,e){if(1&i){const t=a.EpF();a.ynx(0),a.TgZ(1,"div",4)(2,"input-workload",21),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw();return a.KtG(l.onCargaHorariaChenge(n))}),a.qZA(),a._UZ(3,"input-timer",22)(4,"input-timer",23),a.qZA(),a.YNc(5,Kt,2,2,"separator",24),a.YNc(6,Xt,2,1,"separator",25),a.BQk()}if(2&i){const t=a.oxw();a.xp6(2),a.Q6J("size",4)("unit",t.formaContagemCargaHoraria)("control",t.form.controls.carga_horaria)("unitChange",t.onFormaContagemCargaHorariaChange.bind(t)),a.xp6(1),a.Q6J("size",4)("control",t.form.controls.tempo_total),a.xp6(1),a.Q6J("size",4)("control",t.form.controls.tempo_proporcional),a.xp6(1),a.Q6J("ngIf",t.horasTotais),a.xp6(1),a.Q6J("ngIf",t.horasParciais)}}function ae(i,e){if(1&i&&a._UZ(0,"top-alert",30),2&i){const t=a.oxw();a.Q6J("message","Antes de incluir "+t.lex.translate("entrega")+" neste "+t.lex.translate("Plano de Trabalho")+", \xe9 necess\xe1rio selecionar "+t.lex.translate("a Unidade")+" e  o "+t.lex.translate("Programa")+"!")}}function te(i,e){if(1&i&&(a.TgZ(0,"div"),a._UZ(1,"plano-trabalho-list-entrega",31),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("disabled",t.formDisabled)("entity",t.entity)}}function ee(i,e){if(1&i&&(a.TgZ(0,"tab",32)(1,"separator",17),a._UZ(2,"input-switch",33)(3,"input-editor",34),a.qZA(),a.TgZ(4,"separator",35),a._UZ(5,"input-switch",36)(6,"input-editor",37),a.qZA()()),2&i){const t=a.oxw();a.Q6J("label",t.lex.translate("Texto Complementar")),a.xp6(1),a.Q6J("title","Texto complementar da "+t.lex.translate("unidade")),a.xp6(1),a.Q6J("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("na unidade")),a.xp6(1),a.Q6J("disabled",t.form.controls.editar_texto_complementar_unidade.value?void 0:"true")("dataset",t.planoDataset),a.xp6(2),a.Q6J("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("do usu\xe1rio")),a.xp6(1),a.Q6J("disabled",t.form.controls.editar_texto_complementar_usuario.value?void 0:"true")("dataset",t.planoDataset)}}function oe(i,e){if(1&i&&(a.TgZ(0,"tab",38)(1,"div",39),a._UZ(2,"documentos",40,41),a.qZA()()),2&i){const t=a.oxw(),o=a.MAs(12);a.Q6J("label",t.lex.translate("Termo")),a.xp6(2),a.Q6J("entity",t.entity)("disabled",t.formDisabled)("cdRef",t.cdRef)("needSign",t.planoTrabalhoService.needSign)("extraTags",t.planoTrabalhoService.extraTags)("editingId",t.formDisabled?void 0:t.editingId)("datasource",t.datasource)("template",null==o||null==o.selectedEntity?null:o.selectedEntity.template_tcr)}}const ie=function(){return["afastamentos","lotacao","unidades","participacoes_programas"]},ne=function(){return["usuario_id"]},le=function(){return["usuario_id","programa_id","tipo_modalidade_id"]};class K extends ha.F{constructor(e){super(e,y.p,P.t),this.injector=e,this.entregas=[],this.gestoresUnidadeExecutora=[],this.validate=(t,o)=>{let n=null;return["unidade_id","programa_id","usuario_id","tipo_modalidade_id"].indexOf(o)>=0&&!t.value?.length?n="Obrigat\xf3rio":["carga_horaria"].indexOf(o)>=0&&!t.value?n="Valor n\xe3o pode ser zero.":["data_inicio","data_fim"].includes(o)&&!this.util.isDataValid(t.value)?n="Inv\xe1lido":"data_fim"==o&&this.util.isDataValid(this.form?.controls.data_inicio.value)&&this.util.asTimestamp(t.value)<=this.util.asTimestamp(this.form.controls.data_inicio.value)?n="Menor que o in\xedcio":this.programa&&"data_inicio"==o&&t.value.getTime()<this.programa.selectedEntity?.data_inicio.getTime()?n="Menor que programa":this.programa&&"data_fim"==o&&t.value.getTime()>this.programa.selectedEntity?.data_fim.getTime()&&(n="Maior que programa"),n},this.formValidation=function(){var t=(0,s.Z)(function*(o){return""});return function(o){return t.apply(this,arguments)}}(),this.titleEdit=t=>"Editando "+this.lex.translate("Plano de Trabalho")+": "+(t?.usuario?.apelido||""),this.join=["unidade.entidade","entregas.entrega","entregas.plano_entrega_entrega:id,plano_entrega_id","usuario","programa.template_tcr","tipo_modalidade","documento","documentos.assinaturas.usuario:id,nome,apelido","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega.unidade:id,nome,sigla","entregas.reacoes.usuario:id,nome,apelido"],this.joinPrograma=["template_tcr"],this.programaDao=e.get(pa.w),this.usuarioDao=e.get($.q),this.unidadeDao=e.get(U.J),this.documentoService=e.get(Ka.t),this.templateService=e.get(Xa.E),this.utilService=e.get($a.f),this.calendar=e.get(va.o),this.allPages=e.get(ga.T),this.tipoModalidadeDao=e.get(_a.D),this.documentoDao=e.get(ma.d),this.planoTrabalhoService=e.get(w.p),this.modalWidth=1300,this.planoDataset=this.dao.dataset(),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},unidade_id:{default:""},programa_id:{default:""},documento_id:{default:null},documentos:{default:[]},atividades:{default:[]},entregas:{default:[]},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"},editar_texto_complementar_unidade:{default:!1},editar_texto_complementar_usuario:{default:!1},unidade_texto_complementar:{default:""},usuario_texto_complementar:{default:""},criterios_avaliacao:{default:[]},criterio_avaliacao:{default:""}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();const e=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["termos"].includes(e)?e:this.action,this.buscaGestoresUnidadeExecutora(this.entity?.unidade??null)}atualizarTcr(){this.entity=this.loadEntity();let e=this.form.controls.usuario_texto_complementar.value,t=this.form.controls.unidade_texto_complementar.value,o=this.planoTrabalhoService.atualizarTcr(this.planoTrabalho,this.entity,e,t);this.form?.controls.documento_id.setValue(o?.id),this.form?.controls.documentos.setValue(this.entity.documentos),this.datasource=o?.datasource||{},this.template=this.entity.programa?.template_tcr,this.editingId=["ADD","EDIT"].includes(o?._status||"")?o.id:void 0,this.cdRef.detectChanges()}get isTermos(){return"termos"==this.action}onUnidadeSelect(e){let t=this.unidade?.selectedEntity;this.entity.unidade=t,this.entity.unidade_id=t.id,this.form.controls.forma_contagem_carga_horaria.setValue(t?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(t?.texto_complementar_plano||""),this.unidadeDao.getById(t.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(o=>{this.buscaGestoresUnidadeExecutora(o)})}podeEditarTextoComplementar(e){return e==this.auth.unidadeGestor()?.id?void 0:"true"}onProgramaSelect(e){let t=e.entity;this.entity.programa_id=t.id,this.entity.programa=t,this.form?.controls.criterios_avaliacao.setValue(t.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity(),this.calculaTempos(),this.cdRef.detectChanges()}onUsuarioSelect(e){var t=this;this.form.controls.usuario_texto_complementar.setValue(e.entity?.texto_complementar_plano||""),this.form?.controls.unidade_id.value||e.entity.unidades?.every(function(){var o=(0,s.Z)(function*(n){if(e.entity.lotacao.unidade_id==n.id){if(!t.form?.controls.programa_id.value){let l=n.path.split("/").reverse(),d=new Date,p=0,c=0;for(;0==p;)yield t.programaDao.query({where:[["unidade_id","==",l[c]],["data_inicio","<",d],["data_fim",">",d]]}).asPromise().then(_=>{_.length>0&&0==p&&(p=1,t.preencheUnidade(n),t.preenchePrograma(_[0]))}),c+=1}return!1}return!0});return function(n){return o.apply(this,arguments)}}()),this.calculaTempos(),this.cdRef.detectChanges()}preencheUnidade(e){this.form?.controls.unidade_id.setValue(e.id),this.entity.unidade=e,this.entity.unidade_id=e.id,this.form.controls.forma_contagem_carga_horaria.setValue(e?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(e?.texto_complementar_plano||""),this.unidadeDao.getById(e.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(t=>{this.buscaGestoresUnidadeExecutora(t)})}preenchePrograma(e){this.form?.controls.programa_id.setValue(e.id),this.entity.programa_id=e.id,this.entity.programa=e,this.form?.controls.criterios_avaliacao.setValue(e.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity()}onDataInicioChange(e){this.calculaTempos()}onDataFimChange(e){this.calculaTempos()}onCargaHorariaChenge(e){this.calculaTempos()}calculaTempos(){const e=this.form?.controls.data_inicio.value,t=this.form?.controls.data_fim.value,o=this.form?.controls.carga_horaria.value||8,n=this.usuario?.selectedEntity,l=this.unidade?.selectedEntity;n&&l&&this.util.isDataValid(e)&&this.util.isDataValid(t)&&this.util.asTimestamp(e)<this.util.asTimestamp(t)&&this.calendar.loadFeriadosCadastrados(l.id).then(d=>{this.horasTotais=this.calendar.calculaDataTempoUnidade(e,t,o,l,"ENTREGA",[],[]),this.horasParciais=this.calendar.calculaDataTempoUnidade(e,t,o,l,"ENTREGA",[],n.afastamentos),this.form?.controls.tempo_total.setValue(this.horasTotais.tempoUtil),this.form?.controls.tempo_proporcional.setValue(this.horasParciais.tempoUtil)})}loadData(e,t){var o=this;return(0,s.Z)(function*(){o.planoTrabalho=new y.p(e),yield Promise.all([o.calendar.loadFeriadosCadastrados(e.unidade_id),o.usuario?.loadSearch(e.usuario||e.usuario_id),o.unidade?.loadSearch(e.unidade||e.unidade_id),o.programa?.loadSearch(e.programa||e.programa_id),o.tipoModalidade?.loadSearch(e.tipo_modalidade||e.tipo_modalidade_id)]);let n=Object.assign({},t.value);t.patchValue(o.util.fillForm(n,e)),o.calculaTempos(),o.atualizarTcr()})()}initializeData(e){var t=this;return(0,s.Z)(function*(){t.isTermos?t.entity=yield t.dao.getById(t.urlParams.get("id"),t.join):(t.entity=new y.p,t.entity.carga_horaria=t.auth.entidade?.carga_horaria_padrao||8,t.entity.forma_contagem_carga_horaria=t.auth.entidade?.forma_contagem_carga_horaria||"DIA",t.entity.unidade_id=t.auth.unidade.id,t.buscaGestoresUnidadeExecutora(t.auth.unidade),t.gestoresUnidadeExecutora.includes(t.auth.unidade.id)||(t.entity.usuario_id=t.auth.usuario.id)),yield t.loadData(t.entity,t.form);let o=new Date;o.setHours(0,0,0,0),t.form?.controls.data_inicio.setValue(o),t.form?.controls.data_fim.setValue("")})()}loadEntity(){let e=this.util.fill(new y.p,this.entity);return e=this.util.fillForm(e,this.form.value),e.usuario=this.usuario.selectedEntity||this.entity?.usuario,e.unidade=this.unidade?.selectedEntity||this.entity?.unidade,e.programa=this.programa?.selectedEntity||this.entity?.programa,e.tipo_modalidade=this.tipoModalidade.selectedEntity||this.entity?.tipo_modalidade,e}saveData(e){var t=this;return(0,s.Z)(function*(){t.submitting=!0;try{t.atualizarTcr(),t.documentos?.saveData(),t.submitting=!0,t.entity.documentos=t.entity.documentos.filter(l=>["ADD","EDIT","DELETE"].includes(l._status||""));let o=[t.dao.save(t.entity,t.join)];t.form.controls.editar_texto_complementar_unidade.value&&o.push(t.unidadeDao.update(t.entity.unidade_id,{texto_complementar_plano:t.form.controls.unidade_texto_complementar.value})),t.form.controls.editar_texto_complementar_usuario.value&&o.push(t.usuarioDao.update(t.entity.usuario_id,{texto_complementar_plano:t.form.controls.usuario_texto_complementar.value}));let n=yield Promise.all(o);t.entity=n[0]}finally{t.submitting=!1}return!0})()}onTabSelect(e){"TERMO"==e.key&&this.atualizarTcr()}documentoDynamicButtons(e){let t=[],o=e;return this.isTermos&&this.planoTrabalhoService.needSign(this.entity,o)&&t.push({hint:"Assinar",icon:"bi bi-pen",onClick:this.signDocumento.bind(this)}),t.push({hint:"Preview",icon:"bi bi-zoom-in",onClick:(n=>{this.dialog.html({title:"Termo de ades\xe3o",modalWidth:1e3},n.conteudo||"")}).bind(this)}),t}signDocumento(e){var t=this;return(0,s.Z)(function*(){yield t.documentoService.sign([e]),t.cdRef.detectChanges()})()}get formaContagemCargaHoraria(){const e=this.form?.controls.forma_contagem_carga_horaria.value||"DIA";return"DIA"==e?"day":"SEMANA"==e?"week":"mouth"}onFormaContagemCargaHorariaChange(e){this.form.controls.forma_contagem_carga_horaria.setValue("day"==e?"DIA":"week"==e?"SEMANA":"MES")}isVigente(e){return this.form.controls.documento_id.value==e.id}buscaGestoresUnidadeExecutora(e){return e&&[e.gestor?.usuario_id,...e.gestores_substitutos?.map(t=>t.usuario_id),...e.gestores_delegados?.map(t=>t.usuario_id)].forEach(t=>{t&&this.gestoresUnidadeExecutora.push(t)}),this.gestoresUnidadeExecutora}}(F=K).\u0275fac=function(e){return new(e||F)(a.Y36(a.zs3))},F.\u0275cmp=a.Xpm({type:F,selectors:[["plano-trabalho-form"]],viewQuery:function(e,t){if(1&e&&(a.Gf(x.Q,5),a.Gf(Rt,5),a.Gf(Vt,5),a.Gf(Lt,5),a.Gf(zt,5),a.Gf(Gt,5),a.Gf(Yt,5),a.Gf(Ht,5),a.Gf(Bt,5),a.Gf(kt,5),a.Gf(Wt,5),a.Gf(jt,5)),2&e){let o;a.iGM(o=a.CRH())&&(t.editableForm=o.first),a.iGM(o=a.CRH())&&(t.gridAtividades=o.first),a.iGM(o=a.CRH())&&(t.gridDocumentos=o.first),a.iGM(o=a.CRH())&&(t.tabs=o.first),a.iGM(o=a.CRH())&&(t.usuario=o.first),a.iGM(o=a.CRH())&&(t.programa=o.first),a.iGM(o=a.CRH())&&(t.unidade=o.first),a.iGM(o=a.CRH())&&(t.tipoModalidade=o.first),a.iGM(o=a.CRH())&&(t.planoEntrega=o.first),a.iGM(o=a.CRH())&&(t.atividade=o.first),a.iGM(o=a.CRH())&&(t.entrega=o.first),a.iGM(o=a.CRH())&&(t.documentos=o.first)}},features:[a.qOj],decls:24,vars:35,consts:[["initialFocus","plano_entrega_id",3,"form","disabled","noButtons","submit","cancel"],["display","","right","",3,"hidden","title","select"],["tabs",""],["key","DADOS","label","Dados"],[1,"row"],[1,"col-md-12"],["required","","controlName","usuario_id",3,"size","disabled","dao","join","select"],["usuario",""],["required","","controlName","unidade_id",3,"size","disabled","dao","select"],["unidade",""],["icon","bi bi-file-bar-graph","required","","controlName","programa_id",3,"size","label","disabled","join","dao","select"],["programa",""],["label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","required","",3,"size","control","labelInfo","change"],["label","Final","icon","bi bi-calendar-date","controlName","data_fim","required","",3,"size","control","labelInfo","change"],["controlName","tipo_modalidade_id","required","",3,"size","dao"],["tipoModalidade",""],[4,"ngIf"],[3,"title"],["type","warning",3,"message",4,"ngIf"],["key","MENSAGENS",3,"label",4,"ngIf"],["key","TERMO",3,"label",4,"ngIf"],["label","Carga Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria","labelInfo","Carga hor\xe1ria do usu\xe1rio (M\xe1x.: di\xe1ria 24 horas; semana 24*5=240 horas; mensal 24*20=480 horas)","required","",3,"size","unit","control","unitChange","change"],["onlyHours","","disabled","","label","Horas Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["onlyHours","","disabled","","label","Horas Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["title","C\xe1lculos das horas totais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas parciais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas totais","collapse",""],[3,"efemerides","partial"],["title","C\xe1lculos das horas parciais","collapse",""],[3,"efemerides"],["type","warning",3,"message"],["noPersist","",3,"disabled","entity"],["key","MENSAGENS",3,"label"],["controlName","editar_texto_complementar_unidade","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","unidade_texto_complementar",3,"disabled","dataset"],["title","Texto complementar do usuario"],["controlName","editar_texto_complementar_usuario","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","usuario_texto_complementar",3,"disabled","dataset"],["key","TERMO",3,"label"],["clss","row"],["noPersist","","especie","TCR",3,"entity","disabled","cdRef","needSign","extraTags","editingId","datasource","template"],["documentos",""]],template:function(e,t){if(1&e&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),a.TgZ(1,"tabs",1,2)(3,"tab",3)(4,"div",4)(5,"div",5)(6,"div",4)(7,"input-search",6,7),a.NdJ("select",function(n){return t.onUsuarioSelect(n)}),a.qZA(),a.TgZ(9,"input-search",8,9),a.NdJ("select",function(n){return t.onUnidadeSelect(n)}),a.qZA(),a.TgZ(11,"input-search",10,11),a.NdJ("select",function(n){return t.onProgramaSelect(n)}),a.qZA()(),a.TgZ(13,"div",4)(14,"input-datetime",12),a.NdJ("change",function(n){return t.onDataInicioChange(n)}),a.qZA(),a.TgZ(15,"input-datetime",13),a.NdJ("change",function(n){return t.onDataFimChange(n)}),a.qZA(),a._UZ(16,"input-search",14,15),a.qZA(),a.YNc(18,$t,7,10,"ng-container",16),a.qZA()(),a.TgZ(19,"separator",17),a.YNc(20,ae,1,1,"top-alert",18),a.YNc(21,te,2,2,"div",16),a.qZA()(),a.YNc(22,ee,7,12,"tab",19),a.YNc(23,oe,4,9,"tab",20),a.qZA()()),2&e){const o=a.MAs(17);a.Q6J("form",t.form)("disabled",t.formDisabled)("noButtons",t.isTermos?"true":void 0),a.xp6(1),a.Q6J("hidden",t.isTermos?"true":void 0)("title",t.isModal?"":t.title)("select",t.onTabSelect.bind(t)),a.xp6(6),a.Q6J("size",4)("disabled","new"==t.action?void 0:"true")("dao",t.usuarioDao)("join",a.DdM(32,ie)),a.xp6(2),a.Q6J("size",4)("disabled","new"==t.action?void 0:"true")("dao",t.unidadeDao),a.xp6(2),a.Q6J("size",4)("label",t.lex.translate("Programa de gest\xe3o"))("disabled","new"==t.action?void 0:"true")("join",t.joinPrograma)("dao",t.programaDao),a.xp6(3),a.Q6J("size",3)("control",t.form.controls.data_inicio)("labelInfo","In\xedcio da Vig\xeancia do "+t.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",3)("control",t.form.controls.data_fim)("labelInfo","Final da Vig\xeancia do "+t.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",6)("dao",t.tipoModalidadeDao),a.xp6(2),a.Q6J("ngIf",null==o.selectedEntity?null:o.selectedEntity.plano_trabalho_calcula_horas),a.xp6(1),a.Q6J("title",t.lex.translate("Entregas")+t.lex.translate(" do plano de trabalho")),a.xp6(1),a.Q6J("ngIf",!(null!=t.form.controls.programa_id.value&&t.form.controls.programa_id.value.length&&null!=t.form.controls.unidade_id.value&&t.form.controls.unidade_id.value.length)),a.xp6(1),a.Q6J("ngIf",(null==t.form.controls.programa_id.value?null:t.form.controls.programa_id.value.length)&&(null==t.form.controls.unidade_id.value?null:t.form.controls.unidade_id.value.length)),a.xp6(1),a.Q6J("ngIf",t.checkFilled(a.DdM(33,ne))),a.xp6(1),a.Q6J("ngIf",t.checkFilled(a.DdM(34,le)))}},dependencies:[g.O5,x.Q,J.a,T.V,k.k,at.u,W.n,ta.i,Z.N,tt.o,fa.S,et.G,ot.Y,it.N,j]});var R,Za=r(89997),na=r(57765),Ea=r(2729),re=r(55736);function se(i,e){if(1&i&&a._UZ(0,"i"),2&i){const t=a.oxw();a.Tol(t.icon)}}const Da=function(i){return{data:i}};function de(i,e){if(1&i&&a.GkF(0,5),2&i){const t=a.oxw();a.Q6J("ngTemplateOutlet",t.titleTemplate)("ngTemplateOutletContext",a.VKq(2,Da,t.data))}}function ce(i,e){if(1&i&&a.GkF(0,5),2&i){const t=a.oxw(2);a.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",a.VKq(2,Da,t.data))}}function ue(i,e){if(1&i&&(a.TgZ(0,"div",6),a.YNc(1,ce,1,4,"ng-container",3),a.Hsn(2),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("ngIf",t.template)}}class Oa extends re.V{set class(e){this._class!=e&&(this._class=e)}get class(){return"card m-3 "+this.getClassBorderColor(this.color)+this._class}constructor(e){super(e),this.injector=e,this.collapsed=!0}ngOnInit(){}onHeaderClick(){this.collapsed=!this.collapsed,this.cdRef.detectChanges()}get style(){return this.getStyleBgColor(this.color)}}(R=Oa).\u0275fac=function(e){return new(e||R)(a.Y36(a.zs3))},R.\u0275cmp=a.Xpm({type:R,selectors:[["collapse-card"]],inputs:{title:"title",data:"data",icon:"icon",collapsed:"collapsed",color:"color",template:"template",titleTemplate:"titleTemplate",class:"class"},features:[a.qOj],ngContentSelectors:["*"],decls:7,vars:6,consts:[[1,"card","border-primary","m-3"],["role","button",1,"card-header",3,"click"],[3,"class",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],["class","card-body text-primary",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"card-body","text-primary"]],template:function(e,t){1&e&&(a.F$t(),a.TgZ(0,"div",0)(1,"div",1),a.NdJ("click",function(){return t.onHeaderClick()}),a.YNc(2,se,1,2,"i",2),a._uU(3),a.YNc(4,de,1,4,"ng-container",3),a._UZ(5,"i"),a.qZA(),a.YNc(6,ue,3,1,"div",4),a.qZA()),2&e&&(a.xp6(2),a.Q6J("ngIf",t.icon),a.xp6(1),a.hij(" ",t.title||""," "),a.xp6(1),a.Q6J("ngIf",t.titleTemplate),a.xp6(1),a.Tol("collapse-card-toggle-icon "+(t.collapsed?"bi bi-chevron-down":"bi bi-chevron-up")),a.xp6(1),a.Q6J("ngIf",!t.collapsed))},dependencies:[g.O5,g.tP],styles:[".card-header[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transition:.3s transform ease-in-out}.card-header[_ngcontent-%COMP%]   .collapsed[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transform:rotate(90deg)}.collapse-card-toggle-icon[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}"]});var pe=r(90058),la=r(17046),_e=r(64368);class Ia extends _e.X{constructor(e){super(),this.data_inicio=new Date,this.data_fim=new Date,this.status="INCLUIDO",this.avaliacoes=[],this.status_historico=[],this.plano_trabalho_id="",this.avaliacao_id=null,this.initialization(e)}}var D,Pa=r(41095),Ua=r(56486),ge=r(73101),he=r(22981),fe=r(77447),be=r(84971),ve=r(57338),Te=r(39373),Ce=r(56976);class Ja extends Ce.B{constructor(e){super("Comparecimento",e),this.injector=e,this.inputSearchConfig.searchFields=["data_comparecimento"]}}(D=Ja).\u0275fac=function(e){return new(e||D)(a.LFG(a.zs3))},D.\u0275prov=a.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"});var V,Ae=r(25034),xe=r(17819),ye=r(69756),Ze=r(9224),Ee=r(81419),Qa=r(72504),De=r(62095);const Oe=["gridEntregas"],Ie=["gridAtividades"],Pe=["etiqueta"],Ue=["tipoAtividade"],Je=["listTarefas"];function Qe(i,e){if(1&i&&(a.TgZ(0,"span",34),a._UZ(1,"i",35),a._uU(2),a.qZA()),2&i){const t=a.oxw().row;a.xp6(2),a.hij(" ",null==t.atividades?null:t.atividades.length,"")}}function we(i,e){if(1&i&&a.YNc(0,Qe,3,1,"span",33),2&i){const t=e.row;a.Q6J("ngIf",null==t.atividades?null:t.atividades.length)}}function Ne(i,e){if(1&i&&(a.TgZ(0,"span",34),a._UZ(1,"i",35),a._uU(2),a.qZA()),2&i){const t=a.oxw().row;a.xp6(2),a.hij(" ",null==t.tarefas?null:t.tarefas.length,"")}}function Me(i,e){if(1&i&&a.YNc(0,Ne,3,1,"span",33),2&i){const t=e.row;a.Q6J("ngIf",null==t.tarefas?null:t.tarefas.length)}}function qe(i,e){if(1&i&&a._UZ(0,"atividade-list-tarefa",51,52),2&i){const t=e.row;a.Q6J("atividade",t)("consolidacao",!1)}}function Se(i,e){if(1&i&&(a.TgZ(0,"span",53),a._UZ(1,"badge",54),a.qZA(),a.TgZ(2,"span",55),a._uU(3),a.qZA(),a._UZ(4,"reaction",56)),2&i){const t=e.row,o=a.oxw(2);a.xp6(1),a.Q6J("label",t.numero)("data",t.numero)("click",o.atividadeService.onIdClick.bind(o)),a.xp6(2),a.Oqu(t.descricao),a.xp6(1),a.Q6J("entity",t)}}function Fe(i,e){if(1&i&&a._UZ(0,"input-textarea",57),2&i){const t=a.oxw(2);a.Q6J("size",12)("rows",2)("control",t.formAtividade.controls.descricao)}}function Re(i,e){if(1&i&&a._UZ(0,"badge",60),2&i){const t=e.$implicit;a.Q6J("badge",t)}}function Ve(i,e){if(1&i&&(a.TgZ(0,"div",58),a.YNc(1,Re,1,1,"badge",59),a.qZA()),2&i){const t=e.row,o=a.oxw(2);a.xp6(1),a.Q6J("ngForOf",o.tempoAtividade(t))}}function Le(i,e){if(1&i&&(a.TgZ(0,"separator",61),a._UZ(1,"input-datetime",62)(2,"input-datetime",63),a.qZA()),2&i){const t=a.oxw(2);a.Q6J("collapsed",!0),a.xp6(1),a.Q6J("control",t.formAtividade.controls.data_inicio),a.xp6(1),a.Q6J("control",t.formAtividade.controls.data_entrega)}}function ze(i,e){if(1&i&&a._UZ(0,"badge",68),2&i){const t=e.$implicit;a.Q6J("lookup",t)}}function Ge(i,e){1&i&&a._UZ(0,"separator",69)}function Ye(i,e){1&i&&a._UZ(0,"i",73)}function He(i,e){if(1&i&&(a.TgZ(0,"tr")(1,"td"),a.YNc(2,Ye,1,0,"i",71),a.qZA(),a.TgZ(3,"td",72),a._uU(4),a.qZA()()),2&i){const t=e.$implicit;a.xp6(2),a.Q6J("ngIf",t.checked),a.xp6(2),a.Oqu(t.texto)}}function Be(i,e){if(1&i&&(a.TgZ(0,"table"),a.YNc(1,He,5,2,"tr",70),a.qZA()),2&i){const t=a.oxw().row;a.xp6(1),a.Q6J("ngForOf",t.checklist)}}function ke(i,e){if(1&i&&(a._UZ(0,"progress-bar",64),a.YNc(1,ze,1,1,"badge",65),a.YNc(2,Ge,1,0,"separator",66),a.YNc(3,Be,2,1,"table",67)),2&i){const t=e.row;a.Q6J("value",t.progresso),a.xp6(1),a.Q6J("ngForOf",t.etiquetas),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function We(i,e){1&i&&a._UZ(0,"separator",69)}function je(i,e){if(1&i&&(a.TgZ(0,"tr")(1,"td"),a._UZ(2,"input-switch",78),a.qZA(),a.TgZ(3,"td",72),a._uU(4),a.qZA()()),2&i){const t=e.$implicit,o=e.index,n=a.oxw(4);a.xp6(2),a.Q6J("size",12)("source",n.checklist)("path",o+".checked"),a.xp6(2),a.Oqu(t.texto)}}function Ke(i,e){if(1&i&&(a.TgZ(0,"table"),a.YNc(1,je,5,4,"tr",70),a.qZA()),2&i){const t=a.oxw(3);a.xp6(1),a.Q6J("ngForOf",t.checklist)}}function Xe(i,e){if(1&i){const t=a.EpF();a._UZ(0,"input-number",74),a.TgZ(1,"input-multiselect",75)(2,"input-select",76,77),a.NdJ("details",function(){a.CHM(t);const n=a.oxw(2);return a.KtG(n.onEtiquetaConfigClick())}),a.qZA()(),a.YNc(4,We,1,0,"separator",66),a.YNc(5,Ke,2,1,"table",67)}if(2&i){const t=e.row,o=a.oxw(2);a.Q6J("size",12)("decimals",2)("control",o.formEdit.controls.progresso),a.xp6(1),a.Q6J("size",12)("control",o.formEdit.controls.etiquetas)("addItemHandle",o.addItemHandleEtiquetas.bind(o)),a.xp6(1),a.Q6J("size",12)("control",o.formEdit.controls.etiqueta)("items",o.etiquetas),a.xp6(2),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function $e(i,e){if(1&i&&a._UZ(0,"badge",83),2&i){const t=e.$implicit;a.Q6J("data",t)("color",t.color)("icon",t.icon)("label",t.label)}}function ao(i,e){if(1&i&&a._UZ(0,"comentarios-widget",84),2&i){const t=a.oxw().row;a.oxw();const o=a.MAs(1);a.Q6J("entity",t)("selectable",!1)("grid",o)}}function to(i,e){if(1&i&&(a._UZ(0,"documentos-badge",79),a.TgZ(1,"span",80),a.YNc(2,$e,1,4,"badge",81),a.qZA(),a.YNc(3,ao,1,3,"comentarios-widget",82)),2&i){const t=e.row;a.oxw();const o=a.MAs(1),n=a.oxw();a.Q6J("documento",t.documento_requisicao),a.xp6(2),a.Q6J("ngForOf",n.atividadeService.getStatus(t,n.entity)),a.xp6(1),a.Q6J("ngIf",!o.editing)}}function eo(i,e){if(1&i&&(a.TgZ(0,"grid",36,37)(2,"columns")(3,"column",38),a.YNc(4,Me,1,1,"ng-template",null,39,a.W1O),a.YNc(6,qe,2,2,"ng-template",null,40,a.W1O),a.qZA(),a.TgZ(8,"column",41),a.YNc(9,Se,5,5,"ng-template",null,42,a.W1O),a.YNc(11,Fe,1,3,"ng-template",null,43,a.W1O),a.qZA(),a.TgZ(13,"column",44),a.YNc(14,Ve,2,1,"ng-template",null,45,a.W1O),a.YNc(16,Le,3,3,"ng-template",null,46,a.W1O),a.qZA(),a.TgZ(18,"column",41),a.YNc(19,ke,4,4,"ng-template",null,47,a.W1O),a.YNc(21,Xe,6,11,"ng-template",null,48,a.W1O),a.qZA(),a.TgZ(23,"column",44),a.YNc(24,to,4,3,"ng-template",null,49,a.W1O),a.qZA(),a._UZ(26,"column",50),a.qZA()()),2&i){const t=e.row,o=a.MAs(5),n=a.MAs(7),l=a.MAs(10),d=a.MAs(12),p=a.MAs(15),c=a.MAs(17),_=a.MAs(20),u=a.MAs(22),b=a.MAs(25),m=a.oxw();a.Q6J("items",t.atividades)("minHeight",0)("form",m.formAtividade)("hasAdd",!m.disabled)("hasDelete",!1)("hasEdit",!1)("add",m.addAtividade.bind(m,t.entrega))("load",m.loadAtividade.bind(m))("remove",m.removeAtividade.bind(m,t.atividades))("save",m.saveAtividade.bind(m)),a.xp6(3),a.Q6J("width",50)("align","center")("hint","Tarefas da "+m.lex.translate("atividade"))("template",o)("expandTemplate",n),a.xp6(5),a.Q6J("title","#ID/Trabalho executado")("width",400)("template",l)("editTemplate",d)("columnEditTemplate",m.atividadeOptionsMetadata.disabled?void 0:d)("edit",m.atividadeOptionsMetadata.disabled?void 0:m.onColumnAtividadeDescricaoEdit.bind(m))("save",m.atividadeOptionsMetadata.disabled?void 0:m.onColumnAtividadeDescricaoSave.bind(m)),a.xp6(5),a.Q6J("title","In\xedcio e Conclus\xe3o")("width",250)("template",p)("editTemplate",c),a.xp6(5),a.Q6J("title","Progresso\nEtiquetas/Checklist")("width",200)("template",_)("editTemplate",_)("columnEditTemplate",m.atividadeOptionsMetadata.disabled?void 0:u)("edit",m.atividadeOptionsMetadata.disabled?void 0:m.onColumnProgressoEtiquetasChecklistEdit.bind(m))("save",m.atividadeOptionsMetadata.disabled?void 0:m.onColumnProgressoEtiquetasChecklistSave.bind(m)),a.xp6(5),a.Q6J("title","n\xba Processo/Status\nComent\xe1rios")("width",300)("template",b)("editTemplate",b),a.xp6(3),a.Q6J("metadata",m.atividadeOptionsMetadata)("dynamicOptions",m.atividadeService.dynamicOptions.bind(m))("dynamicButtons",m.atividadeService.dynamicButtons.bind(m))}}function oo(i,e){if(1&i&&a._UZ(0,"badge",85),2&i){const t=e.row;a.Q6J("label",t.badge.titulo)("color",t.badge.cor)}}function io(i,e){if(1&i&&(a._uU(0),a._UZ(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA(),a._UZ(4,"reaction",86)),2&i){const t=e.row;a.hij(" ",t.badge.descricao||t.entrega.descricao,""),a.xp6(3),a.Oqu(t.entrega.descricao),a.xp6(1),a.Q6J("entity",t.entrega)}}function no(i,e){if(1&i&&a._UZ(0,"badge",87),2&i){const t=e.row;a.Q6J("label",t.entrega.forca_trabalho+"%")}}function lo(i,e){if(1&i&&a._UZ(0,"badge",88)(1,"br")(2,"badge",89),2&i){const t=e.row;a.Q6J("textValue",t.meta),a.xp6(2),a.Q6J("textValue",t.metaRealizado)}}function ro(i,e){if(1&i&&a._UZ(0,"progress-bar",64),2&i){const t=e.row;a.Q6J("value",t.progresso_realizado)}}function so(i,e){if(1&i&&(a._UZ(0,"badge",90),a._uU(1)),2&i){const t=e.row;a.Q6J("color",t.tipo_motivo_afastamento.cor)("icon",t.tipo_motivo_afastamento.icone)("label",t.tipo_motivo_afastamento.nome),a.xp6(1),a.hij(" ",t.observacao," ")}}function co(i,e){if(1&i&&a._UZ(0,"badge",91),2&i){const t=e.row,o=a.oxw();a.Q6J("icon",o.entityService.getIcon("Unidade"))("label",t.unidade.sigla)("textValue",t.unidade.nome)}}function uo(i,e){if(1&i&&a._UZ(0,"input-search",92,93),2&i){const t=a.oxw();a.Q6J("size",6)("dao",t.unidadeDao)}}class ra extends N.D{set noPersist(e){super.noPersist=e}get noPersist(){return super.noPersist}set control(e){super.control=e}get control(){return super.control}set entity(e){super.entity=e,this.bindEntity()}get entity(){return super.entity}set disabled(e){(this._disabled!=e||this.atividadeOptionsMetadata.disabled!==e)&&(this._disabled=e,this.atividadeOptionsMetadata.disabled=e,this.cdRef.detectChanges())}get disabled(){return this._disabled}constructor(e){super(e),this.injector=e,this.joinAtividade=["demandante","usuario","tipo_atividade","comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.itemsEntregas=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.itemsOcorrencias=[],this.itemsComparecimentos=[],this.itemsAfastamentos=[],this._disabled=!0,this.validateAtividade=(t,o)=>{let n=null;return["descricao"].indexOf(o)>=0&&!t.value?.length?n="Obrigat\xf3rio":["data_inicio","data_entrega"].includes(o)&&!this.util.isDataValid(t.value)?n="Inv\xe1lido":"data_inicio"==o&&t.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()||"data_entrega"==o&&t.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()?n="Menor que distribui\xe7\xe3o":"data_entrega"==o&&t.value.getTime()<this.formAtividade?.controls.data_inicio.value.getTime()&&(n="Menor que in\xedcio"),n},this.validateComparecimento=(t,o)=>{let n=null;return["detalhamento","unidade_id"].indexOf(o)>=0&&!t.value?.length?n="Obrigat\xf3rio":"data_comparecimento"==o&&this.entity&&!this.util.between(t.value,{start:this.entity.data_inicio,end:this.entity.data_fim})&&(n="Inv\xe1lido"),n},this.cdRef=e.get(a.sBO),this.dao=e.get(la.E),this.unidadeDao=e.get(U.J),this.comparecimentoDao=e.get(Ja),this.atividadeDao=e.get(be.P),this.atividadeService=e.get(ve.s),this.calendar=e.get(va.o),this.ocorrenciaDao=e.get(Ae.u),this.tipoAtividadeDao=e.get(he.Y),this.planoTrabalhoService=e.get(w.p),this.planoEntregaService=e.get(fe.f),this.pEEDao=e.get(Ta.K),this.formAtividade=this.fh.FormBuilder({descricao:{default:""},etiquetas:{default:[]},checklist:{default:[]},comentarios:{default:[]},esforco:{default:0},tempo_planejado:{default:0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},data_inicio:{default:new Date},data_entrega:{default:new Date}},this.cdRef,this.validateAtividade),this.formComparecimento=this.fh.FormBuilder({data_comparecimento:{default:new Date},unidade_id:{default:""},detalhamento:{default:""}},this.cdRef,this.validateComparecimento),this.formEdit=this.fh.FormBuilder({descricao:{default:""},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.atividadeOptionsMetadata={refreshId:this.atividadeRefreshId.bind(this),removeId:this.atividadeRemoveId.bind(this),refresh:this.refresh.bind(this)}}refresh(){this.loadData(this.entity,this.form)}bindEntity(){this.entity&&(this.entity._metadata=this.entity._metadata||{},this.entity._metadata.planoTrabalhoConsolidacaoFormComponent=this)}atividadeRefreshId(e,t){this.itemsEntregas.forEach(o=>{let n=o.atividades.findIndex(l=>l.id==e);n>=0&&(t?o.atividades[n]=t:this.atividadeDao.getById(e,this.joinAtividade).then(l=>{l&&(o.atividades[n]=l)}))}),this.cdRef.detectChanges()}atividadeRemoveId(e){this.itemsEntregas.forEach(t=>{let o=t.atividades.findIndex(n=>n.id==e);o>=0&&t.atividades.splice(o,1)}),this.cdRef.detectChanges()}ngAfterViewInit(){var e=this;super.ngAfterViewInit(),(0,s.Z)(function*(){yield e.loadData(e.entity,e.form)})()}loadConsolidacao(e){this.itemsEntregas=e.entregas.map(t=>(t.plano_entrega_entrega&&(t.plano_entrega_entrega.plano_entrega=e.planosEntregas.find(n=>n.id==t.plano_entrega_entrega?.plano_entrega_id)),{id:t.id,entrega:t,atividades:e.atividades.filter(n=>n.plano_trabalho_entrega_id==t.id),badge:this.planoTrabalhoService.tipoEntrega(t,e.planoTrabalho),meta:t.plano_entrega_entrega?this.planoEntregaService.getValorMeta(t.plano_entrega_entrega):"",metaRealizado:t.plano_entrega_entrega?this.planoEntregaService.getValorRealizado(t.plano_entrega_entrega):"",progresso_realizado:t.plano_entrega_entrega?t.plano_entrega_entrega.progresso_realizado:0,objetivos:t.plano_entrega_entrega?t.plano_entrega_entrega.objetivos:[],processos:t.plano_entrega_entrega?t.plano_entrega_entrega.processos:[]})),this.programa=e.programa,this.planoTrabalho=e.planoTrabalho,this.itemsOcorrencias=e.ocorrencias,this.itemsComparecimentos=e.comparecimentos,this.itemsAfastamentos=e.afastamentos,this.unidade=e.planoTrabalho.unidade||this.entity.plano_trabalho?.unidade,this.cdRef.detectChanges()}loadData(e,t){var o=this;return(0,s.Z)(function*(){o.gridEntregas.loading=!0,o.cdRef.detectChanges();try{let n=yield o.dao.dadosConsolidacao(e.id);o.loadConsolidacao(n)}finally{o.gridEntregas.loading=!1,o.cdRef.detectChanges()}})()}addAtividade(e){var t=this;return(0,s.Z)(function*(){let o=e.plano_trabalho||t.entity.plano_trabalho,n=t.calendar.calculaDataTempoUnidade(t.entity.data_inicio,t.entity.data_fim,o.carga_horaria,t.unidade,"ENTREGA");const l=t.calendar.horasUteis(t.entity.data_inicio,t.entity.data_fim,o.carga_horaria,t.unidade,"DISTRIBUICAO"),d=t.util.maxDate(t.util.setTime(t.entity.data_inicio,0,0,0),o.data_inicio),p=t.util.minDate(t.util.setTime(t.entity.data_fim,23,59,59),o.data_fim);return new ge.a({id:t.dao.generateUuid(),plano_trabalho:o,plano_trabalho_entrega:e,plano_trabalho_consolidacao:t.entity,demandante:t.auth.usuario,usuario:t.auth.usuario,unidade:t.unidade,data_distribuicao:d,carga_horaria:o.carga_horaria,data_estipulada_entrega:p,data_inicio:d,data_entrega:p,tempo_planejado:l,tempo_despendido:n?.tempoUtil||0,status:"CONCLUIDO",progresso:100,plano_trabalho_id:t.entity.plano_trabalho_id,plano_trabalho_entrega_id:e.id,plano_trabalho_consolidacao_id:t.entity.id,demandante_id:t.auth.usuario.id,usuario_id:t.auth.usuario.id,unidade_id:t.unidade.id,metadados:{atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!0,concluido:!0,avaliado:!1,arquivado:!1,produtividade:0,extra:void 0,_status:[]}})})()}loadAtividade(e,t){var o=this;return(0,s.Z)(function*(){o.formAtividade.patchValue(t),o.cdRef.detectChanges()})()}removeAtividade(e,t){var o=this;return(0,s.Z)(function*(){if(!(yield o.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let l=t;return yield o.atividadeDao?.delete(l),e.splice(e.findIndex(d=>d.id==l.id),1),!0}catch{return!1}})()}saveAtividade(e,t){var o=this;return(0,s.Z)(function*(){let n;if(console.log("AQIO"),o.gridAtividades.error="",o.formAtividade.markAllAsTouched(),o.formAtividade.valid){t.id="NEW"==t.id?o.dao.generateUuid():t.id,o.util.fillForm(t,o.formAtividade.value),o.submitting=!0;try{n=yield o.atividadeDao?.save(t,o.joinAtividade,["etiquetas","checklist","comentarios","pausas","tarefas"]),o.atividadeRefreshId(t.id,n)}catch(l){n=!1,o.gridAtividades.error=l.message||l}finally{o.submitting=!1}}return n})()}onDataDistribuicaoChange(e){this.formAtividade.controls.data_inicio.setValue(this.formAtividade.controls.data_distribuicao.value)}onDataEstipuladaEntregaChange(e){this.formAtividade.controls.data_entrega.setValue(this.formAtividade.controls.data_estipulada_entrega.value)}atividadeDynamicButtons(e){let t=[];return t.push(Object.assign({},this.gridEntregas.BUTTON_EDIT,{})),t.push(Object.assign({},this.gridEntregas.BUTTON_DELETE,{})),t}onColumnProgressoEtiquetasChecklistEdit(e){var t=this;return(0,s.Z)(function*(){if(!t.etiquetasAscendentes.filter(o=>o.data==e.plano_trabalho.unidade.id).length){let o=yield t.carregaEtiquetasUnidadesAscendentes(e.plano_trabalho.unidade);t.etiquetasAscendentes.push(...o)}t.formEdit.controls.progresso.setValue(e.progresso),t.formEdit.controls.etiquetas.setValue(e.etiquetas),t.formEdit.controls.etiqueta.setValue(null),t.etiquetas=t.util.merge(e.tipo_atividade?.etiquetas,e.plano_trabalho.unidade?.etiquetas,(o,n)=>o.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.auth.usuario.config?.etiquetas,(o,n)=>o.key==n.key),t.etiquetas=t.util.merge(t.etiquetas,t.etiquetasAscendentes.filter(o=>o.data==e.plano_trabalho.unidade.id),(o,n)=>o.key==n.key),t.checklist=t.util.clone(e.checklist)})()}carregaEtiquetasUnidadesAscendentes(e){var t=this;return(0,s.Z)(function*(){let o=[],n=e.path.split("/");return(yield t.unidadeDao.query({where:[["id","in",n]]}).asPromise()).forEach(d=>{o=t.util.merge(o,d.etiquetas,(p,c)=>p.key==c.key)}),o.forEach(d=>d.data=e.id),o})()}onColumnProgressoEtiquetasChecklistSave(e){var t=this;return(0,s.Z)(function*(){try{const o=yield t.atividadeDao.update(e.id,{progresso:t.formEdit.controls.progresso.value,etiquetas:t.formEdit.controls.etiquetas.value,checklist:t.checklist});return e.progresso=t.formEdit.controls.progresso.value,e.checklist=t.checklist,!!o}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:e=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,o)=>t.key==o.key),this.cdRef.detectChanges()}})}addItemHandleEtiquetas(){let e;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,o=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.formEdit.controls.etiquetas.value,o)&&(e={key:o,value:t.value,color:t.color,icon:t.icon},this.formEdit.controls.etiqueta.setValue(null))}return e}loadTipoAtividade(e){e?(this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade,e),this.atividadeService.buildChecklist(e,this.formAtividade.controls.checklist),this.formAtividade.controls.esforco.setValue(e?.esforco||0)):(this.etiquetas=[],this.formAtividade.controls.esforco.setValue(0)),this.cdRef.detectChanges()}onTipoAtividadeSelect(e){const t=e.entity;this.loadTipoAtividade(t),this.atividadeService.comentarioAtividade(t,this.formAtividade.controls.comentarios),this.cdRef.detectChanges()}onColumnAtividadeDescricaoEdit(e){var t=this;return(0,s.Z)(function*(){t.formAtividade.controls.descricao.setValue(e.descricao),t.formAtividade.controls.comentarios.setValue(e.comentarios)})()}onColumnAtividadeDescricaoSave(e){var t=this;return(0,s.Z)(function*(){try{t.atividadeService.comentarioAtividade(t.tipoAtividade?.selectedEntity,t.formAtividade.controls.comentarios);const o=yield t.atividadeDao.update(e.id,{descricao:t.formAtividade.controls.descricao.value,comentarios:(t.formAtividade.controls.comentarios.value||[]).filter(n=>["ADD","EDIT","DELETE"].includes(n._status||""))});return e.descricao=t.formAtividade.controls.descricao.value,e.tipo_atividade=t.tipoAtividade?.selectedEntity||null,e.comentarios=t.formAtividade.controls.comentarios.value,!!o}catch{return!1}})()}tempoAtividade(e){let t=[{color:"light",hint:"In\xedcio",icon:"bi bi-file-earmark-play",label:this.dao.getDateTimeFormatted(e.data_inicio)}],o=this.atividadeService.temposAtividade(e);return o=o.filter(n=>"bi bi-file-earmark-plus"!=n.icon&&"bi bi-calendar-check"!=n.icon),t.push(...o),t}dynamicButtons(e){let t=[];return t.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),t}showDetalhes(e){var t=this;return(0,s.Z)(function*(){let o=yield t.pEEDao.getById(e.entrega.plano_entrega_entrega.id,["entrega","objetivos.objetivo"]);t.go.navigate({route:["gestao","plano-entrega","entrega",e.entrega.plano_entrega_entrega.id,"detalhes"]},{metadata:{plano_entrega:e.entrega.plano_entrega_entrega.plano_entrega,planejamento_id:e.entrega.plano_entrega_entrega.plano_entrega.planejamento_id,cadeia_valor_id:e.entrega.plano_entrega_entrega.plano_entrega.cadeia_valor_id,unidade_id:e.entrega.plano_entrega_entrega.plano_entrega.unidade_id,entrega:o}})})()}addOcorrencia(){var e=this;return(0,s.Z)(function*(){e.go.navigate({route:["gestao","ocorrencia","new"]},{metadata:{consolidacao:e.entity,planoTrabalho:e.planoTrabalho},modalClose:t=>{t&&e.refresh()}})})()}editOcorrencia(e){var t=this;return(0,s.Z)(function*(){t.go.navigate({route:["gestao","ocorrencia",e.id,"edit"]},{modalClose:o=>{o&&t.refresh()}})})()}removeOcorrencia(e){var t=this;return(0,s.Z)(function*(){if(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")){t.submitting=!0;try{let o=e;yield t.ocorrenciaDao?.delete(o),t.itemsOcorrencias.splice(t.itemsOcorrencias.findIndex(n=>n.id==o.id),1)}finally{t.submitting=!1}}})()}ocorrenciaDynamicButtons(e){let t=[];return!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EDT")&&t.push(Object.assign({},this.OPTION_ALTERAR,{onClick:this.editOcorrencia.bind(this)})),!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EXCL")&&t.push(Object.assign({},this.OPTION_EXCLUIR,{onClick:this.removeOcorrencia.bind(this)})),t}addComparecimento(){var e=this;return(0,s.Z)(function*(){return new Te.V({unidade_id:e.unidade?.id,unidade:e.unidade,plano_trabalho_consolidacao_id:e.entity.id})})()}loadComparecimento(e,t){var o=this;return(0,s.Z)(function*(){o.formComparecimento.patchValue({data_comparecimento:t.data_comparecimento,unidade_id:t.unidade_id,detalhamento:t.detalhamento}),o.cdRef.detectChanges()})()}removeComparecimento(e){var t=this;return(0,s.Z)(function*(){if(!(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=e;return yield t.comparecimentoDao?.delete(n),t.itemsComparecimentos.splice(t.itemsComparecimentos.findIndex(l=>l.id==n.id),1),!0}catch{return!1}})()}saveComparecimento(e,t){var o=this;return(0,s.Z)(function*(){let n;if(o.formComparecimento.markAllAsTouched(),o.formComparecimento.valid){t.id="NEW"==t.id?o.dao.generateUuid():t.id,t.data_comparecimento=e.controls.data_comparecimento.value,t.detalhamento=e.controls.detalhamento.value,t.plano_trabalho_consolidacao_id=o.entity.id,t.unidade_id=e.controls.unidade_id.value,o.submitting=!0;try{n=yield o.comparecimentoDao?.save(t)}finally{o.submitting=!1}}return n})()}comparecimentoDynamicButtons(e){return[]}addAfastamento(){var e=this;return(0,s.Z)(function*(){e.go.navigate({route:["gestao","afastamento","new"]},{metadata:{consolidacao:e.entity},filterSnapshot:void 0,querySnapshot:void 0,modalClose:t=>{t&&e.refresh()}})})()}afastamentoDynamicButtons(e){let t=[];return t.push(Object.assign({},this.OPTION_INFORMACOES,{onClick:o=>this.go.navigate({route:["cadastros","afastamento",o.id,"consult"]})})),t}showPlanejamento(e){var t=this;return(0,s.Z)(function*(){t.go.navigate({route:["gestao","planejamento",e,"consult"]},{modal:!0})})()}showCadeiaValor(e){var t=this;return(0,s.Z)(function*(){t.go.navigate({route:["gestao","cadeia-valor",e,"consult"]},{modal:!0})})()}}var L,z;function mo(i,e){}function po(i,e){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-form",16,17),2&i){const t=e.row,o=a.oxw();a.Q6J("disabled",o.isDisabled(t))("entity",t)("planoTrabalho",o.entity)("cdRef",o.cdRef)}}function _o(i,e){if(1&i&&a._uU(0),2&i){const t=e.row,o=a.oxw();a.hij(" ",o.util.getDateFormatted(t.data_inicio)," ")}}function go(i,e){if(1&i&&a._uU(0),2&i){const t=e.row,o=a.oxw();a.hij(" ",o.util.getDateFormatted(t.data_fim)," ")}}function ho(i,e){if(1&i&&a._UZ(0,"avaliar-nota-badge",20),2&i){const t=a.oxw().row,o=a.oxw();a.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao||o.entity.programa.tipo_avaliacao_plano_trabalho)("nota",t.avaliacao.nota)}}function fo(i,e){if(1&i&&(a.TgZ(0,"separator",21)(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.Q6J("collapsed",!1),a.xp6(2),a.Oqu(t.avaliacao.recurso)}}function bo(i,e){if(1&i&&(a.YNc(0,ho,1,3,"avaliar-nota-badge",18),a.YNc(1,fo,3,2,"separator",19)),2&i){const t=e.row;a.Q6J("ngIf",t.avaliacao),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function vo(i,e){1&i&&a._UZ(0,"badge",25)}function To(i,e){if(1&i&&(a.TgZ(0,"div",22),a._UZ(1,"badge",23),a.YNc(2,vo,1,0,"badge",24),a.qZA()),2&i){const t=e.row,o=a.oxw();a.xp6(1),a.Q6J("color",o.lookup.getColor(o.lookup.CONSOLIDACAO_STATUS,t.status))("icon",o.lookup.getIcon(o.lookup.CONSOLIDACAO_STATUS,t.status))("label",o.lookup.getValue(o.lookup.CONSOLIDACAO_STATUS,t.status)),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}(V=ra).\u0275fac=function(e){return new(e||V)(a.Y36(a.zs3))},V.\u0275cmp=a.Xpm({type:V,selectors:[["plano-trabalho-consolidacao-form"]],viewQuery:function(e,t){if(1&e&&(a.Gf(x.Q,5),a.Gf(Oe,5),a.Gf(Ie,5),a.Gf(Pe,5),a.Gf(Ue,5),a.Gf(Je,5)),2&e){let o;a.iGM(o=a.CRH())&&(t.editableForm=o.first),a.iGM(o=a.CRH())&&(t.gridEntregas=o.first),a.iGM(o=a.CRH())&&(t.gridAtividades=o.first),a.iGM(o=a.CRH())&&(t.etiqueta=o.first),a.iGM(o=a.CRH())&&(t.tipoAtividade=o.first),a.iGM(o=a.CRH())&&(t.listTarefas=o.first)}},inputs:{cdRef:"cdRef",planoTrabalho:"planoTrabalho",noPersist:"noPersist",control:"control",entity:"entity",disabled:"disabled"},features:[a.qOj],decls:55,vars:66,consts:[["collapse","",3,"collapsed","title","icon"],[3,"items","minHeight","hasEdit"],["gridEntregas",""],["type","expand",3,"width","icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["title","Origem",3,"template","width"],["columnOrigem",""],["title","Entrega",3,"template"],["columnEntrega",""],["title","% CHD Planejado",3,"template","width","titleHint"],["columnForcaTrabalho",""],[3,"title","template","width"],["columnMetaRealizado",""],["title","Progresso",3,"template","width"],["columnProgresso",""],["type","options",3,"dynamicButtons"],["editable","",3,"items","minHeight","hasDelete","hasEdit","hasAdd","add"],["gridOcorrencia",""],["title","In\xedcio","type","datetime","field","data_inicio",3,"width"],["title","Fim","type","datetime","field","data_fim",3,"width"],["title","Descri\xe7\xe3o","type","textarea","field","descricao"],["editable","",3,"items","minHeight","hasEdit","hasDelete","hasAdd","add"],["gridAfastamento",""],["title","Motivo/Observa\xe7\xe3o",3,"template"],["columnMotivoObservacao",""],["editable","",3,"items","minHeight","form","hasDelete","hasAdd","hasEdit","add","load","remove","save"],["gridComparecimento",""],["title","Data","type","date","field","data_comparecimento",3,"width"],["title","Unidade",3,"template","editTemplate"],["columnUnidade",""],["editUnidade",""],["title","Detalhamento","type","text","field","detalhamento"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["editable","",3,"items","minHeight","form","hasAdd","hasDelete","hasEdit","add","load","remove","save"],["gridAtividades",""],["type","expand","icon","bi bi-boxes",3,"width","align","hint","template","expandTemplate"],["columnTarefas",""],["columnExpandedTarefas",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save"],["columnAtividadeDescricao",""],["editAtividadeDescricao",""],[3,"title","width","template","editTemplate"],["columnTempos",""],["editTempos",""],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],["columnNumero",""],["type","options",3,"metadata","dynamicOptions","dynamicButtons"],["persist","",3,"atividade","consolidacao"],["listTarefas",""],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["title","In\xedcio e Conclus\xe3o","collapse","",3,"collapsed"],["icon","bi bi-play-circle","label","In\xedcio","controlName","data_inicio","labelInfo","Data de inicializa\xe7\xe3o da atividade",3,"control"],["icon","bi bi-check-circle","label","Conclus\xe3o","controlName","data_entrega","labelInfo","Data da conclus\xe3o da atividade",3,"control"],["color","success",3,"value"],[3,"lookup",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],[4,"ngIf"],[3,"lookup"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["controlName","etiquetas",3,"size","control","addItemHandle"],["label","Etiqueta","controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],["scale","small",3,"size","source","path"],[3,"documento"],[1,"d-block"],[3,"data","color","icon","label",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid",4,"ngIf"],[3,"data","color","icon","label"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"label","color"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],["color","light",3,"label"],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],[3,"color","icon","label"],["color","success",3,"icon","label","textValue"],["label","","icon","","controlName","unidade_id",3,"size","dao"],["unidade",""]],template:function(e,t){if(1&e&&(a.TgZ(0,"separator",0)(1,"grid",1,2)(3,"columns")(4,"column",3),a.YNc(5,we,1,1,"ng-template",null,4,a.W1O),a.YNc(7,eo,27,40,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(9,"column",6),a.YNc(10,oo,1,2,"ng-template",null,7,a.W1O),a.qZA(),a.TgZ(12,"column",8),a.YNc(13,io,5,3,"ng-template",null,9,a.W1O),a.qZA(),a.TgZ(15,"column",10),a.YNc(16,no,1,1,"ng-template",null,11,a.W1O),a.qZA(),a.TgZ(18,"column",12),a.YNc(19,lo,3,2,"ng-template",null,13,a.W1O),a.qZA(),a.TgZ(21,"column",14),a.YNc(22,ro,1,1,"ng-template",null,15,a.W1O),a.qZA(),a._UZ(24,"column",16),a.qZA()()(),a.TgZ(25,"separator",0)(26,"grid",17,18)(28,"columns"),a._UZ(29,"column",19)(30,"column",20)(31,"column",21)(32,"column",16),a.qZA()()(),a.TgZ(33,"separator",0)(34,"grid",22,23)(36,"columns"),a._UZ(37,"column",19)(38,"column",20),a.TgZ(39,"column",24),a.YNc(40,so,2,4,"ng-template",null,25,a.W1O),a.qZA(),a._UZ(42,"column",16),a.qZA()()(),a.TgZ(43,"separator",0)(44,"grid",26,27)(46,"columns"),a._UZ(47,"column",28),a.TgZ(48,"column",29),a.YNc(49,co,1,3,"ng-template",null,30,a.W1O),a.YNc(51,uo,2,2,"ng-template",null,31,a.W1O),a.qZA(),a._UZ(53,"column",32)(54,"column",16),a.qZA()()()),2&e){const o=a.MAs(6),n=a.MAs(8),l=a.MAs(11),d=a.MAs(14),p=a.MAs(17),c=a.MAs(20),_=a.MAs(23),u=a.MAs(41),b=a.MAs(50),m=a.MAs(52);a.Q6J("collapsed",!1)("title",t.lex.translate("Atividades"))("icon",t.entityService.getIcon("Atividade")),a.xp6(1),a.Q6J("items",t.itemsEntregas)("minHeight",0)("hasEdit",!1),a.xp6(3),a.Q6J("width",50)("icon",t.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",t.lex.translate("Consolida\xe7\xe3o"))("template",o)("expandTemplate",n),a.xp6(5),a.Q6J("template",l)("width",200),a.xp6(3),a.Q6J("template",d),a.xp6(3),a.Q6J("template",p)("width",100)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada"),a.xp6(3),a.Q6J("title","Meta")("template",c)("width",100),a.xp6(3),a.Q6J("template",_)("width",150),a.xp6(3),a.Q6J("dynamicButtons",t.dynamicButtons.bind(t)),a.xp6(1),a.Q6J("collapsed",!1)("title",t.lex.translate("Ocorr\xeancias"))("icon",t.entityService.getIcon("PlanoTrabalhoConsolidacao")),a.xp6(1),a.Q6J("items",t.itemsOcorrencias)("minHeight",0)("hasDelete",!1)("hasEdit",!1)("hasAdd",!t.disabled)("add",t.addOcorrencia.bind(t)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("width",300),a.xp6(2),a.Q6J("dynamicButtons",t.ocorrenciaDynamicButtons.bind(t)),a.xp6(1),a.Q6J("collapsed",!1)("title",t.lex.translate("Afastamentos"))("icon",t.entityService.getIcon("Afastamento")),a.xp6(1),a.Q6J("items",t.itemsAfastamentos)("minHeight",0)("hasEdit",!1)("hasDelete",!1)("hasAdd",!t.disabled)("add",t.addAfastamento.bind(t)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("width",300),a.xp6(1),a.Q6J("template",u),a.xp6(3),a.Q6J("dynamicButtons",t.afastamentoDynamicButtons.bind(t)),a.xp6(1),a.Q6J("collapsed",!1)("title",t.lex.translate("Comparecimentos"))("icon",t.entityService.getIcon("Comparecimento")),a.xp6(1),a.Q6J("items",t.itemsComparecimentos)("minHeight",0)("form",t.formComparecimento)("hasDelete",!t.disabled)("hasAdd",!t.disabled)("hasEdit",!t.disabled)("add",t.addComparecimento.bind(t))("load",t.loadComparecimento.bind(t))("remove",t.removeComparecimento.bind(t))("save",t.saveComparecimento.bind(t)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("template",b)("editTemplate",m),a.xp6(6),a.Q6J("dynamicButtons",t.comparecimentoDynamicButtons.bind(t))}},dependencies:[g.sg,g.O5,C.M,M.a,q.b,J.a,T.V,Ca.Q,k.k,oa.p,xe.p,Z.N,E.F,ye.R,Ze.l,Aa.C,Ee.y,Qa.h,De.u]});class sa extends N.D{set entity(e){super.entity=e}get entity(){return super.entity}get items(){return this.entity?.consolidacoes||[]}constructor(e){super(e),this.injector=e,this.validate=(t,o)=>null,this.dao=e.get(la.E),this.avaliacaoDao=e.get(Pa.w),this.planoTrabalhoService=e.get(w.p),this.unidadeService=e.get(ea.Z),this.planoTrabalhoDao=e.get(P.t),this.title=this.lex.translate("Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD",this.modalWidth=1200,this.form=this.fh.FormBuilder({data_inicio:{default:new Date},data_fim:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){var e=this;super.ngAfterViewInit(),(0,s.Z)(function*(){if(e.urlParams?.has("usuarioId")&&e.urlParams?.has("planoTrabalhoId")){let o=yield e.planoTrabalhoDao.getByUsuario(e.urlParams.get("usuarioId"),!0,e.urlParams.get("planoTrabalhoId"));1==o.planos.length&&(e.entity=o.planos[0])}let t=(new Date).getTime();e.items.forEach(o=>{o.plano_trabalho||(o.plano_trabalho=e.entity),e.util.asTimestamp(o.data_inicio)<=t&&t<=e.util.asTimestamp(o.data_fim)&&e.grid.expand(o.id)})})()}addConsolidacao(){var e=this;return(0,s.Z)(function*(){return new Ia({id:e.dao.generateUuid(),plano_trabalho_id:e.entity.id})})()}loadConsolidacao(e,t){var o=this;return(0,s.Z)(function*(){o.form.patchValue({data_inicio:t.data_inicio,data_fim:t.data_fim}),o.cdRef.detectChanges()})()}removeConsolidacao(e){var t=this;return(0,s.Z)(function*(){if(!(yield t.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=e;return yield t.dao?.delete(n),t.items.splice(t.items.findIndex(l=>l.id==n.id),1),!0}catch{return!1}})()}saveConsolidacao(e,t){var o=this;return(0,s.Z)(function*(){let n;return o.form.markAllAsTouched(),o.form.valid&&(t.id="NEW"==t.id?o.dao.generateUuid():t.id,t.data_inicio=e.controls.data_inicio.value,t.data_fim=e.controls.data_fim.value,n=yield o.dao?.save(t)),n})()}refreshConsolidacao(e,t){t&&e._metadata?.planoTrabalhoConsolidacaoFormComponent?(e._metadata?.planoTrabalhoConsolidacaoFormComponent).loadConsolidacao(t):this.grid.refreshExpanded(e.id),this.grid.refreshRows()}concluir(e){var t=this;return(0,s.Z)(function*(){t.submitting=!0;try{let o=yield t.dao.concluir(e.id);e.status=o.status,t.refreshConsolidacao(e,o)}catch(o){t.error(o.message||o)}finally{t.submitting=!1}})()}cancelarConclusao(e){var t=this;return(0,s.Z)(function*(){t.submitting=!0;try{let o=yield t.dao.cancelarConclusao(e.id);e.status=o.status,t.refreshConsolidacao(e,o)}catch(o){t.error(o.message||o)}finally{t.submitting=!1}})()}anterior(e){return this.entity.consolidacoes.reduce((t,o)=>this.util.asTimestamp(o.data_inicio)<this.util.asTimestamp(e.data_inicio)&&(!t||this.util.asTimestamp(t.data_inicio)<this.util.asTimestamp(o.data_inicio))?o:t,void 0)}proximo(e){return this.entity.consolidacoes.reduce((t,o)=>this.util.asTimestamp(o.data_fim)>this.util.asTimestamp(e.data_fim)&&(!t||this.util.asTimestamp(t.data_fim)>this.util.asTimestamp(o.data_fim))?o:t,void 0)}isDisabled(e){return e&&"INCLUIDO"!=e.status||"ATIVO"!=this.entity?.status}podeInserir(){return this.auth.hasPermissionTo("MOD_PTR_CSLD_INCL")}dynamicButtons(e){let t=[],o=e;const n=o.plano_trabalho?.usuario_id,l=this.entity.unidade_id,d=this.anterior(e),p=this.proximo(e),c=this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL")&&(this.unidadeService.isGestorUnidade(l)||this.auth.isIntegrante("AVALIADOR_PLANO_TRABALHO",l)),_=this.auth.usuario.id==n,u={hint:"Concluir",icon:"bi bi-check-circle",color:"btn-outline-success",onClick:this.concluir.bind(this)},b={hint:"Cancelar conclus\xe3o",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:this.cancelarConclusao.bind(this)},m={hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-warning",onClick:A=>this.planoTrabalhoService.avaliar(A,this.entity.programa,this.refreshConsolidacao.bind(this))},H={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:A=>this.planoTrabalhoService.avaliar(A,this.entity.programa,this.refreshConsolidacao.bind(this))},B={hint:"Fazer recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:A=>this.planoTrabalhoService.fazerRecurso(A,this.entity.programa,this.refreshConsolidacao.bind(this))},X={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:A=>this.planoTrabalhoService.cancelarAvaliacao(A,this,this.refreshConsolidacao.bind(this))},da=!d||["CONCLUIDO","AVALIADO"].includes(d.status),v=!p||["INCLUIDO"].includes(p.status),La=!d||["AVALIADO"].includes(d.status),hi=!p||["INCLUIDO","CONCLUIDO"].includes(p.status);return this.isDisabled()||("INCLUIDO"==o.status&&da&&(_||this.auth.hasPermissionTo("MOD_PTR_CSLD_CONCL"))&&t.push(u),"CONCLUIDO"==o.status&&v&&this.planoTrabalhoService.diasParaConcluirConsolidacao(e,this.entity.programa)>=0&&(_||this.auth.hasPermissionTo("MOD_PTR_CSLD_DES_CONCL"))&&t.push(b),"CONCLUIDO"==o.status&&La&&c&&t.push(m),"AVALIADO"==o.status&&o.avaliacao&&(_&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&o.avaliacao?.data_avaliacao&&(!this.entity.programa.dias_tolerancia_recurso_avaliacao||this.util.daystamp(o.avaliacao.data_avaliacao)+this.entity.programa.dias_tolerancia_recurso_avaliacao>this.util.daystamp(this.auth.hora))&&t.push(B),La&&c&&(t.push(H),hi&&t.push(X)))),t}}(L=sa).\u0275fac=function(e){return new(e||L)(a.Y36(a.zs3))},L.\u0275cmp=a.Xpm({type:L,selectors:[["plano-trabalho-consolidacao-list"]],viewQuery:function(e,t){if(1&e&&a.Gf(C.M,5),2&e){let o;a.iGM(o=a.CRH())&&(t.grid=o.first)}},inputs:{entity:"entity"},features:[a.qOj],decls:24,vars:20,consts:[["editable","",3,"items","form","hasDelete","minHeight","add","hasAdd","hasEdit"],["grid",""],[1,"my-2"],[1,"bi","bi-arrow-down"],["type","expand",3,"icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["title","Data in\xedcio",3,"template"],["columnDataInicio",""],["title","Data fim",3,"template"],["columnDataFim",""],["title","Estat\xedsticas/Avalia\xe7\xf5es",3,"template","width"],["columnEstatisticas",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicButtons"],[3,"disabled","entity","planoTrabalho","cdRef"],["consolidacao",""],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"]],template:function(e,t){if(1&e&&(a.TgZ(0,"grid",0,1)(2,"h5",2),a._uU(3),a._UZ(4,"i",3),a.qZA(),a.TgZ(5,"columns")(6,"column",4),a.YNc(7,mo,0,0,"ng-template",null,5,a.W1O),a.YNc(9,po,2,4,"ng-template",null,6,a.W1O),a.qZA(),a.TgZ(11,"column",7),a.YNc(12,_o,1,1,"ng-template",null,8,a.W1O),a.qZA(),a.TgZ(14,"column",9),a.YNc(15,go,1,1,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(17,"column",11),a.YNc(18,bo,2,2,"ng-template",null,12,a.W1O),a.qZA(),a.TgZ(20,"column",13),a.YNc(21,To,3,4,"ng-template",null,14,a.W1O),a.qZA(),a._UZ(23,"column",15),a.qZA()()),2&e){const o=a.MAs(8),n=a.MAs(10),l=a.MAs(13),d=a.MAs(16),p=a.MAs(19),c=a.MAs(22);a.Q6J("items",t.items)("form",t.form)("hasDelete",!0)("minHeight",0)("add",t.addConsolidacao.bind(t))("hasAdd",t.podeInserir())("hasEdit",!1)("hasDelete",!1),a.xp6(3),a.hij("",t.lex.translate("Consolida\xe7\xf5es")," "),a.xp6(3),a.Q6J("icon",t.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",t.lex.translate("Consolida\xe7\xe3o"))("template",o)("expandTemplate",n),a.xp6(5),a.Q6J("template",l),a.xp6(3),a.Q6J("template",d),a.xp6(3),a.Q6J("template",p)("width",300),a.xp6(3),a.Q6J("template",c),a.xp6(3),a.Q6J("dynamicButtons",t.dynamicButtons.bind(t))}},dependencies:[g.O5,C.M,M.a,q.b,Z.N,E.F,Ua.M,ra]});const Co=["accordion"];function Ao(i,e){if(1&i&&a._UZ(0,"badge",13),2&i){const t=e.$implicit;a.Q6J("badge",t)}}function xo(i,e){if(1&i&&(a.TgZ(0,"div",1)(1,"div",2),a._uU(2),a.qZA(),a.TgZ(3,"div",3),a._UZ(4,"badge",10)(5,"badge",10)(6,"badge",10)(7,"badge",10),a.qZA(),a.TgZ(8,"div",4),a._uU(9),a.qZA(),a.TgZ(10,"div",5),a.YNc(11,Ao,1,1,"badge",11),a.qZA(),a.TgZ(12,"div",5),a._UZ(13,"badge",12),a.qZA()()),2&i){const t=e.item,o=a.oxw();a.xp6(2),a.Oqu("#"+t.numero),a.xp6(2),a.Q6J("icon",o.entityService.getIcon("Usuario"))("label",null==t.usuario?null:t.usuario.nome)("hint",o.lex.translate("Participante")+": "+(null==t.usuario?null:t.usuario.nome)),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("Unidade"))("label",null==t.unidade?null:t.unidade.sigla)("hint",o.lex.translate("Unidade")+": "+(null==t.unidade?null:t.unidade.nome)),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("Programa"))("label",null==t.programa?null:t.programa.nome)("hint",o.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("TipoModalidade"))("label",null==t.tipo_modalidade?null:t.tipo_modalidade.nome)("hint",o.lex.translate("Tipo de modalidade")),a.xp6(2),a.hij(" ",o.dao.getDateFormatted(t.data_inicio)+" at\xe9 "+o.dao.getDateFormatted(t.data_fim)," "),a.xp6(2),a.Q6J("ngForOf",o.getPlanoBadges(t)),a.xp6(2),a.Q6J("label",o.lookup.getValue(o.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",o.lookup.getIcon(o.lookup.PLANO_TRABALHO_STATUS,t.status))("color",o.lookup.getColor(o.lookup.PLANO_TRABALHO_STATUS,t.status))}}function yo(i,e){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-list",14),2&i){const t=e.item;a.Q6J("entity",t)}}class wa extends N.D{set arquivados(e){this._arquivados!=e&&(this._arquivados=e,this.viewInit&&this.loadData(this.entity,this.form))}get arquivados(){return this._arquivados}constructor(e){super(e),this.injector=e,this.selectedIndex=-1,this.planos=[],this._arquivados=!1,this.dao=e.get(P.t)}ngAfterViewInit(){var e=this;super.ngAfterViewInit(),(0,s.Z)(function*(){yield e.loadData(e.entity,e.form)})()}loadData(e,t){var o=this;return(0,s.Z)(function*(){o.accordion.loading=!0;try{let l=yield o.dao.getByUsuario(o.usuarioId,o.arquivados),d=(new Date).getTime();o.planos=l.planos;for(var n=0;n<o.planos.length;n++)o.util.asTimestamp(o.planos[n].data_inicio)<=d&&d<=o.util.asTimestamp(o.planos[n].data_fim)&&["ATIVO","CONCLUIDO"].includes(o.planos[n].status)&&(o.selectedIndex=n)}finally{o.accordion.loading=!1,o.cdRef.detectChanges()}})()}getPlanoBadges(e){let t=[],o=e.consolidacoes.filter(l=>"CONCLUIDO"==l.status),n=e.consolidacoes.filter(l=>"AVALIADO"==l.status);if(o.length){const l=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"CONCLUIDO");t.push({icon:l?.icon,label:l?.value,color:l?.color,textValue:o.length.toString()})}if(n.length){const l=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"AVALIADO");t.push({icon:l?.icon,label:l?.value,color:l?.color,textValue:n.length.toString()})}return JSON.stringify(e._metadata?.badges)!=this.JSON.stringify(t)&&(e._metadata=Object.assign(e._metadata||{},{badges:t})),e._metadata.badges}}var G;function Zo(i,e){1&i&&(a.TgZ(0,"div",15)(1,"div",16),a._UZ(2,"span",17),a.qZA()())}function Eo(i,e){if(1&i&&(a.TgZ(0,"div",21)(1,"div",22),a._UZ(2,"profile-picture",23),a.qZA(),a.TgZ(3,"div",24)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&i){const t=e.data;a.xp6(2),a.Q6J("url",t.url_foto)("size",40)("hint",t.nome),a.xp6(3),a.Oqu(t.nome||""),a.xp6(3),a.Oqu(t.apelido||"")}}function Do(i,e){if(1&i&&a._UZ(0,"plano-trabalho-list-accordeon",25),2&i){const t=e.data;a.Q6J("usuarioId",t.id)}}function Oo(i,e){if(1&i&&(a.TgZ(0,"collapse-card",18),a.YNc(1,Eo,9,5,"ng-template",null,19,a.W1O),a.YNc(3,Do,1,1,"ng-template",null,20,a.W1O),a.qZA()),2&i){const t=e.$implicit,o=a.MAs(2),n=a.MAs(4);a.Q6J("data",t)("titleTemplate",o)("template",n)}}function Io(i,e){if(1&i&&(a.TgZ(0,"filter",7)(1,"div",8),a._UZ(2,"input-search",9,10),a.qZA()(),a.TgZ(4,"div",11)(5,"h5"),a._uU(6),a.qZA(),a.TgZ(7,"h4"),a._uU(8),a._UZ(9,"i",12),a.qZA()(),a.YNc(10,Zo,3,0,"div",13),a.YNc(11,Oo,5,3,"collapse-card",14)),2&i){const t=a.MAs(3),o=a.oxw(2);a.Q6J("form",o.filter)("filter",o.filterWhere)("collapsed",!1),a.xp6(2),a.Q6J("size",12)("control",o.filter.controls.unidade_id)("dao",o.unidadeDao),a.xp6(4),a.lnq("",o.lex.translate("Unidade")," selecionada: ",null==t||null==t.selectedItem?null:t.selectedItem.entity.sigla," - ",null==t||null==t.selectedItem?null:t.selectedItem.entity.nome,""),a.xp6(2),a.hij("",o.lex.translate("Participantes")," "),a.xp6(2),a.Q6J("ngIf",o.loading),a.xp6(1),a.Q6J("ngForOf",o.usuarios)}}function Po(i,e){if(1&i&&(a.TgZ(0,"tab",5),a.YNc(1,Io,12,12,"ng-template",null,6,a.W1O),a.qZA()),2&i){const t=a.MAs(2),o=a.oxw();a.Q6J("icon",o.entityService.getIcon("Unidade"))("label",o.lex.translate("Unidade"))("template",t)}}function Uo(i,e){if(1&i&&(a.TgZ(0,"div",26)(1,"h5",27),a._uU(2),a._UZ(3,"i",12),a.qZA(),a._UZ(4,"separator",28),a.qZA(),a._UZ(5,"plano-trabalho-list-accordeon",29)),2&i){const t=a.oxw();a.xp6(2),a.hij("",t.lex.translate("Planos de Trabalho")," "),a.xp6(2),a.Q6J("control",t.form.controls.arquivados)("title","Mostrar "+t.lex.translate("Planos de trabalho")+" arquivados?"),a.xp6(1),a.Q6J("usuarioId",t.auth.usuario.id)("arquivados",t.form.controls.arquivados.value)}}(z=wa).\u0275fac=function(e){return new(e||z)(a.Y36(a.zs3))},z.\u0275cmp=a.Xpm({type:z,selectors:[["plano-trabalho-list-accordeon"]],viewQuery:function(e,t){if(1&e&&a.Gf(Co,5),2&e){let o;a.iGM(o=a.CRH())&&(t.accordion=o.first)}},inputs:{usuarioId:"usuarioId",arquivados:"arquivados"},features:[a.qOj],decls:17,vars:8,consts:[[1,"p-3","bg-body-secondary","mb-3"],[1,"row","w-100"],[1,"col-md-1"],[1,"col-md-4"],[1,"col-md-3"],[1,"col-md-2"],[3,"items","selectedIndex","titleTemplate","template"],["accordion",""],["planoTrabalhoSectionTitle",""],["planoTrabalhoSection",""],["color","light",3,"icon","label","hint"],[3,"badge",4,"ngFor","ngForOf"],[3,"label","icon","color"],[3,"badge"],[3,"entity"]],template:function(e,t){if(1&e&&(a.TgZ(0,"div",0)(1,"div",1)(2,"div",2),a._uU(3,"#ID"),a.qZA(),a.TgZ(4,"div",3),a._uU(5),a.qZA(),a.TgZ(6,"div",4),a._uU(7,"Vig\xeancia"),a.qZA(),a._UZ(8,"div",5),a.TgZ(9,"div",5),a._uU(10,"Status"),a.qZA()()(),a.TgZ(11,"accordion",6,7),a.YNc(13,xo,14,18,"ng-template",null,8,a.W1O),a.YNc(15,yo,1,1,"ng-template",null,9,a.W1O),a.qZA()),2&e){const o=a.MAs(14),n=a.MAs(16);a.xp6(5),a.HOy("",t.lex.translate("Participante"),"/",t.lex.translate("Unidade"),"/",t.lex.translate("Programa"),"/",t.lex.translate("Tipo de modalidade"),""),a.xp6(6),a.Q6J("items",t.planos)("selectedIndex",t.selectedIndex)("titleTemplate",o)("template",n)}},dependencies:[g.sg,E.F,pe.Z,sa]});class Na extends N.D{constructor(e){super(e),this.injector=e,this.usuarios=[],this.loadingUnidade=!1,this.filterWhere=t=>{let o=t.value;this.loadUsuarios(o.unidade_id)},this.unidadeDao=e.get(U.J),this.form=this.fh.FormBuilder({arquivados:{default:!1}}),this.filter=this.fh.FormBuilder({unidade_id:{default:!1}})}ngAfterViewInit(){var e=this;super.ngAfterViewInit(),this.tabs.active=this.queryParams?.tab||"USUARIO",this.tabs.title=this.lex.translate("Consolida\xe7\xf5es"),(0,s.Z)(function*(){yield e.loadData(e.entity,e.form)})()}loadData(e,t){var o=this;return(0,s.Z)(function*(){o.unidade=o.auth.unidadeGestor(),o.filter.controls.unidade_id.setValue(o.unidade?.id||o.auth.lotacao||null),o.unidade&&(yield o.loadUsuarios(o.unidade.id))})()}loadUsuarios(e){var t=this;return(0,s.Z)(function*(){t.usuarios=[],t.loadingUnidade=!0,t.loading=!0,t.cdRef.detectChanges();try{t.usuarios=yield t.unidadeDao.lotados(e)}finally{t.loading=!1,t.loadingUnidade=!1,t.cdRef.detectChanges()}})()}}(G=Na).\u0275fac=function(e){return new(e||G)(a.Y36(a.zs3))},G.\u0275cmp=a.Xpm({type:G,selectors:[["app-plano-trabalho-consolidacao"]],viewQuery:function(e,t){if(1&e&&(a.Gf(W.n,5),a.Gf(T.V,5)),2&e){let o;a.iGM(o=a.CRH())&&(t.tabs=o.first),a.iGM(o=a.CRH())&&(t.unidadeSelecionada=o.first)}},features:[a.qOj],decls:6,vars:5,consts:[["right","",3,"title"],["tabs",""],["key","UNIDADE",3,"icon","label","template",4,"ngIf"],["key","USUARIO",3,"icon","label","template"],["tabUsuario",""],["key","UNIDADE",3,"icon","label","template"],["tabUnidade",""],[3,"form","filter","collapsed"],[1,"row"],["label","Selecione a unidade","controlName","unidade_id",3,"size","control","dao"],["unidadeSelecionada",""],[1,"p-3","mb-3","bg-body-secondary"],[1,"bi","bi-arrow-down"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"data","titleTemplate","template",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[3,"data","titleTemplate","template"],["usuarioCardTitle",""],["usuarioCard",""],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],[3,"usuarioId"],[1,"d-flex","justify-content-between"],[1,"mt-2"],[3,"control","title"],[3,"usuarioId","arquivados"]],template:function(e,t){if(1&e&&(a.TgZ(0,"tabs",0,1),a.YNc(2,Po,3,3,"tab",2),a.TgZ(3,"tab",3),a.YNc(4,Uo,6,5,"ng-template",null,4,a.W1O),a.qZA()()),2&e){const o=a.MAs(5);a.Q6J("title",t.isModal?"":t.title),a.xp6(2),a.Q6J("ngIf",t.unidade),a.xp6(1),a.Q6J("icon",t.entityService.getIcon("Usuario"))("label",t.lex.translate("Usu\xe1rio"))("template",o)}},dependencies:[g.sg,g.O5,na.z,T.V,W.n,ta.i,Z.N,Ea.q,Oa,wa]});var Y,O,Ma=r(90038),Jo=r(78509),Qo=r(31313),qa=r(45512),Sa=r(42704);function wo(i,e){if(1&i&&(a.TgZ(0,"div",33)(1,"div",34),a._UZ(2,"profile-picture",35),a.qZA(),a.TgZ(3,"div",36)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br")(7,"badge",37),a.qZA()()),2&i){const t=e.separator,o=a.oxw(2);let n,l,d,p;a.xp6(2),a.Q6J("url",null==(n=o.usuarioSeparator(t))?null:n.url_foto)("size",40)("hint",null==(l=o.usuarioSeparator(t))?null:l.nome),a.xp6(3),a.Oqu((null==(d=o.usuarioSeparator(t))?null:d.nome)||"Desconhecido"),a.xp6(2),a.Q6J("icon",o.entityService.getIcon("Unidade"))("label",(null==(p=o.unidadeSeparator(t))?null:p.sigla)||"Desconhecido")}}function No(i,e){1&i&&a._UZ(0,"toolbar")}function Mo(i,e){}function qo(i,e){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-form",38,39),2&i){const t=e.row,o=a.oxw(2);a.Q6J("disabled",!0)("entity",t)("planoTrabalho",t.plano_trabalho)("cdRef",o.cdRef)}}function So(i,e){if(1&i&&(a._uU(0),a._UZ(1,"badge",40)(2,"badge",41)(3,"br")(4,"badge",42)(5,"badge",42)(6,"badge",42)),2&i){const t=e.row,o=a.oxw(2);a.hij(" ",t.plano_trabalho.usuario.nome," "),a.xp6(1),a.Q6J("textValue",o.util.getDateFormatted(t.plano_trabalho.data_inicio)),a.xp6(1),a.Q6J("textValue",o.util.getDateFormatted(t.plano_trabalho.data_fim)),a.xp6(2),a.Q6J("icon",o.entityService.getIcon("Unidade"))("label",null==t.plano_trabalho.unidade?null:t.plano_trabalho.unidade.sigla)("hint",o.lex.translate("Unidade")+": "+(null==t.plano_trabalho.unidade?null:t.plano_trabalho.unidade.nome)),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("Programa"))("label",null==t.plano_trabalho.programa?null:t.plano_trabalho.programa.nome)("hint",o.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",o.lex.translate("Tipo de modalidade"))}}function Fo(i,e){if(1&i&&a._uU(0),2&i){const t=e.row,o=a.oxw(2);a.hij(" ",o.util.getDateFormatted(t.data_inicio)," ")}}function Ro(i,e){if(1&i&&(a.TgZ(0,"strong"),a._uU(1),a.qZA()),2&i){const t=e.row,o=a.oxw(2);a.xp6(1),a.Oqu(o.util.getDateFormatted(t.data_fim))}}function Vo(i,e){if(1&i&&a._UZ(0,"avaliar-nota-badge",45),2&i){const t=a.oxw().row;a.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function Lo(i,e){if(1&i&&(a.TgZ(0,"separator",46)(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.Q6J("collapsed",!1),a.xp6(2),a.Oqu(t.avaliacao.recurso)}}function zo(i,e){if(1&i&&(a.YNc(0,Vo,1,3,"avaliar-nota-badge",43),a.YNc(1,Lo,3,2,"separator",44)),2&i){const t=e.row;a.Q6J("ngIf",t.avaliacao),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function Go(i,e){1&i&&a._UZ(0,"badge",50)}function Yo(i,e){if(1&i&&(a.TgZ(0,"div",47),a._UZ(1,"badge",48),a.YNc(2,Go,1,0,"badge",49),a.qZA()),2&i){const t=e.row,o=a.oxw(2);a.xp6(1),a.Q6J("color",o.lookup.getColor(o.lookup.CONSOLIDACAO_STATUS,t.status))("icon",o.lookup.getIcon(o.lookup.CONSOLIDACAO_STATUS,t.status))("label",o.lookup.getValue(o.lookup.CONSOLIDACAO_STATUS,t.status)),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function Ho(i,e){if(1&i){const t=a.EpF();a.TgZ(0,"grid",5),a.YNc(1,wo,8,6,"ng-template",null,6,a.W1O),a.YNc(3,No,1,0,"toolbar",7),a.TgZ(4,"filter",8)(5,"div",9),a._UZ(6,"input-search",10,11),a.TgZ(8,"input-search",12,13),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw();return a.KtG(l.onUnidadeChange(n))}),a.qZA(),a._UZ(10,"input-switch",14,15)(12,"input-switch",16,17),a.qZA()(),a.TgZ(14,"columns")(15,"column",18),a.YNc(16,Mo,0,0,"ng-template",null,19,a.W1O),a.YNc(18,qo,2,4,"ng-template",null,20,a.W1O),a.qZA(),a.TgZ(20,"column",21),a.YNc(21,So,7,12,"ng-template",null,22,a.W1O),a.qZA(),a.TgZ(23,"column",23),a.YNc(24,Fo,1,1,"ng-template",null,24,a.W1O),a.qZA(),a.TgZ(26,"column",25),a.YNc(27,Ro,2,1,"ng-template",null,26,a.W1O),a.qZA(),a.TgZ(29,"column",27),a.YNc(30,zo,2,2,"ng-template",null,28,a.W1O),a.qZA(),a.TgZ(32,"column",29),a.YNc(33,Yo,3,4,"ng-template",null,30,a.W1O),a.qZA(),a._UZ(35,"column",31),a.qZA(),a._UZ(36,"pagination",32),a.qZA()}if(2&i){const t=a.MAs(2),o=a.MAs(17),n=a.MAs(19),l=a.MAs(22),d=a.MAs(25),p=a.MAs(28),c=a.MAs(31),_=a.MAs(34),u=a.oxw();a.Q6J("dao",u.dao)("orderBy",u.orderBy)("groupBy",u.groupBy)("join",u.join)("init",u.initGrid.bind(u))("hasAdd",!1)("hasEdit",!1)("loadList",u.onGridLoad.bind(u))("groupTemplate",t),a.xp6(3),a.Q6J("ngIf",!u.selectable),a.xp6(1),a.Q6J("form",u.filter)("where",u.filterWhere)("submit",u.filterSubmit.bind(u))("collapseChange",u.filterCollapseChange.bind(u))("collapsed",u.filterCollapsed)("deleted",u.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",5)("control",u.filter.controls.usuario_id)("dao",u.usuarioDao),a.xp6(2),a.Q6J("size",5)("control",u.filter.controls.unidade_id)("dao",u.unidadeDao),a.xp6(2),a.Q6J("size",1)("disabled",u.canFilterSubordinadas)("control",u.filter.controls.unidades_subordinadas),a.xp6(2),a.Q6J("size",1)("control",u.filter.controls.incluir_arquivados),a.xp6(3),a.Q6J("icon",u.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",u.lex.translate("Consolida\xe7\xe3o"))("template",o)("expandTemplate",n),a.xp6(5),a.Q6J("title","Plano de trabalho/Vig\xeancia\nUnidade/Programa/Modalidade")("template",l),a.xp6(3),a.Q6J("template",d),a.xp6(3),a.Q6J("template",p),a.xp6(3),a.Q6J("title","Estat\xedsticas\nAvalia\xe7\xf5es")("template",c)("width",300),a.xp6(3),a.Q6J("template",_),a.xp6(3),a.Q6J("dynamicButtons",u.dynamicButtons.bind(u)),a.xp6(1),a.Q6J("rows",u.rowsLimit)}}function Bo(i,e){if(1&i&&(a.TgZ(0,"div",33)(1,"div",34),a._UZ(2,"profile-picture",35),a.qZA(),a.TgZ(3,"div",36)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br")(7,"badge",37),a.qZA()()),2&i){const t=e.separator,o=a.oxw(2);let n,l,d,p;a.xp6(2),a.Q6J("url",null==(n=o.usuarioSeparator(t))?null:n.url_foto)("size",40)("hint",null==(l=o.usuarioSeparator(t))?null:l.nome),a.xp6(3),a.Oqu((null==(d=o.usuarioSeparator(t))?null:d.nome)||"Desconhecido"),a.xp6(2),a.Q6J("icon",o.entityService.getIcon("Unidade"))("label",(null==(p=o.unidadeSeparator(t))?null:p.sigla)||"Desconhecido")}}function ko(i,e){1&i&&a._UZ(0,"toolbar")}function Wo(i,e){}function jo(i,e){if(1&i&&(a.TgZ(0,"div",64)(1,"div",65),a._UZ(2,"profile-picture",35),a.qZA(),a.TgZ(3,"div",66)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&i){const t=e.row;a.xp6(2),a.Q6J("url",t.avaliador.url_foto||"")("size",40)("hint",t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.apelido||"")}}function Ko(i,e){if(1&i&&(a._UZ(0,"badge",67)(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA()),2&i){const t=e.row,o=a.oxw(3);a.Q6J("label",o.getNota(t).nota)("icon",o.getNota(t).icone)("color",o.getNota(t).cor),a.xp6(3),a.Oqu(o.getNota(t).descricao)}}function Xo(i,e){if(1&i&&a._UZ(0,"badge",69),2&i){const t=e.$implicit,o=a.oxw(4);a.Q6J("icon",o.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function $o(i,e){if(1&i&&(a._uU(0),a.TgZ(1,"div",47),a.YNc(2,Xo,1,2,"badge",68),a.qZA()),2&i){const t=e.row;a.hij(" ",t.justificativa||""," "),a.xp6(2),a.Q6J("ngForOf",t.justificativas)}}function ai(i,e){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=e.row;a.xp6(1),a.Oqu(t.recurso||"")}}function ti(i,e){1&i&&a._UZ(0,"badge",50)}function ei(i,e){1&i&&a._UZ(0,"badge",71)}function oi(i,e){if(1&i&&(a.TgZ(0,"div",47),a.YNc(1,ti,1,0,"badge",49),a.YNc(2,ei,1,0,"badge",70),a.qZA()),2&i){const t=e.row,o=a.oxw(3);a.xp6(1),a.Q6J("ngIf",null==t.recurso?null:t.recurso.length),a.xp6(1),a.Q6J("ngIf",t.id==(null==o.avaliacao?null:o.avaliacao.id))}}function ii(i,e){if(1&i&&(a.TgZ(0,"grid",55,56)(2,"columns"),a._UZ(3,"column",57),a.TgZ(4,"column",58),a.YNc(5,jo,9,5,"ng-template",null,59,a.W1O),a.qZA(),a.TgZ(7,"column",21),a.YNc(8,Ko,4,4,"ng-template",null,60,a.W1O),a.qZA(),a.TgZ(10,"column",21),a.YNc(11,$o,3,2,"ng-template",null,61,a.W1O),a.qZA(),a.TgZ(13,"column",62),a.YNc(14,ai,2,1,"ng-template",null,63,a.W1O),a.qZA(),a.TgZ(16,"column",29),a.YNc(17,oi,3,2,"ng-template",null,30,a.W1O),a.qZA()()()),2&i){const t=e.row,o=a.MAs(6),n=a.MAs(9),l=a.MAs(12),d=a.MAs(15),p=a.MAs(18),c=a.oxw(2);a.Q6J("items",c.getAvaliacoes(t))("minHeight",0),a.xp6(4),a.Q6J("template",o),a.xp6(3),a.Q6J("title","Nota")("template",n),a.xp6(3),a.Q6J("title","Justificativas")("template",l),a.xp6(3),a.Q6J("template",d),a.xp6(3),a.Q6J("template",p)}}function ni(i,e){if(1&i&&(a._uU(0),a._UZ(1,"badge",40)(2,"badge",41)(3,"br")(4,"badge",42)(5,"badge",42)),2&i){const t=e.row,o=a.oxw(2);a.hij(" ",t.plano_trabalho.usuario.nome," "),a.xp6(1),a.Q6J("textValue",o.util.getDateFormatted(t.plano_trabalho.data_inicio)),a.xp6(1),a.Q6J("textValue",o.util.getDateFormatted(t.plano_trabalho.data_fim)),a.xp6(2),a.Q6J("icon",o.entityService.getIcon("Programa"))("label",null==t.plano_trabalho.programa?null:t.plano_trabalho.programa.nome)("hint",o.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",o.lex.translate("Tipo de modalidade"))}}function li(i,e){if(1&i&&a._uU(0),2&i){const t=e.row,o=a.oxw(2);a.hij(" ",o.util.getDateFormatted(t.data_inicio)," ")}}function ri(i,e){if(1&i&&a._uU(0),2&i){const t=e.row,o=a.oxw(2);a.hij(" ",o.util.getDateFormatted(t.data_fim)," ")}}function si(i,e){if(1&i){const t=a.EpF();a.TgZ(0,"grid",5),a.YNc(1,Bo,8,6,"ng-template",null,51,a.W1O),a.YNc(3,ko,1,0,"toolbar",7),a.TgZ(4,"filter",8)(5,"div",9),a._UZ(6,"input-search",10,11),a.TgZ(8,"input-search",12,13),a.NdJ("change",function(n){a.CHM(t);const l=a.oxw();return a.KtG(l.onUnidadeChange(n))}),a.qZA(),a._UZ(10,"input-switch",14,15)(12,"input-switch",16,17),a.qZA()(),a.TgZ(14,"columns")(15,"column",52),a.YNc(16,Wo,0,0,"ng-template",null,53,a.W1O),a.YNc(18,ii,19,9,"ng-template",null,54,a.W1O),a.qZA(),a.TgZ(20,"column",21),a.YNc(21,ni,6,9,"ng-template",null,22,a.W1O),a.qZA(),a.TgZ(23,"column",23),a.YNc(24,li,1,1,"ng-template",null,24,a.W1O),a.qZA(),a.TgZ(26,"column",25),a.YNc(27,ri,1,1,"ng-template",null,26,a.W1O),a.qZA()(),a._UZ(29,"pagination",32),a.qZA()}if(2&i){const t=a.MAs(2),o=a.MAs(17),n=a.MAs(19),l=a.MAs(22),d=a.MAs(25),p=a.MAs(28),c=a.oxw();a.Q6J("dao",c.dao)("orderBy",c.orderBy)("groupBy",c.groupBy)("join",c.join)("init",c.initGrid.bind(c))("hasAdd",!1)("hasEdit",!1)("loadList",c.onGridLoadHistorico.bind(c))("groupTemplate",t),a.xp6(3),a.Q6J("ngIf",!c.selectable),a.xp6(1),a.Q6J("form",c.filter)("where",c.filterWhereHistorico)("submit",c.filterSubmit.bind(c))("collapseChange",c.filterCollapseChange.bind(c))("collapsed",c.filterCollapsed)("deleted",c.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",5)("control",c.filter.controls.usuario_id)("dao",c.usuarioDao),a.xp6(2),a.Q6J("size",5)("control",c.filter.controls.unidade_id)("dao",c.unidadeDao),a.xp6(2),a.Q6J("size",1)("disabled",c.canFilterSubordinadas)("control",c.filter.controls.unidades_subordinadas),a.xp6(2),a.Q6J("size",1)("control",c.filter.controls.incluir_arquivados),a.xp6(3),a.Q6J("icon",c.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("template",o)("expandTemplate",n),a.xp6(5),a.Q6J("title","Plano de trabalho/Vig\xeancia\nPrograma/Modalidade")("template",l),a.xp6(3),a.Q6J("template",d),a.xp6(3),a.Q6J("template",p),a.xp6(3),a.Q6J("rows",c.rowsLimit)}}class Fa extends Jo.E{constructor(e){super(e,Ia,la.E),this.injector=e,this.avaliacoes=[],this.avaliacao=new Qo.g,this.consolidacaoId=[],this.joinAvaliacao=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.filterWhere=t=>{let o=[],n=t.value;return o.push(["status","in",["CONCLUIDO","AVALIADO"]]),n.usuario_id?.length&&o.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&o.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&o.push(["incluir_arquivados","==",!0]),o},this.filterWhereHistorico=t=>{let o=[],n=t.value;return o.push(["status","in",["AVALIADO"]]),n.usuario_id?.length&&o.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&o.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&o.push(["incluir_arquivados","==",!0]),o},this.unidadeService=e.get(ea.Z),this.join=["avaliacao","plano_trabalho:id"],this.extraJoin=["avaliacao.tipoAvaliacao.notas","planoTrabalho.unidade:id,sigla,nome","planoTrabalho.unidade.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.tipoModalidade:id,nome","planoTrabalho.usuario:id,nome,apelido,foto_perfil,url_foto"],this.groupBy=[{field:"plano_trabalho.unidade.sigla",label:this.lex.translate("Unidade")},{field:"plano_trabalho.unidade.id",label:"Unidade Id"},{field:"plano_trabalho.usuario.nome",label:this.lex.translate("Participante")},{field:"plano_trabalho.usuario.id",label:"Usu\xe1rio Id"}],this.usuarioDao=e.get($.q),this.unidadeDao=e.get(U.J),this.avaliacaoDao=e.get(Pa.w),this.planoTrabalhoService=e.get(w.p),this.title="Avalia\xe7\xf5es "+this.lex.translate("das Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD_AVAL",this.filter=this.fh.FormBuilder({usuario_id:{default:""},unidade_id:{default:""},unidades_subordinadas:{default:!1},incluir_arquivados:{default:!1}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||this.auth.lotacao||null)}get canFilterSubordinadas(){return this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)?void 0:"true"}usuarioSeparator(e){let t=e.group[3].value;return e.metadata=e.metadata||{},e.metadata.usuario=e.metadata.usuario||this.extra?.planos_trabalhos?.find(o=>o.usuario_id==t)?.usuario,e.metadata.usuario}unidadeSeparator(e){let t=e.group[1].value;return e.metadata=e.metadata||{},e.metadata.unidade=e.metadata.unidade||this.extra?.planos_trabalhos?.find(o=>o.unidade_id==t)?.unidade,e.metadata.unidade}onUnidadeChange(e){this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)||this.filter.controls.unidades_subordinadas.setValue(!1)}onGridLoad(e){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(o=>{let n=o;n.programa=this.extra?.programas?.find(l=>l.id==n.programa_id)}),e?.forEach(o=>{let n=o;n.plano_trabalho=this.extra?.planos_trabalhos?.find(l=>l.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(l=>l.id==n.avaliacao.tipo_avaliacao_id))})}refreshConsolidacao(e){var t=this;(0,s.Z)(function*(){yield t.grid.query.refreshId(e.id,t.extraJoin),t.grid.refreshRows()})()}anterior(e){return this.grid.items.reduce((t,o)=>this.util.asTimestamp(o.data_inicio)<this.util.asTimestamp(e.data_inicio)&&(!t||this.util.asTimestamp(t.data_inicio)<this.util.asTimestamp(o.data_inicio))?o:t,void 0)}proximo(e){return this.grid.items.reduce((t,o)=>this.util.asTimestamp(o.data_fim)>this.util.asTimestamp(e.data_fim)&&(!t||this.util.asTimestamp(t.data_fim)>this.util.asTimestamp(o.data_fim))?o:t,void 0)}dynamicButtons(e){let t=[],o=e,n=o.plano_trabalho.programa;const l=o.plano_trabalho.usuario_id,d=o.plano_trabalho.unidade_id,p=this.anterior(e),c=this.proximo(e),_=this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL")&&(this.unidadeService.isGestorUnidade(d)||this.auth.isIntegrante("AVALIADOR_PLANO_TRABALHO",d)),u=this.auth.usuario.id==l,b={hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-warning",onClick:v=>this.planoTrabalhoService.avaliar(v,n,this.refreshConsolidacao.bind(this))},m={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:v=>this.planoTrabalhoService.avaliar(v,n,this.refreshConsolidacao.bind(this))},H={hint:"Fazer recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:v=>this.planoTrabalhoService.fazerRecurso(v,n,this.refreshConsolidacao.bind(this))},B={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:v=>this.planoTrabalhoService.cancelarAvaliacao(v,this,this.refreshConsolidacao.bind(this))},X=!p||["AVALIADO"].includes(p.status),da=!c||["INCLUIDO","CONCLUIDO"].includes(c.status);return"CONCLUIDO"==o.status&&X&&_&&t.push(b),"AVALIADO"==o.status&&o.avaliacao&&(u&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&o.avaliacao?.data_avaliacao&&(!n.dias_tolerancia_recurso_avaliacao||this.util.daystamp(o.avaliacao.data_avaliacao)+n.dias_tolerancia_recurso_avaliacao>this.util.daystamp(this.auth.hora))&&t.push(H),X&&_&&(t.push(m),da&&t.push(B))),t}onSelectTab(e){var t=this;return(0,s.Z)(function*(){t.viewInit&&t.saveUsuarioConfig({active_tab:e.key})})()}initGrid(e){e.queryInit()}getAvaliacoes(e){return this.avaliacoes.filter(t=>t.plano_trabalho_consolidacao_id==e.id)}loadData(){var e=this;return(0,s.Z)(function*(){e.loading=!0;try{e.avaliacoes=yield e.avaliacaoDao.query({where:[["plano_trabalho_consolidacao_id","in",e.consolidacaoId]],join:e.joinAvaliacao,orderBy:[["data_avaliacao","desc"]]}).asPromise(),e.avaliacao=e.avaliacoes[0]||e.avaliacao}finally{e.loading=!1}})()}onGridLoadHistorico(e){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(o=>{let n=o;n.programa=this.extra?.programas?.find(l=>l.id==n.programa_id)}),e?.forEach(o=>{this.consolidacaoId?.push(o.id);let n=o;n.plano_trabalho=this.extra?.planos_trabalhos?.find(l=>l.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(l=>l.id==n.avaliacao.tipo_avaliacao_id))}),this.loadData()}getNota(e){return e.tipo_avaliacao.notas.find(t=>t.codigo==e.nota)}}(Y=Fa).\u0275fac=function(e){return new(e||Y)(a.Y36(a.zs3))},Y.\u0275cmp=a.Xpm({type:Y,selectors:[["app-plano-trabalho-consolidacao-avaliacao"]],viewQuery:function(e,t){if(1&e&&a.Gf(C.M,5),2&e){let o;a.iGM(o=a.CRH())&&(t.grid=o.first)}},features:[a.qOj],decls:7,vars:5,consts:[["right","",3,"title","select"],["key","CONSOLIDACOES","icon","bi bi-clipboard-check",3,"label","template"],["consolidacoes",""],["key","HISTORICO","icon","bi bi-clipboard-pulse","label","Hist\xf3rico de Avalia\xe7\xf5es",3,"template"],["historico",""],[3,"dao","orderBy","groupBy","join","init","hasAdd","hasEdit","loadList","groupTemplate"],["groupUnidadeUsuario",""],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","unidade_id",3,"size","control","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","disabled","control"],["subordinadas",""],["label","Arq.","controlName","incluir_arquivados","labelInfo","Incluir os planos de trabalhos arquivados",3,"size","control"],["arquivadas",""],["type","expand",3,"icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],[3,"title","template"],["columnPlanoTrabalho",""],["title","Data in\xedcio",3,"template"],["columnDataInicio",""],["title","Data fim",3,"template"],["columnDataFim",""],[3,"title","template","width"],["columnEstatisticas",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicButtons"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","primary",3,"icon","label"],[3,"disabled","entity","planoTrabalho","cdRef"],["consolidacao",""],["label","In\xedcio","color","light","icon","bi bi-calendar2",3,"textValue"],["label","T\xe9rmino","color","light","icon","bi bi-calendar2-check",3,"textValue"],["color","light",3,"icon","label","hint"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["groupHistorico",""],["type","expand",3,"icon","align","template","expandTemplate"],["columnHistorico",""],["columnExpandedHistorico",""],[3,"items","minHeight"],["gridEntregas",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],["columnAvaliador",""],["columnNota",""],["columnJustificativa",""],["title","Recurso",3,"template"],["columnRecurso",""],[1,"avaliador"],[1,"avaliador-profile"],[1,"avaliador-nome"],[3,"label","icon","color"],[3,"icon","label",4,"ngFor","ngForOf"],[3,"icon","label"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(e,t){if(1&e&&(a.TgZ(0,"tabs",0)(1,"tab",1),a.YNc(2,Ho,37,42,"ng-template",null,2,a.W1O),a.qZA(),a.TgZ(4,"tab",3),a.YNc(5,si,30,36,"ng-template",null,4,a.W1O),a.qZA()()),2&e){const o=a.MAs(3),n=a.MAs(6);a.Q6J("title",t.isModal?"":t.title)("select",t.onSelectTab.bind(t)),a.xp6(1),a.Q6J("label",t.lex.translate("Consolida\xe7\xf5es"))("template",o),a.xp6(3),a.Q6J("template",n)}},dependencies:[g.sg,g.O5,C.M,M.a,q.b,na.z,qa.n,Sa.Q,J.a,T.V,W.n,ta.i,Z.N,E.F,Ea.q,Ua.M,ra]});const di=[{path:"",component:Za.H,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Planos de Trabalho"}},{path:"new",component:K,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Trabalho",modal:!0}},{path:"termo",component:ba,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Termo de ades\xe3o",modal:!0}},{path:"consolidacao/avaliacao",component:Fa,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Avalia\xe7\xe3o das Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/avaliar",component:Ma.w,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Avaliar Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/recurso",component:Ma.w,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Recurso da Avalia\xe7\xe3o da Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:usuarioId/:planoTrabalhoId",component:sa,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao",component:Na,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es"}},{path:":id/edit",component:K,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Trabalho",modal:!0}},{path:":id/consult",component:K,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Trabalho",modal:!0}},{path:"entrega-list",component:j,canActivate:[h.a],resolve:{config:f.o},runGuardsAndResolvers:"always",data:{title:"Lista de Entregas do Plano de Trabalho",modal:!0}}];class Ra{}(O=Ra).\u0275fac=function(e){return new(e||O)},O.\u0275mod=a.oAB({type:O}),O.\u0275inj=a.cJS({imports:[ua.Bz.forChild(di),ua.Bz]});var I,ci=r(58568),ui=r(72133),mi=r(32864),pi=r(59013),_i=r(58252),gi=r(61915);class Va{}(I=Va).\u0275fac=function(e){return new(e||I)},I.\u0275mod=a.oAB({type:I}),I.\u0275inj=a.cJS({imports:[g.ez,ci.K,ui.UX,Ra,mi.UteisModule,pi.AtividadeModule]}),a.B6R(Za.H,[g.O5,C.M,M.a,q.b,na.z,qa.n,Sa.Q,J.a,T.V,aa.m,k.k,oa.p,_i.Y,gi.l,E.F,Qa.h,j],[])}}]);