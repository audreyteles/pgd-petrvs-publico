<<<<<<< HEAD
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9013],{62095:(ye,R,l)=>{l.d(R,{u:()=>J});var b=l(8239),L=l(72133),v=l(73150),C=l(949),h=l(79084),T=l(88543),I=l(17112),Z=l(57338),r=l(20755),P=l(76733),z=l(57224),G=l(83351),U=l(88820),e=l(81419),q=l(72504);function D(f,c){if(1&f&&(r.TgZ(0,"strong",9),r._uU(1),r.qZA()),2&f){const d=r.oxw().row;r.xp6(1),r.Oqu((null==d.tipo_tarefa?null:d.tipo_tarefa.nome)||"")}}function O(f,c){if(1&f&&(r.YNc(0,D,2,1,"strong",8),r._uU(1)),2&f){const d=c.row;r.Q6J("ngIf",null==d.tipo_tarefa||null==d.tipo_tarefa.nome?null:d.tipo_tarefa.nome.length),r.xp6(1),r.hij(" ",d.descricao," ")}}function k(f,c){if(1&f&&r._UZ(0,"documentos-badge",12),2&f){const d=c.row;r.Q6J("documento",d.documento)}}function B(f,c){if(1&f&&(r.TgZ(0,"column",10),r.YNc(1,k,1,1,"ng-template",null,11,r.W1O),r.qZA()),2&f){const d=r.MAs(2);r.Q6J("template",d)}}function x(f,c){1&f&&r._UZ(0,"i",18)}function w(f,c){if(1&f&&(r.TgZ(0,"div",16),r.YNc(1,x,1,0,"i",17),r.qZA()),2&f){const d=c.row;r.xp6(1),r.Q6J("ngIf",d.data_conclusao)}}function H(f,c){if(1&f&&r._UZ(0,"input-switch",19),2&f){const d=r.oxw(2);r.Q6J("size",12)("control",d.formEdit.controls.concluido)}}function oe(f,c){if(1&f&&(r.TgZ(0,"column",13),r.YNc(1,w,2,1,"ng-template",null,14,r.W1O),r.YNc(3,H,1,2,"ng-template",null,15,r.W1O),r.qZA()),2&f){const d=r.MAs(2),u=r.MAs(4),m=r.oxw();r.Q6J("align","center")("template",d)("columnEditTemplate",u)("canEdit",m.canConcluidoEdit.bind(m))("edit",m.editable?m.onColumnConcluidoEdit.bind(m):void 0)("save",m.editable?m.onColumnConcluidoSave.bind(m):void 0)}}function Y(f,c){if(1&f&&r._UZ(0,"comentarios-widget",20),2&f){const d=c.row,u=r.oxw();r.Q6J("entity",d)("noPersist",u.isPersist?void 0:"true")("selectable",u.selectable)("grid",u.grid)("save",u.addComentarioResult.bind(u))}}function j(f,c){if(1&f&&r._UZ(0,"column",21),2&f){const d=r.oxw();r.Q6J("dynamicButtons",d.dynamicButtons.bind(d))}}class J extends I._{set atividade(c){this._atividade!=c&&(this._atividade=c,this.isPersist&&c?.tarefas&&this.control.setValue(c?.tarefas))}get atividade(){return this._atividade}constructor(c){var d;super(c),d=this,this.injector=c,this.control=new L.NI,this.disabled=!1,this.editable=!0,this.selectable=!1,this.id_processo=0,this.consolidacao=!0,this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.editTarefa=function(){var u=(0,b.Z)(function*(m){d.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:m,atividade:d.atividade},modalClose:g=>{g&&(0,b.Z)(function*(){const Q=d.control.value,E=Q.findIndex(y=>y.id==m.id);if(E>=0){if(g._status="ADD"==g._status?"ADD":"EDIT",d.isPersist&&d.atividade?.tarefas){d.grid.error=void 0;try{d.dialog.showSppinerOverlay("Salvando dados do formul\xe1rio"),g=yield d.dao.save(g,d.join)}catch(y){d.grid.error=y.message?y.message:y,g=void 0}finally{d.dialog.closeSppinerOverlay()}}g&&(Q[E]=g,d.control.setValue(Q))}d.cdRef.detectChanges()})()}})});return function(m){return u.apply(this,arguments)}}(),this.dao=c.get(C.n),this.atividadeService=c.get(Z.s),this.allPages=c.get(h.T),this.formEdit=this.fh.FormBuilder({concluido:{default:!1}}),this.join=["tipo_tarefa","comentarios.usuario"]}ngOnInit(){super.ngOnInit(),this.queryParams?.id_processo&&(this.id_processo=this.queryParams?.id_processo),this.isPersist&&this.atividade?.tarefas&&this.control.setValue(this.atividade?.tarefas)}ngAfterViewInit(){super.ngAfterViewInit(),this.id_processo&&(this.loading=!0,this.dao.query({where:[["id_processo","==",this.id_processo]]}).asPromise().then(c=>{this.control.setValue(c||[]),this.cdRef.detectChanges()}).finally(()=>{this.loading=!1}))}get isPersist(){return null!=this.persist}addTarefa(){var c=this;return(0,b.Z)(function*(){const d=new T.l;d.id=c.dao.generateUuid(),d.usuario=c.auth.usuario,d.usuario_id=c.auth.usuario.id,d.atividade_id=c.atividade?.id||"",d.comentarios=[],d._status="ADD",c.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:d,atividade:c.atividade},modalClose:u=>{u&&(0,b.Z)(function*(){const m=c.control.value||[];if(c.isPersist&&c.atividade?.tarefas){c.grid.error=void 0;try{c.dialog.showSppinerOverlay("Salvando dados do formul\xe1rio"),u=yield c.dao.save(u,c.join)}catch(g){c.grid.error=g.message?g.message:g,u=void 0}finally{c.dialog.closeSppinerOverlay()}}u&&(m.push(u),c.control.setValue(m)),c.cdRef.detectChanges()})()}})})()}deleteTarefa(c){var d=this;return(0,b.Z)(function*(){const u=yield d.dialog.confirm("Exclui ?","Deseja realmente excluir?");if(d.grid.error=void 0,u)try{if(d.isPersist&&d.atividade?.tarefas||"ADD"==c._status){const m=d.control.value,g=m.findIndex(Q=>Q.id==c.id);d.isPersist&&d.atividade?.tarefas&&(yield d.dao.delete(c)),g>=0&&(m.splice(g,1),d.control.setValue(m))}else c._status="DELETE";d.dialog.alert("Sucesso","Registro exclu\xeddo com sucesso!"),d.cdRef.detectChanges()}catch(m){d.grid.error=m?.message?m?.message:m}})()}onColumnConcluidoEdit(c){var d=this;return(0,b.Z)(function*(){d.formEdit.controls.concluido.setValue(!!c.data_conclusao)})()}onColumnConcluidoSave(c){var d=this;return(0,b.Z)(function*(){try{const u=d.formEdit.controls.concluido.value?d.auth.hora:null,m=yield d.dao.update(c.id,{data_conclusao:u});return c.concluido=d.formEdit.controls.concluido.value,c.data_conclusao=c.concluido?u:null,!!m}catch{return!1}})()}addComentarioResult(c){if(c)if(this.isPersist)this.dao.getById(c.id,this.join).then(d=>{if(d){const u=this.control.value||[],m=u.findIndex(g=>g.id=d.id);m>=0&&(u[m]=d,this.control.setValue(u),this.cdRef.detectChanges())}});else{const d=c.comentarios.filter(u=>["ADD","EDIT","DELETE"].includes(u._status||"")).length>0;c._status=d&&!["ADD","EDIT","DELETE"].includes(c._status||"")?"EDIT":c._status}}dynamicButtons(c){let d=[],u=c,m=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return(!m||"INCLUIDO"==m.status||this.util.asTimestamp(m.data_conclusao)<this.util.asTimestamp(u.created_at))&&(d.push({label:"Alterar",icon:"bi bi-pencil-square",hint:"Alterar",color:"btn-outline-info",onClick:this.editTarefa.bind(this)}),d.push({label:"Excluir",icon:"bi bi-trash",hint:"Excluir",color:"btn-outline-danger",onClick:this.deleteTarefa.bind(this)})),d}canConcluidoEdit(c){let d=c,u=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return!u||"INCLUIDO"==u.status||this.util.asTimestamp(u.data_conclusao)<this.util.asTimestamp(d.data_conclusao)}static#e=this.\u0275fac=function(d){return new(d||J)(r.Y36(r.zs3))};static#t=this.\u0275cmp=r.Xpm({type:J,selectors:[["atividade-list-tarefa"]],viewQuery:function(d,u){if(1&d&&r.Gf(v.M,5),2&d){let m;r.iGM(m=r.CRH())&&(u.grid=m.first)}},inputs:{control:"control",persist:"persist",disabled:"disabled",editable:"editable",selectable:"selectable",id_processo:"id_processo",consolidacao:"consolidacao",atividade:"atividade"},features:[r.qOj],decls:11,vars:13,consts:[[3,"control","add","disabled","minHeight","hasEdit","hasDelete","editable"],[3,"title","template"],["tipoTarefaDescricao",""],["title","Documento",3,"template",4,"ngIf"],["title","Conclu\xeddo",3,"align","template","columnEditTemplate","canEdit","edit","save",4,"ngIf"],["title","Informa\xe7\xf5es adicionais",3,"template"],["tarefaComentarios",""],["type","options",3,"dynamicButtons",4,"ngIf"],["class","d-block",4,"ngIf"],[1,"d-block"],["title","Documento",3,"template"],["documento",""],[3,"documento"],["title","Conclu\xeddo",3,"align","template","columnEditTemplate","canEdit","edit","save"],["concluido",""],["editConcluido",""],[1,"text-center"],["class","bi bi-check-circle",4,"ngIf"],[1,"bi","bi-check-circle"],["controlName","concluido",3,"size","control"],["origem","ATIVIDADE_TAREFA",3,"entity","noPersist","selectable","grid","save"],["type","options",3,"dynamicButtons"]],template:function(d,u){if(1&d&&(r.TgZ(0,"grid",0)(1,"columns")(2,"column",1),r.YNc(3,O,2,2,"ng-template",null,2,r.W1O),r.qZA(),r.YNc(5,B,3,1,"column",3),r.YNc(6,oe,5,6,"column",4),r.TgZ(7,"column",5),r.YNc(8,Y,1,5,"ng-template",null,6,r.W1O),r.qZA(),r.YNc(10,j,1,1,"column",7),r.qZA()()),2&d){const m=r.MAs(4),g=r.MAs(9);r.Q6J("control",u.control)("add",u.addTarefa.bind(u))("disabled",u.disabled?"true":void 0)("minHeight",50)("hasEdit",!1)("hasDelete",!1)("editable",u.editable?"true":void 0),r.xp6(2),r.Q6J("title",u.lex.translate("Tipo de Tarefa")+" e Descri\xe7\xe3o")("template",m),r.xp6(3),r.Q6J("ngIf",u.consolidacao),r.xp6(1),r.Q6J("ngIf",u.consolidacao),r.xp6(1),r.Q6J("template",g),r.xp6(3),r.Q6J("ngIf",u.editable&&!u.selectable&&!u.id_processo)}},dependencies:[P.O5,v.M,z.a,G.b,U.a,e.y,q.h]})}},59013:(ye,R,l)=>{l.r(R),l.d(R,{AtividadeModule:()=>ie});var b=l(76733),L=l(55579),v=l(1391),C=l(2314),h=l(8239),T=l(74040),I=l(1184),Z=l(84971),r=l(73101),P=l(6551),z=l(88340),G=l(22981),U=l(43972),e=l(20755),q=l(88820),D=l(32802),O=l(84495),k=l(64603),B=l(53085),x=l(25560),w=l(9224),H=l(60785),oe=l(25026),Y=l(70361),j=l(79084),J=l(76298),f=l(48935),c=l(92392);const d=["numeroProcesso"],u=["numeroDocumento"],m=["tipoProcesso"],g=["tipoDocumento"];function Q(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"editable-form",1),e._UZ(1,"separator",2),e.TgZ(2,"separator",3)(3,"div",4)(4,"input-button",5,6),e.NdJ("buttonClick",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onNumeroProcessoClick(i))}),e.qZA(),e._UZ(6,"input-search",7,8),e.qZA(),e.TgZ(8,"div",4)(9,"input-button",9,10),e.NdJ("buttonClick",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onNumeroDocumentoClick(i))}),e.qZA(),e._UZ(11,"input-search",11,12),e.qZA(),e.TgZ(13,"div",4),e._UZ(14,"input-text",13),e.qZA()()()}if(2&s){const t=e.oxw();e.Q6J("form",t.form),e.xp6(4),e.Q6J("size",4)("control",t.form.controls.numero_processo)("disabled",!t.gb.isEmbedded||null!=t.form.controls.numero_documento.value&&t.form.controls.numero_documento.value.length?"true":void 0),e.xp6(2),e.Q6J("label",t.lex.translate("Tipo de Processo"))("size",8)("dao",t.tipoProcessoDao),e.xp6(3),e.Q6J("size",4)("control",t.form.controls.numero_requisicao)("disabled",t.gb.isEmbedded?void 0:"true"),e.xp6(2),e.Q6J("label",t.lex.translate("Tipo de Documento"))("size",8)("dao",t.tipoDocumentoDao),e.xp6(3),e.Q6J("size",12)("control",t.form.controls.titulo_documento),e.uIk("maxlength",250)}}class E extends J.D{set documento(o){this._entity!=o&&(this._entity=o,o&&this.loadData(o))}get documento(){if(this._entity){this.loadEntity(this.form.value);const o=!!this._entity.link?.id_processo;return this._entity._status=o||"ADD"==this._entity._status?o&&!this._entity._status?"EDIT":this._entity._status:"DEL",o||"ADD"!=this._entity._status?this._entity:void 0}}set sei(o){this._sei!=o&&(this._sei=o,o&&(this.form?.controls.id_processo.setValue(o.id_processo||0),this.form?.controls.numero_processo.setValue(o.numero_processo||""),this.form?.controls.id_documento.setValue(o.id_documento||0),this.form?.controls.numero_documento.setValue(o.numero_documento||""),o.numero_documento?this.onNumeroDocumentoClick(new Event("click")):o.numero_processo&&this.onNumeroProcessoClick(new Event("click"))))}get sei(){return this._sei}constructor(o){super(o),this.injector=o,this.validate=(t,a)=>null,this.documentoDao=o.get(oe.d),this._entity=new U.U({tipo:"LINK",especie:"SEI",link:{tipo:"SEI",id_processo:null,numero_processo:"",id_documento:null,numero_documento:"",titulo_documento:""},_status:"ADD"}),this.allPages=o.get(j.T),this.tipoDocumentoDao=o.get(z.Q),this.tipoProcessoDao=o.get(Y.n),this.form=this.fh.FormBuilder({tipo:{default:"URL"},url:{default:""},id_processo:{default:0},numero_processo:{default:""},id_documento:{default:0},numero_documento:{default:""},tipo_processo_id:{default:null},tipo_documento_id:{default:null},titulo_documento:{default:""}},this.cdRef,this.validate)}loadData(o){o&&(o.tipo="LINK"),this.form.patchValue(o?.link||{})}loadEntity(o){this.util.fillForm(this._entity.link,o)}get isSei(){return"SEI"==this._entity?.tipo}isEmpty(){let o=this.form.value;return!this.form.valid||"URL"==o.tipo&&!o.url?.length||"SEI"==o.tipo&&(!o.numero_processo?.length||!o.numero_processo?.length)}onNumeroDocumentoClick(o){var t=this;return(0,h.Z)(function*(){const a=t.form?.controls.numero_documento?.value;if(a?.length){t.numeroDocumento.loading=!0;try{let i=yield t.allPages.getDadosDocumento(a);if(!i)throw new Error("Documento n\xe3o encontrado");{let n=null,p=null;if(i.processo?.tipo_processo){const _=yield t.tipoProcessoDao.query({where:[["codigo","=",i.processo?.tipo_processo]]}).asPromise();_[0]&&(t.tipoProcesso?.loadSearch(_[0]),n=_[0].id)}if(i.documento?.tipo_documento){const _=yield t.tipoDocumentoDao.query({where:[["nome","=",i.documento?.tipo_documento]]}).asPromise();_[0]&&(t.tipoDocumento?.loadSearch(_[0]),p=_[0].id)}Object.assign(t._entity.link,{id_processo:i.processo?.id_processo,numero_processo:i.processo?.numero_processo,id_documento:i.documento?.id_documento,numero_documento:i.documento?.numero_documento,tipo_processo_id:n,tipo_documento_requisicao_id:p,titulo_documento:i.documento?.titulo_documento}),t._entity.titulo=i.documento?.titulo_documento,t.loadData(t._entity)}}catch{t.dialog.alert("Error","Imposs\xedvel encontrar o documento informado. Tente incluir diretamente pelo bot\xe3o 'Incluir atividade' acessando o documento no Sei!")}finally{t.numeroDocumento.loading=!1}}})()}onNumeroProcessoClick(o){var t=this;return(0,h.Z)(function*(){const a=t.form?.controls.numero_processo?.value;if(a?.length){t.numeroProcesso.loading=!0;try{let i=yield t.allPages.getDadosProcesso(a);if(!i)throw new Error("Processo n\xe3o encontrado");{let n=null;if(i.processo?.tipo_processo){const p=yield t.tipoProcessoDao.query({where:[["codigo","=",i.processo?.tipo_processo]]}).asPromise();p[0]&&(t.tipoProcesso?.loadSearch(p[0]),n=p[0].id)}Object.assign(t._entity.link,{id_processo:i.processo?.id_processo,numero_processo:i.processo?.numero_processo,id_documento:0,numero_documento:"",tipo_processo_id:n,tipo_documento_requisicao_id:null,titulo_documento:""}),t._entity.title="Processo "+i.processo?.numero_processo,t.loadData(t._entity)}}catch{t.dialog.alert("Error","Imposs\xedvel encontrar o processo informado. Tente incluir diretamente pelo bot\xe3o 'Incluir atividade' acessando o processo no Sei!")}finally{t.numeroProcesso.loading=!1}}})()}static#e=this.\u0275fac=function(t){return new(t||E)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:E,selectors:[["documento-link"]],viewQuery:function(t,a){if(1&t&&(e.Gf(T.Q,5),e.Gf(d,5),e.Gf(u,5),e.Gf(m,5),e.Gf(g,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.numeroProcesso=i.first),e.iGM(i=e.CRH())&&(a.numeroDocumento=i.first),e.iGM(i=e.CRH())&&(a.tipoProcesso=i.first),e.iGM(i=e.CRH())&&(a.tipoDocumento=i.first)}},inputs:{documento:"documento",sei:"sei"},features:[e.qOj],decls:1,vars:1,consts:[["noButtons","","confirmLabel","Assinar",3,"form",4,"ngIf"],["noButtons","","confirmLabel","Assinar",3,"form"],["title","Sei"],["transparent","","bottom",""],[1,"row"],["label","N\xfamero Processo","controlName","numero_processo","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"size","control","disabled","buttonClick"],["numeroProcesso",""],["controlName","tipo_processo_id","disabled","",3,"label","size","dao"],["tipoProcesso",""],["label","'N\xfamero Documento","controlName","numero_documento","labelInfo","Numero do documento, caso seja o Sei \xe9 o numero Sei",3,"size","control","disabled","buttonClick"],["numeroDocumento",""],["controlName","tipo_documento_id","disabled","",3,"label","size","dao"],["tipoDocumento",""],["label","T\xedtulo do documento","controlName","titulo_documento","disabled","","labelInfo","T\xedtulo do documento no Sei",3,"size","control"]],template:function(t,a){1&t&&e.YNc(0,Q,15,16,"editable-form",0),2&t&&e.Q6J("ngIf",a.isSei||a.gb.isEmbedded)},dependencies:[b.O5,T.Q,D.V,f.G,c.m,x.N]})}var y=l(62095);const Ie=["tipoAtividade"],Ze=["docEntregue"];function qe(s,o){if(1&s&&(e.TgZ(0,"div",2),e._UZ(1,"input-number",15)(2,"input-datetime",16),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",6)("decimals",2),e.xp6(1),e.Q6J("size",6)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+t.lex.translate("atividade"))}}function Oe(s,o){if(1&s&&(e.TgZ(0,"div",2),e._UZ(1,"input-timer",17)(2,"input-number",15)(3,"input-datetime",18),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Esfor\xe7o"))("control",t.form.controls.esforco),e.xp6(1),e.Q6J("size",4)("decimals",2),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+t.lex.translate("atividade"))}}function xe(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"input-datetime",19),e.TgZ(2,"input-datetime",20),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onDataEntregaChange(i))}),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",6)("control",t.form.controls.data_inicio)("labelInfo","Data em que o usu\xe1rio iniciou a "+t.lex.translate("atividade")),e.xp6(1),e.Q6J("size",6)("control",t.form.controls.data_entrega)("labelInfo","Data da conclus\xe3o da "+t.lex.translate("atividade"))}}function Ne(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"input-datetime",19),e.TgZ(2,"input-datetime",21),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onDataEntregaChange(i))}),e.qZA(),e._UZ(3,"input-timer",22),e.qZA()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio)("labelInfo","Data em que o usu\xe1rio iniciou a "+t.lex.translate("atividade")),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_entrega)("labelInfo","Data da conclus\xe3o da "+t.lex.translate("atividade")),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.tempo_despendido)("labelInfo","Calculado no fim da "+t.lex.translate("atividade")+", sendo o tempo l\xedquido (considerando pausas)")}}function ke(s,o){if(1&s&&(e.TgZ(0,"separator",23),e._UZ(1,"calendar-efemerides",24),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("efemerides",t.efemerides)}}class K extends I.F{constructor(o){super(o,r.a,Z.P),this.injector=o,this.modalWidth=800,this.entregas=[],this.validate=(t,a)=>{let i=null;return("plano_trabalho_entrega_id"==a&&!t.value?.length||"data_entrega"==a&&!this.util.isDataValid(t.value))&&(i="Obrigat\xf3rio"),i},this.tipoAtividadeDao=o.get(G.Y),this.tipoDocumentoDao=o.get(z.Q),this.calendar=o.get(P.o),this.title="Conclus\xe3o de "+this.lex.translate("atividade"),this.form=this.fh.FormBuilder({tipo_atividade_id:{default:null},data_distribuicao:{default:null},esforco:{default:0},progresso:{default:0},data_estipulada_entrega:{default:null},data_inicio:{default:null},tempo_despendido:{default:0},data_entrega:{default:null},arquivar:{default:!1},descricao_tecnica:{default:""},documento_entrega:{default:new U.U},documento_entrega_id:{default:null},plano_trabalho_entrega_id:{default:null}},this.cdRef,this.validate),this.join=["plano_trabalho.tipo_modalidade","unidade","plano_trabalho.entregas.plano_entrega_entrega:id,descricao"]}loadData(o,t){var a=this;return(0,h.Z)(function*(){let i=Object.assign({},t.value);i=a.util.fillForm(i,o),i.data_entrega=a.auth.hora,i.progresso=100,yield a.tipoAtividade.loadSearch(o.tipo_atividade||i.tipo_atividade_id),o.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(o.unidade_id)),a.entregas=o.plano_trabalho?.entregas?.map(n=>Object.assign({},{key:n.id,value:n.descricao+(n.plano_entrega_entrega?" ("+n.plano_entrega_entrega?.descricao+")":""),data:n}))||[],i.arquivar=!1,t.patchValue(i),a.onDataEntregaChange()})()}initializeData(o){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getAtividade(t.urlParams.get("id")),yield t.loadData(t.entity,o)})()}onDataEntregaChange(o){const t=this.form.controls.data_entrega.value,a=this.entity.data_inicio,i=this.entity.carga_horaria,n=this.entity.unidade,p=this.entity.pausas||[],_=this.entity.usuario?.afastamentos||[];this.efemerides=this.util.isDataValid(t)?this.calendar.calculaDataTempoUnidade(a,t,i,n,"ENTREGA",p,_):void 0,this.efemerides&&(this.form.controls.tempo_despendido.setValue(this.efemerides.tempoUtil),this.cdRef.detectChanges())}onTipoAtividadeSelect(o){const t=o.entity;this.form.controls.esforco.setValue(t?.esforco||0),this.cdRef.detectChanges()}saveData(o){return new Promise((t,a)=>{let i=this.util.fill(new r.a,this.entity);i=this.util.fillForm(i,this.form.value),i.id=this.entity.id,i.descricao_tecnica=this.form.controls.descricao_tecnica.value,i.data_arquivamento=this.form.controls.arquivar.value?new Date:null,i.progresso=this.form.controls.progresso.value,i.produtividade=this.entity?.plano_trabalho?.tipo_modalidade?.atividade_tempo_despendido?this.calendar.produtividade(i.esforco,i.tempo_despendido):null,this.dao.concluir(i).then(n=>t(n)).catch(a)})}static#e=this.\u0275fac=function(t){return new(t||K)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:K,selectors:[["app-atividade-form-concluir"]],viewQuery:function(t,a){if(1&t&&(e.Gf(Ie,5),e.Gf(Ze,5),e.Gf(T.Q,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.tipoAtividade=i.first),e.iGM(i=e.CRH())&&(a.docEntregue=i.first),e.iGM(i=e.CRH())&&(a.editableForm=i.first)}},features:[e.qOj],decls:19,vars:23,consts:[["initialFocus","tipo_atividade_id",3,"form","disabled","submit","cancel"],[3,"documento"],[1,"row"],["controlName","tipo_atividade_id",3,"label","emptyValue","size","dao","select"],["tipoAtividade",""],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["entrega",""],["label","Arquivar","controlName","arquivar","labelInfo","Arquivar automaticamente ap\xf3s a conclus\xe3o (Somente se o plano dispensar avalia\xe7\xe3o)",3,"size","control"],["collapse","",3,"title","collapsed"],["persist","",3,"atividade"],["class","row",4,"ngIf","ngIfElse"],["comEsforco",""],["title","Conclus\xe3o"],["comTempoDespendido",""],["title","C\xe1lculos das horas","collapse","",4,"ngIf"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo). Sempre ser\xe1 100% na conclus\xe3o!",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xe7\xe3o",3,"size","label","control"],["noIcon","","disabled","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","",3,"size","control","labelInfo"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega","required","",3,"size","control","labelInfo","change"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega",3,"size","control","labelInfo","change"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","",3,"size","control","labelInfo"],["title","C\xe1lculos das horas","collapse",""],[3,"efemerides"]],template:function(t,a){if(1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e._UZ(1,"documento-link",1),e.TgZ(2,"div",2)(3,"input-search",3,4),e.NdJ("select",function(n){return a.onTipoAtividadeSelect(n)}),e.qZA(),e._UZ(5,"input-select",5,6)(7,"input-switch",7),e.qZA(),e.TgZ(8,"separator",8),e._UZ(9,"atividade-list-tarefa",9),e.qZA(),e.YNc(10,qe,3,6,"div",10),e.YNc(11,Oe,4,9,"ng-template",null,11,e.W1O),e.TgZ(13,"separator",12),e.YNc(14,xe,3,6,"div",10),e.YNc(15,Ne,4,9,"ng-template",null,13,e.W1O),e._UZ(17,"documento-link",1),e.qZA(),e.YNc(18,ke,2,1,"separator",14),e.qZA()),2&t){const i=e.MAs(12),n=e.MAs(16);e.Q6J("form",a.form)("disabled",a.formDisabled),e.xp6(1),e.Q6J("documento",a.form.controls.documento_entrega.value),e.xp6(2),e.Q6J("label","Tipo de"+a.lex.translate("Atividade"))("emptyValue",null)("size",5)("dao",a.tipoAtividadeDao),e.xp6(2),e.Q6J("label",a.lex.translate("Entrega do plano"))("size",5)("control",a.form.controls.plano_trabalho_entrega_id)("items",a.entregas)("labelInfo",a.lex.translate("Entrega do plano")+" que a "+a.lex.translate("atividade")+" \xe9 referente"),e.xp6(2),e.Q6J("size",2)("control",a.form.controls.arquivar),e.xp6(1),e.Q6J("title","Tarefa da "+a.lex.translate("atividade"))("collapsed",!1),e.xp6(1),e.Q6J("atividade",a.entity),e.xp6(1),e.Q6J("ngIf",!(null!=a.entity&&null!=a.entity.plano_trabalho&&null!=a.entity.plano_trabalho.tipo_modalidade&&a.entity.plano_trabalho.tipo_modalidade.atividade_esforco))("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",!(null!=a.entity&&null!=a.entity.plano_trabalho&&null!=a.entity.plano_trabalho.tipo_modalidade&&a.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",n),e.xp6(3),e.Q6J("documento",a.form.controls.documento_entrega.value),e.xp6(1),e.Q6J("ngIf",a.efemerides&&(null==a.entity||null==a.entity.plano_trabalho||null==a.entity.plano_trabalho.tipo_modalidade?null:a.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))}},dependencies:[b.O5,T.Q,q.a,D.V,O.k,k.p,B.u,x.N,w.l,H.Y,E,y.u]})}var Qe=l(15213),Ue=l(949),ce=l(88543),Je=l(92307),ue=l(2124),ne=l(74508),se=l(66384),le=l(74978),Pe=l(54240);const ze=["documento"],we=["comentarios"],Fe=["tipoTarefa"];class F extends I.F{constructor(o){super(o,ce.l,Ue.n),this.injector=o,this.modalWidth=800,this.validate=(t,a)=>{let i=null;return["descricao"].includes(a)&&!t.value?.length&&(i="Obrigat\xf3rio"),i},this.formValidation=t=>{const a=t.value;return a.tipo_tarefa_id?.length&&!this.tipoTarefa?.selectedEntity?"Aguarde o carregamento "+this.lex.translate("tipo de tarefa")+". Caso demore, selecione novamente!":a.concluido&&this.tipoTarefa?.selectedEntity?.documental&&this.documento?.isEmpty()?this.gb.isEmbedded?"Obrigat\xf3rio selecionar um arquivo para a tarefa selecionada!":"Utilize o sistema como extens\xe3o para concluir!":void 0},this.tipoTarefaDao=o.get(Qe.J),this.tipoDocumentoDao=o.get(z.Q),this.tipoProcessoDao=o.get(Y.n),this.allPages=o.get(j.T),this.comentario=o.get(ue.K),this.title=this.lex.translate("Tarefa da atividade"),this.form=this.fh.FormBuilder({descricao:{default:""},tipo_tarefa_id:{default:null},tempo_estimado:{default:0},concluido:{default:!0},id_processo:{default:0},numero_processo:{default:""},documento:{default:null},comentarios:{default:[]}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();const o=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action="comentar"==o?o:this.action}loadData(o,t){var a=this;return(0,h.Z)(function*(){let i=Object.assign({},t.value);i=a.util.fillForm(i,o),yield a.tipoTarefa?.loadSearch(o.tipo_tarefa||i.tipo_tarefa_id),i.comentarios=a.comentario.orderComentarios(i.comentarios||[]),t.patchValue(i)})()}initializeData(o){var t=this;return(0,h.Z)(function*(){t.entity=t.metadata.tarefa,t.atividade=t.metadata.atividade,t.sei=t.metadata.sei,yield t.loadData(t.entity,o)})()}saveData(o){var t=this;return(0,h.Z)(function*(){return t.comentarios?.confirm(),t.util.fillForm(t.entity,t.form.value),t.entity.tipo_tarefa=t.tipoTarefa?.selectedEntity,t.entity.data_conclusao=t.form.controls.concluido.value&&!t.entity.data_conclusao?t.auth.hora:t.entity.data_conclusao,new Je.R(t.entity)})()}onTipoTarefaSelect(o){const t=o.entity;this.form.controls.tempo_estimado.setValue(t?.tempo_estimado||0)}static#e=this.\u0275fac=function(t){return new(t||F)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:F,selectors:[["app-atividade-form-tarefa"]],viewQuery:function(t,a){if(1&t&&(e.Gf(T.Q,5),e.Gf(ze,5),e.Gf(we,5),e.Gf(Fe,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.documento=i.first),e.iGM(i=e.CRH())&&(a.comentarios=i.first),e.iGM(i=e.CRH())&&(a.tipoTarefa=i.first)}},features:[e.qOj],decls:15,vars:16,consts:[["initialFocus","descricao",3,"form","disabled","submit","cancel"],["display","","right","",3,"title"],["key","TAREFA",3,"label"],[1,"row"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","tipo_tarefa_id",3,"label","size","control","dao","select"],["tipoTarefa",""],["label","Conclu\xeddo","controlName","concluido","labelInfo","Se foi conclu\xedda",3,"size","control"],[3,"sei","documento"],["documento",""],["key","COMENTARIOS","label","Comentarios"],["clss","row"],["origem","ATIVIDADE_TAREFA",3,"control"],["comentarios",""]],template:function(t,a){1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"tabs",1)(2,"tab",2)(3,"div",3),e._UZ(4,"input-textarea",4),e.qZA(),e.TgZ(5,"div",3)(6,"input-search",5,6),e.NdJ("select",function(n){return a.onTipoTarefaSelect(n)}),e.qZA(),e._UZ(8,"input-switch",7),e.qZA(),e._UZ(9,"documento-link",8,9),e.qZA(),e.TgZ(11,"tab",10)(12,"div",11),e._UZ(13,"comentarios",12,13),e.qZA()()()()),2&t&&(e.Q6J("form",a.form)("disabled",a.formDisabled),e.xp6(1),e.Q6J("title",a.isModal?"":a.title),e.xp6(1),e.Q6J("label",a.lex.translate("Tarefa da Atividade")),e.xp6(2),e.Q6J("size",12)("rows",2)("control",a.form.controls.descricao),e.xp6(2),e.Q6J("label",a.lex.translate("Tipo de Tarefa"))("size",10)("control",a.form.controls.tipo_tarefa_id)("dao",a.tipoTarefaDao),e.xp6(2),e.Q6J("size",2)("control",a.form.controls.concluido),e.xp6(1),e.Q6J("sei",a.sei)("documento",a.form.controls.documento.value),e.xp6(4),e.Q6J("control",a.form.controls.comentarios))},dependencies:[T.Q,q.a,D.V,ne.Q,se.n,le.i,Pe.y,E],styles:['@charset "UTF-8";.comentario-table[_ngcontent-%COMP%]{width:100%}.comentario-user[_ngcontent-%COMP%]{width:50px;vertical-align:top;padding:8px}.comentario-container[_ngcontent-%COMP%]{padding-left:10px;width:auto;border-left:var(--bs-gray-400) 2px solid;position:relative}.comentario-user-indicator[_ngcontent-%COMP%]{content:"";position:absolute;width:0px;height:0px;top:0;left:-12px;border-top:.75rem solid var(--bs-gray-400);border-left:.75rem solid transparent;border-bottom:none;border-right:none}.comentario-level[_ngcontent-%COMP%]{color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:" \\2022  "}']})}var pe=l(35255),me=l(87744);const Me=["usuario"],Se=["planoTrabalho"],Ve=["planejado"],Re=function(){return["planos_trabalho.tipo_modalidade:id,nome","planos_trabalho.entregas.entrega:id,nome"]};class W extends I.F{get labelInfoSuspender(){const o=this.iniciadas.length>1?this.lex.translate("tarefas"):this.lex.translate("tarefa"),t=1==this.iniciadas.length?"":"s",a=1==this.iniciadas.length?"":" "+this.iniciadas.length.toString();return this.iniciadas.length?`Suspender a${t}${a} ${o} j\xe1 iniciada${t}?`:"N\xe3o h\xe1 outras atividades iniciadas pelo usu\xe1rio!"}constructor(o){super(o,r.a,Z.P),this.injector=o,this.modalWidth=600,this.iniciadas=[],this.planoTrabalhoSelecionado=null,this.planosTrabalhos=[],this.planosTrabalhosEntregas=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.validate=(t,a)=>{let i=null;return(["usuario_id","plano_trabalho_id","plano_trabalho_entrega_id"].includes(a)&&!t.value?.length||"data_inicio"==a&&!t.value)&&(i="Obrigat\xf3rio"),i},this.formValidation=t=>{let a;return this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_inicio.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_inicio.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(a="Data de in\xedcio fora do per\xedodo do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xe9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_6]"),a},this.usuarioDao=o.get(pe.q),this.planoTrabalhoDao=o.get(me.t),this.calendar=o.get(P.o),this.form=this.fh.FormBuilder({usuario_id:{default:void 0},plano_trabalho_id:{default:void 0},plano_trabalho_entrega_id:{default:void 0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},carga_horaria:{default:0},tempo_planejado:{default:0},esforco:{default:0},data_inicio:{default:null},suspender:{default:!1}},this.cdRef,this.validate),this.join=["unidade","atividade","usuario.planos_trabalho.tipo_modalidade"]}loadIniciadas(o){this.iniciadas=[],o?.length&&this.dao.iniciadas(o).then(t=>{this.iniciadas=t,this.cdRef.detectChanges()})}onUsuarioSelect(o){const a=o.entity?.planos_trabalho||[];this.planosTrabalhos=a.filter(i=>i.unidade_id==this.entity.unidade_id).map(i=>({key:i.id,value:(i.tipo_modalidade?.nome||"")+" - "+this.dao.getDateFormatted(i.data_inicio)+" \xe0 "+this.dao.getDateFormatted(i.data_fim),data:i})),this.cdRef.detectChanges(),!this.form.controls.plano_trabalho_id.value?.length&&1==this.planosTrabalhos.length&&this.form.controls.plano_trabalho_id.setValue(this.planosTrabalhos[0].key),this.cdRef.detectChanges()}onPlanoChange(o){var t=this;(0,h.Z)(function*(){if(t.entity&&t.planoTrabalho?.selectedItem?.data){const a=t.planoTrabalho?.selectedItem?.data;t.planoTrabalhoSelecionado?.id!=a.id&&(t.planoTrabalhoSelecionado=yield t.planoTrabalhoDao.getById(a.id,t.planoTrabalhoJoin));const i=a?.carga_horaria||t.calendar.expedienteMedio(t.entity.unidade),n=t.calendar.horasUteis(t.form.controls.data_distribuicao.value,t.form.controls.data_estipulada_entrega.value,i,t.entity.unidade,"DISTRIBUICAO");t.form.controls.carga_horaria.setValue(i),t.form.controls.tempo_planejado.setValue(n),t.form.controls.esforco.setValue(t.form.controls.esforco.value||t.entity?.tipo_atividade?.esforco||0);const p=t.form.controls.plano_trabalho_entrega_id.value;t.planosTrabalhosEntregas=t.planoTrabalhoSelecionado?.entregas?.map(_=>Object.assign({},{key:_.id,value:_.descricao+(_.plano_entrega_entrega?" ("+_.plano_entrega_entrega?.descricao+")":""),data:_}))||[],t.cdRef.detectChanges(),t.form.controls.plano_trabalho_entrega_id.setValue(!p?.length&&t.planosTrabalhos.length>0?t.planosTrabalhos[0].key:p)}})()}loadData(o,t){var a=this;return(0,h.Z)(function*(){let i=Object.assign({},t.value);i=a.util.fillForm(i,o),i.usuario_id?.length||(i.usuario_id=a.auth.usuario?.id),i.data_inicio=i.data_inicio||a.util.setStrTime(new Date,a.auth.unidadeHora),yield a.usuario.loadSearch(o.usuario||i.usuario_id),a.loadIniciadas(i.usuario_id),o.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(o.unidade_id)),t.patchValue(i),a.onPlanoChange(new Event("change"))})()}initializeData(o){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getById(t.urlParams.get("id"),t.join),yield t.loadData(t.entity,o)})()}saveData(o){return new Promise((t,a)=>{let i=this.util.fill(new r.a,this.entity);i=this.util.fillForm(i,this.form.value),i.id=this.entity.id,i.suspender=this.form.controls.suspender.value,this.dao.iniciar(i).then(n=>t(n)).catch(a)})}static#e=this.\u0275fac=function(t){return new(t||W)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:W,selectors:[["app-atividade-form-iniciar"]],viewQuery:function(t,a){if(1&t&&(e.Gf(T.Q,5),e.Gf(Me,5),e.Gf(Se,5),e.Gf(Ve,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.usuario=i.first),e.iGM(i=e.CRH())&&(a.planoTrabalho=i.first),e.iGM(i=e.CRH())&&(a.planejado=i.first)}},features:[e.qOj],decls:17,vars:28,consts:[["initialFocus","data_distribuicao",3,"form","disabled","submit","cancel"],[1,"row"],["controlName","data_distribuicao","disabled","","labelInfo","Data de cadastro da atividade",3,"size","label","control"],["controlName","data_estipulada_entrega","disabled","","labelInfo","Data estipulada para entrega da atividade",3,"size","label","control"],["label","Respons\xe1vel","controlName","usuario_id","labelInfo","Respons\xe1vel por executar a atividade","required","",3,"size","dao","join","select"],["usuario",""],["controlName","plano_trabalho_id","required","",3,"label","size","control","items","labelInfo","change"],["planoTrabalho",""],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["entrega",""],["label","Inicio","controlName","data_inicio","labelInfo","Data em que o usu\xe1rio iniciou a atividade","required","",3,"size","control"],["label","Suspender as demais","controlName","suspender",3,"size","control","disabled","labelInfo"]],template:function(t,a){1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2)(3,"input-datetime",3),e.qZA(),e._UZ(4,"separator"),e.TgZ(5,"div",1)(6,"input-search",4,5),e.NdJ("select",function(n){return a.onUsuarioSelect(n)}),e.qZA()(),e.TgZ(8,"div",1)(9,"input-select",6,7),e.NdJ("change",function(n){return a.onPlanoChange(n)}),e.qZA(),e._UZ(11,"input-select",8,9),e.qZA(),e._UZ(13,"separator"),e.TgZ(14,"div",1),e._UZ(15,"input-datetime",10)(16,"input-switch",11),e.qZA()()),2&t&&(e.Q6J("form",a.form)("disabled",a.formDisabled),e.xp6(2),e.Q6J("size",6)("label",a.lex.translate("Data de distribui\xe7\xe3o"))("control",a.form.controls.data_distribuicao),e.xp6(1),e.Q6J("size",6)("label",a.lex.translate("Prazo de entrega"))("control",a.form.controls.data_estipulada_entrega),e.xp6(3),e.Q6J("size",12)("dao",a.usuarioDao)("join",e.DdM(27,Re)),e.xp6(3),e.Q6J("label",a.lex.translate("Plano de trabalho"))("size",7)("control",a.form.controls.plano_trabalho_id)("items",a.planosTrabalhos)("labelInfo",a.lex.translate("Plano de trabalho")),e.xp6(2),e.Q6J("label",a.lex.translate("Entrega do plano"))("size",5)("control",a.form.controls.plano_trabalho_entrega_id)("items",a.planosTrabalhosEntregas)("labelInfo",a.lex.translate("Entrega")+" do "+a.lex.translate("plano de trabalho")+" que a "+a.lex.translate("atividade")+" \xe9 referente"),e.xp6(4),e.Q6J("size",6)("control",a.form.controls.data_inicio),e.xp6(1),e.Q6J("size",6)("control",a.form.controls.suspender)("disabled",a.iniciadas.length?void 0:"")("labelInfo",a.labelInfoSuspender))},dependencies:[T.Q,q.a,D.V,O.k,k.p,x.N]})}var Le=l(50933);function Ge(s,o){1&s&&e._UZ(0,"top-alert",5)}function Be(s,o){if(1&s&&(e.TgZ(0,"div",3),e._UZ(1,"input-datetime",6),e.qZA()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",12)("control",t.form.controls.data_inicio)}}class X extends I.F{constructor(o){super(o,r.a,Z.P),this.injector=o,this.reiniciar=!1,this.modalWidth=400,this.validate=(t,a)=>{let i=null,n=this.entity?.pausas?.find(p=>!p.data_fim);return"data"==a&&(this.reiniciar&&!n?i="N\xe3o \xe1 pausa!":this.util.isDataValid(t.value)?n&&this.entity&&t.value.getTime()<this.entity.data_inicio.getTime()&&(i="Menor que in\xedcio!"):i="Obrigat\xf3rio"),i},this.form=this.fh.FormBuilder({data_inicio:{default:void 0},data:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){this.reiniciar=!!this.queryParams?.reiniciar,this.title=this.reiniciar?"Reiniciar":"Suspender",super.ngAfterViewInit()}loadData(o,t){var a=this;return(0,h.Z)(function*(){let i=a.entity?.pausas?.find(p=>!p.data_fim);a.reiniciar&&!i&&a.error("N\xe3o h\xe1 pausa ativa para ser reiniciada.");let n={inicio:a.reiniciar?i?.data_inicio:void 0,data:a.util.setStrTime(new Date,a.auth.unidadeHora)};o.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(o.unidade_id)),t.patchValue(n)})()}initializeData(o){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getAtividade(t.urlParams.get("id")),yield t.loadData(t.entity,o)})()}saveData(o){return new Promise((t,a)=>{let i={atividade_id:this.entity.id,data:this.form.controls.data.value};this.reiniciar?this.dao.reiniciar(i).then(n=>t(n)).catch(a):this.dao.pausar(i).then(n=>t(n)).catch(a)})}static#e=this.\u0275fac=function(t){return new(t||X)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:X,selectors:[["app-atividade-form-pausar"]],viewQuery:function(t,a){if(1&t&&e.Gf(T.Q,5),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first)}},features:[e.qOj],decls:5,vars:8,consts:[["type","warning","message","Dica: N\xe3o \xe9 necess\xe1rio suspender a tarefa entre as jornadas de trabalho!",4,"ngIf"],["initialFocus","data",3,"form","disabled","submit","cancel"],["class","row",4,"ngIf"],[1,"row"],["controlName","data","required","",3,"size","label","control","labelInfo"],["type","warning","message","Dica: N\xe3o \xe9 necess\xe1rio suspender a tarefa entre as jornadas de trabalho!"],["label","In\xedcio da pausa","controlName","data_inicio","disabled","","labelInfo","Data de in\xedcio da \xfaltima pausa",3,"size","control"]],template:function(t,a){1&t&&(e.YNc(0,Ge,1,0,"top-alert",0),e.TgZ(1,"editable-form",1),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.YNc(2,Be,2,2,"div",2),e.TgZ(3,"div",3),e._UZ(4,"input-datetime",4),e.qZA()()),2&t&&(e.Q6J("ngIf",!a.reiniciar),e.xp6(1),e.Q6J("form",a.form)("disabled",a.formDisabled),e.xp6(1),e.Q6J("ngIf",a.reiniciar),e.xp6(2),e.Q6J("size",12)("label",a.reiniciar?"Data de rein\xedcio":"Data da pausa")("control",a.form.controls.data)("labelInfo",a.reiniciar?"Data e hora do rein\xedcio da atividade":"Data e hora do in\xedcio da pausa/suspens\xe3o"))},dependencies:[b.O5,T.Q,O.k,Le.o]})}class $ extends I.F{constructor(o){super(o,r.a,Z.P),this.injector=o,this.modalWidth=400,this.validate=(t,a)=>{let i=null;return"data_estipulada_entrega"==a&&(this.util.isDataValid(t.value)?this.entity?.data_distribuicao&&t.value.getTime()<this.entity.data_distribuicao.getTime()&&(i="Menor que distribui\xe7\xe3o!"):i="Obrigat\xf3rio"),i},this.form=this.fh.FormBuilder({data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date}},this.cdRef,this.validate)}loadData(o,t){var a=this;return(0,h.Z)(function*(){let i={data_distribuicao:o.data_distribuicao,data_estipulada_entrega:o.data_estipulada_entrega};o.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(o.unidade_id)),t.patchValue(i)})()}initializeData(o){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getAtividade(t.urlParams.get("id")),yield t.loadData(t.entity,o)})()}saveData(o){return new Promise((t,a)=>{let i={id:this.entity.id,data_estipulada_entrega:this.form.controls.data_estipulada_entrega.value};this.dao.prorrogar(i).then(n=>t(n)).catch(a)})}static#e=this.\u0275fac=function(t){return new(t||$)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:$,selectors:[["app-atividade-form-prorrogar"]],viewQuery:function(t,a){if(1&t&&e.Gf(T.Q,5),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first)}},features:[e.qOj],decls:5,vars:7,consts:[["initialFocus","data_estipulada_entrega",3,"form","disabled","submit","cancel"],[1,"row"],["label","Data da distribui\xe7\xe3o","controlName","data_distribuicao","disabled","","labelInfo","Data de distribui\xe7\xe3o da atividade",3,"size","control"],["controlName","data_estipulada_entrega","labelInfo","Prazo para entrega da atividade","required","",3,"size","label","control"]],template:function(t,a){1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2),e.qZA(),e.TgZ(3,"div",1),e._UZ(4,"input-datetime",3),e.qZA()()),2&t&&(e.Q6J("form",a.form)("disabled",a.formDisabled),e.xp6(2),e.Q6J("size",12)("control",a.form.controls.data_distribuicao),e.xp6(2),e.Q6J("size",12)("label",a.lex.translate("Prazo de entrega"))("control",a.form.controls.data_estipulada_entrega))},dependencies:[T.Q,O.k]})}var He=l(81214),Ye=l(57338),je=l(20609);const Ke=["etiqueta"],We=["tipoAtividade"],Xe=["planoTrabalho"],$e=["unidade"],et=["usuario"],tt=["comentarios"],at=["requisicao"];function it(s,o){if(1&s&&e._UZ(0,"input-switch",22),2&s){const t=e.oxw();e.Q6J("size",1)("disabled",t.form.controls.concluido.value?"true":void 0)}}function ot(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"input-switch",23),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onConcluidoChange(i))}),e.qZA()}2&s&&e.Q6J("size",1)}function nt(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",5)(1,"input-datetime",24),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onDataDistribuicaoChange(i))}),e.qZA(),e._UZ(2,"input-number",25),e.TgZ(3,"input-datetime",26),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onPrazoEntregaChange(i))}),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.xp6(1),e.Q6J("size",4)("decimals",2),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)}}function st(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"div",5)(1,"input-datetime",24),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onDataDistribuicaoChange(i))}),e.qZA(),e._UZ(2,"input-timer",27)(3,"input-number",25),e.TgZ(4,"input-datetime",26),e.NdJ("change",function(i){e.CHM(t);const n=e.oxw();return e.KtG(n.onPrazoEntregaChange(i))}),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Esfor\xe7o"))("control",t.form.controls.esforco),e.xp6(1),e.Q6J("size",3)("decimals",2),e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)}}function lt(s,o){if(1&s&&(e.TgZ(0,"div",5),e._UZ(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-datetime",33),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_entrega),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio)}}function rt(s,o){if(1&s&&(e.TgZ(0,"div",5),e._UZ(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-timer",34)(4,"input-datetime",33),e.qZA()),2&s){const t=e.oxw(2);e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_entrega),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.tempo_despendido),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio)}}function dt(s,o){if(1&s&&(e.TgZ(0,"separator",28),e.YNc(1,lt,4,6,"div",19),e.YNc(2,rt,5,8,"ng-template",null,29,e.W1O),e._UZ(4,"documento-link",30),e.qZA()),2&s){const t=e.MAs(3),a=e.oxw(),i=e.MAs(18);e.xp6(1),e.Q6J("ngIf",!(null!=i&&null!=i.selectedItem&&null!=i.selectedItem.data&&null!=i.selectedItem.data.tipo_modalidade&&i.selectedItem.data.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",t),e.xp6(3),e.Q6J("documento",a.form.controls.documento_entrega.value)}}class N extends I.F{constructor(o){super(o,r.a,Z.P),this.injector=o,this.etiquetas=[],this.checklist=[],this.planosTrabalhos=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.planoTrabalhoSelecionado=null,this.usuarioJoin=["planos_trabalho.entregas.plano_entrega_entrega:id,descricao","planos_trabalho.tipo_modalidade:id,nome"],this.entregas=[],this.validateChecklist=(a,i)=>null,this.validate=(a,i)=>{let n=null;if(["unidade_id","descricao"].includes(i)&&!a?.value?.length)n="Obrigat\xf3rio";else if("tipo_atividade_id"!=i||a?.value?.length||this.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO"))if(["data_distribuicao","data_estipulada_entrega"].includes(i)){let p=this.form?.controls.data_estipulada_entrega?.value,_=this.form?.controls.data_distribuicao?.value;this.util.isDataValid(a.value)?"data_distribuicao"==i&&a.value&&this.util.isDataValid(p)&&a.value.getTime()>p.getTime()?n="Maior que entrega":"data_estipulada_entrega"==i&&a.value&&this.util.isDataValid(_)&&a.value.getTime()<_.getTime()&&(n="Menor que distribui\xe7\xe3o"):n="Data inv\xe1lida"}else"plano_trabalho_id"==i&&!a.value?.length&&this.form?.controls?.usuario_id.value?.length?n="Obrigat\xf3rio":"plano_trabalho_entrega_id"==i&&(this.form?.controls?.plano_trabalho_id.value?.length&&!a.value?.length?n="Obrigat\xf3rio":a.value?.length&&!this.entregas.find(p=>p.key==a.value)&&(n="Selecione"));else n="Obrigat\xf3rio";return n},this.formValidation=a=>{let i;if(this.loadEtiquetas(),this.form.controls.tipo_atividade_id.value){let A=this.tipoAtividade?.selectedEntity.checklist;A&&this.form.controls.checklist.value.length==A.length&&this.loadChecklist()}const n=this.etiquetas.map(A=>A.key),p=this.checklist.map(A=>A.id),_=(this.form.controls.etiquetas.value||[]).find(A=>!n.includes(A.key)),V=(this.form.controls.checklist.value||[]).find(A=>!p.includes(A.id)&&A.checked);return _&&(i="Etiqueta "+_.value+"n\xe3o pode ser utilizada!"),V&&(i="Checklist "+V.texto+"n\xe3o pode ser utilizado!"),this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_distribuicao.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_estipulada_entrega.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(i="A atividade dever\xe1 ter per\xeddo compat\xedvel com o do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xe9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_5]"),i};const t=this.auth.hora;this.tipoAtividadeDao=o.get(G.Y),this.unidadeDao=o.get(He.J),this.usuarioDao=o.get(pe.q),this.planoTrabalhoDao=o.get(me.t),this.atividadeService=o.get(Ye.s),this.unidadeService=o.get(je.Z),this.calendar=o.get(P.o),this.comentario=o.get(ue.K),this.title="Inclus\xe3o de "+this.lex.translate("Atividade"),this.form=this.fh.FormBuilder({numero:{default:0},descricao:{default:""},data_distribuicao:{default:t},carga_horaria:{default:0},tempo_planejado:{default:0},data_estipulada_entrega:{default:t},data_inicio:{default:null},data_entrega:{default:null},esforco:{default:0},tempo_despendido:{default:0},data_arquivamento:{default:null},etiquetas:{default:[]},checklist:{default:[]},prioridade:{default:0},progresso:{default:0},plano_trabalho_id:{default:null},plano_trabalho_entrega_id:{default:null},tipo_atividade_id:{default:null},demandante_id:{default:""},usuario_id:{default:null},unidade_id:{default:""},documento_requisicao_id:{default:null},documento_entrega_id:{default:null},comentarios:{default:[]},pausas:{default:[]},etiqueta:{default:""},tarefas:{default:[]},iniciado:{default:!1},concluido:{default:!1},documento_requisicao:{default:void 0},documento_entrega:{default:void 0}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef,this.validateChecklist),this.join=["usuario.planos_trabalho.tipo_modalidade:id,nome","pausas","tipo_atividade","unidade","comentarios.usuario","tarefas.tipo_tarefa","tarefas.comentarios.usuario","documento_requisicao","documento_entrega"]}ngOnInit(){super.ngOnInit();const o=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["comentar","clonar"].includes(o)?o:this.action}get isClonar(){return"clonar"==this.action}get titleAtividade(){return this.form?.controls.numero?.value?"#"+this.form?.controls.numero?.value:""}addItemHandleEtiquetas(){let o;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,a=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,a)&&(o={key:a,value:t.value,color:t.color,icon:t.icon},this.form.controls.etiqueta.setValue(""))}return o}onUnidadeChange(o){this.loadEtiquetas()}onDataDistribuicaoChange(o){this.loadUsuario(this.usuario?.selectedEntity),this.form?.controls.data_estipulada_entrega.updateValueAndValidity()}onPrazoEntregaChange(o){this.form?.controls.data_distribuicao.updateValueAndValidity()}onPlanoTrabalhoChange(o){var t=this;(0,h.Z)(function*(){if(t.entity){const a=t.usuario?.selectedEntity?.planos_trabalho?.find(i=>i.id==t.form.controls.plano_trabalho_id.value);if(a){if(t.planoTrabalhoSelecionado?.id!=a.id&&(t.planoTrabalhoSelecionado=yield t.planoTrabalhoDao.getById(a.id,t.planoTrabalhoJoin)),t.form.controls.unidade_id.value!=a.unidade_id){const n=yield t.unidadeDao.getById(a.unidade_id);n&&(yield t.unidade?.loadSearch(n),yield t.auth.selecionaUnidade(n.id))}const i=t.form.controls.plano_trabalho_entrega_id.value;t.entregas=t.planoTrabalhoSelecionado?.entregas?.map(n=>Object.assign({},{key:n.id,value:n.descricao+(n.plano_entrega_entrega?" ("+n.plano_entrega_entrega?.descricao+")":""),data:n}))||[],t.cdRef.detectChanges(),t.form.controls.plano_trabalho_entrega_id.setValue(!i?.length&&t.entregas.length>0?t.entregas[0].key:i)}else t.entregas=[],t.form.controls.plano_trabalho_entrega_id.setValue(null)}})()}loadEtiquetas(){this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade?.selectedEntity,this.tipoAtividade?.selectedEntity)}loadChecklist(){const o=this.tipoAtividade?.selectedEntity;let t=o.checklist?.map(a=>({id:a.key,texto:a.value,checked:!1}));this.checklist=t||[],this.form.controls.checklist.setValue(t),this.atividadeService.buildChecklist(o,this.form.controls.checklist)}loadTipoAtividade(o){o?(this.loadEtiquetas(),this.loadChecklist()):(this.etiquetas=[],this.form.controls.esforco.setValue(0),this.form.controls.tempo_planejado.setValue(0)),this.cdRef.detectChanges()}getPlanosTrabalhos(o,t,a){return o.planos_trabalho?.filter(i=>i.id==a||this.util.between(t,{start:i.data_inicio,end:i.data_fim})&&"ATIVO"==i.status).map(i=>Object.assign({key:i.id,value:(i.tipo_modalidade?.nome||"")+" - "+this.usuarioDao.getDateFormatted(i.data_inicio)+" a "+this.usuarioDao.getDateFormatted(i.data_fim),data:i}))||[]}loadUsuario(o){if(o){const t=this.form.controls.plano_trabalho_id.value,a=this.form.controls.data_distribuicao.value||new Date;this.planosTrabalhos=this.getPlanosTrabalhos(o,a,t),this.hasUsuarioActionNew&&this.auth.usuario.id==this.form.controls.usuario_id.value&&this.form.controls.iniciado.setValue(!0),this.cdRef.detectChanges(),this.form.controls.plano_trabalho_id.setValue(!t?.length&&this.planosTrabalhos.length>0?this.planosTrabalhos[0].key:t)}else this.planosTrabalhos=[],this.form.controls.plano_trabalho_id.setValue(null);this.cdRef.detectChanges()}get hasUsuarioActionNew(){return this.form?.controls.usuario_id?.value?.length&&"new"==this.action}onTipoAtividadeSelect(o){const t=o.entity;this.loadTipoAtividade(t),this.atividadeService.comentarioAtividade(t,this.form.controls.comentarios),this.cdRef.detectChanges()}onTipoAtividadeChange(o){this.form?.controls.tipo_atividade_id.value?.length||this.loadTipoAtividade(void 0)}onUsuarioSelect(o){const t=o.entity;this.loadUsuario(t)}onUsuarioChange(o){this.form?.controls.usuario_id.value?.length||this.loadUsuario(void 0)}onConcluidoChange(o){this.hasUsuarioActionNew&&this.form.controls.concluido.value?(this.form.controls.iniciado.setValue(!0),this.form.controls.progresso.setValue(100)):this.form.controls.progresso.setValue(0)}orderPausas(o){return o.sort((t,a)=>t.data_inicio<a.data_inicio?-1:1)}loadData(o,t){var a=this;return(0,h.Z)(function*(){let i=Object.assign({},t.value);i=a.util.fillForm(i,o),a.planoTrabalhoSelecionado=o.plano_trabalho,yield Promise.all([a.unidade?.loadSearch(o.unidade||i.unidade_id,!1),a.usuario?.loadSearch(o.usuario||i.usuario_id,!1),a.tipoAtividade?.loadSearch(o.tipo_atividade||i.tipo_atividade_id,!1)]),t.patchValue(i,{emitEvent:!1}),o.usuario&&a.loadUsuario(o.usuario),o.tipo_atividade&&a.loadTipoAtividade(o.tipo_atividade),o.unidade_id!=a.auth.unidade.id&&(yield a.auth.selecionaUnidade(o.unidade_id)),o.comentarios=a.comentario.orderComentarios(o.comentarios||[]),o.pausas=a.orderPausas(o.pausas||[]),t.patchValue(a.util.fillForm(i,a.form.value)),a.loadEtiquetas()})()}initializeData(o){var t=this;return(0,h.Z)(function*(){if(t.isClonar){const a=yield t.dao.getAtividade(t.urlParams.get("id"));t.entity=new r.a,Object.assign(t.entity,{tipo_atividade:a.tipo_atividade,unidade:a.unidade,usuario:a.usuario,plano_trabalho:a.plano_trabalho,descricao:a.descricao,data_distribuicao:a.data_distribuicao,tempo_planejado:a.tempo_planejado,carga_horaria:a.carga_horaria,data_estipulada_entrega:a.data_estipulada_entrega,esforco:a.esforco,tipo_atividade_id:a.tipo_atividade_id,demandante_id:t.auth.usuario?.id,usuario_id:a.usuario_id,unidade_id:a.unidade_id,plano_trabalho_id:a.plano_trabalho_id,etiquetas:a.etiquetas,checklist:a.checklist,metadados:a.metadados,plano_trabalho_entrega_id:a.plano_trabalho_entrega_id,progresso:a.progresso,tarefas:(a.tarefas||[]).map(i=>new ce.l(Object.assign({},i,{id:t.dao.generateUuid(),comentarios:[],_status:"ADD"}))),documento_requisicao:a.documento_requisicao?Object.assign({},new U.U(Object.assign({},a.documento_requisicao,{id:t.dao.generateUuid(),_status:"ADD"}))):void 0,documento_entrega:a.documento_entrega?Object.assign({},new U.U(Object.assign({},a.documento_entrega,{id:t.dao.generateUuid(),_status:"ADD"}))):void 0})}else if(t.sei=t.metadata?.sei,t.entity=new r.a,t.entity.data_distribuicao=t.auth.hora,t.entity.data_estipulada_entrega=t.entity.data_distribuicao,t.entity.demandante_id=t.auth.usuario?.id||"",t.entity.unidade_id=t.auth.unidade?.id||"",t.entity.unidade=t.auth.unidade,t.entity.metadados={atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!1,concluido:!1,avaliado:!1,arquivado:!1,produtividade:0,consolidacoes:[]},!t.unidadeService.isGestorUnidade(t.entity.unidade_id)){let a=yield t.usuarioDao.getById(t.auth.usuario.id,t.usuarioJoin);t.entity.usuario_id=a?.id||null,t.entity.usuario=a||void 0}yield t.loadData(t.entity,o)})()}saveData(o){return new Promise((t,a)=>{let i=this.util.fill(new r.a,this.entity);if(this.comentarios?.confirm(),i=this.util.fillForm(i,this.form.value),this.hasUsuarioActionNew&&this.form.controls.iniciado.value&&(i.data_inicio=i.data_distribuicao,i.status="INICIADO",this.form.controls.concluido.value)){let n=this.calendar.calculaDataTempoUnidade(i.data_inicio,i.data_estipulada_entrega,this.planoTrabalhoSelecionado.carga_horaria,this.unidade?.selectedEntity,"ENTREGA");i.data_entrega=i.data_estipulada_entrega,i.progresso=100,i.tempo_despendido=n?.tempoUtil||0,i.status="CONCLUIDO"}i.documento_requisicao=this.requisicao?.documento,i.comentarios=i.comentarios.filter(n=>["ADD","EDIT","DELETE"].includes(n._status||"")&&n.texto?.length),i.tarefas=i.tarefas.filter(n=>(n.comentarios=n.comentarios.filter(p=>["ADD","EDIT","DELETE"].includes(p._status||"")&&p.texto?.length),["ADD","EDIT","DELETE"].includes(n._status||""))),t(i)})}static#e=this.\u0275fac=function(t){return new(t||N)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:N,selectors:[["app-atividade-form"]],viewQuery:function(t,a){if(1&t&&(e.Gf(T.Q,5),e.Gf(Ke,5),e.Gf(We,5),e.Gf(Xe,5),e.Gf($e,5),e.Gf(et,5),e.Gf(tt,5),e.Gf(at,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.editableForm=i.first),e.iGM(i=e.CRH())&&(a.etiqueta=i.first),e.iGM(i=e.CRH())&&(a.tipoAtividade=i.first),e.iGM(i=e.CRH())&&(a.planoTrabalho=i.first),e.iGM(i=e.CRH())&&(a.unidade=i.first),e.iGM(i=e.CRH())&&(a.usuario=i.first),e.iGM(i=e.CRH())&&(a.comentarios=i.first),e.iGM(i=e.CRH())&&(a.requisicao=i.first)}},features:[e.qOj],decls:26,vars:38,consts:[["initialFocus","descricao",3,"form","disabled","submit","cancel"],["display","","right","",3,"title"],["key","ATIVIDADE",3,"label"],[3,"sei","documento"],["requisicao",""],[1,"row"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","unidade_id","required","",3,"label","size","dao","change"],["unidade",""],["controlName","tipo_atividade_id",3,"label","emptyValue","size","dao","labelInfo","required","select","change"],["tipoAtividade",""],["label","Iniciado","controlName","iniciado",3,"size","disabled",4,"ngIf"],["label","Conclu\xeddo","controlName","concluido",3,"size","change",4,"ngIf"],["controlName","usuario_id","labelInfo","Participante respons\xe1vel pela execu\xe7\xe3o",3,"label","size","emptyValue","dao","join","select","change"],["usuario",""],["controlName","plano_trabalho_id",3,"label","size","control","items","labelInfo","change"],["planoTrabalho",""],["controlName","plano_trabalho_entrega_id",3,"label","size","control","items","labelInfo"],["entrega",""],["class","row",4,"ngIf","ngIfElse"],["comEsforco",""],["title","Conclus\xe3o",4,"ngIf"],["label","Iniciado","controlName","iniciado",3,"size","disabled"],["label","Conclu\xeddo","controlName","concluido",3,"size","change"],["noIcon","","controlName","data_distribuicao","labelInfo","Data de inclus\xe3o/distribui\xe7\xe3o/lan\xe7amento",3,"size","label","control","change"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega","labelInfo","Data estipulada para entrega da atividade",3,"size","label","control","change"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xe7\xe3o",3,"size","label","control"],["title","Conclus\xe3o"],["comTempoDespendido",""],[3,"documento"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","","labelInfo","Data em que o usu\xe1rio iniciou a atividade",3,"size","control"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega","disabled","","labelInfo","Data da conclus\xe3o da atividade",3,"size","control"],["label","Data de arquivamento","controlName","data_arquivamento","disabled","","labelInfo","Data de arquivamento da atividade",3,"size","control"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","","labelInfo","Calculado no fim da atividade, sendo o tempo l\xedquido (considerando pausas)",3,"size","control"]],template:function(t,a){if(1&t&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),e.TgZ(1,"tabs",1)(2,"tab",2),e._UZ(3,"documento-link",3,4),e.TgZ(5,"div",5),e._UZ(6,"input-textarea",6),e.qZA(),e.TgZ(7,"div",5)(8,"input-search",7,8),e.NdJ("change",function(n){return a.onUnidadeChange(n)}),e.qZA(),e.TgZ(10,"input-search",9,10),e.NdJ("select",function(n){return a.onTipoAtividadeSelect(n)})("change",function(n){return a.onTipoAtividadeChange(n)}),e.qZA(),e.YNc(12,it,1,2,"input-switch",11),e.YNc(13,ot,1,1,"input-switch",12),e.qZA(),e.TgZ(14,"div",5)(15,"input-search",13,14),e.NdJ("select",function(n){return a.onUsuarioSelect(n)})("change",function(n){return a.onUsuarioChange(n)}),e.qZA(),e.TgZ(17,"input-select",15,16),e.NdJ("change",function(n){return a.onPlanoTrabalhoChange(n)}),e.qZA()(),e.TgZ(19,"div",5),e._UZ(20,"input-select",17,18),e.qZA(),e.YNc(22,nt,4,8,"div",19),e.YNc(23,st,5,11,"ng-template",null,20,e.W1O),e.YNc(25,dt,5,3,"separator",21),e.qZA()()()),2&t){const i=e.MAs(18),n=e.MAs(24);e.Q6J("form",a.form)("disabled",a.formDisabled),e.xp6(1),e.Q6J("title",a.titleAtividade),e.xp6(1),e.Q6J("label",a.lex.translate("Atividade")),e.xp6(1),e.Q6J("sei",a.sei)("documento",a.form.controls.documento_requisicao.value),e.xp6(3),e.Q6J("size",12)("rows",2)("control",a.form.controls.descricao),e.xp6(2),e.Q6J("label",a.lex.translate("Unidade"))("size",a.hasUsuarioActionNew?5:6)("dao",a.unidadeDao),e.xp6(2),e.Q6J("label","Tipo de "+a.lex.translate("atividade"))("emptyValue",null)("size",a.hasUsuarioActionNew?5:6)("dao",a.tipoAtividadeDao)("labelInfo",a.lex.translate("Tipo de atividade")+" utilizado para classificar a atividade")("required",a.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true"),e.xp6(2),e.Q6J("ngIf",a.hasUsuarioActionNew),e.xp6(1),e.Q6J("ngIf",a.hasUsuarioActionNew),e.xp6(2),e.Q6J("label",a.lex.translate("Respons\xe1vel"))("size",6)("emptyValue",null)("dao",a.usuarioDao)("join",a.usuarioJoin),e.xp6(2),e.Q6J("label",a.lex.translate("Plano de trabalho"))("size",6)("control",a.form.controls.plano_trabalho_id)("items",a.planosTrabalhos)("labelInfo",a.lex.translate("Plano de trabalho")),e.xp6(3),e.Q6J("label",a.lex.translate("Entrega")+" (Descri\xe7\xe3o dos trabalhos)")("size",12)("control",a.form.controls.plano_trabalho_entrega_id)("items",a.entregas)("labelInfo",a.lex.translate("Entrega")+a.lex.translate(" plano de trabalho")+" que a "+a.lex.translate("atividade")+" \xe9 referente"),e.xp6(2),e.Q6J("ngIf",!(null!=i&&null!=i.selectedItem&&null!=i.selectedItem.data&&null!=i.selectedItem.data.tipo_modalidade&&i.selectedItem.data.tipo_modalidade.atividade_esforco))("ngIfElse",n),e.xp6(3),e.Q6J("ngIf",a.form.controls.data_entrega.value)}},dependencies:[b.O5,T.Q,q.a,D.V,ne.Q,O.k,k.p,B.u,se.n,le.i,x.N,w.l,E]})}var re=l(48644),_e=l(17112);function ct(s,o){if(1&s&&e._UZ(0,"atividade-list-grid",6),2&s){const t=e.oxw();e.Q6J("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)("minhas",!t.eGestor)}}function ut(s,o){if(1&s&&e._UZ(0,"atividade-list-kanban",6),2&s){const t=e.oxw();e.Q6J("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)("minhas",!t.eGestor)}}function pt(s,o){if(1&s&&e._UZ(0,"atividade-dashboard",9),2&s){const t=e.oxw(2);e.Q6J("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)}}function mt(s,o){if(1&s&&(e.TgZ(0,"tab",7),e.YNc(1,pt,1,1,"ng-template",null,8,e.W1O),e.qZA()),2&s){const t=e.MAs(2);e.Q6J("template",t)}}class M extends _e._{constructor(o){super(o),this.injector=o,this.activeTab="TABELA",this.eGestor=this.auth.unidadeGestor(),this.title=this.lex.translate("Atividades"),this.code="MOD_DMD"}ngOnInit(){super.ngOnInit(),this.activeTab=this.usuarioConfig.active_tab||"TABELA"}onSelectTab(o){var t=this;return(0,h.Z)(function*(){t.activeTab=o.key,t.viewInit&&t.saveUsuarioConfig({active_tab:t.activeTab})})()}static#e=this.\u0275fac=function(t){return new(t||M)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:M,selectors:[["app-atividade-list"]],features:[e.qOj],decls:8,vars:6,consts:[["right","",3,"title","select","active"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["grid",""],["key","KANBAN","icon","bi bi-card-heading","label","Quadro",3,"template"],["kanban",""],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template",4,"ngIf"],[3,"snapshot","minhas"],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template"],["dashboard",""],[3,"snapshot"]],template:function(t,a){if(1&t&&(e.TgZ(0,"tabs",0)(1,"tab",1),e.YNc(2,ct,1,2,"ng-template",null,2,e.W1O),e.qZA(),e.TgZ(4,"tab",3),e.YNc(5,ut,1,2,"ng-template",null,4,e.W1O),e.qZA(),e.YNc(7,mt,3,1,"tab",5),e.qZA()),2&t){const i=e.MAs(3),n=e.MAs(6);e.Q6J("title",a.isModal?"":a.title)("select",a.onSelectTab.bind(a))("active",a.activeTab),e.xp6(1),e.Q6J("template",i),e.xp6(3),e.Q6J("template",n),e.xp6(3),e.Q6J("ngIf",!1)}}})}var _t=l(77447),de=l(95489),fe=l(69756),ft=l(19108);function ht(s,o){if(1&s&&e._UZ(0,"planejamento-show",10),2&s){const t=e.oxw(2);e.Q6J("planejamento",t.atividade.planejamento)}}function gt(s,o){if(1&s&&(e.TgZ(0,"div",11)(1,"h6"),e._uU(2,"Cadeia de valor:"),e.qZA(),e.TgZ(3,"h4"),e._uU(4),e.qZA()()),2&s){const t=e.oxw(2);e.xp6(4),e.Oqu(t.atividade.cadeiaValor.nome)}}function bt(s,o){1&s&&(e.ynx(0),e._UZ(1,"i",15),e.BQk())}const he=function(){return[]};function vt(s,o){if(1&s&&(e.TgZ(0,"div")(1,"div",14),e.YNc(2,bt,2,0,"ng-container",13),e.TgZ(3,"h5"),e._uU(4),e.qZA()()()),2&s){const t=o.$implicit,a=o.index;e.xp6(2),e.Q6J("ngForOf",e.DdM(2,he).constructor(a)),e.xp6(2),e.Oqu(t.nome)}}function Ct(s,o){if(1&s&&(e.TgZ(0,"div",12)(1,"h6"),e._uU(2,"Objetivos:"),e.qZA(),e.YNc(3,vt,5,3,"div",13),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.atividade.objetivos)}}function Tt(s,o){if(1&s&&(e.TgZ(0,"div")(1,"h5"),e._uU(2),e.qZA()()),2&s){const t=o.$implicit;e.xp6(2),e.Oqu(t.nome)}}function At(s,o){if(1&s&&(e.TgZ(0,"div",16)(1,"h6"),e._uU(2,"Processos:"),e.qZA(),e.YNc(3,Tt,3,1,"div",13),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.atividade.processos)}}function Dt(s,o){1&s&&(e.ynx(0),e._UZ(1,"i",15),e.BQk())}function Et(s,o){if(1&s&&(e.TgZ(0,"div")(1,"div",14),e.YNc(2,Dt,2,0,"ng-container",13),e.TgZ(3,"div",18)(4,"h5",8),e._uU(5),e.qZA(),e.TgZ(6,"div",19)(7,"span",20)(8,"b",21),e._uU(9,"Meta:"),e.qZA(),e._UZ(10,"badge",22),e.qZA(),e.TgZ(11,"span",23)(12,"b",21),e._uU(13,"Realizado:"),e.qZA(),e._UZ(14,"badge",24),e.qZA(),e.TgZ(15,"span",25)(16,"b",26),e._uU(17,"Progresso:"),e.qZA(),e._UZ(18,"progress-bar",27),e.qZA()()()(),e._UZ(19,"hr"),e.qZA()),2&s){const t=o.$implicit,a=o.index,i=e.oxw(3);e.xp6(2),e.Q6J("ngForOf",e.DdM(6,he).constructor(a)),e.xp6(3),e.hij(" ",t.descricao," "),e.xp6(5),e.Q6J("label",i.planoEntregaService.getValorMeta(t)),e.xp6(4),e.Q6J("label",i.planoEntregaService.getValorRealizado(t)),e.xp6(4),e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}function yt(s,o){if(1&s&&(e.TgZ(0,"div",17)(1,"h6"),e._uU(2,"Entrega do plano de entregas:"),e.qZA(),e.YNc(3,Et,20,7,"div",13),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.atividade.entregasPlanoEntrega)}}function It(s,o){if(1&s&&(e.ynx(0),e.TgZ(1,"div",1),e.YNc(2,ht,1,1,"planejamento-show",2),e.YNc(3,gt,5,1,"div",3),e.qZA(),e.TgZ(4,"div",1),e.YNc(5,Ct,4,1,"div",4),e.YNc(6,At,4,1,"div",5),e.qZA(),e.YNc(7,yt,4,1,"div",6),e.TgZ(8,"div",7)(9,"h6"),e._uU(10,"Aloca\xe7\xe3o:"),e.qZA(),e.TgZ(11,"h5",8),e._uU(12),e.qZA(),e.TgZ(13,"p"),e._uU(14,"For\xe7a de trabalho: "),e.TgZ(15,"b"),e._uU(16),e.qZA()()(),e.TgZ(17,"div",9)(18,"h6"),e._uU(19,"Atividade:"),e.qZA(),e.TgZ(20,"h5",8),e._uU(21),e.qZA(),e.TgZ(22,"p"),e._uU(23,"Data estipulada para entrega: "),e.TgZ(24,"b"),e._uU(25),e.qZA()()(),e.BQk()),2&s){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.atividade.planejamento),e.xp6(1),e.Q6J("ngIf",t.atividade.cadeiaValor),e.xp6(2),e.Q6J("ngIf",t.atividade.objetivos),e.xp6(1),e.Q6J("ngIf",null==t.atividade.processos?null:t.atividade.processos.length),e.xp6(1),e.Q6J("ngIf",t.atividade.entregasPlanoEntrega),e.xp6(5),e.Oqu(t.atividade.entregaPlanoTrabalho.descricao),e.xp6(4),e.hij("",t.atividade.entregaPlanoTrabalho.forca_trabalho,"%"),e.xp6(5),e.Oqu(t.atividade.atividade.descricao),e.xp6(4),e.Oqu(t.util.getDateTimeFormatted(t.atividade.atividade.data_estipulada_entrega))}}class ee extends _e._{constructor(o){super(o),this.injector=o,this.atividadeDao=o.get(Z.P),this.planoEntregaService=o.get(_t.f)}ngOnInit(){super.ngOnInit(),this.urlParams.get("id")&&this.loadAtividade(this.urlParams.get("id"))}loadAtividade(o){var t=this;return(0,h.Z)(function*(){const a=yield t.atividadeDao.getHierarquia(o);a&&(t.atividade=a)})()}static#e=this.\u0275fac=function(t){return new(t||ee)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:ee,selectors:[["atividade-hierarquia"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex","align-items-stretch"],[3,"planejamento",4,"ngIf"],["class","cadeiaValor arrow_box first-box w-100 ms-3",4,"ngIf"],["class","objetivos arrow_box w-100",4,"ngIf"],["class","procesos arrow_box w-100 ms-3",4,"ngIf"],["class","plano_entrega_entrega arrow_box",4,"ngIf"],[1,"plano_trabalho_entrega","arrow_box"],[1,"mb-2"],[1,"atividade","arrow_box"],[3,"planejamento"],[1,"cadeiaValor","arrow_box","first-box","w-100","ms-3"],[1,"objetivos","arrow_box","w-100"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"bi","bi-chevron-right"],[1,"procesos","arrow_box","w-100","ms-3"],[1,"plano_entrega_entrega","arrow_box"],[1,"ms-3","flex-grow-1","d-flex","flex-column"],[1,"d-flex","justify-content-start","align-items-center","m-0"],[1,"text-center"],[1,"d-block"],["icon","bi bi-graph-up-arrow","color","light",3,"label"],[1,"text-center","ms-3"],["icon","bi bi-check-lg","color","light",3,"label"],[1,"ms-3","flex-fill"],[1,""],["color","success",3,"value","goal"]],template:function(t,a){1&t&&e.YNc(0,It,26,9,"ng-container",0),2&t&&e.Q6J("ngIf",a.atividade)},dependencies:[b.sg,b.O5,de.F,fe.R,ft.W],styles:["h6[_ngcontent-%COMP%]{border-bottom:1px solid rgba(194,225,245,.14);padding-bottom:5px;color:var(--bs-body-color)}h5[_ngcontent-%COMP%]{color:var(--bs-body-color);font-weight:300;margin:0}"]})}const Zt=[{path:"",component:M,canActivate:[v.a],resolve:{config:C.o},data:{title:"Atividades"}},{path:"grid",component:re.N,canActivate:[v.a],resolve:{config:C.o},data:{title:"Atividades"}},{path:"new",component:N,canActivate:[v.a],resolve:{config:C.o},data:{title:"",modal:!0}},{path:"tarefa",component:F,canActivate:[v.a],resolve:{config:C.o},data:{title:"Tarefa da Atividade",modal:!0}},{path:"tarefa/concluir",component:y.u,canActivate:[v.a],resolve:{config:C.o},data:{title:"Concluir Tarefa",modal:!0}},{path:"tarefa/:tarefa_id/comentar",component:F,canActivate:[v.a],resolve:{config:C.o},data:{title:"Coment\xe1rios",modal:!0}},{path:":id/edit",component:N,canActivate:[v.a],resolve:{config:C.o},data:{title:"Edi\xe7\xe3o da Atividade",modal:!0}},{path:":id/consult",component:N,canActivate:[v.a],resolve:{config:C.o},data:{title:"Consulta a Atividade",modal:!0}},{path:":id/clonar",component:N,canActivate:[v.a],resolve:{config:C.o},data:{title:"Clone de Atividade",modal:!0}},{path:":id/iniciar",component:W,canActivate:[v.a],resolve:{config:C.o},data:{title:"In\xedcio de Atividade",modal:!0}},{path:":id/concluir",component:K,canActivate:[v.a],resolve:{config:C.o},data:{title:"Conclus\xe3o de Atividade",modal:!0}},{path:":id/pausar",component:X,canActivate:[v.a],resolve:{config:C.o},data:{title:"Suspens\xe3o de Atividade",modal:!0}},{path:":id/prorrogar",component:$,canActivate:[v.a],resolve:{config:C.o},data:{title:"Prorroga\xe7\xe3o de Atividade",modal:!0}},{path:":id/comentar",component:N,canActivate:[v.a],resolve:{config:C.o},data:{title:"Coment\xe1rios de Atividade",modal:!0}},{path:":id/hierarquia",component:ee,canActivate:[v.a],resolve:{config:C.o},data:{title:"Hierarquia da Atividade",modal:!0}}];class te{static#e=this.\u0275fac=function(t){return new(t||te)};static#t=this.\u0275mod=e.oAB({type:te});static#a=this.\u0275inj=e.cJS({imports:[L.Bz.forChild(Zt),L.Bz]})}var qt=l(58568),Ot=l(32864),ge=l(94180);const xt=["filterRef"],Nt=["kanbanEtiquetas"],kt=["dockerNaoIniciado"],Qt=["dockerPausado"],Ut=["dockerIniciado"],Jt=["dockerConcluido"],Pt=["planoEntrega"],zt=["planoEntregaEntrega"];function wt(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"badge",35),e.NdJ("click",function(){e.CHM(t);const i=e.oxw().card,n=e.oxw();return e.KtG(n.onEntregaClick(i.data))}),e.qZA()}if(2&s){const t=e.oxw().card,a=e.oxw();e.Q6J("icon",a.entityService.getIcon("Entrega"))("label",t.data.plano_trabalho_entrega.descricao)}}function Ft(s,o){if(1&s&&(e.TgZ(0,"div"),e._UZ(1,"profile-picture",36),e.qZA()),2&s){const t=e.oxw().card;e.xp6(1),e.Q6J("url",t.data.usuario.url_foto)("hint","Respons\xe1vel: "+((null==t.data.usuario?null:t.data.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio"))}}function Mt(s,o){if(1&s&&e._UZ(0,"badge",44),2&s){const t=o.$implicit,a=e.oxw(3);e.Q6J("color",t.color)("label",t.label)("icon",t.icon)("data",t)("click",t.data.filter?a.onStatusClick.bind(a):void 0)}}function St(s,o){if(1&s&&e._UZ(0,"badge",44),2&s){const t=o.$implicit,a=e.oxw(3);e.Q6J("color",t.color)("label",t.value)("icon",t.icon)("data",t)("click",a.onEtiquetaClick.bind(a))}}function Vt(s,o){1&s&&e._UZ(0,"separator",45)}function Rt(s,o){1&s&&e._UZ(0,"i",49)}function Lt(s,o){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,Rt,1,0,"i",47),e.qZA(),e.TgZ(3,"td",48),e._uU(4),e.qZA()()),2&s){const t=o.$implicit;e.xp6(2),e.Q6J("ngIf",t.checked),e.xp6(2),e.Oqu(t.texto)}}function Gt(s,o){if(1&s&&(e.TgZ(0,"table"),e.YNc(1,Lt,5,2,"tr",46),e.qZA()),2&s){const t=e.oxw(2).card;e.xp6(1),e.Q6J("ngForOf",t.data.checklist)}}function Bt(s,o){if(1&s&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&s){const t=o.$implicit;e.xp6(1),e.Oqu(t.descricao)}}function Ht(s,o){if(1&s&&(e.TgZ(0,"separator",50),e.YNc(1,Bt,2,1,"small",46),e.qZA()),2&s){const t=e.oxw(2).card;e.Q6J("title","Tarefas ("+(null==t.data.tarefas?null:t.data.tarefas.length)+")")("collapsed",!0),e.xp6(1),e.Q6J("ngForOf",t.data.tarefas)}}function Yt(s,o){if(1&s&&(e.ynx(0),e.TgZ(1,"div",37),e._UZ(2,"documentos-badge",38),e.YNc(3,Mt,1,5,"badge",39),e.YNc(4,St,1,5,"badge",39),e.qZA(),e.YNc(5,Vt,1,0,"separator",40),e.YNc(6,Gt,2,1,"table",34),e._UZ(7,"reaction",41),e.YNc(8,Ht,2,3,"separator",42),e._UZ(9,"comentarios-widget",43),e.BQk()),2&s){const t=e.oxw().card,a=e.oxw();e.xp6(2),e.Q6J("documento",t.data.documento_requisicao),e.xp6(1),e.Q6J("ngForOf",a.atividadeService.getStatus(t.data)),e.xp6(1),e.Q6J("ngForOf",t.data.etiquetas),e.xp6(1),e.Q6J("ngIf",null==t.data.checklist?null:t.data.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.data.checklist?null:t.data.checklist.length),e.xp6(1),e.Q6J("entity",t.data),e.xp6(1),e.Q6J("ngIf",null==t.data.tarefas?null:t.data.tarefas.length),e.xp6(1),e.Q6J("entity",t.data)("selectable",!1)("query",a.query)}}function jt(s,o){if(1&s&&(e.YNc(0,wt,1,2,"badge",25),e.TgZ(1,"div",26)(2,"div",27)(3,"div",28)(4,"span",29),e._uU(5),e.qZA(),e.TgZ(6,"span",29),e._UZ(7,"i",30),e._uU(8),e.qZA(),e.TgZ(9,"span",31),e._UZ(10,"i"),e._uU(11),e.qZA()(),e.TgZ(12,"span",32),e._UZ(13,"i",33),e._uU(14),e.qZA()(),e.YNc(15,Ft,2,2,"div",34),e.qZA(),e.YNc(16,Yt,10,10,"ng-container",34)),2&s){const t=o.card,a=e.oxw();e.Q6J("ngIf",t.data.plano_trabalho_entrega),e.xp6(5),e.hij(" #",t.data.numero," "),e.xp6(3),e.hij(" ",t.data.unidade.sigla," "),e.xp6(1),e.MGl("title","Respons\xe1vel: ",(null==t.data.usuario?null:t.data.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio",""),e.xp6(1),e.Tol("bi "+(null!=t.data.usuario&&null!=t.data.usuario.nome&&t.data.usuario.nome.length?"bi-person-check":"bi-person-x")),e.xp6(1),e.hij(" ",a.util.apelidoOuNome(t.data.usuario,!0)||"(N\xe3o atribu\xeddo)"," "),e.xp6(1),e.MGl("title","Demandante: ",(null==t.data.demandante?null:t.data.demandante.nome)||"Desconhecido",""),e.xp6(2),e.hij(" ",a.util.apelidoOuNome(t.data.demandante,!0)||"Desconhecido"," "),e.xp6(1),e.Q6J("ngIf",t.data.usuario),e.xp6(1),e.Q6J("ngIf",!(null!=a.filter&&null!=a.filter.controls&&null!=a.filter.controls.resumido&&a.filter.controls.resumido.value))}}function Kt(s,o){if(1&s&&e._UZ(0,"input-select",51),2&s){const t=e.oxw();e.Q6J("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetasEdit)}}function Wt(s,o){1&s&&(e.TgZ(0,"div",52)(1,"div",26)(2,"div",27)(3,"h5",53),e._UZ(4,"span",54),e.qZA()(),e.TgZ(5,"div",55)(6,"button",56),e._UZ(7,"i",57),e.qZA()()(),e.TgZ(8,"h6",58),e._UZ(9,"span",59),e.qZA(),e.TgZ(10,"p",60),e._UZ(11,"span",61)(12,"span",62)(13,"span",62)(14,"span",54)(15,"span",59),e.qZA()())}function Xt(s,o){if(1&s&&(e.TgZ(0,"kanban",63)(1,"swimlane"),e._UZ(2,"docker",64,65),e.qZA(),e.TgZ(4,"swimlane"),e._UZ(5,"docker",66,67)(7,"docker",68,69),e.qZA(),e.TgZ(9,"swimlane"),e._UZ(10,"docker",70,71),e.qZA()()),2&s){const t=e.oxw(),a=e.MAs(22),i=e.MAs(26);e.Q6J("template",a)("placeholderTemplate",i)("loading",t.loading)("dragSwimlanes",!1),e.xp6(2),e.Q6J("collapse",t.cardsConfig.naoIniciado)("toggle",t.onDockerCollapse.bind(t))("menu",t.menuDockerNaoIniciado)("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.NAOINICIADO]))("cards",t.cards[t.NAOINICIADO]),e.xp6(3),e.Q6J("collapse",t.cardsConfig.iniciado)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.INICIADO]))("cards",t.cards[t.INICIADO]),e.xp6(2),e.Q6J("collapse",t.cardsConfig.pausado)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.PAUSADO]))("cards",t.cards[t.PAUSADO]),e.xp6(3),e.Q6J("collapse",t.cardsConfig.concluido)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.CONCLUIDO]))("cards",t.cards[t.CONCLUIDO])}}function $t(s,o){if(1&s&&e._UZ(0,"kanban",72,73),2&s){const t=e.oxw(),a=e.MAs(22),i=e.MAs(26),n=e.MAs(24);e.Q6J("dockers",t.labels)("template",a)("placeholderTemplate",i)("loading",t.loading)("swimlaneDrop",t.onSwimlaneDrop.bind(t))("dockerDragged",t.onDragged.bind(t))("dockerDrop",t.onDrop.bind(t))("dockerEditTemplate",n)("dockerToggle",t.onDockerCollapse.bind(t))("dockerEdit",t.editEtiquetas.bind(t))("dockerSave",t.saveEtiquetas.bind(t))("dockerDelete",t.deleteEtiquetas.bind(t))("dockerCancel",t.cancelEtiquetas.bind(t))("dockerColorStyle",t.getLabelStyle)}}class S extends ge.x{constructor(o){var t,a;super(o),t=this,this.injector=o,this.minhas=!1,this.TITLE_OUTRAS="Outras",this.NAOINICIADO=0,this.PAUSADO=1,this.INICIADO=2,this.CONCLUIDO=3,this.AVALIADO=4,this.DOCKERS=["NAOINICIADO","PAUSADO","INICIADO","CONCLUIDO"],this.cards=[[],[],[],[]],this.cardsConfig={naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},this.labels=[],this.cardsVersion=0,this.dragDrop={},this.rowsLimit=500,this.kanbanQueryOptions={},this.etiquetasEdit=[],this.planosEntregas=[],this.planosEntregasEntregas=[],this.toolbarButtons=[{icon:"bi bi-search",label:"Filtrar",onClick:()=>this.filterRef?.toggle()},{icon:"bi bi-plus-circle",color:"btn-outline-success",label:"Incluir",onClick:(a=(0,h.Z)(function*(){return yield t.add()}),function(){return a.apply(this,arguments)})}],this.outrasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.etiquetasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.menuDockerNaoIniciado=[{icon:"bi bi-plus-circle",color:"btn-outline-primary",hint:"Incluir",onClick:function(){var a=(0,h.Z)(function*(){return yield t.add()});return function(){return a.apply(this,arguments)}}()}],this.filterWhere=a=>{let i=this.fixedFilter||[],n=a.value;return n.somente_unidade_atual&&n.unidade_id!=this.auth.unidade?.id&&(a.controls.unidade_id.setValue(this.auth.unidade?.id),n.unidade_id=this.auth.unidade?.id),n.atribuidas_para_mim&&n.usuario_id!=this.auth.usuario?.id&&(a.controls.usuario_id.setValue(this.auth.usuario?.id),n.usuario_id=this.auth.usuario.id),n.usuario_id?.length&&i.push(["usuario_id","==",n.usuario_id]),n.unidade_id?.length&&i.push(["unidade_id","==",n.unidade_id]),n.unidades_subordinadas&&i.push(["unidades_subordinadas","==",!0]),n.etiquetas?.length&&i.push(["etiquetas","in",n.etiquetas.map(p=>p.value)]),n.numero_processo?.length&&i.push(["numero_processo","==",n.numero_processo]),n.status?.length&&!i.find(p=>"status"==p[0])&&i.push(["status","==",n.status]),n.plano_entrega_id?.length&&i.push(["plano_entrega_id","==",n.plano_entrega_id]),n.plano_entrega_entrega_id?.length&&i.push(["plano_entrega_entrega_id","==",n.plano_entrega_entrega_id]),i.push(["data_arquivamento","==",null]),i},this.code="MOD_DMD",this.filter=this.fh.FormBuilder({atribuidas_para_mim:{default:this.minhas},usuario_id:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},unidade_id:{default:""},numero_processo:{default:""},status:{default:""},usarEtiquetas:{default:!!this.usuarioConfig?.kanban_usar_etiquetas},resumido:{default:!!this.usuarioConfig?.kanban_resumido},etiquetas:{default:[]},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({etiqueta:{default:null}}),this.cardsConfig=Object.assign(this.cardsConfig,this.usuarioConfig?.kanban_status_dockers),this.groupBy=[],this.loadEtiquetas(),this.loadLabel()}defaultUsuarioConfig(){return Object.assign(super.defaultUsuarioConfig(),{active_tab:"TABELA",kanban_resumido:!1,kanban_usar_etiquetas:!1,kanban_status_dockers:{naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},kanban_etiquetas_dockers:[]})}ngAfterViewInit(){super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.query.onLoadingChange=o=>{this.loading=o,this.cdRef.detectChanges()},this.loading=this.query.loading,this.query.subject.asObservable().subscribe(this.onQueryLoad.bind(this)),this.cdRef.detectChanges()}isOutras(o){return o.title==this.TITLE_OUTRAS&&!o.labels.length}loadLabel(){const o=[...this.usuarioConfig?.kanban_etiquetas_dockers||[]];o.find(this.isOutras.bind(this))||o.splice(0,0,{title:this.TITLE_OUTRAS,labels:[],collapse:!1}),this.labels=o.reduce((t,a)=>(t.find(i=>i.title?.length&&i.title==a.title||i.labels?.length&&a.labels?.length&&i.labels[0].key==a.labels[0].key)||t.push({labels:this.isOutras(a)?[]:a.labels,title:a.title,menu:this.isOutras(a)?this.outrasButtons:this.etiquetasButtons,cards:[],editing:!1,collapse:a.collapse}),t),[])}get isEtiquetas(){return!!this.filter?.controls?.usarEtiquetas?.value}onUsarEtiquetasChange(o){this.saveUsuarioConfig({kanban_usar_etiquetas:this.filter.controls.usarEtiquetas.value}),this.query&&this.onQueryLoad(this.query.rows)}incluirLista(o){this.labels.splice(o.key+1,0,{labels:[],menu:this.etiquetasButtons,cards:[],editing:!0,collapse:!1}),this.kanbanEtiquetas?.refreshDoubleScrollbar(),this.cdRef.detectChanges()}onResumidoChange(o){this.saveUsuarioConfig({kanban_resumido:this.filter.controls.resumido.value}),this.cdRef.detectChanges()}loadEtiquetas(){this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(o,t)=>o.key==t.key)}getLabelStyle(o){return`border-color: ${1==o.labels.length&&o.labels[0].color||"#000000"} !important;`}onDockerCollapse(o,t){this.isEtiquetas?(this.labels[o.key].collapse=t,this.saveEtiquetasUsuarioConfig()):(this.cardsConfig={naoIniciado:!!this.dockerNaoIniciado?.collapse,pausado:!!this.dockerPausado?.collapse,iniciado:!!this.dockerIniciado?.collapse,concluido:!!this.dockerConcluido?.collapse},this.saveUsuarioConfig({kanban_status_dockers:this.cardsConfig})),this.kanbanEtiquetas?.refreshDoubleScrollbar()}editEtiquetas(o){var t=this;return(0,h.Z)(function*(){const a=t.labels[o.key],i=t.labels.reduce((n,p,_)=>(p.labels.length&&_!=o.key&&n.push(p.labels[0].key),n),[]);t.etiquetasEdit=t.etiquetas.filter(n=>!i.includes(n.key)),t.formEdit.controls.etiqueta.setValue(a.labels.length?a.labels[0].key:null)})()}saveEtiquetasUsuarioConfig(){const o=this.labels.reduce((t,a)=>(t.find(i=>i.title?.length&&i.title==a.title||i.labels?.length&&a.labels?.length&&i.labels[0].key==a.labels[0].key)||t.push({title:a.title,labels:a.labels,collapse:a.collapse}),t),[]);this.saveUsuarioConfig({kanban_etiquetas_dockers:o})}saveEtiquetas(o){var t=this;return(0,h.Z)(function*(){const a=t.formEdit.controls.etiqueta.value;if(a?.length){const i=t.labels[o.key],n=t.etiquetasEdit.find(p=>p.key==a);return n&&(i.labels=[n]),t.query&&t.onQueryLoad(t.query.rows),t.saveEtiquetasUsuarioConfig(),!0}return!1})()}cancelEtiquetas(o){var t=this;return(0,h.Z)(function*(){t.labels[o.key].labels?.length||(t.labels.splice(o.key,1),t.kanbanEtiquetas?.refreshDoubleScrollbar())})()}deleteEtiquetas(o){var t=this;return(0,h.Z)(function*(){t.labels.splice(o.key,1),t.kanbanEtiquetas?.refreshDoubleScrollbar(),t.query&&t.onQueryLoad(t.query.rows),t.saveEtiquetasUsuarioConfig()})()}getNomes(o){return Object.getOwnPropertyNames(o.filter.controls||{}).join(",")}modalRefreshId(o){return{modal:!0,modalClose:t=>{const a=this.dragDrop.destination,i=this.dragDrop.source;t&&(a&&i&&(a.list.splice(a.index,0,a.card),i.list.splice(i.index,1)),(this.grid?.query||this.query).refreshId(o.id)),this.dragDrop={}}}}mergeEtiqueta(o){this.etiquetas.find(t=>t.key==o.key)||this.etiquetas.push(o)}filterSubmit(o){return super.filterSubmit(o),this.cards=[[],[],[],[]],this.labels.forEach(t=>t.cards=[]),this.queryOptions}onQueryLoad(o){if(super.onGridLoad(o),this.cardsVersion++,this.filter?.controls?.usarEtiquetas?.value){const t=this.labels.findIndex(this.isOutras.bind(this));o?.forEach(a=>{let n,i=a;i.etiquetas=i.etiquetas||[];for(let p=0;p<i.etiquetas.length;p++){for(let _=1;_<this.labels.length&&!n;_++)this.labels[_].labels[0].key==i.etiquetas[p].key&&(n=this.labels[_]);this.etiquetas.some(_=>_.key==i.etiquetas[p].key)||this.etiquetas.push(i.etiquetas[p])}this.putCard(n?.cards||this.labels[t]?.cards||[],i)});for(let a of this.labels.map(i=>i.cards||[]))for(let i=0;i<a.length;a[i].version!=this.cardsVersion?a.splice(i,1):i++);}else{o?.forEach(t=>{const a=t;switch(this.lookup.ATIVIDADE_STATUS.find(n=>n.key==a.status)?.key||"INCLUIDO"){case"PAUSADO":this.putCard(this.cards[this.PAUSADO],a);break;case"INICIADO":this.putCard(this.cards[this.INICIADO],a);break;case"CONCLUIDO":this.putCard(this.cards[this.CONCLUIDO],a);break;default:this.putCard(this.cards[this.NAOINICIADO],a)}});for(let t of this.cards)for(let a=0;a<t.length;t[a].version!=this.cardsVersion?t.splice(a,1):a++);}this.cdRef.detectChanges()}putCard(o,t){const a=o.findIndex(n=>n.id==t.id),i={id:t.id,title:t.tipo_atividade?.nome||"("+this.lex.translate("Atividade")+" sem tipo de registro de execu\xe7\xe3o atribu\xeddo)",subTitle:t.descricao||"",data:t,version:this.cardsVersion,menu:void 0,dynamicMenu:this.dynamicCardMenu.bind(this)};a>=0?o[a]=Object.assign(o[a],i):o.push(i)}dynamicCardMenu(o){const t=this.atividadeService.dynamicButtons.bind(this)(o.data,this.optionsMetadata);return t.push({icon:"bi bi-three-dots",hint:"Op\xe7\xf5es",dynamicItems:this.cardDynamicOptions.bind(this)}),(!o.menu||o.menu.map(a=>a.hint).join()!=t.map(a=>a.hint).join())&&(o.menu=t),o.menu}cardDynamicOptions(o){const t=o.menu?.find(a=>"Op\xe7\xf5es"==a.hint);if(t){const a=this.atividadeService.dynamicOptions.bind(this)(o.data,this.optionsMetadata);(!t.items||t?.items.map(i=>i.label).join()!=a.map(i=>i.label).join())&&(t.items=a)}return t?.items}canDrop(o){let t=this;return a=>!!t.isEtiquetas||!!t.atividadeService.dynamicOptions.bind(t)(a.data,t.optionsMetadata).find(n=>n.id==o)}updateEtiquetasAtividade(o){const t=this.labels.find(n=>n.cards==o.source.list)?.labels[0],a=this.labels.find(n=>n.cards==o.destination.list)?.labels[0],i=o.destination.atividade;t&&a&&t.key==a.key||(t&&i.etiquetas.splice(i.etiquetas.findIndex(n=>n.key==t.key),1),a&&i.etiquetas.unshift(a),this.loading=!0,this.dao.update(i.id,{etiquetas:i.etiquetas}).then(n=>this.modalRefreshId(n).modalClose.bind(this)(n.id)).finally(()=>this.loading=!1))}onDragged(o,t,a){if(["copy","move"].includes(a)){const i=t.indexOf(o);this.dragDrop.source={list:t,index:i},this.isEtiquetas&&this.updateEtiquetasAtividade(this.dragDrop)}}onDrop(o,t){if(t&&["copy","move"].includes(o.dropEffect)){const a=o.data.data,i=o.data;let n=typeof o.index>"u"?t.length:o.index;if(this.dragDrop={destination:{list:t,index:n,card:i,atividade:a}},!this.isEtiquetas){const p=this.atividadeService.dynamicOptions.bind(this)(a,this.optionsMetadata),_=this.cards.indexOf(t);if(_>=0){const V=p.find(A=>A.id==this.DOCKERS[_]);V?.onClick&&V?.onClick(a)}}}}onStatusClick(o){this.filter?.controls.status.setValue(o.data?.status),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}onEtiquetaClick(o){let t=this.filter.controls.etiquetas.value;t.push(o),this.filter?.controls.etiquetas.setValue(t),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}filterClear(o){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(""),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(""),this.filter.controls.numero_processo.setValue(""),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(t=>"status"==t[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(o)}onSwimlaneDrop(o,t){const a=this.labels[t],i=t<o.index?o.index-1:o.index;this.labels.splice(t,1),this.labels.splice(i,0,a),this.saveEtiquetasUsuarioConfig()}onEntregaClick(o){this.go.navigate({route:["gestao","atividade",o.id,"hierarquia"]},{metadata:{atividade:o}})}onUnidadeChange(o){var t=this;return(0,h.Z)(function*(){let a=yield t.unidadeDao.getById(t.filter?.controls.unidade_id.value,["planos_entrega"]);t.planosEntregas=a?.planos_entrega?.map(i=>Object.assign({key:i.id,value:i.nome}))||[]})()}onPlanoEntregaChange(o){var t=this;return(0,h.Z)(function*(){let a=[];(yield t.unidadeDao.getById(t.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(n=>{n.id==t.filter.controls.plano_entrega_id.value&&a.push(n.entregas)}),t.planosEntregasEntregas=a[0].map(n=>Object.assign({key:n.id,value:n.descricao}))||[]})()}static#e=this.\u0275fac=function(t){return new(t||S)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:S,selectors:[["atividade-list-kanban"]],viewQuery:function(t,a){if(1&t&&(e.Gf(xt,5),e.Gf(Nt,5),e.Gf(kt,5),e.Gf(Qt,5),e.Gf(Ut,5),e.Gf(Jt,5),e.Gf(Pt,5),e.Gf(zt,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.filterRef=i.first),e.iGM(i=e.CRH())&&(a.kanbanEtiquetas=i.first),e.iGM(i=e.CRH())&&(a.dockerNaoIniciado=i.first),e.iGM(i=e.CRH())&&(a.dockerPausado=i.first),e.iGM(i=e.CRH())&&(a.dockerIniciado=i.first),e.iGM(i=e.CRH())&&(a.dockerConcluido=i.first),e.iGM(i=e.CRH())&&(a.planoEntrega=i.first),e.iGM(i=e.CRH())&&(a.planoEntregaEntrega=i.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.qOj],decls:29,vars:52,consts:[[3,"buttons"],["labelPosition","left","label","Resumido","controlName","resumido",3,"size","control","change"],["labelPosition","left","label","Usar etiquetas","controlName","usarEtiquetas",1,"me-2",3,"size","control","change"],[3,"deleted","form","where","query","submit","clear","collapseChange","collapsed"],["filterRef",""],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"size","control","change"],["controlName","usuario_id",3,"size","label","control","disabled","dao"],["usuario",""],["label","Atual","controlName","somente_unidade_atual","labelInfo","Somente as atividades da unidade selecionada",3,"size","control","change"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["controlName","unidade_id",3,"size","label","control","disabled","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"size","label","valueTodos","control","items","change"],["planoEntrega",""],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["planoEntregaEntrega",""],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["ticket",""],["editDocker",""],["placeholder",""],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes",4,"ngIf"],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"d-flex","w-100"],[1,"flex-fill"],[1,"text-nowrap"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-briefcase"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark",3,"title"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark","fw-light",3,"title"],[1,"bi","bi-cursor"],[4,"ngIf"],["color","info","role","button",3,"icon","label","click"],[3,"url","hint"],[1,"card-status-container"],[3,"documento"],["class","ms-1",3,"color","label","icon","data","click",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],["origem","ATIVIDADE",3,"entity"],["collapse","",3,"title","collapsed",4,"ngIf"],["origem","ATIVIDADE",3,"entity","selectable","query"],[1,"ms-1",3,"color","label","icon","data","click"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["collapse","",3,"title","collapsed"],["controlName","etiqueta",3,"size","control","items"],[1,"card-body"],[1,"card-title","placeholder-glow"],[1,"placeholder","col-6"],["role","group","aria-label","Basic outlined example",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","disabled","placeholder"],[1,"bi","bi-question"],[1,"card-subtitle","mb-2","text-muted","placeholder-glow"],[1,"placeholder","col-8"],[1,"card-text","placeholder-glow"],[1,"placeholder","col-7"],[1,"placeholder","col-4"],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes"],["icon","bi bi-hourglass-split","title","N\xe3o iniciado","color","border-warning",3,"collapse","toggle","menu","dragged","drop","dropIf","cards"],["dockerNaoIniciado",""],["icon","bi bi-play-circle","title","Iniciadas","color","border-info",3,"collapse","toggle","dragged","drop","dropIf","cards"],["dockerIniciado",""],["icon","bi bi-pause-circle","title","Pausadas","color","border-danger",3,"collapse","toggle","dragged","drop","dropIf","cards"],["dockerPausado",""],["icon","bi bi-check-circle","title","Conclu\xeddas","color","border-primary",3,"collapse","toggle","dragged","drop","dropIf","cards"],["dockerConcluido",""],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle"],["kanbanEtiquetas",""]],template:function(t,a){1&t&&(e.TgZ(0,"toolbar",0)(1,"input-switch",1),e.NdJ("change",function(n){return a.onResumidoChange(n)}),e.qZA(),e.TgZ(2,"input-switch",2),e.NdJ("change",function(n){return a.onUsarEtiquetasChange(n)}),e.qZA()(),e.TgZ(3,"filter",3,4)(5,"div",5)(6,"input-switch",6),e.NdJ("change",function(n){return a.onAtribuidasParaMimChange(n)}),e.qZA(),e._UZ(7,"input-search",7,8),e.TgZ(9,"input-switch",9),e.NdJ("change",function(n){return a.onSomenteUnidadeAtualChange(n)}),e.qZA(),e._UZ(10,"input-text",10)(11,"input-select",11),e.qZA(),e.TgZ(12,"div",5)(13,"input-search",12,13),e.NdJ("change",function(n){return a.onUnidadeChange(n)}),e.qZA(),e._UZ(15,"input-switch",14),e.TgZ(16,"input-select",15,16),e.NdJ("change",function(n){return a.onPlanoEntregaChange(n)}),e.qZA(),e._UZ(18,"input-select",17,18)(20,"input-multiselect",19),e.qZA()(),e.YNc(21,jt,17,11,"ng-template",null,20,e.W1O),e.YNc(23,Kt,1,3,"ng-template",null,21,e.W1O),e.YNc(25,Wt,16,0,"ng-template",null,22,e.W1O),e.YNc(27,Xt,12,29,"kanban",23),e.YNc(28,$t,2,14,"kanban",24)),2&t&&(e.Q6J("buttons",a.toolbarButtons),e.xp6(1),e.Q6J("size",2)("control",a.filter.controls.resumido),e.xp6(1),e.Q6J("size",2)("control",a.filter.controls.usarEtiquetas),e.xp6(1),e.Q6J("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",a.filter)("where",a.filterWhere)("query",a.query)("submit",a.filterSubmit.bind(a))("clear",a.filterClear.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",a.filterCollapsed),e.xp6(3),e.Q6J("size",1)("control",a.filter.controls.atribuidas_para_mim),e.xp6(1),e.Q6J("size",4)("label",a.lex.translate("Usu\xe1rio"))("control",a.filter.controls.usuario_id)("disabled",a.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",a.usuarioDao),e.xp6(2),e.Q6J("size",1)("control",a.filter.controls.somente_unidade_atual),e.xp6(1),e.Q6J("size",3)("label","N\xba "+a.lex.translate("Processo")+" (Sei)")("control",a.filter.controls.numero_processo),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("valueTodos",null)("disabled",null!=a.fixedFilter&&a.fixedFilter.length&&"status"==a.fixedFilter[0][0]?"true":void 0)("control",a.filter.controls.status)("items",a.lookup.ATIVIDADE_STATUS),e.xp6(2),e.Q6J("size",3)("label",a.lex.translate("Unidade"))("control",a.filter.controls.unidade_id)("disabled",a.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",a.unidadeDao),e.xp6(2),e.Q6J("size",1)("control",a.filter.controls.unidades_subordinadas),e.xp6(1),e.Q6J("size",3)("label",a.lex.translate("Plano de Entrega"))("valueTodos",null)("control",a.filter.controls.plano_entrega_id)("items",a.planosEntregas),e.xp6(2),e.Q6J("size",2)("label",a.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",a.filter.controls.plano_entrega_entrega_id)("items",a.planosEntregasEntregas),e.xp6(2),e.Q6J("size",3)("control",a.filter.controls.etiquetas),e.xp6(7),e.Q6J("ngIf",!a.isEtiquetas),e.xp6(1),e.Q6J("ngIf",a.isEtiquetas))},styles:[".comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:initial;white-space:normal}.comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{font-size:12px;height:auto;display:block;max-width:290px;white-space:initial}.atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}.comentario-badge[_ngcontent-%COMP%]{white-space:nowrap;display:block;background-color:#ffe69c!important;margin-bottom:1px;text-align:left}.comentario-badge[_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:none}.comentario-badge[_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{display:inline-block;max-width:290px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:12px}.docker-border[_ngcontent-%COMP%]{border-width:1px}.card-status-container[_ngcontent-%COMP%]{width:330px}"]})}var ea=l(38720),be=l(73150);const ta=["programa"],aa=["unidadesSubordinadas"];class ae extends ge.x{constructor(o){super(o),this.injector=o,this.validate=(t,a)=>null,this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.fh=this.injector.get(ea.k),this.cdRef=o.get(e.sBO),this.filter=this.fh.FormBuilder({programa_id:{default:""},unidadesSubordinadas:{default:!1}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit()}static#e=this.\u0275fac=function(t){return new(t||ae)(e.Y36(e.zs3))};static#t=this.\u0275cmp=e.Xpm({type:ae,selectors:[["atividade-dashboard"]],viewQuery:function(t,a){if(1&t&&(e.Gf(be.M,5),e.Gf(ta,5),e.Gf(aa,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.grid=i.first),e.iGM(i=e.CRH())&&(a.programa=i.first),e.iGM(i=e.CRH())&&(a.unidadesSubordinadas=i.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter"},features:[e.qOj],decls:0,vars:0,template:function(t,a){}})}var ia=l(75471),oa=l(57224),na=l(83351),ve=l(57765),Ce=l(45512),sa=l(42704),Te=l(17819),la=l(61915),Ae=l(64792),De=l(81419),Ee=l(72504),ra=l(58189),da=l(64502),ca=l(56152),ua=l(2729);class ie{static#e=this.\u0275fac=function(t){return new(t||ie)};static#t=this.\u0275mod=e.oAB({type:ie});static#a=this.\u0275inj=e.cJS({imports:[b.ez,te,qt.K,Ot.UteisModule,ia.lC]})}e.B6R(M,[b.O5,se.n,le.i,re.N,ae,S],[]),e.B6R(re.N,[b.sg,b.O5,be.M,oa.a,na.b,ve.z,Ce.n,sa.Q,q.a,D.V,c.m,ne.Q,O.k,k.p,Te.p,x.N,la.l,de.F,fe.R,w.l,Ae.C,H.Y,De.y,Ee.h,y.u],[]),e.B6R(S,[b.sg,b.O5,ve.z,Ce.n,q.a,D.V,c.m,k.p,Te.p,x.N,ra.C,da.x,ca.m,de.F,ua.q,Ae.C,De.y,Ee.h],[])}}]);
=======
"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[9013],{62095:(ze,W,r)=>{r.d(W,{u:()=>oe});var T,g=r(8239),X=r(72133),b=r(73150),C=r(949),h=r(79084),A=r(88543),y=r(17112),I=r(57338),d=r(20755),F=r(76733),z=r(57224),$=r(83351),Q=r(88820),e=r(81419),Z=r(72504);function q(m,c){if(1&m&&(d.TgZ(0,"strong",9),d._uU(1),d.qZA()),2&m){const l=d.oxw().row;d.xp6(1),d.Oqu((null==l.tipo_tarefa?null:l.tipo_tarefa.nome)||"")}}function x(m,c){if(1&m&&(d.YNc(0,q,2,1,"strong",8),d._uU(1)),2&m){const l=c.row;d.Q6J("ngIf",null==l.tipo_tarefa||null==l.tipo_tarefa.nome?null:l.tipo_tarefa.nome.length),d.xp6(1),d.hij(" ",l.descricao," ")}}function ee(m,c){if(1&m&&d._UZ(0,"documentos-badge",12),2&m){const l=c.row;d.Q6J("documento",l.documento)}}function O(m,c){if(1&m&&(d.TgZ(0,"column",10),d.YNc(1,ee,1,1,"ng-template",null,11,d.W1O),d.qZA()),2&m){const l=d.MAs(2);d.Q6J("template",l)}}function w(m,c){1&m&&d._UZ(0,"i",18)}function te(m,c){if(1&m&&(d.TgZ(0,"div",16),d.YNc(1,w,1,0,"i",17),d.qZA()),2&m){const l=c.row;d.xp6(1),d.Q6J("ngIf",l.data_conclusao)}}function ne(m,c){if(1&m&&d._UZ(0,"input-switch",19),2&m){const l=d.oxw(2);d.Q6J("size",12)("control",l.formEdit.controls.concluido)}}function ae(m,c){if(1&m&&(d.TgZ(0,"column",13),d.YNc(1,te,2,1,"ng-template",null,14,d.W1O),d.YNc(3,ne,1,2,"ng-template",null,15,d.W1O),d.qZA()),2&m){const l=d.MAs(2),p=d.MAs(4),_=d.oxw();d.Q6J("align","center")("template",l)("columnEditTemplate",p)("canEdit",_.canConcluidoEdit.bind(_))("edit",_.editable?_.onColumnConcluidoEdit.bind(_):void 0)("save",_.editable?_.onColumnConcluidoSave.bind(_):void 0)}}function ie(m,c){if(1&m&&d._UZ(0,"comentarios-widget",20),2&m){const l=c.row,p=d.oxw();d.Q6J("entity",l)("noPersist",p.isPersist?void 0:"true")("selectable",p.selectable)("grid",p.grid)("save",p.addComentarioResult.bind(p))}}function se(m,c){if(1&m&&d._UZ(0,"column",21),2&m){const l=d.oxw();d.Q6J("dynamicButtons",l.dynamicButtons.bind(l))}}class oe extends y._{set atividade(c){this._atividade!=c&&(this._atividade=c,this.isPersist&&c?.tarefas&&this.control.setValue(c?.tarefas))}get atividade(){return this._atividade}constructor(c){var l;super(c),l=this,this.injector=c,this.control=new X.NI,this.disabled=!1,this.editable=!0,this.selectable=!1,this.id_processo=0,this.consolidacao=!0,this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.editTarefa=function(){var p=(0,g.Z)(function*(_){l.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:_,atividade:l.atividade},modalClose:v=>{v&&(0,g.Z)(function*(){const N=l.control.value,k=N.findIndex(E=>E.id==_.id);if(k>=0){if(v._status="ADD"==v._status?"ADD":"EDIT",l.isPersist&&l.atividade?.tarefas){l.grid.error=void 0;try{l.dialog.showSppinerOverlay("Salvando dados do formul\xe1rio"),v=yield l.dao.save(v,l.join)}catch(E){l.grid.error=E.message?E.message:E,v=void 0}finally{l.dialog.closeSppinerOverlay()}}v&&(N[k]=v,l.control.setValue(N))}l.cdRef.detectChanges()})()}})});return function(_){return p.apply(this,arguments)}}(),this.dao=c.get(C.n),this.atividadeService=c.get(I.s),this.allPages=c.get(h.T),this.formEdit=this.fh.FormBuilder({concluido:{default:!1}}),this.join=["tipo_tarefa","comentarios.usuario"]}ngOnInit(){super.ngOnInit(),this.queryParams?.id_processo&&(this.id_processo=this.queryParams?.id_processo),this.isPersist&&this.atividade?.tarefas&&this.control.setValue(this.atividade?.tarefas)}ngAfterViewInit(){super.ngAfterViewInit(),this.id_processo&&(this.loading=!0,this.dao.query({where:[["id_processo","==",this.id_processo]]}).asPromise().then(c=>{this.control.setValue(c||[]),this.cdRef.detectChanges()}).finally(()=>{this.loading=!1}))}get isPersist(){return null!=this.persist}addTarefa(){var c=this;return(0,g.Z)(function*(){const l=new A.l;l.id=c.dao.generateUuid(),l.usuario=c.auth.usuario,l.usuario_id=c.auth.usuario.id,l.atividade_id=c.atividade?.id||"",l.comentarios=[],l._status="ADD",c.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:l,atividade:c.atividade},modalClose:p=>{p&&(0,g.Z)(function*(){const _=c.control.value||[];if(c.isPersist&&c.atividade?.tarefas){c.grid.error=void 0;try{c.dialog.showSppinerOverlay("Salvando dados do formul\xe1rio"),p=yield c.dao.save(p,c.join)}catch(v){c.grid.error=v.message?v.message:v,p=void 0}finally{c.dialog.closeSppinerOverlay()}}p&&(_.push(p),c.control.setValue(_)),c.cdRef.detectChanges()})()}})})()}deleteTarefa(c){var l=this;return(0,g.Z)(function*(){const p=yield l.dialog.confirm("Exclui ?","Deseja realmente excluir?");if(l.grid.error=void 0,p)try{if(l.isPersist&&l.atividade?.tarefas||"ADD"==c._status){const _=l.control.value,v=_.findIndex(N=>N.id==c.id);l.isPersist&&l.atividade?.tarefas&&(yield l.dao.delete(c)),v>=0&&(_.splice(v,1),l.control.setValue(_))}else c._status="DELETE";l.dialog.alert("Sucesso","Registro exclu\xeddo com sucesso!"),l.cdRef.detectChanges()}catch(_){l.grid.error=_?.message?_?.message:_}})()}onColumnConcluidoEdit(c){var l=this;return(0,g.Z)(function*(){l.formEdit.controls.concluido.setValue(!!c.data_conclusao)})()}onColumnConcluidoSave(c){var l=this;return(0,g.Z)(function*(){try{const p=l.formEdit.controls.concluido.value?l.auth.hora:null,_=yield l.dao.update(c.id,{data_conclusao:p});return c.concluido=l.formEdit.controls.concluido.value,c.data_conclusao=c.concluido?p:null,!!_}catch{return!1}})()}addComentarioResult(c){if(c)if(this.isPersist)this.dao.getById(c.id,this.join).then(l=>{if(l){const p=this.control.value||[],_=p.findIndex(v=>v.id=l.id);_>=0&&(p[_]=l,this.control.setValue(p),this.cdRef.detectChanges())}});else{const l=c.comentarios.filter(p=>["ADD","EDIT","DELETE"].includes(p._status||"")).length>0;c._status=l&&!["ADD","EDIT","DELETE"].includes(c._status||"")?"EDIT":c._status}}dynamicButtons(c){let l=[],p=c,_=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return(!_||"INCLUIDO"==_.status||this.util.asTimestamp(_.data_conclusao)<this.util.asTimestamp(p.created_at))&&(l.push({label:"Alterar",icon:"bi bi-pencil-square",hint:"Alterar",color:"btn-outline-info",onClick:this.editTarefa.bind(this)}),l.push({label:"Excluir",icon:"bi bi-trash",hint:"Excluir",color:"btn-outline-danger",onClick:this.deleteTarefa.bind(this)})),l}canConcluidoEdit(c){let l=c,p=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return!p||"INCLUIDO"==p.status||this.util.asTimestamp(p.data_conclusao)<this.util.asTimestamp(l.data_conclusao)}}(T=oe).\u0275fac=function(c){return new(c||T)(d.Y36(d.zs3))},T.\u0275cmp=d.Xpm({type:T,selectors:[["atividade-list-tarefa"]],viewQuery:function(c,l){if(1&c&&d.Gf(b.M,5),2&c){let p;d.iGM(p=d.CRH())&&(l.grid=p.first)}},inputs:{control:"control",persist:"persist",disabled:"disabled",editable:"editable",selectable:"selectable",id_processo:"id_processo",consolidacao:"consolidacao",atividade:"atividade"},features:[d.qOj],decls:11,vars:13,consts:[[3,"control","add","disabled","minHeight","hasEdit","hasDelete","editable"],[3,"title","template"],["tipoTarefaDescricao",""],["title","Documento",3,"template",4,"ngIf"],["title","Conclu\xeddo",3,"align","template","columnEditTemplate","canEdit","edit","save",4,"ngIf"],["title","Informa\xe7\xf5es adicionais",3,"template"],["tarefaComentarios",""],["type","options",3,"dynamicButtons",4,"ngIf"],["class","d-block",4,"ngIf"],[1,"d-block"],["title","Documento",3,"template"],["documento",""],[3,"documento"],["title","Conclu\xeddo",3,"align","template","columnEditTemplate","canEdit","edit","save"],["concluido",""],["editConcluido",""],[1,"text-center"],["class","bi bi-check-circle",4,"ngIf"],[1,"bi","bi-check-circle"],["controlName","concluido",3,"size","control"],["origem","ATIVIDADE_TAREFA",3,"entity","noPersist","selectable","grid","save"],["type","options",3,"dynamicButtons"]],template:function(c,l){if(1&c&&(d.TgZ(0,"grid",0)(1,"columns")(2,"column",1),d.YNc(3,x,2,2,"ng-template",null,2,d.W1O),d.qZA(),d.YNc(5,O,3,1,"column",3),d.YNc(6,ae,5,6,"column",4),d.TgZ(7,"column",5),d.YNc(8,ie,1,5,"ng-template",null,6,d.W1O),d.qZA(),d.YNc(10,se,1,1,"column",7),d.qZA()()),2&c){const p=d.MAs(4),_=d.MAs(9);d.Q6J("control",l.control)("add",l.addTarefa.bind(l))("disabled",l.disabled?"true":void 0)("minHeight",50)("hasEdit",!1)("hasDelete",!1)("editable",l.editable?"true":void 0),d.xp6(2),d.Q6J("title",l.lex.translate("Tipo de Tarefa")+" e Descri\xe7\xe3o")("template",p),d.xp6(3),d.Q6J("ngIf",l.consolidacao),d.xp6(1),d.Q6J("ngIf",l.consolidacao),d.xp6(1),d.Q6J("template",_),d.xp6(3),d.Q6J("ngIf",l.editable&&!l.selectable&&!l.id_processo)}},dependencies:[F.O5,b.M,z.a,$.b,Q.a,e.y,Z.h]})},59013:(ze,W,r)=>{r.r(W),r.d(W,{AtividadeModule:()=>Fe});var c,g=r(76733),X=r(55579),b=r(1391),C=r(2314),h=r(8239),A=r(74040),y=r(1184),I=r(84971),d=r(73101),F=r(6551),z=r(88340),$=r(22981),Q=r(43972),e=r(20755),Z=r(88820),T=r(32802),q=r(84495),x=r(64603),ee=r(53085),O=r(25560),w=r(9224),te=r(60785),ne=r(25026),ae=r(70361),ie=r(79084),se=r(76298),oe=r(48935),m=r(92392);const l=["numeroProcesso"],p=["numeroDocumento"],_=["tipoProcesso"],v=["tipoDocumento"];function N(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"editable-form",1),e._UZ(1,"separator",2),e.TgZ(2,"separator",3)(3,"div",4)(4,"input-button",5,6),e.NdJ("buttonClick",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onNumeroProcessoClick(o))}),e.qZA(),e._UZ(6,"input-search",7,8),e.qZA(),e.TgZ(8,"div",4)(9,"input-button",9,10),e.NdJ("buttonClick",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onNumeroDocumentoClick(o))}),e.qZA(),e._UZ(11,"input-search",11,12),e.qZA(),e.TgZ(13,"div",4),e._UZ(14,"input-text",13),e.qZA()()()}if(2&n){const t=e.oxw();e.Q6J("form",t.form),e.xp6(4),e.Q6J("size",4)("control",t.form.controls.numero_processo)("disabled",!t.gb.isEmbedded||null!=t.form.controls.numero_documento.value&&t.form.controls.numero_documento.value.length?"true":void 0),e.xp6(2),e.Q6J("label",t.lex.translate("Tipo de Processo"))("size",8)("dao",t.tipoProcessoDao),e.xp6(3),e.Q6J("size",4)("control",t.form.controls.numero_requisicao)("disabled",t.gb.isEmbedded?void 0:"true"),e.xp6(2),e.Q6J("label",t.lex.translate("Tipo de Documento"))("size",8)("dao",t.tipoDocumentoDao),e.xp6(3),e.Q6J("size",12)("control",t.form.controls.titulo_documento),e.uIk("maxlength",250)}}class k extends se.D{set documento(a){this._entity!=a&&(this._entity=a,a&&this.loadData(a))}get documento(){if(this._entity){this.loadEntity(this.form.value);const a=!!this._entity.link?.id_processo;return this._entity._status=a||"ADD"==this._entity._status?a&&!this._entity._status?"EDIT":this._entity._status:"DEL",a||"ADD"!=this._entity._status?this._entity:void 0}}set sei(a){this._sei!=a&&(this._sei=a,a&&(this.form?.controls.id_processo.setValue(a.id_processo||0),this.form?.controls.numero_processo.setValue(a.numero_processo||""),this.form?.controls.id_documento.setValue(a.id_documento||0),this.form?.controls.numero_documento.setValue(a.numero_documento||""),a.numero_documento?this.onNumeroDocumentoClick(new Event("click")):a.numero_processo&&this.onNumeroProcessoClick(new Event("click"))))}get sei(){return this._sei}constructor(a){super(a),this.injector=a,this.validate=(t,i)=>null,this.documentoDao=a.get(ne.d),this._entity=new Q.U({tipo:"LINK",especie:"SEI",link:{tipo:"SEI",id_processo:null,numero_processo:"",id_documento:null,numero_documento:"",titulo_documento:""},_status:"ADD"}),this.allPages=a.get(ie.T),this.tipoDocumentoDao=a.get(z.Q),this.tipoProcessoDao=a.get(ae.n),this.form=this.fh.FormBuilder({tipo:{default:"URL"},url:{default:""},id_processo:{default:0},numero_processo:{default:""},id_documento:{default:0},numero_documento:{default:""},tipo_processo_id:{default:null},tipo_documento_id:{default:null},titulo_documento:{default:""}},this.cdRef,this.validate)}loadData(a){a&&(a.tipo="LINK"),this.form.patchValue(a?.link||{})}loadEntity(a){this.util.fillForm(this._entity.link,a)}get isSei(){return"SEI"==this._entity?.tipo}isEmpty(){let a=this.form.value;return!this.form.valid||"URL"==a.tipo&&!a.url?.length||"SEI"==a.tipo&&(!a.numero_processo?.length||!a.numero_processo?.length)}onNumeroDocumentoClick(a){var t=this;return(0,h.Z)(function*(){const i=t.form?.controls.numero_documento?.value;if(i?.length){t.numeroDocumento.loading=!0;try{let o=yield t.allPages.getDadosDocumento(i);if(!o)throw new Error("Documento n\xe3o encontrado");{let s=null,u=null;if(o.processo?.tipo_processo){const f=yield t.tipoProcessoDao.query({where:[["codigo","=",o.processo?.tipo_processo]]}).asPromise();f[0]&&(t.tipoProcesso?.loadSearch(f[0]),s=f[0].id)}if(o.documento?.tipo_documento){const f=yield t.tipoDocumentoDao.query({where:[["nome","=",o.documento?.tipo_documento]]}).asPromise();f[0]&&(t.tipoDocumento?.loadSearch(f[0]),u=f[0].id)}Object.assign(t._entity.link,{id_processo:o.processo?.id_processo,numero_processo:o.processo?.numero_processo,id_documento:o.documento?.id_documento,numero_documento:o.documento?.numero_documento,tipo_processo_id:s,tipo_documento_requisicao_id:u,titulo_documento:o.documento?.titulo_documento}),t._entity.titulo=o.documento?.titulo_documento,t.loadData(t._entity)}}catch{t.dialog.alert("Error","Imposs\xedvel encontrar o documento informado. Tente incluir diretamente pelo bot\xe3o 'Incluir atividade' acessando o documento no Sei!")}finally{t.numeroDocumento.loading=!1}}})()}onNumeroProcessoClick(a){var t=this;return(0,h.Z)(function*(){const i=t.form?.controls.numero_processo?.value;if(i?.length){t.numeroProcesso.loading=!0;try{let o=yield t.allPages.getDadosProcesso(i);if(!o)throw new Error("Processo n\xe3o encontrado");{let s=null;if(o.processo?.tipo_processo){const u=yield t.tipoProcessoDao.query({where:[["codigo","=",o.processo?.tipo_processo]]}).asPromise();u[0]&&(t.tipoProcesso?.loadSearch(u[0]),s=u[0].id)}Object.assign(t._entity.link,{id_processo:o.processo?.id_processo,numero_processo:o.processo?.numero_processo,id_documento:0,numero_documento:"",tipo_processo_id:s,tipo_documento_requisicao_id:null,titulo_documento:""}),t._entity.title="Processo "+o.processo?.numero_processo,t.loadData(t._entity)}}catch{t.dialog.alert("Error","Imposs\xedvel encontrar o processo informado. Tente incluir diretamente pelo bot\xe3o 'Incluir atividade' acessando o processo no Sei!")}finally{t.numeroProcesso.loading=!1}}})()}}(c=k).\u0275fac=function(a){return new(a||c)(e.Y36(e.zs3))},c.\u0275cmp=e.Xpm({type:c,selectors:[["documento-link"]],viewQuery:function(a,t){if(1&a&&(e.Gf(A.Q,5),e.Gf(l,5),e.Gf(p,5),e.Gf(_,5),e.Gf(v,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.editableForm=i.first),e.iGM(i=e.CRH())&&(t.numeroProcesso=i.first),e.iGM(i=e.CRH())&&(t.numeroDocumento=i.first),e.iGM(i=e.CRH())&&(t.tipoProcesso=i.first),e.iGM(i=e.CRH())&&(t.tipoDocumento=i.first)}},inputs:{documento:"documento",sei:"sei"},features:[e.qOj],decls:1,vars:1,consts:[["noButtons","","confirmLabel","Assinar",3,"form",4,"ngIf"],["noButtons","","confirmLabel","Assinar",3,"form"],["title","Sei"],["transparent","","bottom",""],[1,"row"],["label","N\xfamero Processo","controlName","numero_processo","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"size","control","disabled","buttonClick"],["numeroProcesso",""],["controlName","tipo_processo_id","disabled","",3,"label","size","dao"],["tipoProcesso",""],["label","'N\xfamero Documento","controlName","numero_documento","labelInfo","Numero do documento, caso seja o Sei \xe9 o numero Sei",3,"size","control","disabled","buttonClick"],["numeroDocumento",""],["controlName","tipo_documento_id","disabled","",3,"label","size","dao"],["tipoDocumento",""],["label","T\xedtulo do documento","controlName","titulo_documento","disabled","","labelInfo","T\xedtulo do documento no Sei",3,"size","control"]],template:function(a,t){1&a&&e.YNc(0,N,15,16,"editable-form",0),2&a&&e.Q6J("ngIf",t.isSei||t.gb.isEmbedded)},dependencies:[g.O5,A.Q,T.V,oe.G,m.m,O.N]});var M,E=r(62095);const we=["tipoAtividade"],Me=["docEntregue"];function Se(n,a){if(1&n&&(e.TgZ(0,"div",2),e._UZ(1,"input-number",15)(2,"input-datetime",16),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",6)("decimals",2),e.xp6(1),e.Q6J("size",6)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+t.lex.translate("atividade"))}}function Re(n,a){if(1&n&&(e.TgZ(0,"div",2),e._UZ(1,"input-timer",17)(2,"input-number",15)(3,"input-datetime",18),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Esfor\xe7o"))("control",t.form.controls.esforco),e.xp6(1),e.Q6J("size",4)("decimals",2),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+t.lex.translate("atividade"))}}function Ve(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"input-datetime",19),e.TgZ(2,"input-datetime",20),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onDataEntregaChange(o))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",6)("control",t.form.controls.data_inicio)("labelInfo","Data em que o usu\xe1rio iniciou a "+t.lex.translate("atividade")),e.xp6(1),e.Q6J("size",6)("control",t.form.controls.data_entrega)("labelInfo","Data da conclus\xe3o da "+t.lex.translate("atividade"))}}function Le(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",2),e._UZ(1,"input-datetime",19),e.TgZ(2,"input-datetime",21),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onDataEntregaChange(o))}),e.qZA(),e._UZ(3,"input-timer",22),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio)("labelInfo","Data em que o usu\xe1rio iniciou a "+t.lex.translate("atividade")),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_entrega)("labelInfo","Data da conclus\xe3o da "+t.lex.translate("atividade")),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.tempo_despendido)("labelInfo","Calculado no fim da "+t.lex.translate("atividade")+", sendo o tempo l\xedquido (considerando pausas)")}}function Ge(n,a){if(1&n&&(e.TgZ(0,"separator",23),e._UZ(1,"calendar-efemerides",24),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("efemerides",t.efemerides)}}class fe extends y.F{constructor(a){super(a,d.a,I.P),this.injector=a,this.modalWidth=800,this.entregas=[],this.validate=(t,i)=>{let o=null;return("plano_trabalho_entrega_id"==i&&!t.value?.length||"data_entrega"==i&&!this.util.isDataValid(t.value))&&(o="Obrigat\xf3rio"),o},this.tipoAtividadeDao=a.get($.Y),this.tipoDocumentoDao=a.get(z.Q),this.calendar=a.get(F.o),this.title="Conclus\xe3o de "+this.lex.translate("atividade"),this.form=this.fh.FormBuilder({tipo_atividade_id:{default:null},data_distribuicao:{default:null},esforco:{default:0},progresso:{default:0},data_estipulada_entrega:{default:null},data_inicio:{default:null},tempo_despendido:{default:0},data_entrega:{default:null},arquivar:{default:!1},descricao_tecnica:{default:""},documento_entrega:{default:new Q.U},documento_entrega_id:{default:null},plano_trabalho_entrega_id:{default:null}},this.cdRef,this.validate),this.join=["plano_trabalho.tipo_modalidade","unidade","plano_trabalho.entregas.plano_entrega_entrega:id,descricao"]}loadData(a,t){var i=this;return(0,h.Z)(function*(){let o=Object.assign({},t.value);o=i.util.fillForm(o,a),o.data_entrega=i.auth.hora,o.progresso=100,yield i.tipoAtividade.loadSearch(a.tipo_atividade||o.tipo_atividade_id),a.unidade_id!=i.auth.unidade.id&&(yield i.auth.selecionaUnidade(a.unidade_id)),i.entregas=a.plano_trabalho?.entregas?.map(s=>Object.assign({},{key:s.id,value:s.descricao+(s.plano_entrega_entrega?" ("+s.plano_entrega_entrega?.descricao+")":""),data:s}))||[],o.arquivar=!1,t.patchValue(o),i.onDataEntregaChange()})()}initializeData(a){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getAtividade(t.urlParams.get("id")),yield t.loadData(t.entity,a)})()}onDataEntregaChange(a){const t=this.form.controls.data_entrega.value,i=this.entity.data_inicio,o=this.entity.carga_horaria,s=this.entity.unidade,u=this.entity.pausas||[],f=this.entity.usuario?.afastamentos||[];this.efemerides=this.util.isDataValid(t)?this.calendar.calculaDataTempoUnidade(i,t,o,s,"ENTREGA",u,f):void 0,this.efemerides&&(this.form.controls.tempo_despendido.setValue(this.efemerides.tempoUtil),this.cdRef.detectChanges())}onTipoAtividadeSelect(a){const t=a.entity;this.form.controls.esforco.setValue(t?.esforco||0),this.cdRef.detectChanges()}saveData(a){return new Promise((t,i)=>{let o=this.util.fill(new d.a,this.entity);o=this.util.fillForm(o,this.form.value),o.id=this.entity.id,o.descricao_tecnica=this.form.controls.descricao_tecnica.value,o.data_arquivamento=this.form.controls.arquivar.value?new Date:null,o.progresso=this.form.controls.progresso.value,o.produtividade=this.entity?.plano_trabalho?.tipo_modalidade?.atividade_tempo_despendido?this.calendar.produtividade(o.esforco,o.tempo_despendido):null,this.dao.concluir(o).then(s=>t(s)).catch(i)})}}(M=fe).\u0275fac=function(a){return new(a||M)(e.Y36(e.zs3))},M.\u0275cmp=e.Xpm({type:M,selectors:[["app-atividade-form-concluir"]],viewQuery:function(a,t){if(1&a&&(e.Gf(we,5),e.Gf(Me,5),e.Gf(A.Q,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.tipoAtividade=i.first),e.iGM(i=e.CRH())&&(t.docEntregue=i.first),e.iGM(i=e.CRH())&&(t.editableForm=i.first)}},features:[e.qOj],decls:19,vars:23,consts:[["initialFocus","tipo_atividade_id",3,"form","disabled","submit","cancel"],[3,"documento"],[1,"row"],["controlName","tipo_atividade_id",3,"label","emptyValue","size","dao","select"],["tipoAtividade",""],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["entrega",""],["label","Arquivar","controlName","arquivar","labelInfo","Arquivar automaticamente ap\xf3s a conclus\xe3o (Somente se o plano dispensar avalia\xe7\xe3o)",3,"size","control"],["collapse","",3,"title","collapsed"],["persist","",3,"atividade"],["class","row",4,"ngIf","ngIfElse"],["comEsforco",""],["title","Conclus\xe3o"],["comTempoDespendido",""],["title","C\xe1lculos das horas","collapse","",4,"ngIf"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo). Sempre ser\xe1 100% na conclus\xe3o!",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xe7\xe3o",3,"size","label","control"],["noIcon","","disabled","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","",3,"size","control","labelInfo"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega","required","",3,"size","control","labelInfo","change"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega",3,"size","control","labelInfo","change"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","",3,"size","control","labelInfo"],["title","C\xe1lculos das horas","collapse",""],[3,"efemerides"]],template:function(a,t){if(1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e._UZ(1,"documento-link",1),e.TgZ(2,"div",2)(3,"input-search",3,4),e.NdJ("select",function(o){return t.onTipoAtividadeSelect(o)}),e.qZA(),e._UZ(5,"input-select",5,6)(7,"input-switch",7),e.qZA(),e.TgZ(8,"separator",8),e._UZ(9,"atividade-list-tarefa",9),e.qZA(),e.YNc(10,Se,3,6,"div",10),e.YNc(11,Re,4,9,"ng-template",null,11,e.W1O),e.TgZ(13,"separator",12),e.YNc(14,Ve,3,6,"div",10),e.YNc(15,Le,4,9,"ng-template",null,13,e.W1O),e._UZ(17,"documento-link",1),e.qZA(),e.YNc(18,Ge,2,1,"separator",14),e.qZA()),2&a){const i=e.MAs(12),o=e.MAs(16);e.Q6J("form",t.form)("disabled",t.formDisabled),e.xp6(1),e.Q6J("documento",t.form.controls.documento_entrega.value),e.xp6(2),e.Q6J("label","Tipo de"+t.lex.translate("Atividade"))("emptyValue",null)("size",5)("dao",t.tipoAtividadeDao),e.xp6(2),e.Q6J("label",t.lex.translate("Entrega do plano"))("size",5)("control",t.form.controls.plano_trabalho_entrega_id)("items",t.entregas)("labelInfo",t.lex.translate("Entrega do plano")+" que a "+t.lex.translate("atividade")+" \xe9 referente"),e.xp6(2),e.Q6J("size",2)("control",t.form.controls.arquivar),e.xp6(1),e.Q6J("title","Tarefa da "+t.lex.translate("atividade"))("collapsed",!1),e.xp6(1),e.Q6J("atividade",t.entity),e.xp6(1),e.Q6J("ngIf",!(null!=t.entity&&null!=t.entity.plano_trabalho&&null!=t.entity.plano_trabalho.tipo_modalidade&&t.entity.plano_trabalho.tipo_modalidade.atividade_esforco))("ngIfElse",i),e.xp6(4),e.Q6J("ngIf",!(null!=t.entity&&null!=t.entity.plano_trabalho&&null!=t.entity.plano_trabalho.tipo_modalidade&&t.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",o),e.xp6(3),e.Q6J("documento",t.form.controls.documento_entrega.value),e.xp6(1),e.Q6J("ngIf",t.efemerides&&(null==t.entity||null==t.entity.plano_trabalho||null==t.entity.plano_trabalho.tipo_modalidade?null:t.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))}},dependencies:[g.O5,A.Q,Z.a,T.V,q.k,x.p,ee.u,O.N,w.l,te.Y,k,E.u]});var S,Be=r(15213),He=r(949),he=r(88543),Ye=r(92307),ge=r(2124),le=r(74508),re=r(66384),de=r(74978),je=r(54240);const Ke=["documento"],We=["comentarios"],Xe=["tipoTarefa"];class ce extends y.F{constructor(a){super(a,he.l,He.n),this.injector=a,this.modalWidth=800,this.validate=(t,i)=>{let o=null;return["descricao"].includes(i)&&!t.value?.length&&(o="Obrigat\xf3rio"),o},this.formValidation=t=>{const i=t.value;return i.tipo_tarefa_id?.length&&!this.tipoTarefa?.selectedEntity?"Aguarde o carregamento "+this.lex.translate("tipo de tarefa")+". Caso demore, selecione novamente!":i.concluido&&this.tipoTarefa?.selectedEntity?.documental&&this.documento?.isEmpty()?this.gb.isEmbedded?"Obrigat\xf3rio selecionar um arquivo para a tarefa selecionada!":"Utilize o sistema como extens\xe3o para concluir!":void 0},this.tipoTarefaDao=a.get(Be.J),this.tipoDocumentoDao=a.get(z.Q),this.tipoProcessoDao=a.get(ae.n),this.allPages=a.get(ie.T),this.comentario=a.get(ge.K),this.title=this.lex.translate("Tarefa da atividade"),this.form=this.fh.FormBuilder({descricao:{default:""},tipo_tarefa_id:{default:null},tempo_estimado:{default:0},concluido:{default:!0},id_processo:{default:0},numero_processo:{default:""},documento:{default:null},comentarios:{default:[]}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();const a=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action="comentar"==a?a:this.action}loadData(a,t){var i=this;return(0,h.Z)(function*(){let o=Object.assign({},t.value);o=i.util.fillForm(o,a),yield i.tipoTarefa?.loadSearch(a.tipo_tarefa||o.tipo_tarefa_id),o.comentarios=i.comentario.orderComentarios(o.comentarios||[]),t.patchValue(o)})()}initializeData(a){var t=this;return(0,h.Z)(function*(){t.entity=t.metadata.tarefa,t.atividade=t.metadata.atividade,t.sei=t.metadata.sei,yield t.loadData(t.entity,a)})()}saveData(a){var t=this;return(0,h.Z)(function*(){return t.comentarios?.confirm(),t.util.fillForm(t.entity,t.form.value),t.entity.tipo_tarefa=t.tipoTarefa?.selectedEntity,t.entity.data_conclusao=t.form.controls.concluido.value&&!t.entity.data_conclusao?t.auth.hora:t.entity.data_conclusao,new Ye.R(t.entity)})()}onTipoTarefaSelect(a){const t=a.entity;this.form.controls.tempo_estimado.setValue(t?.tempo_estimado||0)}}(S=ce).\u0275fac=function(a){return new(a||S)(e.Y36(e.zs3))},S.\u0275cmp=e.Xpm({type:S,selectors:[["app-atividade-form-tarefa"]],viewQuery:function(a,t){if(1&a&&(e.Gf(A.Q,5),e.Gf(Ke,5),e.Gf(We,5),e.Gf(Xe,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.editableForm=i.first),e.iGM(i=e.CRH())&&(t.documento=i.first),e.iGM(i=e.CRH())&&(t.comentarios=i.first),e.iGM(i=e.CRH())&&(t.tipoTarefa=i.first)}},features:[e.qOj],decls:15,vars:16,consts:[["initialFocus","descricao",3,"form","disabled","submit","cancel"],["display","","right","",3,"title"],["key","TAREFA",3,"label"],[1,"row"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","tipo_tarefa_id",3,"label","size","control","dao","select"],["tipoTarefa",""],["label","Conclu\xeddo","controlName","concluido","labelInfo","Se foi conclu\xedda",3,"size","control"],[3,"sei","documento"],["documento",""],["key","COMENTARIOS","label","Comentarios"],["clss","row"],["origem","ATIVIDADE_TAREFA",3,"control"],["comentarios",""]],template:function(a,t){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"tabs",1)(2,"tab",2)(3,"div",3),e._UZ(4,"input-textarea",4),e.qZA(),e.TgZ(5,"div",3)(6,"input-search",5,6),e.NdJ("select",function(o){return t.onTipoTarefaSelect(o)}),e.qZA(),e._UZ(8,"input-switch",7),e.qZA(),e._UZ(9,"documento-link",8,9),e.qZA(),e.TgZ(11,"tab",10)(12,"div",11),e._UZ(13,"comentarios",12,13),e.qZA()()()()),2&a&&(e.Q6J("form",t.form)("disabled",t.formDisabled),e.xp6(1),e.Q6J("title",t.isModal?"":t.title),e.xp6(1),e.Q6J("label",t.lex.translate("Tarefa da Atividade")),e.xp6(2),e.Q6J("size",12)("rows",2)("control",t.form.controls.descricao),e.xp6(2),e.Q6J("label",t.lex.translate("Tipo de Tarefa"))("size",10)("control",t.form.controls.tipo_tarefa_id)("dao",t.tipoTarefaDao),e.xp6(2),e.Q6J("size",2)("control",t.form.controls.concluido),e.xp6(1),e.Q6J("sei",t.sei)("documento",t.form.controls.documento.value),e.xp6(4),e.Q6J("control",t.form.controls.comentarios))},dependencies:[A.Q,Z.a,T.V,le.Q,re.n,de.i,je.y,k],styles:['@charset "UTF-8";.comentario-table[_ngcontent-%COMP%]{width:100%}.comentario-user[_ngcontent-%COMP%]{width:50px;vertical-align:top;padding:8px}.comentario-container[_ngcontent-%COMP%]{padding-left:10px;width:auto;border-left:var(--bs-gray-400) 2px solid;position:relative}.comentario-user-indicator[_ngcontent-%COMP%]{content:"";position:absolute;width:0px;height:0px;top:0;left:-12px;border-top:.75rem solid var(--bs-gray-400);border-left:.75rem solid transparent;border-bottom:none;border-right:none}.comentario-level[_ngcontent-%COMP%]{color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:" \\2022  "}']});var R,ve=r(35255),be=r(87744);const $e=["usuario"],et=["planoTrabalho"],tt=["planejado"],at=function(){return["planos_trabalho.tipo_modalidade:id,nome","planos_trabalho.entregas.entrega:id,nome"]};class Ce extends y.F{get labelInfoSuspender(){const a=this.iniciadas.length>1?this.lex.translate("tarefas"):this.lex.translate("tarefa"),t=1==this.iniciadas.length?"":"s",i=1==this.iniciadas.length?"":" "+this.iniciadas.length.toString();return this.iniciadas.length?`Suspender a${t}${i} ${a} j\xe1 iniciada${t}?`:"N\xe3o h\xe1 outras atividades iniciadas pelo usu\xe1rio!"}constructor(a){super(a,d.a,I.P),this.injector=a,this.modalWidth=600,this.iniciadas=[],this.planoTrabalhoSelecionado=null,this.planosTrabalhos=[],this.planosTrabalhosEntregas=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.validate=(t,i)=>{let o=null;return(["usuario_id","plano_trabalho_id","plano_trabalho_entrega_id"].includes(i)&&!t.value?.length||"data_inicio"==i&&!t.value)&&(o="Obrigat\xf3rio"),o},this.formValidation=t=>{let i;return this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_inicio.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_inicio.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(i="Data de in\xedcio fora do per\xedodo do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xe9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_6]"),i},this.usuarioDao=a.get(ve.q),this.planoTrabalhoDao=a.get(be.t),this.calendar=a.get(F.o),this.form=this.fh.FormBuilder({usuario_id:{default:void 0},plano_trabalho_id:{default:void 0},plano_trabalho_entrega_id:{default:void 0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},carga_horaria:{default:0},tempo_planejado:{default:0},esforco:{default:0},data_inicio:{default:null},suspender:{default:!1}},this.cdRef,this.validate),this.join=["unidade","atividade","usuario.planos_trabalho.tipo_modalidade"]}loadIniciadas(a){this.iniciadas=[],a?.length&&this.dao.iniciadas(a).then(t=>{this.iniciadas=t,this.cdRef.detectChanges()})}onUsuarioSelect(a){const i=a.entity?.planos_trabalho||[];this.planosTrabalhos=i.filter(o=>o.unidade_id==this.entity.unidade_id).map(o=>({key:o.id,value:(o.tipo_modalidade?.nome||"")+" - "+this.dao.getDateFormatted(o.data_inicio)+" \xe0 "+this.dao.getDateFormatted(o.data_fim),data:o})),this.cdRef.detectChanges(),!this.form.controls.plano_trabalho_id.value?.length&&1==this.planosTrabalhos.length&&this.form.controls.plano_trabalho_id.setValue(this.planosTrabalhos[0].key),this.cdRef.detectChanges()}onPlanoChange(a){var t=this;(0,h.Z)(function*(){if(t.entity&&t.planoTrabalho?.selectedItem?.data){const i=t.planoTrabalho?.selectedItem?.data;t.planoTrabalhoSelecionado?.id!=i.id&&(t.planoTrabalhoSelecionado=yield t.planoTrabalhoDao.getById(i.id,t.planoTrabalhoJoin));const o=i?.carga_horaria||t.calendar.expedienteMedio(t.entity.unidade),s=t.calendar.horasUteis(t.form.controls.data_distribuicao.value,t.form.controls.data_estipulada_entrega.value,o,t.entity.unidade,"DISTRIBUICAO");t.form.controls.carga_horaria.setValue(o),t.form.controls.tempo_planejado.setValue(s),t.form.controls.esforco.setValue(t.form.controls.esforco.value||t.entity?.tipo_atividade?.esforco||0);const u=t.form.controls.plano_trabalho_entrega_id.value;t.planosTrabalhosEntregas=t.planoTrabalhoSelecionado?.entregas?.map(f=>Object.assign({},{key:f.id,value:f.descricao+(f.plano_entrega_entrega?" ("+f.plano_entrega_entrega?.descricao+")":""),data:f}))||[],t.cdRef.detectChanges(),t.form.controls.plano_trabalho_entrega_id.setValue(!u?.length&&t.planosTrabalhos.length>0?t.planosTrabalhos[0].key:u)}})()}loadData(a,t){var i=this;return(0,h.Z)(function*(){let o=Object.assign({},t.value);o=i.util.fillForm(o,a),o.usuario_id?.length||(o.usuario_id=i.auth.usuario?.id),o.data_inicio=o.data_inicio||i.util.setStrTime(new Date,i.auth.unidadeHora),yield i.usuario.loadSearch(a.usuario||o.usuario_id),i.loadIniciadas(o.usuario_id),a.unidade_id!=i.auth.unidade.id&&(yield i.auth.selecionaUnidade(a.unidade_id)),t.patchValue(o),i.onPlanoChange(new Event("change"))})()}initializeData(a){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getById(t.urlParams.get("id"),t.join),yield t.loadData(t.entity,a)})()}saveData(a){return new Promise((t,i)=>{let o=this.util.fill(new d.a,this.entity);o=this.util.fillForm(o,this.form.value),o.id=this.entity.id,o.suspender=this.form.controls.suspender.value,this.dao.iniciar(o).then(s=>t(s)).catch(i)})}}(R=Ce).\u0275fac=function(a){return new(a||R)(e.Y36(e.zs3))},R.\u0275cmp=e.Xpm({type:R,selectors:[["app-atividade-form-iniciar"]],viewQuery:function(a,t){if(1&a&&(e.Gf(A.Q,5),e.Gf($e,5),e.Gf(et,5),e.Gf(tt,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.editableForm=i.first),e.iGM(i=e.CRH())&&(t.usuario=i.first),e.iGM(i=e.CRH())&&(t.planoTrabalho=i.first),e.iGM(i=e.CRH())&&(t.planejado=i.first)}},features:[e.qOj],decls:17,vars:28,consts:[["initialFocus","data_distribuicao",3,"form","disabled","submit","cancel"],[1,"row"],["controlName","data_distribuicao","disabled","","labelInfo","Data de cadastro da atividade",3,"size","label","control"],["controlName","data_estipulada_entrega","disabled","","labelInfo","Data estipulada para entrega da atividade",3,"size","label","control"],["label","Respons\xe1vel","controlName","usuario_id","labelInfo","Respons\xe1vel por executar a atividade","required","",3,"size","dao","join","select"],["usuario",""],["controlName","plano_trabalho_id","required","",3,"label","size","control","items","labelInfo","change"],["planoTrabalho",""],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["entrega",""],["label","Inicio","controlName","data_inicio","labelInfo","Data em que o usu\xe1rio iniciou a atividade","required","",3,"size","control"],["label","Suspender as demais","controlName","suspender",3,"size","control","disabled","labelInfo"]],template:function(a,t){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2)(3,"input-datetime",3),e.qZA(),e._UZ(4,"separator"),e.TgZ(5,"div",1)(6,"input-search",4,5),e.NdJ("select",function(o){return t.onUsuarioSelect(o)}),e.qZA()(),e.TgZ(8,"div",1)(9,"input-select",6,7),e.NdJ("change",function(o){return t.onPlanoChange(o)}),e.qZA(),e._UZ(11,"input-select",8,9),e.qZA(),e._UZ(13,"separator"),e.TgZ(14,"div",1),e._UZ(15,"input-datetime",10)(16,"input-switch",11),e.qZA()()),2&a&&(e.Q6J("form",t.form)("disabled",t.formDisabled),e.xp6(2),e.Q6J("size",6)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.xp6(1),e.Q6J("size",6)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega),e.xp6(3),e.Q6J("size",12)("dao",t.usuarioDao)("join",e.DdM(27,at)),e.xp6(3),e.Q6J("label",t.lex.translate("Plano de trabalho"))("size",7)("control",t.form.controls.plano_trabalho_id)("items",t.planosTrabalhos)("labelInfo",t.lex.translate("Plano de trabalho")),e.xp6(2),e.Q6J("label",t.lex.translate("Entrega do plano"))("size",5)("control",t.form.controls.plano_trabalho_entrega_id)("items",t.planosTrabalhosEntregas)("labelInfo",t.lex.translate("Entrega")+" do "+t.lex.translate("plano de trabalho")+" que a "+t.lex.translate("atividade")+" \xe9 referente"),e.xp6(4),e.Q6J("size",6)("control",t.form.controls.data_inicio),e.xp6(1),e.Q6J("size",6)("control",t.form.controls.suspender)("disabled",t.iniciadas.length?void 0:"")("labelInfo",t.labelInfoSuspender))},dependencies:[A.Q,Z.a,T.V,q.k,x.p,O.N]});var V,L,it=r(50933);function ot(n,a){1&n&&e._UZ(0,"top-alert",5)}function nt(n,a){if(1&n&&(e.TgZ(0,"div",3),e._UZ(1,"input-datetime",6),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",12)("control",t.form.controls.data_inicio)}}class Ae extends y.F{constructor(a){super(a,d.a,I.P),this.injector=a,this.reiniciar=!1,this.modalWidth=400,this.validate=(t,i)=>{let o=null,s=this.entity?.pausas?.find(u=>!u.data_fim);return"data"==i&&(this.reiniciar&&!s?o="N\xe3o \xe1 pausa!":this.util.isDataValid(t.value)?s&&this.entity&&t.value.getTime()<this.entity.data_inicio.getTime()&&(o="Menor que in\xedcio!"):o="Obrigat\xf3rio"),o},this.form=this.fh.FormBuilder({data_inicio:{default:void 0},data:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){this.reiniciar=!!this.queryParams?.reiniciar,this.title=this.reiniciar?"Reiniciar":"Suspender",super.ngAfterViewInit()}loadData(a,t){var i=this;return(0,h.Z)(function*(){let o=i.entity?.pausas?.find(u=>!u.data_fim);i.reiniciar&&!o&&i.error("N\xe3o h\xe1 pausa ativa para ser reiniciada.");let s={inicio:i.reiniciar?o?.data_inicio:void 0,data:i.util.setStrTime(new Date,i.auth.unidadeHora)};a.unidade_id!=i.auth.unidade.id&&(yield i.auth.selecionaUnidade(a.unidade_id)),t.patchValue(s)})()}initializeData(a){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getAtividade(t.urlParams.get("id")),yield t.loadData(t.entity,a)})()}saveData(a){return new Promise((t,i)=>{let o={atividade_id:this.entity.id,data:this.form.controls.data.value};this.reiniciar?this.dao.reiniciar(o).then(s=>t(s)).catch(i):this.dao.pausar(o).then(s=>t(s)).catch(i)})}}(V=Ae).\u0275fac=function(a){return new(a||V)(e.Y36(e.zs3))},V.\u0275cmp=e.Xpm({type:V,selectors:[["app-atividade-form-pausar"]],viewQuery:function(a,t){if(1&a&&e.Gf(A.Q,5),2&a){let i;e.iGM(i=e.CRH())&&(t.editableForm=i.first)}},features:[e.qOj],decls:5,vars:8,consts:[["type","warning","message","Dica: N\xe3o \xe9 necess\xe1rio suspender a tarefa entre as jornadas de trabalho!",4,"ngIf"],["initialFocus","data",3,"form","disabled","submit","cancel"],["class","row",4,"ngIf"],[1,"row"],["controlName","data","required","",3,"size","label","control","labelInfo"],["type","warning","message","Dica: N\xe3o \xe9 necess\xe1rio suspender a tarefa entre as jornadas de trabalho!"],["label","In\xedcio da pausa","controlName","data_inicio","disabled","","labelInfo","Data de in\xedcio da \xfaltima pausa",3,"size","control"]],template:function(a,t){1&a&&(e.YNc(0,ot,1,0,"top-alert",0),e.TgZ(1,"editable-form",1),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.YNc(2,nt,2,2,"div",2),e.TgZ(3,"div",3),e._UZ(4,"input-datetime",4),e.qZA()()),2&a&&(e.Q6J("ngIf",!t.reiniciar),e.xp6(1),e.Q6J("form",t.form)("disabled",t.formDisabled),e.xp6(1),e.Q6J("ngIf",t.reiniciar),e.xp6(2),e.Q6J("size",12)("label",t.reiniciar?"Data de rein\xedcio":"Data da pausa")("control",t.form.controls.data)("labelInfo",t.reiniciar?"Data e hora do rein\xedcio da atividade":"Data e hora do in\xedcio da pausa/suspens\xe3o"))},dependencies:[g.O5,A.Q,q.k,it.o]});class Te extends y.F{constructor(a){super(a,d.a,I.P),this.injector=a,this.modalWidth=400,this.validate=(t,i)=>{let o=null;return"data_estipulada_entrega"==i&&(this.util.isDataValid(t.value)?this.entity?.data_distribuicao&&t.value.getTime()<this.entity.data_distribuicao.getTime()&&(o="Menor que distribui\xe7\xe3o!"):o="Obrigat\xf3rio"),o},this.form=this.fh.FormBuilder({data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date}},this.cdRef,this.validate)}loadData(a,t){var i=this;return(0,h.Z)(function*(){let o={data_distribuicao:a.data_distribuicao,data_estipulada_entrega:a.data_estipulada_entrega};a.unidade_id!=i.auth.unidade.id&&(yield i.auth.selecionaUnidade(a.unidade_id)),t.patchValue(o)})()}initializeData(a){var t=this;return(0,h.Z)(function*(){t.entity=yield t.dao.getAtividade(t.urlParams.get("id")),yield t.loadData(t.entity,a)})()}saveData(a){return new Promise((t,i)=>{let o={id:this.entity.id,data_estipulada_entrega:this.form.controls.data_estipulada_entrega.value};this.dao.prorrogar(o).then(s=>t(s)).catch(i)})}}(L=Te).\u0275fac=function(a){return new(a||L)(e.Y36(e.zs3))},L.\u0275cmp=e.Xpm({type:L,selectors:[["app-atividade-form-prorrogar"]],viewQuery:function(a,t){if(1&a&&e.Gf(A.Q,5),2&a){let i;e.iGM(i=e.CRH())&&(t.editableForm=i.first)}},features:[e.qOj],decls:5,vars:7,consts:[["initialFocus","data_estipulada_entrega",3,"form","disabled","submit","cancel"],[1,"row"],["label","Data da distribui\xe7\xe3o","controlName","data_distribuicao","disabled","","labelInfo","Data de distribui\xe7\xe3o da atividade",3,"size","control"],["controlName","data_estipulada_entrega","labelInfo","Prazo para entrega da atividade","required","",3,"size","label","control"]],template:function(a,t){1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"div",1),e._UZ(2,"input-datetime",2),e.qZA(),e.TgZ(3,"div",1),e._UZ(4,"input-datetime",3),e.qZA()()),2&a&&(e.Q6J("form",t.form)("disabled",t.formDisabled),e.xp6(2),e.Q6J("size",12)("control",t.form.controls.data_distribuicao),e.xp6(2),e.Q6J("size",12)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega))},dependencies:[A.Q,q.k]});var G,st=r(81214),lt=r(57338),rt=r(20609);const dt=["etiqueta"],ct=["tipoAtividade"],ut=["planoTrabalho"],pt=["unidade"],mt=["usuario"],_t=["comentarios"],ft=["requisicao"];function ht(n,a){if(1&n&&e._UZ(0,"input-switch",22),2&n){const t=e.oxw();e.Q6J("size",1)("disabled",t.form.controls.concluido.value?"true":void 0)}}function gt(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"input-switch",23),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onConcluidoChange(o))}),e.qZA()}2&n&&e.Q6J("size",1)}function vt(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"input-datetime",24),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onDataDistribuicaoChange(o))}),e.qZA(),e._UZ(2,"input-number",25),e.TgZ(3,"input-datetime",26),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onPrazoEntregaChange(o))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.xp6(1),e.Q6J("size",4)("decimals",2),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)}}function bt(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"input-datetime",24),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onDataDistribuicaoChange(o))}),e.qZA(),e._UZ(2,"input-timer",27)(3,"input-number",25),e.TgZ(4,"input-datetime",26),e.NdJ("change",function(o){e.CHM(t);const s=e.oxw();return e.KtG(s.onPrazoEntregaChange(o))}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Data de distribui\xe7\xe3o"))("control",t.form.controls.data_distribuicao),e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Esfor\xe7o"))("control",t.form.controls.esforco),e.xp6(1),e.Q6J("size",3)("decimals",2),e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Prazo de entrega"))("control",t.form.controls.data_estipulada_entrega)}}function Ct(n,a){if(1&n&&(e.TgZ(0,"div",5),e._UZ(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-datetime",33),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_entrega),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio)}}function At(n,a){if(1&n&&(e.TgZ(0,"div",5),e._UZ(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-timer",34)(4,"input-datetime",33),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_entrega),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.tempo_despendido),e.xp6(1),e.Q6J("size",4)("control",t.form.controls.data_inicio)}}function Tt(n,a){if(1&n&&(e.TgZ(0,"separator",28),e.YNc(1,Ct,4,6,"div",19),e.YNc(2,At,5,8,"ng-template",null,29,e.W1O),e._UZ(4,"documento-link",30),e.qZA()),2&n){const t=e.MAs(3),i=e.oxw(),o=e.MAs(18);e.xp6(1),e.Q6J("ngIf",!(null!=o&&null!=o.selectedItem&&null!=o.selectedItem.data&&null!=o.selectedItem.data.tipo_modalidade&&o.selectedItem.data.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",t),e.xp6(3),e.Q6J("documento",i.form.controls.documento_entrega.value)}}class U extends y.F{constructor(a){super(a,d.a,I.P),this.injector=a,this.etiquetas=[],this.checklist=[],this.planosTrabalhos=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.planoTrabalhoSelecionado=null,this.usuarioJoin=["planos_trabalho.entregas.plano_entrega_entrega:id,descricao","planos_trabalho.tipo_modalidade:id,nome"],this.entregas=[],this.validateChecklist=(i,o)=>null,this.validate=(i,o)=>{let s=null;if(["unidade_id","descricao"].includes(o)&&!i?.value?.length)s="Obrigat\xf3rio";else if("tipo_atividade_id"!=o||i?.value?.length||this.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO"))if(["data_distribuicao","data_estipulada_entrega"].includes(o)){let u=this.form?.controls.data_estipulada_entrega?.value,f=this.form?.controls.data_distribuicao?.value;this.util.isDataValid(i.value)?"data_distribuicao"==o&&i.value&&this.util.isDataValid(u)&&i.value.getTime()>u.getTime()?s="Maior que entrega":"data_estipulada_entrega"==o&&i.value&&this.util.isDataValid(f)&&i.value.getTime()<f.getTime()&&(s="Menor que distribui\xe7\xe3o"):s="Data inv\xe1lida"}else"plano_trabalho_id"==o&&!i.value?.length&&this.form?.controls?.usuario_id.value?.length?s="Obrigat\xf3rio":"plano_trabalho_entrega_id"==o&&(this.form?.controls?.plano_trabalho_id.value?.length&&!i.value?.length?s="Obrigat\xf3rio":i.value?.length&&!this.entregas.find(u=>u.key==i.value)&&(s="Selecione"));else s="Obrigat\xf3rio";return s},this.formValidation=i=>{let o;if(this.loadEtiquetas(),this.form.controls.tipo_atividade_id.value){let D=this.tipoAtividade?.selectedEntity.checklist;D&&this.form.controls.checklist.value.length==D.length&&this.loadChecklist()}const s=this.etiquetas.map(D=>D.key),u=this.checklist.map(D=>D.id),f=(this.form.controls.etiquetas.value||[]).find(D=>!s.includes(D.key)),K=(this.form.controls.checklist.value||[]).find(D=>!u.includes(D.id)&&D.checked);return f&&(o="Etiqueta "+f.value+"n\xe3o pode ser utilizada!"),K&&(o="Checklist "+K.texto+"n\xe3o pode ser utilizado!"),this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_distribuicao.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_estipulada_entrega.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(o="A atividade dever\xe1 ter per\xeddo compat\xedvel com o do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xe9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_5]"),o};const t=this.auth.hora;this.tipoAtividadeDao=a.get($.Y),this.unidadeDao=a.get(st.J),this.usuarioDao=a.get(ve.q),this.planoTrabalhoDao=a.get(be.t),this.atividadeService=a.get(lt.s),this.unidadeService=a.get(rt.Z),this.calendar=a.get(F.o),this.comentario=a.get(ge.K),this.title="Inclus\xe3o de "+this.lex.translate("Atividade"),this.form=this.fh.FormBuilder({numero:{default:0},descricao:{default:""},data_distribuicao:{default:t},carga_horaria:{default:0},tempo_planejado:{default:0},data_estipulada_entrega:{default:t},data_inicio:{default:null},data_entrega:{default:null},esforco:{default:0},tempo_despendido:{default:0},data_arquivamento:{default:null},etiquetas:{default:[]},checklist:{default:[]},prioridade:{default:0},progresso:{default:0},plano_trabalho_id:{default:null},plano_trabalho_entrega_id:{default:null},tipo_atividade_id:{default:null},demandante_id:{default:""},usuario_id:{default:null},unidade_id:{default:""},documento_requisicao_id:{default:null},documento_entrega_id:{default:null},comentarios:{default:[]},pausas:{default:[]},etiqueta:{default:""},tarefas:{default:[]},iniciado:{default:!1},concluido:{default:!1},documento_requisicao:{default:void 0},documento_entrega:{default:void 0}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef,this.validateChecklist),this.join=["usuario.planos_trabalho.tipo_modalidade:id,nome","pausas","tipo_atividade","unidade","comentarios.usuario","tarefas.tipo_tarefa","tarefas.comentarios.usuario","documento_requisicao","documento_entrega"]}ngOnInit(){super.ngOnInit();const a=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["comentar","clonar"].includes(a)?a:this.action}get isClonar(){return"clonar"==this.action}get titleAtividade(){return this.form?.controls.numero?.value?"#"+this.form?.controls.numero?.value:""}addItemHandleEtiquetas(){let a;if(this.etiqueta&&this.etiqueta.selectedItem){const t=this.etiqueta.selectedItem,i=t.key?.length?t.key:this.util.textHash(t.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,i)&&(a={key:i,value:t.value,color:t.color,icon:t.icon},this.form.controls.etiqueta.setValue(""))}return a}onUnidadeChange(a){this.loadEtiquetas()}onDataDistribuicaoChange(a){this.loadUsuario(this.usuario?.selectedEntity),this.form?.controls.data_estipulada_entrega.updateValueAndValidity()}onPrazoEntregaChange(a){this.form?.controls.data_distribuicao.updateValueAndValidity()}onPlanoTrabalhoChange(a){var t=this;(0,h.Z)(function*(){if(t.entity){const i=t.usuario?.selectedEntity?.planos_trabalho?.find(o=>o.id==t.form.controls.plano_trabalho_id.value);if(i){if(t.planoTrabalhoSelecionado?.id!=i.id&&(t.planoTrabalhoSelecionado=yield t.planoTrabalhoDao.getById(i.id,t.planoTrabalhoJoin)),t.form.controls.unidade_id.value!=i.unidade_id){const s=yield t.unidadeDao.getById(i.unidade_id);s&&(yield t.unidade?.loadSearch(s),yield t.auth.selecionaUnidade(s.id))}const o=t.form.controls.plano_trabalho_entrega_id.value;t.entregas=t.planoTrabalhoSelecionado?.entregas?.map(s=>Object.assign({},{key:s.id,value:s.descricao+(s.plano_entrega_entrega?" ("+s.plano_entrega_entrega?.descricao+")":""),data:s}))||[],t.cdRef.detectChanges(),t.form.controls.plano_trabalho_entrega_id.setValue(!o?.length&&t.entregas.length>0?t.entregas[0].key:o)}else t.entregas=[],t.form.controls.plano_trabalho_entrega_id.setValue(null)}})()}loadEtiquetas(){this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade?.selectedEntity,this.tipoAtividade?.selectedEntity)}loadChecklist(){const a=this.tipoAtividade?.selectedEntity;let t=a.checklist?.map(i=>({id:i.key,texto:i.value,checked:!1}));this.checklist=t||[],this.form.controls.checklist.setValue(t),this.atividadeService.buildChecklist(a,this.form.controls.checklist)}loadTipoAtividade(a){a?(this.loadEtiquetas(),this.loadChecklist()):(this.etiquetas=[],this.form.controls.esforco.setValue(0),this.form.controls.tempo_planejado.setValue(0)),this.cdRef.detectChanges()}getPlanosTrabalhos(a,t,i){return a.planos_trabalho?.filter(o=>o.id==i||this.util.between(t,{start:o.data_inicio,end:o.data_fim})&&"ATIVO"==o.status).map(o=>Object.assign({key:o.id,value:(o.tipo_modalidade?.nome||"")+" - "+this.usuarioDao.getDateFormatted(o.data_inicio)+" a "+this.usuarioDao.getDateFormatted(o.data_fim),data:o}))||[]}loadUsuario(a){if(a){const t=this.form.controls.plano_trabalho_id.value,i=this.form.controls.data_distribuicao.value||new Date;this.planosTrabalhos=this.getPlanosTrabalhos(a,i,t),this.hasUsuarioActionNew&&this.auth.usuario.id==this.form.controls.usuario_id.value&&this.form.controls.iniciado.setValue(!0),this.cdRef.detectChanges(),this.form.controls.plano_trabalho_id.setValue(!t?.length&&this.planosTrabalhos.length>0?this.planosTrabalhos[0].key:t)}else this.planosTrabalhos=[],this.form.controls.plano_trabalho_id.setValue(null);this.cdRef.detectChanges()}get hasUsuarioActionNew(){return this.form?.controls.usuario_id?.value?.length&&"new"==this.action}onTipoAtividadeSelect(a){const t=a.entity;this.loadTipoAtividade(t),this.atividadeService.comentarioAtividade(t,this.form.controls.comentarios),this.cdRef.detectChanges()}onTipoAtividadeChange(a){this.form?.controls.tipo_atividade_id.value?.length||this.loadTipoAtividade(void 0)}onUsuarioSelect(a){const t=a.entity;this.loadUsuario(t)}onUsuarioChange(a){this.form?.controls.usuario_id.value?.length||this.loadUsuario(void 0)}onConcluidoChange(a){this.hasUsuarioActionNew&&this.form.controls.concluido.value?(this.form.controls.iniciado.setValue(!0),this.form.controls.progresso.setValue(100)):this.form.controls.progresso.setValue(0)}orderPausas(a){return a.sort((t,i)=>t.data_inicio<i.data_inicio?-1:1)}loadData(a,t){var i=this;return(0,h.Z)(function*(){let o=Object.assign({},t.value);o=i.util.fillForm(o,a),i.planoTrabalhoSelecionado=a.plano_trabalho,yield Promise.all([i.unidade?.loadSearch(a.unidade||o.unidade_id,!1),i.usuario?.loadSearch(a.usuario||o.usuario_id,!1),i.tipoAtividade?.loadSearch(a.tipo_atividade||o.tipo_atividade_id,!1)]),t.patchValue(o,{emitEvent:!1}),a.usuario&&i.loadUsuario(a.usuario),a.tipo_atividade&&i.loadTipoAtividade(a.tipo_atividade),a.unidade_id!=i.auth.unidade.id&&(yield i.auth.selecionaUnidade(a.unidade_id)),a.comentarios=i.comentario.orderComentarios(a.comentarios||[]),a.pausas=i.orderPausas(a.pausas||[]),t.patchValue(i.util.fillForm(o,i.form.value)),i.loadEtiquetas()})()}initializeData(a){var t=this;return(0,h.Z)(function*(){if(t.isClonar){const i=yield t.dao.getAtividade(t.urlParams.get("id"));t.entity=new d.a,Object.assign(t.entity,{tipo_atividade:i.tipo_atividade,unidade:i.unidade,usuario:i.usuario,plano_trabalho:i.plano_trabalho,descricao:i.descricao,data_distribuicao:i.data_distribuicao,tempo_planejado:i.tempo_planejado,carga_horaria:i.carga_horaria,data_estipulada_entrega:i.data_estipulada_entrega,esforco:i.esforco,tipo_atividade_id:i.tipo_atividade_id,demandante_id:t.auth.usuario?.id,usuario_id:i.usuario_id,unidade_id:i.unidade_id,plano_trabalho_id:i.plano_trabalho_id,etiquetas:i.etiquetas,checklist:i.checklist,metadados:i.metadados,plano_trabalho_entrega_id:i.plano_trabalho_entrega_id,progresso:i.progresso,tarefas:(i.tarefas||[]).map(o=>new he.l(Object.assign({},o,{id:t.dao.generateUuid(),comentarios:[],_status:"ADD"}))),documento_requisicao:i.documento_requisicao?Object.assign({},new Q.U(Object.assign({},i.documento_requisicao,{id:t.dao.generateUuid(),_status:"ADD"}))):void 0,documento_entrega:i.documento_entrega?Object.assign({},new Q.U(Object.assign({},i.documento_entrega,{id:t.dao.generateUuid(),_status:"ADD"}))):void 0})}else if(t.sei=t.metadata?.sei,t.entity=new d.a,t.entity.data_distribuicao=t.auth.hora,t.entity.data_estipulada_entrega=t.entity.data_distribuicao,t.entity.demandante_id=t.auth.usuario?.id||"",t.entity.unidade_id=t.auth.unidade?.id||"",t.entity.unidade=t.auth.unidade,t.entity.metadados={atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!1,concluido:!1,avaliado:!1,arquivado:!1,produtividade:0,consolidacoes:[]},!t.unidadeService.isGestorUnidade(t.entity.unidade_id)){let i=yield t.usuarioDao.getById(t.auth.usuario.id,t.usuarioJoin);t.entity.usuario_id=i?.id||null,t.entity.usuario=i||void 0}yield t.loadData(t.entity,a)})()}saveData(a){return new Promise((t,i)=>{let o=this.util.fill(new d.a,this.entity);if(this.comentarios?.confirm(),o=this.util.fillForm(o,this.form.value),this.hasUsuarioActionNew&&this.form.controls.iniciado.value&&(o.data_inicio=o.data_distribuicao,o.status="INICIADO",this.form.controls.concluido.value)){let s=this.calendar.calculaDataTempoUnidade(o.data_inicio,o.data_estipulada_entrega,this.planoTrabalhoSelecionado.carga_horaria,this.unidade?.selectedEntity,"ENTREGA");o.data_entrega=o.data_estipulada_entrega,o.progresso=100,o.tempo_despendido=s?.tempoUtil||0,o.status="CONCLUIDO"}o.documento_requisicao=this.requisicao?.documento,o.comentarios=o.comentarios.filter(s=>["ADD","EDIT","DELETE"].includes(s._status||"")&&s.texto?.length),o.tarefas=o.tarefas.filter(s=>(s.comentarios=s.comentarios.filter(u=>["ADD","EDIT","DELETE"].includes(u._status||"")&&u.texto?.length),["ADD","EDIT","DELETE"].includes(s._status||""))),t(o)})}}(G=U).\u0275fac=function(a){return new(a||G)(e.Y36(e.zs3))},G.\u0275cmp=e.Xpm({type:G,selectors:[["app-atividade-form"]],viewQuery:function(a,t){if(1&a&&(e.Gf(A.Q,5),e.Gf(dt,5),e.Gf(ct,5),e.Gf(ut,5),e.Gf(pt,5),e.Gf(mt,5),e.Gf(_t,5),e.Gf(ft,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.editableForm=i.first),e.iGM(i=e.CRH())&&(t.etiqueta=i.first),e.iGM(i=e.CRH())&&(t.tipoAtividade=i.first),e.iGM(i=e.CRH())&&(t.planoTrabalho=i.first),e.iGM(i=e.CRH())&&(t.unidade=i.first),e.iGM(i=e.CRH())&&(t.usuario=i.first),e.iGM(i=e.CRH())&&(t.comentarios=i.first),e.iGM(i=e.CRH())&&(t.requisicao=i.first)}},features:[e.qOj],decls:26,vars:38,consts:[["initialFocus","descricao",3,"form","disabled","submit","cancel"],["display","","right","",3,"title"],["key","ATIVIDADE",3,"label"],[3,"sei","documento"],["requisicao",""],[1,"row"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","unidade_id","required","",3,"label","size","dao","change"],["unidade",""],["controlName","tipo_atividade_id",3,"label","emptyValue","size","dao","labelInfo","required","select","change"],["tipoAtividade",""],["label","Iniciado","controlName","iniciado",3,"size","disabled",4,"ngIf"],["label","Conclu\xeddo","controlName","concluido",3,"size","change",4,"ngIf"],["controlName","usuario_id","labelInfo","Participante respons\xe1vel pela execu\xe7\xe3o",3,"label","size","emptyValue","dao","join","select","change"],["usuario",""],["controlName","plano_trabalho_id",3,"label","size","control","items","labelInfo","change"],["planoTrabalho",""],["controlName","plano_trabalho_entrega_id",3,"label","size","control","items","labelInfo"],["entrega",""],["class","row",4,"ngIf","ngIfElse"],["comEsforco",""],["title","Conclus\xe3o",4,"ngIf"],["label","Iniciado","controlName","iniciado",3,"size","disabled"],["label","Conclu\xeddo","controlName","concluido",3,"size","change"],["noIcon","","controlName","data_distribuicao","labelInfo","Data de inclus\xe3o/distribui\xe7\xe3o/lan\xe7amento",3,"size","label","control","change"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega","labelInfo","Data estipulada para entrega da atividade",3,"size","label","control","change"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xe7\xe3o",3,"size","label","control"],["title","Conclus\xe3o"],["comTempoDespendido",""],[3,"documento"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","","labelInfo","Data em que o usu\xe1rio iniciou a atividade",3,"size","control"],["noIcon","","label","Conclus\xe3o","controlName","data_entrega","disabled","","labelInfo","Data da conclus\xe3o da atividade",3,"size","control"],["label","Data de arquivamento","controlName","data_arquivamento","disabled","","labelInfo","Data de arquivamento da atividade",3,"size","control"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","","labelInfo","Calculado no fim da atividade, sendo o tempo l\xedquido (considerando pausas)",3,"size","control"]],template:function(a,t){if(1&a&&(e.TgZ(0,"editable-form",0),e.NdJ("submit",function(){return t.onSaveData()})("cancel",function(){return t.onCancel()}),e.TgZ(1,"tabs",1)(2,"tab",2),e._UZ(3,"documento-link",3,4),e.TgZ(5,"div",5),e._UZ(6,"input-textarea",6),e.qZA(),e.TgZ(7,"div",5)(8,"input-search",7,8),e.NdJ("change",function(o){return t.onUnidadeChange(o)}),e.qZA(),e.TgZ(10,"input-search",9,10),e.NdJ("select",function(o){return t.onTipoAtividadeSelect(o)})("change",function(o){return t.onTipoAtividadeChange(o)}),e.qZA(),e.YNc(12,ht,1,2,"input-switch",11),e.YNc(13,gt,1,1,"input-switch",12),e.qZA(),e.TgZ(14,"div",5)(15,"input-search",13,14),e.NdJ("select",function(o){return t.onUsuarioSelect(o)})("change",function(o){return t.onUsuarioChange(o)}),e.qZA(),e.TgZ(17,"input-select",15,16),e.NdJ("change",function(o){return t.onPlanoTrabalhoChange(o)}),e.qZA()(),e.TgZ(19,"div",5),e._UZ(20,"input-select",17,18),e.qZA(),e.YNc(22,vt,4,8,"div",19),e.YNc(23,bt,5,11,"ng-template",null,20,e.W1O),e.YNc(25,Tt,5,3,"separator",21),e.qZA()()()),2&a){const i=e.MAs(18),o=e.MAs(24);e.Q6J("form",t.form)("disabled",t.formDisabled),e.xp6(1),e.Q6J("title",t.titleAtividade),e.xp6(1),e.Q6J("label",t.lex.translate("Atividade")),e.xp6(1),e.Q6J("sei",t.sei)("documento",t.form.controls.documento_requisicao.value),e.xp6(3),e.Q6J("size",12)("rows",2)("control",t.form.controls.descricao),e.xp6(2),e.Q6J("label",t.lex.translate("Unidade"))("size",t.hasUsuarioActionNew?5:6)("dao",t.unidadeDao),e.xp6(2),e.Q6J("label","Tipo de "+t.lex.translate("atividade"))("emptyValue",null)("size",t.hasUsuarioActionNew?5:6)("dao",t.tipoAtividadeDao)("labelInfo",t.lex.translate("Tipo de atividade")+" utilizado para classificar a atividade")("required",t.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true"),e.xp6(2),e.Q6J("ngIf",t.hasUsuarioActionNew),e.xp6(1),e.Q6J("ngIf",t.hasUsuarioActionNew),e.xp6(2),e.Q6J("label",t.lex.translate("Respons\xe1vel"))("size",6)("emptyValue",null)("dao",t.usuarioDao)("join",t.usuarioJoin),e.xp6(2),e.Q6J("label",t.lex.translate("Plano de trabalho"))("size",6)("control",t.form.controls.plano_trabalho_id)("items",t.planosTrabalhos)("labelInfo",t.lex.translate("Plano de trabalho")),e.xp6(3),e.Q6J("label",t.lex.translate("Entrega")+" (Descri\xe7\xe3o dos trabalhos)")("size",12)("control",t.form.controls.plano_trabalho_entrega_id)("items",t.entregas)("labelInfo",t.lex.translate("Entrega")+t.lex.translate(" plano de trabalho")+" que a "+t.lex.translate("atividade")+" \xe9 referente"),e.xp6(2),e.Q6J("ngIf",!(null!=i&&null!=i.selectedItem&&null!=i.selectedItem.data&&null!=i.selectedItem.data.tipo_modalidade&&i.selectedItem.data.tipo_modalidade.atividade_esforco))("ngIfElse",o),e.xp6(3),e.Q6J("ngIf",t.form.controls.data_entrega.value)}},dependencies:[g.O5,A.Q,Z.a,T.V,le.Q,q.k,x.p,ee.u,re.n,de.i,O.N,w.l,k]});var B,ue=r(48644),De=r(17112);function Dt(n,a){if(1&n&&e._UZ(0,"atividade-list-grid",6),2&n){const t=e.oxw();e.Q6J("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)("minhas",!t.eGestor)}}function Et(n,a){if(1&n&&e._UZ(0,"atividade-list-kanban",6),2&n){const t=e.oxw();e.Q6J("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)("minhas",!t.eGestor)}}function yt(n,a){if(1&n&&e._UZ(0,"atividade-dashboard",9),2&n){const t=e.oxw(2);e.Q6J("snapshot",t.snapshot||t.modalRoute||t.route.snapshot)}}function It(n,a){if(1&n&&(e.TgZ(0,"tab",7),e.YNc(1,yt,1,1,"ng-template",null,8,e.W1O),e.qZA()),2&n){const t=e.MAs(2);e.Q6J("template",t)}}class pe extends De._{constructor(a){super(a),this.injector=a,this.activeTab="TABELA",this.eGestor=this.auth.unidadeGestor(),this.title=this.lex.translate("Atividades"),this.code="MOD_DMD"}ngOnInit(){super.ngOnInit(),this.activeTab=this.usuarioConfig.active_tab||"TABELA"}onSelectTab(a){var t=this;return(0,h.Z)(function*(){t.activeTab=a.key,t.viewInit&&t.saveUsuarioConfig({active_tab:t.activeTab})})()}}(B=pe).\u0275fac=function(a){return new(a||B)(e.Y36(e.zs3))},B.\u0275cmp=e.Xpm({type:B,selectors:[["app-atividade-list"]],features:[e.qOj],decls:8,vars:6,consts:[["right","",3,"title","select","active"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["grid",""],["key","KANBAN","icon","bi bi-card-heading","label","Quadro",3,"template"],["kanban",""],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template",4,"ngIf"],[3,"snapshot","minhas"],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template"],["dashboard",""],[3,"snapshot"]],template:function(a,t){if(1&a&&(e.TgZ(0,"tabs",0)(1,"tab",1),e.YNc(2,Dt,1,2,"ng-template",null,2,e.W1O),e.qZA(),e.TgZ(4,"tab",3),e.YNc(5,Et,1,2,"ng-template",null,4,e.W1O),e.qZA(),e.YNc(7,It,3,1,"tab",5),e.qZA()),2&a){const i=e.MAs(3),o=e.MAs(6);e.Q6J("title",t.isModal?"":t.title)("select",t.onSelectTab.bind(t))("active",t.activeTab),e.xp6(1),e.Q6J("template",i),e.xp6(3),e.Q6J("template",o),e.xp6(3),e.Q6J("ngIf",!1)}}});var H,Zt=r(77447),me=r(95489),Ee=r(69756),qt=r(19108);function Ot(n,a){if(1&n&&e._UZ(0,"planejamento-show",10),2&n){const t=e.oxw(2);e.Q6J("planejamento",t.atividade.planejamento)}}function xt(n,a){if(1&n&&(e.TgZ(0,"div",11)(1,"h6"),e._uU(2,"Cadeia de valor:"),e.qZA(),e.TgZ(3,"h4"),e._uU(4),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.Oqu(t.atividade.cadeiaValor.nome)}}function Nt(n,a){1&n&&(e.ynx(0),e._UZ(1,"i",15),e.BQk())}const ye=function(){return[]};function kt(n,a){if(1&n&&(e.TgZ(0,"div")(1,"div",14),e.YNc(2,Nt,2,0,"ng-container",13),e.TgZ(3,"h5"),e._uU(4),e.qZA()()()),2&n){const t=a.$implicit,i=a.index;e.xp6(2),e.Q6J("ngForOf",e.DdM(2,ye).constructor(i)),e.xp6(2),e.Oqu(t.nome)}}function Qt(n,a){if(1&n&&(e.TgZ(0,"div",12)(1,"h6"),e._uU(2,"Objetivos:"),e.qZA(),e.YNc(3,kt,5,3,"div",13),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.atividade.objetivos)}}function Ut(n,a){if(1&n&&(e.TgZ(0,"div")(1,"h5"),e._uU(2),e.qZA()()),2&n){const t=a.$implicit;e.xp6(2),e.Oqu(t.nome)}}function Jt(n,a){if(1&n&&(e.TgZ(0,"div",16)(1,"h6"),e._uU(2,"Processos:"),e.qZA(),e.YNc(3,Ut,3,1,"div",13),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.atividade.processos)}}function Pt(n,a){1&n&&(e.ynx(0),e._UZ(1,"i",15),e.BQk())}function Ft(n,a){if(1&n&&(e.TgZ(0,"div")(1,"div",14),e.YNc(2,Pt,2,0,"ng-container",13),e.TgZ(3,"div",18)(4,"h5",8),e._uU(5),e.qZA(),e.TgZ(6,"div",19)(7,"span",20)(8,"b",21),e._uU(9,"Meta:"),e.qZA(),e._UZ(10,"badge",22),e.qZA(),e.TgZ(11,"span",23)(12,"b",21),e._uU(13,"Realizado:"),e.qZA(),e._UZ(14,"badge",24),e.qZA(),e.TgZ(15,"span",25)(16,"b",26),e._uU(17,"Progresso:"),e.qZA(),e._UZ(18,"progress-bar",27),e.qZA()()()(),e._UZ(19,"hr"),e.qZA()),2&n){const t=a.$implicit,i=a.index,o=e.oxw(3);e.xp6(2),e.Q6J("ngForOf",e.DdM(6,ye).constructor(i)),e.xp6(3),e.hij(" ",t.descricao," "),e.xp6(5),e.Q6J("label",o.planoEntregaService.getValorMeta(t)),e.xp6(4),e.Q6J("label",o.planoEntregaService.getValorRealizado(t)),e.xp6(4),e.Q6J("value",t.progresso_realizado)("goal",t.progresso_esperado)}}function zt(n,a){if(1&n&&(e.TgZ(0,"div",17)(1,"h6"),e._uU(2,"Entrega do plano de entregas:"),e.qZA(),e.YNc(3,Ft,20,7,"div",13),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.Q6J("ngForOf",t.atividade.entregasPlanoEntrega)}}function wt(n,a){if(1&n&&(e.ynx(0),e.TgZ(1,"div",1),e.YNc(2,Ot,1,1,"planejamento-show",2),e.YNc(3,xt,5,1,"div",3),e.qZA(),e.TgZ(4,"div",1),e.YNc(5,Qt,4,1,"div",4),e.YNc(6,Jt,4,1,"div",5),e.qZA(),e.YNc(7,zt,4,1,"div",6),e.TgZ(8,"div",7)(9,"h6"),e._uU(10,"Aloca\xe7\xe3o:"),e.qZA(),e.TgZ(11,"h5",8),e._uU(12),e.qZA(),e.TgZ(13,"p"),e._uU(14,"For\xe7a de trabalho: "),e.TgZ(15,"b"),e._uU(16),e.qZA()()(),e.TgZ(17,"div",9)(18,"h6"),e._uU(19,"Atividade:"),e.qZA(),e.TgZ(20,"h5",8),e._uU(21),e.qZA(),e.TgZ(22,"p"),e._uU(23,"Data estipulada para entrega: "),e.TgZ(24,"b"),e._uU(25),e.qZA()()(),e.BQk()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.atividade.planejamento),e.xp6(1),e.Q6J("ngIf",t.atividade.cadeiaValor),e.xp6(2),e.Q6J("ngIf",t.atividade.objetivos),e.xp6(1),e.Q6J("ngIf",null==t.atividade.processos?null:t.atividade.processos.length),e.xp6(1),e.Q6J("ngIf",t.atividade.entregasPlanoEntrega),e.xp6(5),e.Oqu(t.atividade.entregaPlanoTrabalho.descricao),e.xp6(4),e.hij("",t.atividade.entregaPlanoTrabalho.forca_trabalho,"%"),e.xp6(5),e.Oqu(t.atividade.atividade.descricao),e.xp6(4),e.Oqu(t.util.getDateTimeFormatted(t.atividade.atividade.data_estipulada_entrega))}}class Ie extends De._{constructor(a){super(a),this.injector=a,this.atividadeDao=a.get(I.P),this.planoEntregaService=a.get(Zt.f)}ngOnInit(){super.ngOnInit(),this.urlParams.get("id")&&this.loadAtividade(this.urlParams.get("id"))}loadAtividade(a){var t=this;return(0,h.Z)(function*(){const i=yield t.atividadeDao.getHierarquia(a);i&&(t.atividade=i)})()}}var J;(H=Ie).\u0275fac=function(a){return new(a||H)(e.Y36(e.zs3))},H.\u0275cmp=e.Xpm({type:H,selectors:[["atividade-hierarquia"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex","align-items-stretch"],[3,"planejamento",4,"ngIf"],["class","cadeiaValor arrow_box first-box w-100 ms-3",4,"ngIf"],["class","objetivos arrow_box w-100",4,"ngIf"],["class","procesos arrow_box w-100 ms-3",4,"ngIf"],["class","plano_entrega_entrega arrow_box",4,"ngIf"],[1,"plano_trabalho_entrega","arrow_box"],[1,"mb-2"],[1,"atividade","arrow_box"],[3,"planejamento"],[1,"cadeiaValor","arrow_box","first-box","w-100","ms-3"],[1,"objetivos","arrow_box","w-100"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"bi","bi-chevron-right"],[1,"procesos","arrow_box","w-100","ms-3"],[1,"plano_entrega_entrega","arrow_box"],[1,"ms-3","flex-grow-1","d-flex","flex-column"],[1,"d-flex","justify-content-start","align-items-center","m-0"],[1,"text-center"],[1,"d-block"],["icon","bi bi-graph-up-arrow","color","light",3,"label"],[1,"text-center","ms-3"],["icon","bi bi-check-lg","color","light",3,"label"],[1,"ms-3","flex-fill"],[1,""],["color","success",3,"value","goal"]],template:function(a,t){1&a&&e.YNc(0,wt,26,9,"ng-container",0),2&a&&e.Q6J("ngIf",t.atividade)},dependencies:[g.sg,g.O5,me.F,Ee.R,qt.W],styles:["h6[_ngcontent-%COMP%]{border-bottom:1px solid rgba(194,225,245,.14);padding-bottom:5px;color:var(--bs-body-color)}h5[_ngcontent-%COMP%]{color:var(--bs-body-color);font-weight:300;margin:0}"]});const Mt=[{path:"",component:pe,canActivate:[b.a],resolve:{config:C.o},data:{title:"Atividades"}},{path:"grid",component:ue.N,canActivate:[b.a],resolve:{config:C.o},data:{title:"Atividades"}},{path:"new",component:U,canActivate:[b.a],resolve:{config:C.o},data:{title:"",modal:!0}},{path:"tarefa",component:ce,canActivate:[b.a],resolve:{config:C.o},data:{title:"Tarefa da Atividade",modal:!0}},{path:"tarefa/concluir",component:E.u,canActivate:[b.a],resolve:{config:C.o},data:{title:"Concluir Tarefa",modal:!0}},{path:"tarefa/:tarefa_id/comentar",component:ce,canActivate:[b.a],resolve:{config:C.o},data:{title:"Coment\xe1rios",modal:!0}},{path:":id/edit",component:U,canActivate:[b.a],resolve:{config:C.o},data:{title:"Edi\xe7\xe3o da Atividade",modal:!0}},{path:":id/consult",component:U,canActivate:[b.a],resolve:{config:C.o},data:{title:"Consulta a Atividade",modal:!0}},{path:":id/clonar",component:U,canActivate:[b.a],resolve:{config:C.o},data:{title:"Clone de Atividade",modal:!0}},{path:":id/iniciar",component:Ce,canActivate:[b.a],resolve:{config:C.o},data:{title:"In\xedcio de Atividade",modal:!0}},{path:":id/concluir",component:fe,canActivate:[b.a],resolve:{config:C.o},data:{title:"Conclus\xe3o de Atividade",modal:!0}},{path:":id/pausar",component:Ae,canActivate:[b.a],resolve:{config:C.o},data:{title:"Suspens\xe3o de Atividade",modal:!0}},{path:":id/prorrogar",component:Te,canActivate:[b.a],resolve:{config:C.o},data:{title:"Prorroga\xe7\xe3o de Atividade",modal:!0}},{path:":id/comentar",component:U,canActivate:[b.a],resolve:{config:C.o},data:{title:"Coment\xe1rios de Atividade",modal:!0}},{path:":id/hierarquia",component:Ie,canActivate:[b.a],resolve:{config:C.o},data:{title:"Hierarquia da Atividade",modal:!0}}];class Ze{}(J=Ze).\u0275fac=function(a){return new(a||J)},J.\u0275mod=e.oAB({type:J}),J.\u0275inj=e.cJS({imports:[X.Bz.forChild(Mt),X.Bz]});var Y,St=r(58568),Rt=r(32864),qe=r(94180);const Vt=["filterRef"],Lt=["kanbanEtiquetas"],Gt=["dockerNaoIniciado"],Bt=["dockerPausado"],Ht=["dockerIniciado"],Yt=["dockerConcluido"],jt=["planoEntrega"],Kt=["planoEntregaEntrega"];function Wt(n,a){if(1&n){const t=e.EpF();e.TgZ(0,"badge",35),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().card,s=e.oxw();return e.KtG(s.onEntregaClick(o.data))}),e.qZA()}if(2&n){const t=e.oxw().card,i=e.oxw();e.Q6J("icon",i.entityService.getIcon("Entrega"))("label",t.data.plano_trabalho_entrega.descricao)}}function Xt(n,a){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"profile-picture",36),e.qZA()),2&n){const t=e.oxw().card;e.xp6(1),e.Q6J("url",t.data.usuario.url_foto)("hint","Respons\xe1vel: "+((null==t.data.usuario?null:t.data.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio"))}}function $t(n,a){if(1&n&&e._UZ(0,"badge",44),2&n){const t=a.$implicit,i=e.oxw(3);e.Q6J("color",t.color)("label",t.label)("icon",t.icon)("data",t)("click",t.data.filter?i.onStatusClick.bind(i):void 0)}}function ea(n,a){if(1&n&&e._UZ(0,"badge",44),2&n){const t=a.$implicit,i=e.oxw(3);e.Q6J("color",t.color)("label",t.value)("icon",t.icon)("data",t)("click",i.onEtiquetaClick.bind(i))}}function ta(n,a){1&n&&e._UZ(0,"separator",45)}function aa(n,a){1&n&&e._UZ(0,"i",49)}function ia(n,a){if(1&n&&(e.TgZ(0,"tr")(1,"td"),e.YNc(2,aa,1,0,"i",47),e.qZA(),e.TgZ(3,"td",48),e._uU(4),e.qZA()()),2&n){const t=a.$implicit;e.xp6(2),e.Q6J("ngIf",t.checked),e.xp6(2),e.Oqu(t.texto)}}function oa(n,a){if(1&n&&(e.TgZ(0,"table"),e.YNc(1,ia,5,2,"tr",46),e.qZA()),2&n){const t=e.oxw(2).card;e.xp6(1),e.Q6J("ngForOf",t.data.checklist)}}function na(n,a){if(1&n&&(e.TgZ(0,"small"),e._uU(1),e.qZA()),2&n){const t=a.$implicit;e.xp6(1),e.Oqu(t.descricao)}}function sa(n,a){if(1&n&&(e.TgZ(0,"separator",50),e.YNc(1,na,2,1,"small",46),e.qZA()),2&n){const t=e.oxw(2).card;e.Q6J("title","Tarefas ("+(null==t.data.tarefas?null:t.data.tarefas.length)+")")("collapsed",!0),e.xp6(1),e.Q6J("ngForOf",t.data.tarefas)}}function la(n,a){if(1&n&&(e.ynx(0),e.TgZ(1,"div",37),e._UZ(2,"documentos-badge",38),e.YNc(3,$t,1,5,"badge",39),e.YNc(4,ea,1,5,"badge",39),e.qZA(),e.YNc(5,ta,1,0,"separator",40),e.YNc(6,oa,2,1,"table",34),e._UZ(7,"reaction",41),e.YNc(8,sa,2,3,"separator",42),e._UZ(9,"comentarios-widget",43),e.BQk()),2&n){const t=e.oxw().card,i=e.oxw();e.xp6(2),e.Q6J("documento",t.data.documento_requisicao),e.xp6(1),e.Q6J("ngForOf",i.atividadeService.getStatus(t.data)),e.xp6(1),e.Q6J("ngForOf",t.data.etiquetas),e.xp6(1),e.Q6J("ngIf",null==t.data.checklist?null:t.data.checklist.length),e.xp6(1),e.Q6J("ngIf",null==t.data.checklist?null:t.data.checklist.length),e.xp6(1),e.Q6J("entity",t.data),e.xp6(1),e.Q6J("ngIf",null==t.data.tarefas?null:t.data.tarefas.length),e.xp6(1),e.Q6J("entity",t.data)("selectable",!1)("query",i.query)}}function ra(n,a){if(1&n&&(e.YNc(0,Wt,1,2,"badge",25),e.TgZ(1,"div",26)(2,"div",27)(3,"div",28)(4,"span",29),e._uU(5),e.qZA(),e.TgZ(6,"span",29),e._UZ(7,"i",30),e._uU(8),e.qZA(),e.TgZ(9,"span",31),e._UZ(10,"i"),e._uU(11),e.qZA()(),e.TgZ(12,"span",32),e._UZ(13,"i",33),e._uU(14),e.qZA()(),e.YNc(15,Xt,2,2,"div",34),e.qZA(),e.YNc(16,la,10,10,"ng-container",34)),2&n){const t=a.card,i=e.oxw();e.Q6J("ngIf",t.data.plano_trabalho_entrega),e.xp6(5),e.hij(" #",t.data.numero," "),e.xp6(3),e.hij(" ",t.data.unidade.sigla," "),e.xp6(1),e.MGl("title","Respons\xe1vel: ",(null==t.data.usuario?null:t.data.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio",""),e.xp6(1),e.Tol("bi "+(null!=t.data.usuario&&null!=t.data.usuario.nome&&t.data.usuario.nome.length?"bi-person-check":"bi-person-x")),e.xp6(1),e.hij(" ",i.util.apelidoOuNome(t.data.usuario,!0)||"(N\xe3o atribu\xeddo)"," "),e.xp6(1),e.MGl("title","Demandante: ",(null==t.data.demandante?null:t.data.demandante.nome)||"Desconhecido",""),e.xp6(2),e.hij(" ",i.util.apelidoOuNome(t.data.demandante,!0)||"Desconhecido"," "),e.xp6(1),e.Q6J("ngIf",t.data.usuario),e.xp6(1),e.Q6J("ngIf",!(null!=i.filter&&null!=i.filter.controls&&null!=i.filter.controls.resumido&&i.filter.controls.resumido.value))}}function da(n,a){if(1&n&&e._UZ(0,"input-select",51),2&n){const t=e.oxw();e.Q6J("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetasEdit)}}function ca(n,a){1&n&&(e.TgZ(0,"div",52)(1,"div",26)(2,"div",27)(3,"h5",53),e._UZ(4,"span",54),e.qZA()(),e.TgZ(5,"div",55)(6,"button",56),e._UZ(7,"i",57),e.qZA()()(),e.TgZ(8,"h6",58),e._UZ(9,"span",59),e.qZA(),e.TgZ(10,"p",60),e._UZ(11,"span",61)(12,"span",62)(13,"span",62)(14,"span",54)(15,"span",59),e.qZA()())}function ua(n,a){if(1&n&&(e.TgZ(0,"kanban",63)(1,"swimlane"),e._UZ(2,"docker",64,65),e.qZA(),e.TgZ(4,"swimlane"),e._UZ(5,"docker",66,67)(7,"docker",68,69),e.qZA(),e.TgZ(9,"swimlane"),e._UZ(10,"docker",70,71),e.qZA()()),2&n){const t=e.oxw(),i=e.MAs(22),o=e.MAs(26);e.Q6J("template",i)("placeholderTemplate",o)("loading",t.loading)("dragSwimlanes",!1),e.xp6(2),e.Q6J("collapse",t.cardsConfig.naoIniciado)("toggle",t.onDockerCollapse.bind(t))("menu",t.menuDockerNaoIniciado)("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.NAOINICIADO]))("cards",t.cards[t.NAOINICIADO]),e.xp6(3),e.Q6J("collapse",t.cardsConfig.iniciado)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.INICIADO]))("cards",t.cards[t.INICIADO]),e.xp6(2),e.Q6J("collapse",t.cardsConfig.pausado)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.PAUSADO]))("cards",t.cards[t.PAUSADO]),e.xp6(3),e.Q6J("collapse",t.cardsConfig.concluido)("toggle",t.onDockerCollapse.bind(t))("dragged",t.onDragged.bind(t))("drop",t.onDrop.bind(t))("dropIf",t.canDrop(t.DOCKERS[t.CONCLUIDO]))("cards",t.cards[t.CONCLUIDO])}}function pa(n,a){if(1&n&&e._UZ(0,"kanban",72,73),2&n){const t=e.oxw(),i=e.MAs(22),o=e.MAs(26),s=e.MAs(24);e.Q6J("dockers",t.labels)("template",i)("placeholderTemplate",o)("loading",t.loading)("swimlaneDrop",t.onSwimlaneDrop.bind(t))("dockerDragged",t.onDragged.bind(t))("dockerDrop",t.onDrop.bind(t))("dockerEditTemplate",s)("dockerToggle",t.onDockerCollapse.bind(t))("dockerEdit",t.editEtiquetas.bind(t))("dockerSave",t.saveEtiquetas.bind(t))("dockerDelete",t.deleteEtiquetas.bind(t))("dockerCancel",t.cancelEtiquetas.bind(t))("dockerColorStyle",t.getLabelStyle)}}class _e extends qe.x{constructor(a){var t,i;super(a),t=this,this.injector=a,this.minhas=!1,this.TITLE_OUTRAS="Outras",this.NAOINICIADO=0,this.PAUSADO=1,this.INICIADO=2,this.CONCLUIDO=3,this.AVALIADO=4,this.DOCKERS=["NAOINICIADO","PAUSADO","INICIADO","CONCLUIDO"],this.cards=[[],[],[],[]],this.cardsConfig={naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},this.labels=[],this.cardsVersion=0,this.dragDrop={},this.rowsLimit=500,this.kanbanQueryOptions={},this.etiquetasEdit=[],this.planosEntregas=[],this.planosEntregasEntregas=[],this.toolbarButtons=[{icon:"bi bi-search",label:"Filtros",onClick:()=>this.filterRef?.toggle()},{icon:"bi bi-plus-circle",color:"btn-outline-success",label:"Incluir",onClick:(i=(0,h.Z)(function*(){return yield t.add()}),function(){return i.apply(this,arguments)})}],this.outrasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.etiquetasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.menuDockerNaoIniciado=[{icon:"bi bi-plus-circle",color:"btn-outline-primary",hint:"Incluir",onClick:function(){var i=(0,h.Z)(function*(){return yield t.add()});return function(){return i.apply(this,arguments)}}()}],this.filterWhere=i=>{let o=this.fixedFilter||[],s=i.value;return s.somente_unidade_atual&&s.unidade_id!=this.auth.unidade?.id&&(i.controls.unidade_id.setValue(this.auth.unidade?.id),s.unidade_id=this.auth.unidade?.id),s.atribuidas_para_mim&&s.usuario_id!=this.auth.usuario?.id&&(i.controls.usuario_id.setValue(this.auth.usuario?.id),s.usuario_id=this.auth.usuario.id),s.usuario_id?.length&&o.push(["usuario_id","==",s.usuario_id]),s.unidade_id?.length&&o.push(["unidade_id","==",s.unidade_id]),s.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),s.etiquetas?.length&&o.push(["etiquetas","in",s.etiquetas.map(u=>u.value)]),s.numero_processo?.length&&o.push(["numero_processo","==",s.numero_processo]),s.status?.length&&!o.find(u=>"status"==u[0])&&o.push(["status","==",s.status]),s.plano_entrega_id?.length&&o.push(["plano_entrega_id","==",s.plano_entrega_id]),s.plano_entrega_entrega_id?.length&&o.push(["plano_entrega_entrega_id","==",s.plano_entrega_entrega_id]),o.push(["data_arquivamento","==",null]),o},this.code="MOD_DMD",this.filter=this.fh.FormBuilder({atribuidas_para_mim:{default:this.minhas},usuario_id:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},unidade_id:{default:""},numero_processo:{default:""},status:{default:""},usarEtiquetas:{default:!!this.usuarioConfig?.kanban_usar_etiquetas},resumido:{default:!!this.usuarioConfig?.kanban_resumido},etiquetas:{default:[]},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({etiqueta:{default:null}}),this.cardsConfig=Object.assign(this.cardsConfig,this.usuarioConfig?.kanban_status_dockers),this.groupBy=[],this.loadEtiquetas(),this.loadLabel()}defaultUsuarioConfig(){return Object.assign(super.defaultUsuarioConfig(),{active_tab:"TABELA",kanban_resumido:!1,kanban_usar_etiquetas:!1,kanban_status_dockers:{naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},kanban_etiquetas_dockers:[]})}ngAfterViewInit(){super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.query.onLoadingChange=a=>{this.loading=a,this.cdRef.detectChanges()},this.loading=this.query.loading,this.query.subject.asObservable().subscribe(this.onQueryLoad.bind(this)),this.cdRef.detectChanges()}isOutras(a){return a.title==this.TITLE_OUTRAS&&!a.labels.length}loadLabel(){const a=[...this.usuarioConfig?.kanban_etiquetas_dockers||[]];a.find(this.isOutras.bind(this))||a.splice(0,0,{title:this.TITLE_OUTRAS,labels:[],collapse:!1}),this.labels=a.reduce((t,i)=>(t.find(o=>o.title?.length&&o.title==i.title||o.labels?.length&&i.labels?.length&&o.labels[0].key==i.labels[0].key)||t.push({labels:this.isOutras(i)?[]:i.labels,title:i.title,menu:this.isOutras(i)?this.outrasButtons:this.etiquetasButtons,cards:[],editing:!1,collapse:i.collapse}),t),[])}get isEtiquetas(){return!!this.filter?.controls?.usarEtiquetas?.value}onUsarEtiquetasChange(a){this.saveUsuarioConfig({kanban_usar_etiquetas:this.filter.controls.usarEtiquetas.value}),this.query&&this.onQueryLoad(this.query.rows)}incluirLista(a){this.labels.splice(a.key+1,0,{labels:[],menu:this.etiquetasButtons,cards:[],editing:!0,collapse:!1}),this.kanbanEtiquetas?.refreshDoubleScrollbar(),this.cdRef.detectChanges()}onResumidoChange(a){this.saveUsuarioConfig({kanban_resumido:this.filter.controls.resumido.value}),this.cdRef.detectChanges()}loadEtiquetas(){this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(a,t)=>a.key==t.key)}getLabelStyle(a){return`border-color: ${1==a.labels.length&&a.labels[0].color||"#000000"} !important;`}onDockerCollapse(a,t){this.isEtiquetas?(this.labels[a.key].collapse=t,this.saveEtiquetasUsuarioConfig()):(this.cardsConfig={naoIniciado:!!this.dockerNaoIniciado?.collapse,pausado:!!this.dockerPausado?.collapse,iniciado:!!this.dockerIniciado?.collapse,concluido:!!this.dockerConcluido?.collapse},this.saveUsuarioConfig({kanban_status_dockers:this.cardsConfig})),this.kanbanEtiquetas?.refreshDoubleScrollbar()}editEtiquetas(a){var t=this;return(0,h.Z)(function*(){const i=t.labels[a.key],o=t.labels.reduce((s,u,f)=>(u.labels.length&&f!=a.key&&s.push(u.labels[0].key),s),[]);t.etiquetasEdit=t.etiquetas.filter(s=>!o.includes(s.key)),t.formEdit.controls.etiqueta.setValue(i.labels.length?i.labels[0].key:null)})()}saveEtiquetasUsuarioConfig(){const a=this.labels.reduce((t,i)=>(t.find(o=>o.title?.length&&o.title==i.title||o.labels?.length&&i.labels?.length&&o.labels[0].key==i.labels[0].key)||t.push({title:i.title,labels:i.labels,collapse:i.collapse}),t),[]);this.saveUsuarioConfig({kanban_etiquetas_dockers:a})}saveEtiquetas(a){var t=this;return(0,h.Z)(function*(){const i=t.formEdit.controls.etiqueta.value;if(i?.length){const o=t.labels[a.key],s=t.etiquetasEdit.find(u=>u.key==i);return s&&(o.labels=[s]),t.query&&t.onQueryLoad(t.query.rows),t.saveEtiquetasUsuarioConfig(),!0}return!1})()}cancelEtiquetas(a){var t=this;return(0,h.Z)(function*(){t.labels[a.key].labels?.length||(t.labels.splice(a.key,1),t.kanbanEtiquetas?.refreshDoubleScrollbar())})()}deleteEtiquetas(a){var t=this;return(0,h.Z)(function*(){t.labels.splice(a.key,1),t.kanbanEtiquetas?.refreshDoubleScrollbar(),t.query&&t.onQueryLoad(t.query.rows),t.saveEtiquetasUsuarioConfig()})()}getNomes(a){return Object.getOwnPropertyNames(a.filter.controls||{}).join(",")}modalRefreshId(a){return{modal:!0,modalClose:t=>{const i=this.dragDrop.destination,o=this.dragDrop.source;t&&(i&&o&&(i.list.splice(i.index,0,i.card),o.list.splice(o.index,1)),(this.grid?.query||this.query).refreshId(a.id)),this.dragDrop={}}}}mergeEtiqueta(a){this.etiquetas.find(t=>t.key==a.key)||this.etiquetas.push(a)}filterSubmit(a){return super.filterSubmit(a),this.cards=[[],[],[],[]],this.labels.forEach(t=>t.cards=[]),this.queryOptions}onQueryLoad(a){if(super.onGridLoad(a),this.cardsVersion++,this.filter?.controls?.usarEtiquetas?.value){const t=this.labels.findIndex(this.isOutras.bind(this));a?.forEach(i=>{let s,o=i;o.etiquetas=o.etiquetas||[];for(let u=0;u<o.etiquetas.length;u++){for(let f=1;f<this.labels.length&&!s;f++)this.labels[f].labels[0].key==o.etiquetas[u].key&&(s=this.labels[f]);this.etiquetas.some(f=>f.key==o.etiquetas[u].key)||this.etiquetas.push(o.etiquetas[u])}this.putCard(s?.cards||this.labels[t]?.cards||[],o)});for(let i of this.labels.map(o=>o.cards||[]))for(let o=0;o<i.length;i[o].version!=this.cardsVersion?i.splice(o,1):o++);}else{a?.forEach(t=>{const i=t;switch(this.lookup.ATIVIDADE_STATUS.find(s=>s.key==i.status)?.key||"INCLUIDO"){case"PAUSADO":this.putCard(this.cards[this.PAUSADO],i);break;case"INICIADO":this.putCard(this.cards[this.INICIADO],i);break;case"CONCLUIDO":this.putCard(this.cards[this.CONCLUIDO],i);break;default:this.putCard(this.cards[this.NAOINICIADO],i)}});for(let t of this.cards)for(let i=0;i<t.length;t[i].version!=this.cardsVersion?t.splice(i,1):i++);}this.cdRef.detectChanges()}putCard(a,t){const i=a.findIndex(s=>s.id==t.id),o={id:t.id,title:t.tipo_atividade?.nome||"("+this.lex.translate("Atividade")+" sem tipo de registro de execu\xe7\xe3o atribu\xeddo)",subTitle:t.descricao||"",data:t,version:this.cardsVersion,menu:void 0,dynamicMenu:this.dynamicCardMenu.bind(this)};i>=0?a[i]=Object.assign(a[i],o):a.push(o)}dynamicCardMenu(a){const t=this.atividadeService.dynamicButtons.bind(this)(a.data,this.optionsMetadata);return t.push({icon:"bi bi-three-dots",hint:"Op\xe7\xf5es",dynamicItems:this.cardDynamicOptions.bind(this)}),(!a.menu||a.menu.map(i=>i.hint).join()!=t.map(i=>i.hint).join())&&(a.menu=t),a.menu}cardDynamicOptions(a){const t=a.menu?.find(i=>"Op\xe7\xf5es"==i.hint);if(t){const i=this.atividadeService.dynamicOptions.bind(this)(a.data,this.optionsMetadata);(!t.items||t?.items.map(o=>o.label).join()!=i.map(o=>o.label).join())&&(t.items=i)}return t?.items}canDrop(a){let t=this;return i=>!!t.isEtiquetas||!!t.atividadeService.dynamicOptions.bind(t)(i.data,t.optionsMetadata).find(s=>s.id==a)}updateEtiquetasAtividade(a){const t=this.labels.find(s=>s.cards==a.source.list)?.labels[0],i=this.labels.find(s=>s.cards==a.destination.list)?.labels[0],o=a.destination.atividade;t&&i&&t.key==i.key||(t&&o.etiquetas.splice(o.etiquetas.findIndex(s=>s.key==t.key),1),i&&o.etiquetas.unshift(i),this.loading=!0,this.dao.update(o.id,{etiquetas:o.etiquetas}).then(s=>this.modalRefreshId(s).modalClose.bind(this)(s.id)).finally(()=>this.loading=!1))}onDragged(a,t,i){if(["copy","move"].includes(i)){const o=t.indexOf(a);this.dragDrop.source={list:t,index:o},this.isEtiquetas&&this.updateEtiquetasAtividade(this.dragDrop)}}onDrop(a,t){if(t&&["copy","move"].includes(a.dropEffect)){const i=a.data.data,o=a.data;let s=typeof a.index>"u"?t.length:a.index;if(this.dragDrop={destination:{list:t,index:s,card:o,atividade:i}},!this.isEtiquetas){const u=this.atividadeService.dynamicOptions.bind(this)(i,this.optionsMetadata),f=this.cards.indexOf(t);if(f>=0){const K=u.find(D=>D.id==this.DOCKERS[f]);K?.onClick&&K?.onClick(i)}}}}onStatusClick(a){this.filter?.controls.status.setValue(a.data?.status),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}onEtiquetaClick(a){let t=this.filter.controls.etiquetas.value;t.push(a),this.filter?.controls.etiquetas.setValue(t),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}filterClear(a){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(""),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(""),this.filter.controls.numero_processo.setValue(""),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(t=>"status"==t[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(a)}onSwimlaneDrop(a,t){const i=this.labels[t],o=t<a.index?a.index-1:a.index;this.labels.splice(t,1),this.labels.splice(o,0,i),this.saveEtiquetasUsuarioConfig()}onEntregaClick(a){this.go.navigate({route:["gestao","atividade",a.id,"hierarquia"]},{metadata:{atividade:a}})}onUnidadeChange(a){var t=this;return(0,h.Z)(function*(){let i=yield t.unidadeDao.getById(t.filter?.controls.unidade_id.value,["planos_entrega"]);t.planosEntregas=i?.planos_entrega?.map(o=>Object.assign({key:o.id,value:o.nome}))||[]})()}onPlanoEntregaChange(a){var t=this;return(0,h.Z)(function*(){let i=[];(yield t.unidadeDao.getById(t.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(s=>{s.id==t.filter.controls.plano_entrega_id.value&&i.push(s.entregas)}),t.planosEntregasEntregas=i[0].map(s=>Object.assign({key:s.id,value:s.descricao}))||[]})()}}(Y=_e).\u0275fac=function(a){return new(a||Y)(e.Y36(e.zs3))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["atividade-list-kanban"]],viewQuery:function(a,t){if(1&a&&(e.Gf(Vt,5),e.Gf(Lt,5),e.Gf(Gt,5),e.Gf(Bt,5),e.Gf(Ht,5),e.Gf(Yt,5),e.Gf(jt,5),e.Gf(Kt,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.filterRef=i.first),e.iGM(i=e.CRH())&&(t.kanbanEtiquetas=i.first),e.iGM(i=e.CRH())&&(t.dockerNaoIniciado=i.first),e.iGM(i=e.CRH())&&(t.dockerPausado=i.first),e.iGM(i=e.CRH())&&(t.dockerIniciado=i.first),e.iGM(i=e.CRH())&&(t.dockerConcluido=i.first),e.iGM(i=e.CRH())&&(t.planoEntrega=i.first),e.iGM(i=e.CRH())&&(t.planoEntregaEntrega=i.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.qOj],decls:29,vars:52,consts:[[3,"buttons"],["labelPosition","left","label","Resumido","controlName","resumido",3,"size","control","change"],["labelPosition","left","label","Usar etiquetas","controlName","usarEtiquetas",1,"me-2",3,"size","control","change"],[3,"deleted","form","where","query","submit","clear","collapseChange","collapsed"],["filterRef",""],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"size","control","change"],["controlName","usuario_id",3,"size","label","control","disabled","dao"],["usuario",""],["label","Atual","controlName","somente_unidade_atual","labelInfo","Somente as atividades da unidade selecionada",3,"size","control","change"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["controlName","unidade_id",3,"size","label","control","disabled","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"size","label","valueTodos","control","items","change"],["planoEntrega",""],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["planoEntregaEntrega",""],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["ticket",""],["editDocker",""],["placeholder",""],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes",4,"ngIf"],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"d-flex","w-100"],[1,"flex-fill"],[1,"text-nowrap"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-briefcase"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark",3,"title"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark","fw-light",3,"title"],[1,"bi","bi-cursor"],[4,"ngIf"],["color","info","role","button",3,"icon","label","click"],[3,"url","hint"],[1,"card-status-container"],[3,"documento"],["class","ms-1",3,"color","label","icon","data","click",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],["origem","ATIVIDADE",3,"entity"],["collapse","",3,"title","collapsed",4,"ngIf"],["origem","ATIVIDADE",3,"entity","selectable","query"],[1,"ms-1",3,"color","label","icon","data","click"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["collapse","",3,"title","collapsed"],["controlName","etiqueta",3,"size","control","items"],[1,"card-body"],[1,"card-title","placeholder-glow"],[1,"placeholder","col-6"],["role","group","aria-label","Basic outlined example",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","disabled","placeholder"],[1,"bi","bi-question"],[1,"card-subtitle","mb-2","text-muted","placeholder-glow"],[1,"placeholder","col-8"],[1,"card-text","placeholder-glow"],[1,"placeholder","col-7"],[1,"placeholder","col-4"],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes"],["icon","bi bi-hourglass-split","title","N\xe3o iniciado","color","border-warning",3,"collapse","toggle","menu","dragged","drop","dropIf","cards"],["dockerNaoIniciado",""],["icon","bi bi-play-circle","title","Iniciadas","color","border-info",3,"collapse","toggle","dragged","drop","dropIf","cards"],["dockerIniciado",""],["icon","bi bi-pause-circle","title","Pausadas","color","border-danger",3,"collapse","toggle","dragged","drop","dropIf","cards"],["dockerPausado",""],["icon","bi bi-check-circle","title","Conclu\xeddas","color","border-primary",3,"collapse","toggle","dragged","drop","dropIf","cards"],["dockerConcluido",""],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle"],["kanbanEtiquetas",""]],template:function(a,t){1&a&&(e.TgZ(0,"toolbar",0)(1,"input-switch",1),e.NdJ("change",function(o){return t.onResumidoChange(o)}),e.qZA(),e.TgZ(2,"input-switch",2),e.NdJ("change",function(o){return t.onUsarEtiquetasChange(o)}),e.qZA()(),e.TgZ(3,"filter",3,4)(5,"div",5)(6,"input-switch",6),e.NdJ("change",function(o){return t.onAtribuidasParaMimChange(o)}),e.qZA(),e._UZ(7,"input-search",7,8),e.TgZ(9,"input-switch",9),e.NdJ("change",function(o){return t.onSomenteUnidadeAtualChange(o)}),e.qZA(),e._UZ(10,"input-text",10)(11,"input-select",11),e.qZA(),e.TgZ(12,"div",5)(13,"input-search",12,13),e.NdJ("change",function(o){return t.onUnidadeChange(o)}),e.qZA(),e._UZ(15,"input-switch",14),e.TgZ(16,"input-select",15,16),e.NdJ("change",function(o){return t.onPlanoEntregaChange(o)}),e.qZA(),e._UZ(18,"input-select",17,18)(20,"input-multiselect",19),e.qZA()(),e.YNc(21,ra,17,11,"ng-template",null,20,e.W1O),e.YNc(23,da,1,3,"ng-template",null,21,e.W1O),e.YNc(25,ca,16,0,"ng-template",null,22,e.W1O),e.YNc(27,ua,12,29,"kanban",23),e.YNc(28,pa,2,14,"kanban",24)),2&a&&(e.Q6J("buttons",t.toolbarButtons),e.xp6(1),e.Q6J("size",2)("control",t.filter.controls.resumido),e.xp6(1),e.Q6J("size",2)("control",t.filter.controls.usarEtiquetas),e.xp6(1),e.Q6J("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("query",t.query)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",t.filterCollapsed),e.xp6(3),e.Q6J("size",1)("control",t.filter.controls.atribuidas_para_mim),e.xp6(1),e.Q6J("size",4)("label",t.lex.translate("Usu\xe1rio"))("control",t.filter.controls.usuario_id)("disabled",t.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",t.usuarioDao),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.somente_unidade_atual),e.xp6(1),e.Q6J("size",3)("label","N\xba "+t.lex.translate("Processo")+" (Sei)")("control",t.filter.controls.numero_processo),e.uIk("maxlength",250),e.xp6(1),e.Q6J("size",3)("valueTodos",null)("disabled",null!=t.fixedFilter&&t.fixedFilter.length&&"status"==t.fixedFilter[0][0]?"true":void 0)("control",t.filter.controls.status)("items",t.lookup.ATIVIDADE_STATUS),e.xp6(2),e.Q6J("size",3)("label",t.lex.translate("Unidade"))("control",t.filter.controls.unidade_id)("disabled",t.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",t.unidadeDao),e.xp6(2),e.Q6J("size",1)("control",t.filter.controls.unidades_subordinadas),e.xp6(1),e.Q6J("size",3)("label",t.lex.translate("Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_id)("items",t.planosEntregas),e.xp6(2),e.Q6J("size",2)("label",t.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_entrega_id)("items",t.planosEntregasEntregas),e.xp6(2),e.Q6J("size",3)("control",t.filter.controls.etiquetas),e.xp6(7),e.Q6J("ngIf",!t.isEtiquetas),e.xp6(1),e.Q6J("ngIf",t.isEtiquetas))},styles:[".comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:initial;white-space:normal}.comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{font-size:12px;height:auto;display:block;max-width:290px;white-space:initial}.atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}.comentario-badge[_ngcontent-%COMP%]{white-space:nowrap;display:block;background-color:#ffe69c!important;margin-bottom:1px;text-align:left}.comentario-badge[_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:none}.comentario-badge[_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{display:inline-block;max-width:290px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:12px}.docker-border[_ngcontent-%COMP%]{border-width:1px}.card-status-container[_ngcontent-%COMP%]{width:330px}"]});var j,ma=r(38720),Oe=r(73150);const _a=["programa"],fa=["unidadesSubordinadas"];class xe extends qe.x{constructor(a){super(a),this.injector=a,this.validate=(t,i)=>null,this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.fh=this.injector.get(ma.k),this.cdRef=a.get(e.sBO),this.filter=this.fh.FormBuilder({programa_id:{default:""},unidadesSubordinadas:{default:!1}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit()}}(j=xe).\u0275fac=function(a){return new(a||j)(e.Y36(e.zs3))},j.\u0275cmp=e.Xpm({type:j,selectors:[["atividade-dashboard"]],viewQuery:function(a,t){if(1&a&&(e.Gf(Oe.M,5),e.Gf(_a,5),e.Gf(fa,5)),2&a){let i;e.iGM(i=e.CRH())&&(t.grid=i.first),e.iGM(i=e.CRH())&&(t.programa=i.first),e.iGM(i=e.CRH())&&(t.unidadesSubordinadas=i.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter"},features:[e.qOj],decls:0,vars:0,template:function(a,t){}});var P,ha=r(75471),ga=r(57224),va=r(83351),Ne=r(57765),ke=r(45512),ba=r(42704),Qe=r(17819),Ca=r(61915),Ue=r(64792),Je=r(81419),Pe=r(72504),Aa=r(58189),Ta=r(64502),Da=r(56152),Ea=r(2729);class Fe{}(P=Fe).\u0275fac=function(a){return new(a||P)},P.\u0275mod=e.oAB({type:P}),P.\u0275inj=e.cJS({imports:[g.ez,Ze,St.K,Rt.UteisModule,ha.lC]}),e.B6R(pe,[g.O5,re.n,de.i,ue.N,xe,_e],[]),e.B6R(ue.N,[g.sg,g.O5,Oe.M,ga.a,va.b,Ne.z,ke.n,ba.Q,Z.a,T.V,m.m,le.Q,q.k,x.p,Qe.p,O.N,Ca.l,me.F,Ee.R,w.l,Ue.C,te.Y,Je.y,Pe.h,E.u],[]),e.B6R(_e,[g.sg,g.O5,Ne.z,ke.n,Z.a,T.V,m.m,x.p,Qe.p,O.N,Aa.C,Ta.x,Da.m,me.F,Ea.q,Ue.C,Je.y,Pe.h],[])}}]);
>>>>>>> develop
