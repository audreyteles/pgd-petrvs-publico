"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[4790],{5917:(Q,P,_)=>{_.d(P,{N:()=>L});var C=_(291);class L extends C.C{constructor(e){super(),this.documento=null,this.comentarios=[],this.descricao=null,this.data_lancamento=new Date,this.tempo_estimado=0,this.data_conclusao=null,this.documento_id=null,this.atividade_id="",this.usuario_id="",this.tipo_tarefa_id=null,this.initialization(e)}}},9050:(Q,P,_)=>{_.d(P,{p:()=>Y});var C=_(9062),L=_(5413),A=_(3535),e=_(4407),M=_(9276),N=_(5624),q=_(336),S=_(5362),B=_(5623),F=_(6807),U=_(2464),V=_(6867);class Y extends C.P{constructor(m){super(m,e.Y,q.R),this.injector=m,this.etiquetas=[],this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xe1rio"},this.DATAS_FILTRO=[{key:"DISTRIBUICAO",value:"Distribui\xe7\xe3o",icon:"bi bi-file-earmark-plus",color:"badge rounded-pill bg-warning text-dark"},{key:"PRAZO",value:"Prazo",icon:"bi bi-calendar-check",color:"badge rounded-pill bg-info text-dark"},{key:"CONCLUSAO",value:"Conclus\xe3o",icon:"bi bi-check-circle",color:"badge rounded-pill bg-info text-dark"}],this.unidadeDao=m.get(A.s),this.usuarioDao=m.get(L._),this.planoTrabalhoDao=m.get(V.x),this.tipoAtividadeDao=m.get(F.f),this.tipoProcessoDao=m.get(S.W),this.allPages=m.get(M.v),this.atividadeService=m.get(U.h),this.calendar=m.get(N.I),this.comentario=m.get(B.D),this.join=["tipo_atividade","plano_trabalho_entrega.plano_entrega_entrega:id,descricao","demandante","pausas","usuario","unidade","comentarios.usuario:id,nome,apelido","tarefas.tipo_tarefa","tarefas.comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.extra={planos_trabalho:{},afastamentos:{}},this.optionsMetadata={refreshId:(n=>(this.grid?.query||this.query).refreshId(n)).bind(this),removeId:(n=>(this.grid?.query||this.query).removeId(n)).bind(this),refresh:this.refresh.bind(this)}}onGridLoad(m){m?.forEach(r=>{r.comentarios=this.comentario.orderComentarios(r.comentarios)});const n=(this.grid?.query||this.query).extra;if(n){this.extra.planos_trabalho=Object.assign(this.extra.planos_trabalho,n.planos||{});for(let[r,c]of Object.entries(n.afastamentos||{}))this.extra.afastamentos[r]=c.reduce((p,f)=>(p.find(O=>O.id==f.id)||p.push(f),p),this.extra.afastamentos[r]||[]);Object.entries(n.feriados||{}).forEach(([r,c])=>{this.calendar.feriadosCadastrados[r]||(this.calendar.feriadosCadastrados[r]=c)}),m?.forEach(r=>{r.planoTrabalho=n.planos_trabalho[r.plano_trabalho_id]}),this.cdRef.detectChanges()}}onAtribuidasParaMimChange(m){this.filter.controls.usuario_id.setValue(this.filter.controls.atribuidas_para_mim.value?this.auth.usuario.id:void 0)}onSomenteUnidadeAtualChange(m){this.filter.controls.unidade_id.setValue(this.filter.controls.somente_unidade_atual.value?this.auth.unidade.id:void 0)}onDespendidoClick(m){m.metadados&&!m.metadados.concluido&&(this.efemerides=this.calendar.calculaDataTempoUnidade(m.data_inicio,this.auth.hora,this.extra?.planos_trabalho[m.plano_trabalho_id]?.carga_horaria||0,m.unidade,"ENTREGA",m.pausas,this.extra?.afastamentos[m.usuario_id]||[]),this.dialog.template({title:"C\xe1lculos do tempo despendido"},this.calendarEfemerides,[]))}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:m=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(n,r)=>n.key==r.key),this.cdRef.detectChanges()}})}comentarioClick(m){const n=m.getAttribute("data-expanded");m.setAttribute("data-expanded","true"==n?"false":"true")}addComentarioClick(m){this.go.navigate({route:["gestao","atividade",m.id,"comentar"]},{modal:!0,modalClose:n=>{n&&(this.grid?.query||this.query).refreshId(m.id)}})}}},4282:(Q,P,_)=>{_.d(P,{b:()=>se});var C=_(3308),L=_(5611),A=_(9050),e=_(3279);const M=["calendarEfemerides"],N=["unidade"],q=["usuario"],S=["tipoAtividade"],B=["etiqueta"],F=["planoEntrega"],U=["planoEntregaEntrega"];function V(a,l){if(1&a&&e.nrm(0,"calendar-efemerides",57),2&a){const i=e.XpG();e.Y8G("efemerides",i.efemerides)}}function Y(a,l){if(1&a&&(e.qex(0),e.j41(1,"label",60),e.EFF(2),e.j41(3,"b"),e.EFF(4),e.k0s()(),e.bVm()),2&a){const i=l.$implicit;e.R7$(2),e.SpI("",i.label,": "),e.R7$(2),e.JRh(i.value)}}function G(a,l){if(1&a&&(e.j41(0,"div",58),e.DNE(1,Y,5,2,"ng-container",59),e.k0s()),2&a){const i=l.group;e.R7$(),e.Y8G("ngForOf",i)}}function m(a,l){if(1&a){const i=e.RV6();e.j41(0,"toolbar")(1,"input-switch",61),e.bIt("change",function(t){e.eBV(i);const s=e.XpG();return e.Njj(s.onAgruparChange(t))}),e.k0s(),e.j41(2,"input-switch",62),e.bIt("change",function(t){e.eBV(i);const s=e.XpG();return e.Njj(s.onAgruparChange(t))}),e.k0s()()}if(2&a){const i=e.XpG();e.R7$(),e.Y8G("size",3)("control",i.filter.controls.agrupar_entrega),e.R7$(),e.Y8G("size",3)("control",i.filter.controls.agrupar)}}function n(a,l){if(1&a&&(e.j41(0,"span",65),e.nrm(1,"i",66),e.EFF(2),e.k0s()),2&a){const i=e.XpG().row;e.R7$(2),e.SpI(" ",null==i.tarefas?null:i.tarefas.length,"")}}function r(a,l){if(1&a&&e.DNE(0,n,3,1,"span",64),2&a){const i=l.row;e.Y8G("ngIf",null==i.tarefas?null:i.tarefas.length)}}function c(a,l){if(1&a&&e.nrm(0,"atividade-list-tarefa",67),2&a){const i=l.row,o=e.XpG(2);e.Y8G("selectable",o.selectable)("editable",!i.metadados.concluido)("atividade",i)}}function p(a,l){if(1&a&&(e.j41(0,"column",63),e.DNE(1,r,1,1,"ng-template",null,21,e.C5r)(3,c,1,3,"ng-template",null,22,e.C5r),e.k0s()),2&a){const i=e.sdS(2),o=e.sdS(4),t=e.XpG();e.Y8G("align","center")("hint","Tarefas da "+t.lex.translate("atividade"))("template",i)("expandTemplate",o)}}function f(a,l){if(1&a&&(e.j41(0,"order",68),e.EFF(1,"#ID"),e.k0s(),e.EFF(2),e.j41(3,"order",69),e.EFF(4),e.k0s(),e.nrm(5,"br"),e.EFF(6," Descri\xe7\xe3o ")),2&a){const i=l.header,o=e.XpG();e.Y8G("header",i),e.R7$(2),e.SpI("/Tipo de ",o.lex.translate("Atividade"),"/ "),e.R7$(),e.Y8G("header",i),e.R7$(),e.JRh(o.lex.translate("Entrega"))}}function O(a,l){if(1&a&&e.nrm(0,"badge",76),2&a){const i=e.XpG().row,o=e.XpG();e.Y8G("icon",o.entityService.getIcon("TipoAtividade"))("label",i.tipo_atividade.nome)}}function T(a,l){if(1&a){const i=e.RV6();e.j41(0,"badge",77),e.bIt("click",function(){e.eBV(i);const t=e.XpG().row,s=e.XpG();return e.Njj(s.onEntregaClick(t))}),e.k0s()}if(2&a){const i=e.XpG().row,o=e.XpG();e.Y8G("icon",o.entityService.getIcon("Entrega"))("label",i.plano_trabalho_entrega.descricao)}}function k(a,l){if(1&a&&(e.j41(0,"span",70),e.nrm(1,"badge",71),e.DNE(2,O,1,2,"badge",72)(3,T,1,2,"badge",73),e.k0s(),e.j41(4,"span",74),e.EFF(5),e.k0s(),e.nrm(6,"reaction",75)),2&a){const i=l.row,o=e.XpG();e.R7$(),e.Y8G("label",i.numero)("data",i.numero)("click",o.atividadeService.onIdClick.bind(o)),e.R7$(),e.Y8G("ngIf",i.tipo_atividade),e.R7$(),e.Y8G("ngIf",i.plano_trabalho_entrega),e.R7$(2),e.JRh(i.descricao),e.R7$(),e.Y8G("entity",i)}}function J(a,l){if(1&a&&e.nrm(0,"input-textarea",78)(1,"input-search",79,23),2&a){const i=e.XpG();e.Y8G("size",12)("rows",2)("control",i.formEdit.controls.descricao),e.R7$(),e.Y8G("label","Tipo de "+i.lex.translate("atividade"))("size",12)("emptyValue",null)("control",i.formEdit.controls.tipo_atividade_id)("dao",i.tipoAtividadeDao)("labelInfo","Tipo de "+i.lex.translate("atividade")+" utilizado para classificar a "+i.lex.translate("atividade"))("required",i.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true")}}function E(a,l){if(1&a&&e.nrm(0,"badge",81),2&a){const i=l.$implicit,o=e.XpG(2);e.Y8G("lookup",i)("click",o.onEtiquetaClick.bind(o))}}function u(a,l){1&a&&e.DNE(0,E,1,2,"badge",80),2&a&&e.Y8G("ngForOf",l.row.etiquetas)}function d(a,l){if(1&a){const i=e.RV6();e.j41(0,"input-multiselect",82)(1,"input-select",83,24),e.bIt("details",function(){e.eBV(i);const t=e.XpG();return e.Njj(t.onEtiquetaConfigClick())}),e.k0s()()}if(2&a){const i=e.XpG();e.Y8G("size",12)("control",i.formEdit.controls.etiquetas)("addItemHandle",i.addItemHandleEtiquetas.bind(i)),e.R7$(),e.Y8G("size",12)("control",i.formEdit.controls.etiqueta)("items",i.etiquetas)}}function h(a,l){1&a&&e.EFF(0," Plano de trabalho ")}function R(a,l){if(1&a&&(e.j41(0,"span",85),e.EFF(1),e.nrm(2,"br"),e.EFF(3),e.k0s()),2&a){const i=e.XpG().row,o=e.XpG();e.R7$(),e.SpI("",o.dao.getDateFormatted(i.planoTrabalho.data_inicio)," "),e.R7$(2),e.JRh(" at\xe9 "+o.dao.getDateFormatted(i.planoTrabalho.data_fim))}}function I(a,l){1&a&&e.DNE(0,R,4,2,"span",84),2&a&&e.Y8G("ngIf",l.row.planoTrabalho)}function D(a,l){if(1&a&&(e.EFF(0," Un./"),e.j41(1,"order",86),e.EFF(2),e.k0s(),e.nrm(3,"br"),e.j41(4,"order",87),e.EFF(5,"Demandante"),e.k0s()),2&a){const i=l.header,o=e.XpG();e.R7$(),e.Y8G("header",i),e.R7$(),e.JRh(o.lex.translate("Respons\xe1vel")),e.R7$(2),e.Y8G("header",i)}}function y(a,l){if(1&a&&(e.j41(0,"div",88),e.nrm(1,"badge",89)(2,"badge",90),e.k0s(),e.nrm(3,"badge",91)),2&a){const i=l.row,o=e.XpG();e.R7$(),e.Y8G("label",i.unidade.sigla),e.R7$(),e.Y8G("icon","bi "+(null!=i.usuario&&null!=i.usuario.nome&&i.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",o.util.apelidoOuNome(i.usuario,!0)||"(N\xe3o atribu\xeddo)")("hint","Respons\xe1vel: "+((null==i.usuario?null:i.usuario.nome)||"N\xe3o atribuido a nenhum usu\xe1rio")),e.R7$(),e.Y8G("label",o.util.apelidoOuNome(i.demandante,!0)||"Desconhecido")("hint","Demandante: "+((null==i.demandante?null:i.demandante.nome)||"Desconhecido"))}}function $(a,l){if(1&a&&(e.EFF(0," Tempos "),e.j41(1,"order",92),e.EFF(2,"Distribui\xe7\xe3o"),e.k0s(),e.nrm(3,"br"),e.j41(4,"order",93),e.EFF(5,"Prazo"),e.k0s(),e.j41(6,"order",94),e.EFF(7,"Entrega"),e.k0s()),2&a){const i=l.header;e.R7$(),e.Y8G("header",i),e.R7$(3),e.Y8G("header",i),e.R7$(2),e.Y8G("header",i)}}function j(a,l){1&a&&e.nrm(0,"badge",97),2&a&&e.Y8G("badge",l.$implicit)}function z(a,l){if(1&a&&(e.j41(0,"div",95),e.DNE(1,j,1,1,"badge",96),e.k0s()),2&a){const i=l.row,o=e.XpG();e.R7$(),e.Y8G("ngForOf",o.atividadeService.temposAtividade(i,o.extra,o.onDespendidoClick.bind(o)))}}function x(a,l){1&a&&e.nrm(0,"separator",100)}function W(a,l){1&a&&e.nrm(0,"i",103)}function K(a,l){if(1&a&&(e.j41(0,"tr")(1,"td"),e.DNE(2,W,1,0,"i",101),e.k0s(),e.j41(3,"td",102),e.EFF(4),e.k0s()()),2&a){const i=l.$implicit;e.R7$(2),e.Y8G("ngIf",i.checked),e.R7$(2),e.JRh(i.texto)}}function X(a,l){if(1&a&&(e.j41(0,"table"),e.DNE(1,K,5,2,"tr",59),e.k0s()),2&a){const i=e.XpG().row;e.R7$(),e.Y8G("ngForOf",i.checklist)}}function g(a,l){if(1&a&&(e.nrm(0,"progress-bar",98),e.DNE(1,x,1,0,"separator",99)(2,X,2,1,"table",26)),2&a){const i=l.row;e.Y8G("value",i.progresso),e.R7$(),e.Y8G("ngIf",null==i.checklist?null:i.checklist.length),e.R7$(),e.Y8G("ngIf",null==i.checklist?null:i.checklist.length)}}function Z(a,l){1&a&&e.nrm(0,"separator",100)}function w(a,l){if(1&a&&(e.j41(0,"tr")(1,"td"),e.nrm(2,"input-switch",105),e.k0s(),e.j41(3,"td",102),e.EFF(4),e.k0s()()),2&a){const i=l.$implicit,o=l.index,t=e.XpG(3);e.R7$(2),e.Y8G("size",12)("source",t.checklist)("path",o+".checked"),e.R7$(2),e.JRh(i.texto)}}function ee(a,l){if(1&a&&(e.j41(0,"table"),e.DNE(1,w,5,4,"tr",59),e.k0s()),2&a){const i=e.XpG(2);e.R7$(),e.Y8G("ngForOf",i.checklist)}}function te(a,l){if(1&a&&(e.nrm(0,"input-number",104),e.DNE(1,Z,1,0,"separator",99)(2,ee,2,1,"table",26)),2&a){const i=l.row,o=e.XpG();e.Y8G("size",12)("decimals",2)("control",o.formEdit.controls.progresso),e.R7$(),e.Y8G("ngIf",null==i.checklist?null:i.checklist.length),e.R7$(),e.Y8G("ngIf",null==i.checklist?null:i.checklist.length)}}function ie(a,l){if(1&a&&e.nrm(0,"badge",109),2&a){const i=l.$implicit,o=e.XpG(2);e.Y8G("data",i)("color",i.color)("icon",i.icon)("label",i.label)("click",null!=i.data&&i.data.filter?o.onStatusClick.bind(o):void 0)}}function ae(a,l){if(1&a&&(e.nrm(0,"documentos-badge",106),e.j41(1,"span",85),e.DNE(2,ie,1,5,"badge",107),e.k0s(),e.nrm(3,"comentarios-widget",108)),2&a){const i=l.row,o=e.XpG();e.Y8G("documento",i.documento_requisicao),e.R7$(2),e.Y8G("ngForOf",o.atividadeService.getStatus(i)),e.R7$(),e.Y8G("entity",i)("selectable",o.selectable)("grid",o.grid)}}function oe(a,l){if(1&a&&e.nrm(0,"column",110),2&a){const i=e.XpG();e.Y8G("metadata",i.optionsMetadata)("dynamicOptions",i.atividadeService.dynamicOptions.bind(i))("dynamicButtons",i.atividadeService.dynamicButtons.bind(i))("options",i.options)}}let se=(()=>{class a extends A.p{static{this.selectRoute={route:["gestao","atividade","grid"]}}constructor(i){super(i),this.injector=i,this.minhas=!1,this.planosEntregas=[],this.planosEntregasEntregas=[],this.etiquetasAscendentes=[],this.storeFilter=o=>{const t=o?.value;return{atribuidas_para_mim:t.atribuidas_para_mim,usuario_id:t.usuario_id,plano_trabalho_id:t.plano_trabalho_id,somente_unidade_atual:t.somente_unidade_atual,unidades_subordinadas:t.unidades_subordinadas,unidade_id:t.somente_unidade_atual?null:t.unidade_id}},this.filterWhere=o=>{let t=this.fixedFilter||[],s=o.value;if(s.somente_unidade_atual&&s.unidade_id!=this.auth.unidade?.id&&(o.controls.unidade_id.setValue(this.auth.unidade?.id),s.unidade_id=this.auth.unidade?.id),s.atribuidas_para_mim&&s.usuario_id!=this.auth.usuario?.id&&(o.controls.usuario_id.setValue(this.auth.usuario?.id),s.usuario_id=this.auth.usuario.id),s.usuario_id&&s.usuario_id.length&&t.push(["usuario_id","==",s.usuario_id]),s.plano_trabalho_id?.length&&t.push(["plano_trabalho_id","==",s.plano_trabalho_id]),s.unidade_id?.length&&t.push(["unidade_id","==",s.unidade_id]),s.unidades_subordinadas&&t.push(["unidades_subordinadas","==",!0]),s.etiquetas?.length&&t.push(["etiquetas","in",s.etiquetas.map(b=>b.value)]),s.numero_processo?.length&&t.push(["numero_processo","==",s.numero_processo]),s.numero?.length&&t.push(["numero","==",s.numero]),s.status?.length&&!t.find(b=>"status"==b[0])&&(t.push(["status","==",s.status]),"ARQUIVADO"==s.status&&this.filter.controls.arquivadas.setValue(!0)),this.filter.controls.arquivadas.value||t.push(["data_arquivamento","==",null]),s.tipo_atividade_id?.length&&t.push(["tipo_atividade_id","==",s.tipo_atividade_id]),s.tipo_processo_id?.length&&t.push(["tipo_processo_id","==",s.tipo_processo_id]),s.plano_entrega_id?.length&&t.push(["plano_entrega_id","==",s.plano_entrega_id]),s.plano_entrega_entrega_id?.length&&t.push(["plano_entrega_entrega_id","==",s.plano_entrega_entrega_id]),s.data_filtro?.length){const b="DISTRIBUICAO"==s.data_filtro?"data_distribuicao":"PRAZO"==s.data_filtro?"data_estipulada_entrega":"data_entrega";s.data_inicio&&t.push([b,">=",s.data_inicio]),s.data_fim&&t.push([b,"<=",s.data_fim])}return t},this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.modalWidth=1100,this.filter=this.fh.FormBuilder({agrupar:{default:!0},agrupar_entrega:{default:!0},atribuidas_para_mim:{default:this.minhas},usuario_id:{default:null},numero:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},plano_trabalho_id:{default:null},unidade_id:{default:null},numero_processo:{default:""},status:{default:null},etiquetas:{default:[]},arquivadas:{default:!1},tipo_atividade_id:{default:null},tipo_processo_id:{default:null},data_filtro:{default:null},data_inicio:{default:null},data_fim:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({descricao:{default:""},tipo_atividade_id:{default:null},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.groupBy=[{field:"unidade.sigla",label:"Unidade"},{field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"},{field:"plano_trabalho_entrega.descricao",label:"Descri\xe7\xe3o dos trabalhos"}],this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngAfterViewInit(){if(super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.fixedFilter){const i=this.fixedFilter.find(o=>"status"==o[0]);i&&this.filter?.controls.status.setValue(i[2])}}onAgruparChange(i){const t=this.filter.controls.agrupar_entrega.value,s=[];this.filter.controls.agrupar.value&&s.push({field:"unidade.sigla",label:"Unidade"}),t&&s.push({field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"}),this.groupBy=s,this.grid.reloadFilter()}onStatusClick(i){this.filter?.controls.status.setValue(i.data?.status),this.grid.showFilter(),this.grid.reloadFilter()}onEtiquetaClick(i){let o=this.filter.controls.etiquetas.value;o.push(i),this.filter?.controls.etiquetas.setValue(o),this.grid.showFilter(),this.grid.reloadFilter()}onEntregaClick(i){this.go.navigate({route:["gestao","atividade",i.id,"hierarquia"]},{metadata:{atividade:i}})}onColumnProgressoEtiquetasChecklistEdit(i){var o=this;return(0,C.A)(function*(){o.formEdit.controls.progresso.setValue(i.progresso),o.checklist=o.util.clone(i.checklist)})()}onColumnProgressoEtiquetasChecklistSave(i){var o=this;return(0,C.A)(function*(){try{const t=yield o.dao.update(i.id,{progresso:o.formEdit.controls.progresso.value,checklist:o.checklist});return i.progresso=o.formEdit.controls.progresso.value,i.checklist=o.checklist,!!t}catch{return!1}})()}filterClear(i){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(null),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(null),this.filter.controls.plano_trabalho_id.setValue(null),this.filter.controls.numero_processo.setValue(""),this.filter.controls.atividade_id.setValue(null),this.filter.controls.tipo_processo_id.setValue(null),this.filter.controls.data_filtro.setValue(null),this.filter.controls.data_inicio.setValue(null),this.filter.controls.data_fim.setValue(null),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(o=>"status"==o[0]))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(i)}addItemHandleEtiquetas(){let i;if(this.etiqueta&&this.etiqueta.selectedItem){const o=this.etiqueta.selectedItem,t=o.key?.length?o.key:this.util.textHash(o.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,t)&&(i={key:t,value:o.value,color:o.color,icon:o.icon},this.formEdit.controls.etiqueta.setValue(null))}return i}onColumnEtiquetasEdit(i){var o=this;return(0,C.A)(function*(){if(!o.etiquetasAscendentes.filter(t=>t.data==i.unidade_id).length){o.loading=!0;let t=[];try{t=yield o.carregaEtiquetasUnidadesAscendentes(i.unidade)}finally{o.loading=!1}o.etiquetasAscendentes.push(...t)}o.formEdit.controls.etiquetas.setValue(i.etiquetas),o.formEdit.controls.etiqueta.setValue(null),o.etiquetas=o.util.merge(i.tipo_atividade?.etiquetas,i.unidade?.etiquetas,(t,s)=>t.key==s.key),o.etiquetas=o.util.merge(o.etiquetas,o.auth.usuario.config?.etiquetas,(t,s)=>t.key==s.key),o.etiquetas=o.util.merge(o.etiquetas,o.etiquetasAscendentes.filter(t=>t.data==i.unidade_id),(t,s)=>t.key==s.key)})()}carregaEtiquetasUnidadesAscendentes(i){var o=this;return(0,C.A)(function*(){let t=[],s=i.path.split("/").filter(v=>v?.length);return(yield o.unidadeDao.query({where:[["id","in",s]]}).asPromise()).forEach(v=>{t=o.util.merge(t,v.etiquetas,(ne,H)=>ne.key==H.key)}),t.forEach(v=>v.data=i.id),t})()}onColumnEtiquetasSave(i){var o=this;return(0,C.A)(function*(){try{const t=yield o.dao.update(i.id,{etiquetas:o.formEdit.controls.etiquetas.value});return i.etiquetas=o.formEdit.controls.etiquetas.value,!!t}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:i=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(o,t)=>o.key==t.key),this.cdRef.detectChanges()}})}onUnidadeChange(i){var o=this;return(0,C.A)(function*(){let t=yield o.unidadeDao.getById(o.filter?.controls.unidade_id.value,["planos_entrega"]);o.planosEntregas=t?.planos_entrega?.map(s=>Object.assign({key:s.id,value:s.nome}))||[]})()}onPlanoEntregaChange(i){var o=this;return(0,C.A)(function*(){let t=[];(yield o.unidadeDao.getById(o.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(b=>{b.id==o.filter.controls.plano_entrega_id.value&&t.push(b.entregas)}),o.planosEntregasEntregas=t[0].map(b=>Object.assign({key:b.id,value:b.descricao}))||[]})()}onColumnAtividadeDescricaoEdit(i){var o=this;return(0,C.A)(function*(){o.formEdit.controls.descricao.setValue(i.descricao),o.formEdit.controls.tipo_atividade_id.setValue(i.tipo_atividade_id),o.formEdit.controls.comentarios.setValue(i.comentarios)})()}onColumnAtividadeDescricaoSave(i){var o=this;return(0,C.A)(function*(){try{o.atividadeService.comentarioAtividade(o.tipoAtividade?.selectedEntity,o.formEdit.controls.comentarios);const t=yield o.dao.update(i.id,{descricao:o.formEdit.controls.descricao.value,tipo_atividade_id:o.formEdit.controls.tipo_atividade_id.value,comentarios:(o.formEdit.controls.comentarios.value||[]).filter(s=>["ADD","EDIT","DELETE"].includes(s._status||""))});return i.descricao=o.formEdit.controls.descricao.value,i.tipo_atividade_id=o.formEdit.controls.tipo_atividade_id.value,i.tipo_atividade=o.tipoAtividade?.selectedEntity||null,i.comentarios=o.formEdit.controls.comentarios.value,!!t}catch{return!1}})()}canEditColumn(i){return i.usuario_id==this.auth.usuario.id}static{this.\u0275fac=function(o){return new(o||a)(e.rXU(e.zZn))}}static{this.\u0275cmp=e.VBU({type:a,selectors:[["atividade-list-grid"]],viewQuery:function(o,t){if(1&o&&(e.GBs(L._,5),e.GBs(M,5),e.GBs(N,5),e.GBs(q,5),e.GBs(S,5),e.GBs(B,5),e.GBs(F,5),e.GBs(U,5)),2&o){let s;e.mGM(s=e.lsd())&&(t.grid=s.first),e.mGM(s=e.lsd())&&(t.calendarEfemerides=s.first),e.mGM(s=e.lsd())&&(t.unidade=s.first),e.mGM(s=e.lsd())&&(t.usuario=s.first),e.mGM(s=e.lsd())&&(t.tipoAtividade=s.first),e.mGM(s=e.lsd())&&(t.etiqueta=s.first),e.mGM(s=e.lsd())&&(t.planoEntrega=s.first),e.mGM(s=e.lsd())&&(t.planoEntregaEntrega=s.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[e.Vt3],decls:73,vars:122,consts:[["calendarEfemerides",""],["groupAtividades",""],["usuario",""],["planoTrabalho",""],["unidade",""],["planoEntrega",""],["planoEntregaEntrega",""],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["columnAtividadeDescricaoEdit",""],["columnEtiquetas",""],["columnEtiquetasEdit",""],["titlePlanoTrabalho",""],["columnPlanoTrabalho",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],["titleTempos",""],["columnTempos",""],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],["columnNumero",""],["columnTarefas",""],["columnExpandedTarefas",""],["tipoAtividade",""],["etiqueta",""],[3,"select","dao","add","form","hasEdit","hasDelete","orderBy","groupBy","join","loadList","selectable","groupTemplate"],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"change","size","control"],["label","Usu\xe1rio","controlName","usuario_id",3,"size","control","disabled","dao"],["label","Plano de trabalho","controlName","plano_trabalho_id",3,"size","control","dao"],["label","Atual","controlName","somente_unidade_atual",3,"change","size","control","labelInfo"],["label","Unidade","controlName","unidade_id",3,"change","size","control","disabled","dao"],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"change","size","label","valueTodos","control","items"],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["label","#ID","controlName","numero","maskFormat","999999",3,"size","control","labelInfo"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xe7\xe3o, conclus\xe3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["label","Arq.","controlName","arquivadas",3,"size","control","labelInfo"],["controlName","tipo_atividade_id",3,"size","label","control","dao"],["controlName","tipo_processo_id",3,"size","label","control","dao"],["label","Data","itemTodos","- Todos -","controlName","data_filtro",3,"size","valueTodos","control","items"],["noIcon","","label","In\xedcio","controlName","data_inicio","labelInfo","Data in\xedcio do per\xedodo",3,"size","disabled","control"],["noIcon","","label","Fim","controlName","data_fim","labelInfo","Data fim do per\xedodo",3,"size","disabled","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","editable","maxWidth","template","editTemplate","columnEditTemplate","edit","save"],[3,"title","editable","maxWidth","width","template","editTemplate","columnEditTemplate","edit","save"],[3,"titleTemplate","template"],[3,"titleTemplate","template","maxWidth","editable"],[3,"titleTemplate","template","width"],[3,"title","maxWidth","editable","columnEditTemplate","template","edit","save"],[3,"title","width","template"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options",4,"ngIf"],[3,"rows"],[3,"efemerides"],[1,"d-flex","ps-3"],[4,"ngFor","ngForOf"],[1,"me-3"],["labelPosition","left","label","Agrupar por Entrega","controlName","agrupar_entrega",3,"change","size","control"],["labelPosition","left","label","Agrupar por Unidade","controlName","agrupar",3,"change","size","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["persist","",3,"selectable","editable","atividade"],["by","numero",3,"header"],["by","plano_trabalho_entrega.descricao",3,"header"],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],["color","light",3,"icon","label",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["color","light",3,"icon","label"],["color","info","role","button",3,"click","icon","label"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],["relativeId","columnTipoAtividade","controlName","tipo_atividade_id",3,"label","size","emptyValue","control","dao","labelInfo","required"],[3,"lookup","click",4,"ngFor","ngForOf"],[3,"lookup","click"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"details","size","control","items"],["class","d-block",4,"ngIf"],[1,"d-block"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["by","data_distribuicao",3,"header"],["by","data_estipulada_entrega",3,"header"],["by","data_entrega",3,"header"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["color","success",3,"value"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["scale","small",3,"size","source","path"],[3,"documento"],[3,"data","color","icon","label","click",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"data","color","icon","label","click"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options"]],template:function(o,t){if(1&o){const s=e.RV6();e.DNE(0,V,1,1,"ng-template",null,0,e.C5r),e.j41(2,"grid",25),e.bIt("select",function(v){return e.eBV(s),e.Njj(t.onSelect(v))}),e.DNE(3,G,2,1,"ng-template",null,1,e.C5r)(5,m,3,4,"toolbar",26),e.j41(6,"filter",27)(7,"div",28)(8,"input-switch",29),e.bIt("change",function(v){return e.eBV(s),e.Njj(t.onAtribuidasParaMimChange(v))}),e.k0s(),e.nrm(9,"input-search",30,2)(11,"input-search",31,3),e.k0s(),e.j41(13,"div",28)(14,"input-switch",32),e.bIt("change",function(v){return e.eBV(s),e.Njj(t.onSomenteUnidadeAtualChange(v))}),e.k0s(),e.j41(15,"input-search",33,4),e.bIt("change",function(v){return e.eBV(s),e.Njj(t.onUnidadeChange(v))}),e.k0s(),e.nrm(17,"input-switch",34),e.j41(18,"input-select",35,5),e.bIt("change",function(v){return e.eBV(s),e.Njj(t.onPlanoEntregaChange(v))}),e.k0s(),e.nrm(20,"input-select",36,6),e.k0s(),e.j41(22,"div",28),e.nrm(23,"input-text",37)(24,"input-text",38)(25,"input-select",39)(26,"input-multiselect",40)(27,"input-switch",41),e.k0s(),e.j41(28,"div",28),e.nrm(29,"input-search",42)(30,"input-search",43)(31,"input-select",44)(32,"input-datetime",45)(33,"input-datetime",46),e.k0s()(),e.j41(34,"columns"),e.DNE(35,p,5,4,"column",47),e.j41(36,"column",48),e.DNE(37,f,7,4,"ng-template",null,7,e.C5r)(39,k,7,7,"ng-template",null,8,e.C5r)(41,J,3,10,"ng-template",null,9,e.C5r),e.k0s(),e.j41(43,"column",49),e.DNE(44,u,1,1,"ng-template",null,10,e.C5r)(46,d,3,6,"ng-template",null,11,e.C5r),e.k0s(),e.j41(48,"column",50),e.DNE(49,h,1,0,"ng-template",null,12,e.C5r)(51,I,1,1,"ng-template",null,13,e.C5r),e.k0s(),e.j41(53,"column",51),e.DNE(54,D,6,3,"ng-template",null,14,e.C5r)(56,y,4,6,"ng-template",null,15,e.C5r),e.k0s(),e.j41(58,"column",52),e.DNE(59,$,8,3,"ng-template",null,16,e.C5r)(61,z,2,1,"ng-template",null,17,e.C5r),e.k0s(),e.j41(63,"column",53),e.DNE(64,g,3,3,"ng-template",null,18,e.C5r)(66,te,3,5,"ng-template",null,19,e.C5r),e.k0s(),e.j41(68,"column",54),e.DNE(69,ae,4,5,"ng-template",null,20,e.C5r),e.k0s(),e.DNE(71,oe,1,4,"column",55),e.k0s(),e.nrm(72,"pagination",56),e.k0s()}if(2&o){const s=e.sdS(4),b=e.sdS(38),v=e.sdS(40),ne=e.sdS(42),H=e.sdS(45),le=e.sdS(47),re=e.sdS(50),de=e.sdS(52),ue=e.sdS(55),ce=e.sdS(57),_e=e.sdS(60),he=e.sdS(62),me=e.sdS(65),pe=e.sdS(67),fe=e.sdS(70);e.R7$(2),e.Y8G("dao",t.dao)("add",t.add)("form",t.formEdit)("hasEdit",!1)("hasDelete",!1)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("loadList",t.onGridLoad.bind(t))("selectable",t.selectable)("groupTemplate",s),e.R7$(3),e.Y8G("ngIf",!t.fixedFilter&&!t.selectable),e.R7$(),e.Y8G("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&!(null!=t.queryParams&&t.queryParams.filter)&&t.filterCollapsed),e.R7$(2),e.Y8G("size",1)("control",t.filter.controls.atribuidas_para_mim),e.R7$(),e.Y8G("size",6)("control",t.filter.controls.usuario_id)("disabled",t.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",t.usuarioDao),e.R7$(2),e.Y8G("size",5)("control",t.filter.controls.plano_trabalho_id)("dao",t.planoTrabalhoDao),e.R7$(3),e.Y8G("size",1)("control",t.filter.controls.somente_unidade_atual)("labelInfo","Somente as "+t.lex.translate("atividades")+" da unidade selecionada"),e.R7$(),e.Y8G("size",3)("control",t.filter.controls.unidade_id)("disabled",t.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",t.unidadeDao),e.R7$(2),e.Y8G("size",1)("control",t.filter.controls.unidades_subordinadas),e.R7$(),e.Y8G("size",4)("label",t.lex.translate("Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_id)("items",t.planosEntregas),e.R7$(2),e.Y8G("size",3)("label",t.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",t.filter.controls.plano_entrega_entrega_id)("items",t.planosEntregasEntregas),e.R7$(3),e.Y8G("size",1)("control",t.filter.controls.numero)("labelInfo","N\xfamero "+t.lex.translate("atividade")),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",3)("label","N\xba "+t.lex.translate("Processo")+" (Sei)")("control",t.filter.controls.numero_processo),e.BMQ("maxlength",250),e.R7$(),e.Y8G("size",3)("valueTodos",null)("disabled",null!=t.fixedFilter&&t.fixedFilter.length&&"status"==t.fixedFilter[0][0]?"true":void 0)("control",t.filter.controls.status)("items",t.lookup.ATIVIDADE_STATUS_COM_ARQUIVADAS),e.R7$(),e.Y8G("size",4)("control",t.filter.controls.etiquetas),e.R7$(),e.Y8G("size",1)("control",t.filter.controls.arquivadas)("labelInfo","Listar tamb\xe9m "+t.lex.translate("atividades")+" arquivadas"),e.R7$(2),e.Y8G("size",3)("label","Tipo de "+t.lex.translate("Atividade"))("control",t.filter.controls.tipo_atividade_id)("dao",t.tipoAtividadeDao),e.R7$(),e.Y8G("size",3)("label","Tipo de "+t.lex.translate("Processo"))("control",t.filter.controls.tipo_processo_id)("dao",t.tipoProcessoDao),e.R7$(),e.Y8G("size",2)("valueTodos",null)("control",t.filter.controls.data_filtro)("items",t.DATAS_FILTRO),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_inicio),e.R7$(),e.Y8G("size",2)("disabled",null==t.filter.controls.data_filtro.value?"true":void 0)("control",t.filter.controls.data_fim),e.R7$(2),e.Y8G("ngIf",!t.selectable),e.R7$(),e.Y8G("titleTemplate",b)("editable",t.canEditColumn.bind(t))("maxWidth",250)("template",v)("editTemplate",v)("columnEditTemplate",t.selectable?void 0:ne)("edit",t.selectable?void 0:t.onColumnAtividadeDescricaoEdit.bind(t))("save",t.selectable?void 0:t.onColumnAtividadeDescricaoSave.bind(t)),e.R7$(7),e.Y8G("title","Etiquetas")("editable",t.canEditColumn.bind(t))("maxWidth",300)("width",100)("template",H)("editTemplate",H)("columnEditTemplate",t.selectable?void 0:le)("edit",t.selectable?void 0:t.onColumnEtiquetasEdit.bind(t))("save",t.selectable?void 0:t.onColumnEtiquetasSave.bind(t)),e.R7$(5),e.Y8G("titleTemplate",re)("template",de),e.R7$(5),e.Y8G("titleTemplate",ue)("template",ce)("maxWidth",150)("editable",t.canEditColumn.bind(t)),e.R7$(5),e.Y8G("titleTemplate",_e)("template",he)("width",250),e.R7$(5),e.Y8G("title","Progresso\nChecklist")("maxWidth",250)("editable",t.canEditColumn.bind(t))("columnEditTemplate",t.selectable?void 0:pe)("template",me)("edit",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistEdit.bind(t))("save",t.selectable?void 0:t.onColumnProgressoEtiquetasChecklistSave.bind(t)),e.R7$(5),e.Y8G("title","n\xba Processo/Status\nComent\xe1rios")("width",250)("template",fe),e.R7$(3),e.Y8G("ngIf",!t.selectable),e.R7$(),e.Y8G("rows",t.rowsLimit)}},styles:[".atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}"]})}}return a})()},2464:(Q,P,_)=>{_.d(P,{h:()=>Y});var C=_(3308),L=_(5112),A=_(3279),e=_(568),M=_(9622),N=_(5624),q=_(5623),S=_(4796),B=_(2342),F=_(3609),U=_(7065),V=_(336);let Y=(()=>{class G{constructor(n,r,c,p,f,O,T,k,J){this.lookup=n,this.lex=r,this.calendar=c,this.comentario=p,this.auth=f,this.util=O,this.go=T,this.dialog=k,this.dao=J,this.delete=(E,u)=>{this.dialog.confirm("Exclui ?","Deseja realmente excluir?").then(d=>{d&&this.dao.delete(u).then(()=>{E.removeId(u.id),this.dialog.topAlert("Registro exclu\xeddo com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro","Erro ao excluir: "+(h?.message?h?.message:h)))})},this.cancelarInicio=(E,u)=>{this.dialog.confirm("Cancelar inicio ?","Deseja realmente cancelar a inicializa\xe7\xe3o?").then(d=>{d&&this.dao.cancelarInicio(u.id).then(()=>{E.refreshId(u.id),this.dialog.topAlert("Cancelado a inicializa\xe7\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",h?.message))})},this.cancelarConclusao=(E,u)=>{this.dialog.confirm("Cancelar conclus\xe3o ?","Deseja realmente cancelar a conclus\xe3o?").then(d=>{d&&this.dao.cancelarConclusao(u.id).then(()=>{E.refreshId(u.id),this.dialog.topAlert("Cancelado a conclus\xe3o com sucesso!",5e3)}).catch(h=>this.dialog.alert("Erro",h?.message))})},this.desarquivar=(E,u)=>{this.dao.arquivar(u.id,!1).then(()=>{E.refreshId(u.id)}).catch(d=>this.dialog.alert("Erro",d?.message))},this.arquivar=(E,u)=>{this.dialog.confirm("Arquivar?","Deseja realmente arquivar a atividade?").then(d=>{d&&this.dao.arquivar(u.id,!0).then(()=>{E.refreshId(u.id)}).catch(h=>this.dialog.alert("Erro",h?.message))})},this.dynamicOptions=(E,u)=>{let d=[],h=E;const R=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(a=>a.id).includes(this.auth.usuario?.id||""),I=this.auth.usuario?.id==h.demandante_id,D=this.auth.usuario?.id==h.usuario_id,y=this.lastConsolidacao(E.metadados?.consolidacoes),$={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"consult"]},{modal:!0})},j={label:"Coment\xe1rios",icon:"bi bi-chat-left-quote",onClick:a=>this.go.navigate({route:["uteis","comentarios","ATIVIDADE",a.id,"new"]},this.modalRefreshId(u,a))},z={label:"Clonar",icon:"bi bi-stickies",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"clonar"]},this.modalRefresh(u))},x={label:"Alterar atividade",icon:"bi bi-pencil-square",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"edit"]},this.modalRefreshId(u,a))},W={label:"Excluir atividade",icon:"bi bi-trash",onClick:this.delete.bind(this,u)},K={label:"Prorrogar prazo",icon:"bi bi-skip-end-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"prorrogar"]},this.modalRefreshId(u,a))},X={label:"Iniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"iniciar"]},this.modalRefreshId(u,a))},g={label:"Cancelar inicio",id:"NAOINICIADO",icon:"bi bi-backspace",onClick:this.cancelarInicio.bind(this,u)},Z={label:"Alterar inicio",icon:"bi bi-play-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"iniciar"]},this.modalRefreshId(u,a))},w={label:"Pausar",id:"PAUSADO",icon:"bi bi-pause-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"pausar"]},this.modalRefreshId(u,a))},ee={label:"Reiniciar",id:"INICIADO",icon:"bi bi-play-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(u,a))},te={label:"Concluir",id:"CONCLUIDO",icon:"bi bi-check-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"concluir"]},this.modalRefreshId(u,a))},ie={label:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:a=>this.go.navigate({route:["gestao","atividade",a.id,"concluir"]},this.modalRefreshId(u,a))},ae={label:"Cancelar conclus\xe3o",id:"INICIADO",icon:"bi bi-backspace",onClick:this.cancelarConclusao.bind(this,u)},oe={label:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,u)},se={label:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,u)};return u?.disabled||(d.push($),(D||R||I)&&d.push(j),d.push(z),h.metadados?.arquivado?(R||D)&&d.push(se):h.metadados?.iniciado?h.metadados?.concluido?((R||D)&&d.push(oe),"CONCLUIDO"!=y?.status&&((D||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&d.push(ie),(D||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_CONCL"))&&(d.length&&d.push({divider:!0}),d.push(ae)))):h.metadados?.iniciado&&(h.metadados?.pausado?(D||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(ee):((D||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&d.push(te),(D||this.auth.hasPermissionTo("MOD_DMD_USERS_PAUSA"))&&d.push(w),(!y||"INCLUIDO"==y?.status)&&((D||this.auth.hasPermissionTo("MOD_DMD_USERS_CANC_INICIAR"))&&d.push(g),(D||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(Z))),(R||I||this.auth.hasPermissionTo("MOD_DMD_USERS_PPRZO"))&&d.push(K)):((D||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(X),(R||I||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT"))&&d.push(x),(R||I||this.auth.hasPermissionTo("MOD_DMD_USERS_EXCL")||this.auth.hasPermissionTo("MOD_DMD_NI_EXCL"))&&(d.length&&d.push({divider:!0}),d.push(W)))),d},this.dynamicButtons=(E,u)=>{let d=[],h=E;const R=this.auth.usuario?.id==h.unidade?.gestor?.id||h.unidade?.gestores_substitutos?.map(g=>g.usuario_id).includes(this.auth.usuario?.id||""),I=this.auth.usuario?.id==h.usuario_id,D=this.lastConsolidacao(E.metadados?.consolidacoes),$={label:"Informa\xe7\xf5es",icon:"bi bi-info-circle",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"consult"]},{modal:!0})},j={hint:"Iniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"iniciar"]},this.modalRefreshId(u,g))},z={hint:"Reiniciar",icon:"bi bi-play-circle",color:"btn-outline-secondary",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"pausar"],params:{reiniciar:!0}},this.modalRefreshId(u,g))},x={hint:"Concluir",icon:"bi bi-check",color:"btn-outline-success",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"concluir"]},this.modalRefreshId(u,g))},W={hint:"Arquivar",icon:"bi bi-inboxes",onClick:this.arquivar.bind(this,u)},K={hint:"Desarquivar",icon:"bi bi-reply",onClick:this.desarquivar.bind(this,u)},X={hint:"Alterar conclus\xe3o",icon:"bi bi-check-circle",onClick:g=>this.go.navigate({route:["gestao","atividade",g.id,"concluir"]},this.modalRefreshId(u,g))};return u?.disabled||(h.metadados?.iniciado?h.metadados?.concluido?R||I?d.push(h.metadados?.arquivado?K:W):"CONCLUIDO"!=D?.status&&(I||this.auth.hasPermissionTo("MOD_DMD_USERS_ALT_CONCL"))&&d.push(X):h.metadados?.iniciado&&(h.metadados?.pausado&&I?d.push(z):(I||this.auth.hasPermissionTo("MOD_DMD_USERS_CONCL"))&&d.push(x)):(I||null==h.usuario_id||this.auth.hasPermissionTo("MOD_DMD_USERS_INICIAR"))&&d.push(j)),d.length||d.push($),d}}getStatus(n,r){const c=n,p=this.lookup.ATIVIDADE_STATUS.find(k=>k.key==c.status)||{key:"DESCONHECIDO",value:"Desconhecido",icon:"bi bi-question-circle",color:"light"},f=this.util.setTime(r?.data_inicio||new Date,0,0,0),O=this.util.setTime(r?.data_fim||new Date,23,59,59);let T=[{data:{status:p.key,filter:!0},label:p.value,icon:p.icon,color:p.color}];return c.metadados?.atrasado&&T.push({data:{status:"ATRASADO",filter:!1},label:"Atrasado",icon:"bi bi-alarm",color:"danger"}),r&&(c.data_inicio&&this.util.asTimestamp(c.data_inicio)<this.util.asTimestamp(f)||c.data_entrega&&this.util.asTimestamp(c.data_entrega)>this.util.asTimestamp(O))&&T.push({data:{status:"EXTRAPOLADO",filter:!1},label:"Extrapolado",icon:"bi bi-arrow-left-right",color:"danger",hint:"Data de in\xedcio ou conclus\xe3o "+this.lex.translate("da Atividade")+" extrapola os da consolida\xe7\xe3o"}),c.metadados?.arquivado&&T.push({data:{status:"ARQUIVADO",filter:!1},label:"Arquivado",icon:"bi bi-inboxes",color:"danger"}),c.metadados&&JSON.stringify(c.metadados._status)!=JSON.stringify(T)&&(c.metadados._status=T),c.metadados?._status||T}temposAtividade(n,r,c){if(n.metadados&&n.metadados.extra?.lastUpdate!=this.auth.unidadeHora){let p=r?.planos_trabalho[n.plano_trabalho_id]||n.plano_trabalho,f=[{color:"light",hint:this.lex.translate("Data de distribui\xe7\xe3o"),icon:"bi bi-file-earmark-plus",label:this.dao.getDateTimeFormatted(n.data_distribuicao)},{color:"light",hint:this.lex.translate("Prazo de entrega"),icon:"bi bi-calendar-check",label:this.dao.getDateTimeFormatted(n.data_estipulada_entrega)}];if(p?.tipo_modalidade?.atividade_esforco&&f.push({color:"light",hint:this.lex.translate("Esfor\xe7o"),icon:"bi bi-stopwatch",label:n.esforco?this.util.decimalToTimerFormated(n.esforco,!0)+" "+this.lex.translate("esfor\xe7o"):"Sem "+this.lex.translate("esfor\xe7o")}),n.metadados.concluido&&f.push({color:"light",hint:"Data de entrega realizada",icon:"bi bi-check-circle",label:this.dao.getDateTimeFormatted(n.data_entrega)}),n.metadados.iniciado&&p?.tipo_modalidade?.atividade_tempo_despendido){const k=n.metadados.concluido?n.tempo_despendido||0:this.calendar.horasUteis(n.data_inicio,this.auth.hora,p?.carga_horaria||0,n.unidade,"ENTREGA",n.pausas,r?.afastamentos[n.usuario_id]||[]);f.push({color:k>n.esforco?"warning":"light",hint:"Tempo despendido",icon:"bi bi-hourglass-split",label:this.util.decimalToTimerFormated(k,!0)+" despendido",click:n.metadados.concluido?void 0:c,data:n})}if(!n.metadados.concluido&&this.util.asTimestamp(n.data_estipulada_entrega)<this.auth.hora.getTime()){const O=this.calendar.horasAtraso(n.data_estipulada_entrega,n.unidade);f.push({color:"danger",hint:"Tempo de atraso",icon:"bi bi-alarm",label:this.util.decimalToTimerFormated(O,!0)+" atrasado"})}n.metadados.extra=n.metadados.extra||{},n.metadados.extra.lastUpdate=this.auth.unidadeHora,n.metadados.extra.tempos=f}return n.metadados?.extra?.tempos||[]}onIdClick(n){this.util.copyToClipboard(n.toString())}buildEtiquetas(n,r){return this.util.merge(r?.etiquetas,n?.etiquetas,(c,p)=>c.key==p.key)}buildChecklist(n,r){let c=this.util.merge((n?.checklist||[]).map(p=>({id:p.key,texto:p.value,checked:!1})),(r?.value||[]).filter(p=>p.checked),(p,f)=>p.id==f.id&&(p.checked=f.checked,!0));return r&&r.setValue(c),c}comentarioAtividade(n,r){let c=r?.value||[];const p=c.findIndex(f=>"TIPO_ATIVIDADE"==f.tipo);if(p>=0&&"ADD"==c[p]._status&&c.splice(p,1),n?.comentario?.length){const f=new L.W;f.id=this.dao.generateUuid(),f.path="",f.texto=n.comentario,f.data_comentario=this.auth.hora,f.usuario_id=this.auth.usuario.id,f.comentario_id=null,f.tipo="TIPO_ATIVIDADE",f.usuario=this.auth.usuario,f._status="ADD",c.push(f),c=this.comentario.orderComentarios(c),r&&r.setValue(c)}}modalRefreshId(n,r){return{modal:!0,modalClose:(c=(0,C.A)(function*(p){return n.refreshId(r.id)}),function(f){return c.apply(this,arguments)})};var c}modalRefresh(n){return{modal:!0,modalClose:n.refresh}}lastConsolidacao(n){return n?.reduce((r,c)=>!r||this.util.asTimestamp(c.data_conclusao)>this.util.asTimestamp(r.data_conclusao)?c:r,void 0)}static{this.\u0275fac=function(r){return new(r||G)(A.KVO(e.s),A.KVO(M.y),A.KVO(N.I),A.KVO(q.D),A.KVO(S.u),A.KVO(B.a),A.KVO(F.T),A.KVO(U.o),A.KVO(V.R))}}static{this.\u0275prov=A.jDH({token:G,factory:G.\u0275fac,providedIn:"root"})}}return G})()}}]);