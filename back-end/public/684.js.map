{"version":3,"file":"684.js","mappings":"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","sources":["./src/app/modules/gestao/plano-trabalho/plano-trabalho.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { PlanoTrabalhoDaoService } from 'src/app/dao/plano-trabalho-dao.service';\r\nimport { Documento, HasDocumentos } from 'src/app/models/documento.model';\r\nimport { PlanoTrabalhoEntrega, PlanoTrabalhoEntregaTipo } from 'src/app/models/plano-trabalho-entrega.model';\r\nimport { PlanoTrabalho } from 'src/app/models/plano-trabalho.model';\r\nimport { Template } from 'src/app/models/template.model';\r\nimport { AuthService } from 'src/app/services/auth.service';\r\nimport { LookupItem, LookupService } from 'src/app/services/lookup.service';\r\nimport { TemplateService } from '../../uteis/templates/template.service';\r\nimport { PlanoTrabalhoConsolidacao } from 'src/app/models/plano-trabalho-consolidacao.model';\r\nimport { Programa } from 'src/app/models/programa.model';\r\nimport { UtilService } from 'src/app/services/util.service';\r\nimport { NavigateService } from 'src/app/services/navigate.service';\r\nimport { Avaliacao } from 'src/app/models/avaliacao.model';\r\nimport { PageBase } from '../../base/page-base';\r\nimport { AvaliacaoDaoService } from 'src/app/dao/avaliacao-dao.service';\r\n\r\nexport type RefreshConsolidacao = (consolidacao: PlanoTrabalhoConsolidacao) => void;\r\n\r\nexport type BadgeTrabalho = {\r\n  titulo: string,\r\n  cor: string,\r\n  nome: string,\r\n  descricao: string,\r\n  tipo: PlanoTrabalhoEntregaTipo\r\n}\r\n\r\nexport type AssinaturaList = { \r\n  \"participante\": string[], \r\n  \"gestores_unidade_executora\": string[], \r\n  \"gestores_unidade_lotacao\": string[], \r\n  \"gestores_entidade\": string[], \r\n  \"todas\"?: string[]\r\n};\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PlanoTrabalhoService {\r\n\r\n  constructor(\r\n    public auth: AuthService,\r\n    public util: UtilService,\r\n    public go: NavigateService,\r\n    public lookup: LookupService,\r\n    public dao: PlanoTrabalhoDaoService,\r\n    public avaliacaoDao: AvaliacaoDaoService,\r\n    public templateService: TemplateService,\r\n    public planoTrabalhoDao: PlanoTrabalhoDaoService\r\n  ) { }\r\n\r\n  public template(plano: PlanoTrabalho): Template | undefined {\r\n    return plano.programa?.template_tcr;\r\n  }\r\n\r\n  public metadados(plano: PlanoTrabalho) {\r\n    return {\r\n      needSign: this.needSign.bind(this),\r\n      extraTags: this.extraTags.bind(this),\r\n      especie: \"TCR\",\r\n      titulo: \"Termo de Ciência e Responsabilidade\",\r\n      dataset: this.planoTrabalhoDao.dataset(),\r\n      datasource: this.planoTrabalhoDao.datasource(plano),\r\n      template: plano.programa?.template_tcr,\r\n      template_id: plano.programa?.template_tcr_id\r\n    };\r\n  }\r\n\r\n  public needSign(parent?: HasDocumentos, item?: Documento): boolean {\r\n    const plano = parent as PlanoTrabalho;\r\n    const documento = item || (plano?.documentos || []).find(x => plano?.documento_id?.length && x.id == plano?.documento_id) || plano?.documento;\r\n    if (parent && documento && !documento.assinaturas?.find(x => x.usuario_id == this.auth.usuario!.id)) {\r\n      const tipoModalidade = plano.tipo_modalidade;\r\n      const programa = plano.programa;\r\n      const entidade = this.auth.entidade!;\r\n      let ids: string[] = [];\r\n      if (programa?.plano_trabalho_assinatura_participante) ids.push(plano.usuario_id);\r\n      if (programa?.plano_trabalho_assinatura_gestor_lotacao) ids.push(...this.auth.gestoresLotacao.map(x => x.id));\r\n      if (programa?.plano_trabalho_assinatura_gestor_unidade) ids.push(plano.unidade?.gestor?.id || \"\", ...plano.unidade?.gestores_substitutos?.map(x => x.id) || \"\");\r\n      if (programa?.plano_trabalho_assinatura_gestor_entidade) ids.push(entidade.gestor_id || \"\", entidade.gestor_substituto_id || \"\");\r\n      return !!tipoModalidade && ids.includes(this.auth.usuario!.id);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  public extraTags(parent: HasDocumentos, documento: Documento, metadado: any): LookupItem[] {\r\n    const plano = parent as PlanoTrabalho;\r\n    let tags: LookupItem[] = [];\r\n    if (plano?.documento_id == documento.id) tags.push({ key: documento.id, value: \"Vigente\", icon: \"bi bi-check-all\", color: \"primary\" })\r\n    if (JSON.stringify(metadado.tags) != JSON.stringify(tags)) metadado.tags = tags;\r\n    return metadado.tags;\r\n  }\r\n\r\n  /**\r\n   * Método retorna um badge de acordo com o tipo de entrega recebida no parâmetro 'planoTrabalhoEntrega'. Esse tipo poderá ser 'entrega associada a uma entrega da própria unidade', \r\n   * 'entrega associada a uma entrega de outra unidade', 'entrega associada a outro órgão/entidade', ou ainda 'entrega não vinculada'.\r\n   * @param planoTrabalhoEntrega  Entrega do Plano de Trabalho cujo tipo será analisado.\r\n   * @param planoTrabalho         Plano de Trabalho ao qual pertence a entrega a ser analisada. Se não for informado, o método tentará obtê-lo diretamente da própria entrega recebida.\r\n   * @returns \r\n   */\r\n  public tipoEntrega(planoTrabalhoEntrega: PlanoTrabalhoEntrega, planoTrabalho?: PlanoTrabalho): BadgeTrabalho {\r\n    /* Se planoTrabalhoEntrega for uma entrega vinda do banco de dados, e pertencer a alguma unidade (seja ela a própria do plano de trabalho, ou outra), ela traz consigo planoTrabalhoEntrega.plano_entrega_entrega?.plano_entrega?.unidade_id,\r\n       que será usado para definir a qual tipo de unidade ela está vinculada (própria ou outra). Se planoTrabalhoEntrega não estiver vinculada a nenhuma unidade, ela poderá possuir planoTrabalhoEntrega.orgao \r\n       (caso em que estará 'vinculada a outro órgão/entidade'), ou não (caso em que será uma 'entrega não vinculada').\r\n       Se planoTrabalhoEntrega não vier do banco, ou seja, acabou de ser incluída no grid, ela passou pelo método saveEntrega() e lá foi anexado o objeto 'plano?._metadata?.novaEntrega'. */\r\n    let plano = planoTrabalho || planoTrabalhoEntrega.plano_trabalho;\r\n    let key: PlanoTrabalhoEntregaTipo = planoTrabalhoEntrega.plano_entrega_entrega?.plano_entrega?.unidade_id == plano!.unidade_id ? \"PROPRIA_UNIDADE\" :\r\n      (planoTrabalhoEntrega.plano_entrega_entrega ? \"OUTRA_UNIDADE\" : \r\n      (!!planoTrabalhoEntrega.orgao?.length ? \"OUTRO_ORGAO\" : \"SEM_ENTREGA\"));\r\n    let result = this.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO.find(x => x.key == key) || {key: \"\", value: \"Desconhecido1\"};\r\n    let nome = plano?._metadata?.novaEntrega?.plano_entrega_entrega?.entrega?.nome || planoTrabalhoEntrega.plano_entrega_entrega?.entrega?.nome || \"Desconhecido2\";\r\n    let descricao = plano?._metadata?.novaEntrega?.plano_entrega_entrega?.descricao || planoTrabalhoEntrega.plano_entrega_entrega?.descricao || \"\";\r\n    return { titulo: result.value, cor: result.color || \"danger\", nome: nome, tipo: key, descricao: descricao};\r\n  }\r\n\r\n  /**\r\n   * Método atualiza o TCR caso ele exista (possivelmente obrigatório pelo programa), e caso ele não esteja assinado. \r\n   * Em caso de estar assinado ou ser obrigatório e não exista ainda, será gerado um novo documento.\r\n   * @param planoReferencia  Plano de trabalho para comparação (contendo as entregas)\r\n   * @param planoNovo        Plano de trabalho modificado, com as novas informações (contendo as entregas, programa.template_tcr e documentos)\r\n   * @param ?textUsuario     Texto complementar do usuário, caso não seja informado, irá utilizar o do planoNovo.usuario.texto_complementar_plano\r\n   * @param ?textUnidade     Texto complementar da unidade, caso não seja informado, irá utilizar o do planoNovo.unidade.texto_complementar_plano\r\n   * @returns                Documento gerado ou modificado (observar o _status)\r\n   */\r\n  public atualizarTcr(planoReferencia: PlanoTrabalho, planoNovo: PlanoTrabalho, textUsuario?: string, textUnidade?: string) {\r\n    if (planoNovo.usuario && planoNovo.unidade) {\r\n      let dsReferencia = this.dao!.datasource(planoReferencia);\r\n      let dsNovo = this.dao!.datasource(planoNovo);\r\n      let programa = planoNovo.programa;\r\n      /* Atualiza os campos de texto complementar do usuário e da unidade */\r\n      dsNovo.usuario.texto_complementar_plano = textUsuario || planoNovo.usuario?.texto_complementar_plano || \"\";\r\n      dsNovo.unidade.texto_complementar_plano = textUnidade || planoNovo.unidade?.texto_complementar_plano || \"\";\r\n      /* Se tiver modificações e o termo for obrigatório ou já exista um documento */\r\n      if ((programa?.termo_obrigatorio || planoNovo.documento_id?.length) && JSON.stringify(dsNovo) != JSON.stringify(dsReferencia) && programa?.template_tcr) {\r\n        let documento = planoNovo.documentos?.find((x: Documento) => x.id == planoNovo.documento_id);\r\n        if (!planoNovo.documento_id?.length || !documento || documento.assinaturas?.length || documento.tipo == \"LINK\") {\r\n          documento = new Documento({\r\n            id: this.dao?.generateUuid(),\r\n            tipo: \"HTML\",\r\n            especie: \"TCR\",\r\n            titulo: \"Termo de Ciência e Responsabilidade\",\r\n            conteudo: this.templateService.renderTemplate(programa?.template_tcr?.conteudo || \"\", dsNovo),\r\n            status: \"GERADO\",\r\n            _status: \"ADD\",\r\n            template: programa?.template_tcr?.conteudo,\r\n            dataset: this.dao!.dataset(),\r\n            datasource: dsNovo,\r\n            entidade_id: this.auth.entidade?.id,\r\n            plano_trabalho_id: planoNovo.id,\r\n            template_id: programa?.template_tcr_id\r\n          });\r\n          planoNovo.documentos.push(documento);\r\n        } else {\r\n          documento.conteudo = this.templateService.renderTemplate(programa?.template_tcr?.conteudo || \"\", dsNovo);\r\n          documento.dataset = this.dao!.dataset();\r\n          documento.datasource = dsNovo;\r\n          documento._status = documento._status == \"ADD\" ? \"ADD\" : \"EDIT\";\r\n        }\r\n        planoNovo.documento = documento;\r\n        planoNovo.documento_id = documento?.id || null;\r\n      }\r\n    }\r\n    return planoNovo.documento;\r\n  }\r\n\r\n  /**\r\n   * Informa a situação do plano de trabalho recebido como parâmetro, ou seja, se foi EXCLUIDO ou ARQUIVADO, ou, caso contrário, o seu status atual.\r\n   * @param planoTrabalho \r\n   * @returns \r\n   */\r\n  public situacaoPlano(planoTrabalho: PlanoTrabalho): string {\r\n    if (planoTrabalho.deleted_at) return \"EXCLUIDO\";\r\n    else if (planoTrabalho.data_arquivamento) return \"ARQUIVADO\";\r\n    else return planoTrabalho.status!;\r\n  }\r\n\r\n  /**\r\n   * Informa se o plano de trabalho recebido como parâmetro é válido, ou seja, não foi deletado, não foi cancelado nem foi arquivado.\r\n   * @param planoTrabalho \r\n   * @returns \r\n   */\r\n    public isValido(planoTrabalho: PlanoTrabalho): boolean {\r\n      return !planoTrabalho.deleted_at && planoTrabalho.status != 'CANCELADO' && !planoTrabalho.data_arquivamento;\r\n    }\r\n\r\n    public estaVigente(planoTrabalho: PlanoTrabalho): boolean {\r\n      let hoje = new Date();\r\n      return planoTrabalho.status == 'ATIVO' && planoTrabalho.data_inicio <= hoje && planoTrabalho.data_fim >= hoje\r\n    }\r\n\r\n  /**\r\n   * Calcula a quantidade de dias para concluir a consolidação considerando a tolerância configurada no programa.\r\n   * @param consolidacao  Consolidacao do plano de trabalho\r\n   * @param programa      Programa\r\n   * @returns             Quantidade de dias para conclusão (Retorna números negativos caso tenha passado o prazo)\r\n   */\r\n  public diasParaConcluirConsolidacao(consolidacao?: PlanoTrabalhoConsolidacao, programa?: Programa): number {\r\n    return !consolidacao || !programa ? -1 : this.util.daystamp(consolidacao.data_fim) + programa.dias_tolerancia_avaliacao - this.util.daystamp(this.auth.hora);\r\n  }\r\n\r\n  /**\r\n   * Faz avaliação da consolidação\r\n   * @param consolidacao \r\n   * @param programa\r\n   * @param refresh\r\n   */\r\n  public avaliar(consolidacao: PlanoTrabalhoConsolidacao, programa: Programa, refresh: RefreshConsolidacao) {\r\n    this.go.navigate({route: ['gestao', 'plano-trabalho', 'consolidacao', consolidacao.id, 'avaliar']}, {\r\n      modal: true, \r\n      metadata: {\r\n        consolidacao: consolidacao,\r\n        programa: programa\r\n      },\r\n      modalClose: (modalResult?: Avaliacao) => {\r\n        if(modalResult) {\r\n          consolidacao.status = \"AVALIADO\";\r\n          consolidacao.avaliacao_id = modalResult.id;\r\n          consolidacao.avaliacao = modalResult;\r\n          refresh(consolidacao); \r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Fas recurso contra avaliação\r\n   * @param consolidacao \r\n   * @param programa\r\n   * @param refresh\r\n   */\r\n  public fazerRecurso(consolidacao: PlanoTrabalhoConsolidacao, programa: Programa, refresh: RefreshConsolidacao) {\r\n    this.go.navigate({route: ['gestao', 'plano-trabalho', 'consolidacao', consolidacao.id, 'recurso']}, {\r\n      modal: true, \r\n      metadata: {\r\n        recurso: true,\r\n        consolidacao: consolidacao,\r\n        programa: programa\r\n      },\r\n      modalClose: (modalResult?: Avaliacao) => {\r\n        if(modalResult) {\r\n          consolidacao.avaliacao = modalResult;\r\n          refresh(consolidacao);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public async cancelarAvaliacao(consolidacao: PlanoTrabalhoConsolidacao, page: PageBase, refresh: RefreshConsolidacao) {\r\n    page.submitting = true;\r\n    try {\r\n      let response = await this.avaliacaoDao!.cancelarAvaliacao(consolidacao.avaliacao!.id);\r\n      if(response) {\r\n        consolidacao.status = \"CONCLUIDO\";\r\n        consolidacao.avaliacao_id = null;\r\n        consolidacao.avaliacao = undefined;\r\n        refresh(consolidacao);\r\n      }\r\n    } catch (error: any) {\r\n      page.error(error.message || error);\r\n    } finally {\r\n      page.submitting = false;\r\n    }\r\n  }\r\n\r\n  public usuarioAssinou(assinaram: AssinaturaList, usuarioId?: string): boolean {\r\n    usuarioId = usuarioId || this.auth.usuario!.id;\r\n    return Object.values(assinaram).some(arrayAssinaturas => (arrayAssinaturas || []).includes(usuarioId!));\r\n  }\r\n\r\n  public assinaturasFaltantes(exigidas: AssinaturaList, assinaram: AssinaturaList): AssinaturaList {\r\n    return {\r\n      \"participante\": exigidas.participante.filter(x => !assinaram.participante.includes(x)),\r\n      \"gestores_unidade_executora\": !exigidas.gestores_unidade_executora.length ? [] : (exigidas.gestores_unidade_executora.filter(x => assinaram.gestores_unidade_executora.includes(x)).length ? [] : exigidas.gestores_unidade_executora),\r\n      \"gestores_unidade_lotacao\": !exigidas.gestores_unidade_lotacao.length ? [] : (exigidas.gestores_unidade_lotacao.filter(x => assinaram.gestores_unidade_lotacao.includes(x)).length ? [] : exigidas.gestores_unidade_lotacao),\r\n      \"gestores_entidade\": !exigidas.gestores_entidade.length ? [] : (exigidas.gestores_entidade.filter(x => assinaram.gestores_entidade.includes(x)).length ? [] : exigidas.gestores_entidade),\r\n    };\r\n  }\r\n\r\n/*   public assinaturaUsuarioEhExigida(exigidas: AssinaturaList): boolean {\r\n    return [...exigidas.participante, ...exigidas.gestores_unidade_executora, ...exigidas.gestores_unidade_lotacao, ...exigidas.gestores_entidade].includes(this.auth.usuario?.id!); \r\n  } */\r\n  \r\n}\r\n"],"names":["Documento","PlanoTrabalhoService","constructor","auth","util","go","lookup","dao","avaliacaoDao","templateService","planoTrabalhoDao","template","plano","programa","template_tcr","metadados","needSign","bind","extraTags","especie","titulo","dataset","datasource","template_id","template_tcr_id","parent","item","documento","documentos","find","x","documento_id","length","id","assinaturas","usuario_id","usuario","tipoModalidade","tipo_modalidade","entidade","ids","plano_trabalho_assinatura_participante","push","plano_trabalho_assinatura_gestor_lotacao","gestoresLotacao","map","plano_trabalho_assinatura_gestor_unidade","unidade","gestor","gestores_substitutos","plano_trabalho_assinatura_gestor_entidade","gestor_id","gestor_substituto_id","includes","metadado","tags","key","value","icon","color","JSON","stringify","tipoEntrega","planoTrabalhoEntrega","planoTrabalho","plano_trabalho","plano_entrega_entrega","plano_entrega","unidade_id","orgao","result","ORIGENS_ENTREGAS_PLANO_TRABALHO","nome","_metadata","novaEntrega","entrega","descricao","cor","tipo","atualizarTcr","planoReferencia","planoNovo","textUsuario","textUnidade","dsReferencia","dsNovo","texto_complementar_plano","termo_obrigatorio","generateUuid","conteudo","renderTemplate","status","_status","entidade_id","plano_trabalho_id","situacaoPlano","deleted_at","data_arquivamento","isValido","estaVigente","hoje","Date","data_inicio","data_fim","diasParaConcluirConsolidacao","consolidacao","daystamp","dias_tolerancia_avaliacao","hora","avaliar","refresh","navigate","route","modal","metadata","modalClose","modalResult","avaliacao_id","avaliacao","fazerRecurso","recurso","cancelarAvaliacao","page","_this","_asyncToGenerator","submitting","response","undefined","error","message","usuarioAssinou","assinaram","usuarioId","Object","values","some","arrayAssinaturas","assinaturasFaltantes","exigidas","participante","filter","gestores_unidade_executora","gestores_unidade_lotacao","gestores_entidade","_","i0","ɵɵinject","i1","AuthService","i2","UtilService","i3","NavigateService","i4","LookupService","i5","PlanoTrabalhoDaoService","i6","AvaliacaoDaoService","i7","TemplateService","_2","factory","ɵfac","providedIn"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}