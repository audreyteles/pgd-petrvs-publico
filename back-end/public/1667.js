"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[1667],{81667:(La,N,n)=>{n.r(N),n.d(N,{ProgramaModule:()=>T});var g=n(76733),Z=n(55579),p=n(1391),m=n(2314),d=n(8239),D=n(74040),_=n(92214),S=n(99230),L=n(20207),R=n(88340),B=n(79055),C=n(81214),b=n(90758),q=n(1184),w=n(49367),a=n(20755),O=n(88820),Q=n(32802),F=n(48935),I=n(92392),H=n(84495),j=n(64603),G=n(17819),V=n(66384),Y=n(74978),k=n(25560),W=n(50933),K=n(9224);const X=["unidade"],$=["tipoAvaliacao"];function aa(l,o){if(1&l&&a._UZ(0,"input-select",41),2&l){const t=a.oxw();a.Q6J("size",3)("control",t.form.controls.periodicidade_valor)("items",t.lookup.DIA_SEMANA)}}function ea(l,o){if(1&l&&a._UZ(0,"input-number",42),2&l){const t=a.oxw();a.Q6J("size",3)("control",t.form.controls.periodicidade_valor)}}function ta(l,o){if(1&l&&a._UZ(0,"input-number",43),2&l){const t=a.oxw();a.Q6J("size",3)("control",t.form.controls.periodicidade_valor)}}function oa(l,o){if(1&l&&a._UZ(0,"input-number",44),2&l){const t=a.oxw();a.Q6J("size",4)("control",t.form.controls.nota_padrao_avaliacao)}}function ia(l,o){if(1&l&&a._UZ(0,"input-select",45),2&l){const t=a.oxw();a.Q6J("size",4)("control",t.form.controls.nota_padrao_avaliacao)("items",t.tipoAvaliacaoQualitativo)}}const la=function(){return{instituidora:!0}},na=function(l){return{filter:l}},ra=function(){return["especie","==","TCR"]},sa=function(l){return[l]},da=function(){return["SEMANAL","QUINZENAL"]},ua=function(){return["MENSAL","BIMESTRAL","TRIMESTRAL","SEMESTRAL"]},ca=function(){return["DIAS"]};class h extends q.F{constructor(o){super(o,b.i,_.w),this.injector=o,this._tipoAvaliacaoQualitativo=[],this.validate=(t,e)=>{let i=null;return["nome","unidade_id","tipo_avaliacao_plano_trabalho_id","tipo_avaliacao_plano_entrega_id"].indexOf(e)>=0&&!t.value?.length?i="Obrigat\xf3rio":"prazo_max_plano_entrega"==e&&parseInt(t.value||0)>99999||["data_inicio","data_fim"].indexOf(e)>=0&&!this.dao?.validDateTime(t.value)?i="Inv\xe1lido":"periodicidade_valor"==e&&(["SEMANAL","QUINZENAL"].includes(this.form?.controls.periodicidade_consolidacao.value)&&t.value>6&&(i="Inv\xe1lido"),["MENSAL","BIMESTRAL","TRIMESTRAL","SEMESTRAL"].includes(this.form?.controls.periodicidade_consolidacao.value)&&t.value>31&&(i="M\xe1ximo 31"),["DIAS"].includes(this.form?.controls.periodicidade_consolidacao.value)&&t.value<0&&(i="Inv\xe1lido")),i},this.formValidation=t=>{let e=null;return this.form?.controls.data_fim.value&&this.form?.controls.data_inicio.value>this.form?.controls.data_fim.value&&(e="A data do fim n\xe3o pode ser anterior \xe0 data do inicio!"),e},this.titleEdit=t=>"Editando "+this.lex.translate("Programa")+": "+(t?.nome||""),this.unidadeDao=o.get(C.J),this.templateDao=o.get(S.w),this.tipoDocumentoDao=o.get(R.Q),this.tipoAvaliacaoDao=o.get(L.r),this.tipoJustificativaDao=o.get(B.i),this.templateService=o.get(w.E),this.modalWidth=700,this.form=this.fh.FormBuilder({unidade_id:{default:""},nome:{default:""},normativa:{default:""},link_normativa:{default:null},config:{default:null},data_inicio:{default:new Date},data_fim:{default:new Date},template_tcr_id:{default:null},tipo_avaliacao_plano_entrega_id:{default:""},tipo_avaliacao_plano_trabalho_id:{default:""},tipo_documento_tcr_id:{default:null},prazo_max_plano_entrega:{default:365},termo_obrigatorio:{default:!0},periodicidade_consolidacao:{default:"MENSAL"},periodicidade_valor:{default:1},dias_tolerancia_consolidacao:{default:10},registra_comparecimento:{default:!0},plano_trabalho_assinatura_participante:{default:!0},plano_trabalho_assinatura_gestor_lotacao:{default:!0},plano_trabalho_assinatura_gestor_unidade:{default:!0},plano_trabalho_assinatura_gestor_entidade:{default:!0},checklist_avaliacao_entregas_plano_trabalho:{default:[]},checklist_plano_trabalho_texto:{default:""},checklist_avaliacao_entregas_plano_entrega:{default:[]},checklist_plano_entrega_texto:{default:""},plano_trabalho_criterios_avaliacao:{default:[]},plano_trabalho_criterio_avaliacao:{default:""},dias_tolerancia_avaliacao:{default:20},dias_tolerancia_recurso_avaliacao:{default:20},nota_padrao_avaliacao:{default:0},tipo_justificativa_id:{default:null}},this.cdRef,this.validate),this.join=["unidade"]}loadData(o,t){var e=this;return(0,d.Z)(function*(){let i=Object.assign({},t.value);yield Promise.all([e.unidade.loadSearch(o.unidade||o.unidade_id)]),o.plano_trabalho_criterios_avaliacao=o.plano_trabalho_criterios_avaliacao||[],o.checklist_avaliacao_entregas_plano_entrega=o.checklist_avaliacao_entregas_plano_entrega||[],o.checklist_avaliacao_entregas_plano_trabalho=o.checklist_avaliacao_entregas_plano_trabalho||[],t.patchValue(e.util.fillForm(i,o))})()}initializeData(o){o.patchValue(new b.i)}saveData(o){return new Promise((t,e)=>{const i=this.util.fill(new b.i,this.entity);t(this.util.fillForm(i,this.form.value))})}isTipoAvaliacao(o){let t=this.tipoAvaliacao?.selectedEntity;return t?.tipo==o||!t&&"QUANTITATIVO"==o}get tipoAvaliacaoQualitativo(){let t=this.tipoAvaliacao?.selectedEntity?.notas?.map(e=>Object.assign({},{key:e.nota,value:e.nota}))||[];return JSON.stringify(t)!=JSON.stringify(this._tipoAvaliacaoQualitativo)&&(this._tipoAvaliacaoQualitativo=t),this._tipoAvaliacaoQualitativo}addItemHandlePlanoEntregaChecklist(){let o;const t=this.form.controls.checklist_plano_entrega_texto.value,e=this.util.textHash(t);return t?.length&&this.util.validateLookupItem(this.form.controls.checklist_avaliacao_entregas_plano_entrega.value,e)&&(o={key:e,value:this.form.controls.checklist_plano_entrega_texto.value},this.form.controls.checklist_plano_entrega_texto.setValue("")),o}onClickIN(){this.form?.controls.link_normativa?.value?.length&&window.open(this.form?.controls.link_normativa.value)}static#a=this.\u0275fac=function(t){return new(t||h)(a.Y36(a.zs3))};static#e=this.\u0275cmp=a.Xpm({type:h,selectors:[["app-programa-form"]],viewQuery:function(t,e){if(1&t&&(a.Gf(D.Q,5),a.Gf(X,5),a.Gf($,5)),2&t){let i;a.iGM(i=a.CRH())&&(e.editableForm=i.first),a.iGM(i=a.CRH())&&(e.unidade=i.first),a.iGM(i=a.CRH())&&(e.tipoAvaliacao=i.first)}},features:[a.qOj],decls:49,vars:82,consts:[["initialFocus","unidade_id",3,"form","disabled","title","submit","cancel"],["display","","right",""],["key","GERAL","label","Geral"],[1,"row"],["label","Unidade Instituidora","controlName","unidade_id","required","",3,"size","dao","selectParams"],["unidade",""],["date","","label","Data de In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","Data de in\xedcio da vig\xeancia do programa de gest\xe3o na unidade instituidora",3,"size","control"],["date","","label","Data de Fim","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Data de fim da vig\xeancia do programa de gest\xe3o na unidade instituidora",3,"size","control"],["label","Dura\xe7\xe3o M\xe1x P.E.","icon","bi bi-blockquote-left","controlName","prazo_max_plano_entrega","labelInfo","Limite m\xe1ximo de dias corridos para a dura\xe7\xe3o do plano de entregas a partir da sua data de cria\xe7\xe3o (Zero para n\xe3o limitar)",3,"size","control"],["label","T\xedtulo","icon","bi bi-textarea-t","controlName","nome","required","",3,"size","control"],["label","Normativa","icon","bi bi-blockquote-left","controlName","normativa","labelInfo","Normativa que regula o Programa",3,"size","control"],["iconButton","bi bi-box-arrow-up-right","label","Link Normativa","icon","bi bi-link-45deg","controlName","link_normativa","labelInfo","Link web da instru\xe7\xe3o normativa",3,"size","control","buttonClick"],["key","PLANO_ENTREGA",3,"label"],["controlName","tipo_avaliacao_plano_entrega_id","required","",3,"label","size","dao","labelInfo"],["tipoAvaliacaoEntrega",""],[3,"title"],["label","Checklists das entregas","controlName","checklist_avaliacao_entregas_plano_entrega",3,"size","addItemHandle"],["controlName","checklist_plano_entrega_texto",3,"size"],["key","PLANO_TRABALHO",3,"label"],["scale","small","labelPosition","right","controlName","termo_obrigatorio","label","Se o termo \xe9 obrigat\xf3rio",3,"size"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_participante",3,"size","label"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_gestor_lotacao",3,"size","label"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_gestor_unidade",3,"size","label"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_gestor_entidade",3,"size","label"],["detailsButton","","labelInfo","Template do termo utilizado no plano de trabalho","controlName","template_tcr_id","required","",3,"label","size","dao","where","selectRoute","details"],["controlName","tipo_documento_tcr_id","labelInfo","Tipo de documento utilizado para exportar o termo para o SEI/SUPER",3,"label","size","dao"],["tipoDocumento",""],["controlName","tipo_avaliacao_plano_trabalho_id","required","",3,"label","size","dao","labelInfo"],["tipoAvaliacao",""],["label","Periodicidade","controlName","periodicidade_consolidacao","labelInfo","Per\xedodo para avalia\xe7\xe3o do plano de trabalho",3,"size","control","items"],["label","Dia da semana","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xeas para o restante",3,"size","control","items",4,"ngIf"],["label","Dia do m\xeas","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xeas para o restante",3,"size","control",4,"ngIf"],["label","Qtd. de Dias","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xeas para o restante",3,"size","control",4,"ngIf"],["label","Toler\xe2ncia","controlName","dias_tolerancia_consolidacao","labelInfo","Dias de toler\xe2ncia para o lan\xe7amento do registro das atividades na consolida\xe7\xe3o, ap\xf3s esses dias ser\xe1 liberado automaticamente para avalia\xe7\xe3o",3,"size","control"],["type","warning",3,"message"],["label","Toler\xe2ncia p/ avalia\xe7\xe3o","controlName","dias_tolerancia_avaliacao","labelInfo","Dias de toler\xe2ncia para realizar a avalia\xe7\xe3o, considerando a toler\xe2ncia da consolida\xe7\xe3o. Caso seja zero n\xe3o far\xe1 nada, caso contr\xe1rio ap\xf3s esse prazo a consolida\xe7\xe3o ser\xe1 automaticamente avaliada com a nota padr\xe3o",3,"size","control"],["label","Toler\xe2ncia p/ recurso","controlName","dias_tolerancia_recurso_avaliacao","labelInfo","Dias de toler\xe2ncia para recorrer da avalia\xe7\xe3o",3,"size","control"],["label","Nota","labelInfo","Nota que ser\xe1 atribu\xeddo automaticamente caso a toler\xe2ncia seja alcan\xe7ada",3,"size","control",4,"ngIf"],["label","Conceito","labelInfo","Nota que ser\xe1 atribu\xeddo automaticamente caso a toler\xe2ncia seja alcan\xe7ada",3,"size","control","items",4,"ngIf"],["controlName","tipo_justificativa_id","labelInfo","Tipo de justificativa, para quando o gestor n\xe3o realizar a avalia\xe7\xe3o dentro do prazo",3,"label","size","emptyValue","dao"],["tipoJustificativa",""],["label","Dia da semana","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xeas para o restante",3,"size","control","items"],["label","Dia do m\xeas","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xeas para o restante",3,"size","control"],["label","Qtd. de Dias","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xeas para o restante",3,"size","control"],["label","Nota","labelInfo","Nota que ser\xe1 atribu\xeddo automaticamente caso a toler\xe2ncia seja alcan\xe7ada",3,"size","control"],["label","Conceito","labelInfo","Nota que ser\xe1 atribu\xeddo automaticamente caso a toler\xe2ncia seja alcan\xe7ada",3,"size","control","items"]],template:function(t,e){1&t&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),a.TgZ(1,"tabs",1)(2,"tab",2)(3,"div",3),a._UZ(4,"input-search",4,5),a.qZA(),a.TgZ(6,"div",3),a._UZ(7,"input-datetime",6)(8,"input-datetime",7)(9,"input-number",8),a.qZA(),a.TgZ(10,"div",3),a._UZ(11,"input-text",9)(12,"input-text",10),a.TgZ(13,"input-button",11),a.NdJ("buttonClick",function(){return e.onClickIN()}),a.qZA()()(),a.TgZ(14,"tab",12),a._UZ(15,"input-search",13,14),a.TgZ(17,"separator",15)(18,"input-multiselect",16),a._UZ(19,"input-text",17),a.qZA()()(),a.TgZ(20,"tab",18),a._UZ(21,"input-switch",19)(22,"input-switch",20)(23,"input-switch",21)(24,"input-switch",22)(25,"input-switch",23),a.TgZ(26,"input-search",24),a.NdJ("details",function(r){return e.templateService.details(r)}),a.qZA(),a._UZ(27,"input-search",25,26)(29,"input-search",27,28),a.TgZ(31,"separator",15)(32,"div",3),a._UZ(33,"input-select",29),a.YNc(34,aa,1,3,"input-select",30),a.YNc(35,ea,1,2,"input-number",31),a.YNc(36,ta,1,2,"input-number",32),a._UZ(37,"input-number",33),a.qZA()(),a.TgZ(38,"separator",15)(39,"div",3),a._UZ(40,"top-alert",34),a.qZA(),a.TgZ(41,"div",3),a._UZ(42,"input-number",35)(43,"input-number",36),a.qZA(),a.TgZ(44,"div",3),a.YNc(45,oa,1,2,"input-number",37),a.YNc(46,ia,1,3,"input-select",38),a._UZ(47,"input-search",39,40),a.qZA()()()()()),2&t&&(a.Q6J("form",e.form)("disabled",e.formDisabled)("title",e.isModal?"":e.title),a.xp6(4),a.Q6J("size",12)("dao",e.unidadeDao)("selectParams",a.VKq(74,na,a.DdM(73,la))),a.xp6(3),a.Q6J("size",4)("control",e.form.controls.data_inicio),a.xp6(1),a.Q6J("size",4)("control",e.form.controls.data_fim),a.xp6(1),a.Q6J("size",4)("control",e.form.controls.prazo_max_plano_entrega),a.xp6(2),a.Q6J("size",4)("control",e.form.controls.nome),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",4)("control",e.form.controls.normativa),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",4)("control",e.form.controls.link_normativa),a.xp6(1),a.Q6J("label",e.lex.translate("Plano de entrega")),a.xp6(1),a.Q6J("label",e.lex.translate("Tipo de avalia\xe7\xe3o do Plano de entrega"))("size",12)("dao",e.tipoAvaliacaoDao)("labelInfo",e.lex.translate("Tipo de avalia\xe7\xe3o")+" que especifica a forma que ser\xe1 avaliado "+e.lex.translate("plano de trabalho")+" e "+e.lex.translate("plano de entrega")),a.xp6(2),a.Q6J("title",e.lex.translate("Avalia\xe7\xe3o")+e.lex.translate(" do Plano de Entrega")),a.xp6(1),a.Q6J("size",12)("addItemHandle",e.addItemHandlePlanoEntregaChecklist.bind(e)),a.xp6(1),a.Q6J("size",12),a.uIk("maxlength",250),a.xp6(1),a.Q6J("label",e.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",12),a.xp6(1),a.Q6J("size",12)("label","Exige assinatura "+e.lex.translate("do usu\xe1rio")+e.lex.translate(" do plano de trabalho")),a.xp6(1),a.Q6J("size",12)("label","Exige assinatura do gestor da lota\xe7\xe3o "+e.lex.translate("do usu\xe1rio")+" (para "+e.lex.translate("unidade")+" distinta)"),a.xp6(1),a.Q6J("size",12)("label","Exige assinatura do gestor "+e.lex.translate("da unidade")),a.xp6(1),a.Q6J("size",12)("label","Exige assinatura do gestor "+e.lex.translate("da entidade")),a.xp6(1),a.Q6J("label","Template "+e.lex.translate("termo")+" (TCR)")("size",12)("dao",e.templateDao)("where",a.VKq(77,sa,a.DdM(76,ra)))("selectRoute",e.templateService.selectRoute("TCR",null==e.form||null==e.form.controls||null==e.form.controls.template_tcr_id?null:e.form.controls.template_tcr_id.value)),a.xp6(1),a.Q6J("label","Tipo de documento "+e.lex.translate("termo"))("size",12)("dao",e.tipoDocumentoDao),a.xp6(2),a.Q6J("label",e.lex.translate("Tipo de avalia\xe7\xe3o do Plano de trabalho"))("size",12)("dao",e.tipoAvaliacaoDao)("labelInfo",e.lex.translate("Tipo de avalia\xe7\xe3o")+" que especifica a forma que ser\xe1 avaliado "+e.lex.translate("plano de trabalho")+" e "+e.lex.translate("plano de entrega")),a.xp6(2),a.Q6J("title",e.lex.translate("Consolida\xe7\xe3o")+e.lex.translate(" do Plano de trabalho")),a.xp6(2),a.Q6J("size",6)("control",e.form.controls.periodicidade_consolidacao)("items",e.lookup.PERIODICIDADE_CONSOLIDACAO),a.xp6(1),a.Q6J("ngIf",a.DdM(79,da).includes(e.form.controls.periodicidade_consolidacao.value)),a.xp6(1),a.Q6J("ngIf",a.DdM(80,ua).includes(e.form.controls.periodicidade_consolidacao.value)),a.xp6(1),a.Q6J("ngIf",a.DdM(81,ca).includes(e.form.controls.periodicidade_consolidacao.value)),a.xp6(1),a.Q6J("size",3)("control",e.form.controls.dias_tolerancia_consolidacao),a.xp6(1),a.Q6J("title",e.lex.translate("Avalia\xe7\xe3o")+e.lex.translate(" da Consolida\xe7\xe3o")),a.xp6(2),a.Q6J("message","O sistema ir\xe1 atribuir automaticamente a nota e o tipo de justificativa abaixo quando a toler\xe2ncia para avalia\xe7\xe3o for alcan\xe7ada"),a.xp6(2),a.Q6J("size",6)("control",e.form.controls.dias_tolerancia_avaliacao),a.xp6(1),a.Q6J("size",6)("control",e.form.controls.dias_tolerancia_recurso_avaliacao),a.xp6(2),a.Q6J("ngIf",e.isTipoAvaliacao("QUANTITATIVO")),a.xp6(1),a.Q6J("ngIf",e.isTipoAvaliacao("QUALITATIVO")),a.xp6(1),a.Q6J("label",e.lex.translate("Tipo de justificativa"))("size",8)("emptyValue",null)("dao",e.tipoJustificativaDao))},dependencies:[g.O5,D.Q,O.a,Q.V,F.G,I.m,H.k,j.p,G.p,V.n,Y.i,k.N,W.o,K.l]})}var v=n(73150),z=n(78509),U=n(57224),x=n(83351),J=n(57765),M=n(45512),y=n(42704);function pa(l,o){1&l&&a._UZ(0,"toolbar")}function ma(l,o){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA(),a._UZ(2,"br"),a.TgZ(3,"small"),a._uU(4),a.qZA()),2&l){const t=o.row;a.xp6(1),a.hij(" ",t.nome,""),a.xp6(3),a.hij(" ",t.normativa,"")}}function ha(l,o){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA(),a._UZ(2,"br"),a.TgZ(3,"small"),a._uU(4),a.qZA()),2&l){const t=o.row;a.xp6(1),a.hij(" ",t.unidade.nome,""),a.xp6(3),a.hij(" ",t.unidade.sigla,"")}}function fa(l,o){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA(),a._UZ(2,"br")),2&l){const t=o.row,e=a.oxw();a.xp6(1),a.hij(" ",e.dao.getDateFormatted(t.data_inicio),"")}}function ga(l,o){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&l){const t=o.row,e=a.oxw();a.xp6(1),a.hij(" ",e.dao.getDateFormatted(t.data_fim),"")}}const _a=function(l){return{metadata:l}};class E extends z.E{constructor(o,t){super(o,b.i,_.w),this.injector=o,this.vigentesUnidadeExecutora=!1,this.todosUnidadeExecutora=!1,this.filterWhere=e=>{let i=[],r=e.value;return this.vigentesUnidadeExecutora&&i.push(["vigentesUnidadeExecutora","==",this.auth.unidade.id]),(this.todosUnidadeExecutora||!this.util.isDeveloper())&&i.push(["todosUnidadeExecutora","==",this.auth.unidade.id]),r.nome?.length&&i.push(["nome","like","%"+r.nome.trim().replace(" ","%")+"%"]),i},this.title=this.lex.translate("Programas de Gest\xe3o"),this.code="MOD_PRGT",this.join=["unidade:id, nome"],this.filter=this.fh.FormBuilder({nome:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_PRGT_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG"),this.auth.hasPermissionTo("MOD_PART")&&this.options.push({icon:"bi bi-people",label:"Participantes",onClick:e=>this.go.navigate({route:["gestao","programa",e.id,"participantes"]},{metadata:{programa:e}})})}ngOnInit(){super.ngOnInit(),this.vigentesUnidadeExecutora=this.metadata?.vigentesUnidadeExecutora,this.todosUnidadeExecutora=this.metadata?.todosUnidadeExecutora}static#a=this.\u0275fac=function(t){return new(t||E)(a.Y36(a.zs3),a.Y36(_.w))};static#e=this.\u0275cmp=a.Xpm({type:E,selectors:[["app-programa-list"]],viewQuery:function(t,e){if(1&t&&a.Gf(v.M,5),2&t){let i;a.iGM(i=a.CRH())&&(e.grid=i.first)}},features:[a.qOj],decls:20,vars:31,consts:[[3,"dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","addMetadata","select"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","nome",3,"size","label","control","placeholder"],["title","T\xedtulo/Normativa",3,"template"],["columnTituloNormativa",""],["title","Unidade instituidora",3,"template"],["columnUnidadeInstituidora",""],["title","In\xedcio da Vig\xeancia",3,"template"],["columnInicioVigencia",""],["title","Fim da Vig\xeancia",3,"template"],["columnFimVigencia",""],["type","options",3,"onEdit","options"],[3,"rows"]],template:function(t,e){if(1&t&&(a.TgZ(0,"grid",0),a.NdJ("select",function(r){return e.onSelect(r)}),a.YNc(1,pa,1,0,"toolbar",1),a.TgZ(2,"filter",2)(3,"div",3),a._UZ(4,"input-text",4),a.qZA()(),a.TgZ(5,"columns")(6,"column",5),a.YNc(7,ma,5,2,"ng-template",null,6,a.W1O),a.qZA(),a.TgZ(9,"column",7),a.YNc(10,ha,5,2,"ng-template",null,8,a.W1O),a.qZA(),a.TgZ(12,"column",9),a.YNc(13,fa,3,1,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(15,"column",11),a.YNc(16,ga,2,1,"ng-template",null,12,a.W1O),a.qZA(),a._UZ(18,"column",13),a.qZA(),a._UZ(19,"pagination",14),a.qZA()),2&t){const i=a.MAs(8),r=a.MAs(11),s=a.MAs(14),u=a.MAs(17);a.Q6J("dao",e.dao)("add",e.add)("title",e.isModal?"":e.title)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("hasAdd",e.auth.hasPermissionTo("MOD_PRGT_INCL"))("hasEdit",e.auth.hasPermissionTo("MOD_PRGT_EDT"))("addMetadata",a.VKq(29,_a,e.todosUnidadeExecutora)),a.xp6(1),a.Q6J("ngIf",!e.selectable),a.xp6(1),a.Q6J("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),a.xp6(2),a.Q6J("size",12)("label","Nome do "+e.lex.translate("programa"))("control",e.filter.controls.nome)("placeholder","Nome do "+e.lex.translate("programa")),a.uIk("maxlength",250),a.xp6(2),a.Q6J("template",i),a.xp6(3),a.Q6J("template",r),a.xp6(3),a.Q6J("template",s),a.xp6(3),a.Q6J("template",u),a.xp6(3),a.Q6J("onEdit",e.edit)("options",e.options),a.xp6(1),a.Q6J("rows",e.rowsLimit)}},dependencies:[g.O5,v.M,U.a,x.b,J.z,M.n,y.Q,I.m]})}var ba=n(22866),va=n(91042),Ea=n(35255),Aa=n(26898),Ta=n(95489),Pa=n(2729);const Ia=["programaSearch"];function Na(l,o){if(1&l){const t=a.EpF();a.TgZ(0,"toolbar")(1,"input-switch",20),a.NdJ("change",function(){a.CHM(t);const i=a.oxw();return a.KtG(i.grid.reloadFilter())}),a.qZA()()}if(2&l){const t=a.oxw();a.xp6(1),a.Q6J("size",3)("label",t.lex.translate("Habilitados"))("labelInfo","Se ON, retorna apenas "+t.lex.translate("os usu\xe1rios")+" habilitados "+t.lex.translate("no programa")+". Se OFF, retorna apenas os desabilitados.")("control",t.filter.controls.habilitados)}}function Za(l,o){if(1&l&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3),a.qZA()()()),2&l){const t=a.oxw();a.xp6(3),a.Oqu("Programa: "+(null==t.programa?null:t.programa.nome)||0)}}function Da(l,o){if(1&l&&a._UZ(0,"profile-picture",22),2&l){const t=o.row;a.Q6J("url",t.url_foto)("size",40)("hint",t.nome)}}function Ca(l,o){if(1&l&&(a.TgZ(0,"strong"),a._uU(1),a.qZA(),a._UZ(2,"br"),a.TgZ(3,"small"),a._uU(4),a.qZA()),2&l){const t=o.row;a.xp6(1),a.Oqu(t.nome),a.xp6(3),a.Oqu(t.apelido)}}function Oa(l,o){if(1&l&&a._UZ(0,"badge",23),2&l){const t=o.row,e=a.oxw();a.Q6J("icon",e.isHabilitado(t)?"bi bi-person-check":"bi-person-fill-slash")("label",e.isHabilitado(t)?e.lex.translate("Habilitado"):e.lex.translate("Desabilitado"))("color",e.isHabilitado(t)?"success":"danger")}}function Qa(l,o){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&l){const t=o.row;a.xp6(1),a.Oqu(t.lotacao.unidade.sigla)}}function za(l,o){if(1&l&&(a.TgZ(0,"span"),a._uU(1),a.qZA()),2&l){const t=o.row,e=a.oxw();a.xp6(1),a.Oqu(e.hasPlanoTrabalhoAtivo(t)?"sim":"n\xe3o")}}const Ua=function(l){return["vigentesUnidadeExecutora","==",l]},xa=function(l){return[l]},Ja=function(){return{vigentesUnidadeExecutora:!0}};class f extends z.E{constructor(o){super(o,Aa.b,Ea.q),this.injector=o,this.multiselectMenu=[],this.programa=null,this.BOTAO_HABILITAR={label:this.lex.translate("Habilitar"),hint:this.lex.translate("Habilitar"),icon:"bi bi-person-check-fill",color:"btn-outline-success",onClick:this.habilitarParticipante.bind(this)},this.BOTAO_DESABILITAR={label:this.lex.translate("Desabilitar"),hint:this.lex.translate("Desabilitar"),icon:"bi bi-person-x-fill",color:"btn-outline-danger",onClick:this.desabilitarParticipante.bind(this)},this.validate=(t,e)=>{let i=null;return["programa_id"].indexOf(e)>=0&&!t.value?.length&&(i="Obrigat\xf3rio"),i},this.filterWhere=t=>{let e=[],i=t.value;return i.unidade_id?.length&&e.push(["lotacao","==",i.unidade_id]),i.nome_usuario?.length&&e.push(["nome","like","%"+i.nome_usuario.trim().replace(" ","%")+"%"]),e.push(["habilitado","==",this.filter?.controls.habilitados.value]),e.push(["programa_id","==",this.programa?.id]),e},this.unidadeDao=o.get(C.J),this.programaParticipanteDao=o.get(va.U),this.programaDao=o.get(_.w),this.code="MOD_PART",this.filter=this.fh.FormBuilder({programa_id:{default:this.programa?.id},unidade_id:{default:this.auth.unidade?.id},nome_usuario:{default:""},habilitados:{default:!1}},this.cdRef,this.validate),this.auth.hasPermissionTo("MOD_PART_HAB")&&this.multiselectMenu.push({icon:"bi bi-person-check-fill",label:this.lex.translate("Habilitar"),color:"btn-outline-success",onClick:this.habilitarParticipantes.bind(this)}),this.auth.hasPermissionTo("MOD_PART_DESAB")&&this.multiselectMenu.push({icon:"bi bi-person-x-fill",label:this.lex.translate("Desabilitar"),color:"btn-outline-danger",onClick:this.desabilitarParticipantes.bind(this)}),this.join=["lotacao.unidade:id,sigla","planos_trabalho:id,status","participacoes_programas:id"],this.title=this.lex.translate("Habilita\xe7\xf5es"),this.orderBy=[["nome","asc"]]}dynamicButtons(o){let t=[];return this.auth.hasPermissionTo("MOD_PART_HAB")&&!this.isHabilitado(o)&&t.push(this.BOTAO_HABILITAR),this.auth.hasPermissionTo("MOD_PART_DESAB")&&this.isHabilitado(o)&&t.push(this.BOTAO_DESABILITAR),t}ngAfterViewInit(){var o=this;super.ngAfterViewInit(),this.grid.BUTTON_MULTISELECT_SELECIONAR="Marcar",this.grid.BUTTON_MULTISELECT_CANCELAR_SELECAO="Cancelar Marca\xe7\xe3o",this.grid.BUTTON_MULTISELECT.label="Marcar",(0,d.Z)(function*(){o.loading=!0;try{o.programa=o.metadata?.programa,o.programa||(yield o.programaDao.query({where:[["vigentesUnidadeExecutora","==",o.auth.unidade.id]]}).asPromise().then(t=>{o.programa=t[0],o.programaSearch?.loadSearch(o.programa)}))}finally{o.loading=!1}})()}filterClear(o){o.controls.unidade_id.setValue(void 0),o.controls.nome_usuario.setValue(""),o.controls.habilitados.setValue(!0)}habilitarParticipante(o){var t=this;return(0,d.Z)(function*(){return yield t.programaParticipanteDao.habilitar([o.id],t.programa.id,1,!1).then(e=>{(t.grid?.query||t.query).refreshId(o.id),t.cdRef.detectChanges()}),!1})()}desabilitarParticipante(o){var t=this;return(0,d.Z)(function*(){if(yield t.dialog.confirm("Desabilitar ?","Deseja DESABILITAR "+t.lex.translate("o servidor")+" "+o.nome.toUpperCase()+" "+t.lex.translate("do programa")+" "+(t.programa?.nome).toUpperCase()+" ?")){let i=!1;t.hasPlanoTrabalhoAtivo(o)&&(i=yield t.dialog.confirm("ATEN\xc7\xc3O",t.lex.translate("O servidor")+" possui "+t.lex.translate("Plano de Trabalho")+" ativo vinculado a "+t.lex.translate("este Programa")+"! Deseja continuar com a desabilita\xe7\xe3o, suspendendo o seu "+t.lex.translate("Plano de Trabalho ?"))),(!t.hasPlanoTrabalhoAtivo(o)||i)&&(yield t.programaParticipanteDao.habilitar([o.id],t.programa.id,0,i).then(r=>{(t.grid?.query||t.query).refreshId(o.id),t.cdRef.detectChanges()}))}})()}habilitarParticipantes(){var o=this;return(0,d.Z)(function*(){if(o.grid.multiselectedCount){const t=o;o.dialog.confirm("Habilitar Participantes ?","Confirma a habilita\xe7\xe3o de todos esses participantes?").then(e=>{if(e){const i=Object.values(o.grid.multiselected).map(r=>r.id);o.programaParticipanteDao.habilitar(i,o.programa.id,1,!1).then(function(){t.dialog.topAlert("Participantes habilitados com sucesso!",5e3),(t.grid?.query||t.query).refresh()}).catch(function(r){t.dialog.alert("Erro",(r?.message,r?.message))}),o.grid?.enableMultiselect(!1),t.cdRef.detectChanges()}})}else o.dialog.alert("Selecione","Nenhum participante selecionado para a habilita\xe7\xe3o")})()}desabilitarParticipantes(){var o=this;return(0,d.Z)(function*(){let t=Object.keys(o.grid.multiselected);o.dialog.confirm("Desabilitar ?","Deseja DESABILITAR, "+o.lex.translate("do programa")+" "+(o.programa?.nome).toUpperCase()+" todos "+o.lex.translate("os usu\xe1rios")+" selecionados ?").then(function(){var e=(0,d.Z)(function*(i){if(i){const r=o;let s=0;yield o.programaParticipanteDao.quantidadePlanosTrabalhoAtivos(t).then(c=>{s=c});let u=!1;if(s&&(yield o.dialog.confirm("ATEN\xc7\xc3O","H\xe1 "+s+o.lex.translate(1==s?" usu\xe1rio":" usu\xe1rios")+" com "+o.lex.translate("Plano de Trabalho")+" ativo vinculado a "+o.lex.translate("este Programa")+"! Deseja continuar com a desabilita\xe7\xe3o, suspendendo "+(1==s?"o seu ":"todos ")+o.lex.translate(1==s?"Plano de Trabalho":"os Planos de Trabalho")+" ?").then(c=>{u=c})),!s||u){const c=Object.values(o.grid.multiselected).map(P=>P.id);o.programaParticipanteDao.habilitar(c,o.programa.id,0,u).then(P=>{r.dialog.topAlert("Participantes desabilitados com sucesso!",5e3),(o.grid?.query||o.query).refresh()}).catch(function(P){r.grid&&(r.grid.error=P)}),o.grid?.enableMultiselect(!1),o.cdRef.detectChanges()}}});return function(i){return e.apply(this,arguments)}}())})()}onProgramaChange(){this.programa=this.programaSearch?.selectedItem?.entity,this.programa&&this.grid?.reloadFilter()}isHabilitado(o){return!!o.participacoes_programas.find(t=>1==t.habilitado&&t.programa_id==this.programa?.id)}hasPlanoTrabalhoAtivo(o){return!!o.planos_trabalho?.find(t=>"ATIVO"==t.status&&this.util.between((0,ba.now)(),{start:t.data_inicio,end:t.data_fim}))}static#a=this.\u0275fac=function(t){return new(t||f)(a.Y36(a.zs3))};static#e=this.\u0275cmp=a.Xpm({type:f,selectors:[["app-programa-participantes"]],viewQuery:function(t,e){if(1&t&&(a.Gf(v.M,5),a.Gf(Ia,5)),2&t){let i;a.iGM(i=a.CRH())&&(e.grid=i.first),a.iGM(i=a.CRH())&&(e.programaSearch=i.first)}},features:[a.qOj],decls:29,vars:53,consts:[["multiselect","","editable","",3,"dao","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","hasDelete","multiselectMenu","select"],[4,"ngIf"],[3,"deleted","form","where","clear","submit","collapseChange","collapsed"],[1,"row"],["controlName","programa_id","required","",3,"size","disabled","control","dao","where","metadata","change"],["programaSearch",""],["controlName","nome_usuario",3,"size","label","control","placeholder"],["controlName","unidade_id",3,"size","control","label","labelInfo","dao"],["unidade",""],["class","mt-2 mb-4",4,"ngIf"],["icon","bi-person",1,"text-center",3,"template"],["columnFoto",""],[3,"title","template"],["columnUsuario",""],[3,"title","align","template"],["columnHabilitado",""],["columnLotacao",""],["columnPlanoTrabalho",""],["type","options",3,"dynamicButtons"],[3,"rows"],["labelPosition","left","controlName","habilitados",3,"size","label","labelInfo","control","change"],[1,"mt-2","mb-4"],[3,"url","size","hint"],[3,"icon","label","color"]],template:function(t,e){if(1&t&&(a.TgZ(0,"grid",0),a.NdJ("select",function(r){return e.onSelect(r)}),a.YNc(1,Na,2,4,"toolbar",1),a.TgZ(2,"filter",2)(3,"div",3)(4,"input-search",4,5),a.NdJ("change",function(){return e.onProgramaChange()}),a.qZA()(),a.TgZ(6,"div",3),a._UZ(7,"input-text",6)(8,"input-search",7,8),a.qZA()(),a.YNc(10,Za,4,1,"div",9),a.TgZ(11,"columns")(12,"column",10),a.YNc(13,Da,1,3,"ng-template",null,11,a.W1O),a.qZA(),a.TgZ(15,"column",12),a.YNc(16,Ca,5,2,"ng-template",null,13,a.W1O),a.qZA(),a.TgZ(18,"column",14),a.YNc(19,Oa,1,3,"ng-template",null,15,a.W1O),a.qZA(),a.TgZ(21,"column",12),a.YNc(22,Qa,2,1,"ng-template",null,16,a.W1O),a.qZA(),a.TgZ(24,"column",14),a.YNc(25,za,2,1,"ng-template",null,17,a.W1O),a.qZA(),a._UZ(27,"column",18),a.qZA(),a._UZ(28,"pagination",19),a.qZA()),2&t){const i=a.MAs(14),r=a.MAs(17),s=a.MAs(20),u=a.MAs(23),c=a.MAs(26);a.Q6J("dao",e.dao)("title",e.isModal?"":e.title)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("hasAdd",!1)("hasEdit",!1)("hasDelete",!1)("multiselectMenu",e.multiselectMenu),a.xp6(1),a.Q6J("ngIf",!e.selectable),a.xp6(1),a.Q6J("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("clear",e.filterClear.bind(e))("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),a.xp6(2),a.Q6J("size",12)("disabled",e.isModal?"true":void 0)("control",e.filter.controls.programa_id)("dao",e.programaDao)("where",a.VKq(50,xa,a.VKq(48,Ua,e.auth.unidade.id)))("metadata",a.DdM(52,Ja)),a.xp6(3),a.Q6J("size",6)("label","Nome do "+e.lex.translate("usu\xe1rio"))("control",e.filter.controls.nome_usuario)("placeholder","Nome do "+e.lex.translate("usuario")+"..."),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",6)("control",e.filter.controls.unidade_id)("label",e.lex.translate("Unidade ")+e.lex.translate("de lota\xe7\xe3o"))("labelInfo","Se a op\xe7\xe3o TODOS estiver OFF, exibe apenas "+e.lex.translate("os usu\xe1rios")+" habilitados lotados "+e.lex.translate("nessa unidade")+". Se a op\xe7\xe3o TODOS estiver ON, exibe todos "+e.lex.translate("os usu\xe1rios")+" lotados "+e.lex.translate("nessa unidade")+", habilitados, desabilitados e inabilitados.")("dao",e.unidadeDao),a.xp6(2),a.Q6J("ngIf",null==e.grid||null==e.grid.filterRef?null:e.grid.filterRef.collapsed),a.xp6(2),a.Q6J("template",i),a.xp6(3),a.Q6J("title",e.lex.translate("Usu\xe1rio"))("template",r),a.xp6(3),a.Q6J("title",e.lex.translate("Habilitado"))("align","center")("template",s),a.xp6(3),a.Q6J("title",e.lex.translate("Lota\xe7\xe3o"))("template",u),a.xp6(3),a.Q6J("title",e.lex.translate("Plano de Trabalho")+" ativo?")("align","center")("template",c),a.xp6(3),a.Q6J("dynamicButtons",e.dynamicButtons.bind(e)),a.xp6(1),a.Q6J("rows",e.rowsLimit)}},dependencies:[g.O5,v.M,U.a,x.b,J.z,M.n,y.Q,O.a,Q.V,I.m,Ta.F,Pa.q],styles:[".habilitado[_ngcontent-%COMP%]{background:#198754;border:2px solid #1B5E20}.desabilitado[_ngcontent-%COMP%]{background:#dc3545;border:2px solid #B71C1C}"]})}const Ma=[{path:"",component:E,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Programas"}},{path:"new",component:h,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Programa",modal:!0}},{path:"participantes",component:f,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Participantes do Programa"}},{path:":id/edit",component:h,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Programa",modal:!0}},{path:":id/consult",component:h,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Programa",modal:!0}},{path:":id/participantes",component:f,canActivate:[p.a],resolve:{config:m.o},runGuardsAndResolvers:"always",data:{title:"Participantes do Programa",modal:!0}}];class A{static#a=this.\u0275fac=function(t){return new(t||A)};static#e=this.\u0275mod=a.oAB({type:A});static#t=this.\u0275inj=a.cJS({imports:[Z.Bz.forChild(Ma),Z.Bz]})}var ya=n(58568),Sa=n(72133);class T{static#a=this.\u0275fac=function(t){return new(t||T)};static#e=this.\u0275mod=a.oAB({type:T});static#t=this.\u0275inj=a.cJS({imports:[g.ez,ya.K,Sa.UX,A]})}}}]);