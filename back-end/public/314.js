"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[314],{9314:(V,p,n)=>{n.r(p),n.d(p,{AfastamentoModule:()=>Y});var u=n(6733),c=n(5579),m=n(1391),r=n(2314),Z=n(8239),h=n(4040),_=n(4561),d=n(4684),O=n(1184),v=n(4002),g=n(5255),t=n(755),A=n(8967),C=n(4508),T=n(4495),M=n(933);const F=["tipoMotivoAfastamento"],y=["usuario"];function Q(s,l){if(1&s&&t._UZ(0,"top-alert",10),2&s){const o=t.oxw();t.Q6J("message",o.warning)}}let f=(()=>{class s extends O.F{constructor(o){super(o,d.i,_.e),this.injector=o,this.validate=(e,a)=>{let i=null;return["usuario_id","tipo_motivo_afastamento_id"].indexOf(a)>=0&&!e.value?.length?i="Obrigat\xf3rio":["data_inicio","data_fim"].indexOf(a)>=0&&!this.dao?.validDateTime(e.value)&&(i="Inv\xe1lido"),i},this.titleEdit=e=>"Editando "+this.lex.translate("afastamento")+": "+(e?.usuario?.nome||"")+" - "+(e?.tipo_motivo_afastamento?.nome||""),this.tipoMotivoAfastamentoDao=o.get(v.n),this.usuarioDao=o.get(g.q),this.title=this.lex.translate("Afastamento"),this.form=this.fh.FormBuilder({observacoes:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},tipo_motivo_afastamento_id:{default:""}},this.cdRef,this.validate),this.join=["usuario","tipo_motivo_afastamento"]}isHoras(){return!(!this.form.controls.tipo_motivo_afastamento_id.value?.length||!this.tipoMotivoAfastamento?.selectedEntity?.horas)}loadData(o,e){var a=this;return(0,Z.Z)(function*(){let i=Object.assign({},e.value);a.metadata?.consolidacao&&(a.consolidacao=a.metadata?.consolidacao,o.usuario_id=a.consolidacao.plano_trabalho.usuario_id,o.usuario=a.consolidacao.plano_trabalho?.usuario),yield Promise.all([a.usuario.loadSearch(o.usuario||i.usuario_id),a.tipoMotivoAfastamento.loadSearch(o.tipo_motivo_afastamento||i.tipo_motivo_afastamento_id)]),e.patchValue(a.util.fillForm(i,o))})()}initializeData(o){this.entity=new d.i,this.loadData(this.entity,o)}saveData(o){return new Promise((e,a)=>{let i=this.util.fill(new d.i,this.entity);i=this.util.fillForm(i,this.form.value),this.isHoras()||(i.data_inicio.setHours(0,0,0),i.data_fim.setHours(23,59,0),i.data_fim.setDate(i.data_fim.getDate())),e(i)})}get warning(){let o,e=this.util.asDate(this.form.controls.data_inicio.value),a=this.util.asDate(this.form.controls.data_fim.value);return this.consolidacao&&e&&a&&(this.util.daystamp(e)<this.util.daystamp(this.consolidacao.data_inicio)||this.util.daystamp(a)>this.util.daystamp(this.consolidacao.data_fim))&&(o="Aten\xe7\xe3o: Data da consolida\xe7\xe3o do plano \xe9 de "+this.util.getDateFormatted(this.consolidacao.data_inicio)+" a "+this.util.getDateFormatted(this.consolidacao.data_fim)),o}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(t.zs3))};static#a=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-afastamento-form"]],viewQuery:function(e,a){if(1&e&&(t.Gf(h.Q,5),t.Gf(F,5),t.Gf(y,5)),2&e){let i;t.iGM(i=t.CRH())&&(a.editableForm=i.first),t.iGM(i=t.CRH())&&(a.tipoMotivoAfastamento=i.first),t.iGM(i=t.CRH())&&(a.usuario=i.first)}},features:[t.qOj],decls:12,vars:16,consts:[["type","warning",3,"message",4,"ngIf"],["initialFocus","usuario_id",3,"form","disabled","title","submit","cancel"],[1,"row"],["controlName","usuario_id","required","",3,"size","disabled","dao"],["usuario",""],["controlName","tipo_motivo_afastamento_id","required","","label","Motivo",3,"size","dao"],["tipoMotivoAfastamento",""],["label","In\xedcio","controlName","data_inicio",3,"date","size"],["label","Fim","controlName","data_fim",3,"date","size"],["label","Observa\xe7\xf5es","controlName","observacoes",3,"size","rows"],["type","warning",3,"message"]],template:function(e,a){1&e&&(t.YNc(0,Q,1,1,"top-alert",0),t.TgZ(1,"editable-form",1),t.NdJ("submit",function(){return a.onSaveData()})("cancel",function(){return a.onCancel()}),t.TgZ(2,"div",2),t._UZ(3,"input-search",3,4)(5,"input-search",5,6),t.qZA(),t.TgZ(7,"div",2),t._UZ(8,"input-datetime",7)(9,"input-datetime",8),t.qZA(),t.TgZ(10,"div",2),t._UZ(11,"input-textarea",9),t.qZA()()),2&e&&(t.Q6J("ngIf",null==a.warning?null:a.warning.length),t.xp6(1),t.Q6J("form",a.form)("disabled",a.formDisabled)("title",a.isModal?"":a.title),t.xp6(2),t.Q6J("size",6)("disabled",a.consolidacao?"true":void 0)("dao",a.usuarioDao),t.xp6(2),t.Q6J("size",6)("dao",a.tipoMotivoAfastamentoDao),t.xp6(3),t.Q6J("date",a.isHoras()?void 0:"")("size",6),t.xp6(1),t.Q6J("date",a.isHoras()?void 0:"")("size",6),t.xp6(2),t.Q6J("size",12)("rows",3),t.uIk("maxlength",250))},dependencies:[u.O5,h.Q,A.V,C.Q,T.k,M.o]})}return s})();var D=n(3150),J=n(8509),z=n(7224),I=n(3351),N=n(7765),w=n(5512),E=n(2704);function U(s,l){1&s&&t._UZ(0,"toolbar")}function b(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const o=l.row;t.xp6(1),t.hij(" ",o.usuario.nome,"")}}function L(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const o=t.oxw().row;t.xp6(1),t.hij(" ","(c\xf3d. "+o.tipo_motivo_afastamento.codigo+")","")}}function G(s,l){if(1&s&&(t._UZ(0,"i"),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.YNc(3,L,2,1,"span",1)),2&s){const o=l.row;t.Tol(o.tipo_motivo_afastamento.icone),t.xp6(1),t.Udp("color",o.tipo_motivo_afastamento.cor),t.xp6(1),t.hij(" ",o.tipo_motivo_afastamento.nome,""),t.xp6(1),t.Q6J("ngIf",o.tipo_motivo_afastamento.codigo)}}function R(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const o=l.row,e=t.oxw();t.xp6(1),t.hij(" ",e.dao.getDateFormatted(o.data_inicio),"")}}function j(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&s){const o=l.row,e=t.oxw();t.xp6(1),t.hij(" ",e.dao.getDateFormatted(o.data_fim),"")}}const B=[{path:"",component:(()=>{class s extends J.E{constructor(o){super(o,d.i,_.e),this.injector=o,this.listagemInicial=!0,this.filterWhere=e=>{let a=[],i=e.value;return i.usuario_id?.length&&i.tipo_motivo_afastamento_id?.length?(a.push(["usuario_id","==",i.usuario_id]),a.push(["tipo_motivo_afastamento_id","==",i.tipo_motivo_afastamento_id])):i.usuario_id?.length?a.push(["usuario_id","==",i.usuario_id]):i.tipo_motivo_afastamento_id?.length?a.push(["tipo_motivo_afastamento_id","==",i.tipo_motivo_afastamento_id]):this.dao?.validDateTime(i.data_inicio)&&this.dao?.validDateTime(i.data_fim)&&!this.listagemInicial&&a.push(this.dao?.intersectionWhere("data_inicio","data_fim",this.util.startOfDay(i.data_inicio),this.util.startOfDay(i.data_fim))),a},this.join=["tipo_motivo_afastamento:id, nome","usuario: id, nome"],this.tipoMotivoAfastamentoDao=o.get(v.n),this.usuarioDao=o.get(g.q),this.title=this.lex.translate("Afastamentos"),this.code="MOD_AFT",this.filter=this.fh.FormBuilder({observacoes:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},tipo_motivo_afastamento_id:{default:""}}),this.OPTION_INFORMACOES.onClick=e=>this.go.navigate({route:["gestao","afastamento",e.id,"consult"]},{modal:!0}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_AFT_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}filtro(){this.listagemInicial=!1}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(t.zs3))};static#a=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-afastamento-list"]],viewQuery:function(e,a){if(1&e&&t.Gf(D.M,5),2&e){let i;t.iGM(i=t.CRH())&&(a.grid=i.first)}},features:[t.qOj],decls:26,vars:32,consts:[[3,"dao","add","title","orderBy","groupBy","join","hasAdd","hasEdit"],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","tipo_motivo_afastamento_id","label","Motivo",3,"size","control","dao"],["tipoMotivoAfastamento",""],["date","","label","In\xedcio","controlName","data_inicio",3,"size","click"],["date","","label","Fim","controlName","data_fim",3,"size","click"],[3,"title","template"],["columnUsuario",""],["columnMotivoAfastamento",""],["title","In\xedcio",3,"template"],["columnInicioAfastamento",""],["title","Fim",3,"template"],["columnFimAfastamento",""],["title","Observa\xe7\xf5es","field","observacoes"],["type","options",3,"onEdit","options"],[3,"rows"]],template:function(e,a){if(1&e&&(t.TgZ(0,"grid",0),t.YNc(1,U,1,0,"toolbar",1),t.TgZ(2,"filter",2)(3,"div",3),t._UZ(4,"input-search",4,5)(6,"input-search",6,7),t.TgZ(8,"input-datetime",8),t.NdJ("click",function(){return a.filtro()}),t.qZA(),t.TgZ(9,"input-datetime",9),t.NdJ("click",function(){return a.filtro()}),t.qZA()()(),t.TgZ(10,"columns")(11,"column",10),t.YNc(12,b,2,1,"ng-template",null,11,t.W1O),t.qZA(),t.TgZ(14,"column",10),t.YNc(15,G,4,6,"ng-template",null,12,t.W1O),t.qZA(),t.TgZ(17,"column",13),t.YNc(18,R,2,1,"ng-template",null,14,t.W1O),t.qZA(),t.TgZ(20,"column",15),t.YNc(21,j,2,1,"ng-template",null,16,t.W1O),t.qZA(),t._UZ(23,"column",17)(24,"column",18),t.qZA(),t._UZ(25,"pagination",19),t.qZA()),2&e){const i=t.MAs(13),W=t.MAs(16),X=t.MAs(19),x=t.MAs(22);t.Q6J("dao",a.dao)("add",a.add)("title",a.isModal?"":a.title)("orderBy",a.orderBy)("groupBy",a.groupBy)("join",a.join)("hasAdd",a.auth.hasPermissionTo("MOD_AFT_INCL"))("hasEdit",a.auth.hasPermissionTo("MOD_AFT_EDT")),t.xp6(1),t.Q6J("ngIf",!a.selectable),t.xp6(1),t.Q6J("form",a.filter)("where",a.filterWhere)("submit",a.filterSubmit.bind(a))("collapseChange",a.filterCollapseChange.bind(a))("collapsed",a.filterCollapsed)("deleted",a.auth.hasPermissionTo("MOD_AUDIT_DEL")),t.xp6(2),t.Q6J("size",3)("control",a.filter.controls.usuario_id)("dao",a.usuarioDao),t.xp6(2),t.Q6J("size",3)("control",a.filter.controls.tipo_motivo_afastamento_id)("dao",a.tipoMotivoAfastamentoDao),t.xp6(2),t.Q6J("size",3),t.xp6(1),t.Q6J("size",3),t.xp6(2),t.Q6J("title",a.lex.translate("Usu\xe1rio"))("template",i),t.xp6(3),t.Q6J("title",a.lex.translate("Motivo"))("template",W),t.xp6(3),t.Q6J("template",X),t.xp6(3),t.Q6J("template",x),t.xp6(4),t.Q6J("onEdit",a.edit)("options",a.options),t.xp6(1),t.Q6J("rows",a.rowsLimit)}},dependencies:[u.O5,D.M,z.a,I.b,N.z,w.n,E.Q,A.V,T.k]})}return s})(),canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Afastamentos"}},{path:"new",component:f,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Afastamento",modal:!0}},{path:":id/edit",component:f,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Afastamento",modal:!0}},{path:":id/consult",component:f,canActivate:[m.a],resolve:{config:r.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Afastamento",modal:!0}}];let H=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#a=this.\u0275mod=t.oAB({type:s});static#o=this.\u0275inj=t.cJS({imports:[c.Bz.forChild(B),c.Bz]})}return s})();var P=n(2662),S=n(2133);let Y=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#a=this.\u0275mod=t.oAB({type:s});static#o=this.\u0275inj=t.cJS({imports:[u.ez,P.K,S.UX,H]})}return s})()}}]);