import{l as ze,n as qe}from"./chunk-5IAOL3IR.js";import{a as de}from"./chunk-UFS3OPCG.js";import{b as ce}from"./chunk-76VPKZU2.js";import{a as L,b as Q}from"./chunk-RMYSPY7H.js";import{M as Ve,N as Ne,O as Fe,P as ke,Q as Ae,b as B,ba as Re,f as se,fa as Le,h as X,i as U,j as Te,n as W,o as me,s as E,t as pe,v as je,w as ue,x as K,y as Me}from"./chunk-XHTD5OAS.js";import{b as ae,c as H,d as $,e as re,h as le,m as J,s as D}from"./chunk-KODYKPWY.js";import{Aa as te,Ab as we,Bb as A,Db as Ee,Dc as De,Fa as m,Fb as Ie,Ga as d,Ha as c,Hd as z,Ka as he,Kd as q,La as I,Ma as g,Na as u,P as Z,Sc as oe,U as M,Ua as j,V as ee,Va as C,Wa as y,Xa as x,Ya as O,Z as v,Za as S,_ as h,_a as Y,ba as V,h as b,kb as ie,ma as s,mb as be,na as N,oc as ge,sb as P,ud as ne,va as F,wc as Se,xa as f,xd as T,ya as k,yd as R,za as l}from"./chunk-6YMI2QVU.js";function tt(n,a){if(n&1&&(m(0,"span",12),c(1,"badge",13),d()),n&2){let r,i,t,e=a.separator,o=u();s(),l("icon",((r=o.getEixo(e==null?null:e.text))==null?null:r.icone)||"bi bi-gear")("color",((i=o.getEixo(e==null?null:e.text))==null?null:i.cor)||"primary")("label",((t=o.getEixo(e==null?null:e.text))==null?null:t.nome)||"Desconhecido")}}function it(n,a){if(n&1&&(m(0,"span",14),O(1),d()),n&2){let r=a.row,i=u();te("margin-left",((r._metadata==null?null:r._metadata.level)||0)*20,"px"),s(),S(i.marcador(r)+r.nome)}}function ot(n,a){if(n&1&&(m(0,"span"),O(1),d()),n&2){let r=a.row;s(),S(r.eixo_tematico==null?null:r.eixo_tematico.nome)}}function nt(n,a){if(n&1&&(m(0,"span"),O(1),d()),n&2){let r=a.row;s(),S(r.fundamentacao)}}function at(n,a){if(n&1&&(m(0,"span"),O(1),d()),n&2){let r=a.row;s(),S((r.objetivo_superior==null?null:r.objetivo_superior.nome)||"")}}function rt(n,a){if(n&1&&(m(0,"column",15),f(1,at,2,1,"ng-template",null,5,P),d()),n&2){let r=x(2);l("template",r)}}var fe=(()=>{let a=class a extends J{set control(i){super.control=i}get control(){return super.control}set entity(i){super.entity=i}get entity(){return super.entity}set disabled(i){this._disabled!=i&&(this._disabled=i)}get disabled(){return this._disabled}set noPersist(i){super.noPersist=i}get noPersist(){return super.noPersist}get items(){return this.gridControl.value||this.gridControl.setValue(new z),this.gridControl.value.objetivos||(this.gridControl.value.objetivos=[]),this.gridControl.value.objetivos}constructor(i){super(i),this.injector=i,this.minHeight=350,this.options=[],this._disabled=!1,this.eixos=[],this.dao=i.get(T),this.objetivoDao=i.get(R),this.eixoDao=i.get(ne),this.groupBy=[{field:"eixo_tematico_id",label:"Eixo Tem\xE1tico"}],this.orderBy=[["nome","asc"]],this.form=this.fh.FormBuilder({nome:{default:""},fundamentacao:{default:""},planejamento_id:{default:null},eixo_tematico_id:{default:null},objetivo_superior_id:{default:null}},this.cdRef),this.OPTION_INFORMACOES.onClick=t=>this.go.navigate({route:["gestao","planejamento","objetivo",t.id,"consult"]},{modal:!0}),this.OPTION_EXCLUIR.onClick=t=>{this.removeObjetivo(t)},this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_PLAN_INST_EXCL")}ngOnInit(){super.ngOnInit(),this.entity=this.metadata?.entity||this.entity,this.carregaEixos(),this.sortObjetivos()}dynamicButtons(i){let t=[],e=i;return this.auth.hasPermissionTo("MOD_PLAN_INST_EDT")&&!this.disabled&&t.push({hint:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:o=>{this.editObjetivo(o)}}),t.push({hint:"Entregas",icon:"bi bi-file-earmark-bar-graph",onClick:o=>this.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",o.id]},{modal:!0})}),t}marcador(i){let t=i._metadata?.level||0;return t<1?"":t<2?"\u2022 ":t<3?"- ":"+ "}addObjetivo(){return b(this,null,function*(){let i=new q({_status:"ADD",id:this.dao.generateUuid(),planejamento_id:this.entity?.id});this.go.navigate({route:["gestao","planejamento","objetivo"]},{metadata:{planejamento:this.entity,objetivo:i,objetivos:this.objetivosPai(i.id)},modalClose:t=>b(this,null,function*(){if(t)try{this.carregaEixos(),this.isNoPersist?this.items.push(t):this.items.push(yield this.objetivoDao.save(t)),this.sortObjetivos()}catch(e){this.error(e?.error||e?.message||e)}})})})}objetivosPai(i){let t=[],e=o=>{for(let p of o)p.id!=i&&(t.push(p),e(this.items.filter(_=>_.objetivo_pai_id==p.id).sort((_,w)=>_.sequencia-w.sequencia)))};return e(this.items.filter(o=>!o.objetivo_pai_id).sort((o,p)=>o.sequencia-p.sequencia)),t}sortObjetivos(){let i=[],t=(e,o)=>{for(let p of e)p._metadata=Object.assign(p._metadata||{},{level:o}),i.push(p),p._status!="DELETE"&&t(this.items.filter(_=>_.objetivo_pai_id==p.id).sort((_,w)=>_.nome>w.nome?1:-1),o+1)};t(this.items.filter(e=>!e.objetivo_pai_id).sort((e,o)=>e.nome>o.nome?1:-1),0),this.items.length=0,this.items.push(...i),this.cdRef.detectChanges()}editObjetivo(i){return b(this,null,function*(){i._status=i._status=="ADD"?"ADD":"EDIT";let t=this.items.indexOf(i);this.go.navigate({route:["gestao","planejamento","objetivo"]},{metadata:{planejamento:this.entity,objetivo:i,objetivos:this.objetivosPai(i.id)},modalClose:e=>b(this,null,function*(){e&&(this.isNoPersist||(yield this.objetivoDao?.save(e)),this.items[t]=e,this.carregaEixos(),this.sortObjetivos())})})})}removeObjetivo(i){return b(this,null,function*(){if(yield this.dialog.confirm("Exclui ?","Deseja realmente excluir?")){let e=this.items.indexOf(i);return this.isNoPersist?i._status="DELETE":(yield this.objetivoDao.delete(i),this.grid?.items.splice(e,1)),this.sortObjetivos(),!0}else return!1})}getEixo(i){return this.eixos?.find(t=>t.id==i)}carregaEixos(){this.eixoDao?.query().getAll().then(i=>{this.eixos=i})}};a.\u0275fac=function(t){return new(t||a)(N(V))},a.\u0275cmp=M({type:a,selectors:[["planejamento-list-objetivo"]],viewQuery:function(t,e){if(t&1&&(j(E,5),j(D,5)),t&2){let o;C(o=y())&&(e.editableForm=o.first),C(o=y())&&(e.grid=o.first)}},inputs:{planejamento_superior_id:"planejamento_superior_id",control:"control",entity:"entity",disabled:"disabled",noPersist:"noPersist"},features:[F],decls:16,vars:19,consts:[["gridObjetivos",""],["groupEixoTematico",""],["columnNome",""],["columnEixoTematico",""],["columnFundamentacao",""],["columnObjetivoSuperior",""],["editable","",3,"items","form","selectable","minHeight","add","remove","hasDelete","hasEdit","hasAdd","join","groupBy","orderBy","groupTemplate"],["title","Nome",3,"template"],["title","Eixo Tem\xE1tico",3,"template"],["title","Fundamenta\xE7\xE3o",3,"template"],["title","Objetivo Superior",3,"template",4,"ngIf"],["type","options",3,"dynamicButtons","options"],[1,"text-wrap"],[3,"icon","color","label"],[1,"text-break","w-100"],["title","Objetivo Superior",3,"template"]],template:function(t,e){if(t&1&&(m(0,"grid",6,0),f(2,tt,2,3,"ng-template",null,1,P),m(4,"columns")(5,"column",7),f(6,it,2,3,"ng-template",null,2,P),d(),m(8,"column",8),f(9,ot,2,1,"ng-template",null,3,P),d(),m(11,"column",9),f(12,nt,2,1,"ng-template",null,4,P),d(),f(14,rt,3,1,"column",10),c(15,"column",11),d()()),t&2){let o=x(3),p=x(7),_=x(10),w=x(13);l("items",e.items)("form",e.form)("selectable",!1)("minHeight",e.minHeight)("add",e.addObjetivo.bind(e))("remove",e.removeObjetivo.bind(e))("hasDelete",!1)("hasEdit",!1)("hasAdd",!e.disabled)("join",e.join)("groupBy",e.groupBy)("orderBy",e.orderBy)("groupTemplate",o),s(5),l("template",p),s(3),l("template",_),s(3),l("template",w),s(3),l("ngIf",e.planejamento_superior_id==null?null:e.planejamento_superior_id.length),s(),l("dynamicButtons",e.dynamicButtons.bind(e))("options",e.options)}},dependencies:[A,D,$,H,je]});let n=a;return n})();var st=["planejamentoInstitucional"],xe=()=>["objetivo"],$e=(n,a)=>({objetivo:n,pai:a});function mt(n,a){if(n&1&&c(0,"planejamento-show",10),n&2){let r=u();l("planejamento",r.planejamento)}}function dt(n,a){if(n&1&&he(0,36),n&2){let r=a.$implicit,i=u().$implicit,t=x(10);l("ngTemplateOutlet",t)("ngTemplateOutletContext",be(2,$e,r,i))}}function pt(n,a){if(n&1&&he(0,36),n&2){let r=a.$implicit,i=u().objetivo;u();let t=x(10);l("ngTemplateOutlet",t)("ngTemplateOutletContext",be(2,$e,r,i))}}function ct(n,a){if(n&1){let r=I();m(0,"div",37),g("dndEnd",function(t){v(r);let e=u(3);return h(e.onObjetivoDragEnd(t))})("dndMoved",function(){let t=v(r),e=t.objetivo,o=t.pai,p=u(3);return h(p.onObjetivoDragged(e,o,"move"))})("dndStart",function(t){v(r);let e=u(3);return h(e.onObjetivoDragStart(t))}),m(1,"div",38)(2,"div",39),O(3),d(),c(4,"action-button",40),d(),m(5,"div",29),g("dndDrop",function(t){let e=v(r).objetivo,o=u(3);return h(o.onObjetivoDrop(t,e))}),m(6,"div",30),c(7,"span",31),d(),f(8,pt,1,5,"ng-container",32),d()()}if(n&2){let r=a.objetivo,i=u(3);l("dndDisableIf",!i.canEdit)("dndDraggable",r),s(3),S(r.nome),s(),l("button",i.subObjetivosMenu)("data",r),s(),l("dndDropzone",ie(7,xe)),s(3),l("ngForOf",r.objetivos)}}function ut(n,a){if(n&1){let r=I();m(0,"div",26),g("dndEnd",function(t){v(r);let e=u(2);return h(e.onObjetivoDragEnd(t))})("dndMoved",function(){let t=v(r).$implicit,e=u().$implicit,o=u();return h(o.onObjetivoDragged(t,e,"move"))})("dndStart",function(t){v(r);let e=u(2);return h(e.onObjetivoDragStart(t))}),m(1,"div",17)(2,"div",27)(3,"div",28),O(4),d(),m(5,"div",29),g("dndDrop",function(t){let e=v(r).$implicit,o=u(2);return h(o.onObjetivoDrop(t,e))}),m(6,"div",30),c(7,"span",31),d(),f(8,dt,1,5,"ng-container",32),d()(),f(9,ct,9,8,"ng-template",null,1,P),m(11,"div",23),c(12,"action-button",33)(13,"action-button",34)(14,"action-button",35),d()()()}if(n&2){let r=a.$implicit,i=u(2);l("dndDisableIf",!i.canEdit)("dndDraggable",r),s(4),S(r.nome),s(),l("dndDropzone",ie(11,xe)),s(3),l("ngForOf",r.objetivos),s(4),l("data",r)("onClick",i.onObjetivoClick.bind(i)),s(),l("data",r)("onClick",i.onObjetivoEditClick.bind(i)),s(),l("data",r)("onClick",i.onObjetivoDeleteClick.bind(i))}}function _t(n,a){if(n&1){let r=I();m(0,"div",11),c(1,"action-button",12),m(2,"div",13)(3,"div",14)(4,"h4"),O(5),d()(),m(6,"div",15),g("dndDrop",function(t){let e=v(r).$implicit,o=u();return h(o.onObjetivoDrop(t,e))}),m(7,"div",16)(8,"div",17)(9,"p",18),c(10,"span",19)(11,"span",20)(12,"span",21)(13,"span",22),d(),m(14,"div",23),c(15,"action-button",24)(16,"action-button",24)(17,"action-button",24),d()()(),f(18,ut,15,12,"div",25),d()()()}if(n&2){let r=a.$implicit,i=u();te("background-color",r.eixo.cor),s(),l("data",r)("onClick",i.onObjetivoAddClick.bind(i)),s(4),S(r.eixo.nome),s(),l("dndDropzone",ie(7,xe)),s(12),l("ngForOf",r.objetivos)}}var Xe=(()=>{let a=class a extends J{constructor(i){super(i),this.injector=i,this.canEdit=!0,this.planejamentos=[],this.eixos=[],this.objetivos=[],this.subObjetivosMenu={icon:"bi bi-three-dots-vertical",color:"transparent-black p-1 py-0",items:[{icon:"bi bi-file-earmark-bar-graph",label:"Entregas",onClick:this.onObjetivoClick.bind(this)},{icon:"bi bi-pencil-square",label:"Alterar",onClick:this.onObjetivoEditClick.bind(this)},{icon:"bi bi-trash",label:"Excluir",onClick:this.onObjetivoDeleteClick.bind(this)}]},this.validate=(t,e)=>null,this.dao=i.get(T),this.objetivoDao=i.get(R),this.join=["objetivos"],this.title=this.lex.translate("Objetivos")+" "+this.lex.translate("do Planejamento Institucional"),this.form=this.fh.FormBuilder({planejamento_id:{default:null},todos:{default:!1}},this.cdRef,this.validate)}ngAfterViewInit(){super.ngAfterViewInit(),this.loadData(this.entity)}loadData(i,t){return b(this,null,function*(){this.query=this.dao.query({where:[["data_arquivamento","==",null]],orderBy:[["data_inicio","desc"]]}),this.query.asPromise().then(e=>{this.planejamentos=e.map(o=>Object.assign({},{key:o.id,value:o.nome,data:o})),this.cdRef.detectChanges(),this.form.controls.planejamento_id.setValue(this.planejamentos.length?this.planejamentos[0].key:null)})})}objetivosPai(i){let t=[],e=o=>{for(let p of o)p.id!=i&&(t.push(p),e(this.objetivos.filter(_=>_.objetivo_pai_id==p.id).sort((_,w)=>_.sequencia-w.sequencia)))};return e(this.objetivos.filter(o=>!o.objetivo_pai_id).sort((o,p)=>o.sequencia-p.sequencia)),t}marcador(i){let t=i._metadata?.level||0;return t<1?"":t<2?"\u2022 ":t<3?"- ":"+ "}objetivosEixo(i){let t=this.planejamento?.objetivos?.filter(o=>o.eixo_tematico_id==i&&!o.objetivo_pai_id).sort((o,p)=>o.sequencia-p.sequencia)||[],e=(o,p)=>{for(let _ of o)_.objetivos=this.planejamento?.objetivos?.filter(w=>w.objetivo_pai_id==_.id).sort((w,Ze)=>w.sequencia-Ze.sequencia)||[],_._metadata=Object.assign(_._metadata||{},{level:p}),e(_.objetivos,p+1)};return e(t,0),t}onPlanejamentoChange(){this.planejamentoInstitucional.selectedItem&&this.dao.getById(this.planejamentoInstitucional.selectedItem?.key,this.join).then(i=>{this.planejamento=i,this.objetivos=this.planejamento.objetivos||[],this.eixos=this.query.extra?.eixos?.filter(t=>this.form?.controls.todos.value||this.planejamento?.objetivos?.find(e=>e.eixo_tematico_id==t.id)).map(t=>Object.assign({},{eixo:t,eixo_tematico_id:t.id,objetivos:this.objetivosEixo(t.id)}))||[],this.cdRef.detectChanges()})}onTodosChange(){this.onPlanejamentoChange()}onObjetivoClick(i){let t=i;this.go.navigate({route:["gestao","plano-entrega","entrega","objetivos",t.id]})}onObjetivoAddClick(i){let t=this.eixos.find(o=>o.eixo.id==i.id),e=new q({_status:"ADD",id:this.dao.generateUuid(),planejamento_id:this.planejamento?.id,eixo_tematico_id:i.eixo.id,eixo_tematico:i.eixo,sequencia:t?.objetivos.length?t?.objetivos[0].sequencia:0});this.go.navigate({route:["gestao","planejamento","objetivo"]},{metadata:{planejamento:this.planejamento,objetivo:e,objetivos:this.objetivosPai(e.id)},modalClose:o=>b(this,null,function*(){o&&this.objetivoDao.save(o).then(p=>this.onPlanejamentoChange())})})}onObjetivoDeleteClick(i){let t=i;this.dialog.confirm("Exclui ?","Deseja realmente excluir?").then(e=>{e&&this.objetivoDao.delete(t).then(o=>this.onPlanejamentoChange())})}onObjetivoEditClick(i){let t=i;this.go.navigate({route:["gestao","planejamento","objetivo"]},{metadata:{planejamento:this.planejamento,objetivo:t},modalClose:e=>b(this,null,function*(){e&&this.objetivoDao?.save(e).then(o=>this.onPlanejamentoChange())})})}onObjetivoDrop(i,t){console.log("Drop",i),t.objetivos=t.objetivos||[];let e=i.data,o=typeof i.index>"u"?t.objetivos.length:i.index,p=o&&(t.objetivos[o]||t.objetivos[o-1])||void 0;t.objetivos.splice(o,0,e),this.loading=!0,this.objetivoDao?.update(e.id,{eixo_tematico_id:t.eixo_tematico_id,objetivo_pai_id:t.id||null,sequencia:p?.sequencia||0}).then(_=>this.onPlanejamentoChange()).finally(()=>this.loading=!1)}onObjetivoDragEnd(i){console.log("DragEnd",i)}onObjetivoDragged(i,t,e){console.log("Dragged",i,t.objetivos),t.objetivos=t.objetivos||[],t.objetivos.splice(t.objetivos.indexOf(i),1)}onObjetivoDragStart(i){console.log("DragStart",i)}};a.\u0275fac=function(t){return new(t||a)(N(V))},a.\u0275cmp=M({type:a,selectors:[["planejamento-mapa"]],viewQuery:function(t,e){if(t&1&&(j(E,5),j(st,5)),t&2){let o;C(o=y())&&(e.editableForm=o.first),C(o=y())&&(e.planejamentoInstitucional=o.first)}},features:[F],decls:10,vars:8,consts:[["planejamentoInstitucional",""],["subobjetivos",""],["noButtons","",3,"form"],[1,"row","mt-2"],["controlName","planejamento_id",3,"change","size","control","items"],["transparent","","collapse","","title","Miss\xE3o, vis\xE3o, resultados e valores"],[3,"planejamento",4,"ngIf"],[1,"row","my-2"],["labelPosition","left","label","Todos os eixos","controlName","todos",3,"change","size","control"],["class","eixo",3,"background-color",4,"ngFor","ngForOf"],[3,"planejamento"],[1,"eixo"],["icon","bi bi-plus-circle","color","transparent-black",3,"data","onClick"],[1,"d-flex","align-items-center","align-content-stretch","p-3"],[1,"descricao"],[1,"objetivos","w-100","row",3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"col-md-4"],[1,"objetivo","shadow-sm","d-flex","flex-column","align-content-between"],[1,"placeholder-glow"],[1,"placeholder","col-2"],[1,"placeholder","col-3"],[1,"placeholder","col-1"],[1,"placeholder","col-6"],[1,"buttons","w-100","d-flex","justify-content-end","px-1"],["placeholder","","icon","bi bi-question","color","transparent-black p-0"],["class","col-md-4","dndType","objetivo","dndEffectAllowed","move",3,"dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],["dndType","objetivo","dndEffectAllowed","move",1,"col-md-4",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[1,"m-2"],["dndHandle","",1,"card-text","text-break","w-100"],[1,"subobjetivo",3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"border","mt-3","p-2"],[1,"placeholder","w-75"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngFor","ngForOf"],["icon","bi bi-file-earmark-bar-graph","color","transparent-black px-1",3,"data","onClick"],["icon","bi bi-pencil-square","color","transparent-black px-1",3,"data","onClick"],["icon","bi bi-trash","color","transparent-black px-1",3,"data","onClick"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["dndType","objetivo","dndEffectAllowed","move",1,"border","mt-3","p-2",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[1,"d-flex","justify-content-between"],[1,"me-2","card-text","text-break","w-100"],["noArrow","",3,"button","data"]],template:function(t,e){if(t&1){let o=I();m(0,"editable-form",2)(1,"div",3)(2,"input-select",4,0),g("change",function(){return v(o),h(e.onPlanejamentoChange())}),d()(),m(4,"separator",5),f(5,mt,1,1,"planejamento-show",6),d(),m(6,"div",7)(7,"input-switch",8),g("change",function(){return v(o),h(e.onTodosChange())}),d()(),f(8,_t,19,8,"div",9),c(9,"div",7),d()}t&2&&(l("form",e.form),s(2),l("size",12)("control",e.form.controls.planejamento_id)("items",e.planejamentos),s(3),l("ngIf",e.planejamento),s(2),l("size",12)("control",e.form.controls.todos),s(),l("ngForOf",e.eixos))},dependencies:[we,A,Ee,E,W,U,pe,Me,Ve,Fe,ke,Ne,ze],styles:[".blockquote[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.8rem;margin:0}.eixo[_ngcontent-%COMP%]   .descricao[_ngcontent-%COMP%]{width:250px}.eixo[_ngcontent-%COMP%]   .descricao[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{writing-mode:vertical-rl;text-orientation:mixed;-webkit-transform:scaleX(-1) scaleY(-1);transform:scaleX(-1) scaleY(-1);white-space:normal;height:min-content;text-align:center}.eixo[_ngcontent-%COMP%]   .descricao[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{position:absolute}.eixo[_ngcontent-%COMP%]   .w-25[_ngcontent-%COMP%]{margin-bottom:10px}.eixo[_ngcontent-%COMP%]   .objetivos[_ngcontent-%COMP%]{min-height:100px}.eixo[_ngcontent-%COMP%]   .objetivo[_ngcontent-%COMP%]{background:#fff;margin:0 10px}.eixo[_ngcontent-%COMP%]   .subobjetivo[_ngcontent-%COMP%]{min-height:50px}.eixo[_ngcontent-%COMP%]   .objetivo[_ngcontent-%COMP%]   .card-text[_ngcontent-%COMP%]{font-size:.8rem;cursor:grab}.eixo[_ngcontent-%COMP%]   .objetivo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{padding:10px;color:#5e5b5b;font-size:.8rem;margin:0}.eixo[_ngcontent-%COMP%]   .objetivo[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{border-top:1px solid #ddd}.eixo[_ngcontent-%COMP%]   .objetivo[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{cursor:pointer;padding:5px}.eixo[_ngcontent-%COMP%]   .objetivo[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#ddd}.detalhe_entrega[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.8rem}.dndDraggingSource[_ngcontent-%COMP%]{display:none}.acao-planos[_ngcontent-%COMP%]   .dropdown-toggle[_ngcontent-%COMP%]:after{display:none}"]});let n=a;return n})();var yt=["unidade"];function xt(n,a){n&1&&c(0,"toolbar")}function Pt(n,a){if(n&1&&(m(0,"span",30),c(1,"i",31),O(2),d()),n&2){let r=u().row;s(2),Y(" ",r.objetivos==null?null:r.objetivos.length,"")}}function Ot(n,a){if(n&1&&f(0,Pt,3,1,"span",29),n&2){let r=a.row;l("ngIf",r.objetivos==null?null:r.objetivos.length)}}function wt(n,a){if(n&1&&c(0,"planejamento-list-objetivo",32),n&2){let r=a.row;l("entity",r)}}function Et(n,a){if(n&1&&(m(0,"column",28),f(1,Ot,1,1,"ng-template",null,7,P)(3,wt,1,1,"ng-template",null,8,P),d()),n&2){let r=x(2),i=x(4),t=u(2);l("align","center")("hint",t.lex.translate("Objetivo"))("template",r)("expandTemplate",i)}}function It(n,a){if(n&1&&(m(0,"span",33),O(1),d()),n&2){let r=a.row;s(),S(r.nome)}}function St(n,a){if(n&1&&(m(0,"span"),O(1),d()),n&2){let r=a.row,i=u(2);s(),Y(" ",i.dao.getDateFormatted(r.data_inicio),"")}}function Dt(n,a){if(n&1&&(m(0,"span"),O(1),d()),n&2){let r=a.row,i=u(2);s(),Y(" ",i.dao.getDateFormatted(r.data_fim),"")}}function Tt(n,a){if(n&1&&(m(0,"span"),O(1),d()),n&2){let r=a.row;s(),Y(" ",(r.unidade==null?null:r.unidade.nome)||"","")}}function Mt(n,a){if(n&1){let r=I();m(0,"grid",12),g("select",function(t){v(r);let e=u();return h(e.onSelect(t))}),f(1,xt,1,0,"toolbar",13),m(2,"filter",14)(3,"div",15),c(4,"input-text",16),d(),m(5,"div",15)(6,"input-switch",17),g("change",function(t){v(r);let e=u();return h(e.onSoEntidadeChange(t))}),d(),c(7,"input-search",18,2)(9,"input-datetime",19)(10,"input-datetime",20),d()(),m(11,"columns"),f(12,Et,5,4,"column",21),m(13,"column",22),f(14,It,2,1,"ng-template",null,3,P),d(),m(16,"column",23),f(17,St,2,1,"ng-template",null,4,P),d(),m(19,"column",24),f(20,Dt,2,1,"ng-template",null,5,P),d(),m(22,"column",25),f(23,Tt,2,1,"ng-template",null,6,P),d(),c(25,"column",26),d(),c(26,"pagination",27),d()}if(n&2){let r=x(15),i=x(18),t=x(21),e=x(24),o=u();l("dao",o.dao)("add",o.add)("orderBy",o.orderBy)("join",o.join)("init",o.initGrid.bind(o))("selectable",o.selectable)("hasAdd",o.auth.hasPermissionTo("MOD_PLAN_INST_INCL"))("hasEdit",o.auth.hasPermissionTo("MOD_PLAN_INST_EDT")),s(),l("ngIf",!o.selectable),s(),l("deleted",o.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",o.filter)("where",o.filterWhere)("submit",o.filterSubmit.bind(o))("clear",o.filterClear.bind(o))("collapseChange",o.filterCollapseChange.bind(o))("collapsed",!o.selectable&&o.filterCollapsed),s(2),l("size",12)("label",o.lex.translate("Planejamento Institucional"))("control",o.filter.controls.nome)("placeholder","Nome "+o.lex.translate("Planejamento Institucional")+"..."),k("maxlength",250),s(2),l("size",2)("label","S\xF3 da "+o.lex.translate("Entidade"))("control",o.filter.controls.so_entidade),s(),l("size",4)("label",o.lex.translate("Unidade"))("disabled",o.unidade_disabled)("control",o.filter.controls.unidade_id)("dao",o.unidadeDao),s(2),l("size",3)("control",o.filter.controls.data_inicio)("labelInfo","Data de in\xEDcio do"+o.lex.translate("Planejamento Institucional")),s(),l("size",3)("control",o.filter.controls.data_fim)("labelInfo","Data do fim do "+o.lex.translate("Planejamento Institucional")),s(2),l("ngIf",!o.selectable),s(),l("template",r),s(3),l("template",i),s(3),l("template",t),s(3),l("template",e),s(3),l("onEdit",o.edit)("options",o.options),s(),l("rows",o.rowsLimit)}}function Vt(n,a){n&1&&c(0,"planejamento-mapa")}var Ke=(()=>{let a=class a extends ce{constructor(i){super(i,z,T),this.injector=i,this.filterWhere=t=>{let e=[],o=t.value;return o.so_entidade?(t.controls.unidade_id.setValue(null),e.push(["unidade_id","==",null])):o.unidade_id&&e.push(["unidade_id","==",o.unidade_id]),o.nome?.length&&e.push(["nome","like","%"+o.nome.trim().replace(" ","%")+"%"]),o.data_inicio&&e.push(["data_inicio",">=",o.data_inicio]),o.data_fim&&e.push(["data_fim","<=",o.data_fim]),e},this.unidadeDao=i.get(oe),this.code="MOD_PLAN_INST",this.title=this.lex.translate("Planejamentos Institucionais"),this.filter=this.fh.FormBuilder({data_inicio:{default:null},data_fim:{default:null},nome:{default:""},unidade_id:{default:null},so_entidade:{default:!1},agrupar:{default:!0}}),this.join=["unidade:id,nome,sigla","objetivos","objetivos.eixo_tematico:id,nome","objetivos.objetivo_superior:id,nome","planejamento_superior:id,nome","planejamento_superior.objetivos"],this.auth.hasPermissionTo("MOD_PLAN_INST")&&this.options.push({icon:"bi bi-info-circle",label:"Informa\xE7\xF5es",onClick:this.consult.bind(this)}),this.auth.hasPermissionTo("MOD_PLAN_INST_EXCL")&&this.options.push({icon:"bi bi-trash",label:"Excluir",onClick:this.delete.bind(this)}),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG"),this.addOption({label:"Relat\xF3rio",icon:"bi bi-file-pdf",onClick:t=>this.report(t,"PLAN_INSTITUCIONAL")})}ngAfterViewInit(){super.ngAfterViewInit(),this.tabs.active=["TABELA","MAPA","OKR"].includes(this.usuarioConfig.active_tab)?this.usuarioConfig.active_tab:"TABELA"}onLoad(){}report(i,t){let e={id:i.id,join:["objetivos","objetivos.objetivos_filhos"]};this.grid?.buildRowReport(t,e)}initGrid(i){i.queryInit()}onSelectTab(i){return b(this,null,function*(){this.viewInit&&this.saveUsuarioConfig({active_tab:i.key})})}filterClear(i){i.controls.nome.setValue(""),i.controls.data_inicio.setValue(null),i.controls.data_fim.setValue(null),i.controls.unidade_id.setValue(null),i.controls.so_entidade.setValue(!1),super.filterClear(i)}onSoEntidadeChange(i){this.filter.controls.so_entidade.value?(this.filter.controls.unidade_id.setValue(null),this.unidade_disabled="disabled"):(this.filter.controls.unidade_id.setValue(void 0),this.unidade_disabled=void 0)}};a.\u0275fac=function(t){return new(t||a)(N(V))},a.\u0275cmp=M({type:a,selectors:[["app-planejamento-list"]],viewQuery:function(t,e){if(t&1&&(j(D,5),j(K,5),j(yt,5)),t&2){let o;C(o=y())&&(e.grid=o.first),C(o=y())&&(e.tabs=o.first),C(o=y())&&(e.unidade=o.first)}},features:[F],decls:7,vars:4,consts:[["lista",""],["mapa",""],["unidade",""],["columnNome",""],["columnInicio",""],["columnFim",""],["columnUnidade",""],["columnObjetivos",""],["columnExpandedObjetivos",""],["right","",3,"title","select"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template"],[3,"select","dao","add","orderBy","join","init","selectable","hasAdd","hasEdit"],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["controlName","nome",3,"size","label","control","placeholder"],["controlName","so_entidade",3,"change","size","label","control"],["controlName","unidade_id",3,"size","label","disabled","control","dao"],["date","","label","In\xEDcio","controlName","data_inicio",3,"size","control","labelInfo"],["date","","label","Fim","controlName","data_fim",3,"size","control","labelInfo"],["type","expand","icon","bi bi-bullseye",3,"align","hint","template","expandTemplate",4,"ngIf"],["title","Nome","orderBy","nome",3,"template"],["title","In\xEDcio",3,"template"],["title","Fim",3,"template"],["title","Unidade",3,"template"],["type","options",3,"onEdit","options"],[3,"rows"],["type","expand","icon","bi bi-bullseye",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-bullseye"],[3,"entity"],[1,"text-break","w-100"]],template:function(t,e){if(t&1&&(m(0,"tabs",9)(1,"tab",10),f(2,Mt,27,43,"ng-template",null,0,P),d(),m(4,"tab",11),f(5,Vt,1,0,"ng-template",null,1,P),d()()),t&2){let o=x(3),p=x(6);l("title",e.isModal?"":e.title)("select",e.onSelectTab.bind(e)),s(),l("template",o),s(3),l("template",p)}},dependencies:[A,D,$,H,re,ae,le,W,X,B,se,K,ue,fe,Xe]});let n=a;return n})();var Ft=["planejamentoSuperior"],kt=["objetivos"],ve=(()=>{let a=class a extends de{constructor(i){super(i,z,T),this.injector=i,this.planejamentosSuperiores=[],this.hasPermissionToUNEX=!1,this.joinPlanejamentoSuperior=[],this.validate=(t,e)=>{let o=null;return["nome","unidade_id","missao","visao"].indexOf(e)>=0&&!t.value?.length&&(o="Obrigat\xF3rio"),e=="data_inicio"&&!this.dao?.validDateTime(t.value)&&(o="Inv\xE1lido"),e=="data_fim"&&t.value&&!this.dao?.validDateTime(t.value)&&(o="Inv\xE1lido"),o},this.formValidation=t=>b(this,null,function*(){let e;return this.form.controls.data_fim.value&&this.form.controls.data_inicio.value>this.form.controls.data_fim.value?"A data do in\xEDcio n\xE3o pode ser maior que a data do fim! [RN_PLAN_INST_A]":this.form.controls.valores.value.length==0?"\xC9 obrigat\xF3ria a inclus\xE3o de ao menos um valor institucional! [RN_PLAN_INST_A]":(((yield this.dao?.query({where:[["unidade_id","==",this.form.controls.unidade_id.value]]}).asPromise())||[]).forEach(p=>{p.id!=this.entity.id&&this.util.intersection([{start:this.util.asDate(p.data_inicio),end:this.util.asDate(p.data_fim)},{start:this.util.asDate(this.form.controls.data_inicio.value),end:this.util.asDate(this.form.controls.data_fim.value)}])&&(e="Sobreposi\xE7\xE3o de planejamento para o per\xEDodo de datas selecionadas [RN_PLAN_INST_B]")}),e)}),this.titleEdit=t=>"Editando "+this.lex.translate("Planejamento Institucional")+": "+(t?.nome||""),this.unidadeDao=i.get(oe),this.hasPermissionToUNEX=this.auth.hasPermissionTo("MOD_PLAN_INST_INCL_UNEX_LOTPRI")||this.auth.hasPermissionTo("MOD_PLAN_INST_INCL_UNEX_QQLOT")||this.auth.hasPermissionTo("MOD_PLAN_INST_INCL_UNEX_SUBORD")||this.auth.hasPermissionTo("MOD_PLAN_INST_INCL_UNEX_QUALQUER"),this.join=["objetivos","objetivos.objetivo_pai:id,nome","objetivos.objetivo_superior:id,planejamento_id","objetivos.eixo_tematico:id,nome","planejamento_superior:id,nome","planejamento_superior.objetivos"],this.joinPlanejamentoSuperior=["objetivos"],this.form=this.fh.FormBuilder({nome:{default:""},unidade_id:{default:null},entidade_id:{default:null},planejamento_superior_id:{default:null},data_inicio:{default:new Date},data_fim:{default:null},missao:{default:""},visao:{default:""},valores:{default:[]},valor_texto:{default:""},resultados_institucionais:{default:[]},resultados_texto:{default:""},utilizar_superior:{default:!1}},this.cdRef,this.validate),this.util=i.get(De)}loadData(i,t){return b(this,null,function*(){let e=Object.assign({},t.value);yield this.carregaPlanejamentosSuperiores(i.unidade_id),t.patchValue(this.util.fillForm(e,i)),this.form.controls.planejamento_superior_id.setValue(i.planejamento_superior_id)})}initializeData(i){this.entity=new z,this.loadData(this.entity,i)}saveData(i){return b(this,null,function*(){return new Promise((t,e)=>{this.objetivos.grid.confirm();let o=this.util.fill(new z,this.entity);o=this.util.fillForm(o,this.form.value),o.objetivos=this.objetivos.items,t(o)})})}addValorHandle(){let i,t=this.form.controls.valor_texto.value,e=this.util.textHash(t);return t?.length&&this.util.validateLookupItem(this.form.controls.valores.value,e)&&(i={key:e,value:this.form.controls.valor_texto.value},this.form.controls.valor_texto.setValue("")),i}addResultadoHandle(){let i,t=this.form.controls.resultados_texto.value,e=this.util.textHash(t);return t?.length&&this.util.validateLookupItem(this.form.controls.resultados_institucionais.value,e)&&(i={key:e,value:this.form.controls.resultados_texto.value},this.form.controls.resultados_texto.setValue("")),i}onUnidadeChange(i){return b(this,null,function*(){this.entity.unidade_id!=this.form.controls.unidade_id.value&&(yield this.carregaPlanejamentosSuperiores(this.form.controls.unidade_id.value))})}carregaPlanejamentosSuperiores(i){return b(this,null,function*(){if(i?.length){let t=yield this.dao?.query({where:[["unidade_id","==",i],["manut_planej_unidades_executoras","==",!0]],join:this.joinPlanejamentoSuperior}).asPromise();this.planejamentosSuperiores=(t||[]).map(e=>Object.assign({},{key:e.id,value:e.nome,data:e})),this.planejamentosSuperiores.sort((e,o)=>e.value>o.value?1:-1),this.planejamentosSuperiores.unshift({key:null,value:"Escolha um Planejamento superior..."}),this.objetivos.loadData(this.entity,this.form),this.cdRef.detectChanges()}})}onUtilizarSuperiorChange(i){return b(this,null,function*(){let t=this.form.controls.planejamento_superior_id.value;if(this.form.controls.utilizar_superior.value&&t?.length){let e=yield this.dao?.query({where:[["id","==",t]]}).asPromise();this.form.controls.missao.setValue(e[0].missao),this.form.controls.visao.setValue(e[0].visao),this.form.controls.valores.setValue(e[0].valores),this.form.controls.resultados_institucionais.setValue(e[0].resultados_institucionais)}})}onPlanejamentoChange(i){return b(this,null,function*(){this.form.controls.planejamento_superior_id.value!=this.entity?.planejamento_superior_id&&this.entity?.objetivos?.length&&this.entity?.objetivos.filter(t=>t.objetivo_superior&&t.objetivo_superior.planejamento_id==this.entity?.planejamento_superior_id).length&&((yield this.dialog.confirm("Altera\xE7\xE3o de Planejamento Superior","Como j\xE1 existe(m) objetivo(s) neste Planejamento, vinculado(s) a objetivo(s) do Planejamento Superior anterior, seus v\xEDnculos ser\xE3o perdidos! Deseja continuar?"))?this.entity?.objetivos?.forEach(e=>e.objetivo_superior_id=null):this.form.controls.planejamento_superior_id.setValue(this.entity?.planejamento_superior_id)),this.entity.planejamento_superior_id=this.form.controls.planejamento_superior_id.value,this.entity.planejamento_superior=this.planejamentoSuperior.selectedItem?.data,this.objetivos.planejamento_superior_id=this.form.controls.planejamento_superior_id.value,this.objetivos?.grid?.loadColumns(),this.cdRef.detectChanges()})}};a.\u0275fac=function(t){return new(t||a)(N(V))},a.\u0275cmp=M({type:a,selectors:[["app-planejamento-form"]],viewQuery:function(t,e){if(t&1&&(j(E,5),j(D,7),j(Ft,5),j(kt,5)),t&2){let o;C(o=y())&&(e.editableForm=o.first),C(o=y())&&(e.grid=o.first),C(o=y())&&(e.planejamentoSuperior=o.first),C(o=y())&&(e.objetivos=o.first)}},features:[F],decls:29,vars:39,consts:[["planejamentoSuperior",""],["objetivos",""],["initialFocus","nome",3,"submit","cancel","form","disabled","title"],["display","","right",""],["key","DADOS","label","Dados"],[1,"row"],["controlName","nome","required","",3,"size","label","icon","control"],["controlName","unidade_id","labelInfo","Unidade \xE0 qual se refere o planejamento","required","",3,"change","size","control","dao"],["date","","label","In\xEDcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","In\xEDcio do Planejamento Institucional","required","",3,"size","control"],["date","","label","Fim","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Fim do Planejamento Institucional","required","",3,"size","control"],["label","Planejamento Institucional Superior","controlName","planejamento_superior_id",3,"change","size","items","control","icon"],["scale","small","labelPosition","right","controlName","utilizar_superior","label","Utilizar miss\xE3o, vis\xE3o, resultados e valores da institui\xE7\xE3o superior?",3,"change","size"],[1,"col-md-6"],["label","Miss\xE3o","controlName","missao","required","",3,"size","rows","control"],["label","Vis\xE3o","controlName","visao","required","",3,"size","rows","control"],["controlName","resultados_institucionais",3,"size","label","addItemHandle"],["icon","far fa-edit","controlName","resultados_texto",3,"label","control"],["label","Valores","controlName","valores",3,"size","addItemHandle"],["label","Valor Institucional","icon","far fa-edit","controlName","valor_texto",3,"control"],["key","OBJETIVOS","label","Objetivos"],["noPersist","",3,"entity","disabled","planejamento_superior_id"]],template:function(t,e){if(t&1){let o=I();m(0,"editable-form",2),g("submit",function(){return v(o),h(e.onSaveData())})("cancel",function(){return v(o),h(e.onCancel())}),m(1,"tabs",3)(2,"tab",4)(3,"div",5)(4,"div",5),c(5,"input-text",6),d(),m(6,"div",5)(7,"input-search",7),g("change",function(_){return v(o),h(e.onUnidadeChange(_))}),d(),c(8,"input-datetime",8)(9,"input-datetime",9),d(),m(10,"div",5)(11,"input-select",10,0),g("change",function(_){return v(o),h(e.onPlanejamentoChange(_))}),d(),m(13,"input-switch",11),g("change",function(_){return v(o),h(e.onUtilizarSuperiorChange(_))}),d()(),m(14,"div",5)(15,"div",12),c(16,"input-textarea",13),d(),m(17,"div",12),c(18,"input-textarea",14),d()(),m(19,"div",5)(20,"div",12)(21,"input-multiselect",15),c(22,"input-text",16),d()(),m(23,"div",12)(24,"input-multiselect",17),c(25,"input-text",18),d()()()()(),m(26,"tab",19),c(27,"planejamento-list-objetivo",20,1),d()()()}t&2&&(l("form",e.form)("disabled",e.formDisabled)("title",e.isModal?"":e.title),s(5),l("size",12)("label","Nome do "+e.lex.translate("Planejamento Institucional"))("icon",e.entityService.getIcon("Planejamento"))("control",e.form.controls.nome),k("maxlength",250),s(2),l("size",6)("control",e.form.controls.unidade_id)("dao",e.unidadeDao),s(),l("size",3)("control",e.form.controls.data_inicio),s(),l("size",3)("control",e.form.controls.data_fim),s(2),l("size",12)("items",e.planejamentosSuperiores)("control",e.form.controls.planejamento_superior_id)("icon",e.entityService.getIcon("Planejamento")),s(2),l("size",12),s(3),l("size",12)("rows",3)("control",e.form.controls.missao),s(2),l("size",12)("rows",3)("control",e.form.controls.visao),s(3),l("size",12)("label",e.lex.translate("Resultados Institucionais"))("addItemHandle",e.addResultadoHandle.bind(e)),s(),l("label",e.lex.translate("Resultados Institucionais"))("control",e.form.controls.resultados_texto),k("maxlength",250),s(2),l("size",12)("addItemHandle",e.addValorHandle.bind(e)),s(),l("control",e.form.controls.valor_texto),k("maxlength",250),s(2),l("entity",e.entity)("disabled",e.action=="consult")("planejamento_superior_id",e.form.controls.planejamento_superior_id.value))},dependencies:[E,W,X,B,me,se,U,Te,K,ue,fe]});let n=a;return n})();var At=["planejamentoSuperiorNome"],Rt=["eixoTematico"];function Lt(n,a){if(n&1){let r=I();m(0,"separator",9)(1,"div",3),c(2,"input-text",10),m(3,"input-select",11),g("change",function(t){v(r);let e=u();return h(e.onObjetivoSuperiorChange(t))}),d()()()}if(n&2){let r=u();l("margin",2),s(2),l("size",6)("icon",r.entityService.getIcon("Planejamento")),k("maxlength",250),s(),l("items",r.objetivos_superiores)("size",6)("control",r.form.controls.objetivo_superior_id)}}var Oe=(()=>{let a=class a extends de{constructor(i){super(i,q,R),this.injector=i,this.objetivos=[],this.objetivos_superiores=[],this.validate=(t,e)=>{let o=null;return["nome","fundamentacao"].indexOf(e)>=0&&!t.value?.length&&(o="Obrigat\xF3rio"),["eixo_tematico_id"].indexOf(e)>=0&&!t.value?.length&&(o="Obrigat\xF3rio"),o},this.formValidation=t=>null,this.planejamentoDao=i.get(T),this.eixoTematicoDao=i.get(ne),this.form=this.fh.FormBuilder({nome:{default:""},fundamentacao:{default:""},planejamento_id:{default:null},planejamento_superior_nome:{default:""},eixo_tematico_id:{default:null},objetivo_superior_id:{default:null},objetivo_pai_id:{default:null},integra_okr:{default:!0}},this.cdRef,this.validate)}loadData(i,t){return b(this,null,function*(){let e=Object.assign({},t.value);t.patchValue(this.util.fillForm(e,i)),yield this.eixoTematico?.loadSearch(i.eixo_tematico||i.eixo_tematico_id),this.title=i._status=="ADD"?"Inclus\xE3o de Objetivo":"Editando objetivo...",this.planejamento=this.metadata?.planejamento,this.metadata?.planejamento_superior&&(this.planejamento.planejamento_superior=this.metadata.planejamento_superior),this.form?.controls.planejamento_superior_nome.setValue(this.planejamento?.planejamento_superior?.nome||""),this.objetivos_superiores=this.planejamento?.planejamento_superior?.objetivos?.map(o=>Object.assign({},{key:o.id,value:o.nome,data:o}))||[]})}initializeData(i){return b(this,null,function*(){this.entity=this.metadata?.objetivo,this.objetivos=(this.metadata?.objetivos).map(t=>Object.assign({},{key:t.id,value:t.nome,data:t})),yield this.loadData(this.entity,i)})}saveData(i){return new Promise((t,e)=>b(this,null,function*(){let o=Object.assign({eixo_tematico:this.eixoTematico?.selectedItem?.entity},this.entity);t(new Se(this.util.fillForm(o,this.form.value)))}))}isPlanejamentoUNEX(){return this.planejamento?.unidade_id!=null}onObjetivoPaiChange(i){let t=this.form.controls.objetivo_pai_id.value,e=this.objetivos.find(o=>o.key===t)?.data.eixo_tematico_id;e&&this.form.controls.eixo_tematico_id.setValue(e),this.cdRef.detectChanges()}onObjetivoSuperiorChange(i){let t=this.objetivos_superiores.find(e=>e.key===this.form?.controls.objetivo_superior_id.value)?.data.eixo_tematico_id;this.form.controls.eixo_tematico_id.value||this.form.controls.eixo_tematico_id.setValue(t),this.cdRef.detectChanges()}};a.\u0275fac=function(t){return new(t||a)(N(V))},a.\u0275cmp=M({type:a,selectors:[["app-planejamento-form-objetivo"]],viewQuery:function(t,e){if(t&1&&(j(E,5),j(At,5),j(Rt,5)),t&2){let o;C(o=y())&&(e.editableForm=o.first),C(o=y())&&(e.planejamentoSuperiorNome=o.first),C(o=y())&&(e.eixoTematico=o.first)}},features:[F],decls:12,vars:16,consts:[["eixoTematico",""],["objetivoPai",""],["initialFocus","nome",3,"submit","cancel","form","disabled","title"],[1,"row"],["icon","bi bi-textarea-t","label","Nome","controlName","nome","required","",3,"size","rows","control"],["controlName","eixo_tematico_id","required","",3,"size","disabled","dao"],["label","Objetivo Pai","icon","fab fa-unity","controlName","objetivo_pai_id",3,"change","size","items"],["title","Vinculo com Planejamento Superior",3,"margin",4,"ngIf"],["icon","bi bi-textarea-t","label","Fundamenta\xE7\xE3o","controlName","fundamentacao","required","",3,"size","rows","control"],["title","Vinculo com Planejamento Superior",3,"margin"],["disabled","","label","Planejamento Superior vinculado","controlName","planejamento_superior_nome",3,"size","icon"],["label","Objetivo de Planejamento Superior (Vinculado)","icon","fab fa-unity","controlName","objetivo_superior_id",3,"change","items","size","control"]],template:function(t,e){if(t&1){let o=I();m(0,"editable-form",2),g("submit",function(){return v(o),h(e.onSaveData())})("cancel",function(){return v(o),h(e.onCancel())}),m(1,"div",3)(2,"div",3),c(3,"input-textarea",4),d(),m(4,"div",3),c(5,"input-search",5,0),m(7,"input-select",6,1),g("change",function(_){return v(o),h(e.onObjetivoPaiChange(_))}),d()(),f(9,Lt,4,7,"separator",7),m(10,"div",3),c(11,"input-textarea",8),d()()()}t&2&&(l("form",e.form)("disabled",e.formDisabled)("title",e.isModal?"":e.title),s(3),l("size",12)("rows",2)("control",e.form.controls.nome),k("maxlength",250),s(2),l("size",6)("disabled",!(e.form==null||e.form.controls==null||e.form.controls.objetivo_pai_id==null)&&e.form.controls.objetivo_pai_id.value?"true":void 0)("dao",e.eixoTematicoDao),s(2),l("size",6)("items",e.objetivos),s(2),l("ngIf",e.planejamento==null?null:e.planejamento.planejamento_superior_id),s(2),l("size",12)("rows",4)("control",e.form.controls.fundamentacao))},dependencies:[A,E,X,B,me,U,pe]});let n=a;return n})();function zt(n,a){if(n&1&&(m(0,"h3",11),O(1),d()),n&2){let r=u();s(),S(r.title)}}function qt(n,a){if(n&1&&c(0,"toolbar",12),n&2){let r=u();l("buttons",r.buttons)}}function Bt(n,a){if(n&1&&(m(0,"span",13),O(1),d()),n&2){let r=a.row,i=a.metadata,t=u();s(),S(t.getNome(i,r))}}var Ye=(()=>{let a=class a extends ce{constructor(i){super(i,q,R),this.injector=i,this.buttons=[],this.filterWhere=t=>{let e=t.value,o=[];return e.planejamento_id?.length&&o.push(["planejamento_id","==",e.planejamento_id]),e.nome?.length&&o.push(["nome","like","%"+e.nome.trim().replace(" ","%")+"%"]),o},this.join=["objetivos"],this.planejamentoDao=i.get(T),this.planejamentoObjetivoDao=i.get(R),this.title=this.lex.translate("Objetivos")+" "+this.lex.translate("do Planejamento Institucional"),this.filter=this.fh.FormBuilder({nome:{default:""},planejamento_id:{default:null}}),this.OPTION_INFORMACOES.onClick=t=>this.go.navigate({route:["gestao","planejamento","objetivo",t.id,"consult"]},{modal:!0}),this.addOption(this.OPTION_INFORMACOES)}filterClear(i){super.filterClear(i),this.filter?.controls.nome.setValue("")}getNome(i,t){if(!i.path){let e=t.objetivo_pai_id,o="";for(;e;){let p=this.grid?.items.find(_=>_.id==e);o=(p?.sequencia||"")+"."+o,e=p?.objetivo_pai_id||null}i.path=o+t.sequencia}return this.grid?.items.sort((e,o)=>{let p=(this.grid.getMetadata(e)?.path||"").split(".").map(w=>("000"+w).substr(-3)).join("."),_=(this.grid.getMetadata(o)?.path||"").split(".").map(w=>("000"+w).substr(-3)).join(".");return p<_?-1:p>_?1:0}),i.path.length>2?"- "+t.nome:i.path.length>4?"-- "+t.nome:t.nome}};a.\u0275fac=function(t){return new(t||a)(N(V))},a.\u0275cmp=M({type:a,selectors:[["planejamento-list-objetivos-entregas"]],viewQuery:function(t,e){if(t&1&&j(D,5),t&2){let o;C(o=y())&&(e.grid=o.first)}},features:[F],decls:13,vars:22,consts:[["columnNome",""],["class","my-2",4,"ngIf"],[3,"select","dao","add","orderBy","groupBy","join","selectable"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Nome","controlName","nome","placeholder","Nome",3,"size","control"],["title","Nome","orderBy","nome",3,"template"],["title","Fundamenta\xE7\xE3o","field","fundamentacao"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],[1,"d-block"]],template:function(t,e){if(t&1){let o=I();f(0,zt,2,1,"h3",1),m(1,"grid",2),g("select",function(_){return v(o),h(e.onSelect(_))}),f(2,qt,1,1,"toolbar",3),m(3,"filter",4)(4,"div",5),c(5,"input-text",6),d()(),m(6,"columns")(7,"column",7),f(8,Bt,2,1,"ng-template",null,0,P),d(),c(10,"column",8)(11,"column",9),d(),c(12,"pagination",10),d()}if(t&2){let o=x(9);l("ngIf",!e.isModal),s(),l("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable),s(),l("ngIf",!e.selectable),s(),l("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),s(2),l("size",12)("control",e.filter.controls.nome),k("maxlength",250),s(2),l("template",o),s(4),l("onEdit",e.edit)("options",e.options),s(),l("rows",e.rowsLimit)}},dependencies:[A,D,$,H,re,ae,le,B]});let n=a;return n})();var Qt=[{path:"",component:Ke,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Planejamentos Institucionais"}},{path:"new",component:ve,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Inclus\xE3o de Planejamento Institucional",modal:!0}},{path:":id/edit",component:ve,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Edi\xE7\xE3o de Planejamento Institucional",modal:!0}},{path:":id/consult",component:ve,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Consulta a Planejamento Institucional",modal:!0}},{path:"objetivo",component:Oe,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Inclus\xE3o de Objetivo de Planejamento Institucional",modal:!0}},{path:"objetivoList",component:Ye,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Objetivos de Planejamento Institucional",modal:!0}},{path:"objetivo/:id/consult",component:Oe,canActivate:[L],resolve:{config:Q},runGuardsAndResolvers:"always",data:{title:"Consulta a Objetivo de Planejamento Institucional",modal:!0}}],Je=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=ee({type:a}),a.\u0275inj=Z({imports:[ge.forChild(Qt),ge]});let n=a;return n})();var So=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=ee({type:a}),a.\u0275inj=Z({imports:[Ie,Le,Ae,Je,Re,qe]});let n=a;return n})();export{So as a};
