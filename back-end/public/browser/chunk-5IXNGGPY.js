import{a as X}from"./chunk-BPXUIHBM.js";import{b as K}from"./chunk-IVBXO46K.js";import{b as J}from"./chunk-76VPKZU2.js";import{q as Z,s as j}from"./chunk-KODYKPWY.js";import{Fa as u,Ga as d,Gd as H,Ha as c,Ia as O,Ja as R,Jc as N,La as k,Ma as C,Na as p,Nc as B,Nd as $,Sc as U,U as L,Ua as T,Va as x,Wa as A,Xa as g,Ya as f,Z as E,Za as q,_ as y,_a as I,ba as z,fd as Q,h as v,jd as M,ma as s,na as G,od as W,pc as F,sb as h,va as P,xa as m,ya as D,za as l}from"./chunk-6YMI2QVU.js";var S=class extends J{constructor(n){super(n,H,$),this.injector=n,this.etiquetas=[],this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xE1rio"},this.DATAS_FILTRO=[{key:"DISTRIBUICAO",value:"Distribui\xE7\xE3o",icon:"bi bi-file-earmark-plus",color:"badge rounded-pill bg-warning text-dark"},{key:"PRAZO",value:"Prazo",icon:"bi bi-calendar-check",color:"badge rounded-pill bg-info text-dark"},{key:"CONCLUSAO",value:"Conclus\xE3o",icon:"bi bi-check-circle",color:"badge rounded-pill bg-info text-dark"}],this.unidadeDao=n.get(U),this.usuarioDao=n.get(B),this.planoTrabalhoDao=n.get(Q),this.tipoAtividadeDao=n.get(M),this.tipoProcessoDao=n.get(W),this.allPages=n.get(Z),this.atividadeService=n.get(X),this.calendar=n.get(N),this.comentario=n.get(K),this.join=["tipo_atividade","plano_trabalho_entrega.plano_entrega_entrega:id,descricao","demandante","pausas","usuario","unidade","comentarios.usuario:id,nome,apelido","tarefas.tipo_tarefa","tarefas.comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.extra={planos_trabalho:{},afastamentos:{}},this.optionsMetadata={refreshId:(t=>(this.grid?.query||this.query).refreshId(t)).bind(this),removeId:(t=>(this.grid?.query||this.query).removeId(t)).bind(this),refresh:this.refresh.bind(this)}}onGridLoad(n){n?.forEach(i=>{i.comentarios=this.comentario.orderComentarios(i.comentarios)});let t=(this.grid?.query||this.query).extra;if(t){this.extra.planos_trabalho=Object.assign(this.extra.planos_trabalho,t.planos||{});for(let[i,o]of Object.entries(t.afastamentos||{}))this.extra.afastamentos[i]=o.reduce((e,r)=>(e.find(_=>_.id==r.id)||e.push(r),e),this.extra.afastamentos[i]||[]);Object.entries(t.feriados||{}).forEach(([i,o])=>{this.calendar.feriadosCadastrados[i]||(this.calendar.feriadosCadastrados[i]=o)}),n?.forEach(i=>{i.planoTrabalho=t.planos_trabalho[i.plano_trabalho_id]}),this.cdRef.detectChanges()}}onAtribuidasParaMimChange(n){this.filter.controls.atribuidas_para_mim.value?this.filter.controls.usuario_id.setValue(this.auth.usuario.id):this.filter.controls.usuario_id.setValue(void 0)}onSomenteUnidadeAtualChange(n){this.filter.controls.somente_unidade_atual.value?this.filter.controls.unidade_id.setValue(this.auth.unidade.id):this.filter.controls.unidade_id.setValue(void 0)}onDespendidoClick(n){if(n.metadados&&!n.metadados.concluido){let t=this.extra?.planos_trabalho[n.plano_trabalho_id]?.carga_horaria||0,i=this.extra?.afastamentos[n.usuario_id]||[];this.efemerides=this.calendar.calculaDataTempoUnidade(n.data_inicio,this.auth.hora,t,n.unidade,"ENTREGA",n.pausas,i),this.dialog.template({title:"C\xE1lculos do tempo despendido"},this.calendarEfemerides,[])}}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:n=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,i)=>t.key==i.key),this.cdRef.detectChanges()}})}comentarioClick(n){let t=n.getAttribute("data-expanded");n.setAttribute("data-expanded",t=="true"?"false":"true")}addComentarioClick(n){this.go.navigate({route:["gestao","atividade",n.id,"comentar"]},{modal:!0,modalClose:t=>{t&&(this.grid?.query||this.query).refreshId(n.id)}})}};var ue=["calendarEfemerides"],ce=["unidade"],pe=["usuario"],me=["tipoAtividade"],_e=["etiqueta"],fe=["planoEntrega"],he=["planoEntregaEntrega"];function ge(a,n){if(a&1&&c(0,"calendar-efemerides",57),a&2){let t=p();l("efemerides",t.efemerides)}}function be(a,n){if(a&1&&(O(0),u(1,"label",60),f(2),u(3,"b"),f(4),d()(),R()),a&2){let t=n.$implicit;s(2),I("",t.label,": "),s(2),q(t.value)}}function ve(a,n){if(a&1&&(u(0,"div",58),m(1,be,5,2,"ng-container",59),d()),a&2){let t=n.group;s(),l("ngForOf",t)}}function Ee(a,n){if(a&1){let t=k();u(0,"toolbar")(1,"input-switch",61),C("change",function(o){E(t);let e=p();return y(e.onAgruparChange(o))}),d(),u(2,"input-switch",62),C("change",function(o){E(t);let e=p();return y(e.onAgruparChange(o))}),d()()}if(a&2){let t=p();s(),l("size",3)("control",t.filter.controls.agrupar_entrega),s(),l("size",3)("control",t.filter.controls.agrupar)}}function ye(a,n){if(a&1&&(u(0,"span",65),c(1,"i",66),f(2),d()),a&2){let t=p().row;s(2),I(" ",t.tarefas==null?null:t.tarefas.length,"")}}function Ce(a,n){if(a&1&&m(0,ye,3,1,"span",64),a&2){let t=n.row;l("ngIf",t.tarefas==null?null:t.tarefas.length)}}function Te(a,n){if(a&1&&c(0,"atividade-list-tarefa",67),a&2){let t=n.row,i=p(2);l("selectable",i.selectable)("editable",!t.metadados.concluido)("atividade",t)}}function xe(a,n){if(a&1&&(u(0,"column",63),m(1,Ce,1,1,"ng-template",null,21,h)(3,Te,1,3,"ng-template",null,22,h),d()),a&2){let t=g(2),i=g(4),o=p();l("align","center")("hint","Tarefas da "+o.lex.translate("atividade"))("template",t)("expandTemplate",i)}}function Ae(a,n){if(a&1&&(u(0,"order",68),f(1,"#ID"),d(),f(2),u(3,"order",69),f(4),d(),c(5,"br"),f(6," Descri\xE7\xE3o ")),a&2){let t=n.header,i=p();l("header",t),s(2),I("/Tipo de ",i.lex.translate("Atividade"),"/ "),s(),l("header",t),s(),q(i.lex.translate("Entrega"))}}function qe(a,n){if(a&1&&c(0,"badge",76),a&2){let t=p().row,i=p();l("icon",i.entityService.getIcon("TipoAtividade"))("label",t.tipo_atividade.nome)}}function ke(a,n){if(a&1){let t=k();u(0,"badge",77),C("click",function(){E(t);let o=p().row,e=p();return y(e.onEntregaClick(o))}),d()}if(a&2){let t=p().row,i=p();l("icon",i.entityService.getIcon("Entrega"))("label",t.plano_trabalho_entrega.descricao)}}function Ie(a,n){if(a&1&&(u(0,"span",70),c(1,"badge",71),m(2,qe,1,2,"badge",72)(3,ke,1,2,"badge",73),d(),u(4,"span",74),f(5),d(),c(6,"reaction",75)),a&2){let t=n.row,i=p();s(),l("label",t.numero)("data",t.numero)("click",i.atividadeService.onIdClick.bind(i)),s(),l("ngIf",t.tipo_atividade),s(),l("ngIf",t.plano_trabalho_entrega),s(2),q(t.descricao),s(),l("entity",t)}}function Se(a,n){if(a&1&&c(0,"input-textarea",78)(1,"input-search",79,23),a&2){let t=p();l("size",12)("rows",2)("control",t.formEdit.controls.descricao),s(),l("label","Tipo de "+t.lex.translate("atividade"))("size",12)("emptyValue",null)("control",t.formEdit.controls.tipo_atividade_id)("dao",t.tipoAtividadeDao)("labelInfo","Tipo de "+t.lex.translate("atividade")+" utilizado para classificar a "+t.lex.translate("atividade"))("required",t.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true")}}function we(a,n){if(a&1&&c(0,"badge",81),a&2){let t=n.$implicit,i=p(2);l("lookup",t)("click",i.onEtiquetaClick.bind(i))}}function De(a,n){if(a&1&&m(0,we,1,2,"badge",80),a&2){let t=n.row;l("ngForOf",t.etiquetas)}}function Ve(a,n){if(a&1){let t=k();u(0,"input-multiselect",82)(1,"input-select",83,24),C("details",function(){E(t);let o=p();return y(o.onEtiquetaConfigClick())}),d()()}if(a&2){let t=p();l("size",12)("control",t.formEdit.controls.etiquetas)("addItemHandle",t.addItemHandleEtiquetas.bind(t)),s(),l("size",12)("control",t.formEdit.controls.etiqueta)("items",t.etiquetas)}}function Le(a,n){a&1&&f(0," Plano de trabalho ")}function ze(a,n){if(a&1&&(u(0,"span",85),f(1),c(2,"br"),f(3),d()),a&2){let t=p().row,i=p();s(),I("",i.dao.getDateFormatted(t.planoTrabalho.data_inicio)," "),s(2),q(" at\xE9 "+i.dao.getDateFormatted(t.planoTrabalho.data_fim))}}function Ge(a,n){if(a&1&&m(0,ze,4,2,"span",84),a&2){let t=n.row;l("ngIf",t.planoTrabalho)}}function Pe(a,n){if(a&1&&(f(0," Un./"),u(1,"order",86),f(2),d(),c(3,"br"),u(4,"order",87),f(5,"Demandante"),d()),a&2){let t=n.header,i=p();s(),l("header",t),s(),q(i.lex.translate("Respons\xE1vel")),s(2),l("header",t)}}function Oe(a,n){if(a&1&&(u(0,"div",88),c(1,"badge",89)(2,"badge",90),d(),c(3,"badge",91)),a&2){let t=n.row,i=p();s(),l("label",t.unidade.sigla),s(),l("icon","bi "+(!(t.usuario==null||t.usuario.nome==null)&&t.usuario.nome.length?"bi-person-check":"bi-person-x"))("label",i.util.apelidoOuNome(t.usuario,!0)||"(N\xE3o atribu\xEDdo)")("hint","Respons\xE1vel: "+((t.usuario==null?null:t.usuario.nome)||"N\xE3o atribuido a nenhum usu\xE1rio")),s(),l("label",i.util.apelidoOuNome(t.demandante,!0)||"Desconhecido")("hint","Demandante: "+((t.demandante==null?null:t.demandante.nome)||"Desconhecido"))}}function Re(a,n){if(a&1&&(f(0," Tempos "),u(1,"order",92),f(2,"Distribui\xE7\xE3o"),d(),c(3,"br"),u(4,"order",93),f(5,"Prazo"),d(),u(6,"order",94),f(7,"Entrega"),d()),a&2){let t=n.header;s(),l("header",t),s(3),l("header",t),s(2),l("header",t)}}function Fe(a,n){if(a&1&&c(0,"badge",97),a&2){let t=n.$implicit;l("badge",t)}}function Ne(a,n){if(a&1&&(u(0,"div",95),m(1,Fe,1,1,"badge",96),d()),a&2){let t=n.row,i=p();s(),l("ngForOf",i.atividadeService.temposAtividade(t,i.extra,i.onDespendidoClick.bind(i)))}}function Be(a,n){a&1&&c(0,"separator",100)}function Ue(a,n){a&1&&c(0,"i",103)}function Qe(a,n){if(a&1&&(u(0,"tr")(1,"td"),m(2,Ue,1,0,"i",101),d(),u(3,"td",102),f(4),d()()),a&2){let t=n.$implicit;s(2),l("ngIf",t.checked),s(2),q(t.texto)}}function Me(a,n){if(a&1&&(u(0,"table"),m(1,Qe,5,2,"tr",59),d()),a&2){let t=p().row;s(),l("ngForOf",t.checklist)}}function We(a,n){if(a&1&&(c(0,"progress-bar",98),m(1,Be,1,0,"separator",99)(2,Me,2,1,"table",26)),a&2){let t=n.row;l("value",t.progresso),s(),l("ngIf",t.checklist==null?null:t.checklist.length),s(),l("ngIf",t.checklist==null?null:t.checklist.length)}}function He(a,n){a&1&&c(0,"separator",100)}function $e(a,n){if(a&1&&(u(0,"tr")(1,"td"),c(2,"input-switch",105),d(),u(3,"td",102),f(4),d()()),a&2){let t=n.$implicit,i=n.index,o=p(3);s(2),l("size",12)("source",o.checklist)("path",i+".checked"),s(2),q(t.texto)}}function Ze(a,n){if(a&1&&(u(0,"table"),m(1,$e,5,4,"tr",59),d()),a&2){let t=p(2);s(),l("ngForOf",t.checklist)}}function je(a,n){if(a&1&&(c(0,"input-number",104),m(1,He,1,0,"separator",99)(2,Ze,2,1,"table",26)),a&2){let t=n.row,i=p();l("size",12)("decimals",2)("control",i.formEdit.controls.progresso),s(),l("ngIf",t.checklist==null?null:t.checklist.length),s(),l("ngIf",t.checklist==null?null:t.checklist.length)}}function Je(a,n){if(a&1&&c(0,"badge",109),a&2){let t=n.$implicit,i=p(2);l("data",t)("color",t.color)("icon",t.icon)("label",t.label)("click",t.data!=null&&t.data.filter?i.onStatusClick.bind(i):void 0)}}function Ke(a,n){if(a&1&&(c(0,"documentos-badge",106),u(1,"span",85),m(2,Je,1,5,"badge",107),d(),c(3,"comentarios-widget",108)),a&2){let t=n.row,i=p();l("documento",t.documento_requisicao),s(2),l("ngForOf",i.atividadeService.getStatus(t)),s(),l("entity",t)("selectable",i.selectable)("grid",i.grid)}}function Xe(a,n){if(a&1&&c(0,"column",110),a&2){let t=p();l("metadata",t.optionsMetadata)("dynamicOptions",t.atividadeService.dynamicOptions.bind(t))("dynamicButtons",t.atividadeService.dynamicButtons.bind(t))("options",t.options)}}var ft=(()=>{let n=class n extends S{constructor(i){super(i),this.injector=i,this.minhas=!1,this.planosEntregas=[],this.planosEntregasEntregas=[],this.etiquetasAscendentes=[],this.storeFilter=o=>{let e=o?.value;return{atribuidas_para_mim:e.atribuidas_para_mim,usuario_id:e.usuario_id,plano_trabalho_id:e.plano_trabalho_id,somente_unidade_atual:e.somente_unidade_atual,unidades_subordinadas:e.unidades_subordinadas,unidade_id:e.somente_unidade_atual?null:e.unidade_id}},this.filterWhere=o=>{let e=this.fixedFilter||[],r=o.value;if(r.somente_unidade_atual&&r.unidade_id!=this.auth.unidade?.id&&(o.controls.unidade_id.setValue(this.auth.unidade?.id),r.unidade_id=this.auth.unidade?.id),r.atribuidas_para_mim&&r.usuario_id!=this.auth.usuario?.id&&(o.controls.usuario_id.setValue(this.auth.usuario?.id),r.usuario_id=this.auth.usuario.id),r.usuario_id&&r.usuario_id.length&&e.push(["usuario_id","==",r.usuario_id]),r.plano_trabalho_id?.length&&e.push(["plano_trabalho_id","==",r.plano_trabalho_id]),r.unidade_id?.length&&e.push(["unidade_id","==",r.unidade_id]),r.unidades_subordinadas&&e.push(["unidades_subordinadas","==",!0]),r.etiquetas?.length&&e.push(["etiquetas","in",r.etiquetas.map(_=>_.value)]),r.numero_processo?.length&&e.push(["numero_processo","==",r.numero_processo]),r.numero?.length&&e.push(["numero","==",r.numero]),r.status?.length&&!e.find(_=>_[0]=="status")&&(e.push(["status","==",r.status]),r.status=="ARQUIVADO"&&this.filter.controls.arquivadas.setValue(!0)),this.filter.controls.arquivadas.value||e.push(["data_arquivamento","==",null]),r.tipo_atividade_id?.length&&e.push(["tipo_atividade_id","==",r.tipo_atividade_id]),r.tipo_processo_id?.length&&e.push(["tipo_processo_id","==",r.tipo_processo_id]),r.plano_entrega_id?.length&&e.push(["plano_entrega_id","==",r.plano_entrega_id]),r.plano_entrega_entrega_id?.length&&e.push(["plano_entrega_entrega_id","==",r.plano_entrega_entrega_id]),r.data_filtro?.length){let _=r.data_filtro=="DISTRIBUICAO"?"data_distribuicao":r.data_filtro=="PRAZO"?"data_estipulada_entrega":"data_entrega";r.data_inicio&&e.push([_,">=",r.data_inicio]),r.data_fim&&e.push([_,"<=",r.data_fim])}return e},this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.modalWidth=1100,this.filter=this.fh.FormBuilder({agrupar:{default:!0},agrupar_entrega:{default:!0},atribuidas_para_mim:{default:this.minhas},usuario_id:{default:null},numero:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},plano_trabalho_id:{default:null},unidade_id:{default:null},numero_processo:{default:""},status:{default:null},etiquetas:{default:[]},arquivadas:{default:!1},tipo_atividade_id:{default:null},tipo_processo_id:{default:null},data_filtro:{default:null},data_inicio:{default:null},data_fim:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({descricao:{default:""},tipo_atividade_id:{default:null},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.groupBy=[{field:"unidade.sigla",label:"Unidade"},{field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"},{field:"plano_trabalho_entrega.descricao",label:"Descri\xE7\xE3o dos trabalhos"}],this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngAfterViewInit(){if(super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.fixedFilter){let i=this.fixedFilter.find(o=>o[0]=="status");i&&this.filter?.controls.status.setValue(i[2])}}onAgruparChange(i){let o=this.filter.controls.agrupar.value,e=this.filter.controls.agrupar_entrega.value,r=[];o&&r.push({field:"unidade.sigla",label:"Unidade"}),e&&r.push({field:"plano_trabalho_entrega.plano_entrega_entrega.descricao",label:"Entrega"}),this.groupBy=r,this.grid.reloadFilter()}onStatusClick(i){this.filter?.controls.status.setValue(i.data?.status),this.grid.showFilter(),this.grid.reloadFilter()}onEtiquetaClick(i){let o=this.filter.controls.etiquetas.value;o.push(i),this.filter?.controls.etiquetas.setValue(o),this.grid.showFilter(),this.grid.reloadFilter()}onEntregaClick(i){this.go.navigate({route:["gestao","atividade",i.id,"hierarquia"]},{metadata:{atividade:i}})}onColumnProgressoEtiquetasChecklistEdit(i){return v(this,null,function*(){this.formEdit.controls.progresso.setValue(i.progresso),this.checklist=this.util.clone(i.checklist)})}onColumnProgressoEtiquetasChecklistSave(i){return v(this,null,function*(){try{let o=yield this.dao.update(i.id,{progresso:this.formEdit.controls.progresso.value,checklist:this.checklist});return i.progresso=this.formEdit.controls.progresso.value,i.checklist=this.checklist,!!o}catch{return!1}})}filterClear(i){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(null),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(null),this.filter.controls.plano_trabalho_id.setValue(null),this.filter.controls.numero_processo.setValue(""),this.filter.controls.atividade_id.setValue(null),this.filter.controls.tipo_processo_id.setValue(null),this.filter.controls.data_filtro.setValue(null),this.filter.controls.data_inicio.setValue(null),this.filter.controls.data_fim.setValue(null),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(o=>o[0]=="status"))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(i)}addItemHandleEtiquetas(){let i;if(this.etiqueta&&this.etiqueta.selectedItem){let o=this.etiqueta.selectedItem,e=o.key?.length?o.key:this.util.textHash(o.value);this.util.validateLookupItem(this.formEdit.controls.etiqueta.value,e)&&(i={key:e,value:o.value,color:o.color,icon:o.icon},this.formEdit.controls.etiqueta.setValue(null))}return i}onColumnEtiquetasEdit(i){return v(this,null,function*(){if(!this.etiquetasAscendentes.filter(o=>o.data==i.unidade_id).length){this.loading=!0;let o=[];try{o=yield this.carregaEtiquetasUnidadesAscendentes(i.unidade)}finally{this.loading=!1}this.etiquetasAscendentes.push(...o)}this.formEdit.controls.etiquetas.setValue(i.etiquetas),this.formEdit.controls.etiqueta.setValue(null),this.etiquetas=this.util.merge(i.tipo_atividade?.etiquetas,i.unidade?.etiquetas,(o,e)=>o.key==e.key),this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(o,e)=>o.key==e.key),this.etiquetas=this.util.merge(this.etiquetas,this.etiquetasAscendentes.filter(o=>o.data==i.unidade_id),(o,e)=>o.key==e.key)})}carregaEtiquetasUnidadesAscendentes(i){return v(this,null,function*(){let o=[],e=i.path.split("/").filter(_=>_?.length);return(yield this.unidadeDao.query({where:[["id","in",e]]}).asPromise()).forEach(_=>{o=this.util.merge(o,_.etiquetas,(b,w)=>b.key==w.key)}),o.forEach(_=>_.data=i.id),o})}onColumnEtiquetasSave(i){return v(this,null,function*(){try{let o=yield this.dao.update(i.id,{etiquetas:this.formEdit.controls.etiquetas.value});return i.etiquetas=this.formEdit.controls.etiquetas.value,!!o}catch{return!1}})}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:i=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(o,e)=>o.key==e.key),this.cdRef.detectChanges()}})}onUnidadeChange(i){return v(this,null,function*(){let o=yield this.unidadeDao.getById(this.filter?.controls.unidade_id.value,["planos_entrega"]);this.planosEntregas=o?.planos_entrega?.map(e=>Object.assign({key:e.id,value:e.nome}))||[]})}onPlanoEntregaChange(i){return v(this,null,function*(){let o=[];(yield this.unidadeDao.getById(this.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(r=>{r.id==this.filter.controls.plano_entrega_id.value&&o.push(r.entregas)}),this.planosEntregasEntregas=o[0].map(r=>Object.assign({key:r.id,value:r.descricao}))||[]})}onColumnAtividadeDescricaoEdit(i){return v(this,null,function*(){this.formEdit.controls.descricao.setValue(i.descricao),this.formEdit.controls.tipo_atividade_id.setValue(i.tipo_atividade_id),this.formEdit.controls.comentarios.setValue(i.comentarios)})}onColumnAtividadeDescricaoSave(i){return v(this,null,function*(){try{this.atividadeService.comentarioAtividade(this.tipoAtividade?.selectedEntity,this.formEdit.controls.comentarios);let o=yield this.dao.update(i.id,{descricao:this.formEdit.controls.descricao.value,tipo_atividade_id:this.formEdit.controls.tipo_atividade_id.value,comentarios:(this.formEdit.controls.comentarios.value||[]).filter(e=>["ADD","EDIT","DELETE"].includes(e._status||""))});return i.descricao=this.formEdit.controls.descricao.value,i.tipo_atividade_id=this.formEdit.controls.tipo_atividade_id.value,i.tipo_atividade=this.tipoAtividade?.selectedEntity||null,i.comentarios=this.formEdit.controls.comentarios.value,!!o}catch{return!1}})}canEditColumn(i){return i.usuario_id==this.auth.usuario.id}};n.selectRoute={route:["gestao","atividade","grid"]},n.\u0275fac=function(o){return new(o||n)(G(z))},n.\u0275cmp=L({type:n,selectors:[["atividade-list-grid"]],viewQuery:function(o,e){if(o&1&&(T(j,5),T(ue,5),T(ce,5),T(pe,5),T(me,5),T(_e,5),T(fe,5),T(he,5)),o&2){let r;x(r=A())&&(e.grid=r.first),x(r=A())&&(e.calendarEfemerides=r.first),x(r=A())&&(e.unidade=r.first),x(r=A())&&(e.usuario=r.first),x(r=A())&&(e.tipoAtividade=r.first),x(r=A())&&(e.etiqueta=r.first),x(r=A())&&(e.planoEntrega=r.first),x(r=A())&&(e.planoEntregaEntrega=r.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[P],decls:73,vars:122,consts:[["calendarEfemerides",""],["groupAtividades",""],["usuario",""],["planoTrabalho",""],["unidade",""],["planoEntrega",""],["planoEntregaEntrega",""],["titleIdAtividadeDescricao",""],["columnAtividadeDescricao",""],["columnAtividadeDescricaoEdit",""],["columnEtiquetas",""],["columnEtiquetasEdit",""],["titlePlanoTrabalho",""],["columnPlanoTrabalho",""],["titleUnResponsavelDemandante",""],["columnPessoas",""],["titleTempos",""],["columnTempos",""],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],["columnNumero",""],["columnTarefas",""],["columnExpandedTarefas",""],["tipoAtividade",""],["etiqueta",""],[3,"select","dao","add","form","hasEdit","hasDelete","orderBy","groupBy","join","loadList","selectable","groupTemplate"],[4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"change","size","control"],["label","Usu\xE1rio","controlName","usuario_id",3,"size","control","disabled","dao"],["label","Plano de trabalho","controlName","plano_trabalho_id",3,"size","control","dao"],["label","Atual","controlName","somente_unidade_atual",3,"change","size","control","labelInfo"],["label","Unidade","controlName","unidade_id",3,"change","size","control","disabled","dao"],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"change","size","label","valueTodos","control","items"],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["label","#ID","controlName","numero","maskFormat","999999",3,"size","control","labelInfo"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xE7\xE3o, conclus\xE3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["label","Arq.","controlName","arquivadas",3,"size","control","labelInfo"],["controlName","tipo_atividade_id",3,"size","label","control","dao"],["controlName","tipo_processo_id",3,"size","label","control","dao"],["label","Data","itemTodos","- Todos -","controlName","data_filtro",3,"size","valueTodos","control","items"],["noIcon","","label","In\xEDcio","controlName","data_inicio","labelInfo","Data in\xEDcio do per\xEDodo",3,"size","disabled","control"],["noIcon","","label","Fim","controlName","data_fim","labelInfo","Data fim do per\xEDodo",3,"size","disabled","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],[3,"titleTemplate","editable","maxWidth","template","editTemplate","columnEditTemplate","edit","save"],[3,"title","editable","maxWidth","width","template","editTemplate","columnEditTemplate","edit","save"],[3,"titleTemplate","template"],[3,"titleTemplate","template","maxWidth","editable"],[3,"titleTemplate","template","width"],[3,"title","maxWidth","editable","columnEditTemplate","template","edit","save"],[3,"title","width","template"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options",4,"ngIf"],[3,"rows"],[3,"efemerides"],[1,"d-flex","ps-3"],[4,"ngFor","ngForOf"],[1,"me-3"],["labelPosition","left","label","Agrupar por Entrega","controlName","agrupar_entrega",3,"change","size","control"],["labelPosition","left","label","Agrupar por Unidade","controlName","agrupar",3,"change","size","control"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["persist","",3,"selectable","editable","atividade"],["by","numero",3,"header"],["by","plano_trabalho_entrega.descricao",3,"header"],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],["color","light",3,"icon","label",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["color","light",3,"icon","label"],["color","info","role","button",3,"click","icon","label"],["label","Descri\xE7\xE3o","controlName","descricao","required","",3,"size","rows","control"],["relativeId","columnTipoAtividade","controlName","tipo_atividade_id",3,"label","size","emptyValue","control","dao","labelInfo","required"],[3,"lookup","click",4,"ngFor","ngForOf"],[3,"lookup","click"],["controlName","etiquetas",3,"size","control","addItemHandle"],["controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"details","size","control","items"],["class","d-block",4,"ngIf"],[1,"d-block"],["by","usuario.nome",3,"header"],["by","demandante.nome",3,"header"],[1,"text-nowrap"],["icon","bi bi-briefcase","color","light",3,"label"],["color","light",3,"icon","label","hint"],["icon","bi bi-cursor","color","light",3,"label","hint"],["by","data_distribuicao",3,"header"],["by","data_estipulada_entrega",3,"header"],["by","data_entrega",3,"header"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["color","success",3,"value"],["small","","title","Checklist",4,"ngIf"],["small","","title","Checklist"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xE7\xE3o (% Conclu\xEDdo)",3,"size","decimals","control"],["scale","small",3,"size","source","path"],[3,"documento"],[3,"data","color","icon","label","click",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"data","color","icon","label","click"],["type","options",3,"metadata","dynamicOptions","dynamicButtons","options"]],template:function(o,e){if(o&1){let r=k();m(0,ge,1,1,"ng-template",null,0,h),u(2,"grid",25),C("select",function(b){return E(r),y(e.onSelect(b))}),m(3,ve,2,1,"ng-template",null,1,h)(5,Ee,3,4,"toolbar",26),u(6,"filter",27)(7,"div",28)(8,"input-switch",29),C("change",function(b){return E(r),y(e.onAtribuidasParaMimChange(b))}),d(),c(9,"input-search",30,2)(11,"input-search",31,3),d(),u(13,"div",28)(14,"input-switch",32),C("change",function(b){return E(r),y(e.onSomenteUnidadeAtualChange(b))}),d(),u(15,"input-search",33,4),C("change",function(b){return E(r),y(e.onUnidadeChange(b))}),d(),c(17,"input-switch",34),u(18,"input-select",35,5),C("change",function(b){return E(r),y(e.onPlanoEntregaChange(b))}),d(),c(20,"input-select",36,6),d(),u(22,"div",28),c(23,"input-text",37)(24,"input-text",38)(25,"input-select",39)(26,"input-multiselect",40)(27,"input-switch",41),d(),u(28,"div",28),c(29,"input-search",42)(30,"input-search",43)(31,"input-select",44)(32,"input-datetime",45)(33,"input-datetime",46),d()(),u(34,"columns"),m(35,xe,5,4,"column",47),u(36,"column",48),m(37,Ae,7,4,"ng-template",null,7,h)(39,Ie,7,7,"ng-template",null,8,h)(41,Se,3,10,"ng-template",null,9,h),d(),u(43,"column",49),m(44,De,1,1,"ng-template",null,10,h)(46,Ve,3,6,"ng-template",null,11,h),d(),u(48,"column",50),m(49,Le,1,0,"ng-template",null,12,h)(51,Ge,1,1,"ng-template",null,13,h),d(),u(53,"column",51),m(54,Pe,6,3,"ng-template",null,14,h)(56,Oe,4,6,"ng-template",null,15,h),d(),u(58,"column",52),m(59,Re,8,3,"ng-template",null,16,h)(61,Ne,2,1,"ng-template",null,17,h),d(),u(63,"column",53),m(64,We,3,3,"ng-template",null,18,h)(66,je,3,5,"ng-template",null,19,h),d(),u(68,"column",54),m(69,Ke,4,5,"ng-template",null,20,h),d(),m(71,Xe,1,4,"column",55),d(),c(72,"pagination",56),d()}if(o&2){let r=g(4),_=g(38),b=g(40),w=g(42),V=g(45),ee=g(47),te=g(50),ie=g(52),ae=g(55),ne=g(57),oe=g(60),le=g(62),re=g(65),se=g(67),de=g(70);s(2),l("dao",e.dao)("add",e.add)("form",e.formEdit)("hasEdit",!1)("hasDelete",!1)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("loadList",e.onGridLoad.bind(e))("selectable",e.selectable)("groupTemplate",r),s(3),l("ngIf",!e.fixedFilter&&!e.selectable),s(),l("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&!(e.queryParams!=null&&e.queryParams.filter)&&e.filterCollapsed),s(2),l("size",1)("control",e.filter.controls.atribuidas_para_mim),s(),l("size",6)("control",e.filter.controls.usuario_id)("disabled",e.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",e.usuarioDao),s(2),l("size",5)("control",e.filter.controls.plano_trabalho_id)("dao",e.planoTrabalhoDao),s(3),l("size",1)("control",e.filter.controls.somente_unidade_atual)("labelInfo","Somente as "+e.lex.translate("atividades")+" da unidade selecionada"),s(),l("size",3)("control",e.filter.controls.unidade_id)("disabled",e.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",e.unidadeDao),s(2),l("size",1)("control",e.filter.controls.unidades_subordinadas),s(),l("size",4)("label",e.lex.translate("Plano de Entrega"))("valueTodos",null)("control",e.filter.controls.plano_entrega_id)("items",e.planosEntregas),s(2),l("size",3)("label",e.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",e.filter.controls.plano_entrega_entrega_id)("items",e.planosEntregasEntregas),s(3),l("size",1)("control",e.filter.controls.numero)("labelInfo","N\xFAmero "+e.lex.translate("atividade")),D("maxlength",250),s(),l("size",3)("label","N\xBA "+e.lex.translate("Processo")+" (Sei)")("control",e.filter.controls.numero_processo),D("maxlength",250),s(),l("size",3)("valueTodos",null)("disabled",e.fixedFilter!=null&&e.fixedFilter.length&&e.fixedFilter[0][0]=="status"?"true":void 0)("control",e.filter.controls.status)("items",e.lookup.ATIVIDADE_STATUS_COM_ARQUIVADAS),s(),l("size",4)("control",e.filter.controls.etiquetas),s(),l("size",1)("control",e.filter.controls.arquivadas)("labelInfo","Listar tamb\xE9m "+e.lex.translate("atividades")+" arquivadas"),s(2),l("size",3)("label","Tipo de "+e.lex.translate("Atividade"))("control",e.filter.controls.tipo_atividade_id)("dao",e.tipoAtividadeDao),s(),l("size",3)("label","Tipo de "+e.lex.translate("Processo"))("control",e.filter.controls.tipo_processo_id)("dao",e.tipoProcessoDao),s(),l("size",2)("valueTodos",null)("control",e.filter.controls.data_filtro)("items",e.DATAS_FILTRO),s(),l("size",2)("disabled",e.filter.controls.data_filtro.value==null?"true":void 0)("control",e.filter.controls.data_inicio),s(),l("size",2)("disabled",e.filter.controls.data_filtro.value==null?"true":void 0)("control",e.filter.controls.data_fim),s(2),l("ngIf",!e.selectable),s(),l("titleTemplate",_)("editable",e.canEditColumn.bind(e))("maxWidth",250)("template",b)("editTemplate",b)("columnEditTemplate",e.selectable?void 0:w)("edit",e.selectable?void 0:e.onColumnAtividadeDescricaoEdit.bind(e))("save",e.selectable?void 0:e.onColumnAtividadeDescricaoSave.bind(e)),s(7),l("title","Etiquetas")("editable",e.canEditColumn.bind(e))("maxWidth",300)("width",100)("template",V)("editTemplate",V)("columnEditTemplate",e.selectable?void 0:ee)("edit",e.selectable?void 0:e.onColumnEtiquetasEdit.bind(e))("save",e.selectable?void 0:e.onColumnEtiquetasSave.bind(e)),s(5),l("titleTemplate",te)("template",ie),s(5),l("titleTemplate",ae)("template",ne)("maxWidth",150)("editable",e.canEditColumn.bind(e)),s(5),l("titleTemplate",oe)("template",le)("width",250),s(5),l("title",`Progresso
Checklist`)("maxWidth",250)("editable",e.canEditColumn.bind(e))("columnEditTemplate",e.selectable?void 0:se)("template",re)("edit",e.selectable?void 0:e.onColumnProgressoEtiquetasChecklistEdit.bind(e))("save",e.selectable?void 0:e.onColumnProgressoEtiquetasChecklistSave.bind(e)),s(5),l("title",`n\xBA Processo/Status
Coment\xE1rios`)("width",250)("template",de),s(3),l("ngIf",!e.selectable),s(),l("rows",e.rowsLimit)}},styles:[".atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}"]});let a=n;return a})();var Y=class extends F{constructor(n){super(),this.documento=null,this.comentarios=[],this.descricao=null,this.data_lancamento=new Date,this.tempo_estimado=0,this.data_conclusao=null,this.documento_id=null,this.atividade_id="",this.usuario_id="",this.tipo_tarefa_id=null,this.initialization(n)}};export{Y as a,S as b,ft as c};
