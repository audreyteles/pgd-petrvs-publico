import{a as Qe}from"./chunk-2GIPZNZY.js";import{a as Le,b as Ge}from"./chunk-MNKRGGEJ.js";import{f as Ve,n as qe}from"./chunk-5IAOL3IR.js";import"./chunk-IVBXO46K.js";import{a as Re}from"./chunk-UFS3OPCG.js";import{b as $}from"./chunk-76VPKZU2.js";import{a as k,b as q}from"./chunk-RMYSPY7H.js";import{W as Oe,Y as Me,aa as Pe,b as ae,ba as ze,d as Ae,fa as ke,h as W,i as re,j as de,n as X,q as Ne,s as V,t as Fe,v as se,w as le,x as J}from"./chunk-XHTD5OAS.js";import{b as ne,c as j,d as H,e as we,h as Se,m as oe,n as Te,s as R}from"./chunk-KODYKPWY.js";import{i as xe}from"./chunk-ORJB5SCJ.js";import{$a as ue,Ab as be,Bb as z,Cd as Ue,Fa as m,Fb as ve,Ga as l,Ha as p,Hc as Ie,La as B,Ma as M,Na as E,Nc as ee,P as K,Pc as ie,Qc as te,Sa as ge,Sc as F,U as w,Ua as b,Uc as Ce,V as Y,Va as v,Wa as y,Xa as I,Ya as D,Z as x,Za as U,Zc as Ee,_ as O,_a as _e,ba as S,fd as De,h as _,ic as ye,kb as G,lb as P,ma as s,mb as pe,na as T,oc as ce,sb as C,sc as N,va as A,xa as h,ya as Z,za as d}from"./chunk-6YMI2QVU.js";var mi=["unidade_pai"],ui=["cidade"],pi=["gestor"],ci=["gestorSubstituto"],fi=["gestorDelegado"],hi=["entidade"],gi=["notificacoes"],_i=a=>["entidade_id","==",a],bi=a=>[a];function vi(a,o){if(a&1&&(m(0,"tab",29),p(1,"notificacoes-config",30,5),l()),a&2){let r=E();s(),d("unidadeId",r.entity.id.length?r.entity.id:"ADD")("entity",r.entity)("disabled",r.formDisabled)}}var me=(()=>{let o=class o extends Re{get informalIsDisabled(){return"true"}get instituidoraIsDisabled(){return this.informal?"true":void 0}get codigoIsDisabled(){return!this.informal&&this.action=="new"?void 0:"true"}get unidadePaiIsDisabled(){return this.unidadeRaiz||!this.informal&&this.action=="edit"?"true":void 0}get isDisabled(){return!this.informal&&this.action=="edit"?"true":void 0}constructor(i){super(i,N,F),this.injector=i,this.unidadeRaiz=!1,this.informal=!0,this.validate=(t,e)=>{let n=null;return e=="unidade_pai_id"&&!t.value?.length&&!this.unidadeRaiz&&(n="Obrigat\xF3rio"),e=="codigo"&&!this.form?.controls.informal.value&&!parseInt(t.value)&&(n="Obrigat\xF3rio"),n},this.titleEdit=t=>"Editando "+this.lex.translate("Unidade")+": "+(t?.sigla||""),this.entidadeDao=i.get(te),this.cidadeDao=i.get(ie),this.usuarioDao=i.get(ee),this.planoTrabalhoDao=i.get(De),this.notificacao=i.get(Ce),this.modalWidth=1200,this.planoDataset=this.planoTrabalhoDao.dataset(),this.form=this.fh.FormBuilder({codigo:{default:""},sigla:{default:""},nome:{default:""},path:{default:""},cidade_id:{default:""},uf:{default:""},instituidora:{default:!1},informal:{default:!0},atividades_arquivamento_automatico:{default:0},distribuicao_forma_contagem_prazos:{default:"DIAS_UTEIS"},entrega_forma_contagem_prazos:{default:"HORAS_UTEIS"},notificacoes:{default:{}},etiquetas:{default:[]},unidade_pai_id:{default:""},entidade_id:{default:this.auth.unidade?.entidade_id},etiqueta_texto:{default:""},etiqueta_icone:{default:null},etiqueta_cor:{default:null},expediente24:{default:!0},expediente:{default:null},usar_expediente_unidade:{default:!1},texto_complementar_plano:{default:""}},this.cdRef,this.validate),this.join=["cidade","entidade","unidade_pai","gestor.usuario:id,nome","gestores_substitutos.usuario:id,nome","gestores_delegados.usuario:id,nome","notificacoes_templates","gestor.gestor:id","gestores_substitutos.gestor_substituto:id","gestores_delegados.gestor_delegado:id"]}loadData(i,t){return _(this,null,function*(){this.informal=!!i.informal,this.cdRef.detectChanges();let e=Object.assign({},t.value);i.etiquetas=i.etiquetas||[],this.form.patchValue(this.util.fillForm(e,i)),yield Promise.all([this.unidadePai.loadSearch(i.unidade_pai||i.unidade_pai_id),this.cidade.loadSearch(i.cidade||i.cidade_id),this.entidade.loadSearch(i.entidade||i.entidade_id)]),this.form.controls.informal.setValue(i.informal),this.unidadeRaiz=this.action=="edit"&&!i.unidade_pai_id,this.form.controls.usar_expediente_unidade.setValue(!!i.expediente),this.fh.revalidate(this.form)})}initializeData(i){this.entity=new N({entidade_id:this.auth.unidade?.entidade_id,entidade:this.auth.unidade?.entidade,informal:1}),this.loadData(this.entity,i)}addItemHandle(){let i,t=this.form.controls.etiqueta_texto.value,e=this.util.textHash(t);return t?.length&&this.util.validateLookupItem(this.form.controls.etiquetas.value,e)&&(i={key:e,value:this.form.controls.etiqueta_texto.value,color:this.form.controls.etiqueta_cor.value,icon:this.form.controls.etiqueta_icone.value},this.form.controls.etiqueta_texto.setValue(""),this.form.controls.etiqueta_icone.setValue(null),this.form.controls.etiqueta_cor.setValue(null)),i}saveData(i){return new Promise((t,e)=>_(this,null,function*(){this.notificacoes.saveData();let n=this.util.fill(new N,this.entity);n=this.util.fillForm(n,this.form.value),n.notificacoes=this.entity.notificacoes,n.notificacoes_templates=this.entity.notificacoes_templates,this.form.controls.usar_expediente_unidade||(n.expediente=null),t(n)}))}onInformalChange(i){this.informal=this.form.controls.informal.value,this.form.controls.codigo.setValue(""),this.form.controls.instituidora.setValue(!1),this.form.controls.codigo.updateValueAndValidity()}onUsarExpedienteEntidadeChange(){this.form.controls.expediente.setValue(this.form.controls.usar_expediente_unidade.value?this.form.controls.expediente.value||new Ie:null)}};o.\u0275fac=function(t){return new(t||o)(T(S))},o.\u0275cmp=w({type:o,selectors:[["app-unidade-form"]],viewQuery:function(t,e){if(t&1&&(b(V,5),b(mi,5),b(ui,5),b(pi,5),b(ci,5),b(fi,5),b(hi,5),b(gi,5)),t&2){let n;v(n=y())&&(e.editableForm=n.first),v(n=y())&&(e.unidadePai=n.first),v(n=y())&&(e.cidade=n.first),v(n=y())&&(e.gestor=n.first),v(n=y())&&(e.gestorSubstituto=n.first),v(n=y())&&(e.gestorDelegado=n.first),v(n=y())&&(e.entidade=n.first),v(n=y())&&(e.notificacoes=n.first)}},features:[A],decls:33,vars:47,consts:[["cidade",""],["unidade_pai",""],["entidade",""],["usarExpedienteEntidade",""],["expediente",""],["notificacoes",""],["initialFocus","sigla",3,"submit","cancel","title","form","disabled"],["display","","right",""],["key","PRINCIPAL","label","Principal"],[1,"row"],["label","Informal","labelClass","text-nowrap","controlName","informal",3,"change","disabled","size","labelInfo"],["label","Instit.","labelClass","text-nowrap","controlName","instituidora",3,"disabled","size","labelInfo"],["label","C\xF3digo","controlName","codigo",3,"disabled","size"],["label","Sigla","controlName","sigla","required","",3,"disabled","size"],["label","Nome","controlName","nome","required","",3,"disabled","size"],["controlName","cidade_id","required","",3,"disabled","size","dao"],["controlName","unidade_pai_id",3,"disabled","size","label","where","dao"],["disabled","","controlName","entidade_id","required","",3,"size","dao"],["key","CONFIGURACOES","label","Configura\xE7\xF5es"],["clss","row"],["label","Etiquetas","multiselectStyle","inline","controlName","etiquetas",3,"maxItemWidth","size","addItemHandle"],["label","Texto","controlName","etiqueta_texto",3,"size"],["label","\xCDcone","controlName","etiqueta_icone",3,"size","items"],["label","Cor","controlName","etiqueta_cor",3,"size"],["controlName","texto_complementar_plano",3,"label","dataset"],["key","EXPEDIENTE","label","Expediente"],["label","Usar calend\xE1rio pr\xF3prio","labelPosition","right","icon","bi bi-check2","controlName","usar_expediente_unidade",3,"change","size","labelInfo"],[3,"disabled","expedienteDisabled","control"],["key","NOTIFICACOES","label","Notifica\xE7\xF5es",4,"ngIf"],["key","NOTIFICACOES","label","Notifica\xE7\xF5es"],[3,"unidadeId","entity","disabled"]],template:function(t,e){if(t&1){let n=B();m(0,"editable-form",6),M("submit",function(){return x(n),O(e.onSaveData())})("cancel",function(){return x(n),O(e.onCancel())}),m(1,"tabs",7)(2,"tab",8)(3,"div",9)(4,"input-switch",10),M("change",function(g){return x(n),O(e.onInformalChange(g))}),l(),p(5,"input-switch",11)(6,"input-text",12)(7,"input-text",13)(8,"input-text",14),l(),m(9,"div",9),p(10,"input-search",15,0)(12,"input-search",16,1)(14,"input-search",17,2),l()(),m(16,"tab",18),p(17,"separator"),m(18,"div",19)(19,"input-multiselect",20),p(20,"input-text",21)(21,"input-select",22)(22,"input-color",23),l()(),p(23,"separator"),m(24,"div",9),p(25,"input-editor",24),l()(),m(26,"tab",25)(27,"div",9)(28,"input-switch",26,3),M("change",function(){return x(n),O(e.onUsarExpedienteEntidadeChange())}),l()(),p(30,"calendar-expediente",27,4),l(),h(32,vi,3,3,"tab",28),l()()}t&2&&(d("title",e.isModal?"":e.title)("form",e.form)("disabled",e.formDisabled),s(4),d("disabled",e.informalIsDisabled)("size",1)("labelInfo","Definir se "+e.lex.translate("a unidade")+" \xE9 informal ou n\xE3o."+e.lex.translate(" Unidades")+" informais s\xE3o, por exemplo: times volantes, comiss\xF5es, grupos de trabalho, etc."+e.lex.translate(" Unidades")+" informais n\xE3o podem mudar para formais, ou vice-versa."),s(),d("disabled",e.instituidoraIsDisabled)("size",1)("labelInfo","Se a "+e.lex.translate("unidade")+" \xE9 instituidora de Programas. Unidade administrativa prevista no art. 4\xBA do Decreto n\xBA 11.072, de 2022."),s(),d("disabled",e.codigoIsDisabled)("size",2),s(),d("disabled",e.isDisabled)("size",2),s(),d("disabled",e.isDisabled)("size",6),s(2),d("disabled",e.isDisabled)("size",4)("dao",e.cidadeDao),s(2),d("disabled",e.unidadePaiIsDisabled)("size",4)("label",e.lex.translate("Unidade")+" pai")("where",P(45,bi,P(43,_i,e.form.controls.entidade_id.value)))("dao",e.dao),s(2),d("size",4)("dao",e.entidadeDao),s(5),d("maxItemWidth",250)("size",12)("addItemHandle",e.addItemHandle.bind(e)),s(),d("size",6),Z("maxlength",250),s(),d("size",3)("items",e.lookup.ICONES),s(),d("size",3),s(3),d("label","Texto complementar "+e.lex.translate("Plano de Trabalho"))("dataset",e.planoDataset),s(3),ge("labelInfo","Se o expediente da ",e.lex.translate("unidade")," n\xE3o for definido usaremos o da ",e.lex.translate("entidade"),""),d("size",12),s(2),d("disabled",e.form.controls.usar_expediente_unidade.value?void 0:"true")("expedienteDisabled",e.entity==null||e.entity.entidade==null?null:e.entity.entidade.expediente)("control",e.form.controls.expediente),s(2),d("ngIf",e.entity))},dependencies:[z,V,X,W,ae,re,Ae,de,J,le,Fe,Ne,Ve,Te]});let a=o;return a})();var Ci=["instituidora"];function Ei(a,o){if(a&1&&(m(0,"h3",19),D(1),l()),a&2){let r=E();s(),U(r.title)}}function Di(a,o){if(a&1&&p(0,"toolbar",20),a&2){let r=E();d("buttons",r.buttons)}}function Ui(a,o){if(a&1&&(m(0,"span",23),p(1,"i",24),D(2),l()),a&2){let r=E().row;s(2),_e(" ",r.unidade.sigla," ")}}function wi(a,o){if(a&1&&(m(0,"span",21),D(1),l(),h(2,Ui,3,1,"span",22)),a&2){let r=o.row;s(),U(r.nome),s(),d("ngIf",r.unidade)}}function Si(a,o){if(a&1&&(m(0,"span"),D(1),l()),a&2){let r=o.row;s(),U(((r.cidade==null?null:r.cidade.nome)||"")+"/"+((r.cidade==null?null:r.cidade.uf)||""))}}function Ti(a,o){a&1&&p(0,"badge",28)}function Ai(a,o){if(a&1&&(m(0,"div",25),h(1,Ti,1,0,"badge",26),p(2,"badge",27),l()),a&2){let r=o.row;s(),d("ngIf",r.instituidora),s(),d("color",r.data_inativacao?"danger":"success")("icon",r.data_inativacao?"bi bi-x-circle":"bi bi-check-circle")("label",r.data_inativacao?"Inativo":"Ativo")}}var $e=(()=>{let o=class o extends ${constructor(i){super(i,N,F),this.injector=i,this.selectable=!1,this.buttons=[],this.filterWhere=t=>{let e=t.value,n=[];return n.push(this.selectable?["data_inativacao",e.inativos?"!=":"==",null]:["inativos","==",e.inativos]),e.entidade_id?.length&&n.push(["entidade_id","==",e.entidade_id]),e.nome?.length&&n.push(["or",["nome","like","%"+e.nome.trim().replace(" ","%")+"%"],["sigla","like","%"+e.nome.trim().replace(" ","%")+"%"]]),e.instituidora&&n.push(["instituidora","==",1]),n},this.join=["cidade","unidade_pai:id,sigla","entidade:id,sigla","gestor.usuario:id","gestores_substitutos.usuario:id"],this.cidadeDao=i.get(ie),this.entidadeDao=i.get(te),this.code="MOD_CFG_UND",this.filter=this.fh.FormBuilder({entidade_id:{default:this.auth.unidade?.entidade_id},inativos:{default:!1},instituidora:{default:!1},nome:{default:""}}),this.groupBy=[{field:"entidade.sigla",label:"Entidade"}],this.auth.hasPermissionTo("MOD_UND_UNIR")&&this.buttons.push({icon:"bi bi-arrows-collapse",color:"btn-outline-danger",label:"Unificar",onClick:t=>this.go.navigate({route:["configuracoes","unidade","merge"]},this.modalRefresh())}),this.addOption(this.OPTION_INFORMACOES,"MOD_UND"),this.addOption(this.OPTION_EXCLUIR,"MOD_UND_EXCL")}dynamicOptions(i){let t=[],e=i;return this.auth.hasPermissionTo("MOD_UND_INATV")&&t.push({icon:e.data_inativacao?"bi bi-check-circle":"bi bi-x-circle",label:e.data_inativacao?"Reativar":"Inativar",onClick:n=>_(this,null,function*(){return yield this.inativo(n,!n.data_inativacao)})}),this.auth.hasPermissionTo("MOD_UND_INTG")&&t.push({label:"Integrantes",icon:"bi bi-people",onClick:n=>this.go.navigate({route:["configuracoes","unidade","",n.id,"integrante"]},{metadata:{unidade:i}})}),t}inativo(i,t){return _(this,null,function*(){if(yield this.dialog.confirm(t?"Inativar":"Reativar",t?"Deseja realmente inativar essa unidade ("+i.nome+")?":"Deseja reativar essa unidade ("+i.nome+")?"))try{this.submitting=!0,yield this.dao.inativar(i.id,t),yield this.modalRefreshId(i).modalClose(void 0)}finally{this.submitting=!1}})}filterClear(i){super.filterClear(i)}get labelInfoInativas(){return this.selectable?"Se lista s\xF3 as unidades inativas":"Se lista tamb\xE9m as unidades inativas"}};o.\u0275fac=function(t){return new(t||o)(T(S))},o.\u0275cmp=w({type:o,selectors:[["unidade-list-grid"]],viewQuery:function(t,e){if(t&1&&(b(R,5),b(Ci,5)),t&2){let n;v(n=y())&&(e.grid=n.first),v(n=y())&&(e.instituidora=n.first)}},inputs:{selectable:"selectable",snapshot:"snapshot"},features:[A],decls:23,vars:34,consts:[["instituidora",""],["columnNome",""],["columnCidade",""],["columnSituacao",""],["class","my-2",4,"ngIf"],[3,"select","dao","add","orderBy","groupBy","join","selectable","hasAdd","hasEdit"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Nome","controlName","nome","placeholder","Nome ou sigla...",3,"size","control"],["label","Instit.","labelClass","text-nowrap","controlName","instituidora",3,"size","control","labelInfo"],["label","Inativos","controlName","inativos",3,"size","control","labelInfo"],["title","Sigla","field","sigla"],["title","Nome","orderBy","nome",3,"template"],["title","C\xF3digo","field","codigo"],[3,"title","template"],["title","Situa\xE7\xE3o",3,"template"],["type","options",3,"onEdit","options","dynamicOptions"],[3,"rows"],[1,"my-2"],[3,"buttons"],[1,"d-block"],["class","badge bg-light text-dark",4,"ngIf"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-arrow-return-right"],[1,"one-per-line"],["color","primary","icon","bi bi-star","label","Instituidora",4,"ngIf"],[3,"color","icon","label"],["color","primary","icon","bi bi-star","label","Instituidora"]],template:function(t,e){if(t&1){let n=B();h(0,Ei,2,1,"h3",4),m(1,"grid",5),M("select",function(g){return x(n),O(e.onSelect(g))}),h(2,Di,1,1,"toolbar",6),m(3,"filter",7)(4,"div",8),p(5,"input-text",9)(6,"input-switch",10,0)(8,"input-switch",11),l()(),m(9,"columns"),p(10,"column",12),m(11,"column",13),h(12,wi,3,2,"ng-template",null,1,C),l(),p(14,"column",14),m(15,"column",15),h(16,Si,2,1,"ng-template",null,2,C),l(),m(18,"column",16),h(19,Ai,3,4,"ng-template",null,3,C),l(),p(21,"column",17),l(),p(22,"pagination",18),l()}if(t&2){let n=I(13),c=I(17),g=I(20);d("ngIf",e.isModal),s(),d("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("hasAdd",e.auth.hasPermissionTo("MOD_UND_INCL"))("hasEdit",e.auth.hasPermissionTo("MOD_UND_EDT")),s(),d("ngIf",!e.selectable),s(),d("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),s(2),d("size",10)("control",e.filter.controls.nome),Z("maxlength",250),s(),d("size",1)("control",e.filter.controls.instituidora)("labelInfo","Se lista SOMENTE as "+e.lex.translate("unidades")+" instituidoras de "+e.lex.translate("programas")),s(2),d("size",1)("control",e.filter.controls.inativos)("labelInfo",e.labelInfoInativas),s(3),d("template",n),s(4),d("title",e.lex.translate("Cidade"))("template",c),s(3),d("template",g),s(3),d("onEdit",e.edit)("options",e.options)("dynamicOptions",e.dynamicOptions.bind(e)),s(),d("rows",e.rowsLimit)}},dependencies:[z,R,H,j,we,ne,Se,X,ae,se]});let a=o;return a})();function Ri(a,o){if(a&1&&(m(0,"div",4),D(1),l()),a&2){let r=o.$implicit;s(),U(r.label)}}var Je=(()=>{let o=class o extends ${constructor(i){super(i,N,F),this.injector=i,this.data=[],this.dao=i.get(F)}ngAfterViewInit(){super.ngAfterViewInit(),this.carregaUnidades()}carregaUnidades(){return _(this,null,function*(){let i=this.auth.usuario?.lotacao?.unidade_id,t=yield this.dao.hierarquiaUnidades(i),e=[],n=i;for(;n;){let u=t.find(f=>f.id===n);if(u)e.unshift(n),n=u.unidade_pai_id||void 0;else break}let c=u=>t.filter(f=>f.unidade_pai_id===u).map(f=>({type:"unidade",label:f.sigla,expanded:i===f.id?!1:e.includes(f.id),styleClass:i==f.id?"text-bg-primary":"",data:{hint:f.nome,unidade:f},children:g(f.id)?c(f.id):[{type:"fake",expanded:!1,label:"Carregando..."}]})),g=u=>t.some(f=>f.unidade_pai_id===u);this.data=c(null)})}expandeUnidade(i){this.carregaFilhas(i.node.data.unidade.id,i.node)}carregaFilhas(i,t){return _(this,null,function*(){let e=yield this.dao.unidadesFilhas(i);t.children=e.map(n=>({type:"unidade",label:n.sigla,expanded:!1,data:{unidade:n,hint:n.nome},children:[{type:"fake",expanded:!1,label:"Carregando..."}]}))})}};o.\u0275fac=function(t){return new(t||o)(T(S))},o.\u0275cmp=w({type:o,selectors:[["unidade-mapa"]],features:[A],decls:4,vars:1,consts:[["autoHeightDisabled","false","track","all"],[1,"my-3"],[3,"onNodeExpand","value"],["pTemplate","unidade"],[1,"font-bold"]],template:function(t,e){t&1&&(m(0,"ng-scrollbar",0)(1,"div",1)(2,"p-organizationChart",2),M("onNodeExpand",function(c){return e.expandeUnidade(c)}),h(3,Ri,2,1,"ng-template",3),l()()()),t&2&&(s(2),d("value",e.data))},dependencies:[Le,xe,Pe]});let a=o;return a})();function xi(a,o){if(a&1&&p(0,"unidade-list-grid",5),a&2){let r=E();d("selectable",r.selectable)("snapshot",r.snapshot||r.modalRoute||r.route.snapshot)}}function Oi(a,o){a&1&&p(0,"unidade-mapa")}function Mi(a,o){if(a&1&&(m(0,"tab",6),h(1,Oi,1,0,"ng-template",null,1,C),l()),a&2){let r=I(2);d("template",r)}}var he=(()=>{let o=class o extends ${constructor(i){super(i,N,F),this.injector=i,this.filterWhere=t=>{let e=[],n=t.value;return e},this.title=this.lex.translate("Unidades"),this.code="MOD_CFG_UND",this.filter=this.fh.FormBuilder({})}ngAfterViewInit(){super.ngAfterViewInit(),this.tabs.active=["TABELA","MAPA"].includes(this.usuarioConfig.active_tab)?this.usuarioConfig.active_tab:"TABELA"}onSelectTab(i){return _(this,null,function*(){this.viewInit&&this.saveUsuarioConfig({active_tab:i.key})})}filterClear(i){i.controls.nome.setValue(""),super.filterClear(i)}};o.\u0275fac=function(t){return new(t||o)(T(S))},o.\u0275cmp=w({type:o,selectors:[["app-unidade-list"]],viewQuery:function(t,e){if(t&1&&(b(R,5),b(J,5)),t&2){let n;v(n=y())&&(e.grid=n.first),v(n=y())&&(e.tabs=n.first)}},features:[A],decls:5,vars:4,consts:[["grid",""],["mapa",""],["right","",3,"title","select"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template",4,"ngIf"],[3,"selectable","snapshot"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template"]],template:function(t,e){if(t&1&&(m(0,"tabs",2)(1,"tab",3),h(2,xi,1,2,"ng-template",null,0,C),l(),h(4,Mi,3,1,"tab",4),l()),t&2){let n=I(3);d("title",e.isModal?"":e.title)("select",e.onSelectTab.bind(e)),s(),d("template",n),s(3),d("ngIf",!e.selectable)}},dependencies:[z,J,le,$e,Je]});let a=o;return a})();var Pi=["unidadeOrigem"],zi=["unidadeDestino"],ki=()=>["inativo","!=",null],Ke=a=>[a],Ye=()=>["configuracoes","unidade"],Vi=()=>({inativos:!0}),Ze=a=>({filter:a}),ei=(a,o)=>({route:a,params:o}),qi=()=>["inativo","==",null],Li=()=>({inativos:!1});function Gi(a,o){if(a&1&&(m(0,"span"),D(1),l(),p(2,"br"),m(3,"small"),D(4),l()),a&2){let r=o.row;s(),U((r.unidade_origem==null?null:r.unidade_origem.nome)||""),s(3),ue("",(r.unidade_origem==null?null:r.unidade_origem.codigo)||""," - ",(r.unidade_origem==null?null:r.unidade_origem.sigla)||"","")}}function Qi(a,o){if(a&1&&p(0,"input-search",14,4),a&2){let r=E();d("size",12)("dao",r.dao)("where",P(5,Ke,G(4,ki)))("selectRoute",pe(11,ei,G(7,Ye),P(9,Ze,G(8,Vi))))}}function Bi(a,o){if(a&1&&(m(0,"span"),D(1),l(),p(2,"br"),m(3,"small"),D(4),l()),a&2){let r=o.row;s(),U((r.unidade_destino==null?null:r.unidade_destino.nome)||""),s(3),ue("",(r.unidade_destino==null?null:r.unidade_destino.codigo)||""," - ",(r.unidade_destino==null?null:r.unidade_destino.sigla)||"","")}}function ji(a,o){if(a&1&&p(0,"input-search",15,5),a&2){let r=E();d("size",12)("dao",r.dao)("where",P(5,Ke,G(4,qi)))("selectRoute",pe(11,ei,G(7,Ye),P(9,Ze,G(8,Li))))}}var ii=(()=>{let o=class o extends oe{constructor(i){super(i),this.injector=i,this.items=[],this.toolbarButtons=[{icon:"bi bi-yin-yang",label:"Mesma sigla",hint:"Unificar todos que tenham a mesma sigla. Sendo a inativa considerada como origem.",onClick:this.onMesmaSiglaClick.bind(this)}],this.validate=(t,e)=>null,this.dao=i.get(F),this.form=this.fh.FormBuilder({exclui_origem:{default:!1},origem_inativo:{default:!0},unidade_origem_id:{default:""},unidade_destino_id:{default:""}},this.cdRef,this.validate)}onMesmaSiglaClick(){this.loading=!0,this.dao.mesmaSigla().then(i=>{let t=[];t=i.reduce((u,f)=>(!f.data_inativacao&&!u.find(L=>L.sigla==f.sigla)&&u.push(f),u),t);let e=t.map(u=>u.id),n=i.filter(u=>!e.includes(u.id)&&!!u.data_inativacao),c=n.map(u=>u.id);this.items=[];for(let u of n){let f=t.find(L=>L.sigla==u.sigla);f&&this.items.push({id:this.dao.generateUuid(),unidade_origem_id:u.id,unidade_destino_id:f.id,unidade_origem:u,unidade_destino:f})}let g=[];for(let u of i)!e.includes(u.id)&&!c.includes(u.id)&&g.push(u.codigo+" - "+u.sigla+" - "+u.nome);g.length&&(this.editableForm.error=(g.length==1?"A unidade abaixo possui duplicidade de SIGLA, mas n\xE3o est\xE1 inativa:":"As unidades abaixo possuem duplicidade de SIGLA, mas n\xE3o est\xE3o inativas:")+`
`+g.join(`
`))}).finally(()=>{this.loading=!1})}addMerge(){return _(this,null,function*(){return{id:this.dao.generateUuid(),unidade_origem_id:"",unidade_destino_id:"",unidade_origem:void 0,unidade_destino:void 0}})}loadMerge(i,t){return _(this,null,function*(){i.controls.unidade_origem_id.setValue(t.unidade_origem_id),i.controls.unidade_destino_id.setValue(t.unidade_destino_id)})}removeMerge(i){return _(this,null,function*(){return!0})}saveMerge(i,t){return _(this,null,function*(){let e;return(this.form.controls.unidade_origem_id.value?.length||this.form.controls.unidade_destino_id.value?.length)&&(t.unidade_origem_id=i.controls.unidade_origem_id.value,t.unidade_origem=this.unidadeOrigem?.selectedEntity||(yield this.dao?.getById(t.unidade_origem_id)),t.unidade_destino_id=i.controls.unidade_destino_id.value,t.unidade_destino=this.unidadeDestino?.selectedEntity||(yield this.dao?.getById(t.unidade_destino_id)),e=t),e})}onMerge(){let i;for(let t of this.items)i=i||(!t.unidade_origem_id?.length||!t.unidade_destino_id?.length?"A origem e o destino precisam estar preenchidos em todos":void 0);this.editableForm.error=i,i?.length||(this.loading=!0,this.dao.unificar(this.items.map(t=>Object.assign({},{unidade_origem_id:t.unidade_origem_id,unidade_destino_id:t.unidade_destino_id})),this.form.controls.exclui_origem.value).then(t=>{t&&this.close()}).finally(()=>{this.loading=!1}))}};o.\u0275fac=function(t){return new(t||o)(T(S))},o.\u0275cmp=w({type:o,selectors:[["app-unidade-merge"]],viewQuery:function(t,e){if(t&1&&(b(V,5),b(Pi,5),b(zi,5)),t&2){let n;v(n=y())&&(e.editableForm=n.first),v(n=y())&&(e.unidadeOrigem=n.first),v(n=y())&&(e.unidadeDestino=n.first)}},features:[A],decls:17,vars:16,consts:[["columnUnidadeOrigem",""],["editUnidadeOrigem",""],["columnUnidadeDestino",""],["editUnidadeDestino",""],["unidade_origem",""],["unidade_destino",""],["confirmLabel","Unificar",3,"submit","cancel","form","title"],["type","warning","message","Por motivos de seguran\xE7a ser\xE1 permitido somente unificar unidades inativas para unidade ativas. E caso [Exclui origem] n\xE3o esteja habilitado, a unidade de origem continuar\xE1 na lista (como inativa)."],[3,"buttons"],["labelPosition","left","label","Exclui origem","controlName","exclui_origem",3,"size"],["editable","",3,"items","form","add","load","remove","save"],["titleHint","Unidade que ser\xE1 substitu\xEDda pela outra",3,"title","template","editTemplate"],["titleHint","Unidade que sobrar\xE1 ap\xF3s a unifica\xE7\xE3o",3,"title","template","editTemplate"],["type","options"],["label","","icon","","controlName","unidade_origem_id",3,"size","dao","where","selectRoute"],["label","","icon","","controlName","unidade_destino_id",3,"size","dao","where","selectRoute"]],template:function(t,e){if(t&1){let n=B();m(0,"editable-form",6),M("submit",function(){return x(n),O(e.onMerge())})("cancel",function(){return x(n),O(e.onCancel())}),p(1,"top-alert",7),m(2,"toolbar",8),p(3,"input-switch",9),l(),m(4,"grid",10)(5,"columns")(6,"column",11),h(7,Gi,5,3,"ng-template",null,0,C)(9,Qi,2,14,"ng-template",null,1,C),l(),m(11,"column",12),h(12,Bi,5,3,"ng-template",null,2,C)(14,ji,2,14,"ng-template",null,3,C),l(),p(16,"column",13),l()()()}if(t&2){let n=I(8),c=I(10),g=I(13),u=I(15);d("form",e.form)("title",e.isModal?"":e.title),s(2),d("buttons",e.toolbarButtons),s(),d("size",4),s(),d("items",e.items)("form",e.form)("add",e.addMerge.bind(e))("load",e.loadMerge.bind(e))("remove",e.removeMerge.bind(e))("save",e.saveMerge.bind(e)),s(2),d("title",e.lex.translate("Unidade")+" origem")("template",n)("editTemplate",c),s(5),d("title",e.lex.translate("Unidade")+" destino")("template",g)("editTemplate",u)}},dependencies:[R,H,j,ne,V,X,W,Me]});let a=o;return a})();var Hi=["usuario"];function Wi(a,o){if(a&1&&(m(0,"span")(1,"strong"),D(2),l()()),a&2){let r=E();s(2),U("Unidade: "+((r.entity==null?null:r.entity.nome)||""))}}function Xi(a,o){if(a&1&&(m(0,"div",12)(1,"div",13),p(2,"profile-picture",14),l(),m(3,"div",15)(4,"strong"),D(5),l(),p(6,"br"),m(7,"small"),D(8),l()()()),a&2){let r=o.row;s(2),d("url",r.usuario_url_foto||"")("size",40)("hint",r.usuario_nome||""),s(3),U(r.usuario_nome||""),s(3),U(r.usuario_apelido||"")}}function $i(a,o){if(a&1&&p(0,"input-search",16,7),a&2){let r=E(),i=I(1);d("disabled",i!=null&&i.adding?void 0:"true")("size",12)("dao",r.usuarioDao)}}function Ji(a,o){if(a&1&&(m(0,"div"),p(1,"badge",18)(2,"br"),l()),a&2){let r=o.$implicit,i=E(2);s(),d("color",i.lookup.getColor(i.lookup.UNIDADE_INTEGRANTE_TIPO,r||""))("icon",i.lookup.getIcon(i.lookup.UNIDADE_INTEGRANTE_TIPO,r||""))("label",i.lookup.getValue(i.lookup.UNIDADE_INTEGRANTE_TIPO,r||""))}}function Ki(a,o){if(a&1&&h(0,Ji,3,3,"div",17),a&2){let r=o.row;d("ngForOf",r.atribuicoes)}}function Yi(a,o){if(a&1&&(m(0,"input-multiselect",19),p(1,"input-select",20),l()),a&2){let r=E();d("size",8)("addItemHandle",r.addItemHandle.bind(r))("deleteItemHandle",r.deleteItemHandle.bind(r)),s(),d("size",12)("items",r.tiposAtribuicao)}}function Zi(a,o){if(a&1&&p(0,"badge",21)(1,"br"),a&2){let r=o.row,i=E();d("label",i.getPerfil(r.id)||"")}}function et(a,o){if(a&1&&p(0,"input-select",22),a&2){let r=E();d("size",12)("label",r.lex.translate("Perfil"))("dao",r.perfilDao)}}var ti=(()=>{let o=class o extends oe{set control(i){super.control=i}get control(){return super.control}set entity(i){super.entity=i}get entity(){return super.entity}set noPersist(i){super.noPersist=i}get noPersist(){return super.noPersist}constructor(i){super(i),this.injector=i,this.items=[],this.perfis=[],this.tiposAtribuicao=[],this.validate=(t,e)=>{let n=null;return["usuario_id","atribuicoes"].includes(e)&&!t.value?.length&&(n="Obrigat\xF3rio"),e=="usuario_id"&&this.grid?.adding&&this.items.map(c=>c.id).includes(t.value)&&(n="O usu\xE1rio j\xE1 \xE9 integrante desta unidade. Edite-o, ao inv\xE9s de inclu\xED-lo novamente!"),n},this.formValidation=t=>{let e=t.controls.atribuicoes.value;if(this.util.array_diff(["GESTOR","GESTOR_SUBSTITUTO","GESTOR_DELEGADO"],e.map(n=>n.key)||[]).length<2)return"A um mesmo servidor s\xF3 pode ser atribu\xEDda uma fun\xE7\xE3o de gestor (titular, substituto ou delegado), para uma mesma Unidade!"},this.integranteService=i.get(Qe),this.integranteDao=i.get(Ue),this.usuarioDao=i.get(ee),this.perfilDao=i.get(Ee),this.form=this.fh.FormBuilder({usuario_id:{default:""},atribuicoes:{default:void 0},atribuicao:{default:""},perfil_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.entity=this.metadata?.unidade,this.tiposAtribuicao=this.lookup.UNIDADE_INTEGRANTE_TIPO}ngAfterViewInit(){_(this,null,function*(){yield this.loadData(this.entity,this.form)})}loadData(i,t){return _(this,null,function*(){if(i.id){let e=[],n=[];this.loading=!0;try{yield this.integranteDao.carregarIntegrantes(i.id,"").then(c=>e=c.integrantes.filter(g=>g.atribuicoes?.length>0)),e.forEach(c=>n.push(c.id)),this.perfis=yield this.usuarioDao.query({where:[["id","in",n]]}).asPromise()}finally{this.loading=!1,this.items=[],e.forEach(c=>this.items?.push(this.integranteService.completarIntegrante(c,i.id,c.id,c.atribuicoes))),this.items=this.integranteService.ordenarIntegrantes(this.items),this.cdRef.detectChanges(),this.grid.loading=!1}}})}getPerfil(i){return this.perfis.find(e=>e.id==i)?.perfil?.nome}addItemHandle(){let i,t=this.lookup.getValue(this.lookup.UNIDADE_INTEGRANTE_TIPO,this.form.controls.atribuicao.value),e=this.form.controls.atribuicao.value;if(t?.length&&this.util.validateLookupItem(this.form.controls.atribuicoes.value,e)){let n=this.lookup.getIcon(this.lookup.UNIDADE_INTEGRANTE_TIPO,this.form.controls.atribuicao.value),c=this.lookup.getColor(this.lookup.UNIDADE_INTEGRANTE_TIPO,this.form.controls.atribuicao.value);i={key:e,value:t,icon:n,color:c},this.form.controls.atribuicao.setValue("")}return i}deleteItemHandle(i){return this.integranteService.ehPermitidoApagar(i.key)}carregarIntegrante(i,t){return _(this,null,function*(){let e=this.perfis.find(n=>n.id==t.id);i.controls.usuario_id.setValue(this.grid?.adding?t.usuario_id:t.id),i.controls.perfil_id.setValue(e?.perfil_id),i.controls.atribuicoes.setValue(this.integranteService.converterAtribuicoes(t.atribuicoes)),i.controls.atribuicao.setValue("")})}adicionarIntegrante(){return _(this,null,function*(){return this.grid&&(this.grid.error=""),{id:this.integranteDao.generateUuid(),usuario_id:"",atribuicoes:[]}})}removerIntegrante(i){return _(this,null,function*(){if(i.atribuicoes[0].includes("LOTADO"))yield this.dialog.alert("IMPOSS\xCDVEL EXCLUIR !","O v\xEDnculo que inclui "+this.lex.translate("a lota\xE7\xE3o")+" "+this.lex.translate("do servidor")+" n\xE3o pode ser exclu\xEDdo. Se desejar excluir as demais atribui\xE7\xF5es, edite o v\xEDnculo. Se deseja alterar "+this.lex.translate("a lota\xE7\xE3o")+", lote-o em outra "+this.lex.translate("Unidade")+".");else if(yield this.dialog.confirm("Exclui ?","Deseja realmente excluir todas as atribui\xE7\xF5es "+this.lex.translate("do servidor")+i.usuario_nome?.toUpperCase()+" "+this.lex.translate("na unidade")+" "+this.entity.sigla.toUpperCase()+" ?")){let e;try{if(!this.isNoPersist)this.loading=!0,yield this.integranteDao.salvarIntegrantes([this.integranteService.completarIntegrante(i,this.entity.id,i.id,[])]).then(n=>{(e=n.find(c=>c._metadata.msg?.length)?._metadata.msg)&&this.grid&&(this.grid.error=e)}),yield this.loadData({id:this.entity.id},this.form);else return Object.assign(i,{_status:"DELETE",atribuicoes:[]}),!1}finally{this.loading=!1}}return!1})}salvarIntegrante(i,t){return _(this,null,function*(){let e=this.lookup.uniqueLookupItem(i.controls.atribuicoes.value);i.controls.atribuicoes.setValue(e),this.grid&&(this.grid.error=""),this.cdRef.detectChanges();let n=this.formValidation(i);if(n)yield this.dialog.alert("Imposs\xEDvel incluir/alterar o servidor!",n);else{let c=!0,g=this.integranteService.haAlteracaoGerencia(e.map(u=>u.key),Object.assign(t,{usuario_nome:this.usuario?.selectedItem?.entity.nome}),this.grid?.items||[],this.entity?.sigla||"");if(g[0]!="nenhuma")if(c=yield this.dialog.confirm("CONFIRMA A ALTERA\xC7\xC3O DA CHEFIA ?",g[2]),c){switch(g[0]){case"troca":this.grid.items[g[1]].atribuicoes=this.grid.items[g[1]].atribuicoes.filter(u=>!["GESTOR"].includes(u));break}e=this.integranteService.inserirAtribuicao(e,"LOTADO"),i.controls.atribuicoes.setValue(e),this.loading=!0}else return;try{this.isNoPersist?(t.id=this.usuario?.selectedEntity.id,this.grid.items=this.integranteService.substituirItem({id:t.id,itens:this.grid?.items||[],apelidoOuSigla:this.usuario?.selectedItem?.entity.apelido,nome:this.usuario?.selectedItem?.entity.nome,codigo:""},e.map(u=>u.key),new N(this.entity))):(yield this.integranteDao.salvarIntegrantes([Object.assign({_metadata:{perfil_id:i.controls.perfil_id.value}},this.integranteService.completarIntegrante(t,this.entity.id,i.controls.usuario_id.value,e.map(u=>u.key)))]).then(u=>{let f;(f=u?.find(L=>L._metadata.msg?.length)?._metadata.msg)&&this.dialog.alert("ATEN\xC7\xC3O: ERRO!",f)}),yield this.loadData({id:this.entity.id},this.form),this.grid&&(this.grid.error="")),this.cdRef.detectChanges()}catch(u){this.grid&&(this.grid.error=u),yield this.loadData({id:this.entity.id},this.form)}finally{this.loading=!1}}})}};o.\u0275fac=function(t){return new(t||o)(T(S))},o.\u0275cmp=w({type:o,selectors:[["unidade-integrante"]],viewQuery:function(t,e){if(t&1&&(b(R,5),b(Hi,5)),t&2){let n;v(n=y())&&(e.grid=n.first),v(n=y())&&(e.usuario=n.first)}},inputs:{control:"control",entity:"entity",noPersist:"noPersist"},features:[A],decls:20,vars:21,consts:[["grid",""],["columnUsuario",""],["editUsuario",""],["columnAtribuicoes",""],["editAtribuicoes",""],["columnPerfil",""],["editPerfil",""],["usuario",""],["editable","",3,"items","minHeight","form","hasDelete","add","load","remove","save"],[4,"ngIf"],[3,"title","template","editTemplate","maxWidth"],["type","options"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["label","","icon","","controlName","usuario_id",3,"disabled","size","dao"],[4,"ngFor","ngForOf"],[3,"color","icon","label"],["controlName","atribuicoes",3,"size","addItemHandle","deleteItemHandle"],["label","","icon","fas fa-sign-out-alt","controlName","atribuicao",3,"size","items"],["color","gray",3,"label"],["controlName","perfil_id","required","",3,"size","label","dao"]],template:function(t,e){if(t&1&&(m(0,"grid",8,0),h(2,Wi,3,1,"span",9),m(3,"columns")(4,"column",10),h(5,Xi,9,5,"ng-template",null,1,C)(7,$i,2,3,"ng-template",null,2,C),l(),m(9,"column",10),h(10,Ki,1,1,"ng-template",null,3,C)(12,Yi,2,5,"ng-template",null,4,C),l(),m(14,"column",10),h(15,Zi,2,1,"ng-template",null,5,C)(17,et,1,3,"ng-template",null,6,C),l(),p(19,"column",11),l()()),t&2){let n=I(6),c=I(8),g=I(11),u=I(13),f=I(16),L=I(18);d("items",e.items)("minHeight",500)("form",e.form)("hasDelete",!0)("add",e.adicionarIntegrante.bind(e))("load",e.carregarIntegrante.bind(e))("remove",e.removerIntegrante.bind(e))("save",e.salvarIntegrante.bind(e)),s(2),d("ngIf",!e.isNoPersist),s(2),d("title",e.lex.translate("Usu\xE1rios"))("template",n)("editTemplate",c)("maxWidth",150),s(5),d("title",e.lex.translate("Atribui\xE7\xF5es"))("template",g)("editTemplate",u)("maxWidth",200),s(5),d("title",e.lex.translate("Perfil"))("template",f)("editTemplate",e.auth.hasPermissionTo("MOD_CFG_USER_PERFIL")?L:f)("maxWidth",300)}},dependencies:[be,z,R,H,j,W,re,de,se,Oe]});let a=o;return a})();var it=[{path:"",component:he,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Unidades"}},{path:"new",component:me,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Inclus\xE3o de Unidade",modal:!0}},{path:":id/edit",component:me,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Edi\xE7\xE3o de Unidade",modal:!0}},{path:":id/consult",component:me,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Consulta a Unidade",modal:!0}},{path:":id/:idUnidade/integrante",component:ti,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Integrantes da Unidade",modal:!0}},{path:":id/subordinadas",component:he,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Unidades subordinadas"}},{path:"merge",component:ii,canActivate:[k],resolve:{config:q},runGuardsAndResolvers:"always",data:{title:"Unifica\xE7\xE3o",modal:!0}}],ai=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Y({type:o}),o.\u0275inj=K({imports:[ce.forChild(it),ce]});let a=o;return a})();var Ra=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=Y({type:o}),o.\u0275inj=K({imports:[ve,ke,qe,ye,ai,Ge,ze]});let a=o;return a})();export{Ra as UnidadeModule};
