import{a as Y}from"./chunk-BK3LQZ2W.js";import{c as ye}from"./chunk-MAEBQYG4.js";import{a as X}from"./chunk-3OQ5NXFP.js";import{b as W}from"./chunk-GEQ4G77C.js";import{a as V,b as O}from"./chunk-72ETMCRT.js";import{b as K,ca as ge,f as I,fa as _e,i as z,o as he,s as N,v as ve}from"./chunk-JEWU6XZO.js";import{b as k,c as ce,d as ue,e as q,h as U,i as fe,q as J,s as _}from"./chunk-OWVQDN4P.js";import{Ab as le,Bb as P,Ed as L,Fa as s,Fb as se,Fd as T,Ga as m,Ha as c,La as ne,Ma as A,Na as R,Nc as G,P as M,Td as pe,U as S,Ua as h,V as x,Va as v,Wa as g,Xa as Q,Ya as C,Z as re,Za as E,_ as ae,a as te,b as ie,ba as D,g as oe,h as B,ic as me,ma as r,na as f,oc as H,pc as de,sb as j,va as F,xa as y,ya as b,za as n}from"./chunk-SDCVQHKS.js";var Te=["selectResponsaveis"],ze=["relacao"];function Ne(a,o){if(a&1){let d=ne();s(0,"button",12),A("click",function(){re(d);let i=R();return ae(i.exportarCSV())}),s(1,"i",13),C(2," Exportar CSV"),m()()}}function Ve(a,o){if(a&1&&(s(0,"div",14)(1,"h2",15)(2,"button",16)(3,"div",17)(4,"span",18),C(5),m(),s(6,"span",19),c(7,"badge",20),m(),s(8,"span",21),C(9),m(),s(10,"span",22),c(11,"badge",20),m()()()(),s(12,"div",23)(13,"div",24),c(14,"json-viewer",25),m()()()),a&2){let d=o.$implicit,t=R();r(2),b("data-bs-toggle","collapse")("data-bs-target","#collapse_"+d.id)("aria-controls","collapse_"+d.id),r(3),E(d._metadata.responsavel),r(2),n("label",d.type)("color",d.type=="DELETE"?"#910404":"#030521"),r(2),E(d.table_name),r(2),n("label",t.util.getDateTimeFormatted(d.date_time))("color","#676789"),r(),b("id","collapse_"+d.id)("data-bs-target","#accordionLogs"),r(2),n("json",d.delta)}}var ee=(()=>{let o=class o extends W{constructor(t,i,e){super(t,Y,L),this.injector=t,this.xlsx=e,this.toolbarButtons=[],this.responsaveis=[],this.relacoes=[],this.changes=[],this.filterWhere=l=>{let p=[],u=l.value;return u.usuario_id?.length&&p.push(["user_id","==",u.usuario_id=="null"?null:u.usuario_id]),u.data_inicio&&p.push(["date_time",">=",u.data_inicio]),u.data_fim&&p.push(["date_time","<=",u.data_fim]),u.tabela&&p.push(["table_name","==",u.tabela]),u.row_id_text&&p.push(["row_id","==",u.row_id_text]),u.row_id_search&&!u.row_id_text&&p.push(["row_id","==",u.row_id_search]),u.tipo?.length&&p.push(["type","==",u.tipo]),p},this.usuarioDao=t.get(G),this.entityService=t.get(pe),this.allPages=t.get(J),this.title=this.lex.translate("Logs das Altera\xE7\xF5es"),this.filter=this.fh.FormBuilder({relacoes:{default:[]},usuario_id:{default:""},data_inicio:{default:""},data_fim:{default:""},tabela:{default:""},tipo:{default:""},row_id:{default:""},row_id_text:{default:""},row_id_search:{default:""}}),this.orderBy=[["id","desc"]]}ngOnInit(){super.ngOnInit(),this.filter?.controls.row_id_text.setValue(this.urlParams?.get("id"))}carregaResposaveis(t){this.selectResponsaveis.loading=!0,this.dao?.showResponsaveis(t).then(i=>{this.responsaveis=i.map(e=>({key:e.id,value:e.nome}))}).finally(()=>this.selectResponsaveis.loading=!1)}montaRelacoes(t){this.relacoes=t[0]._metadata.relacoes.map(i=>({key:i,value:i}))}loadChanges(t){return B(this,null,function*(){if(t){this.changes=t;let i=this.changes.map(e=>e.user_id);i=Array.from(new Set(i)),this.carregaResposaveis(i),this.changes.length>1&&this.montaRelacoes(this.changes)}})}onRelacaoChange(t){let i=t.target.value,e=this.filter?.controls.relacoes.value||[];if(!e.includes(i))e.push(i);else{let l=e.indexOf(i);e.splice(l,1)}this.filter?.controls.relacoes.setValue(e)}filterClear(t){t.controls.usuario_id.setValue(""),t.controls.data_inicio.setValue(""),t.controls.data_fim.setValue(""),t.controls.tabela.setValue(""),t.controls.tipo.setValue(""),t.controls.opcao_filtro.setValue("ID do registro"),super.filterClear(t)}exportarCSV(){let t=this.changes.map(i=>ie(te({},i),{delta:JSON.stringify(i.delta)}));this.xlsx.exportJSON("logs",t)}};o.\u0275fac=function(i){return new(i||o)(f(D),f(L),f(fe))},o.\u0275cmp=S({type:o,selectors:[["app-change-list"]],viewQuery:function(i,e){if(i&1&&(h(_,5),h(Te,5),h(ze,5)),i&2){let l;v(l=g())&&(e.grid=l.first),v(l=g())&&(e.selectResponsaveis=l.first),v(l=g())&&(e.relacao=l.first)}},features:[F],decls:14,vars:26,consts:[["selectResponsaveis",""],[3,"dao","hasEdit","title","orderBy","groupBy","join","loadList"],["class","btn btn-outline-info me-2",3,"click",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xE1vel pelo registro","controlName","usuario_id",3,"control","items"],["datetime","","label","In\xEDcio","controlName","data_inicio","labelInfo","In\xEDcio dos registros",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim dos registros",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","tipo","itemTodos","Todos","valueTodos","",3,"size","control","items"],["id","accordionLogs",1,"accordion","mt-3"],["class","accordion-item",4,"ngFor","ngForOf"],[3,"rows"],[1,"btn","btn-outline-info","me-2",3,"click"],[1,"bi","bi-filetype-csv"],[1,"accordion-item"],[1,"accordion-header"],["type","button","aria-expanded","false",1,"accordion-button","collapsed"],[1,"d-flex","justify-content-start","align-items-center","m-0"],[1,"nome","me-2"],[1,"acao","me-2"],[3,"label","color"],[1,"tabela","me-2"],[1,"data"],[1,"accordion-collapse","collapse"],[1,"accordion-body"],[3,"json"]],template:function(i,e){i&1&&(s(0,"grid",1)(1,"toolbar"),y(2,Ne,3,0,"button",2),m(),s(3,"filter",3)(4,"div",4),c(5,"input-select",5,0),m(),s(7,"div",4),c(8,"input-datetime",6)(9,"input-datetime",7)(10,"input-select",8),m()(),s(11,"div",9),y(12,Ve,15,12,"div",10),m(),c(13,"pagination",11),m()),i&2&&(n("dao",e.dao)("hasEdit",!1)("title",e.isModal?"":e.title)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("loadList",e.loadChanges.bind(e)),r(2),n("ngIf",e.changes.length),r(),n("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),r(2),n("control",e.filter.controls.usuario_id)("items",e.responsaveis),r(3),n("size",4)("control",e.filter.controls.data_inicio),r(),n("size",4)("control",e.filter.controls.data_fim),r(),n("size",4)("control",e.filter.controls.tipo)("items",e.lookup.TIPO_LOG_CHANGE),r(2),n("ngForOf",e.changes),r(),n("rows",e.rowsLimit))},dependencies:[le,P,_,q,k,U,I,z,ve,ge]});let a=o;return a})();var w=class extends de{constructor(){super(),this.user=[],this.date_time="",this.message="",this.data="",this.trace="",this.type="ERROR"}};var be=(()=>{let o=class o extends X{constructor(t){super(t,w,T),this.injector=t,this.form=this.fh.FormBuilder({message:{default:""},data:{default:""},trace:{default:""},user_id:{default:""},user_email:{default:""},user_nome:{default:""},date_time:{default:null},type:{default:""}},this.cdRef)}ngOnInit(){super.ngOnInit()}loadData(t,i){let e=Object.assign({},i.value);i.patchValue(this.util.fillForm(e,t))}initializeData(t){t.patchValue(new w)}saveData(t){return new Promise((i,e)=>{let l=this.util.fill(new w,this.entity);i(this.util.fillForm(l,this.form.value))})}};o.\u0275fac=function(i){return new(i||o)(f(D))},o.\u0275cmp=S({type:o,selectors:[["error-form"]],viewQuery:function(i,e){if(i&1&&h(N,5),i&2){let l;v(l=g())&&(e.editableForm=l.first)}},features:[F],decls:15,vars:26,consts:[[3,"cancel","form","disabled","title"],[1,"row"],["label","Tipo de altera\xE7\xE3o","icon","bi bi-upc","controlName","type",3,"size","control"],["datetime","","label","Data do registro","controlName","date_time",3,"size","control"],["label","Respons\xE1vel pelo registro","icon","bi bi-upc","controlName","user_nome",3,"size","control"],["label","ID","icon","bi bi-upc","controlName","user_id",3,"size","control"],["label","E-mail","icon","bi bi-upc","controlName","user_email",3,"size","control"],["label","Mensagem","icon","bi bi-textarea-t","controlName","message",3,"size","rows","control"],["label","Dados","icon","bi bi-textarea-t","controlName","data",3,"size","rows","control"],["label","Trace","icon","bi bi-textarea-t","controlName","trace",3,"size","rows","control"]],template:function(i,e){i&1&&(s(0,"editable-form",0),A("cancel",function(){return e.onCancel()}),s(1,"div",1)(2,"div",1),c(3,"input-text",2)(4,"input-datetime",3),m(),s(5,"div",1),c(6,"input-text",4)(7,"input-text",5)(8,"input-text",6),m(),s(9,"div",1),c(10,"input-textarea",7),m(),s(11,"div",1),c(12,"input-textarea",8),m(),s(13,"div",1),c(14,"input-textarea",9),m()()()),i&2&&(n("form",e.form)("disabled",!0)("title",e.isModal?"":e.title),r(3),n("size",3)("control",e.form.controls.type),b("maxlength",250),r(),n("size",4)("control",e.form.controls.date_time),r(2),n("size",4)("control",e.form.controls.user_nome),b("maxlength",250),r(),n("size",4)("control",e.form.controls.user_id),b("maxlength",250),r(),n("size",4)("control",e.form.controls.user_email),b("maxlength",250),r(2),n("size",12)("rows",3)("control",e.form.controls.message),r(2),n("size",12)("rows",3)("control",e.form.controls.data),r(2),n("size",12)("rows",3)("control",e.form.controls.trace))},dependencies:[N,K,he,I]});let a=o;return a})();function Be(a,o){if(a&1&&(s(0,"span")(1,"small"),C(2),m()()),a&2){let d=o.row;r(2),E(d.user&&d.user.nome||"")}}function Me(a,o){if(a&1&&(s(0,"span")(1,"small"),C(2),m()()),a&2){let d=o.row,t=R();r(2),E(t.util.getDateTimeFormatted(d.date_time))}}function xe(a,o){if(a&1&&(s(0,"span")(1,"small"),C(2),m()()),a&2){let d=o.row;r(2),E(d.message.substr(0,200))}}function Ae(a,o){if(a&1&&c(0,"column",17),a&2){let d=R();n("dynamicButtons",d.dynamicButtons.bind(d))}}var Ce=(()=>{let o=class o extends W{constructor(t,i){super(t,w,T),this.injector=t,this.responsaveis=[],this.filterWhere=e=>{let l=[],p=e.value;return p.responsavel_id?.length&&l.push(["user_id","==",p.responsavel_id=="null"?null:p.responsavel_id]),p.data_inicio&&l.push(["date_time",">=",p.data_inicio]),p.data_fim&&l.push(["date_time","<=",p.data_fim]),p.type?.length&&l.push(["type","==",p.type]),l},this.usuarioDao=t.get(G),this.allPages=t.get(J),this.title=this.lex.translate("Logs dos Erros"),this.filter=this.fh.FormBuilder({type:{default:""},responsavel_id:{default:""},data_inicio:{default:null},data_fim:{default:null}}),this.orderBy=[["date_time","desc"]]}ngAfterViewInit(){return B(this,null,function*(){oe(o.prototype,this,"ngAfterViewInit").call(this),this.selectResponsaveis.loading=!0,this.dao?.showResponsaveis().then(t=>{this.responsaveis=t||[]}),this.cdRef.detectChanges(),this.selectResponsaveis.loading=!1})}filterClear(t){t.controls.responsavel_id.setValue(""),t.controls.data_inicio.setValue(""),t.controls.data_fim.setValue(""),t.controls.type.setValue("")}dynamicButtons(t){let i=[];return this.auth.hasPermissionTo("MOD_PENT")&&i.push({icon:"bi bi-info-circle",label:"Informa\xE7\xF5es",onClick:this.consult.bind(this)}),i}};o.\u0275fac=function(i){return new(i||o)(f(D),f(T))},o.\u0275cmp=S({type:o,selectors:[["error-list"]],viewQuery:function(i,e){if(i&1&&(h(_,5),h(z,5)),i&2){let l;v(l=g())&&(e.grid=l.first),v(l=g())&&(e.selectResponsaveis=l.first)}},features:[F],decls:22,vars:29,consts:[["selectResponsaveis",""],["columnUser",""],["columnDataCriacao",""],["columnMessage",""],[3,"dao","hasEdit","title","orderBy"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Respons\xE1vel pelo registro","controlName","responsavel_id","itemTodos","Todos","valueTodos","",3,"control","size","items"],["datetime","","label","In\xEDcio","controlName","data_inicio","labelInfo","In\xEDcio da pesquisa",3,"size","control"],["datetime","","label","Fim","controlName","data_fim","labelInfo","Fim da pesquisa",3,"size","control"],["label","Tipo","icon","bi bi-arrow-up-right-circle","controlName","type","itemTodos","Todos","valueTodos","",3,"size","control","items"],["title","Respons\xE1vel","field","user",3,"width","template"],["title","Criado em","field","date_time",3,"width","template"],["title","Mensagem","field","message",3,"width","template"],["title","Tipo","field","type"],["type","options",3,"dynamicButtons",4,"ngIf"],[3,"rows"],["type","options",3,"dynamicButtons"]],template:function(i,e){if(i&1&&(s(0,"grid",4),c(1,"toolbar"),s(2,"filter",5)(3,"div",6),c(4,"input-select",7,0)(6,"input-datetime",8)(7,"input-datetime",9)(8,"input-select",10),m()(),s(9,"columns")(10,"column",11),y(11,Be,3,1,"ng-template",null,1,j),m(),s(13,"column",12),y(14,Me,3,1,"ng-template",null,2,j),m(),s(16,"column",13),y(17,xe,3,1,"ng-template",null,3,j),m(),c(19,"column",14),y(20,Ae,1,1,"column",15),m(),c(21,"pagination",16),m()),i&2){let l=Q(12),p=Q(15),u=Q(18);n("dao",e.dao)("hasEdit",!1)("title",e.isModal?"":e.title)("orderBy",e.orderBy),r(2),n("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),r(2),n("control",e.filter.controls.responsavel_id)("size",4)("items",e.responsaveis),r(2),n("size",3)("control",e.filter.controls.data_inicio),r(),n("size",3)("control",e.filter.controls.data_fim),r(),n("size",2)("control",e.filter.controls.type)("items",e.lookup.TIPO_LOG_ERROR),r(2),n("width",80)("template",l),r(3),n("width",80)("template",p),r(3),n("width",80)("template",u),r(4),n("ngIf",!e.selectable),r(),n("rows",e.rowsLimit)}},dependencies:[P,_,ue,ce,q,k,U,I,z]});let a=o;return a})();var Qe=[{path:"change",component:ee,canActivate:[V],resolve:{config:O},runGuardsAndResolvers:"always",data:{title:"Logs das Altera\xE7\xF5es"}},{path:"change/:id/consult",component:ee,canActivate:[V],resolve:{config:O},runGuardsAndResolvers:"always",data:{title:"Consulta a Log de Altera\xE7\xE3o",modal:!0}},{path:"error",component:Ce,canActivate:[V],resolve:{config:O},runGuardsAndResolvers:"always",data:{title:"Logs dos Erros"}},{path:"error/:id/consult",component:be,canActivate:[V],resolve:{config:O},runGuardsAndResolvers:"always",data:{title:"Consulta a Log de Erro",modal:!0}}],we=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=x({type:o}),o.\u0275inj=M({imports:[H.forChild(Qe),H]});let a=o;return a})();var Wt=(()=>{let o=class o{};o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=x({type:o}),o.\u0275inj=M({imports:[se,_e,me,we,ye.forRoot()]});let a=o;return a})();export{Wt as a};
