import{a as Ce}from"./chunk-3OQ5NXFP.js";import{b as ae}from"./chunk-GEQ4G77C.js";import{a as L,b as M}from"./chunk-72ETMCRT.js";import{W as Te,b as Q,c as _e,f as ge,fa as De,h as Y,i as $,j as be,n as ve,r as Ee,s as ee,t as Ie,v as Pe,w as ye,x as Ae}from"./chunk-JEWU6XZO.js";import{b as Z,c as W,d as J,e as X,h as K,o as he,s as R}from"./chunk-OWVQDN4P.js";import"./chunk-P4ZMML75.js";import{Ac as Me,Bb as V,Fa as s,Fb as ne,Ga as d,Ha as p,La as B,Ma as I,Na as _,Nc as de,P as H,Sc as G,U as F,Ua as P,V as j,Va as y,Wa as A,Xa as g,Ya as h,Z as v,Za as x,_ as E,_a as O,ba as k,bd as w,ed as q,f as Le,h as C,ic as le,kb as S,kd as me,lb as N,ld as pe,ma as o,md as ue,na as z,oc as oe,pd as ce,sb as b,uc as se,va as U,xa as c,ya as D,za as n,zd as fe}from"./chunk-SDCVQHKS.js";var Ue=["unidade"],Be=["tipoAvaliacao"],xe=()=>({instituidora:!0}),Ve=i=>({filter:i}),qe=()=>["especie","==","TCR"],Qe=i=>[i],He=()=>["SEMANAL","QUINZENAL"],je=()=>["MENSAL","BIMESTRAL","TRIMESTRAL","SEMESTRAL"],Ge=()=>["DIAS"];function Ze(i,l){if(i&1&&p(0,"input-select",36),i&2){let m=_();n("size",3)("control",m.form.controls.periodicidade_valor)("items",m.lookup.DIA_SEMANA)}}function We(i,l){if(i&1&&p(0,"input-number",37),i&2){let m=_();n("size",3)("control",m.form.controls.periodicidade_valor)}}function Je(i,l){if(i&1&&p(0,"input-number",38),i&2){let m=_();n("size",3)("control",m.form.controls.periodicidade_valor)}}var ie=(()=>{let l=class l extends Ce{constructor(a){super(a,q,w),this.injector=a,this._tipoAvaliacaoQualitativo=[],this.validate=(t,e)=>{let r=null;return["nome","unidade_id","tipo_avaliacao_plano_trabalho_id","tipo_avaliacao_plano_entrega_id"].indexOf(e)>=0&&!t.value?.length?r="Obrigat\xF3rio":e=="prazo_max_plano_entrega"&&parseInt(t.value||0)>99999||["data_inicio","data_fim"].indexOf(e)>=0&&!this.dao?.validDateTime(t.value)?r="Inv\xE1lido":e=="periodicidade_valor"&&(["SEMANAL","QUINZENAL"].includes(this.form?.controls.periodicidade_consolidacao.value)&&t.value>6&&(r="Inv\xE1lido"),["MENSAL","BIMESTRAL","TRIMESTRAL","SEMESTRAL"].includes(this.form?.controls.periodicidade_consolidacao.value)&&t.value>31&&(r="M\xE1ximo 31"),["DIAS"].includes(this.form?.controls.periodicidade_consolidacao.value)&&t.value<0&&(r="Inv\xE1lido")),r},this.formValidation=t=>{let e=null;return this.form?.controls.data_fim.value&&this.form?.controls.data_inicio.value>this.form?.controls.data_fim.value&&(e="A data do fim n\xE3o pode ser anterior \xE0 data do inicio!"),e},this.titleEdit=t=>"Editando "+this.lex.translate("Programa")+": "+(t?.nome||""),this.unidadeDao=a.get(G),this.templateDao=a.get(ce),this.tipoDocumentoDao=a.get(pe),this.tipoAvaliacaoDao=a.get(me),this.tipoJustificativaDao=a.get(ue),this.templateService=a.get(he),this.modalWidth=700,this.form=this.fh.FormBuilder({unidade_id:{default:""},nome:{default:""},normativa:{default:""},link_normativa:{default:null},config:{default:null},data_inicio:{default:new Date},data_fim:{default:new Date},template_tcr_id:{default:null},tipo_avaliacao_plano_entrega_id:{default:""},tipo_avaliacao_plano_trabalho_id:{default:""},tipo_documento_tcr_id:{default:null},prazo_max_plano_entrega:{default:365},termo_obrigatorio:{default:!0},periodicidade_consolidacao:{default:"MENSAL"},periodicidade_valor:{default:1},dias_tolerancia_consolidacao:{default:10},registra_comparecimento:{default:!0},plano_trabalho_assinatura_participante:{default:!0},plano_trabalho_assinatura_gestor_lotacao:{default:!0},plano_trabalho_assinatura_gestor_unidade:{default:!0},plano_trabalho_assinatura_gestor_entidade:{default:!1},checklist_avaliacao_entregas_plano_trabalho:{default:[]},checklist_plano_trabalho_texto:{default:""},checklist_avaliacao_entregas_plano_entrega:{default:[]},checklist_plano_entrega_texto:{default:""},plano_trabalho_criterios_avaliacao:{default:[]},plano_trabalho_criterio_avaliacao:{default:""},dias_tolerancia_avaliacao:{default:20},dias_tolerancia_recurso_avaliacao:{default:10},nota_padrao_avaliacao:{default:0},tipo_justificativa_id:{default:null}},this.cdRef,this.validate),this.join=["unidade"]}loadData(a,t){return C(this,null,function*(){let e=Object.assign({},t.value);yield Promise.all([this.unidade.loadSearch(a.unidade||a.unidade_id)]),a.plano_trabalho_criterios_avaliacao=a.plano_trabalho_criterios_avaliacao||[],a.checklist_avaliacao_entregas_plano_entrega=a.checklist_avaliacao_entregas_plano_entrega||[],a.checklist_avaliacao_entregas_plano_trabalho=a.checklist_avaliacao_entregas_plano_trabalho||[],t.patchValue(this.util.fillForm(e,a))})}initializeData(a){a.patchValue(new q)}saveData(a){return new Promise((t,e)=>{let r=this.util.fill(new q,this.entity);t(this.util.fillForm(r,this.form.value))})}isTipoAvaliacao(a){let t=this.tipoAvaliacao?.selectedEntity;return t?.tipo==a||!t&&a=="QUANTITATIVO"}get tipoAvaliacaoQualitativo(){let t=this.tipoAvaliacao?.selectedEntity?.notas?.map(e=>Object.assign({},{key:e.nota,value:e.nota}))||[];return JSON.stringify(t)!=JSON.stringify(this._tipoAvaliacaoQualitativo)&&(this._tipoAvaliacaoQualitativo=t),this._tipoAvaliacaoQualitativo}addItemHandlePlanoEntregaChecklist(){let a,t=this.form.controls.checklist_plano_entrega_texto.value,e=this.util.textHash(t);return t?.length&&this.util.validateLookupItem(this.form.controls.checklist_avaliacao_entregas_plano_entrega.value,e)&&(a={key:e,value:this.form.controls.checklist_plano_entrega_texto.value},this.form.controls.checklist_plano_entrega_texto.setValue("")),a}onClickIN(){this.form?.controls.link_normativa?.value?.length&&window.open(this.form?.controls.link_normativa.value)}};l.\u0275fac=function(t){return new(t||l)(z(k))},l.\u0275cmp=F({type:l,selectors:[["app-programa-form"]],viewQuery:function(t,e){if(t&1&&(P(ee,5),P(Ue,5),P(Be,5)),t&2){let r;y(r=A())&&(e.editableForm=r.first),y(r=A())&&(e.unidade=r.first),y(r=A())&&(e.tipoAvaliacao=r.first)}},features:[U],decls:42,vars:82,consts:[["unidade",""],["tipoAvaliacaoEntrega",""],["tipoDocumento",""],["tipoAvaliacao",""],["initialFocus","unidade_id",3,"submit","cancel","form","disabled","title"],["display","","right",""],["key","GERAL","label","Geral"],[1,"row"],["label","Unidade Instituidora","controlName","unidade_id","required","",3,"size","dao","selectParams"],["date","","label","Data de In\xEDcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","Data de in\xEDcio da vig\xEAncia do programa de gest\xE3o na unidade instituidora",3,"size","control"],["date","","label","Data de Fim","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Data de fim da vig\xEAncia do programa de gest\xE3o na unidade instituidora",3,"size","control"],["label","Dura\xE7\xE3o M\xE1x P.E.","icon","bi bi-blockquote-left","controlName","prazo_max_plano_entrega","labelInfo","Limite m\xE1ximo de dias corridos para a dura\xE7\xE3o do plano de entregas a partir da sua data de cria\xE7\xE3o (Zero para n\xE3o limitar)",3,"size","control"],["label","T\xEDtulo","icon","bi bi-textarea-t","controlName","nome","required","",3,"size","control"],["label","Normativa","icon","bi bi-blockquote-left","controlName","normativa","labelInfo","Normativa que regula o Programa",3,"size","control"],["iconButton","bi bi-box-arrow-up-right","label","Link Normativa","icon","bi bi-link-45deg","controlName","link_normativa","labelInfo","Link web da instru\xE7\xE3o normativa",3,"buttonClick","size","control"],["key","PLANO_ENTREGA",3,"label"],["controlName","tipo_avaliacao_plano_entrega_id","required","",3,"label","size","dao","labelInfo"],[3,"title"],["label","Checklists das entregas","controlName","checklist_avaliacao_entregas_plano_entrega",3,"size","addItemHandle"],["controlName","checklist_plano_entrega_texto",3,"size"],["key","PLANO_TRABALHO",3,"label"],["scale","small","labelPosition","right","controlName","termo_obrigatorio","label","Se o termo \xE9 obrigat\xF3rio",3,"size","disabled"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_participante",3,"size","label","disabled"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_gestor_lotacao",3,"size","label","disabled"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_gestor_unidade",3,"size","label","disabled"],["scale","small","labelPosition","right","controlName","plano_trabalho_assinatura_gestor_entidade",3,"size","label","disabled"],["detailsButton","","labelInfo","Template do termo utilizado no plano de trabalho","controlName","template_tcr_id","required","",3,"details","label","size","dao","where","selectRoute"],["controlName","tipo_documento_tcr_id","labelInfo","Tipo de documento utilizado para exportar o termo para o SEI/SUPER",3,"label","size","dao"],["controlName","tipo_avaliacao_plano_trabalho_id","required","",3,"label","size","dao","labelInfo"],["label","Periodicidade","controlName","periodicidade_consolidacao","labelInfo","Per\xEDodo para avalia\xE7\xE3o do plano de trabalho",3,"size","control","items"],["label","Dia da semana","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xEAs para o restante",3,"size","control","items",4,"ngIf"],["label","Dia do m\xEAs","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xEAs para o restante",3,"size","control",4,"ngIf"],["label","Qtd. de Dias","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xEAs para o restante",3,"size","control",4,"ngIf"],["label","Toler\xE2ncia","controlName","dias_tolerancia_consolidacao","labelInfo","Dias de toler\xE2ncia para o lan\xE7amento do registro das atividades na consolida\xE7\xE3o, ap\xF3s esses dias ser\xE1 liberado automaticamente para avalia\xE7\xE3o",3,"size","control"],["label","Toler\xE2ncia p/ avalia\xE7\xE3o","controlName","dias_tolerancia_avaliacao","labelInfo","Dias de toler\xE2ncia para realizar a avalia\xE7\xE3o, considerando a toler\xE2ncia da consolida\xE7\xE3o. Caso seja zero n\xE3o far\xE1 nada, caso contr\xE1rio ap\xF3s esse prazo a consolida\xE7\xE3o ser\xE1 automaticamente avaliada com a nota padr\xE3o",3,"size","control","disabled"],["label","Toler\xE2ncia p/ recurso","controlName","dias_tolerancia_recurso_avaliacao","labelInfo","Dias de toler\xE2ncia para recorrer da avalia\xE7\xE3o",3,"size","control","disabled"],["label","Dia da semana","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xEAs para o restante",3,"size","control","items"],["label","Dia do m\xEAs","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xEAs para o restante",3,"size","control"],["label","Qtd. de Dias","controlName","periodicidade_valor","labelInfo","Representa quantidade de dias para DIAS; dia da semana para SEMANAL e QUINZENAL; e dia do m\xEAs para o restante",3,"size","control"]],template:function(t,e){if(t&1){let r=B();s(0,"editable-form",4),I("submit",function(){return v(r),E(e.onSaveData())})("cancel",function(){return v(r),E(e.onCancel())}),s(1,"tabs",5)(2,"tab",6)(3,"div",7),p(4,"input-search",8,0),d(),s(6,"div",7),p(7,"input-datetime",9)(8,"input-datetime",10)(9,"input-number",11),d(),s(10,"div",7),p(11,"input-text",12)(12,"input-text",13),s(13,"input-button",14),I("buttonClick",function(){return v(r),E(e.onClickIN())}),d()()(),s(14,"tab",15),p(15,"input-search",16,1),s(17,"separator",17)(18,"input-multiselect",18),p(19,"input-text",19),d()()(),s(20,"tab",20),p(21,"input-switch",21)(22,"input-switch",22)(23,"input-switch",23)(24,"input-switch",24)(25,"input-switch",25),s(26,"input-search",26),I("details",function(f){return v(r),E(e.templateService.details(f))}),d(),p(27,"input-search",27,2)(29,"input-search",28,3),s(31,"separator",17)(32,"div",7),p(33,"input-select",29),c(34,Ze,1,3,"input-select",30)(35,We,1,2,"input-number",31)(36,Je,1,2,"input-number",32),p(37,"input-number",33),d()(),s(38,"separator",17)(39,"div",7),p(40,"input-number",34)(41,"input-number",35),d()()()()()}t&2&&(n("form",e.form)("disabled",e.formDisabled)("title",e.isModal?"":e.title),o(4),n("size",12)("dao",e.unidadeDao)("selectParams",N(74,Ve,S(73,xe))),o(3),n("size",4)("control",e.form.controls.data_inicio),o(),n("size",4)("control",e.form.controls.data_fim),o(),n("size",4)("control",e.form.controls.prazo_max_plano_entrega),o(2),n("size",4)("control",e.form.controls.nome),D("maxlength",250),o(),n("size",4)("control",e.form.controls.normativa),D("maxlength",250),o(),n("size",4)("control",e.form.controls.link_normativa),o(),n("label",e.lex.translate("Plano de entrega")),o(),n("label",e.lex.translate("Tipo de avalia\xE7\xE3o do Plano de entrega"))("size",12)("dao",e.tipoAvaliacaoDao)("labelInfo",e.lex.translate("Tipo de avalia\xE7\xE3o")+" que especifica a forma que ser\xE1 avaliado "+e.lex.translate("plano de trabalho")+" e "+e.lex.translate("plano de entrega")),o(2),n("title",e.lex.translate("Avalia\xE7\xE3o")+e.lex.translate(" do Plano de Entrega")),o(),n("size",12)("addItemHandle",e.addItemHandlePlanoEntregaChecklist.bind(e)),o(),n("size",12),D("maxlength",250),o(),n("label",e.lex.translate("Plano de trabalho")),o(),n("size",12)("disabled",e.util.isDeveloper()?void 0:"true"),o(),n("size",12)("label","Exige assinatura "+e.lex.translate("do usu\xE1rio")+e.lex.translate(" do plano de trabalho"))("disabled",e.util.isDeveloper()?void 0:"true"),o(),n("size",12)("label","Exige assinatura do gestor da lota\xE7\xE3o "+e.lex.translate("do usu\xE1rio")+" (para "+e.lex.translate("unidade")+" distinta)")("disabled",e.util.isDeveloper()?void 0:"true"),o(),n("size",12)("label","Exige assinatura do gestor "+e.lex.translate("da unidade"))("disabled",e.util.isDeveloper()?void 0:"true"),o(),n("size",12)("label","Exige assinatura do gestor "+e.lex.translate("da entidade"))("disabled",e.util.isDeveloper()?void 0:"true"),o(),n("label","Template "+e.lex.translate("termo")+" (TCR)")("size",12)("dao",e.templateDao)("where",N(77,Qe,S(76,qe)))("selectRoute",e.templateService.selectRoute("TCR",e.form==null||e.form.controls==null||e.form.controls.template_tcr_id==null?null:e.form.controls.template_tcr_id.value)),o(),n("label","Tipo de documento "+e.lex.translate("termo"))("size",12)("dao",e.tipoDocumentoDao),o(2),n("label",e.lex.translate("Tipo de avalia\xE7\xE3o do Plano de trabalho"))("size",12)("dao",e.tipoAvaliacaoDao)("labelInfo",e.lex.translate("Tipo de avalia\xE7\xE3o")+" que especifica a forma que ser\xE1 avaliado "+e.lex.translate("plano de trabalho")+" e "+e.lex.translate("plano de entrega")),o(2),n("title",e.lex.translate("Consolida\xE7\xE3o")+e.lex.translate(" do Plano de trabalho")),o(2),n("size",6)("control",e.form.controls.periodicidade_consolidacao)("items",e.lookup.PERIODICIDADE_CONSOLIDACAO),o(),n("ngIf",S(79,He).includes(e.form.controls.periodicidade_consolidacao.value)),o(),n("ngIf",S(80,je).includes(e.form.controls.periodicidade_consolidacao.value)),o(),n("ngIf",S(81,Ge).includes(e.form.controls.periodicidade_consolidacao.value)),o(),n("size",3)("control",e.form.controls.dias_tolerancia_consolidacao),o(),n("title",e.lex.translate("Avalia\xE7\xE3o")+e.lex.translate(" da Consolida\xE7\xE3o")),o(2),n("size",6)("control",e.form.controls.dias_tolerancia_avaliacao)("disabled",e.util.isDeveloper()?void 0:"true"),o(),n("size",6)("control",e.form.controls.dias_tolerancia_recurso_avaliacao)("disabled",e.util.isDeveloper()?void 0:"true"))},dependencies:[V,ee,ve,Y,_e,Q,ge,$,be,Ae,ye,Ie,Ee]});let i=l;return i})();var ta=i=>({metadata:i});function ia(i,l){i&1&&p(0,"toolbar")}function oa(i,l){if(i&1&&(s(0,"span"),h(1),d(),p(2,"br"),s(3,"small"),h(4),d()),i&2){let m=l.row;o(),O(" ",m.nome,""),o(3),O(" ",m.normativa,"")}}function ra(i,l){if(i&1&&(s(0,"span"),h(1),d(),p(2,"br"),s(3,"small"),h(4),d()),i&2){let m=l.row;o(),O(" ",m.unidade.nome,""),o(3),O(" ",m.unidade.sigla,"")}}function na(i,l){if(i&1&&(s(0,"span"),h(1),d(),p(2,"br")),i&2){let m=l.row,a=_();o(),O(" ",a.dao.getDateFormatted(m.data_inicio),"")}}function la(i,l){if(i&1&&(s(0,"span"),h(1),d()),i&2){let m=l.row,a=_();o(),O(" ",a.dao.getDateFormatted(m.data_fim),"")}}var we=(()=>{let l=class l extends ae{constructor(a,t){super(a,q,w),this.injector=a,this.vigentesUnidadeExecutora=!1,this.todosUnidadeExecutora=!1,this.filterWhere=e=>{let r=[],u=e.value;return this.vigentesUnidadeExecutora&&r.push(["vigentesUnidadeExecutora","==",this.auth.unidade.id]),(this.todosUnidadeExecutora||!this.util.isDeveloper())&&r.push(["todosUnidadeExecutora","==",this.auth.unidade.id]),u.nome?.length&&r.push(["nome","like","%"+u.nome.trim().replace(" ","%")+"%"]),r},this.title=this.lex.translate("Programas de Gest\xE3o"),this.code="MOD_PRGT",this.join=["unidade:id, nome"],this.filter=this.fh.FormBuilder({nome:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_PRGT_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG"),this.auth.hasPermissionTo("MOD_PART")&&this.options.push({icon:"bi bi-people",label:"Participantes",onClick:e=>this.go.navigate({route:["gestao","programa",e.id,"participantes"]},{metadata:{programa:e}})})}ngOnInit(){super.ngOnInit(),this.vigentesUnidadeExecutora=this.metadata?.vigentesUnidadeExecutora,this.todosUnidadeExecutora=this.metadata?.todosUnidadeExecutora}};l.\u0275fac=function(t){return new(t||l)(z(k),z(w))},l.\u0275cmp=F({type:l,selectors:[["app-programa-list"]],viewQuery:function(t,e){if(t&1&&P(R,5),t&2){let r;y(r=A())&&(e.grid=r.first)}},features:[U],decls:20,vars:31,consts:[["columnTituloNormativa",""],["columnUnidadeInstituidora",""],["columnInicioVigencia",""],["columnFimVigencia",""],[3,"select","dao","add","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","addMetadata"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","nome",3,"size","label","control","placeholder"],["title","T\xEDtulo/Normativa",3,"template"],["title","Unidade instituidora",3,"template"],["title","In\xEDcio da Vig\xEAncia",3,"template"],["title","Fim da Vig\xEAncia",3,"template"],["type","options",3,"onEdit","options"],[3,"rows"]],template:function(t,e){if(t&1){let r=B();s(0,"grid",4),I("select",function(f){return v(r),E(e.onSelect(f))}),c(1,ia,1,0,"toolbar",5),s(2,"filter",6)(3,"div",7),p(4,"input-text",8),d()(),s(5,"columns")(6,"column",9),c(7,oa,5,2,"ng-template",null,0,b),d(),s(9,"column",10),c(10,ra,5,2,"ng-template",null,1,b),d(),s(12,"column",11),c(13,na,3,1,"ng-template",null,2,b),d(),s(15,"column",12),c(16,la,2,1,"ng-template",null,3,b),d(),p(18,"column",13),d(),p(19,"pagination",14),d()}if(t&2){let r=g(8),u=g(11),f=g(14),T=g(17);n("dao",e.dao)("add",e.add)("title",e.isModal?"":e.title)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("hasAdd",e.auth.hasPermissionTo("MOD_PRGT_INCL"))("hasEdit",e.auth.hasPermissionTo("MOD_PRGT_EDT"))("addMetadata",N(29,ta,e.todosUnidadeExecutora)),o(),n("ngIf",!e.selectable),o(),n("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),o(2),n("size",12)("label","Nome do "+e.lex.translate("programa"))("control",e.filter.controls.nome)("placeholder","Nome do "+e.lex.translate("programa")),D("maxlength",250),o(2),n("template",r),o(3),n("template",u),o(3),n("template",f),o(3),n("template",T),o(3),n("onEdit",e.edit)("options",e.options),o(),n("rows",e.rowsLimit)}},dependencies:[V,R,J,W,X,Z,K,Q]});let i=l;return i})();var Re=Le(Me());var sa=["programaSearch"],da=i=>["vigentesUnidadeExecutora","==",i],ma=i=>[i],pa=()=>({vigentesUnidadeExecutora:!0});function ua(i,l){i&1&&p(0,"toolbar")}function ca(i,l){if(i&1&&(s(0,"div",21)(1,"span")(2,"strong"),h(3),d()()()),i&2){let m=_();o(3),x("Programa: "+(m.programa==null?null:m.programa.nome)||"")}}function fa(i,l){if(i&1&&p(0,"profile-picture",22),i&2){let m=l.row;n("url",m.url_foto)("size",40)("hint",m.nome)}}function ha(i,l){if(i&1&&(s(0,"strong"),h(1),d(),p(2,"br"),s(3,"small"),h(4),d()),i&2){let m=l.row;o(),x(m.nome),o(3),x(m.apelido)}}function _a(i,l){if(i&1&&p(0,"badge",23),i&2){let m=l.row,a=_();n("icon",a.isHabilitado(m)?"bi bi-person-check":"bi-person-fill-slash")("label",a.isHabilitado(m)?a.lex.translate("Habilitado"):a.lex.translate("Desabilitado"))("color",a.isHabilitado(m)?"success":"danger")}}function ga(i,l){if(i&1&&(s(0,"span"),h(1),d()),i&2){let m=l.row;o(),x(m.lotacao.unidade.sigla)}}function ba(i,l){if(i&1&&(s(0,"span"),h(1),d()),i&2){let m=l.row,a=_();o(),x(a.hasPlanoTrabalhoAtivo(m)?"sim":"n\xE3o")}}var re=(()=>{let l=class l extends ae{constructor(a){super(a,se,de),this.injector=a,this.multiselectMenu=[],this.programa=null,this.BOTAO_HABILITAR={label:this.lex.translate("Habilitar"),hint:this.lex.translate("Habilitar"),icon:"bi bi-person-check-fill",color:"btn-outline-success",onClick:this.habilitarParticipante.bind(this)},this.BOTAO_DESABILITAR={label:this.lex.translate("Desabilitar"),hint:this.lex.translate("Desabilitar"),icon:"bi bi-person-x-fill",color:"btn-outline-danger",onClick:this.desabilitarParticipante.bind(this)},this.condicoes=[{key:"1",value:this.lex.translate("Habilitados")},{key:"0",value:this.lex.translate("Desabilitados")}],this.validate=(t,e)=>{let r=null;return["programa_id"].indexOf(e)>=0&&!t.value?.length&&(r="Obrigat\xF3rio"),r},this.filterWhere=t=>{let e=[],r=t.value;return r.unidade_id?.length&&e.push(["lotacao","==",r.unidade_id]),r.nome_usuario?.length&&e.push(["nome","like","%"+r.nome_usuario.trim().replace(" ","%")+"%"]),e.push(["habilitado","==",this.filter?.controls.habilitados.value]),e.push(["programa_id","==",this.programa?.id||this.metadata?.programa.id]),e},this.unidadeDao=a.get(G),this.programaParticipanteDao=a.get(fe),this.programaDao=a.get(w),this.code="MOD_PART",this.filter=this.fh.FormBuilder({programa_id:{default:this.programa?.id},unidade_id:{default:this.auth.unidade?.id},nome_usuario:{default:""},habilitados:{default:"0"}},this.cdRef,this.validate),this.auth.hasPermissionTo("MOD_PART_HAB")&&this.multiselectMenu.push({icon:"bi bi-person-check-fill",label:this.lex.translate("Habilitar"),color:"btn-outline-success",onClick:this.habilitarParticipantes.bind(this)}),this.auth.hasPermissionTo("MOD_PART_DESAB")&&this.multiselectMenu.push({icon:"bi bi-person-x-fill",label:this.lex.translate("Desabilitar"),color:"btn-outline-danger",onClick:this.desabilitarParticipantes.bind(this)}),this.join=["lotacao.unidade:id,sigla","planos_trabalho:id,status","participacoes_programas:id"],this.title=this.lex.translate("Habilita\xE7\xF5es"),this.orderBy=[["nome","asc"]]}dynamicButtons(a){let t=[];return this.auth.hasPermissionTo("MOD_PART_HAB")&&!this.isHabilitado(a)&&t.push(this.BOTAO_HABILITAR),this.auth.hasPermissionTo("MOD_PART_DESAB")&&this.isHabilitado(a)&&t.push(this.BOTAO_DESABILITAR),t}ngAfterViewInit(){super.ngAfterViewInit(),this.grid.BUTTON_MULTISELECT_SELECIONAR="Marcar",this.grid.BUTTON_MULTISELECT_CANCELAR_SELECAO="Cancelar Marca\xE7\xE3o",this.grid.BUTTON_MULTISELECT.label="Marcar",C(this,null,function*(){this.loading=!0;try{this.programa=this.metadata?.programa,this.programa||(yield this.programaDao.query({where:[["vigentesUnidadeExecutora","==",this.auth.unidade.id]]}).asPromise().then(a=>{this.programa=a[0]}))}finally{this.programaSearch?.loadSearch(this.programa),this.loading=!1}})}filterClear(a){a.controls.unidade_id.setValue(void 0),a.controls.nome_usuario.setValue(""),a.controls.habilitados.setValue("1")}habilitarParticipante(a){return C(this,null,function*(){return yield this.programaParticipanteDao.habilitar([a.id],this.programa.id,1,!1).then(t=>{(this.grid?.query||this.query).refreshId(a.id),this.cdRef.detectChanges()}),!1})}desabilitarParticipante(a){return C(this,null,function*(){if(yield this.dialog.confirm("Desabilitar ?","Deseja DESABILITAR "+this.lex.translate("o servidor")+" "+a.nome.toUpperCase()+" "+this.lex.translate("do programa")+" "+(this.programa?.nome).toUpperCase()+" ?")){let e=!1;this.hasPlanoTrabalhoAtivo(a)&&(e=yield this.dialog.confirm("ATEN\xC7\xC3O",this.lex.translate("O servidor")+" possui "+this.lex.translate("Plano de Trabalho")+" ativo vinculado a "+this.lex.translate("este Programa")+"! Deseja continuar com a desabilita\xE7\xE3o, suspendendo o seu "+this.lex.translate("Plano de Trabalho ?"))),(!this.hasPlanoTrabalhoAtivo(a)||e)&&(yield this.programaParticipanteDao.habilitar([a.id],this.programa.id,0,e).then(r=>{(this.grid?.query||this.query).refreshId(a.id),this.cdRef.detectChanges()}))}})}habilitarParticipantes(){return C(this,null,function*(){if(!this.grid.multiselectedCount)this.dialog.alert("Selecione","Nenhum participante selecionado para a habilita\xE7\xE3o");else{let a=this;this.dialog.confirm("Habilitar Participantes ?","Confirma a habilita\xE7\xE3o de todos esses participantes?").then(t=>{if(t){let e=Object.values(this.grid.multiselected).map(r=>r.id);this.programaParticipanteDao.habilitar(e,this.programa.id,1,!1).then(function(){a.dialog.topAlert("Participantes habilitados com sucesso!",5e3),(a.grid?.query||a.query).refresh()}).catch(function(r){a.dialog.alert("Erro","Erro ao habilitar os participantes: "+r?.message?r?.message:r)}),this.grid?.enableMultiselect(!1),a.cdRef.detectChanges()}})}})}desabilitarParticipantes(){return C(this,null,function*(){let a=Object.keys(this.grid.multiselected);this.dialog.confirm("Desabilitar ?","Deseja DESABILITAR, "+this.lex.translate("do programa")+" "+(this.programa?.nome).toUpperCase()+" todos "+this.lex.translate("os usu\xE1rios")+" selecionados ?").then(t=>C(this,null,function*(){if(t){let e=this,r=0;yield this.programaParticipanteDao.quantidadePlanosTrabalhoAtivos(a).then(f=>{r=f});let u=!1;if(r&&(yield this.dialog.confirm("ATEN\xC7\xC3O","H\xE1 "+r+this.lex.translate(r==1?" usu\xE1rio":" usu\xE1rios")+" com "+this.lex.translate("Plano de Trabalho")+" ativo vinculado a "+this.lex.translate("este Programa")+"! Deseja continuar com a desabilita\xE7\xE3o, suspendendo "+(r==1?"o seu ":"todos ")+this.lex.translate(r==1?"Plano de Trabalho":"os Planos de Trabalho")+" ?").then(f=>{u=f})),!r||u){let f=Object.values(this.grid.multiselected).map(T=>T.id);this.programaParticipanteDao.habilitar(f,this.programa.id,0,u).then(T=>{e.dialog.topAlert("Participantes desabilitados com sucesso!",5e3),(this.grid?.query||this.query).refresh()}).catch(function(T){e.grid&&(e.grid.error=T)}),this.grid?.enableMultiselect(!1),this.cdRef.detectChanges()}}}))})}onProgramaChange(){this.programa=this.programaSearch?.selectedItem?.entity,this.programa&&this.grid?.reloadFilter()}isHabilitado(a){return!!a.participacoes_programas.find(t=>t.habilitado==1&&t.programa_id==this.programa?.id)}hasPlanoTrabalhoAtivo(a){return!!a.planos_trabalho?.find(t=>t.status=="ATIVO"&&this.util.between((0,Re.now)(),{start:t.data_inicio,end:t.data_fim}))}};l.\u0275fac=function(t){return new(t||l)(z(k))},l.\u0275cmp=F({type:l,selectors:[["app-programa-participantes"]],viewQuery:function(t,e){if(t&1&&(P(R,5),P(sa,5)),t&2){let r;y(r=A())&&(e.grid=r.first),y(r=A())&&(e.programaSearch=r.first)}},features:[U],decls:30,vars:59,consts:[["programaSearch",""],["unidade",""],["columnFoto",""],["columnUsuario",""],["columnHabilitado",""],["columnLotacao",""],["columnPlanoTrabalho",""],["multiselect","","editable","",3,"select","dao","title","orderBy","groupBy","join","selectable","hasAdd","hasEdit","hasDelete","multiselectMenu"],[4,"ngIf"],[3,"deleted","form","where","clear","submit","collapseChange","collapsed"],[1,"row"],["controlName","programa_id","required","",3,"change","size","disabled","control","dao","where","metadata","value"],["controlName","habilitados","itemTodos","- Todos -",3,"size","items","label","control","valueTodos"],["controlName","nome_usuario",3,"size","label","control","placeholder"],["controlName","unidade_id",3,"size","control","label","labelInfo","dao"],["class","mt-2 mb-4",4,"ngIf"],["icon","bi-person",1,"text-center",3,"template"],[3,"title","template"],[3,"title","align","template"],["type","options",3,"dynamicButtons"],[3,"rows"],[1,"mt-2","mb-4"],[3,"url","size","hint"],[3,"icon","label","color"]],template:function(t,e){if(t&1){let r=B();s(0,"grid",7),I("select",function(f){return v(r),E(e.onSelect(f))}),c(1,ua,1,0,"toolbar",8),s(2,"filter",9)(3,"div",10)(4,"input-search",11,0),I("change",function(){return v(r),E(e.onProgramaChange())}),d(),p(6,"input-select",12),d(),s(7,"div",10),p(8,"input-text",13)(9,"input-search",14,1),d()(),c(11,ca,4,1,"div",15),s(12,"columns")(13,"column",16),c(14,fa,1,3,"ng-template",null,2,b),d(),s(16,"column",17),c(17,ha,5,2,"ng-template",null,3,b),d(),s(19,"column",18),c(20,_a,1,3,"ng-template",null,4,b),d(),s(22,"column",17),c(23,ga,2,1,"ng-template",null,5,b),d(),s(25,"column",18),c(26,ba,2,1,"ng-template",null,6,b),d(),p(28,"column",19),d(),p(29,"pagination",20),d()}if(t&2){let r=g(15),u=g(18),f=g(21),T=g(24),Oe=g(27);n("dao",e.dao)("title",e.isModal?"":e.title)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("hasAdd",!1)("hasEdit",!1)("hasDelete",!1)("multiselectMenu",e.multiselectMenu),o(),n("ngIf",!e.selectable),o(),n("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("clear",e.filterClear.bind(e))("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),o(2),n("size",8)("disabled",e.isModal?"true":void 0)("control",e.filter.controls.programa_id)("dao",e.programaDao)("where",N(56,ma,N(54,da,e.auth.unidade.id)))("metadata",S(58,pa))("value",e.programa==null?null:e.programa.nome),o(2),n("size",4)("items",e.condicoes)("label","Situa\xE7\xE3o "+e.lex.translate("no programa"))("control",e.filter.controls.habilitados)("valueTodos",null),o(2),n("size",6)("label","Nome do "+e.lex.translate("usu\xE1rio"))("control",e.filter.controls.nome_usuario)("placeholder","Nome do "+e.lex.translate("usuario")+"..."),D("maxlength",250),o(),n("size",6)("control",e.filter.controls.unidade_id)("label",e.lex.translate("Unidade ")+e.lex.translate("de lota\xE7\xE3o"))("labelInfo","Se a op\xE7\xE3o TODOS estiver OFF, exibe apenas "+e.lex.translate("os usu\xE1rios")+" habilitados lotados "+e.lex.translate("nessa unidade")+". Se a op\xE7\xE3o TODOS estiver ON, exibe todos "+e.lex.translate("os usu\xE1rios")+" lotados "+e.lex.translate("nessa unidade")+", habilitados, desabilitados e inabilitados.")("dao",e.unidadeDao),o(2),n("ngIf",e.grid==null||e.grid.filterRef==null?null:e.grid.filterRef.collapsed),o(2),n("template",r),o(3),n("title",e.lex.translate("Usu\xE1rio"))("template",u),o(3),n("title",e.lex.translate("Habilitado"))("align","center")("template",f),o(3),n("title",e.lex.translate("Lota\xE7\xE3o"))("template",T),o(3),n("title",e.lex.translate("Plano de Trabalho")+" ativo?")("align","center")("template",Oe),o(3),n("dynamicButtons",e.dynamicButtons.bind(e)),o(),n("rows",e.rowsLimit)}},dependencies:[V,R,J,W,X,Z,K,Y,Q,$,Pe,Te],styles:[".habilitado[_ngcontent-%COMP%]{background:#198754;border:2px solid #1B5E20}.desabilitado[_ngcontent-%COMP%]{background:#dc3545;border:2px solid #B71C1C}"]});let i=l;return i})();var va=[{path:"",component:we,canActivate:[L],resolve:{config:M},runGuardsAndResolvers:"always",data:{title:"Programas"}},{path:"new",component:ie,canActivate:[L],resolve:{config:M},runGuardsAndResolvers:"always",data:{title:"Inclus\xE3o de Programa",modal:!0}},{path:"participantes",component:re,canActivate:[L],resolve:{config:M},runGuardsAndResolvers:"always",data:{title:"Participantes do Programa"}},{path:":id/edit",component:ie,canActivate:[L],resolve:{config:M},runGuardsAndResolvers:"always",data:{title:"Edi\xE7\xE3o de Programa",modal:!0}},{path:":id/consult",component:ie,canActivate:[L],resolve:{config:M},runGuardsAndResolvers:"always",data:{title:"Consulta a Programa",modal:!0}},{path:":id/participantes",component:re,canActivate:[L],resolve:{config:M},runGuardsAndResolvers:"always",data:{title:"Participantes do Programa",modal:!0}}],ze=(()=>{let l=class l{};l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=j({type:l}),l.\u0275inj=H({imports:[oe.forChild(va),oe]});let i=l;return i})();var Ct=(()=>{let l=class l{};l.\u0275fac=function(t){return new(t||l)},l.\u0275mod=j({type:l}),l.\u0275inj=H({imports:[ne,De,le,ze]});let i=l;return i})();export{Ct as ProgramaModule};
