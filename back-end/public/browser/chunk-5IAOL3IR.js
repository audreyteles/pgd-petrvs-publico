import{b as je,c as Ve,d as Ht}from"./chunk-IVBXO46K.js";import{a as kt}from"./chunk-UFS3OPCG.js";import{b as Me}from"./chunk-76VPKZU2.js";import{a as ee,b as ie}from"./chunk-RMYSPY7H.js";import{W as me,X as Ft,Y as Nt,b as W,c as Dt,da as Ot,f as Re,fa as Rt,h as St,i as He,j as At,k as wt,l as Pt,m as ze,n as te,o as _e,q as se,s as O,t as B,v as L}from"./chunk-XHTD5OAS.js";import{b as ge,c as U,d as Q,e as Ne,h as Et,k as re,l as de,m as N,n as xt,o as le,q as Tt,r as Oe,s as w}from"./chunk-KODYKPWY.js";import{$a as ne,Aa as J,Ab as V,Ad as Ct,Bb as I,Ca as tt,Da as oe,Dc as fe,Fa as m,Fb as nt,Ga as s,Ha as c,Hc as We,Ia as P,Ic as Z,Ja as k,La as G,Ma as R,Na as u,Nd as yt,O as De,P as Se,R as Ae,Rc as st,Rd as It,Tc as mt,U as C,Ua as T,Uc as dt,V as we,Va as D,Vb as at,Wa as S,Xa as g,Xc as ke,Ya as p,Z as M,Za as E,_ as j,_a as _,_c as ct,ab as Qe,ba as x,bd as pt,cd as Fe,dd as ut,fd as ft,g as Ze,h as v,ha as et,jb as it,kb as ue,kd as ht,ld as gt,ma as r,na as y,oc as Ge,od as _t,pc as Pe,pd as he,rc as rt,sb as b,sd as vt,tb as K,td as ae,va as A,wc as Je,xa as f,xc as lt,xd as bt,ya as q,za as l,zb as ot,zc as Y}from"./chunk-6YMI2QVU.js";function ti(o,a){o&1&&(P(0),p(1," [DAP]=[HA]+[HP]-([HA]\u2229[HP]) "),m(2,"small"),p(3,"(Uni\xE3o da quantidade de dias que t\xEAm ao menos um Afastamento [HA] ou uma Pausa [HP])"),s(),c(4,"br"),k())}function ii(o,a){if(o&1&&(P(0),p(1," [DU]=[HU]/[CH] "),m(2,"small"),p(3,"(Dias \xFAteis necess\xE1rios)"),s(),c(4,"br"),f(5,ti,5,0,"ng-container",6),p(6),k()),o&2){let i=u(2);r(5),l("ngIf",i.partial),r(),ne(" [F]=[I]+[DU]",i.partial?"+[DAP]":"","",i.useCorridos?"":"+[FER]+[FDS]"," ")}}function oi(o,a){o&1&&(P(0),p(1," [HAP]=[HA]+[HP]-([HA]\u2229[HP]) "),m(2,"small"),p(3,"(Uni\xE3o das horas de afastamentos e/ou pausas)"),s(),c(4,"br"),k())}function ni(o,a){if(o&1&&(p(0," [EX]=[HFE]-[HIE]-[TIN]"),c(1,"br"),p(2," [HD]=MIN([EX], [CH]) "),m(3,"small"),p(4,"(Horas por dia, ser\xE1 o menor valor entre: [EX] e [CH])"),s(),c(5,"br"),p(6," [IE]=[HFE]-[HD] "),m(7,"small"),p(8,"(In\xEDcio do expediente para o servidor, para encerrar o dia exatamente no [HFE])"),s(),c(9,"br"),p(10," [SHI]=[I]-[IE] "),m(11,"small"),p(12,"(Saldo inicial, horas a partir do in\xEDcio do expediente [IE] at\xE9 a data e hora inicial [I])"),s(),c(13,"br"),f(14,oi,5,0,"ng-container",6),p(15),m(16,"small"),p(17,"(Quantidade de dias \xFAteis necess\xE1rios, sendo arredondado sempre para cima, ex: 3.2 = 4)"),s(),c(18,"br"),p(19),m(20,"small"),p(21,"(Saldo final, diferen\xE7a do [DF] que estamos buscando at\xE9 o final do expediente [HFE], em horas)"),s(),c(22,"br"),p(23),m(24,"small"),p(25,"(Data e hor\xE1rio final at\xE9 o cumprimento das [HU])"),s(),c(26,"br")),o&2){let i=u(2);r(14),l("ngIf",i.partial),r(),_(" [QDU]=([HU]",i.partial?"+[HAP]":"","+[SHI])/[HD] "),r(4),_(" [SHF]=([HD]*[QDU])-([HU]",i.partial?"+[HAP]":"","+[SHI]) "),r(4),_(" [DF]=[QDU]",i.useCorridos?"":"+[FER]+[FDS]","+[HFE]-[SHF] ")}}function ai(o,a){if(o&1&&(m(0,"div",9),c(1,"i",10),p(2," A data final [F] \xE9 obtida atrav\xE9s do c\xE1lculo:"),c(3,"br")(4,"br"),f(5,ii,7,3,"ng-container",4)(6,ni,27,4,"ng-template",null,1,b),s()),o&2){let i=g(7),e=u();r(5),l("ngIf",e.useDias)("ngIfElse",i)}}function ri(o,a){o&1&&(P(0),p(1," [DAP]=[HA]+[HP]-([HA]\u2229[HP]) "),m(2,"small"),p(3,"(Uni\xE3o da quantidade de dias que t\xEAm ao menos um Afastamento [HA] ou uma Pausa [HP])"),s(),c(4,"br"),k())}function li(o,a){if(o&1&&(P(0),p(1," [DC]=[F]-[I] "),f(2,ri,5,0,"ng-container",6),p(3),m(4,"small"),p(5,"(Dias \xFAteis)"),s(),c(6,"br"),p(7," [HU]=[CH]*[DU] "),k()),o&2){let i=u(2);r(2),l("ngIf",i.partial),r(),ne(" [DU]=[DC]",i.useCorridos?"":"-[FER]-[FDS]","",i.partial?"-[DAP]":""," ")}}function si(o,a){o&1&&(P(0),p(1," [HAP]=[HA]+[HP]-([HA]\u2229[HP]) "),m(2,"small"),p(3,"(Uni\xE3o das horas de afastamentos e/ou pausas)"),s(),c(4,"br"),k())}function mi(o,a){if(o&1&&(p(0," [EX]=[HFE]-[HIE]-[TIN]"),c(1,"br"),p(2," [SHI]=[I]-[IE] "),m(3,"small"),p(4,"(Saldo inicial, horas a partir do in\xEDcio do expediente [IE] at\xE9 a data e hora inicial [I])"),s(),c(5,"br"),p(6," [SHF]=[HFE]-[F] "),m(7,"small"),p(8,"(Saldo final, horas a partir da data e hora final [F] at\xE9 o fim do expediente [HFE])"),s(),c(9,"br"),f(10,si,5,0,"ng-container",6),p(11," [DU]=[DC](-[FER]-[FDS])"),c(12,"br"),p(13)),o&2){let i=u(2);r(10),l("ngIf",i.partial),r(3),_(" [HU]=[CH]*[DU](-[SHI]-[SHF])",i.partial?"-[HAP]":""," ")}}function di(o,a){if(o&1&&(m(0,"div",9),c(1,"i",10),p(2," As horas s\xE3o obtidas atrav\xE9s do c\xE1lculo:"),c(3,"br")(4,"br"),f(5,li,8,3,"ng-container",4)(6,mi,14,2,"ng-template",null,2,b),s()),o&2){let i=g(7),e=u();r(5),l("ngIf",e.useDias)("ngIfElse",i)}}function ci(o,a){o&1&&(P(0),p(1," * O c\xE1lculo para dias corridos n\xE3o considera feriados nem fins de semana e levar\xE1 em considera\xE7\xE3o o expediente da unidade "),k())}function pi(o,a){if(o&1&&f(0,ci,2,0,"ng-container",6),o&2){let i=u(2);l("ngIf",i.useCorridos)}}function ui(o,a){o&1&&f(0,pi,1,1,"ng-template")}function fi(o,a){o&1&&(P(0),p(1," * O c\xE1lculo para horas corridas N\xC3O considera o expediente da unidade, APENAS leva em considera\xE7\xE3o afastamentos [HA] e pausas [HP] "),k())}function hi(o,a){if(o&1&&f(0,fi,2,0,"ng-container",6),o&2){let i=u();l("ngIf",i.useCorridos)}}function gi(o,a){if(o&1&&(m(0,"span",11),p(1),s()),o&2){let i=a.$implicit;r(),E(i)}}function _i(o,a){if(o&1&&(m(0,"span"),p(1),c(2,"br"),s()),o&2){let i=a.$implicit,e=u(2);r(),Qe(" De ",e.util.getDateTimeFormatted(i.data_inicio)," at\xE9 ",e.util.getDateTimeFormatted(i.data_fim)," - ",i.observacoes,"")}}function vi(o,a){if(o&1&&(m(0,"span"),p(1),c(2,"br"),s()),o&2){let i=a.$implicit,e=u(2);r(),ne(" De ",e.util.getDateTimeFormatted(i.data_inicio)," - ",i.data_fim?"at\xE9 "+e.util.getDateTimeFormatted(i.data_fim):"em aberto","")}}function bi(o,a){if(o&1&&(P(0),m(1,"strong"),p(2),s(),c(3,"br"),f(4,_i,3,3,"span",7),m(5,"strong"),p(6),s(),c(7,"br"),f(8,vi,3,2,"span",7),k()),o&2){let i=u();r(2),_("[HA] Afastamento(s) (",i.efemerides==null||i.efemerides.afastamentos==null?null:i.efemerides.afastamentos.length,"):"),r(2),l("ngForOf",i.efemerides.afastamentos),r(2),_("[HP] Pausa(s) (",i.efemerides==null||i.efemerides.pausas==null?null:i.efemerides.pausas.length,"):"),r(2),l("ngForOf",i.efemerides.pausas)}}function Ci(o,a){if(o&1&&(m(0,"span"),p(1),c(2,"br"),s()),o&2){let i=a.$implicit;r(),ne(" ",i[0]," - ",i[1],"")}}function yi(o,a){if(o&1&&(m(0,"span"),p(1),c(2,"br"),s()),o&2){let i=a.$implicit;r(),ne(" ",i[0]," - ",i[1],"")}}function Ii(o,a){if(o&1&&(m(0,"span")(1,"b"),p(2),s(),p(3),c(4,"br"),p(5),c(6,"br"),p(7),c(8,"br")(9,"br"),s()),o&2){let i=a.$implicit,e=u();r(2),E(i.diaSemana),r(),Qe(" - In\xEDcio: ",e.util.getDateTimeFormatted(e.data(i.tInicio))," - Fim: ",e.util.getDateTimeFormatted(e.data(i.tFim))," - Total: ",+i.hExpediente.toFixed(2),"h"),r(2),ne(" Intervalos: Qde(",i.intervalos.length,") - Total de horas(",e.totalHoras(i.intervalos),"h)"),r(2),_(" Qde. horas contabilizadas: ",+i.hExpediente.toFixed(2)-e.totalHoras(i.intervalos),"")}}var xn=(()=>{let a=class a{constructor(e,n){this.util=e,this.lookup=n,this.partial=!0,this._expediente=[]}ngOnInit(){}get forma(){return this.efemerides?this.lookup.getValue(this.lookup.DIA_HORA_CORRIDOS_OU_UTEIS,this.efemerides.forma):"Desconhecido"}get expediente(){let e=this.efemerides?.expediente,n=this.lookup.DIA_SEMANA.map(t=>this.efemerides?.expediente[t.code]?.length?t.value+": "+this.efemerides.expediente[t.code].map(d=>d.inicio+" at\xE9 "+d.fim).join(", "):"").filter(t=>t.length);return this.efemerides?.expediente?.especial?.length&&n.push("Especial: "+this.efemerides.expediente.especial.map(t=>this.util.getDateFormatted(t.data)+" - "+t.inicio+" at\xE9 "+t.fim+(t.sem?" (Sem expediente)":"")).join(", ")),JSON.stringify(this._expediente)!=JSON.stringify(n)&&(this._expediente=n),this._expediente}get useDias(){return["DIAS_UTEIS","DIAS_CORRIDOS"].includes(this.efemerides.forma)}get useCorridos(){return["DIAS_CORRIDOS","HORAS_CORRIDAS"].includes(this.efemerides.forma)}isoToFormatted(e){return e.substr(8,2)+"/"+e.substr(5,2)+"/"+e.substr(0,4)}get feriados(){return Object.entries(this.efemerides?.feriados||{}).map(e=>[this.isoToFormatted(e[0]),e[1]])}get diasNaoUteis(){return Object.entries(this.efemerides?.diasNaoUteis||{}).map(e=>[this.isoToFormatted(e[0]),e[1]])}data(e){return new Date(e)}totalHoras(e){return+e.reduce((n,t)=>n+this.util.getHoursBetween(t.start,t.end),0).toFixed(2)}};a.\u0275fac=function(n){return new(n||a)(y(fe),y(Z))},a.\u0275cmp=C({type:a,selectors:[["calendar-efemerides"]],inputs:{efemerides:"efemerides",partial:"partial"},decls:49,vars:23,consts:[["obsUseHoras",""],["dataUseHoras",""],["tempoUseHoras",""],["class","mt-2 alert alert-primary","role","alert",4,"ngIf"],[4,"ngIf","ngIfElse"],["class","ms-2 d-block",4,"ngFor","ngForOf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["collapse","","transparent","",3,"bold","title"],["role","alert",1,"mt-2","alert","alert-primary"],[1,"bi","bi-info-circle-fill"],[1,"ms-2","d-block"]],template:function(n,t){if(n&1&&(f(0,ai,8,2,"div",3)(1,di,8,2,"div",3)(2,ui,1,0,null,4)(3,hi,1,1,"ng-template",null,0,b),c(5,"br"),m(6,"strong"),p(7,"[I] In\xEDcio:"),s(),p(8),c(9,"br"),m(10,"strong"),p(11,"[F] Fim:"),s(),p(12),c(13,"br"),m(14,"strong"),p(15,"[DC] Dias corridos:"),s(),p(16),c(17,"br"),m(18,"strong"),p(19),s(),p(20),c(21,"br"),m(22,"strong"),p(23),s(),p(24),c(25,"br"),m(26,"strong"),p(27,"[FC] Forma de c\xE1lculo:"),s(),p(28),c(29,"br"),m(30,"strong"),p(31,"[CH] Carga hor\xE1ria:"),s(),p(32),c(33,"br"),m(34,"strong"),p(35,"Expediente (nos dias da semana):"),s(),c(36,"br"),f(37,gi,2,1,"span",5)(38,bi,9,4,"ng-container",6),m(39,"strong"),p(40),s(),c(41,"br"),f(42,Ci,3,2,"span",7),m(43,"strong"),p(44),s(),c(45,"br"),f(46,yi,3,2,"span",7),m(47,"separator",8),f(48,Ii,10,7,"span",7),s()),n&2){let d=g(4);l("ngIf",(t.efemerides==null?null:t.efemerides.resultado)=="DATA"),r(),l("ngIf",(t.efemerides==null?null:t.efemerides.resultado)=="TEMPO"),r(),l("ngIf",t.useDias)("ngIfElse",d),r(6),_(" ",t.util.getDateTimeFormatted(t.efemerides==null?null:t.efemerides.inicio),""),r(4),_(" ",t.util.getDateTimeFormatted(t.efemerides==null?null:t.efemerides.fim),""),r(4),_(" ",t.efemerides==null?null:t.efemerides.dias_corridos,""),r(3),_("[HU] Horas ",t.useCorridos?"corridas":"\xFAteis",":"),r(),_(" ",t.util.decimalToTimerFormated(t.efemerides==null?null:t.efemerides.tempoUtil,!0),""),r(3),_("[HNU] Horas ",t.useCorridos?"n\xE3o contabilizadas":"n\xE3o \xFAteis",":"),r(),_(" ",t.util.decimalToTimerFormated(t.efemerides==null?null:t.efemerides.horasNaoUteis,!0),""),r(4),_(" ",t.forma,""),r(4),ne(" ",t.util.decimalToTimerFormated(t.efemerides==null?null:t.efemerides.cargaHoraria,!0),"",t.useCorridos?" - Utilizada: 24h/dia":"",""),r(5),l("ngForOf",t.expediente),r(),l("ngIf",t.partial),r(2),_("[DNU] Dias n\xE3o \xFAteis (",t.diasNaoUteis.length,"):"),r(2),l("ngForOf",t.diasNaoUteis),r(2),_("[FER] Feriado(s) (",t.feriados.length,"):"),r(2),l("ngForOf",t.feriados),r(),l("bold",!0)("title","Detalhes dia-a-dia ("+(t.efemerides==null||t.efemerides.diasDetalhes==null?null:t.efemerides.diasDetalhes.length)+"):"),r(),l("ngForOf",t.efemerides==null?null:t.efemerides.diasDetalhes)}},dependencies:[V,I,B]});let o=a;return o})();var xi=["texto"],Ti=["comentarios"];function Di(o,a){if(o&1&&(m(0,"td",16),p(1,"\xA0"),s()),o&2){let i=u().row,e=u();J("width",e.comentario.comentarioLevel(i).length*20,"px")}}function Si(o,a){if(o&1&&(m(0,"table",8)(1,"tr"),f(2,Di,2,2,"td",9),m(3,"td",10),c(4,"profile-picture",11)(5,"br"),s(),m(6,"td",12),c(7,"span",13),m(8,"h6",14),p(9),m(10,"span"),p(11),s(),m(12,"span"),p(13),s(),m(14,"span"),p(15),s()(),m(16,"p",15),p(17),s()()()()),o&2){let i=a.row,e=u();r(2),l("ngIf",e.comentario.comentarioLevel(i).length>0),r(2),l("url",i.usuario==null?null:i.usuario.url_foto)("hint",(i.usuario==null?null:i.usuario.nome)||"Desconhecido"),r(2),J("border-color",e.util.getBackgroundColor(e.comentario.comentarioLevel(i).length,20)),r(),J("border-color",e.util.getBackgroundColor(e.comentario.comentarioLevel(i).length,20)),r(2),_(" ",(i.usuario==null?null:i.usuario.nome)||"Desconhecido"," "),r(2),E(e.lookup.getValue(e.lookup.COMENTARIO_TIPO,i.tipo)),r(2),E(e.lookup.getValue(e.lookup.COMENTARIO_PRIVACIDADE,i.privacidade)),r(2),E(e.util.getDateTimeFormatted(i.comentario)),r(2),E(i.texto)}}function Ai(o,a){o&1&&(P(0),m(1,"span",25),p(2,"\u2022"),s(),c(3,"br"),k())}function wi(o,a){if(o&1&&(m(0,"div",17)(1,"div",18),c(2,"profile-picture",11)(3,"br"),f(4,Ai,4,0,"ng-container",19),s(),m(5,"div",20),c(6,"input-textarea",21,3),s(),m(8,"div",22)(9,"div",17),c(10,"input-select",23),s(),m(11,"div",17),c(12,"input-select",24),s()()()),o&2){let i=a.row,e=u();r(2),l("url",i.usuario==null?null:i.usuario.url_foto)("hint",(i.usuario==null?null:i.usuario.nome)||"Desconhecido"),r(2),l("ngForOf",e.comentario.comentarioLevel(i)),r(2),l("size",12)("rows",3)("control",e.formComentarios.controls.texto),r(4),l("size",12)("control",e.formComentarios.controls.tipo)("items",e.comentarioTipos),r(2),l("size",12)("control",e.formComentarios.controls.privacidade)("items",e.lookup.COMENTARIO_PRIVACIDADE)}}var jt=(()=>{let a=class a extends N{set control(e){this._control!=e&&(this._control=e,e&&this.comentario&&e.setValue(this.comentario.orderComentarios(e.value||[])))}get control(){return this._control}set entity(e){this._entity!=e&&(this._entity=e,e&&this.comentario&&(e.comentarios=this.comentario.orderComentarios(e.comentarios||[])),this.fakeControl.setValue(e?.comentarios))}get entity(){return this._entity}set origem(e){if(this._origem!=e){this._origem=e;let n=["PROJETO","PROJETO_TAREFA"].includes(e||"")?["COMENTARIO","GERENCIAL","TECNICO"]:["COMENTARIO","TECNICO"];this.comentarioTipos=this.lookup.COMENTARIO_TIPO.filter(t=>n.includes(t.key))}}get origem(){return this._origem}constructor(e){super(e),this.injector=e,this.comentarioTipos=[],this._origem=void 0,this.validate=(n,t)=>{let d=null;return t=="texto"&&!n.value?.length&&(d="N\xE3o pode ser em branco"),d},this.addComentario=()=>v(this,null,function*(){this.comentario.newComentario(this.gridControl,this.comentarios)}),this.comentario=e.get(je),this.form=this.fh.FormBuilder({}),this.join=["comentarios.usuario"],this.formComentarios=this.fh.FormBuilder({texto:{default:""},tipo:{default:"COMENTARIO"},privacidade:{default:"PUBLICO"}},this.cdRef,this.validate)}ngOnInit(){switch(super.ngOnInit(),this.urlParams?.has("origem")&&(this.origem=this.urlParams.get("origem"),this.comentario_id=this.queryParams?.comentario_id),this.origem){case"ATIVIDADE":this.dao=this.injector.get(yt);break;case"ATIVIDADE_TAREFA":this.dao=this.injector.get(vt);break;case"PROJETO":this.dao=this.injector.get(ct);break;case"PROJETO_TAREFA":this.dao=this.injector.get(Ct);break;case"PLANO_ENTREGA_ENTREGA":this.dao=this.injector.get(Fe);break}}get isNoPersist(){return this.entity_id=="NOPERSIST"}get constrolOrItems(){return this.control||this.entity?.comentarios||[]}dynamicButtons(e){let n=[];return e.usuario_id==this.auth.usuario?.id&&n.push({icon:"bi bi-pencil-square",hint:"Alterar",color:"btn-outline-info",onClick:d=>{this.grid.edit(d)}}),n.push({hint:"Responder",color:"btn-outline-success",icon:"bi bi-reply",onClick:d=>{this.comentario.newComentario(this.gridControl,this.comentarios,d)}}),n}saveComentario(e,n){return v(this,null,function*(){let t=e.value;Object.assign(this.comentarios.editing,t)})}loadComentario(e,n){return v(this,null,function*(){this.formComentarios.controls.texto.setValue(n.texto),this.formComentarios.controls.tipo.setValue(n.tipo),this.formComentarios.controls.privacidade.setValue(n.privacidade)})}confirm(){this.comentarios?.confirm()}loadData(e,n){let t=this.comentario_id?.length?(this.gridControl.value||[]).find(d=>d.id==this.comentario_id):void 0;this.comentario.newComentario(this.gridControl,this.comentarios,t),this.cdRef.detectChanges(),this.texto.focus()}saveData(){return v(this,null,function*(){return this.confirm(),{comentarios:this.gridControl.value}})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["comentarios"]],viewQuery:function(n,t){if(n&1&&(T(w,5),T(xi,5),T(Ti,5)),n&2){let d;D(d=S())&&(t.grid=d.first),D(d=S())&&(t.texto=d.first),D(d=S())&&(t.comentarios=d.first)}},inputs:{control:"control",entity:"entity",origem:"origem"},features:[A],decls:10,vars:12,consts:[["comentarios",""],["mensagem",""],["mensagemEdit",""],["texto",""],[3,"submit","cancel","form","noButtons"],["editable","",3,"control","hasEdit","hasDelete","add","form","load","save"],["title","Coment\xE1rios",3,"template","editTemplate"],["type","options",3,"dynamicButtons"],[1,"comentario-table"],["class","d-none d-md-table-cell",3,"width",4,"ngIf"],[1,"comentario-user","text-center"],[3,"url","hint"],[1,"comentario-container"],[1,"comentario-user-indicator"],[1,"comentario-message-title"],[1,"fw-light"],[1,"d-none","d-md-table-cell"],[1,"row"],[1,"col-md-1","comentario-user","text-center"],[4,"ngFor","ngForOf"],[1,"col-md-7"],["label","Mensagem","icon","bi bi-textarea-t","controlName","texto",3,"size","rows","control"],[1,"col-md-4"],["label","Tipo","icon","bi bi-braces","controlName","tipo",3,"size","control","items"],["label","privacidade","icon","bi bi-incognito","controlName","privacidade",3,"size","control","items"],[1,"comentario-level"]],template:function(n,t){if(n&1){let d=G();m(0,"editable-form",4),R("submit",function(){return M(d),j(t.onSaveData())})("cancel",function(){return M(d),j(t.onCancel())}),m(1,"grid",5,0)(3,"columns")(4,"column",6),f(5,Si,18,12,"ng-template",null,1,b)(7,wi,13,12,"ng-template",null,2,b),s(),c(9,"column",7),s()()()}if(n&2){let d=g(6),h=g(8);l("form",t.form)("noButtons",t.entity_id?void 0:"true"),r(),l("control",t.gridControl)("hasEdit",!1)("hasDelete",!1)("add",t.addComentario.bind(t))("form",t.formComentarios)("load",t.loadComentario.bind(t))("save",t.saveComentario.bind(t)),r(3),l("template",d)("editTemplate",h),r(5),l("dynamicButtons",t.dynamicButtons.bind(t))}},dependencies:[V,I,w,Q,U,O,_e,He,me],styles:['@charset "UTF-8";.comentario-table[_ngcontent-%COMP%]{width:100%}.comentario-user[_ngcontent-%COMP%]{width:50px;vertical-align:top;padding:8px}.comentario-container[_ngcontent-%COMP%]{padding-left:10px;width:auto;border-left:var(--bs-gray-400) 2px solid;position:relative}.comentario-user-indicator[_ngcontent-%COMP%]{content:"";position:absolute;width:0px;height:0px;top:0;left:-12px;border-top:.75rem solid var(--bs-gray-400);border-left:.75rem solid transparent}.comentario-level[_ngcontent-%COMP%]{color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:" \\2022  "}']});let o=a;return o})();var Pi=()=>[];function ki(o,a){if(o&1){let i=G();m(0,"i",7),R("click",function(n){M(i);let t=u().$implicit,d=u();return j(d.addComentarioClick(n,d.entity,t.id))}),s()}}function Fi(o,a){if(o&1){let i=G();m(0,"span",3,0),R("click",function(){M(i);let n=g(1),t=u();return j(t.comentarioClick(n))}),c(2,"i"),m(3,"span",4)(4,"strong"),p(5),s(),p(6),c(7,"br"),s(),f(8,ki,1,0,"i",5),m(9,"span",6),p(10),s()()}if(o&2){let i=a.$implicit,e=u();J("margin-left",(i.path&&i.path.includes("/")?i.path.split("/").length-1:0)*5+"px")("background-color",e.util.getBackgroundColor(i.path&&i.path.includes("/")?i.path.split("/").length-1:0,20)+"!important"),l("title",e.lookup.getValue(e.lookup.COMENTARIO_TIPO,i.tipo)),r(2),oe("me-1 "+e.lookup.getIcon(e.lookup.COMENTARIO_TIPO,i.tipo)),r(3),E(e.util.shortName(e.util.apelidoOuNome(i.usuario))),r(),_(" \u2022 ",e.util.getDateTimeFormatted(i.data_comentario),""),r(2),l("ngIf",!e.selectable),r(2),_(" ",i.texto," ")}}var Un=(()=>{let a=class a{set entity(e){this._entity!=e&&(this._entity=e,e&&this.comentario&&(e.comentarios=this.comentario.orderComentarios(e.comentarios||[])))}get entity(){return this._entity}constructor(e){this.injector=e,this.selectable=!1,this.noPersist=void 0,this.origem=void 0,this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xE1rio"},this._entity=void 0,this.validate=(n,t)=>null,this.fh=e.get(ke),this.cdRef=e.get(K),this.go=e.get(lt),this.util=e.get(fe),this.lookup=e.get(Z),this.comentario=e.get(je),this.form=this.fh.FormBuilder({comentarios:{default:[]}},this.cdRef,this.validate)}ngOnInit(){}get isNoPersist(){return this.noPersist!=null}comentarioClick(e){let n=e.getAttribute("data-expanded");e.setAttribute("data-expanded",n=="true"?"false":"true")}addComentarioClick(e,n,t){e?.stopPropagation(),this.go.navigate({route:["uteis","comentarios",this.origem,this.isNoPersist?"NOPERSIST":n.id,"new"],params:{comentario_id:t}},{modal:!0,metadata:{entity:n},modalClose:d=>{d&&(this.save&&this.save(d),this.isNoPersist||(this.grid?.query||this.query)?.refreshId(n.id))}})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["comentarios-widget"]],inputs:{selectable:"selectable",noPersist:"noPersist",origem:"origem",save:"save",grid:"grid",query:"query",entity:"entity"},decls:2,vars:3,consts:[["badge",""],["title","Coment\xE1rios","small","",3,"buttonClick","button"],["class","badge bg-light text-dark comentario-badge","role","button","data-expanded","false","data-bs-toggle","tooltip","data-bs-placement","top",3,"title","margin-left","background-color","click",4,"ngFor","ngForOf"],["role","button","data-expanded","false","data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark","comentario-badge",3,"click","title"],[1,"comentario-title"],["class","bi bi-reply comentario-responder","data-bs-toggle","tooltip","data-bs-placement","top","title","Responder",3,"click",4,"ngIf"],[1,"comentario-text","text-truncate"],["data-bs-toggle","tooltip","data-bs-placement","top","title","Responder",1,"bi","bi-reply","comentario-responder",3,"click"]],template:function(n,t){n&1&&(m(0,"separator",1),R("buttonClick",function(h){return t.addComentarioClick(h,t.entity)}),s(),f(1,Fi,11,11,"span",2)),n&2&&(l("button",t.selectable?void 0:t.addComentarioButton),r(),l("ngForOf",(t.entity==null?null:t.entity.comentarios)||ue(2,Pi)))},dependencies:[V,I,B],styles:["[_nghost-%COMP%]{max-width:320px;display:block}.comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:initial;white-space:normal;font-size:12px}.comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{font-size:12px;height:auto;display:block;white-space:initial}.comentario-badge[_ngcontent-%COMP%]{white-space:nowrap;display:block;position:relative;background-color:#ffe69c!important;margin-bottom:1px;text-align:left;padding:3px 5px}.comentario-badge[_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:none}.comentario-badge[_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{width:calc(100% - 15px);display:inline-block;font-size:12px}.comentario-badge[_ngcontent-%COMP%]:hover   .comentario-responder[_ngcontent-%COMP%]{display:block}.comentario-responder[_ngcontent-%COMP%]{display:none;position:absolute;right:5px;top:5px}"]});let o=a;return o})();function Ni(o,a){if(o&1&&(m(0,"div",1),c(1,"input-text",4),s()),o&2){let i=u();r(),l("size",12)("control",i.form.controls.confirmacao),q("maxlength",250)}}function Oi(o,a){o&1&&(m(0,"div",1)(1,"h5"),p(2,"Em desenvolvimento"),s()())}var Vt=(()=>{let a=class a extends N{constructor(e){super(e),this.injector=e,this.textoConfirmar="confirmo",this.documentos=[],this.TIPO_ASSINATURA=[{key:"ELETRONICA",value:"Assinatura Elet\xF4nica"},{key:"DIGITAL",value:"Assinatura Digital"}],this.isProcessandoClique=!1,this.validate=(n,t)=>{let d=null;return this.form?.controls.tipo.value=="ELETRONICA"&&t=="confirmacao"&&n.value.toLowerCase()!=this.textoConfirmar.toLowerCase()?d="Valor dever\xE1 ser "+this.textoConfirmar:this.form?.controls.tipo.value=="DIGITAL"&&t=="certificado_id"&&!n.value?.length&&(d="Obrigat\xF3rio selecionar um certificado"),d},this.documentoDao=e.get(ae),this.modalWidth=450,this.form=this.fh.FormBuilder({tipo:{default:"ELETRONICA"},confirmacao:{default:""},certificado_id:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.documentos=this.metadata?.documentos}onAssinarClick(){return v(this,null,function*(){if(!this.isProcessandoClique){this.isProcessandoClique=!0,this.dialog.showSppinerOverlay("Assinando . . .");try{let e=yield this.documentoDao.assinar(this.documentos.map(n=>n.id));e?.forEach(n=>{let t=this.documentos.find(d=>d.id==n.id);t&&(t.assinaturas=n.assinaturas)}),this.go.setModalResult(this.modalRoute?.queryParams?.idroute,e),this.close()}catch(e){this.error(e?.error.message||e?.message||e||"Erro desconhecido")}finally{this.dialog.closeSppinerOverlay(),this.isProcessandoClique=!1}}})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["app-assinar"]],viewQuery:function(n,t){if(n&1&&T(O,5),n&2){let d;D(d=S())&&(t.editableForm=d.first)}},features:[A],decls:6,vars:6,consts:[["confirmLabel","Assinar",3,"submit","cancel","form"],[1,"row"],["controlName","tipo",3,"size","control","items"],["class","row",4,"ngIf"],["label","Digite a palavra CONFIRMO para prosseguir","icon","bi bi-hand-thumbs-up","controlName","confirmacao",3,"size","control"]],template:function(n,t){n&1&&(m(0,"editable-form",0),R("submit",function(){return t.onAssinarClick()})("cancel",function(){return t.onCancel()}),m(1,"div",1)(2,"div",1),c(3,"input-radio",2),s(),f(4,Ni,2,3,"div",3)(5,Oi,3,0,"div",3),s()()),n&2&&(l("form",t.form),r(3),l("size",12)("control",t.form.controls.tipo)("items",t.TIPO_ASSINATURA),r(),l("ngIf",t.form.controls.tipo.value=="ELETRONICA"),r(),l("ngIf",t.form.controls.tipo.value=="DIGITAL"))},dependencies:[I,O,W,Pt]});let o=a;return o})();function Ri(o,a){if(o&1&&(m(0,"small"),p(1),s()),o&2){let i=u(3);r(),_("Sei n\xBA ",i.documento==null||i.documento.link==null?null:i.documento.link.numero_documento,"")}}function Hi(o,a){if(o&1&&(P(0),p(1),c(2,"br"),f(3,Ri,2,1,"small",4),k()),o&2){let i=u(2);r(),_(" ",(i.documento==null||i.documento.link==null?null:i.documento.link.numero_processo)||i.emptyMessage,""),r(2),l("ngIf",i.documento==null||i.documento.link==null||i.documento.link.numero_documento==null?null:i.documento.link.numero_documento.length)}}function zi(o,a){if(o&1&&(P(0),p(1),k()),o&2){let i=u(2);r(),_(" ",(i.documento==null?null:i.documento.titulo)||i.emptyMessage," ")}}function Mi(o,a){if(o&1&&(P(0),m(1,"span",6)(2,"small")(3,"strong"),p(4),s(),p(5),s()(),k()),o&2){let i=u(2);r(),J("max-width",i.maxWidth,"px"),r(3),_("#",i.documento==null?null:i.documento.numero,""),r(),_(" - ",(i.documento==null?null:i.documento.titulo)||i.emptyMessage,"")}}function ji(o,a){if(o&1&&(P(0),p(1),k()),o&2){let i=u(2);r(),_(" ",(i.documento==null?null:i.documento.titulo)||i.emptyMessage," ")}}function Vi(o,a){if(o&1&&c(0,"profile-picture",10),o&2){let i=a.$implicit;l("url",(i.usuario==null?null:i.usuario.url_foto)||"")("hint",(i.usuario==null?null:i.usuario.nome)||"Desconhecido")}}function Bi(o,a){if(o&1&&(m(0,"separator",7)(1,"div",8),f(2,Vi,1,2,"profile-picture",9),s()()),o&2){let i=u(2);r(2),l("ngForOf",i.documento.assinaturas)}}function Li(o,a){if(o&1&&(m(0,"badge",2)(1,"div",3),f(2,Hi,4,2,"ng-container",4)(3,zi,2,1,"ng-container",4)(4,Mi,6,4,"ng-container",4)(5,ji,2,1,"ng-container",4)(6,Bi,3,1,"separator",5),s()()),o&2){let i=u();l("icon",i.icon)("color",i.color)("rounded",!i.isNoRounded)("data",i.documento)("click",i.documentoService.onDocumentoClick.bind(i.documentoService))("hint",i.documentoService.documentoHint(i.documento)),r(2),l("ngIf",i.isLinkSei),r(),l("ngIf",i.isLinkUrl),r(),l("ngIf",i.isHtml),r(),l("ngIf",i.isPdf),r(),l("ngIf",i.isSignatures&&(i.documento==null||i.documento.assinaturas==null?null:i.documento.assinaturas.length))}}function qi(o,a){if(o&1&&(m(0,"small"),p(1),s()),o&2){let i=u(3);r(),_("Sei n\xBA ",i.documento.link==null?null:i.documento.link.numero_documento,"")}}function Ui(o,a){if(o&1&&(P(0),p(1),c(2,"br"),f(3,qi,2,1,"small",4),k()),o&2){let i=u(2);r(),_(" ",(i.documento.link==null?null:i.documento.link.numero_processo)||i.emptyMessage,""),r(2),l("ngIf",i.documento==null||i.documento.link==null||i.documento.link.numero_documento==null?null:i.documento.link.numero_documento.length)}}function Qi(o,a){if(o&1&&(P(0),p(1),k()),o&2){let i=u(2);r(),_(" ",i.documento.titulo||i.emptyMessage," ")}}function Gi(o,a){if(o&1&&(m(0,"badge",11),f(1,Ui,4,2,"ng-container",4)(2,Qi,2,1,"ng-container",4),s()),o&2){let i=u();oe("d-block"),l("icon",i.linkIcon)("rounded",!1)("data",i.documento.link)("click",i.documentoService.onLinkClick.bind(i.documentoService))("hint",i.documentoService.documentoHint(i.documento)),r(),l("ngIf",(i.documento==null||i.documento.link==null?null:i.documento.link.tipo)=="SEI"),r(),l("ngIf",(i.documento==null||i.documento.link==null?null:i.documento.link.tipo)=="URL")}}var Bt=(()=>{let a=class a{constructor(e){this.documentoService=e,this.color="light"}get show(){return this.isOnlyLink&&(this.isLinkSei||this.isLinkUrl)||!this.isOnlyLink&&(!!this.documento||!!this.emptyMessage?.length)}get icon(){return this.isLinkUrl?"bi bi-link-45deg":this.isLinkSei?this.documento?.link?.numero_processo?.length?"bi bi-folder-symlink":"bi bi-x-lg":this.isPdf?"bi bi-file-earmark-pdf":"bi bi-filetype-html"}get linkIcon(){return this.documento?.link?.tipo=="SEI"?this.documento?.link?.numero_processo?.length?"bi bi-folder-symlink":"bi bi-x-lg":"bi bi-link-45deg"}get hasLink(){return["SEI","URL"].includes(this.documento?.link?.tipo||"")}get isLinkSei(){return this.documento?.tipo=="LINK"&&this.documento?.link?.tipo=="SEI"}get isLinkUrl(){return this.documento?.tipo=="LINK"&&this.documento?.link?.tipo=="URL"}get isHtml(){return this.documento?.tipo=="HTML"}get isPdf(){return this.documento?.tipo=="PDF"}get isSignatures(){return this.signatures!=null}get isNoRounded(){return this.noRounded!=null}get isWithLink(){return this.withLink!=null}get isOnlyLink(){return this.onlyLink!=null}};a.\u0275fac=function(n){return new(n||a)(y(Oe))},a.\u0275cmp=C({type:a,selectors:[["documentos-badge"]],inputs:{documento:"documento",emptyMessage:"emptyMessage",signatures:"signatures",maxWidth:"maxWidth",noRounded:"noRounded",withLink:"withLink",onlyLink:"onlyLink",color:"color"},decls:2,vars:2,consts:[[3,"icon","color","rounded","data","click","hint",4,"ngIf"],["color","warning",3,"class","icon","rounded","data","click","hint",4,"ngIf"],[3,"icon","color","rounded","data","click","hint"],[1,"d-flex","flex-column"],[4,"ngIf"],["transparent","",4,"ngIf"],[1,"text-wrap"],["transparent",""],[1,"d-flex","flex-wrap"],[3,"url","hint",4,"ngFor","ngForOf"],[3,"url","hint"],["color","warning",3,"icon","rounded","data","click","hint"]],template:function(n,t){n&1&&f(0,Li,7,11,"badge",0)(1,Gi,3,9,"badge",1),n&2&&(l("ngIf",t.show),r(),l("ngIf",t.documento&&!t.isLinkSei&&!t.isLinkUrl&&(t.isWithLink||t.isOnlyLink)&&t.hasLink))},dependencies:[V,I,B,L,me],styles:[".doc[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:5px;padding:7px;max-width:200px}"]});let o=a;return o})();function Wi(o,a){if(o&1&&(m(0,"h5"),p(1),s(),c(2,"document-preview",8)),o&2){let i=a.row;r(),E((i==null?null:i.titulo)||"Preview do template"),r(),l("html",i==null?null:i.conteudo)}}function $i(o,a){if(o&1&&(m(0,"div",9),c(1,"input-text",10),s(),m(2,"div"),c(3,"input-editor",11),s()),o&2){let i=u();r(),l("size",12)("control",i.form.controls.titulo),q("maxlength",250),r(2),l("size",12)("control",i.form.controls.conteudo)("canEditTemplate",i.canEdit)("template",i.form.controls.template.value)("datasource",i.form.controls.datasource.value)}}function Xi(o,a){if(o&1&&c(0,"badge",14),o&2){let i=a.$implicit;l("color",i.color)("icon",i.icon)("label",i.value)}}function Ki(o,a){if(o&1&&c(0,"profile-picture",20),o&2){let i=a.$implicit,e=u(3);l("url",i.usuario==null?null:i.usuario.url_foto)("hint",e.util.apelidoOuNome(i.usuario))}}function Yi(o,a){if(o&1&&(m(0,"separator",18),f(1,Ki,1,2,"profile-picture",19),s()),o&2){let i=u().row;r(),l("ngForOf",i.assinaturas)}}function Zi(o,a){if(o&1&&(m(0,"div",9)(1,"strong"),p(2),m(3,"small"),p(4),s()()(),m(5,"div",9)(6,"small"),p(7),s()(),m(8,"div",9)(9,"div",12),c(10,"badge",13)(11,"badge",14),f(12,Xi,1,3,"badge",15),c(13,"documentos-badge",16),f(14,Yi,2,1,"separator",17),s()()),o&2){let i=a.row,e=a.metadata,n=u();r(2),_("#",i.numero>0?i.numero:"NOVO",""),r(2),_(" \u2022 ",n.util.getDateTimeFormatted(i.created_at),""),r(3),E(i.titulo),r(3),l("color",n.lookup.getColor(n.lookup.DOCUMENTO_ESPECIE,i.especie))("label",n.lookup.getValue(n.lookup.DOCUMENTO_ESPECIE,i.especie)),r(),l("color",n.lookup.getColor(n.lookup.DOCUMENTO_STATUS,i.status))("icon",n.lookup.getIcon(n.lookup.DOCUMENTO_STATUS,i.status))("label",n.lookup.getValue(n.lookup.DOCUMENTO_STATUS,i.status)),r(),l("ngForOf",n.extraTags(n.entity,i,e)),r(),l("documento",i),r(),l("ngIf",i.assinaturas==null?null:i.assinaturas.length)}}var Le=(()=>{let a=class a extends N{set entity(e){super.entity=e}get entity(){return super.entity}set noPersist(e){super.noPersist=e}get noPersist(){return super.noPersist}set datasource(e){JSON.stringify(this._datasource)!=this.JSON.stringify(e)&&(this._datasource=e,this.grid?.editing?.assinaturas?.length||this.form.controls.datasource.setValue(e),this.cdRef.detectChanges())}get datasource(){return this._datasource}set editingId(e){this._editingId!=e&&(this._editingId=e,e&&(this.action="edit",this.documentoId=e,this.loadData(this.entity)))}get editingId(){return this._editingId}get items(){return this.gridControl.value||this.gridControl.setValue({documentos:[]}),this.gridControl.value.documentos||(this.gridControl.value.documentos=[]),this.gridControl.value.documentos}constructor(e){super(e),this.injector=e,this.needSign=(n,t)=>!0,this.extraTags=(n,t,d)=>[],this.especie="OUTRO",this.disabled=!1,this.canEditTemplate=!1,this.validate=(n,t)=>{let d=null;return t=="titulo"&&!n?.value?.length&&(d="Obrigat\xF3rio"),d},this.cdRef=e.get(K),this.documentoDao=e.get(ae),this.templateService=e.get(le),this.documentoService=e.get(Oe),this.modalWidth=1200,this.form=this.fh.FormBuilder({id:{default:""},tipo:{default:"HTML"},titulo:{default:""},conteudo:{default:""},link:{default:null},dataset:{default:void 0},datasource:{default:void 0},template:{default:void 0},template_id:{default:void 0}},this.cdRef,this.validate),this.join=["documentos.assinaturas.usuario"]}ngOnInit(){super.ngOnInit(),this.needSign=this.metadata?.needSign||this.needSign,this.extraTags=this.metadata?.extraTags||this.extraTags,this.especie=this.urlParams?.has("especie")?this.urlParams.get("especie"):this.metadata?.especie||this.especie,this.action=this.urlParams?.has("action")?this.urlParams.get("action")||"":this.action,this.documentoId=this.urlParams?.has("documentoId")?this.urlParams.get("documentoId")||void 0:this.documentoId,this.dataset=this.metadata?.dataset||this.dataset,this.datasource=this.metadata?.datasource||this.datasource,this.template=this.metadata?.template||this.template,this.tituloDefault=this.metadata?.titulo||this.tituloDefault,this.dao=["TCR"].includes(this.especie)?this.injector.get(ft):void 0}loadData(e,n){this.entity=e,this.viewInit&&!this.grid.editing&&!this.grid.adding&&(this.action=="new"&&this.grid.onAddItem(),this.action=="edit"&&this.grid.onEditItem(this.grid.selectById(this.documentoId||"")))}initializeData(e){this.entity=this.entity||{id:this.dao?.generateUuid(),documentos:[],documento_id:null},this.loadData(this.entity,this.form)}saveData(e){return v(this,null,function*(){return yield this.grid?.confirm(),this.entity})}get canEdit(){let e=this.grid?.selected;return this.canEditTemplate&&!e?.assinaturas?.length&&e?.tipo!="LINK"}editEndDocumento(e){}documentoDynamicButtons(e){let n=[],t=e;return!this.isNoPersist&&this.entity&&this.needSign(this.entity,t)&&n.push({hint:"Assinar",icon:"bi bi-pen",color:"secondary",onClick:this.signDocumento.bind(this)}),n}signDocumento(e){return v(this,null,function*(){yield this.documentoService.sign([e]),this.cdRef.detectChanges()})}addDocumento(){return v(this,null,function*(){return new Ve({id:this.dao.generateUuid(),entidade_id:this.auth.unidade?.entidade_id||null,tipo:"HTML",especie:this.especie,link:null,_status:"ADD",titulo:this.tituloDefault||"",dataset:this.dataset||null,datasource:this.datasource||null,template:this.metadata?.template.conteudo,template_id:this.metadata?.template.id,plano_trabalho_id:["TCR"].includes(this.especie)?this.entity.id:null})})}loadDocumento(e,n){return v(this,null,function*(){let t=n;this.form.patchValue({id:t?.id||"",tipo:t?.tipo||"HTML",titulo:t?.titulo||"",conteudo:t?.conteudo||"",link:t?.link,dataset:t?.dataset,datasource:t?.datasource,template:t?.template,template_id:t?.template_id}),this.cdRef.detectChanges()})}removeDocumento(e){return v(this,null,function*(){return(yield this.dialog.confirm("Exclui ?","Deseja realmente excluir?"))?(this.isNoPersist?e._status="DEL":yield this.dao.delete(e),!0):!1})}saveDocumento(e,n){return v(this,null,function*(){let t;if(this.form.markAllAsTouched(),this.form.valid){n.titulo=e.controls.titulo.value,n.conteudo=e.controls.conteudo.value,n.dataset=this.templateService.prepareDatasetToSave(n.dataset||[]),this.submitting=!0;try{t=this.isNoPersist?n:yield this.documentoDao.save(n),e.controls.id.setValue(t.id),n.id=t.id}catch(d){this.error(d.message?d.message:d)}finally{this.submitting=!1}this.cdRef.detectChanges()}return t})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["documentos"]],viewQuery:function(n,t){if(n&1&&T(w,5),n&2){let d;D(d=S())&&(t.grid=d.first)}},inputs:{cdRef:"cdRef",entity:"entity",noPersist:"noPersist",needSign:"needSign",extraTags:"extraTags",especie:"especie",dataset:"dataset",disabled:"disabled",canEditTemplate:"canEditTemplate",template:"template",datasource:"datasource",editingId:"editingId"},features:[A],decls:12,vars:18,consts:[["gridDocumentos",""],["panelDocumento",""],["panelDocumentoEdit",""],["documentoTemplate",""],[3,"items","form","editable","selectable","add","load","remove","save","editEnd","hasAdd","hasEdit","hasDelete"],["fullSizeOnEdit","",3,"size","noToolbar","template","editTemplate"],["title","#ID/Especie",3,"template"],["type","options","always","",3,"dynamicButtons"],["emptyDocumentMensage","Nenhum documento selecionado",3,"html"],[1,"row"],["label","T\xEDtulo",3,"size","control"],["label","Conte\xFAdo",3,"size","control","canEditTemplate","template","datasource"],[1,"col-12","text-wrap"],["icon","bi bi-hash",3,"color","label"],[3,"color","icon","label"],[3,"color","icon","label",4,"ngFor","ngForOf"],["onlyLink","",3,"documento"],["title","Assinaturas","small","","transparent","",4,"ngIf"],["title","Assinaturas","small","","transparent",""],[3,"url","hint",4,"ngFor","ngForOf"],[3,"url","hint"]],template:function(n,t){if(n&1&&(m(0,"grid",4,0)(2,"side-panel",5),f(3,Wi,3,2,"ng-template",null,1,b)(5,$i,4,8,"ng-template",null,2,b),s(),m(7,"columns")(8,"column",6),f(9,Zi,15,11,"ng-template",null,3,b),s(),c(11,"column",7),s()()),n&2){let d=g(4),h=g(6),H=g(10);l("items",t.items)("form",t.form)("editable",t.disabled?void 0:"true")("selectable",!0)("add",t.addDocumento.bind(t))("load",t.loadDocumento.bind(t))("remove",t.removeDocumento.bind(t))("save",t.saveDocumento.bind(t))("editEnd",t.editEndDocumento.bind(t))("hasAdd",!t.disabled)("hasEdit",t.canEdit)("hasDelete",!1),r(2),l("size",8)("noToolbar",t.editingId?"true":void 0)("template",d)("editTemplate",h),r(6),l("template",H),r(3),l("dynamicButtons",t.documentoDynamicButtons.bind(t))}},dependencies:[V,I,w,Q,U,W,B,L,me,se,re,Y,Bt]});let o=a;return o})();function to(o,a){o&1&&c(0,"toolbar")}function io(o,a){if(o&1&&(m(0,"h5"),p(1),s(),c(2,"document-preview",11)),o&2){let i=a.row;r(),E((i==null?null:i.titulo)||"Preview do template"),r(),l("html",i==null?null:i.conteudo)}}function oo(o,a){if(o&1&&(m(0,"div",12),c(1,"input-text",13)(2,"input-text",14),s(),m(3,"div"),c(4,"input-editor",15),s()),o&2){let i=u();r(),l("size",2)("control",i.form.controls.codigo),q("maxlength",250),r(),l("size",10)("control",i.form.controls.titulo),q("maxlength",250),r(2),l("size",12)("dataset",i.dataset)("control",i.form.controls.conteudo)}}function no(o,a){if(o&1&&c(0,"badge",19),o&2){let i=u().row;l("label",i.codigo)}}function ao(o,a){if(o&1&&(m(0,"small"),p(1),s(),c(2,"br")(3,"badge",16)(4,"badge",17),f(5,no,1,1,"badge",18)),o&2){let i=a.row,e=u();r(),E(i.titulo),r(2),l("label",i.numero),r(),l("icon",e.lookup.getIcon(e.lookup.TEMPLATE_ESPECIE,i.especie))("label",e.lookup.getValue(e.lookup.TEMPLATE_ESPECIE,i.especie))("color",e.lookup.getColor(e.lookup.TEMPLATE_ESPECIE,i.especie)),r(),l("ngIf",i.codigo==null?null:i.codigo.length)}}function ro(o,a){if(o&1&&c(0,"toolbar",20),o&2){let i=u();l("buttons",i.selectButtons)}}var qt=(()=>{let a=class a extends Me{constructor(e){super(e,de,he),this.injector=e,this.filterWhere=n=>[["especie","==",this.especie]],this.templateService=e.get(le),this.code="MOD_TEMP",this.modalWidth=1200,this.filter=this.fh.FormBuilder({}),this.form=this.fh.FormBuilder({codigo:{default:""},titulo:{default:""},conteudo:{default:""}})}onGridLoad(e){this.selectId&&e?.find(n=>n.id==this.selectId)&&this.grid.selectById(this.selectId)}ngOnInit(){return v(this,null,function*(){Ze(a.prototype,this,"ngOnInit").call(this),this.especie=this.urlParams?.has("especie")?this.urlParams.get("especie"):this.metadata?.especie||this.especie||"OUTRO",this.dataset=this.dataset||(yield this.templateService.dataset(this.especie)),this.title=this.lookup.getValue(this.lookup.TEMPLATE_ESPECIE,this.especie),this.selectId=this.queryParams?.selectId})}onTemplateSelect(e){let n=e||void 0;this.form.patchValue({codigo:n?.codigo||"",titulo:n?.titulo||"",conteudo:n?.conteudo||""}),this.cdRef.detectChanges()}addTemplate(){return v(this,null,function*(){return new de({codigo:"",conteudo:"",especie:this.especie,dataset:this.dataset,titulo:this.templateService.titulo(this.especie)})})}loadTemplate(e,n){return v(this,null,function*(){e.controls.codigo.setValue(n.codigo),e.controls.titulo.setValue(n.titulo),e.controls.conteudo.setValue(n.conteudo),this.cdRef.detectChanges()})}removeTemplate(e){return v(this,null,function*(){return(yield this.dialog.confirm("Exclui ?","Deseja realmente excluir?"))?(yield this.dao.delete(e),!0):!1})}saveTemplate(e,n){return v(this,null,function*(){let t;if(this.form.markAllAsTouched(),this.form.valid){n.codigo=e.controls.codigo.value,n.titulo=e.controls.titulo.value,n.conteudo=e.controls.conteudo.value,n.dataset=this.templateService.prepareDatasetToSave(this.dataset||[]),this.submitting=!0;try{t=yield this.dao.save(n,this.join)}catch(d){this.error(d.message?d.message:d)}finally{this.submitting=!1}this.cdRef.detectChanges()}return t})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["app-templates"]],viewQuery:function(n,t){if(n&1&&T(w,5),n&2){let d;D(d=S())&&(t.grid=d.first)}},inputs:{especie:"especie",dataset:"dataset"},features:[A],decls:15,vars:29,consts:[["panelTemplate",""],["panelTemplateEdit",""],["columnTemplate",""],["editable","",3,"dao","form","title","orderBy","groupBy","join","selectable","add","load","remove","save","hasAdd","hasEdit","hasDelete","loadList"],[4,"ngIf"],["hidden","",3,"deleted","form","where","submit","clear","collapseChange","collapsed"],["fullSizeOnEdit","",3,"size","template","editTemplate"],["title","Template",3,"template"],["type","options","always",""],[3,"rows"],[3,"buttons",4,"ngIf"],["emptyDocumentMensage","Nenhum template selecionado",3,"html"],[1,"row"],["label","C\xF3digo",3,"size","control"],["label","T\xEDtulo",3,"size","control"],["label","Preview do template",3,"size","dataset","control"],["icon","bi bi-hash","color","light",3,"label"],[3,"icon","label","color"],["icon","bi bi-tag",3,"label",4,"ngIf"],["icon","bi bi-tag",3,"label"],[3,"buttons"]],template:function(n,t){if(n&1&&(m(0,"grid",3),f(1,to,1,0,"toolbar",4),c(2,"filter",5),m(3,"side-panel",6),f(4,io,3,2,"ng-template",null,0,b)(6,oo,5,9,"ng-template",null,1,b),s(),m(8,"columns")(9,"column",7),f(10,ao,6,6,"ng-template",null,2,b),s(),c(12,"column",8),s(),c(13,"pagination",9),s(),f(14,ro,1,1,"toolbar",10)),n&2){let d=g(5),h=g(7),H=g(11);l("dao",t.dao)("form",t.form)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("selectable",t.selectable)("add",t.addTemplate.bind(t))("load",t.loadTemplate.bind(t))("remove",t.removeTemplate.bind(t))("save",t.saveTemplate.bind(t))("hasAdd",!0)("hasEdit",!0)("hasDelete",!0)("loadList",t.onGridLoad.bind(t)),r(),l("ngIf",!t.selectable),r(),l("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",!t.selectable&&t.filterCollapsed),r(),l("size",8)("template",d)("editTemplate",h),r(6),l("template",H),r(4),l("rows",t.rowsLimit),r(),l("ngIf",t.selectable&&!(t.grid!=null&&t.grid.editing))}},dependencies:[I,w,Q,U,Ne,ge,Et,W,L,se,re,Y]});let o=a;return o})();function so(o,a){if(o&1&&(m(0,"div",5)(1,"strong"),p(2),m(3,"small"),p(4),s()()(),m(5,"div",5)(6,"div",11),p(7),s()()),o&2){let i=a.row,e=u();r(2),_("#",i.numero,""),r(2),_(" \u2022 ",e.util.getDateTimeFormatted(i.data_registro),""),r(3),_(" ",i.mensagem," ")}}function mo(o,a){if(o&1&&c(0,"badge",17),o&2){let i=u().$implicit;l("label",i.data_leitura?"Lido":"N\xE3o lido")}}function co(o,a){if(o&1&&c(0,"badge",18),o&2){let i=u().$implicit;l("label",i.data_leitura?"Lido":"N\xE3o lido")}}function po(o,a){if(o&1&&c(0,"badge",19),o&2){let i=u().$implicit;l("label",i.data_leitura?"Lido":"N\xE3o lido")}}function uo(o,a){if(o&1&&(P(0),f(1,mo,1,1,"badge",14)(2,co,1,1,"badge",15)(3,po,1,1,"badge",16),k()),o&2){let i=a.$implicit;r(),l("ngIf",i.tipo=="PETRVS"),r(),l("ngIf",i.tipo=="EMAIL"),r(),l("ngIf",i.tipo=="WHATSAPP")}}function fo(o,a){if(o&1&&(m(0,"div",12),f(1,uo,4,3,"ng-container",13),s()),o&2){let i=a.row;r(),l("ngForOf",i.destinatarios)}}var Ut=(()=>{let a=class a extends Me{constructor(e){super(e,rt,mt),this.injector=e,this.toolbarButtons=[{icon:"bi bi-check-all",label:"Lido",color:"btn-outline-success",hint:"Marcar todas as notifica\xE7\xF5es como lido",onClick:this.onLidoClick.bind(this)}],this.filterWhere=n=>{let t=[],d=n.value;return t.push(["usuario_id","==",this.auth.usuario.id]),d.todas&&t.push(["todas","==",!0]),this.util.isDataValid(d.data_inicio)&&t.push(["data_registro",">=",d.data_inicio]),this.util.isDataValid(d.data_fim)&&t.push(["data_registro","<=",d.data_fim]),t},this.notificacaoService=e.get(dt),this.modalWidth=700,this.join=["destinatarios"],this.title=this.lex.translate("Notifica\xE7\xF5es"),this.filter=this.fh.FormBuilder({todas:{default:!1},data_inicio:{default:void 0},data_fim:{default:void 0}})}filterClear(e){e.controls.todas.setValue(!1),e.controls.data_inicio.setValue(void 0),e.controls.data_fim.setValue(void 0),super.filterClear(e)}onLidoClick(){let e=(this.grid?.items||[]).reduce((n,t)=>(n.push(...t.destinatarios.filter(d=>!d.data_leitura).map(d=>d.id)),n),[]);this.dao.marcarComoLido(e).then(n=>{this.grid.reloadFilter(),this.auth.usuario&&(this.auth.usuario.notificacoes_destinatario=[]),this.notificacaoService.updateNaoLidas()})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["notificacoes"]],viewQuery:function(n,t){if(n&1&&T(w,5),n&2){let d;D(d=S())&&(t.grid=d.first)}},features:[A],decls:14,vars:23,consts:[["mensagemTemplate",""],["formatoTemplate",""],[3,"dao","hasAdd","hasEdit","hasDelete","orderBy","groupBy","join"],[3,"buttons"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Todas","controlName","todas","labelInfo","Todas as notifica\xE7\xF5es incluindo as j\xE1 lidas",3,"size","control"],["label","In\xEDcio","controlName","data_inicio","labelInfo","Data in\xEDcio",3,"size","control"],["label","Fim","controlName","data_fim","labelInfo","Data fim",3,"size","control"],["title","Mensagens",3,"template"],["title","Envios",3,"template"],[1,"col-12","text-wrap"],[1,"text-wrap"],[4,"ngFor","ngForOf"],["img","assets/images/logo_24x24.png","hint","PETRVS",3,"label",4,"ngIf"],["icon","bi bi-envelope-at","hint","E-mail",3,"label",4,"ngIf"],["icon","bi bi-whatsapp","hint","WhatsApp",3,"label",4,"ngIf"],["img","assets/images/logo_24x24.png","hint","PETRVS",3,"label"],["icon","bi bi-envelope-at","hint","E-mail",3,"label"],["icon","bi bi-whatsapp","hint","WhatsApp",3,"label"]],template:function(n,t){if(n&1&&(m(0,"grid",2),c(1,"toolbar",3),m(2,"filter",4)(3,"div",5),c(4,"input-switch",6)(5,"input-datetime",7)(6,"input-datetime",8),s()(),m(7,"columns")(8,"column",9),f(9,so,8,3,"ng-template",null,0,b),s(),m(11,"column",10),f(12,fo,2,1,"ng-template",null,1,b),s()()()),n&2){let d=g(10),h=g(13);l("dao",t.dao)("hasAdd",!1)("hasEdit",!1)("hasDelete",!1)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join),r(),l("buttons",t.toolbarButtons),r(),l("deleted",t.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",t.filter)("where",t.filterWhere)("submit",t.filterSubmit.bind(t))("clear",t.filterClear.bind(t))("collapseChange",t.filterCollapseChange.bind(t))("collapsed",t.filterCollapsed),r(2),l("size",2)("control",t.filter.controls.todas),r(),l("size",5)("control",t.filter.controls.data_inicio),r(),l("size",5)("control",t.filter.controls.data_fim),r(2),l("template",d),r(3),l("template",h)}},dependencies:[V,I,w,Q,U,Ne,ge,te,Re,L]});let o=a;return o})();var Qt=(()=>{let a=class a{getItem(e){return this.itens[e]}constructor(e){this.lookup=e,this.itens={PlanoTrabalho:this.lookup.PLANO_TRABALHO_STATUS,PlanoEntrega:this.lookup.PLANO_ENTREGA_STATUS,Atividade:this.lookup.ATIVIDADE_STATUS,Consolidacao:this.lookup.CONSOLIDACAO_STATUS}}};a.\u0275fac=function(n){return new(n||a)(Ae(Z))},a.\u0275prov=De({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();var ho=()=>[];function go(o,a){o&1&&c(0,"input-textarea",5),o&2&&l("size",12)("rows",3)}var Gt=(()=>{let a=class a extends N{constructor(e){super(e),this.injector=e,this.novoStatus="",this.tipo="",this._exigeJustificativa=!1,this.validate=(n,t)=>{let d=null,h=n.value?.trim().length;return t=="justificativa"&&this._exigeJustificativa&&(h?(h<this.MIN_LENGTH_TEXT&&(d="Texto muito curto. M\xEDnimo: "+this.MIN_LENGTH_TEXT+" caracteres."),h>this.MAX_LENGTH_TEXT&&(d="Conte\xFAdo ("+h+" caracteres) excede o comprimento m\xE1ximo: "+this.MAX_LENGTH_TEXT+".")):d="Obrigat\xF3rio"),d},this.statusService=e.get(Qt),this.lookup=e.get(Z),this.modalWidth=450,this.form=this.fh.FormBuilder({justificativa:{default:""},novo_status:{default:null}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),this.tipo=this.metadata?.tipo,this.entity=this.metadata?.entity||this.entity,this._exigeJustificativa=this.metadata?.exigeJustificativa||this._exigeJustificativa,this.novoStatus=this.metadata?.novoStatus||this.novoStatus,this.novoStatus.length&&this.form?.controls.novo_status?.setValue(this.novoStatus)}onSubmitClick(){return v(this,null,function*(){if(this.metadata.onClick){this.loading=!0;try{let e=yield this.metadata.onClick(this.entity,this.form?.controls.justificativa.value);this.go.setModalResult(this.modalRoute?.queryParams?.idroute,e),this.close()}catch(e){this.error(e?.message||e?.error||e||"Erro desconhecido")}finally{this.loading=!1}}})}get exigeJustificativa(){if(this._exigeJustificativa)return!0;let e=this.lookup.getData(this.statusService.getItem(this.tipo),this.form?.controls.novo_status?.value);return this._exigeJustificativa=(e?.justificar||[]).includes(this.entity?.status),this._exigeJustificativa}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["app-status"]],viewQuery:function(n,t){if(n&1&&T(O,5),n&2){let d;D(d=S())&&(t.editableForm=d.first)}},features:[A],decls:6,vars:6,consts:[["confirmLabel","Confirmar",3,"submit","cancel","form"],[1,"row"],[1,"row","mb-4"],["label","Novo status","icon","","controlName","novo_status",3,"size","items","disabled"],["label","Justificativa","controlName","justificativa",3,"size","rows",4,"ngIf"],["label","Justificativa","controlName","justificativa",3,"size","rows"]],template:function(n,t){n&1&&(m(0,"editable-form",0),R("submit",function(){return t.onSubmitClick()})("cancel",function(){return t.onCancel()}),m(1,"div",1)(2,"div",2),c(3,"input-select",3),s(),m(4,"div",1),f(5,go,1,2,"input-textarea",4),s()()()),n&2&&(l("form",t.form),r(3),l("size",12)("items",t.statusService.getItem(t.tipo)||ue(5,ho))("disabled",t.novoStatus.length?"true":void 0),r(2),l("ngIf",t.exigeJustificativa))},dependencies:[I,O,_e,He]});let o=a;return o})();var _o=()=>["HTML","REPORT"];function vo(o,a){o&1&&c(0,"top-alert",3)}function bo(o,a){if(o&1&&c(0,"document-preview",4),o&2){let i=u();l("html",(i.documento==null?null:i.documento.conteudo)||"")}}var Jt=(()=>{let a=class a extends N{constructor(e){super(e),this.injector=e,this.documentoSalvo=!1,this.buttons=[{icon:"bi bi-floppy",hint:"Salvar documento",color:"btn-outline-info border-0",onClick:()=>this.salvarParaUsuario(),id:"salvarDocumento"},{icon:"bi bi-printer",hint:"Imprimir",color:"btn-outline-secondary border-0",onClick:()=>this.imprimir()},{icon:"bi bi-envelope-at",hint:"Enviar E-mail",color:"btn-outline-warning border-0"},{icon:"bi bi-file-earmark-pdf",hint:"Exportar PDF",color:"btn-outline-danger border-0",onClick:()=>this.geraPDF()},{icon:"bi bi-whatsapp",hint:"Enviar WhatsApp",color:"btn-outline-success border-0"},{img:"assets/images/sei_icon.png",hint:"Enviar SEI",color:"btn-outline-primary border-0"}],this.validate=(n,t)=>null,this.documentoDao=e.get(ae),this.modalWidth=1e3,this.form=this.fh.FormBuilder({conteudo:{default:""}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit(),v(this,null,function*(){this.loading=!0;try{if(this.documentoId=this.documentoId||this.metadata?.documentoId||this.urlParams?.get("documentoId"),this.documento=this.documento||this.metadata?.documento||(yield this.dao.getById(this.documentoId)),this.documento?.assinaturas?.length){let e="<div style='display:block; '><br><hr><h5>Assinatura(s):</h5>";this.documento?.assinaturas.forEach(n=>{e+=`<div class='mb-2'><p class="m-0"><b>${n.usuario?.nome}</b></p><small>${this.util.getDateTimeFormatted(n.data_assinatura)}<br>${n.assinatura}</small></div>`}),e+="</div>",this.documento.conteudo?.includes(e)||(this.documento.conteudo=this.documento.conteudo?.concat(e)||null)}this.cdRef.detectChanges()}finally{this.loading=!1}})}salvarParaUsuario(){this.documento&&this.documentoDao.update(this.documento.id,{usuario_id:this.auth.usuario?.id}).then(e=>{this.documentoSalvo=!0;let n=this.buttons.find(t=>t.id=="salvarDocumento");n&&(n.disabled=!0)})}geraPDF(){this.documento&&this.documentoDao.gerarPDF(this.documento.id).then(e=>{})}imprimir(){window.print()}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["documentos-preview"]],inputs:{documentoId:"documentoId",documento:"documento"},features:[A],decls:4,vars:5,consts:[[3,"title","buttons"],["type","success","message","Documento foi salvo com sucesso!",4,"ngIf"],["emptysDocumentMensage","Vazio",3,"html",4,"ngIf"],["type","success","message","Documento foi salvo com sucesso!"],["emptysDocumentMensage","Vazio",3,"html"]],template:function(n,t){n&1&&(c(0,"toolbar",0),f(1,vo,1,0,"top-alert",1),c(2,"separator"),f(3,bo,1,1,"document-preview",2)),n&2&&(l("title",(t.documento==null?null:t.documento.titulo)||"")("buttons",t.buttons),r(),l("ngIf",t.documentoSalvo),r(2),l("ngIf",(t.documento==null?null:t.documento.tipo)&&ue(4,_o).includes(t.documento.tipo)))},dependencies:[I,ge,B,Nt,Y]});let o=a;return o})();var Co=[{path:"comentarios/:origem/:id/new",component:jt,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Coment\xE1rios",modal:!0}},{path:"documentos/assinar",component:Vt,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Assinar",modal:!0}},{path:"documentos/preview/:documentoId",component:Jt,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Preview",modal:!0}},{path:"documentos/:especie/:id",component:Le,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Documentos",modal:!0}},{path:"documentos/:especie/:id/:action",component:Le,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Documentos",modal:!0}},{path:"documentos/:especie/:id/:action/:documentoId",component:Le,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Documentos",modal:!0}},{path:"status",component:Gt,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Altera\xE7\xE3o de Status",modal:!0}},{path:"notificacoes",component:Ut,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Notifica\xE7\xF5es",modal:!0}},{path:"templates/:especie",component:qt,canActivate:[ee],resolve:{config:ie},runGuardsAndResolvers:"always",data:{title:"Templates",modal:!0}}],Wt=(()=>{let a=class a{};a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=we({type:a}),a.\u0275inj=Se({imports:[Ge.forChild(Co),Ge]});let o=a;return o})();var Ya=(()=>{let a=class a{set disabled(e){this._disabled!=e&&(this._disabled=e,this.loadExpediente())}get disabled(){return this._disabled}set control(e){this._control!=e&&(this._control=e,this.expediente=this.control?.value,e?.valueChanges.subscribe(n=>v(this,null,function*(){this.expediente=n})))}get control(){return this._control}set expediente(e){this._expediente!=e&&(this._expediente=e,this.loadExpediente())}get expediente(){return this._expediente}constructor(e,n,t){this.fh=e,this.cdRef=n,this.util=t,this.diasSemana=["domingo","segunda","terca","quarta","quinta","sexta","sabado"],this.validate=(d,h)=>{let H=null;for(let $ of this.diasSemana)if(h.startsWith($)&&h.endsWith("_fim")&&d?.value?.length){let ye=this.form?.controls[$+"_inicio"]?.value;if(!this.util.isTimeValid(ye)||!this.util.isTimeValid(d.value)||this.util.getStrTimeHours(ye)>this.util.getStrTimeHours(d.value))return"Inv\xE1lido"}return H},this.form=e.FormBuilder({domingo:{default:[]},segunda:{default:[]},terca:{default:[]},quarta:{default:[]},quinta:{default:[]},sexta:{default:[]},sabado:{default:[]},especial:{default:[]},domingo_inicio:{default:""},domingo_fim:{default:""},segunda_inicio:{default:""},segunda_fim:{default:""},terca_inicio:{default:""},terca_fim:{default:""},quarta_inicio:{default:""},quarta_fim:{default:""},quinta_inicio:{default:""},quinta_fim:{default:""},sexta_inicio:{default:""},sexta_fim:{default:""},sabado_inicio:{default:""},sabado_fim:{default:""},especial_inicio:{default:""},especial_fim:{default:""},especial_data:{default:null},especial_sem:{default:!1}},this.cdRef,this.validate)}ngOnInit(){}get isDisabled(){return this._disabled!=null}loadExpediente(){let e=(this.isDisabled?this.expedienteDisabled:this._expediente)||new We,n=(t,d)=>t.map(h=>Object.assign({},{key:this.util.textHash((d=="especial"?this.util.getDateFormatted(h.data):"")+d+h.inicio+h.fim),value:(d=="especial"?this.util.getDateFormatted(h.data)+" - ":"")+h.inicio+" at\xE9 "+h.fim,data:{inicio:h.inicio,fim:h.fim,data:h.data,sem:h.sem}}));this.isDisabled||(this._expediente=e),this.form.controls.domingo.setValue(n(e.domingo,"domingo")),this.form.controls.segunda.setValue(n(e.segunda,"segunda")),this.form.controls.terca.setValue(n(e.terca,"terca")),this.form.controls.quarta.setValue(n(e.quarta,"quarta")),this.form.controls.quinta.setValue(n(e.quinta,"quinta")),this.form.controls.sexta.setValue(n(e.sexta,"sexta")),this.form.controls.sabado.setValue(n(e.sabado,"sabado")),this.form.controls.especial.setValue(n(e.especial,"especial"))}saveExpediente(){this.isDisabled||(this._expediente=this._expediente||new We,this._expediente.domingo=this.form.controls.domingo.value.map(e=>e.data),this._expediente.segunda=this.form.controls.segunda.value.map(e=>e.data),this._expediente.terca=this.form.controls.terca.value.map(e=>e.data),this._expediente.quarta=this.form.controls.quarta.value.map(e=>e.data),this._expediente.quinta=this.form.controls.quinta.value.map(e=>e.data),this._expediente.sexta=this.form.controls.sexta.value.map(e=>e.data),this._expediente.sabado=this.form.controls.sabado.value.map(e=>e.data),this._expediente.especial=this.form.controls.especial.value.map(e=>e.data),this.control&&(this.control.setValue(this._expediente),this.cdRef.detectChanges()))}isEmpty(){return!1}addItemHandleDomingo(){return this.addItemHandle("domingo")}addItemHandleSegunda(){return this.addItemHandle("segunda")}addItemHandleTerca(){return this.addItemHandle("terca")}addItemHandleQuarta(){return this.addItemHandle("quarta")}addItemHandleQuinta(){return this.addItemHandle("quinta")}addItemHandleSexta(){return this.addItemHandle("sexta")}addItemHandleSabado(){return this.addItemHandle("sabado")}addItemHandleEspecial(){return this.addItemHandle("especial")}onChange(){this.saveExpediente()}addItemHandle(e){let n,t=this.form.controls[e+"_inicio"].value,d=this.form.controls[e+"_fim"].value,h=this.form.controls.especial_data.value,H=this.form.controls.especial_sem.value,$=this.util.textHash((e=="especial"?this.util.getDateFormatted(h):"")+e+t+d),ye=this.form.controls[e].value;return this.util.isTimeValid(t)&&this.util.isTimeValid(d)&&this.util.getStrTimeHours(t)<this.util.getStrTimeHours(d)&&(e!="especial"||h)&&this.util.validateLookupItem(this.form.controls[e].value,$)&&(n={key:$,value:(e=="especial"?this.util.getDateFormatted(h)+" - ":"")+t+" at\xE9 "+d,data:{inicio:t,fim:d,data:h,sem:H}}),ye.length>0&&ye.forEach(Ye=>{let X=Ye.data.inicio,Te=Ye.data.fim;(t>=X&&d<=X||t<=X&&d>=X||t>=X&&d<=X||t<=X&&d>=Te||t>=X&&t<=Te||d>=X&&d<=Te||t==Te||d==X)&&(console.log("Conflitante"),n=void 0)}),this.form.controls[e+"_inicio"].setValue(""),this.form.controls[e+"_fim"].setValue(""),e=="especial"&&(this.form.controls[e+"_data"].setValue(null),this.form.controls[e+"_sem"].setValue(!1)),n}};a.\u0275fac=function(n){return new(n||a)(y(ke),y(K),y(fe))},a.\u0275cmp=C({type:a,selectors:[["calendar-expediente"]],inputs:{expedienteDisabled:"expedienteDisabled",disabled:"disabled",control:"control",expediente:"expediente"},decls:28,vars:76,consts:[[1,"row"],["label","Domingo","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","domingo_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","domingo_fim",3,"size","control"],["label","Segunda","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","segunda_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","segunda_fim",3,"size","control"],["label","Ter\xE7a","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","terca_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","terca_fim",3,"size","control"],["label","Quarta","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","quarta_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","quarta_fim",3,"size","control"],["label","Quinta","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","quinta_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","quinta_fim",3,"size","control"],["label","Sexta","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","sexta_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","sexta_fim",3,"size","control"],["label","Sabado","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","sabado_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","sabado_fim",3,"size","control"],["label","Especial","hostClass","col-12 col-md-3",3,"disabled","control","size","addItemHandle","change"],["noIcon","","date","","label","Dia","controlName","especial_data",3,"size","control"],["label","Sem","controlName","especial_sem","labelInfo","Sem expediente. Se o hor\xE1rio ir\xE1 representar um per\xEDodo que n\xE1o haver\xE1 expediente.",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","In\xEDcio","hostClass","pe-0","controlName","especial_inicio",3,"size","control"],["noIcon","","noIndicator","","time","","time24hours","","label","Fim","hostClass","ps-0","controlName","especial_fim",3,"size","control"]],template:function(n,t){n&1&&(m(0,"div",0)(1,"input-multiselect",1),c(2,"input-datetime",2)(3,"input-datetime",3),s(),m(4,"input-multiselect",4),c(5,"input-datetime",5)(6,"input-datetime",6),s(),m(7,"input-multiselect",7),c(8,"input-datetime",8)(9,"input-datetime",9),s(),m(10,"input-multiselect",10),c(11,"input-datetime",11)(12,"input-datetime",12),s()(),m(13,"div",0)(14,"input-multiselect",13),c(15,"input-datetime",14)(16,"input-datetime",15),s(),m(17,"input-multiselect",16),c(18,"input-datetime",17)(19,"input-datetime",18),s(),m(20,"input-multiselect",19),c(21,"input-datetime",20)(22,"input-datetime",21),s(),m(23,"input-multiselect",22),c(24,"input-datetime",23)(25,"input-switch",24)(26,"input-datetime",25)(27,"input-datetime",26),s()()),n&2&&(r(),l("disabled",t.disabled)("control",t.form.controls.domingo)("size",3)("addItemHandle",t.addItemHandleDomingo.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.domingo_inicio),r(),l("size",6)("control",t.form.controls.domingo_fim),r(),l("disabled",t.disabled)("control",t.form.controls.segunda)("size",3)("addItemHandle",t.addItemHandleSegunda.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.segunda_inicio),r(),l("size",6)("control",t.form.controls.segunda_fim),r(),l("disabled",t.disabled)("control",t.form.controls.terca)("size",3)("addItemHandle",t.addItemHandleTerca.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.terca_inicio),r(),l("size",6)("control",t.form.controls.terca_fim),r(),l("disabled",t.disabled)("control",t.form.controls.quarta)("size",3)("addItemHandle",t.addItemHandleQuarta.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.quarta_inicio),r(),l("size",6)("control",t.form.controls.quarta_fim),r(2),l("disabled",t.disabled)("control",t.form.controls.quinta)("size",3)("addItemHandle",t.addItemHandleQuinta.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.quinta_inicio),r(),l("size",6)("control",t.form.controls.quinta_fim),r(),l("disabled",t.disabled)("control",t.form.controls.sexta)("size",3)("addItemHandle",t.addItemHandleSexta.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.sexta_inicio),r(),l("size",6)("control",t.form.controls.sexta_fim),r(),l("disabled",t.disabled)("control",t.form.controls.sabado)("size",3)("addItemHandle",t.addItemHandleSabado.bind(t))("change",t.onChange.bind(t)),r(),l("size",6)("control",t.form.controls.sabado_inicio),r(),l("size",6)("control",t.form.controls.sabado_fim),r(),l("disabled",t.disabled)("control",t.form.controls.especial)("size",3)("addItemHandle",t.addItemHandleEspecial.bind(t))("change",t.onChange.bind(t)),r(),l("size",8)("control",t.form.controls.especial_data),r(),l("size",4)("control",t.form.controls.especial_sem),r(),l("size",6)("control",t.form.controls.especial_inicio),r(),l("size",6)("control",t.form.controls.especial_fim))},dependencies:[te,Re,At]});let o=a;return o})();var yo=["numeroProcesso"],Io=["numeroDocumento"],Eo=["tipoProcesso"],xo=["tipoDocumento"];function To(o,a){if(o&1){let i=G();m(0,"editable-form",5),c(1,"separator",6),m(2,"separator",7)(3,"div",8)(4,"input-button",9,0),R("buttonClick",function(n){M(i);let t=u();return j(t.onNumeroProcessoClick(n))}),s(),c(6,"input-search",10,1),s(),m(8,"div",8)(9,"input-button",11,2),R("buttonClick",function(n){M(i);let t=u();return j(t.onNumeroDocumentoClick(n))}),s(),c(11,"input-search",12,3),s(),m(13,"div",8),c(14,"input-text",13),s()()()}if(o&2){let i=u();l("form",i.form),r(4),l("size",4)("control",i.form.controls.numero_processo)("disabled",!i.gb.isEmbedded||i.form.controls.numero_documento.value!=null&&i.form.controls.numero_documento.value.length?"true":void 0),r(2),l("label",i.lex.translate("Tipo de Processo"))("size",8)("dao",i.tipoProcessoDao),r(3),l("size",4)("control",i.form.controls.numero_requisicao)("disabled",i.gb.isEmbedded?void 0:"true"),r(2),l("label",i.lex.translate("Tipo de Documento"))("size",8)("dao",i.tipoDocumentoDao),r(3),l("size",12)("control",i.form.controls.titulo_documento),q("maxlength",250)}}var dr=(()=>{let a=class a extends N{set documento(e){this._entity!=e&&(this._entity=e,e&&this.loadData(e))}get documento(){if(this._entity){this.loadEntity(this.form.value);let e=!!this._entity.link?.id_processo;return this._entity._status=!e&&this._entity._status!="ADD"?"DEL":e&&!this._entity._status?"EDIT":this._entity._status,!e&&this._entity._status=="ADD"?void 0:this._entity}}set sei(e){this._sei!=e&&(this._sei=e,e&&(this.form?.controls.id_processo.setValue(e.id_processo||0),this.form?.controls.numero_processo.setValue(e.numero_processo||""),this.form?.controls.id_documento.setValue(e.id_documento||0),this.form?.controls.numero_documento.setValue(e.numero_documento||""),e.numero_documento?this.onNumeroDocumentoClick(new Event("click")):e.numero_processo&&this.onNumeroProcessoClick(new Event("click"))))}get sei(){return this._sei}constructor(e){super(e),this.injector=e,this.validate=(n,t)=>null,this.documentoDao=e.get(ae),this._entity=new Ve({tipo:"LINK",especie:"SEI",link:{tipo:"SEI",id_processo:null,numero_processo:"",id_documento:null,numero_documento:"",titulo_documento:""},_status:"ADD"}),this.allPages=e.get(Tt),this.tipoDocumentoDao=e.get(gt),this.tipoProcessoDao=e.get(_t),this.form=this.fh.FormBuilder({tipo:{default:"URL"},url:{default:""},id_processo:{default:0},numero_processo:{default:""},id_documento:{default:0},numero_documento:{default:""},tipo_processo_id:{default:null},tipo_documento_id:{default:null},titulo_documento:{default:""}},this.cdRef,this.validate)}loadData(e){e&&(e.tipo="LINK"),this.form.patchValue(e?.link||{})}loadEntity(e){this.util.fillForm(this._entity.link,e)}get isSei(){return this._entity?.tipo=="SEI"}isEmpty(){let e=this.form.value;return!this.form.valid||e.tipo=="URL"&&!e.url?.length||e.tipo=="SEI"&&(!e.numero_processo?.length||!e.numero_processo?.length)}onNumeroDocumentoClick(e){return v(this,null,function*(){let n=this.form?.controls.numero_documento?.value;if(n?.length){this.numeroDocumento.loading=!0;try{let t=yield this.allPages.getDadosDocumento(n);if(t){let d=null,h=null;if(t.processo?.tipo_processo){let H=yield this.tipoProcessoDao.query({where:[["codigo","=",t.processo?.tipo_processo]]}).asPromise();H[0]&&(this.tipoProcesso?.loadSearch(H[0]),d=H[0].id)}if(t.documento?.tipo_documento){let H=yield this.tipoDocumentoDao.query({where:[["nome","=",t.documento?.tipo_documento]]}).asPromise();H[0]&&(this.tipoDocumento?.loadSearch(H[0]),h=H[0].id)}Object.assign(this._entity.link,{id_processo:t.processo?.id_processo,numero_processo:t.processo?.numero_processo,id_documento:t.documento?.id_documento,numero_documento:t.documento?.numero_documento,tipo_processo_id:d,tipo_documento_requisicao_id:h,titulo_documento:t.documento?.titulo_documento}),this._entity.titulo=t.documento?.titulo_documento,this.loadData(this._entity)}else throw new Error("Documento n\xE3o encontrado")}catch{this.dialog.alert("Error","Imposs\xEDvel encontrar o documento informado. Tente incluir diretamente pelo bot\xE3o 'Incluir atividade' acessando o documento no Sei!")}finally{this.numeroDocumento.loading=!1}}})}onNumeroProcessoClick(e){return v(this,null,function*(){let n=this.form?.controls.numero_processo?.value;if(n?.length){this.numeroProcesso.loading=!0;try{let t=yield this.allPages.getDadosProcesso(n);if(t){let d=null;if(t.processo?.tipo_processo){let h=yield this.tipoProcessoDao.query({where:[["codigo","=",t.processo?.tipo_processo]]}).asPromise();h[0]&&(this.tipoProcesso?.loadSearch(h[0]),d=h[0].id)}Object.assign(this._entity.link,{id_processo:t.processo?.id_processo,numero_processo:t.processo?.numero_processo,id_documento:0,numero_documento:"",tipo_processo_id:d,tipo_documento_requisicao_id:null,titulo_documento:""}),this._entity.title="Processo "+t.processo?.numero_processo,this.loadData(this._entity)}else throw new Error("Processo n\xE3o encontrado")}catch{this.dialog.alert("Error","Imposs\xEDvel encontrar o processo informado. Tente incluir diretamente pelo bot\xE3o 'Incluir atividade' acessando o processo no Sei!")}finally{this.numeroProcesso.loading=!1}}})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["documento-link"]],viewQuery:function(n,t){if(n&1&&(T(O,5),T(yo,5),T(Io,5),T(Eo,5),T(xo,5)),n&2){let d;D(d=S())&&(t.editableForm=d.first),D(d=S())&&(t.numeroProcesso=d.first),D(d=S())&&(t.numeroDocumento=d.first),D(d=S())&&(t.tipoProcesso=d.first),D(d=S())&&(t.tipoDocumento=d.first)}},inputs:{documento:"documento",sei:"sei"},features:[A],decls:1,vars:1,consts:[["numeroProcesso",""],["tipoProcesso",""],["numeroDocumento",""],["tipoDocumento",""],["noButtons","","confirmLabel","Assinar",3,"form",4,"ngIf"],["noButtons","","confirmLabel","Assinar",3,"form"],["title","Sei"],["transparent","","bottom",""],[1,"row"],["label","N\xFAmero Processo","controlName","numero_processo","labelInfo","N\xFAmero do processo, com a formata\xE7\xE3o de origem",3,"buttonClick","size","control","disabled"],["controlName","tipo_processo_id","disabled","",3,"label","size","dao"],["label","'N\xFAmero Documento","controlName","numero_documento","labelInfo","Numero do documento, caso seja o Sei \xE9 o numero Sei",3,"buttonClick","size","control","disabled"],["controlName","tipo_documento_id","disabled","",3,"label","size","dao"],["label","T\xEDtulo do documento","controlName","titulo_documento","disabled","","labelInfo","T\xEDtulo do documento no Sei",3,"size","control"]],template:function(n,t){n&1&&f(0,To,15,16,"editable-form",4),n&2&&l("ngIf",t.isSei||t.gb.isEmbedded)},dependencies:[I,O,St,Dt,W,B]});let o=a;return o})();function Do(o,a){if(o&1&&(m(0,"div",8)(1,"h5",9),p(2),s(),c(3,"hr")(4,"document-preview",10),s()),o&2){let i=a.row;r(2),E((i==null?null:i.titulo)||"Preview do template"),r(2),l("html",i==null?null:i.conteudo)}}function So(o,a){if(o&1&&(m(0,"div",11),c(1,"input-text",12)(2,"input-text",13),s(),m(3,"div"),c(4,"input-editor",14),s()),o&2){let i=u(2);r(),l("size",2)("control",i.form.controls.codigo),q("maxlength",250),r(),l("size",10)("control",i.form.controls.titulo),q("maxlength",250),r(2),l("size",12)("dataset",i.dataset)("control",i.form.controls.conteudo)}}function Ao(o,a){if(o&1&&c(0,"badge",21),o&2){let i=u().row;l("label",i.codigo)}}function wo(o,a){if(o&1&&c(0,"badge",22),o&2){let i=u(3);l("icon",i.entityService.getIcon("Entidade"))("label",i.lex.translate("Entidade"))}}function Po(o,a){if(o&1&&c(0,"badge",23),o&2){let i=u(3);l("icon",i.entityService.getIcon("Unidade"))("label",i.lex.translate("Unidade"))}}function ko(o,a){if(o&1){let i=G();m(0,"div",11)(1,"div",15)(2,"input-switch",16),R("change",function(){let n=M(i).row,t=u(2);return j(t.onNotificarChange(n))}),s()(),m(3,"div",17)(4,"small"),p(5),s()()(),f(6,Ao,1,1,"badge",18)(7,wo,1,2,"badge",19)(8,Po,1,2,"badge",20)}if(o&2){let i=a.row;r(2),l("size",12)("source",i._metadata),r(3),E(i.titulo),r(),l("ngIf",i.codigo==null?null:i.codigo.length),r(),l("ngIf",i.entidade_id==null?null:i.entidade_id.length),r(),l("ngIf",i.unidade_id==null?null:i.unidade_id.length)}}function Fo(o,a){if(o&1&&(m(0,"grid",4)(1,"side-panel",5),f(2,Do,5,2,"ng-template",null,0,b)(4,So,5,9,"ng-template",null,1,b),s(),m(6,"columns")(7,"column",6),f(8,ko,9,6,"ng-template",null,2,b),s(),c(10,"column",7),s()()),o&2){let i=g(3),e=g(5),n=g(9),t=u();l("items",t.items)("form",t.form)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("selectable",!0)("load",t.loadTemplate.bind(t))("remove",t.removeTemplate.bind(t))("save",t.saveTemplate.bind(t))("hasAdd",!1)("hasEdit",!1)("hasDelete",!1),r(),l("size",8)("template",i)("editTemplate",e),r(6),l("template",n),r(3),l("dynamicButtons",t.dynamicButtons.bind(t))}}var $t=(()=>{let a=class a extends N{set entity(e){super.entity=e}get entity(){return super.entity}set source(e){this._source!=e&&(this._source=e,this.items=this.templateService.buildItems(this.source,this.entity?.notificacoes_templates||[],this.entity?.notificacoes?.nao_notificar),this.cdRef.detectChanges())}get source(){return this._source}constructor(e){super(e),this.injector=e,this.items=[],this._source=[],this.cdRef=e.get(K),this.dao=e.get(he),this.templateService=e.get(le),this.code="MOD_NOTF_TEMP",this.form=this.fh.FormBuilder({codigo:{default:""},titulo:{default:""},conteudo:{default:""}})}dynamicButtons(e){let n=[],t=this.unidadeId?.length&&this.unidadeId==e.unidade_id||this.entidadeId?.length&&this.entidadeId==e.entidade_id;return(this.unidadeId?.length||this.entidadeId?.length)&&n.push({hint:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:this.grid?.onEditItem.bind(this.grid)}),t&&n.push({hint:"Limpar",icon:"bi bi-x-circle",color:"btn-outline-danger",onClick:this.grid?.onDeleteItem.bind(this.grid)}),n}loadTemplate(e,n){return v(this,null,function*(){this.dataset=yield this.templateService.dataset("NOTIFICACAO",n.codigo),e.controls.codigo.setValue(n.codigo),e.controls.titulo.setValue(n.titulo),e.controls.conteudo.setValue(n.conteudo),this.cdRef.detectChanges()})}removeTemplate(e){return v(this,null,function*(){let n=this.entity.notificacoes_templates?.find(t=>t.id==e.id);return n&&(n._status="DELETE",this.items=this.templateService.buildItems(this.source,this.entity.notificacoes_templates||[],this.entity?.notificacoes?.nao_notificar),this.cdRef.detectChanges()),!1})}onNotificarChange(e){!e._metadata?.notificar&&!this.entity?.notificacoes?.nao_notificar?.includes(e.codigo)?this.entity?.notificacoes?.nao_notificar?.push(e.codigo):e._metadata?.notificar&&this.entity?.notificacoes?.nao_notificar?.includes(e.codigo)&&this.entity?.notificacoes?.nao_notificar?.splice(this.entity?.notificacoes?.nao_notificar?.indexOf(e.codigo),1)}saveTemplate(e,n){return v(this,null,function*(){let t;if(this.form.markAllAsTouched(),this.form.valid)if(this.unidadeId?.length&&this.unidadeId==n.unidade_id||this.entidadeId?.length&&this.entidadeId==n.entidade_id)n.codigo=e.controls.codigo.value,n.titulo=e.controls.titulo.value,n.conteudo=e.controls.conteudo.value,n.dataset=this.dataset,n._status=n._status=="ADD"?"ADD":"EDIT";else{let h=new de({id:this.dao.generateUuid(),codigo:e.controls.codigo.value,titulo:e.controls.titulo.value,conteudo:e.controls.conteudo.value,dataset:this.dataset,especie:"NOTIFICACAO",entidade_id:this.entidadeId||null,unidade_id:this.unidadeId||null,_status:"ADD",_metadata:{notificar:!0}});this.entity.notificacoes_templates=this.entity.notificacoes_templates||[],this.entity.notificacoes_templates.push(h),this.entity.notificacoes?.nao_notificar?.includes(h.codigo)&&this.entity.notificacoes?.nao_notificar?.splice(this.entity.notificacoes?.nao_notificar?.indexOf(h.codigo),1),this.items=this.templateService.buildItems(this.source,this.entity.notificacoes_templates||[],this.entity?.notificacoes?.nao_notificar),this.cdRef.detectChanges()}return t})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["notificacoes-template"]],viewQuery:function(n,t){if(n&1&&T(w,5),n&2){let d;D(d=S())&&(t.grid=d.first)}},inputs:{cdRef:"cdRef",entity:"entity",entidadeId:"entidadeId",unidadeId:"unidadeId",source:"source"},features:[A],decls:1,vars:1,consts:[["panelTemplate",""],["panelTemplateEdit",""],["columnTemplate",""],["editable","",3,"items","form","title","orderBy","groupBy","join","selectable","load","remove","save","hasAdd","hasEdit","hasDelete",4,"ngIf"],["editable","",3,"items","form","title","orderBy","groupBy","join","selectable","load","remove","save","hasAdd","hasEdit","hasDelete"],["fullSizeOnEdit","",3,"size","template","editTemplate"],["title","Template",3,"template"],["type","options","always","",3,"dynamicButtons"],[1,"h-100","ps-3","contentTemplte"],[1,"pt-3","m-0"],["emptyDocumentMensage","Nenhum template selecionado",3,"html"],[1,"row"],["label","C\xF3digo",3,"size","control"],["label","T\xEDtulo",3,"size","control"],["label","Preview do template",3,"size","dataset","control"],[1,"col-md-2"],["scale","small","path","notificar",3,"change","size","source"],[1,"col-md-10"],["color","light","icon","bi bi-tag",3,"label",4,"ngIf"],["color","primary",3,"icon","label",4,"ngIf"],["color","success",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-tag",3,"label"],["color","primary",3,"icon","label"],["color","success",3,"icon","label"]],template:function(n,t){n&1&&f(0,Fo,11,18,"grid",3),n&2&&l("ngIf",t.viewInit)},dependencies:[I,w,Q,U,te,W,L,se,re,Y],styles:[".contentTemplte[_ngcontent-%COMP%]{border-left:1px solid #e3e3e3}"]});let o=a;return o})();var xe=class extends Pe{constructor(a){super(),this.data_avaliacao=new Date,this.nota=0,this.justificativa=null,this.recurso=null,this.justificativas=[],this.entregas_checklist=[],this.avaliador_id="",this.plano_trabalho_consolidacao_id=null,this.plano_entrega_id=null,this.tipo_avaliacao_id="",this.initialization(a)}};var Xt=(()=>{let a=class a{constructor(e){this.lookup=e}getValorMeta(e){let n="";switch(e.entrega?.tipo_indicador){case"PORCENTAGEM":n=e.meta.porcentagem+" %";break;case"QUANTIDADE":n=e.meta.quantitativo+"";break;case"VALOR":n=e.meta.valor+"";break;case"QUALITATIVO":n=this.lookup.getValue(e.entrega.lista_qualitativos||[],e.meta.qualitativo);break;default:n="Indicador desconhecido"}return n}getValorRealizado(e){let n="";switch(e.entrega?.tipo_indicador){case"PORCENTAGEM":n=e.realizado.porcentagem+" %";break;case"QUANTIDADE":n=e.realizado.quantitativo+"";break;case"VALOR":n=e.realizado.valor+"";break;case"QUALITATIVO":n=this.lookup.getValue(e.entrega.lista_qualitativos||[],e.realizado.qualitativo);break;default:n="Indicador desconhecido"}return n}getValor(e){return typeof e.porcentagem<"u"?e.porcentagem:typeof e.qualitativo<"u"?e.qualitativo:typeof e.quantitativo<"u"?e.quantitativo:typeof e.valor<"u"?e.valor:0}getEntregaValor(e,n){let t={};return e.tipo_indicador=="PORCENTAGEM"&&(t.porcentagem=n),e.tipo_indicador=="QUALITATIVO"&&(t.qualitativo=n),e.tipo_indicador=="QUANTIDADE"&&(t.quantitativo=n),e.tipo_indicador=="VALOR"&&(t.valor=n),t}isPorcentagem(e){return e.entrega?.tipo_indicador=="PORCENTAGEM"}isAtivo(e){return this.isValido(e)&&e.status=="ATIVO"}isValido(e){return!e.deleted_at&&e.status!="CANCELADO"&&!e.data_arquivamento}situacaoPlano(e){return e.deleted_at?"EXCLUIDO":e.data_arquivamento?"ARQUIVADO":e.status}};a.\u0275fac=function(n){return new(n||a)(Ae(Z))},a.\u0275prov=De({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();var Ue=class extends Pe{constructor(a){super(),this.checklist=[],this.avaliacao_id="",this.plano_trabalho_entrega_id=null,this.plano_entrega_entrega_id=null,this.initialization(a)}};function Oo(o,a){if(o&1){let i=G();m(0,"input-rate",2),R("change",function(n){M(i);let t=u();return j(t.onValueChange(n))}),s()}if(o&2){let i=u();l("disabled",i.disabled)("size",12)("label",i.label)("control",i.control)}}function Ro(o,a){if(o&1&&c(0,"input-choose",3),o&2){let i=u();l("label",i.label)("control",i.control)("disabled",i.disabled)("items",i.items)("change",i.onValueChange.bind(i))}}var Kt=(()=>{let a=class a{constructor(){this.class="form-group",this.label="Qual nota?",this.items=[],this._size=0,this._control=void 0,this._tipoAvaliacao=void 0}set tipoAvaliacao(e){if(this._tipoAvaliacao!=e){this._tipoAvaliacao=e;let n=this._tipoAvaliacao?.notas;n.sort((t,d)=>d.sequencia-t.sequencia),this.items=(n||[]).map(t=>Object.assign({},{key:t.nota,value:t.nota,hint:t.descricao,icon:t.icone,color:t.cor}))}}get tipoAvaliacao(){return this._tipoAvaliacao}set control(e){this._control!=e&&(this._control=e,e&&(e.valueChanges.subscribe(this.updateNota.bind(this)),this.updateNota()))}get control(){return this._control}set size(e){e!=this._size&&(this._size=e,this.class=this.class.replace(/\scol\-md\-[0-9]+/g,"")+" col-md-"+e)}get size(){return this._size||12}get isQuantitativo(){return this.tipoAvaliacao?.tipo=="QUANTITATIVO"}get isQualitativo(){return this.tipoAvaliacao?.tipo=="QUALITATIVO"}updateNota(){this.nota=this.tipoAvaliacao?.notas.find(e=>e.nota==this.control?.value)}onValueChange(e){this.control?.updateValueAndValidity(),this.change&&this.change(this.control?.value)}};a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=C({type:a,selectors:[["avaliar-nota-input"]],hostVars:2,hostBindings:function(n,t){n&2&&oe(t.class)},inputs:{label:"label",disabled:"disabled",change:"change",tipoAvaliacao:"tipoAvaliacao",control:"control",size:"size"},decls:3,vars:2,consts:[["qualitativo",""],[3,"disabled","size","label","control","change",4,"ngIf","ngIfElse"],[3,"change","disabled","size","label","control"],[3,"label","control","disabled","items","change"]],template:function(n,t){if(n&1&&f(0,Oo,1,4,"input-rate",1)(1,Ro,1,5,"ng-template",null,0,b),n&2){let d=g(2);l("ngIf",t.isQuantitativo)("ngIfElse",d)}},dependencies:[I,ze,Ot]});let o=a;return o})();function zo(o,a){if(o&1&&(m(0,"div",2),c(1,"input-rate",3),s()),o&2){let i=u();r(),l("starMargin",1)("align",i.align)("size",12)("control",i.fakeControl)}}function Mo(o,a){if(o&1&&c(0,"badge",5),o&2){let i=u(2);l("icon",i.tipoAvaliacaoNota.icone)("label",i.tipoAvaliacaoNota.nota)}}function jo(o,a){if(o&1&&f(0,Mo,1,2,"badge",4),o&2){let i=u();l("ngIf",i.tipoAvaliacaoNota)}}var Yt=(()=>{let a=class a{constructor(){this.align="center",this.items=[],this.fakeControl=new at,this._tipoAvaliacao=void 0}set tipoAvaliacao(e){this._tipoAvaliacao!=e&&(this._tipoAvaliacao=e,this.items=(this._tipoAvaliacao?.notas||[]).map(n=>Object.assign({},{key:n.nota,value:n.nota,hint:n.descricao,icon:n.icone})),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(n=>n.nota==this.nota))}get tipoAvaliacao(){return this._tipoAvaliacao}set nota(e){e!=this.fakeControl.value&&(this.fakeControl.setValue(e),this.tipoAvaliacaoNota=(this._tipoAvaliacao?.notas||[]).find(n=>n.nota==this.nota))}get nota(){return this.fakeControl.value}get isQuantitativo(){return this.tipoAvaliacao?.tipo=="QUANTITATIVO"}get isQualitativo(){return this.tipoAvaliacao?.tipo=="QUALITATIVO"}};a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=C({type:a,selectors:[["avaliar-nota-badge"]],inputs:{align:"align",tipoAvaliacao:"tipoAvaliacao",nota:"nota"},decls:3,vars:2,consts:[["qualitativo",""],["class","row",4,"ngIf","ngIfElse"],[1,"row"],["small","","disabled","",3,"starMargin","align","size","control"],["disabled","",3,"icon","label",4,"ngIf"],["disabled","",3,"icon","label"]],template:function(n,t){if(n&1&&f(0,zo,2,4,"div",1)(1,jo,1,1,"ng-template",null,0,b),n&2){let d=g(2);l("ngIf",t.isQuantitativo)("ngIfElse",d)}},dependencies:[I,ze,L]});let o=a;return o})();var Bo=["notaInput"],Lo=["justificativas"];function qo(o,a){if(o&1&&(m(0,"separator",23),c(1,"input-textarea",24),s()),o&2){let i=u();r(),l("size",12)("disabled",i.recurso?void 0:"true")("rows",2)("control",i.form.controls.recurso)}}function Uo(o,a){if(o&1&&(m(0,"div",25)(1,"button",26),c(2,"i"),m(3,"strong",27),p(4),s(),p(5),s()()),o&2){let i=u();r(),tt(i.styleButtonNota),r(),oe(i.nota.icone),J("color",i.nota.cor||"black"),r(2),E(i.nota.nota),r(),_(" - ",i.nota.descricao," ")}}function Qo(o,a){if(o&1&&(m(0,"div",16),c(1,"input-multitoggle",28,1),s()),o&2){let i=u();r(),l("disabled",i.recurso?"true":void 0)("control",i.form.controls.justificativas)("label",i.nota.pergunta)("items",i.tiposJustificativas)}}function Go(o,a){if(o&1&&p(0),o&2){let i=a.row,e=u(2);_(" ",e.util.getDateFormatted(e.isPlanoEntrega?i.data_inicio:i.plano_entrega_entrega==null?null:i.plano_entrega_entrega.data_inicio)," ")}}function Jo(o,a){if(o&1&&p(0),o&2){let i=a.row,e=u(2);_(" ",e.util.getDateFormatted(e.isPlanoEntrega?i.data_fim:i.plano_entrega_entrega==null?null:i.plano_entrega_entrega.data_fim)," ")}}function Wo(o,a){if(o&1&&c(0,"badge",38),o&2){let i=a.row,e=u(2);l("icon",e.entityService.getIcon("Entrega"))("label",i.descricao)}}function $o(o,a){if(o&1&&c(0,"badge",40),o&2){let i=a.row;l("label",i.forca_trabalho+"%")}}function Xo(o,a){if(o&1&&(m(0,"column",39),f(1,$o,1,1,"ng-template",null,6,b),s()),o&2){let i=g(2);l("template",i)("titleHint","% Carga Hor\xE1ria Dispon\xEDvel Planejada")}}function Ko(o,a){if(o&1&&c(0,"badge",42)(1,"br")(2,"badge",43),o&2){let i=a.row,e=u(3);l("textValue",e.planoEntregaService.getValorMeta(i)),r(2),l("textValue",e.planoEntregaService.getValorRealizado(i))}}function Yo(o,a){if(o&1&&(m(0,"column",41),f(1,Ko,3,2,"ng-template",null,7,b),s()),o&2){let i=g(2);l("title",`Meta
Realizado`)("width",200)("template",i)}}function Zo(o,a){if(o&1&&c(0,"progress-bar",45),o&2){let i=a.row;l("value",i.progresso_realizado)("goal",i.progresso_esperado)}}function en(o,a){if(o&1&&(m(0,"column",44),f(1,Zo,1,2,"ng-template",null,8,b),s()),o&2){let i=g(2);l("width",200)("template",i)}}function tn(o,a){if(o&1&&c(0,"input-switch",47),o&2){let i=a.row,e=a.column,n=u(3);l("source",i._metadata)("path",e.metadata.key)("disabled",n.recurso?"true":void 0)}}function on(o,a){if(o&1&&(m(0,"column",46),f(1,tn,1,3,"ng-template",null,9,b),s()),o&2){let i=a.$implicit,e=g(2);l("title",i.value)("template",e)("metadata",i)}}function nn(o,a){if(o&1&&(m(0,"separator",29)(1,"grid",30,2)(3,"columns")(4,"column",31),f(5,Go,1,1,"ng-template",null,3,b),s(),m(7,"column",32),f(8,Jo,1,1,"ng-template",null,4,b),s(),m(10,"column",33),f(11,Wo,1,2,"ng-template",null,5,b),s(),f(13,Xo,3,2,"column",34)(14,Yo,3,3,"column",35)(15,en,3,2,"column",36)(16,on,3,3,"column",37),s()()()),o&2){let i=g(6),e=g(9),n=g(12),t=u();l("title",t.lex.translate("Entregas"))("collapsed",!t.checklist.length),r(),l("items",t.entregas)("minHeight",0),r(3),l("template",i),r(3),l("template",e),r(3),l("template",n),r(3),l("ngIf",t.isConsolidacao),r(),l("ngIf",t.isPlanoEntrega),r(),l("ngIf",t.isPlanoEntrega),r(),l("ngForOf",t.checklist)}}function an(o,a){if(o&1&&(m(0,"div",54)(1,"div",55),c(2,"profile-picture",56),s(),m(3,"div",57)(4,"strong"),p(5),s(),c(6,"br"),m(7,"small"),p(8),s()()()),o&2){let i=a.row;r(2),l("url",i.avaliador.url_foto||"")("size",40)("hint",i.avaliador.nome||""),r(3),E(i.avaliador.nome||""),r(3),E(i.avaliador.apelido||"")}}function rn(o,a){if(o&1&&c(0,"badge",38),o&2){let i=a.$implicit,e=u(3);l("icon",e.entityService.getIcon("TipoJustificativa"))("label",i.value)}}function ln(o,a){if(o&1&&(c(0,"avaliar-nota-badge",58)(1,"br"),m(2,"small"),p(3),s(),m(4,"div",59),f(5,rn,1,2,"badge",60),s()),o&2){let i=a.row;l("align","left")("tipoAvaliacao",i.tipo_avaliacao)("nota",i.nota),r(3),E(i.justificativa||""),r(2),l("ngForOf",i.justificativas)}}function sn(o,a){if(o&1&&(m(0,"small"),p(1),s()),o&2){let i=a.row;r(),E(i.recurso||"")}}function mn(o,a){o&1&&c(0,"badge",63)}function dn(o,a){o&1&&c(0,"badge",64)}function cn(o,a){if(o&1&&(m(0,"div",59),f(1,mn,1,0,"badge",61)(2,dn,1,0,"badge",62),s()),o&2){let i=a.row,e=u(2);r(),l("ngIf",i.recurso==null?null:i.recurso.length),r(),l("ngIf",i.id==(e.entity==null?null:e.entity.id))}}function pn(o,a){if(o&1&&(m(0,"separator",48)(1,"grid",30,2)(3,"columns"),c(4,"column",49),m(5,"column",50),f(6,an,9,5,"ng-template",null,10,b),s(),m(8,"column",51),f(9,ln,6,5,"ng-template",null,11,b),s(),m(11,"column",52),f(12,sn,2,1,"ng-template",null,12,b),s(),m(14,"column",53),f(15,cn,3,2,"ng-template",null,13,b),s()()()()),o&2){let i=g(7),e=g(10),n=g(13),t=g(16),d=u();r(),l("items",d.avaliacoes)("minHeight",0),r(4),l("template",i),r(3),l("title",`Nota
Justificativas`)("template",e),r(3),l("template",n),r(3),l("template",t)}}var Gr=(()=>{let a=class a extends kt{constructor(e){super(e,xe,Ht),this.injector=e,this.recurso=!1,this.tiposJustificativas=[],this.entregas=[],this.checklist=[],this.avaliacoes=[],this.modalWidth=900,this.joinConsolidacao=[],this.joinPlanoEntrega=[],this.joinPrograma=["tipo_avaliacao_plano_trabalho.notas.justificativas","tipo_avaliacao_plano_entrega.notas.justificativas"],this.joinPlanoEntregaEntrega=["entrega","objetivos.objetivo","processos.processo","unidade","comentarios.usuario:id,nome,apelido"],this.joinPlanoTrabalhoEntrega=["entrega","planoEntregaEntrega:id,descricao,data_inicio,data_fim,plano_entrega_id,entrega_id","planoEntregaEntrega.entrega:id,nome,tipo_indicador"],this.validate=(n,t)=>{let d=null;return this.recurso?t=="recurso"&&!n.value?.length&&(d="Obrigat\xF3rio"):t=="nota"&&([null,void 0].includes(n.value)||!this.nota)&&(d="Obrigat\xF3rio"),d},this.formValidation=n=>{let t=n.value;if(!this.recurso&&this.nota?.justifica&&!t.justificativa?.length&&!t.justificativas?.length)return"Para a nota seleciona ser\xE1 necess\xE1rio ao menos uma justificativa."},this.programaDao=e.get(pt),this.planoTrabalhoEntregaDao=e.get(ut),this.tipoAvaliacaoDao=e.get(ht),this.consolidacaoDao=e.get(It),this.planoEntregaDao=e.get(st),this.planoEntregaEntregaDao=e.get(Fe),this.planoEntregaService=e.get(Xt),this.join=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.form=this.fh.FormBuilder({nota:{default:null},recurso:{default:""},justificativas:{default:[]},justificativa:{default:""},arquivar:{default:!0}},this.cdRef,this.validate)}loadData(e,n){return v(this,null,function*(){let t=Object.assign({},n.value);this.loading=!0;try{this.consolidacao=this.urlParams?.has("consolidacaoId")||this.metadata?.consolidacao?this.metadata?.consolidacao||(yield this.consolidacaoDao.getById(this.urlParams.get("consolidacaoId"),this.joinConsolidacao)):void 0,this.planoEntrega=this.urlParams?.has("planoEntregaId")||this.metadata?.planoEntrega?this.metadata?.planoEntrega||(yield this.planoEntregaDao.getById(this.urlParams.get("planoEntregaId"),this.joinPlanoEntrega)):void 0,this.avaliacoes=yield this.dao.query({where:this.consolidacao?[["plano_trabalho_consolidacao_id","==",this.consolidacao.id]]:[["plano_entrega_id","==",this.planoEntrega?.id]],join:this.join,orderBy:[["data_avaliacao","desc"]]}).asPromise(),this.entity=this.avaliacoes.find(d=>d.id==(this.consolidacao||this.planoEntrega)?.avaliacao_id)||this.entity,this.programa=this.metadata?.programa||(yield this.programaDao.query({where:[["id","==",this.consolidacao?.plano_trabalho?.programa_id||this.planoEntrega?.programa_id]],join:this.joinPrograma}).firstOrDefault(this.consolidacao?.plano_trabalho?.programa||this.planoEntrega?.programa)),this.origem=this.consolidacao?"CONSOLIDACAO":"PLANO_ENTREGA",this.tipoAvaliacao=this.isConsolidacao?this.programa?.tipo_avaliacao_plano_trabalho:this.programa?.tipo_avaliacao_plano_entrega,this.checklist=(this.isConsolidacao?this.programa.checklist_avaliacao_entregas_plano_trabalho:this.programa.checklist_avaliacao_entregas_plano_entrega)||[],this.recurso=!!this.metadata?.recurso,this.entregas=this.metadata?.entregas||(this.isConsolidacao?yield this.planoTrabalhoEntregaDao.query({where:[["plano_trabalho_id","==",this.consolidacao.plano_trabalho_id]],join:this.joinPlanoTrabalhoEntrega}).asPromise():yield this.planoEntregaEntregaDao.query({where:[["plano_entrega_id","==",this.planoEntrega.id]],join:this.joinPlanoEntregaEntrega}).asPromise()),this.entregas.forEach(d=>{d._metadata={},this.checklist.forEach(h=>{let H=this.entity?.entregas_checklist.find($=>d.id==($.plano_entrega_entrega_id||$.plano_trabalho_entrega_id));d._metadata[h.key]=!H||!!H.checklist.find($=>$.id==h.key)?.checked})}),this.usuario=this.consolidacao?.plano_trabalho?.usuario,t=this.util.fillForm(t,this.entity),this.form.controls.nota.setValue(t.nota),this.onNotaChange(new Event("change")),n.patchValue(t)}finally{this.loading=!1}})}initializeData(e){return v(this,null,function*(){this.entity=new xe,yield this.loadData(this.entity,e)})}get nota(){return this.notaInput?.nota}get labelNota(){return"Como foi o trabalho "+(this.isConsolidacao?"de "+this.util.apelidoOuNome(this.usuario):"da "+this.planoEntrega?.unidade?.sigla)+"?"}get styleButtonNota(){let e=this.util.colorHexToRGB(this.nota?.cor||"#000000");return"background-color: rgba("+e.r+","+e.g+","+e.b+", 0.2);"}get isConsolidacao(){return this.origem=="CONSOLIDACAO"}get isPlanoEntrega(){return this.origem=="PLANO_ENTREGA"}onNotaChange(e){this.tiposJustificativas=this.nota?.justificativas?.map(n=>({key:n.tipo_justificativa_id,value:n.tipo_justificativa.nome||""}))||[]}saveData(e){return v(this,null,function*(){return this.recurso?(yield this.dao.recorrer(this.consolidacao.avaliacao,e.recurso),new Je(this.consolidacao.avaliacao)):(this.entity.id="",this.entity.data_avaliacao=this.auth.hora,this.entity.nota=e.nota,this.entity.justificativa=e.justificativa,this.entity.justificativas=e.justificativas,this.entity.avaliador_id=this.auth.usuario.id,this.entity.plano_entrega_id=this.planoEntrega?.id||null,this.entity.plano_trabalho_consolidacao_id=this.consolidacao?.id||null,this.entity.tipo_avaliacao_id=this.tipoAvaliacao.id,this.checklist.length&&(this.entity.entregas_checklist=this.entregas.map(n=>new Ue({plano_trabalho_entrega_id:this.consolidacao?n.id:null,plano_entrega_entrega_id:this.planoEntrega?n.id:null,checklist:this.checklist.map(t=>({id:t.key,texto:t.value,checked:!!n._metadata[t.key]}))}))),new Je(yield this.dao.save(this.entity,this.join)))})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["avaliar"]],viewQuery:function(n,t){if(n&1&&(T(Bo,5),T(Lo,5),T(O,5)),n&2){let d;D(d=S())&&(t.notaInput=d.first),D(d=S())&&(t.justificativas=d.first),D(d=S())&&(t.editableForm=d.first)}},features:[A],decls:10,vars:17,consts:[["notaInput",""],["justificativas",""],["gridEntregas",""],["culumnDataInicio",""],["columnDataFim",""],["columnEntrega",""],["columnForcaTrabalho",""],["columnMetaRealizado",""],["columnProgresso",""],["columnCheck",""],["columnAvaliador",""],["columnNotaJustificativa",""],["columnRecurso",""],["columnStatus",""],[3,"submit","cancel","form","disabled"],["title","Recurso",4,"ngIf"],[1,"row"],[3,"size","disabled","tipoAvaliacao","label","change","control"],["class","d-flex justify-content-center",4,"ngIf"],["class","row",4,"ngIf"],["label","Justificativa","controlName","justificativa",3,"disabled","size","rows","control"],["collapse","",3,"title","collapsed",4,"ngIf"],["title","Hist\xF3rico de avalia\xE7\xF5es","collapse","",4,"ngIf"],["title","Recurso"],["label","Texto do recurso","controlName","recurso",3,"size","disabled","rows","control"],[1,"d-flex","justify-content-center"],["type","button",1,"pe-none","btn"],[1,"ms-1"],[3,"disabled","control","label","items"],["collapse","",3,"title","collapsed"],[3,"items","minHeight"],["title","In\xEDcio",3,"template"],["title","Fim",3,"template"],["title","Entrega",3,"template"],["title","% CHD Planejado",3,"template","titleHint",4,"ngIf"],[3,"title","width","template",4,"ngIf"],["title","Progresso",3,"width","template",4,"ngIf"],[3,"title","template","metadata",4,"ngFor","ngForOf"],[3,"icon","label"],["title","% CHD Planejado",3,"template","titleHint"],["color","light",3,"label"],[3,"title","width","template"],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],["title","Progresso",3,"width","template"],["color","success",3,"value","goal"],[3,"title","template","metadata"],[3,"source","path","disabled"],["title","Hist\xF3rico de avalia\xE7\xF5es","collapse",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],[3,"title","template"],["title","Recurso",3,"template"],["title","Status",3,"template"],[1,"avaliador"],[1,"avaliador-profile"],[3,"url","size","hint"],[1,"avaliador-nome"],[3,"align","tipoAvaliacao","nota"],[1,"one-per-line"],[3,"icon","label",4,"ngFor","ngForOf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-check-circle","color","success","label","Vigente",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"],["icon","bi bi-check-circle","color","success","label","Vigente"]],template:function(n,t){if(n&1){let d=G();m(0,"editable-form",14),R("submit",function(){return M(d),j(t.onSaveData())})("cancel",function(){return M(d),j(t.onCancel())}),f(1,qo,2,4,"separator",15),m(2,"div",16),c(3,"avaliar-nota-input",17,0),s(),f(5,Uo,6,8,"div",18)(6,Qo,3,4,"div",19),c(7,"input-textarea",20),f(8,nn,17,11,"separator",21)(9,pn,17,7,"separator",22),s()}n&2&&(l("form",t.form)("disabled",t.formDisabled),r(),l("ngIf",t.recurso||(t.form.controls.recurso==null||t.form.controls.recurso.value==null?null:t.form.controls.recurso.value.length)),r(2),l("size",12)("disabled",t.recurso?"true":void 0)("tipoAvaliacao",t.tipoAvaliacao)("label",t.labelNota)("change",t.onNotaChange.bind(t))("control",t.form.controls.nota),r(2),l("ngIf",t.nota),r(),l("ngIf",!1),r(),l("disabled",t.recurso?"true":void 0)("size",12)("rows",2)("control",t.form.controls.justificativa),r(),l("ngIf",t.entregas.length),r(),l("ngIf",t.avaliacoes.length))},dependencies:[V,I,w,Q,U,O,te,_e,wt,B,L,me,Ft,Kt,Yt],styles:[".avaliador[_ngcontent-%COMP%]{display:table}.avaliador-profile[_ngcontent-%COMP%]{width:fit-content;display:table-cell}.avaliador-nome[_ngcontent-%COMP%]{display:table-cell;min-width:100px}"]});let o=a;return o})();function un(o,a){if(o&1&&(P(0),m(1,"div",2)(2,"h6"),p(3),s(),c(4,"cite",3),s(),k()),o&2){let i=a.$implicit,e=a.index,n=u();r(),J("border-color",n.util.getBackgroundColor(e,n.colunas.length)+"!important"),r(2),E(i.titulo),r(),l("innerHTML",i.texto,et)}}var Zt=(()=>{let a=class a extends N{constructor(e){super(e),this.injector=e,this.colunas=[]}ngOnInit(){super.ngOnInit()}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["app-colunas"]],inputs:{colunas:"colunas"},features:[A],decls:2,vars:1,consts:[[1,"row"],[4,"ngFor","ngForOf"],[1,"border-start","border-4","ps-3","mt-3","col-md-6","col-12"],[3,"innerHTML"]],template:function(n,t){n&1&&(m(0,"div",0),f(1,un,5,4,"ng-container",1),s()),n&2&&(r(),l("ngForOf",t.colunas))},dependencies:[V]});let o=a;return o})();function hn(o,a){if(o&1&&c(0,"planejamento-show",2),o&2){let i=u();l("planejamento",i.planejamentoSuperior)}}function gn(o,a){if(o&1&&(m(0,"div",3)(1,"h6"),p(2,"Planejamento:"),s(),m(3,"h4"),p(4),s(),c(5,"app-colunas",4),s()),o&2){let i=u();l("ngClass",i.planejamento.planejamento_superior_id?"":"first-box"),r(4),E(i.planejamento.nome),r(),l("colunas",i.colunas)}}var Yr=(()=>{let a=class a extends N{constructor(e){super(e),this.injector=e,this.planejamento={},this.planejamentoSuperior=null,this.colunas=[],this.planejamentoDao=e.get(bt)}ngOnInit(){super.ngOnInit(),this.colunas.push({titulo:"Miss\xE3o",texto:this.planejamento.missao},{titulo:"Vis\xE3o",texto:this.planejamento.visao},{titulo:"Valores",texto:this.planejamento.valores.map(e=>e.value).join("<br>")},{titulo:"Resultados institucionais",texto:this.planejamento.resultados_institucionais?.map(e=>e.value).join("<br>")})}ngAfterViewInit(){super.ngAfterViewInit(),this.planejamento.planejamento_superior_id&&this.buscaPlanejamentoSuperior(this.planejamento.planejamento_superior_id)}buscaPlanejamentoSuperior(e){return v(this,null,function*(){this.planejamentoSuperior=yield this.planejamentoDao.getById(e)})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["planejamento-show"]],inputs:{planejamento:"planejamento"},features:[A],decls:2,vars:2,consts:[[3,"planejamento",4,"ngIf"],["class","planejamento arrow_box w-100",3,"ngClass",4,"ngIf"],[3,"planejamento"],[1,"planejamento","arrow_box","w-100",3,"ngClass"],[3,"colunas"]],template:function(n,t){n&1&&f(0,hn,1,1,"planejamento-show",0)(1,gn,6,3,"div",1),n&2&&(l("ngIf",t.planejamentoSuperior),r(),l("ngIf",t.planejamento))},dependencies:[ot,I,Zt,a],styles:["[_nghost-%COMP%]{flex-basis:fit-content}"]});let o=a;return o})();function _n(o,a){if(o&1&&(m(0,"div",8)(1,"h5",9),p(2),s(),c(3,"hr")(4,"document-preview",10),s()),o&2){let i=a.row;r(2),E((i==null?null:i.titulo)||"Preview do template"),r(2),l("html",i==null?null:i.conteudo)}}function vn(o,a){if(o&1&&(P(0),m(1,"div",12),c(2,"input-text",13)(3,"input-text",14),s(),m(4,"div"),c(5,"input-editor",15),s(),k()),o&2){let i=u(3);r(2),l("size",2)("control",i.form.controls.codigo),q("maxlength",250),r(),l("size",10)("control",i.form.controls.titulo),q("maxlength",250),r(2),l("size",12)("dataset",i.dataset)("control",i.form.controls.conteudo)("loading",i.loadingDataset)}}function bn(o,a){if(o&1&&f(0,vn,6,10,"ng-container",11),o&2){let i=u(2);l("ngIf",i.dataset)}}function Cn(o,a){if(o&1&&c(0,"badge",19),o&2){let i=u().row;l("label",i.codigo)}}function yn(o,a){if(o&1&&c(0,"badge",20),o&2){let i=u(3);l("icon",i.entityService.getIcon("Entidade"))("label",i.lex.translate("Entidade"))}}function In(o,a){if(o&1&&(m(0,"div",12)(1,"div",16)(2,"small"),p(3),s()()(),f(4,Cn,1,1,"badge",17)(5,yn,1,2,"badge",18)),o&2){let i=a.row;r(3),E(i.titulo),r(),l("ngIf",i.codigo==null?null:i.codigo.length),r(),l("ngIf",i.entidade_id==null?null:i.entidade_id.length)}}function En(o,a){if(o&1&&(m(0,"grid",4)(1,"side-panel",5),f(2,_n,5,2,"ng-template",null,0,b)(4,bn,1,1,"ng-template",null,1,b),s(),m(6,"columns")(7,"column",6),f(8,In,6,3,"ng-template",null,2,b),s(),c(10,"column",7),s()()),o&2){let i=g(3),e=g(5),n=g(9),t=u();l("items",t.items)("form",t.form)("title",t.isModal?"":t.title)("orderBy",t.orderBy)("groupBy",t.groupBy)("join",t.join)("selectable",!0)("load",t.loadTemplate.bind(t))("save",t.saveTemplate.bind(t))("hasAdd",!1)("hasEdit",!1)("hasDelete",!1),r(),l("size",8)("template",i)("editTemplate",e),r(6),l("template",n),r(3),l("dynamicButtons",t.dynamicButtons.bind(t))}}var dl=(()=>{let a=class a extends N{set entity(e){super.entity=e}get entity(){return super.entity}constructor(e){super(e),this.injector=e,this.items=[],this.loadingRelatorios=!1,this.loadingDataset=!1,this.cdRef=e.get(K),this.dao=e.get(he),this.templateService=e.get(le),this.code="MOD_REL_TEMP",this.form=this.fh.FormBuilder({codigo:{default:""},titulo:{default:""},conteudo:{default:""}})}ngOnInit(){super.ngOnInit(),this.entidadeId=this.entidadeId||this.queryParams?.entidadeId}ngAfterViewInit(){super.ngAfterViewInit(),this.loadRelatorios(this.entity)}loadRelatorios(e){v(this,null,function*(){this.loadingRelatorios=!0,this.cdRef.detectChanges();try{this.items=yield this.templateService.loadRelatorios(this.entidadeId)}finally{this.loadingRelatorios=!1,this.cdRef.detectChanges()}})}dynamicButtons(e){let n=[];return this.entidadeId?.length&&n.push({hint:"Alterar",icon:"bi bi-pencil-square",color:"btn-outline-info",onClick:this.grid?.onEditItem.bind(this.grid)}),n}loadTemplate(e,n){return v(this,null,function*(){this.loadingDataset=!0,this.dataset=yield this.templateService.dataset("RELATORIO",n.codigo),e.controls.codigo.setValue(n.codigo),e.controls.titulo.setValue(n.titulo),e.controls.conteudo.setValue(n.conteudo),this.loadingDataset=!1,this.cdRef.detectChanges()})}saveTemplate(e,n){return v(this,null,function*(){let t;if(this.form.markAllAsTouched(),this.form.valid)if(this.entidadeId?.length&&this.entidadeId==n.entidade_id)n.codigo=e.controls.codigo.value,n.titulo=e.controls.titulo.value,n.conteudo=e.controls.conteudo.value,n.dataset=this.dataset,n._status=n._status=="ADD"?"ADD":"EDIT",yield this.dao.save(n,this.join);else{let h=new de({id:this.dao.generateUuid(),codigo:e.controls.codigo.value,titulo:e.controls.titulo.value,conteudo:e.controls.conteudo.value,dataset:this.dataset,especie:"RELATORIO",entidade_id:this.entidadeId||null,_status:"ADD"});this.entity.relatorios_templates=this.entity.relatorios_templates||[],this.entity.relatorios_templates.push(h),this.cdRef.detectChanges()}return t})}};a.\u0275fac=function(n){return new(n||a)(y(x))},a.\u0275cmp=C({type:a,selectors:[["relatorios-template"]],viewQuery:function(n,t){if(n&1&&T(w,5),n&2){let d;D(d=S())&&(t.grid=d.first)}},inputs:{cdRef:"cdRef",entidadeId:"entidadeId",entity:"entity"},features:[A],decls:1,vars:1,consts:[["panelTemplate",""],["panelTemplateEdit",""],["columnTemplate",""],["editable","",3,"items","form","title","orderBy","groupBy","join","selectable","load","save","hasAdd","hasEdit","hasDelete",4,"ngIf"],["editable","",3,"items","form","title","orderBy","groupBy","join","selectable","load","save","hasAdd","hasEdit","hasDelete"],["fullSizeOnEdit","",3,"size","template","editTemplate"],["title","Template",3,"template"],["type","options","always","",3,"dynamicButtons"],[1,"h-100","ps-3","contentTemplte"],[1,"pt-3","m-0"],["emptyDocumentMensage","Nenhum template selecionado",3,"html"],[4,"ngIf"],[1,"row"],["label","C\xF3digo",3,"size","control"],["label","T\xEDtulo",3,"size","control"],["label","Preview do template",3,"size","dataset","control","loading"],[1,"col-md-12"],["color","light","icon","bi bi-tag",3,"label",4,"ngIf"],["color","primary",3,"icon","label",4,"ngIf"],["color","light","icon","bi bi-tag",3,"label"],["color","primary",3,"icon","label"]],template:function(n,t){n&1&&f(0,En,11,17,"grid",3),n&2&&l("ngIf",t.viewInit)},dependencies:[I,w,Q,U,W,L,se,re,Y]});let o=a;return o})();var es=(()=>{let a=class a{};a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=we({type:a}),a.\u0275inj=Se({imports:[nt,Rt,Wt]});let o=a;return o})();it(xt,[I,O,te,B,$t],[]);export{xn as a,jt as b,Un as c,Bt as d,Le as e,Ya as f,dr as g,xe as h,Xt as i,Yt as j,Gr as k,Yr as l,dl as m,es as n};
