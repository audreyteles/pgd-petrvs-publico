import{a as oe,b as Pe,c as fe}from"./chunk-5IXNGGPY.js";import{a as Oe}from"./chunk-BPXUIHBM.js";import{b as vt}from"./chunk-MNKRGGEJ.js";import{a as xe,b as ft,c as ue,d as pe,g as ae,i as ht,l as _t,n as gt}from"./chunk-5IAOL3IR.js";import{b as Fe,c as me}from"./chunk-IVBXO46K.js";import{a as M}from"./chunk-UFS3OPCG.js";import{a as F,b as O}from"./chunk-RMYSPY7H.js";import{R as st,S as lt,T as dt,U as ct,W as ut,X as Ve,Y as mt,b as Qe,ea as Be,f as U,fa as pt,h as B,i as H,j as je,n as R,o as Y,p as qe,r as ee,s as T,t as G,v as ce,w as te,x as ie}from"./chunk-XHTD5OAS.js";import{b as Ue,c as we,d as Se,e as Me,h as rt,q as ke,s as $}from"./chunk-KODYKPWY.js";import{Ab as de,Bb as z,Da as Je,Fa as u,Fb as Xe,Ga as d,Gd as P,Ha as m,Ia as W,Ja as J,Jc as Z,La as V,Ma as E,Na as f,Nc as Ee,Nd as Q,P as be,Ra as Re,Sc as tt,U as A,Ua as g,Ud as X,V as Ce,Va as v,Vb as Ye,Vc as it,Wa as b,Xa as D,Xc as at,Ya as I,Z as C,Za as L,_ as y,_a as K,ba as w,fd as Ie,gd as ot,h as _,jb as ye,jd as De,kb as le,ld as Te,ma as l,na as S,oc as Le,od as nt,sb as q,sd as Ae,tb as Ze,va as k,wc as et,xa as h,ya as We,za as r}from"./chunk-6YMI2QVU.js";function Nt(n,s){if(n&1&&(u(0,"strong",12),I(1),d()),n&2){let o=f().row;l(),L((o.tipo_tarefa==null?null:o.tipo_tarefa.nome)||"")}}function Rt(n,s){if(n&1&&(h(0,Nt,2,1,"strong",11),I(1)),n&2){let o=s.row;r("ngIf",o.tipo_tarefa==null||o.tipo_tarefa.nome==null?null:o.tipo_tarefa.nome.length),l(),K(" ",o.descricao," ")}}function Lt(n,s){if(n&1&&m(0,"documentos-badge",14),n&2){let o=s.row;r("documento",o.documento)}}function Qt(n,s){if(n&1&&(u(0,"column",13),h(1,Lt,1,1,"ng-template",null,2,q),d()),n&2){let o=D(2);r("template",o)}}function Ut(n,s){n&1&&m(0,"i",18)}function Mt(n,s){if(n&1&&(u(0,"div",16),h(1,Ut,1,0,"i",17),d()),n&2){let o=s.row;l(),r("ngIf",o.data_conclusao)}}function jt(n,s){if(n&1&&m(0,"input-switch",19),n&2){let o=f(2);r("size",12)("control",o.formEdit.controls.concluido)}}function Bt(n,s){if(n&1&&(u(0,"column",15),h(1,Mt,2,1,"ng-template",null,3,q)(3,jt,1,2,"ng-template",null,4,q),d()),n&2){let o=D(2),t=D(4),i=f();r("align","center")("template",o)("columnEditTemplate",t)("canEdit",i.canConcluidoEdit.bind(i))("edit",i.editable?i.onColumnConcluidoEdit.bind(i):void 0)("save",i.editable?i.onColumnConcluidoSave.bind(i):void 0)}}function Kt(n,s){if(n&1&&m(0,"comentarios-widget",20),n&2){let o=s.row,t=f();r("entity",o)("noPersist",t.isPersist?void 0:"true")("selectable",t.selectable)("grid",t.grid)("save",t.addComentarioResult.bind(t))}}function Ht(n,s){if(n&1&&m(0,"column",21),n&2){let o=f();r("dynamicButtons",o.dynamicButtons.bind(o))}}var ne=(()=>{let s=class s extends X{set atividade(t){this._atividade!=t&&(this._atividade=t,this.isPersist&&t?.tarefas&&this.control.setValue(t?.tarefas))}get atividade(){return this._atividade}constructor(t){super(t),this.injector=t,this.control=new Ye,this.disabled=!1,this.editable=!0,this.selectable=!1,this.id_processo=0,this.consolidacao=!0,this.canAdd=!1,this.addComentarioButton={icon:"bi bi-plus-circle",hint:"Incluir coment\xE1rio"},this.editTarefa=i=>_(this,null,function*(){this.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:i,atividade:this.atividade},modalClose:e=>{e&&_(this,null,function*(){let a=this.control.value,c=a.findIndex(p=>p.id==i.id);if(c>=0){if(e._status=e._status=="ADD"?"ADD":"EDIT",this.isPersist&&this.atividade?.tarefas){this.grid.error=void 0;try{this.dialog.showSppinerOverlay("Salvando dados do formul\xE1rio"),e=yield this.dao.save(e,this.join)}catch(p){this.grid.error=p.message?p.message:p,e=void 0}finally{this.dialog.closeSppinerOverlay()}}e&&(a[c]=e,this.control.setValue(a))}this.cdRef.detectChanges()})}})}),this.dao=t.get(Ae),this.atividadeService=t.get(Oe),this.allPages=t.get(ke),this.formEdit=this.fh.FormBuilder({concluido:{default:!1}}),this.join=["tipo_tarefa","comentarios.usuario"]}ngOnInit(){super.ngOnInit(),this.atividade?.descricao!=""&&(this.canAdd=!0),this.queryParams?.id_processo&&(this.id_processo=this.queryParams?.id_processo),this.isPersist&&this.atividade?.tarefas&&this.control.setValue(this.atividade?.tarefas)}ngAfterViewInit(){super.ngAfterViewInit(),this.id_processo&&(this.loading=!0,this.dao.query({where:[["id_processo","==",this.id_processo]]}).asPromise().then(t=>{this.control.setValue(t||[]),this.cdRef.detectChanges()}).finally(()=>{this.loading=!1}))}get isPersist(){return this.persist!=null}addTarefa(){return _(this,null,function*(){let t=new oe;t.id=this.dao.generateUuid(),t.usuario=this.auth.usuario,t.usuario_id=this.auth.usuario.id,t.atividade_id=this.atividade?.id||"",t.comentarios=[],t._status="ADD",this.go.navigate({route:["gestao","atividade","tarefa"]},{metadata:{tarefa:t,atividade:this.atividade},modalClose:i=>{i&&_(this,null,function*(){let e=this.control.value||[];if(this.isPersist&&this.atividade?.tarefas){this.grid.error=void 0;try{this.dialog.showSppinerOverlay("Salvando dados do formul\xE1rio"),i=yield this.dao.save(i,this.join)}catch(a){this.grid.error=a.message?a.message:a,i=void 0}finally{this.dialog.closeSppinerOverlay()}}i&&(e.push(i),this.control.setValue(e)),this.cdRef.detectChanges()})}})})}deleteTarefa(t){return _(this,null,function*(){let i=yield this.dialog.confirm("Exclui ?","Deseja realmente excluir?");if(this.grid.error=void 0,i)try{if(this.isPersist&&this.atividade?.tarefas||t._status=="ADD"){let e=this.control.value,a=e.findIndex(c=>c.id==t.id);this.isPersist&&this.atividade?.tarefas&&(yield this.dao.delete(t)),a>=0&&(e.splice(a,1),this.control.setValue(e))}else t._status="DELETE";this.dialog.alert("Sucesso","Registro exclu\xEDdo com sucesso!"),this.cdRef.detectChanges()}catch(e){this.grid.error=e?.message?e?.message:e}})}onColumnConcluidoEdit(t){return _(this,null,function*(){this.formEdit.controls.concluido.setValue(!!t.data_conclusao)})}onColumnConcluidoSave(t){return _(this,null,function*(){try{let i=this.formEdit.controls.concluido.value?this.auth.hora:null,e=yield this.dao.update(t.id,{data_conclusao:i});return t.concluido=this.formEdit.controls.concluido.value,t.data_conclusao=t.concluido?i:null,!!e}catch{return!1}})}addComentarioResult(t){if(t)if(this.isPersist)this.dao.getById(t.id,this.join).then(i=>{if(i){let e=this.control.value||[],a=e.findIndex(c=>c.id=i.id);a>=0&&(e[a]=i,this.control.setValue(e),this.cdRef.detectChanges())}});else{let i=t.comentarios.filter(e=>["ADD","EDIT","DELETE"].includes(e._status||"")).length>0;t._status=i&&!["ADD","EDIT","DELETE"].includes(t._status||"")?"EDIT":t._status}}dynamicButtons(t){let i=[],e=t,a=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return(!a||a.status=="INCLUIDO"||this.util.asTimestamp(a.data_conclusao)<this.util.asTimestamp(e.created_at))&&(i.push({label:"Alterar",icon:"bi bi-pencil-square",hint:"Alterar",color:"btn-outline-info",onClick:this.editTarefa.bind(this)}),i.push({label:"Excluir",icon:"bi bi-trash",hint:"Excluir",color:"btn-outline-danger",onClick:this.deleteTarefa.bind(this)})),i}canConcluidoEdit(t){let i=t,e=this.atividadeService.lastConsolidacao(this.atividade.metadados.consolidacoes);return!e||e.status=="INCLUIDO"||this.util.asTimestamp(e.data_conclusao)<this.util.asTimestamp(i.data_conclusao)}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["atividade-list-tarefa"]],viewQuery:function(i,e){if(i&1&&g($,5),i&2){let a;v(a=b())&&(e.grid=a.first)}},inputs:{control:"control",persist:"persist",disabled:"disabled",editable:"editable",selectable:"selectable",id_processo:"id_processo",consolidacao:"consolidacao",atividade:"atividade"},features:[k],decls:11,vars:14,consts:[["tipoTarefaDescricao",""],["tarefaComentarios",""],["documento",""],["concluido",""],["editConcluido",""],[3,"control","add","disabled","minHeight","hasEdit","hasDelete","editable","hasAdd"],[3,"title","template"],["title","Documento",3,"template",4,"ngIf"],["title","Conclu\xEDdo",3,"align","template","columnEditTemplate","canEdit","edit","save",4,"ngIf"],["title","Informa\xE7\xF5es adicionais",3,"template"],["type","options",3,"dynamicButtons",4,"ngIf"],["class","d-block",4,"ngIf"],[1,"d-block"],["title","Documento",3,"template"],[3,"documento"],["title","Conclu\xEDdo",3,"align","template","columnEditTemplate","canEdit","edit","save"],[1,"text-center"],["class","bi bi-check-circle",4,"ngIf"],[1,"bi","bi-check-circle"],["controlName","concluido",3,"size","control"],["origem","ATIVIDADE_TAREFA",3,"entity","noPersist","selectable","grid","save"],["type","options",3,"dynamicButtons"]],template:function(i,e){if(i&1&&(u(0,"grid",5)(1,"columns")(2,"column",6),h(3,Rt,2,2,"ng-template",null,0,q),d(),h(5,Qt,3,1,"column",7)(6,Bt,5,6,"column",8),u(7,"column",9),h(8,Kt,1,5,"ng-template",null,1,q),d(),h(10,Ht,1,1,"column",10),d()()),i&2){let a=D(4),c=D(9);r("control",e.control)("add",e.addTarefa.bind(e))("disabled",e.disabled?"true":void 0)("minHeight",50)("hasEdit",!1)("hasDelete",!1)("editable",e.editable?"true":void 0)("hasAdd",e.canAdd),l(2),r("title",e.lex.translate("Tipo de Tarefa")+" e Descri\xE7\xE3o")("template",a),l(3),r("ngIf",e.consolidacao),l(),r("ngIf",e.consolidacao),l(),r("template",c),l(3),r("ngIf",e.editable&&!e.selectable&&!e.id_processo)}},dependencies:[z,$,Se,we,R,ue,pe]});let n=s;return n})();var Jt=["tipoAtividade"],Zt=["docEntregue"];function Xt(n,s){if(n&1&&(u(0,"div",6),m(1,"input-number",15)(2,"input-datetime",16),d()),n&2){let o=f();l(),r("size",6)("decimals",2),l(),r("size",6)("label",o.lex.translate("Prazo de entrega"))("control",o.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+o.lex.translate("atividade"))}}function Yt(n,s){if(n&1&&(u(0,"div",6),m(1,"input-timer",17)(2,"input-number",15)(3,"input-datetime",18),d()),n&2){let o=f();l(),r("size",4)("label",o.lex.translate("Esfor\xE7o"))("control",o.form.controls.esforco),l(),r("size",4)("decimals",2),l(),r("size",4)("label",o.lex.translate("Prazo de entrega"))("control",o.form.controls.data_estipulada_entrega)("labelInfo","Data estipulada para entrega da "+o.lex.translate("atividade"))}}function ei(n,s){if(n&1){let o=V();u(0,"div",6),m(1,"input-datetime",19),u(2,"input-datetime",20),E("change",function(i){C(o);let e=f();return y(e.onDataEntregaChange(i))}),d()()}if(n&2){let o=f();l(),r("size",6)("control",o.form.controls.data_inicio)("labelInfo","Data em que o usu\xE1rio iniciou a "+o.lex.translate("atividade")),l(),r("size",6)("control",o.form.controls.data_entrega)("labelInfo","Data da conclus\xE3o da "+o.lex.translate("atividade"))}}function ti(n,s){if(n&1){let o=V();u(0,"div",6),m(1,"input-datetime",19),u(2,"input-datetime",21),E("change",function(i){C(o);let e=f();return y(e.onDataEntregaChange(i))}),d(),m(3,"input-timer",22),d()}if(n&2){let o=f();l(),r("size",4)("control",o.form.controls.data_inicio)("labelInfo","Data em que o usu\xE1rio iniciou a "+o.lex.translate("atividade")),l(),r("size",4)("control",o.form.controls.data_entrega)("labelInfo","Data da conclus\xE3o da "+o.lex.translate("atividade")),l(),r("size",4)("control",o.form.controls.tempo_despendido)("labelInfo","Calculado no fim da "+o.lex.translate("atividade")+", sendo o tempo l\xEDquido (considerando pausas)")}}function ii(n,s){if(n&1&&(u(0,"separator",23),m(1,"calendar-efemerides",24),d()),n&2){let o=f();l(),r("efemerides",o.efemerides)}}var yt=(()=>{let s=class s extends M{constructor(t){super(t,P,Q),this.injector=t,this.modalWidth=800,this.entregas=[],this.validate=(i,e)=>{let a=null;return(e=="plano_trabalho_entrega_id"&&!i.value?.length||e=="data_entrega"&&!this.util.isDataValid(i.value))&&(a="Obrigat\xF3rio"),a},this.tipoAtividadeDao=t.get(De),this.tipoDocumentoDao=t.get(Te),this.calendar=t.get(Z),this.title="Conclus\xE3o de "+this.lex.translate("atividade"),this.form=this.fh.FormBuilder({tipo_atividade_id:{default:null},data_distribuicao:{default:null},esforco:{default:0},progresso:{default:0},data_estipulada_entrega:{default:null},data_inicio:{default:null},tempo_despendido:{default:0},data_entrega:{default:null},arquivar:{default:!1},descricao_tecnica:{default:""},documento_entrega:{default:new me},documento_entrega_id:{default:null},plano_trabalho_entrega_id:{default:null}},this.cdRef,this.validate),this.join=["plano_trabalho.tipo_modalidade","unidade","plano_trabalho.entregas.plano_entrega_entrega:id,descricao"]}loadData(t,i){return _(this,null,function*(){let e=Object.assign({},i.value);e=this.util.fillForm(e,t),e.data_entrega=this.auth.hora,e.progresso=100,yield this.tipoAtividade.loadSearch(t.tipo_atividade||e.tipo_atividade_id),t.unidade_id!=this.auth.unidade.id&&(yield this.auth.selecionaUnidade(t.unidade_id)),this.entregas=t.plano_trabalho?.entregas?.map(a=>Object.assign({},{key:a.id,value:a.descricao+(a.plano_entrega_entrega?" ("+a.plano_entrega_entrega?.descricao+")":""),data:a}))||[],e.arquivar=!1,i.patchValue(e),this.onDataEntregaChange()})}initializeData(t){return _(this,null,function*(){this.entity=yield this.dao.getAtividade(this.urlParams.get("id")),yield this.loadData(this.entity,t)})}onDataEntregaChange(t){let i=this.form.controls.data_entrega.value,e=this.entity.data_inicio,a=this.entity.carga_horaria,c=this.entity.unidade,p=this.entity.pausas||[],x=this.entity.usuario?.afastamentos||[];this.efemerides=this.util.isDataValid(i)?this.calendar.calculaDataTempoUnidade(e,i,a,c,"ENTREGA",p,x):void 0,this.efemerides&&(this.form.controls.tempo_despendido.setValue(this.efemerides.tempoUtil),this.cdRef.detectChanges())}onTipoAtividadeSelect(t){let i=t.entity;this.form.controls.esforco.setValue(i?.esforco||0),this.cdRef.detectChanges()}saveData(t){return new Promise((i,e)=>{let a=this.util.fill(new P,this.entity);a=this.util.fillForm(a,this.form.value),a.id=this.entity.id,a.descricao_tecnica=this.form.controls.descricao_tecnica.value,a.data_arquivamento=this.form.controls.arquivar.value?new Date:null,a.progresso=this.form.controls.progresso.value,a.produtividade=this.entity?.plano_trabalho?.tipo_modalidade?.atividade_tempo_despendido?this.calendar.produtividade(a.esforco,a.tempo_despendido):null,this.dao.concluir(a).then(c=>i(c)).catch(e)})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-form-concluir"]],viewQuery:function(i,e){if(i&1&&(g(Jt,5),g(Zt,5),g(T,5)),i&2){let a;v(a=b())&&(e.tipoAtividade=a.first),v(a=b())&&(e.docEntregue=a.first),v(a=b())&&(e.editableForm=a.first)}},features:[k],decls:19,vars:23,consts:[["tipoAtividade",""],["entrega",""],["comEsforco",""],["comTempoDespendido",""],["initialFocus","tipo_atividade_id",3,"submit","cancel","form","disabled"],[3,"documento"],[1,"row"],["controlName","tipo_atividade_id",3,"select","label","emptyValue","size","dao"],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["label","Arquivar","controlName","arquivar","labelInfo","Arquivar automaticamente ap\xF3s a conclus\xE3o (Somente se o plano dispensar avalia\xE7\xE3o)",3,"size","control"],["collapse","",3,"title","collapsed"],["persist","",3,"atividade"],["class","row",4,"ngIf","ngIfElse"],["title","Conclus\xE3o"],["title","C\xE1lculos das horas","collapse","",4,"ngIf"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xE7\xE3o (% Conclu\xEDdo). Sempre ser\xE1 100% na conclus\xE3o!",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xE7\xE3o",3,"size","label","control"],["noIcon","","disabled","","controlName","data_estipulada_entrega",3,"size","label","control","labelInfo"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","",3,"size","control","labelInfo"],["noIcon","","label","Conclus\xE3o","controlName","data_entrega","required","",3,"change","size","control","labelInfo"],["noIcon","","label","Conclus\xE3o","controlName","data_entrega",3,"change","size","control","labelInfo"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","",3,"size","control","labelInfo"],["title","C\xE1lculos das horas","collapse",""],[3,"efemerides"]],template:function(i,e){if(i&1){let a=V();u(0,"editable-form",4),E("submit",function(){return C(a),y(e.onSaveData())})("cancel",function(){return C(a),y(e.onCancel())}),m(1,"documento-link",5),u(2,"div",6)(3,"input-search",7,0),E("select",function(p){return C(a),y(e.onTipoAtividadeSelect(p))}),d(),m(5,"input-select",8,1)(7,"input-switch",9),d(),u(8,"separator",10),m(9,"atividade-list-tarefa",11),d(),h(10,Xt,3,6,"div",12)(11,Yt,4,9,"ng-template",null,2,q),u(13,"separator",13),h(14,ei,3,6,"div",12)(15,ti,4,9,"ng-template",null,3,q),m(17,"documento-link",5),d(),h(18,ii,2,1,"separator",14),d()}if(i&2){let a=D(12),c=D(16);r("form",e.form)("disabled",e.formDisabled),l(),r("documento",e.form.controls.documento_entrega.value),l(2),r("label","Tipo de"+e.lex.translate("Atividade"))("emptyValue",null)("size",5)("dao",e.tipoAtividadeDao),l(2),r("label",e.lex.translate("Entrega do plano"))("size",5)("control",e.form.controls.plano_trabalho_entrega_id)("items",e.entregas)("labelInfo",e.lex.translate("Entrega do plano")+" que a "+e.lex.translate("atividade")+" \xE9 referente"),l(2),r("size",2)("control",e.form.controls.arquivar),l(),r("title","Tarefa da "+e.lex.translate("atividade"))("collapsed",!1),l(),r("atividade",e.entity),l(),r("ngIf",!(!(e.entity==null||e.entity.plano_trabalho==null||e.entity.plano_trabalho.tipo_modalidade==null)&&e.entity.plano_trabalho.tipo_modalidade.atividade_esforco))("ngIfElse",a),l(4),r("ngIf",!(!(e.entity==null||e.entity.plano_trabalho==null||e.entity.plano_trabalho.tipo_modalidade==null)&&e.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",c),l(3),r("documento",e.form.controls.documento_entrega.value),l(),r("ngIf",e.efemerides&&(e.entity==null||e.entity.plano_trabalho==null||e.entity.plano_trabalho.tipo_modalidade==null?null:e.entity.plano_trabalho.tipo_modalidade.atividade_tempo_despendido))}},dependencies:[z,T,R,B,U,H,qe,G,ee,xe,ae,ne]});let n=s;return n})();var ai=["documento"],oi=["comentarios"],ni=["tipoTarefa"],Ge=(()=>{let s=class s extends M{constructor(t){super(t,oe,Ae),this.injector=t,this.modalWidth=800,this.validate=(i,e)=>{let a=null;return["descricao"].includes(e)&&!i.value?.length&&(a="Obrigat\xF3rio"),a},this.formValidation=i=>{let e=i.value;if(e.tipo_tarefa_id?.length&&!this.tipoTarefa?.selectedEntity)return"Aguarde o carregamento "+this.lex.translate("tipo de tarefa")+". Caso demore, selecione novamente!";if(e.concluido&&this.tipoTarefa?.selectedEntity?.documental&&this.documento?.isEmpty())return this.gb.isEmbedded?"Obrigat\xF3rio selecionar um arquivo para a tarefa selecionada!":"Utilize o sistema como extens\xE3o para concluir!"},this.tipoTarefaDao=t.get(ot),this.tipoDocumentoDao=t.get(Te),this.tipoProcessoDao=t.get(nt),this.allPages=t.get(ke),this.comentario=t.get(Fe),this.title=this.lex.translate("Tarefa da atividade"),this.form=this.fh.FormBuilder({descricao:{default:""},tipo_tarefa_id:{default:null},tempo_estimado:{default:0},concluido:{default:!0},id_processo:{default:0},numero_processo:{default:""},documento:{default:null},comentarios:{default:[]}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit();let t=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=t=="comentar"?t:this.action}loadData(t,i){return _(this,null,function*(){let e=Object.assign({},i.value);e=this.util.fillForm(e,t),yield this.tipoTarefa?.loadSearch(t.tipo_tarefa||e.tipo_tarefa_id),e.comentarios=this.comentario.orderComentarios(e.comentarios||[]),i.patchValue(e)})}initializeData(t){return _(this,null,function*(){this.entity=this.metadata.tarefa,this.atividade=this.metadata.atividade,this.sei=this.metadata.sei,yield this.loadData(this.entity,t)})}saveData(t){return _(this,null,function*(){return this.comentarios?.confirm(),this.util.fillForm(this.entity,this.form.value),this.entity.tipo_tarefa=this.tipoTarefa?.selectedEntity,this.entity.data_conclusao=this.form.controls.concluido.value&&!this.entity.data_conclusao?this.auth.hora:this.entity.data_conclusao,new et(this.entity)})}onTipoTarefaSelect(t){let i=t.entity;this.form.controls.tempo_estimado.setValue(i?.tempo_estimado||0)}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-form-tarefa"]],viewQuery:function(i,e){if(i&1&&(g(T,5),g(ai,5),g(oi,5),g(ni,5)),i&2){let a;v(a=b())&&(e.editableForm=a.first),v(a=b())&&(e.documento=a.first),v(a=b())&&(e.comentarios=a.first),v(a=b())&&(e.tipoTarefa=a.first)}},features:[k],decls:15,vars:16,consts:[["tipoTarefa",""],["documento",""],["comentarios",""],["initialFocus","descricao",3,"submit","cancel","form","disabled"],["display","","right","",3,"title"],["key","TAREFA",3,"label"],[1,"row"],["label","Descri\xE7\xE3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","tipo_tarefa_id",3,"select","label","size","control","dao"],["label","Conclu\xEDdo","controlName","concluido","labelInfo","Se foi conclu\xEDda",3,"size","control"],[3,"sei","documento"],["key","COMENTARIOS","label","Comentarios"],["clss","row"],["origem","ATIVIDADE_TAREFA",3,"control"]],template:function(i,e){if(i&1){let a=V();u(0,"editable-form",3),E("submit",function(){return C(a),y(e.onSaveData())})("cancel",function(){return C(a),y(e.onCancel())}),u(1,"tabs",4)(2,"tab",5)(3,"div",6),m(4,"input-textarea",7),d(),u(5,"div",6)(6,"input-search",8,0),E("select",function(p){return C(a),y(e.onTipoTarefaSelect(p))}),d(),m(8,"input-switch",9),d(),m(9,"documento-link",10,1),d(),u(11,"tab",11)(12,"div",12),m(13,"comentarios",13,2),d()()()()}i&2&&(r("form",e.form)("disabled",e.formDisabled),l(),r("title",e.isModal?"":e.title),l(),r("label",e.lex.translate("Tarefa da Atividade")),l(2),r("size",12)("rows",2)("control",e.form.controls.descricao),l(2),r("label",e.lex.translate("Tipo de Tarefa"))("size",10)("control",e.form.controls.tipo_tarefa_id)("dao",e.tipoTarefaDao),l(2),r("size",2)("control",e.form.controls.concluido),l(),r("sei",e.sei)("documento",e.form.controls.documento.value),l(4),r("control",e.form.controls.comentarios))},dependencies:[T,R,B,Y,ie,te,ft,ae],styles:['@charset "UTF-8";.comentario-table[_ngcontent-%COMP%]{width:100%}.comentario-user[_ngcontent-%COMP%]{width:50px;vertical-align:top;padding:8px}.comentario-container[_ngcontent-%COMP%]{padding-left:10px;width:auto;border-left:var(--bs-gray-400) 2px solid;position:relative}.comentario-user-indicator[_ngcontent-%COMP%]{content:"";position:absolute;width:0px;height:0px;top:0;left:-12px;border-top:.75rem solid var(--bs-gray-400);border-left:.75rem solid transparent;border-bottom:none;border-right:none}.comentario-level[_ngcontent-%COMP%]{color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.7em;color:var(--bs-gray)}.comentario-message-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:before{content:" \\2022  "}']});let n=s;return n})();var ri=["usuario"],si=["planoTrabalho"],li=["planejado"],di=()=>["planos_trabalho.tipo_modalidade:id,nome","planos_trabalho.entregas.entrega:id,nome"],Tt=(()=>{let s=class s extends M{get labelInfoSuspender(){let t=this.iniciadas.length>1?this.lex.translate("tarefas"):this.lex.translate("tarefa"),i=this.iniciadas.length==1?"":"s",e=this.iniciadas.length==1?"":" "+this.iniciadas.length.toString();return this.iniciadas.length?`Suspender a${i}${e} ${t} j\xE1 iniciada${i}?`:"N\xE3o h\xE1 outras atividades iniciadas pelo usu\xE1rio!"}constructor(t){super(t,P,Q),this.injector=t,this.modalWidth=600,this.iniciadas=[],this.planoTrabalhoSelecionado=null,this.planosTrabalhos=[],this.planosTrabalhosEntregas=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.validate=(i,e)=>{let a=null;return(["usuario_id","plano_trabalho_id","plano_trabalho_entrega_id"].includes(e)&&!i.value?.length||e=="data_inicio"&&!i.value)&&(a="Obrigat\xF3rio"),a},this.formValidation=i=>{let e;return this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_inicio.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_inicio.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(e="Data de in\xEDcio fora do per\xEDodo do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xE9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_6]"),e},this.usuarioDao=t.get(Ee),this.planoTrabalhoDao=t.get(Ie),this.calendar=t.get(Z),this.form=this.fh.FormBuilder({usuario_id:{default:void 0},plano_trabalho_id:{default:void 0},plano_trabalho_entrega_id:{default:void 0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},carga_horaria:{default:0},tempo_planejado:{default:0},esforco:{default:0},data_inicio:{default:null},suspender:{default:!1}},this.cdRef,this.validate),this.join=["unidade","atividade","usuario.planos_trabalho.tipo_modalidade"]}loadIniciadas(t){this.iniciadas=[],t?.length&&this.dao.iniciadas(t).then(i=>{this.iniciadas=i,this.cdRef.detectChanges()})}onUsuarioSelect(t){let e=t.entity?.planos_trabalho||[];this.planosTrabalhos=e.filter(a=>a.unidade_id==this.entity.unidade_id).map(a=>({key:a.id,value:(a.tipo_modalidade?.nome||"")+" - "+this.dao.getDateFormatted(a.data_inicio)+" \xE0 "+this.dao.getDateFormatted(a.data_fim),data:a})),this.cdRef.detectChanges(),!this.form.controls.plano_trabalho_id.value?.length&&this.planosTrabalhos.length==1&&this.form.controls.plano_trabalho_id.setValue(this.planosTrabalhos[0].key),this.cdRef.detectChanges()}onPlanoChange(t){_(this,null,function*(){if(this.entity&&this.planoTrabalho?.selectedItem?.data){let i=this.planoTrabalho?.selectedItem?.data;this.planoTrabalhoSelecionado?.id!=i.id&&(this.planoTrabalhoSelecionado=yield this.planoTrabalhoDao.getById(i.id,this.planoTrabalhoJoin));let e=i?.carga_horaria||this.calendar.expedienteMedio(this.entity.unidade),a=this.calendar.horasUteis(this.form.controls.data_distribuicao.value,this.form.controls.data_estipulada_entrega.value,e,this.entity.unidade,"DISTRIBUICAO");this.form.controls.carga_horaria.setValue(e),this.form.controls.tempo_planejado.setValue(a),this.form.controls.esforco.setValue(this.form.controls.esforco.value||this.entity?.tipo_atividade?.esforco||0);let c=this.form.controls.plano_trabalho_entrega_id.value;this.planosTrabalhosEntregas=this.planoTrabalhoSelecionado?.entregas?.map(p=>Object.assign({},{key:p.id,value:p.descricao+(p.plano_entrega_entrega?" ("+p.plano_entrega_entrega?.descricao+")":""),data:p}))||[],this.cdRef.detectChanges(),this.form.controls.plano_trabalho_entrega_id.setValue(!c?.length&&this.planosTrabalhos.length>0?this.planosTrabalhos[0].key:c)}})}loadData(t,i){return _(this,null,function*(){let e=Object.assign({},i.value);e=this.util.fillForm(e,t),e.usuario_id?.length||(e.usuario_id=this.auth.usuario?.id),e.data_inicio=e.data_inicio||this.util.setStrTime(new Date,this.auth.unidadeHora),yield this.usuario.loadSearch(t.usuario||e.usuario_id),this.loadIniciadas(e.usuario_id),t.unidade_id!=this.auth.unidade.id&&(yield this.auth.selecionaUnidade(t.unidade_id)),i.patchValue(e),this.onPlanoChange(new Event("change"))})}initializeData(t){return _(this,null,function*(){this.entity=yield this.dao.getById(this.urlParams.get("id"),this.join),yield this.loadData(this.entity,t)})}saveData(t){return new Promise((i,e)=>{let a=this.util.fill(new P,this.entity);a=this.util.fillForm(a,this.form.value),a.id=this.entity.id,a.suspender=this.form.controls.suspender.value,this.dao.iniciar(a).then(c=>i(c)).catch(e)})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-form-iniciar"]],viewQuery:function(i,e){if(i&1&&(g(T,5),g(ri,5),g(si,5),g(li,5)),i&2){let a;v(a=b())&&(e.editableForm=a.first),v(a=b())&&(e.usuario=a.first),v(a=b())&&(e.planoTrabalho=a.first),v(a=b())&&(e.planejado=a.first)}},features:[k],decls:17,vars:28,consts:[["usuario",""],["planoTrabalho",""],["entrega",""],["initialFocus","data_distribuicao",3,"submit","cancel","form","disabled"],[1,"row"],["controlName","data_distribuicao","disabled","","labelInfo","Data de cadastro da atividade",3,"size","label","control"],["controlName","data_estipulada_entrega","disabled","","labelInfo","Data estipulada para entrega da atividade",3,"size","label","control"],["label","Respons\xE1vel","controlName","usuario_id","labelInfo","Respons\xE1vel por executar a atividade","required","",3,"select","size","dao","join"],["controlName","plano_trabalho_id","required","",3,"change","label","size","control","items","labelInfo"],["controlName","plano_trabalho_entrega_id","required","",3,"label","size","control","items","labelInfo"],["label","Inicio","controlName","data_inicio","labelInfo","Data em que o usu\xE1rio iniciou a atividade","required","",3,"size","control"],["label","Suspender as demais","controlName","suspender",3,"size","control","disabled","labelInfo"]],template:function(i,e){if(i&1){let a=V();u(0,"editable-form",3),E("submit",function(){return C(a),y(e.onSaveData())})("cancel",function(){return C(a),y(e.onCancel())}),u(1,"div",4),m(2,"input-datetime",5)(3,"input-datetime",6),d(),m(4,"separator"),u(5,"div",4)(6,"input-search",7,0),E("select",function(p){return C(a),y(e.onUsuarioSelect(p))}),d()(),u(8,"div",4)(9,"input-select",8,1),E("change",function(p){return C(a),y(e.onPlanoChange(p))}),d(),m(11,"input-select",9,2),d(),m(13,"separator"),u(14,"div",4),m(15,"input-datetime",10)(16,"input-switch",11),d()()}i&2&&(r("form",e.form)("disabled",e.formDisabled),l(2),r("size",6)("label",e.lex.translate("Data de distribui\xE7\xE3o"))("control",e.form.controls.data_distribuicao),l(),r("size",6)("label",e.lex.translate("Prazo de entrega"))("control",e.form.controls.data_estipulada_entrega),l(3),r("size",12)("dao",e.usuarioDao)("join",le(27,di)),l(3),r("label",e.lex.translate("Plano de trabalho"))("size",7)("control",e.form.controls.plano_trabalho_id)("items",e.planosTrabalhos)("labelInfo",e.lex.translate("Plano de trabalho")),l(2),r("label",e.lex.translate("Entrega do plano"))("size",5)("control",e.form.controls.plano_trabalho_entrega_id)("items",e.planosTrabalhosEntregas)("labelInfo",e.lex.translate("Entrega")+" do "+e.lex.translate("plano de trabalho")+" que a "+e.lex.translate("atividade")+" \xE9 referente"),l(4),r("size",6)("control",e.form.controls.data_inicio),l(),r("size",6)("control",e.form.controls.suspender)("disabled",e.iniciadas.length?void 0:"")("labelInfo",e.labelInfoSuspender))},dependencies:[T,R,B,U,H,G]});let n=s;return n})();function ci(n,s){n&1&&m(0,"top-alert",5)}function ui(n,s){if(n&1&&(u(0,"div",3),m(1,"input-datetime",6),d()),n&2){let o=f();l(),r("size",12)("control",o.form.controls.data_inicio)}}var At=(()=>{let s=class s extends M{constructor(t){super(t,P,Q),this.injector=t,this.reiniciar=!1,this.modalWidth=400,this.validate=(i,e)=>{let a=null,c=this.entity?.pausas?.find(p=>!p.data_fim);return e=="data"&&(this.reiniciar&&!c?a="N\xE3o \xE1 pausa!":this.util.isDataValid(i.value)?c&&this.entity&&i.value.getTime()<this.entity.data_inicio.getTime()&&(a="Menor que in\xEDcio!"):a="Obrigat\xF3rio"),a},this.form=this.fh.FormBuilder({data_inicio:{default:void 0},data:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){this.reiniciar=!!this.queryParams?.reiniciar,this.title=this.reiniciar?"Reiniciar":"Suspender",super.ngAfterViewInit()}loadData(t,i){return _(this,null,function*(){let e=this.entity?.pausas?.find(c=>!c.data_fim);this.reiniciar&&!e&&this.error("N\xE3o h\xE1 pausa ativa para ser reiniciada.");let a={inicio:this.reiniciar?e?.data_inicio:void 0,data:this.util.setStrTime(new Date,this.auth.unidadeHora)};t.unidade_id!=this.auth.unidade.id&&(yield this.auth.selecionaUnidade(t.unidade_id)),i.patchValue(a)})}initializeData(t){return _(this,null,function*(){this.entity=yield this.dao.getAtividade(this.urlParams.get("id")),yield this.loadData(this.entity,t)})}saveData(t){return new Promise((i,e)=>{let a={atividade_id:this.entity.id,data:this.form.controls.data.value};this.reiniciar?this.dao.reiniciar(a).then(c=>i(c)).catch(e):this.dao.pausar(a).then(c=>i(c)).catch(e)})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-form-pausar"]],viewQuery:function(i,e){if(i&1&&g(T,5),i&2){let a;v(a=b())&&(e.editableForm=a.first)}},features:[k],decls:5,vars:8,consts:[["type","warning","message","Dica: N\xE3o \xE9 necess\xE1rio suspender a tarefa entre as jornadas de trabalho!",4,"ngIf"],["initialFocus","data",3,"submit","cancel","form","disabled"],["class","row",4,"ngIf"],[1,"row"],["controlName","data","required","",3,"size","label","control","labelInfo"],["type","warning","message","Dica: N\xE3o \xE9 necess\xE1rio suspender a tarefa entre as jornadas de trabalho!"],["label","In\xEDcio da pausa","controlName","data_inicio","disabled","","labelInfo","Data de in\xEDcio da \xFAltima pausa",3,"size","control"]],template:function(i,e){i&1&&(h(0,ci,1,0,"top-alert",0),u(1,"editable-form",1),E("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),h(2,ui,2,2,"div",2),u(3,"div",3),m(4,"input-datetime",4),d()()),i&2&&(r("ngIf",!e.reiniciar),l(),r("form",e.form)("disabled",e.formDisabled),l(),r("ngIf",e.reiniciar),l(2),r("size",12)("label",e.reiniciar?"Data de rein\xEDcio":"Data da pausa")("control",e.form.controls.data)("labelInfo",e.reiniciar?"Data e hora do rein\xEDcio da atividade":"Data e hora do in\xEDcio da pausa/suspens\xE3o"))},dependencies:[z,T,U,mt]});let n=s;return n})();var wt=(()=>{let s=class s extends M{constructor(t){super(t,P,Q),this.injector=t,this.modalWidth=400,this.validate=(i,e)=>{let a=null;return e=="data_estipulada_entrega"&&(this.util.isDataValid(i.value)?this.entity?.data_distribuicao&&i.value.getTime()<this.entity.data_distribuicao.getTime()&&(a="Menor que distribui\xE7\xE3o!"):a="Obrigat\xF3rio"),a},this.form=this.fh.FormBuilder({data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date}},this.cdRef,this.validate)}loadData(t,i){return _(this,null,function*(){let e={data_distribuicao:t.data_distribuicao,data_estipulada_entrega:t.data_estipulada_entrega};t.unidade_id!=this.auth.unidade.id&&(yield this.auth.selecionaUnidade(t.unidade_id)),i.patchValue(e)})}initializeData(t){return _(this,null,function*(){this.entity=yield this.dao.getAtividade(this.urlParams.get("id")),yield this.loadData(this.entity,t)})}saveData(t){return new Promise((i,e)=>{let a={id:this.entity.id,data_estipulada_entrega:this.form.controls.data_estipulada_entrega.value};this.dao.prorrogar(a).then(c=>i(c)).catch(e)})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-form-prorrogar"]],viewQuery:function(i,e){if(i&1&&g(T,5),i&2){let a;v(a=b())&&(e.editableForm=a.first)}},features:[k],decls:5,vars:7,consts:[["initialFocus","data_estipulada_entrega",3,"submit","cancel","form","disabled"],[1,"row"],["label","Data da distribui\xE7\xE3o","controlName","data_distribuicao","disabled","","labelInfo","Data de distribui\xE7\xE3o da atividade",3,"size","control"],["controlName","data_estipulada_entrega","labelInfo","Prazo para entrega da atividade","required","",3,"size","label","control"]],template:function(i,e){i&1&&(u(0,"editable-form",0),E("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),u(1,"div",1),m(2,"input-datetime",2),d(),u(3,"div",1),m(4,"input-datetime",3),d()()),i&2&&(r("form",e.form)("disabled",e.formDisabled),l(2),r("size",12)("control",e.form.controls.data_distribuicao),l(2),r("size",12)("label",e.lex.translate("Prazo de entrega"))("control",e.form.controls.data_estipulada_entrega))},dependencies:[T,U]});let n=s;return n})();var mi=["etiqueta"],pi=["tipoAtividade"],fi=["planoTrabalho"],hi=["unidade"],_i=["usuario"],gi=["comentarios"],vi=["requisicao"];function bi(n,s){if(n&1&&m(0,"input-switch",23),n&2){let o=f();r("size",1)("disabled",o.form.controls.concluido.value?"true":void 0)}}function Ci(n,s){if(n&1){let o=V();u(0,"input-switch",24),E("change",function(i){C(o);let e=f();return y(e.onConcluidoChange(i))}),d()}n&2&&r("size",1)}function yi(n,s){if(n&1){let o=V();u(0,"div",12)(1,"input-datetime",25),E("change",function(i){C(o);let e=f();return y(e.onDataDistribuicaoChange(i))}),d(),m(2,"input-number",26),u(3,"input-datetime",27),E("change",function(i){C(o);let e=f();return y(e.onPrazoEntregaChange(i))}),d()()}if(n&2){let o=f();l(),r("size",4)("label",o.lex.translate("Data de distribui\xE7\xE3o"))("control",o.form.controls.data_distribuicao),l(),r("size",4)("decimals",2),l(),r("size",4)("label",o.lex.translate("Prazo de entrega"))("control",o.form.controls.data_estipulada_entrega)}}function Ei(n,s){if(n&1){let o=V();u(0,"div",12)(1,"input-datetime",25),E("change",function(i){C(o);let e=f();return y(e.onDataDistribuicaoChange(i))}),d(),m(2,"input-timer",28)(3,"input-number",26),u(4,"input-datetime",27),E("change",function(i){C(o);let e=f();return y(e.onPrazoEntregaChange(i))}),d()()}if(n&2){let o=f();l(),r("size",3)("label",o.lex.translate("Data de distribui\xE7\xE3o"))("control",o.form.controls.data_distribuicao),l(),r("size",3)("label",o.lex.translate("Esfor\xE7o"))("control",o.form.controls.esforco),l(),r("size",3)("decimals",2),l(),r("size",3)("label",o.lex.translate("Prazo de entrega"))("control",o.form.controls.data_estipulada_entrega)}}function Ii(n,s){if(n&1&&(u(0,"div",12),m(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-datetime",33),d()),n&2){let o=f(2);l(),r("size",4)("control",o.form.controls.data_inicio),l(),r("size",4)("control",o.form.controls.data_entrega),l(),r("size",4)("control",o.form.controls.data_inicio)}}function Di(n,s){if(n&1&&(u(0,"div",12),m(1,"input-datetime",31)(2,"input-datetime",32)(3,"input-timer",34)(4,"input-datetime",33),d()),n&2){let o=f(2);l(),r("size",4)("control",o.form.controls.data_inicio),l(),r("size",4)("control",o.form.controls.data_entrega),l(),r("size",4)("control",o.form.controls.tempo_despendido),l(),r("size",4)("control",o.form.controls.data_inicio)}}function Ti(n,s){if(n&1&&(u(0,"separator",29),h(1,Ii,4,6,"div",21)(2,Di,5,8,"ng-template",null,7,q),m(4,"documento-link",30),d()),n&2){let o=D(3),t=f(),i=D(18);l(),r("ngIf",!(!(i==null||i.selectedItem==null||i.selectedItem.data==null||i.selectedItem.data.tipo_modalidade==null)&&i.selectedItem.data.tipo_modalidade.atividade_tempo_despendido))("ngIfElse",o),l(3),r("documento",t.form.controls.documento_entrega.value)}}var re=(()=>{let s=class s extends M{constructor(t){super(t,P,Q),this.injector=t,this.etiquetas=[],this.checklist=[],this.planosTrabalhos=[],this.planoTrabalhoJoin=["entregas.plano_entrega_entrega:id,descricao","tipo_modalidade:id,nome"],this.planoTrabalhoSelecionado=null,this.usuarioJoin=["planos_trabalho.entregas.plano_entrega_entrega:id,descricao","planos_trabalho.tipo_modalidade:id,nome"],this.entregas=[],this.validateChecklist=(e,a)=>null,this.validate=(e,a)=>{let c=null;if(["unidade_id","descricao"].includes(a)&&!e?.value?.length)c="Obrigat\xF3rio";else if(a=="tipo_atividade_id"&&!e?.value?.length&&!this.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO"))c="Obrigat\xF3rio";else if(["data_distribuicao","data_estipulada_entrega"].includes(a)){let p=this.form?.controls.data_estipulada_entrega?.value,x=this.form?.controls.data_distribuicao?.value;this.util.isDataValid(e.value)?a=="data_distribuicao"&&e.value&&this.util.isDataValid(p)&&e.value.getTime()>p.getTime()?c="Maior que entrega":a=="data_estipulada_entrega"&&e.value&&this.util.isDataValid(x)&&e.value.getTime()<x.getTime()&&(c="Menor que distribui\xE7\xE3o"):c="Data inv\xE1lida"}else a=="plano_trabalho_id"&&!e.value?.length&&this.form?.controls?.usuario_id.value?.length?c="Obrigat\xF3rio":a=="plano_trabalho_entrega_id"&&(this.form?.controls?.plano_trabalho_id.value?.length&&!e.value?.length?c="Obrigat\xF3rio":e.value?.length&&!this.entregas.find(p=>p.key==e.value)&&(c="Selecione"));return c},this.formValidation=e=>{let a;if(this.loadEtiquetas(),this.form.controls.tipo_atividade_id.value){let N=this.tipoAtividade?.selectedEntity.checklist;N&&this.form.controls.checklist.value.length==N.length&&this.loadChecklist()}let c=this.etiquetas.map(N=>N.key),p=this.checklist.map(N=>N.id),x=(this.form.controls.etiquetas.value||[]).find(N=>!c.includes(N.key)),se=(this.form.controls.checklist.value||[]).find(N=>!p.includes(N.id)&&N.checked);return x&&(a="Etiqueta "+x.value+"n\xE3o pode ser utilizada!"),se&&(a="Checklist "+se.texto+"n\xE3o pode ser utilizado!"),this.planoTrabalhoSelecionado&&(this.util.asTimestamp(this.form.controls.data_distribuicao.value)<this.util.asTimestamp(this.planoTrabalhoSelecionado.data_inicio)||this.util.asTimestamp(this.form.controls.data_estipulada_entrega.value)>this.util.asTimestamp(this.planoTrabalhoSelecionado.data_fim))&&(a="A atividade dever\xE1 ter per\xEDdo compat\xEDvel com o do plano de trabalho ("+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_inicio)+" at\xE9 "+this.util.getDateFormatted(this.planoTrabalhoSelecionado.data_fim)+") [RN_ATV_5]"),a};let i=this.auth.hora;this.tipoAtividadeDao=t.get(De),this.unidadeDao=t.get(tt),this.usuarioDao=t.get(Ee),this.planoTrabalhoDao=t.get(Ie),this.atividadeService=t.get(Oe),this.unidadeService=t.get(it),this.calendar=t.get(Z),this.comentario=t.get(Fe),this.title="Inclus\xE3o de "+this.lex.translate("Atividade"),this.form=this.fh.FormBuilder({numero:{default:0},descricao:{default:""},data_distribuicao:{default:i},carga_horaria:{default:0},tempo_planejado:{default:0},data_estipulada_entrega:{default:i},data_inicio:{default:null},data_entrega:{default:null},esforco:{default:0},tempo_despendido:{default:0},data_arquivamento:{default:null},etiquetas:{default:[]},checklist:{default:[]},prioridade:{default:0},progresso:{default:0},plano_trabalho_id:{default:null},plano_trabalho_entrega_id:{default:null},tipo_atividade_id:{default:null},demandante_id:{default:""},usuario_id:{default:null},unidade_id:{default:""},documento_requisicao_id:{default:null},documento_entrega_id:{default:null},comentarios:{default:[]},pausas:{default:[]},etiqueta:{default:""},tarefas:{default:[]},iniciado:{default:!1},concluido:{default:!1},documento_requisicao:{default:void 0},documento_entrega:{default:void 0}},this.cdRef,this.validate),this.formChecklist=this.fh.FormBuilder({id:{default:""},texto:{default:""},checked:{default:!1}},this.cdRef,this.validateChecklist),this.join=["usuario.planos_trabalho.tipo_modalidade:id,nome","pausas","tipo_atividade","unidade","comentarios.usuario","tarefas.tipo_tarefa","tarefas.comentarios.usuario","documento_requisicao","documento_entrega"]}ngOnInit(){super.ngOnInit();let t=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["comentar","clonar"].includes(t)?t:this.action}get isClonar(){return this.action=="clonar"}get titleAtividade(){return this.form?.controls.numero?.value?"#"+this.form?.controls.numero?.value:""}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){let i=this.etiqueta.selectedItem,e=i.key?.length?i.key:this.util.textHash(i.value);this.util.validateLookupItem(this.form.controls.etiquetas.value,e)&&(t={key:e,value:i.value,color:i.color,icon:i.icon},this.form.controls.etiqueta.setValue(""))}return t}onUnidadeChange(t){this.loadEtiquetas()}onDataDistribuicaoChange(t){this.loadUsuario(this.usuario?.selectedEntity),this.form?.controls.data_estipulada_entrega.updateValueAndValidity()}onPrazoEntregaChange(t){this.form?.controls.data_distribuicao.updateValueAndValidity()}onPlanoTrabalhoChange(t){_(this,null,function*(){if(this.entity){let i=this.usuario?.selectedEntity?.planos_trabalho?.find(e=>e.id==this.form.controls.plano_trabalho_id.value);if(i){if(this.planoTrabalhoSelecionado?.id!=i.id&&(this.planoTrabalhoSelecionado=yield this.planoTrabalhoDao.getById(i.id,this.planoTrabalhoJoin)),this.form.controls.unidade_id.value!=i.unidade_id){let a=yield this.unidadeDao.getById(i.unidade_id);a&&(yield this.unidade?.loadSearch(a),yield this.auth.selecionaUnidade(a.id))}let e=this.form.controls.plano_trabalho_entrega_id.value;this.entregas=this.planoTrabalhoSelecionado?.entregas?.map(a=>Object.assign({},{key:a.id,value:a.descricao+(a.plano_entrega_entrega?" ("+a.plano_entrega_entrega?.descricao+")":""),data:a}))||[],this.cdRef.detectChanges(),this.form.controls.plano_trabalho_entrega_id.setValue(!e?.length&&this.entregas.length>0?this.entregas[0].key:e)}else this.entregas=[],this.form.controls.plano_trabalho_entrega_id.setValue(null)}})}loadEtiquetas(){this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade?.selectedEntity,this.tipoAtividade?.selectedEntity)}loadChecklist(){let t=this.tipoAtividade?.selectedEntity,i=t.checklist?.map(e=>({id:e.key,texto:e.value,checked:!1}));this.checklist=i||[],this.form.controls.checklist.setValue(i),this.atividadeService.buildChecklist(t,this.form.controls.checklist)}loadTipoAtividade(t){t?(this.loadEtiquetas(),this.loadChecklist()):(this.etiquetas=[],this.form.controls.esforco.setValue(0),this.form.controls.tempo_planejado.setValue(0)),this.cdRef.detectChanges()}getPlanosTrabalhos(t,i,e){return t.planos_trabalho?.filter(a=>a.id==e||this.util.between(i,{start:a.data_inicio,end:a.data_fim})&&a.status=="ATIVO").map(a=>Object.assign({key:a.id,value:(a.tipo_modalidade?.nome||"")+" - "+this.usuarioDao.getDateFormatted(a.data_inicio)+" a "+this.usuarioDao.getDateFormatted(a.data_fim),data:a}))||[]}loadUsuario(t){if(t){let i=this.form.controls.plano_trabalho_id.value,e=this.form.controls.data_distribuicao.value||new Date;this.planosTrabalhos=this.getPlanosTrabalhos(t,e,i),this.hasUsuarioActionNew&&this.auth.usuario.id==this.form.controls.usuario_id.value&&this.form.controls.iniciado.setValue(!0),this.cdRef.detectChanges(),this.form.controls.plano_trabalho_id.setValue(!i?.length&&this.planosTrabalhos.length>0?this.planosTrabalhos[0].key:i)}else this.planosTrabalhos=[],this.form.controls.plano_trabalho_id.setValue(null);this.cdRef.detectChanges()}get hasUsuarioActionNew(){return this.form?.controls.usuario_id?.value?.length&&this.action=="new"}onTipoAtividadeSelect(t){let i=t.entity;this.loadTipoAtividade(i),this.atividadeService.comentarioAtividade(i,this.form.controls.comentarios),this.cdRef.detectChanges()}onTipoAtividadeChange(t){this.form?.controls.tipo_atividade_id.value?.length||this.loadTipoAtividade(void 0)}onUsuarioSelect(t){let i=t.entity;this.loadUsuario(i)}onUsuarioChange(t){this.form?.controls.usuario_id.value?.length||this.loadUsuario(void 0)}onConcluidoChange(t){this.hasUsuarioActionNew&&this.form.controls.concluido.value?(this.form.controls.iniciado.setValue(!0),this.form.controls.progresso.setValue(100)):this.form.controls.progresso.setValue(0)}orderPausas(t){return t.sort((i,e)=>i.data_inicio<e.data_inicio?-1:1)}loadData(t,i){return _(this,null,function*(){let e=Object.assign({},i.value);e=this.util.fillForm(e,t),this.planoTrabalhoSelecionado=t.plano_trabalho,yield Promise.all([this.unidade?.loadSearch(t.unidade||e.unidade_id,!1),this.usuario?.loadSearch(t.usuario||e.usuario_id,!1),this.tipoAtividade?.loadSearch(t.tipo_atividade||e.tipo_atividade_id,!1)]),i.patchValue(e,{emitEvent:!1}),t.usuario&&this.loadUsuario(t.usuario),t.tipo_atividade&&this.loadTipoAtividade(t.tipo_atividade),t.unidade_id!=this.auth.unidade.id&&(yield this.auth.selecionaUnidade(t.unidade_id)),t.comentarios=this.comentario.orderComentarios(t.comentarios||[]),t.pausas=this.orderPausas(t.pausas||[]),i.patchValue(this.util.fillForm(e,this.form.value)),this.loadEtiquetas()})}initializeData(t){return _(this,null,function*(){if(this.isClonar){let i=yield this.dao.getAtividade(this.urlParams.get("id"));this.entity=new P,Object.assign(this.entity,{tipo_atividade:i.tipo_atividade,unidade:i.unidade,usuario:i.usuario,plano_trabalho:i.plano_trabalho,descricao:i.descricao,data_distribuicao:i.data_distribuicao,tempo_planejado:i.tempo_planejado,carga_horaria:i.carga_horaria,data_estipulada_entrega:i.data_estipulada_entrega,esforco:i.esforco,tipo_atividade_id:i.tipo_atividade_id,demandante_id:this.auth.usuario?.id,usuario_id:i.usuario_id,unidade_id:i.unidade_id,plano_trabalho_id:i.plano_trabalho_id,etiquetas:i.etiquetas,checklist:i.checklist,metadados:i.metadados,plano_trabalho_entrega_id:i.plano_trabalho_entrega_id,progresso:i.progresso,tarefas:(i.tarefas||[]).map(e=>new oe(Object.assign({},e,{id:this.dao.generateUuid(),comentarios:[],_status:"ADD"}))),documento_requisicao:i.documento_requisicao?Object.assign({},new me(Object.assign({},i.documento_requisicao,{id:this.dao.generateUuid(),_status:"ADD"}))):void 0,documento_entrega:i.documento_entrega?Object.assign({},new me(Object.assign({},i.documento_entrega,{id:this.dao.generateUuid(),_status:"ADD"}))):void 0})}else if(this.sei=this.metadata?.sei,this.entity=new P,this.entity.data_distribuicao=this.auth.hora,this.entity.data_estipulada_entrega=this.entity.data_distribuicao,this.entity.demandante_id=this.auth.usuario?.id||"",this.entity.unidade_id=this.auth.unidade?.id||"",this.entity.unidade=this.auth.unidade,this.entity.metadados={atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!1,concluido:!1,avaliado:!1,arquivado:!1,produtividade:0,consolidacoes:[]},!this.unidadeService.isGestorUnidade(this.entity.unidade_id)){let i=yield this.usuarioDao.getById(this.auth.usuario.id,this.usuarioJoin);this.entity.usuario_id=i?.id||null,this.entity.usuario=i||void 0}yield this.loadData(this.entity,t)})}saveData(t){return new Promise((i,e)=>{let a=this.util.fill(new P,this.entity);if(this.comentarios?.confirm(),a=this.util.fillForm(a,this.form.value),this.hasUsuarioActionNew&&this.form.controls.iniciado.value&&(a.data_inicio=a.data_distribuicao,a.status="INICIADO",this.form.controls.concluido.value)){let c=this.calendar.calculaDataTempoUnidade(a.data_inicio,a.data_estipulada_entrega,this.planoTrabalhoSelecionado.carga_horaria,this.unidade?.selectedEntity,"ENTREGA");a.data_entrega=a.data_estipulada_entrega,a.progresso=100,a.tempo_despendido=c?.tempoUtil||0,a.status="CONCLUIDO"}a.documento_requisicao=this.requisicao?.documento,a.comentarios=a.comentarios.filter(c=>["ADD","EDIT","DELETE"].includes(c._status||"")&&c.texto?.length),a.tarefas=a.tarefas.filter(c=>(c.comentarios=c.comentarios.filter(p=>["ADD","EDIT","DELETE"].includes(p._status||"")&&p.texto?.length),["ADD","EDIT","DELETE"].includes(c._status||""))),i(a)})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-form"]],viewQuery:function(i,e){if(i&1&&(g(T,5),g(mi,5),g(pi,5),g(fi,5),g(hi,5),g(_i,5),g(gi,5),g(vi,5)),i&2){let a;v(a=b())&&(e.editableForm=a.first),v(a=b())&&(e.etiqueta=a.first),v(a=b())&&(e.tipoAtividade=a.first),v(a=b())&&(e.planoTrabalho=a.first),v(a=b())&&(e.unidade=a.first),v(a=b())&&(e.usuario=a.first),v(a=b())&&(e.comentarios=a.first),v(a=b())&&(e.requisicao=a.first)}},features:[k],decls:26,vars:38,consts:[["requisicao",""],["unidade",""],["tipoAtividade",""],["usuario",""],["planoTrabalho",""],["entrega",""],["comEsforco",""],["comTempoDespendido",""],["initialFocus","descricao",3,"submit","cancel","form","disabled"],["display","","right","",3,"title"],["key","ATIVIDADE",3,"label"],[3,"sei","documento"],[1,"row"],["label","Descri\xE7\xE3o","controlName","descricao","required","",3,"size","rows","control"],["controlName","unidade_id","required","",3,"change","label","size","dao"],["controlName","tipo_atividade_id",3,"select","change","label","emptyValue","size","dao","labelInfo","required"],["label","Iniciado","controlName","iniciado",3,"size","disabled",4,"ngIf"],["label","Conclu\xEDdo","controlName","concluido",3,"size","change",4,"ngIf"],["controlName","usuario_id","labelInfo","Participante respons\xE1vel pela execu\xE7\xE3o",3,"select","change","label","size","emptyValue","dao","join"],["controlName","plano_trabalho_id",3,"change","label","size","control","items","labelInfo"],["controlName","plano_trabalho_entrega_id",3,"label","size","control","items","labelInfo"],["class","row",4,"ngIf","ngIfElse"],["title","Conclus\xE3o",4,"ngIf"],["label","Iniciado","controlName","iniciado",3,"size","disabled"],["label","Conclu\xEDdo","controlName","concluido",3,"change","size"],["noIcon","","controlName","data_distribuicao","labelInfo","Data de inclus\xE3o/distribui\xE7\xE3o/lan\xE7amento",3,"change","size","label","control"],["label","Progresso","disabled","","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xE7\xE3o (% Conclu\xEDdo)",3,"size","decimals"],["noIcon","","controlName","data_estipulada_entrega","labelInfo","Data estipulada para entrega da atividade",3,"change","size","label","control"],["icon","bi bi-stopwatch","onlyHours","","controlName","esforco","labelInfo","Tempo estimado de execu\xE7\xE3o",3,"size","label","control"],["title","Conclus\xE3o"],[3,"documento"],["noIcon","","label","Inicio","controlName","data_inicio","disabled","","labelInfo","Data em que o usu\xE1rio iniciou a atividade",3,"size","control"],["noIcon","","label","Conclus\xE3o","controlName","data_entrega","disabled","","labelInfo","Data da conclus\xE3o da atividade",3,"size","control"],["label","Data de arquivamento","controlName","data_arquivamento","disabled","","labelInfo","Data de arquivamento da atividade",3,"size","control"],["label","Tempo despendido","icon","bi bi-hourglass-bottom","controlName","tempo_despendido","disabled","","labelInfo","Calculado no fim da atividade, sendo o tempo l\xEDquido (considerando pausas)",3,"size","control"]],template:function(i,e){if(i&1){let a=V();u(0,"editable-form",8),E("submit",function(){return C(a),y(e.onSaveData())})("cancel",function(){return C(a),y(e.onCancel())}),u(1,"tabs",9)(2,"tab",10),m(3,"documento-link",11,0),u(5,"div",12),m(6,"input-textarea",13),d(),u(7,"div",12)(8,"input-search",14,1),E("change",function(p){return C(a),y(e.onUnidadeChange(p))}),d(),u(10,"input-search",15,2),E("select",function(p){return C(a),y(e.onTipoAtividadeSelect(p))})("change",function(p){return C(a),y(e.onTipoAtividadeChange(p))}),d(),h(12,bi,1,2,"input-switch",16)(13,Ci,1,1,"input-switch",17),d(),u(14,"div",12)(15,"input-search",18,3),E("select",function(p){return C(a),y(e.onUsuarioSelect(p))})("change",function(p){return C(a),y(e.onUsuarioChange(p))}),d(),u(17,"input-select",19,4),E("change",function(p){return C(a),y(e.onPlanoTrabalhoChange(p))}),d()(),u(19,"div",12),m(20,"input-select",20,5),d(),h(22,yi,4,8,"div",21)(23,Ei,5,11,"ng-template",null,6,q)(25,Ti,5,3,"separator",22),d()()()}if(i&2){let a=D(18),c=D(24);r("form",e.form)("disabled",e.formDisabled),l(),r("title",e.titleAtividade),l(),r("label",e.lex.translate("Atividade")),l(),r("sei",e.sei)("documento",e.form.controls.documento_requisicao.value),l(3),r("size",12)("rows",2)("control",e.form.controls.descricao),l(2),r("label",e.lex.translate("Unidade"))("size",e.hasUsuarioActionNew?5:6)("dao",e.unidadeDao),l(2),r("label","Tipo de "+e.lex.translate("atividade"))("emptyValue",null)("size",e.hasUsuarioActionNew?5:6)("dao",e.tipoAtividadeDao)("labelInfo",e.lex.translate("Tipo de atividade")+" utilizado para classificar a atividade")("required",e.auth.hasPermissionTo("MOD_ATV_TIPO_ATV_VAZIO")?void 0:"true"),l(2),r("ngIf",e.hasUsuarioActionNew),l(),r("ngIf",e.hasUsuarioActionNew),l(2),r("label",e.lex.translate("Respons\xE1vel"))("size",6)("emptyValue",null)("dao",e.usuarioDao)("join",e.usuarioJoin),l(2),r("label",e.lex.translate("Plano de trabalho"))("size",6)("control",e.form.controls.plano_trabalho_id)("items",e.planosTrabalhos)("labelInfo",e.lex.translate("Plano de trabalho")),l(3),r("label",e.lex.translate("Entrega")+" (Descri\xE7\xE3o dos trabalhos)")("size",12)("control",e.form.controls.plano_trabalho_entrega_id)("items",e.entregas)("labelInfo",e.lex.translate("Entrega")+e.lex.translate(" plano de trabalho")+" que a "+e.lex.translate("atividade")+" \xE9 referente"),l(2),r("ngIf",!(!(a==null||a.selectedItem==null||a.selectedItem.data==null||a.selectedItem.data.tipo_modalidade==null)&&a.selectedItem.data.tipo_modalidade.atividade_esforco))("ngIfElse",c),l(3),r("ngIf",e.form.controls.data_entrega.value)}},dependencies:[z,T,R,B,Y,U,H,qe,ie,te,G,ee,ae]});let n=s;return n})();function Ai(n,s){if(n&1&&m(0,"atividade-list-grid",7),n&2){let o=f();r("snapshot",o.snapshot||o.modalRoute||o.route.snapshot)("minhas",!o.eGestor)}}function wi(n,s){if(n&1&&m(0,"atividade-list-kanban",7),n&2){let o=f();r("snapshot",o.snapshot||o.modalRoute||o.route.snapshot)("minhas",!o.eGestor)}}function Si(n,s){if(n&1&&m(0,"atividade-dashboard",9),n&2){let o=f(2);r("snapshot",o.snapshot||o.modalRoute||o.route.snapshot)}}function ki(n,s){if(n&1&&(u(0,"tab",8),h(1,Si,1,1,"ng-template",null,2,q),d()),n&2){let o=D(2);r("template",o)}}var Ne=(()=>{let s=class s extends X{constructor(t){super(t),this.injector=t,this.activeTab="TABELA",this.eGestor=this.auth.unidadeGestor(),this.title=this.lex.translate("Atividades"),this.code="MOD_DMD"}ngOnInit(){super.ngOnInit(),this.activeTab=this.usuarioConfig.active_tab||"TABELA"}onSelectTab(t){return _(this,null,function*(){this.activeTab=t.key,this.viewInit&&this.saveUsuarioConfig({active_tab:this.activeTab})})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["app-atividade-list"]],features:[k],decls:8,vars:6,consts:[["grid",""],["kanban",""],["dashboard",""],["right","",3,"title","select","active"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["key","KANBAN","icon","bi bi-card-heading","label","Quadro",3,"template"],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template",4,"ngIf"],[3,"snapshot","minhas"],["key","DASHBOARD","icon","bi bi-file-earmark-bar-graph","label","Dashboard",3,"template"],[3,"snapshot"]],template:function(i,e){if(i&1&&(u(0,"tabs",3)(1,"tab",4),h(2,Ai,1,2,"ng-template",null,0,q),d(),u(4,"tab",5),h(5,wi,1,2,"ng-template",null,1,q),d(),h(7,ki,3,1,"tab",6),d()),i&2){let a=D(3),c=D(6);r("title",e.isModal?"":e.title)("select",e.onSelectTab.bind(e))("active",e.activeTab),l(),r("template",a),l(3),r("template",c),l(3),r("ngIf",!1)}}});let n=s;return n})();var St=()=>[];function Vi(n,s){if(n&1&&m(0,"planejamento-show",10),n&2){let o=f(2);r("planejamento",o.atividade.planejamento)}}function Fi(n,s){if(n&1&&(u(0,"div",11)(1,"h6"),I(2,"Cadeia de valor:"),d(),u(3,"h4"),I(4),d()()),n&2){let o=f(2);l(4),L(o.atividade.cadeiaValor.nome)}}function Oi(n,s){n&1&&(W(0),m(1,"i",15),J())}function Pi(n,s){if(n&1&&(u(0,"div")(1,"div",14),h(2,Oi,2,0,"ng-container",13),u(3,"h5"),I(4),d()()()),n&2){let o=s.$implicit,t=s.index;l(2),r("ngForOf",le(2,St).constructor(t)),l(2),L(o.nome)}}function zi(n,s){if(n&1&&(u(0,"div",12)(1,"h6"),I(2,"Objetivos:"),d(),h(3,Pi,5,3,"div",13),d()),n&2){let o=f(2);l(3),r("ngForOf",o.atividade.objetivos)}}function Ni(n,s){if(n&1&&(u(0,"div")(1,"h5"),I(2),d()()),n&2){let o=s.$implicit;l(2),L(o.nome)}}function Ri(n,s){if(n&1&&(u(0,"div",16)(1,"h6"),I(2,"Processos:"),d(),h(3,Ni,3,1,"div",13),d()),n&2){let o=f(2);l(3),r("ngForOf",o.atividade.processos)}}function Li(n,s){n&1&&(W(0),m(1,"i",15),J())}function Qi(n,s){if(n&1&&(u(0,"div")(1,"div",14),h(2,Li,2,0,"ng-container",13),u(3,"div",18)(4,"h5",8),I(5),d(),u(6,"div",19)(7,"span",20)(8,"b",21),I(9,"Meta:"),d(),m(10,"badge",22),d(),u(11,"span",23)(12,"b",21),I(13,"Realizado:"),d(),m(14,"badge",24),d(),u(15,"span",25)(16,"b",26),I(17,"Progresso:"),d(),m(18,"progress-bar",27),d()()()(),m(19,"hr"),d()),n&2){let o=s.$implicit,t=s.index,i=f(3);l(2),r("ngForOf",le(6,St).constructor(t)),l(3),K(" ",o.descricao," "),l(5),r("label",i.planoEntregaService.getValorMeta(o)),l(4),r("label",i.planoEntregaService.getValorRealizado(o)),l(4),r("value",o.progresso_realizado)("goal",o.progresso_esperado)}}function Ui(n,s){if(n&1&&(u(0,"div",17)(1,"h6"),I(2,"Entrega do plano de entregas:"),d(),h(3,Qi,20,7,"div",13),d()),n&2){let o=f(2);l(3),r("ngForOf",o.atividade.entregasPlanoEntrega)}}function Mi(n,s){if(n&1&&(W(0),u(1,"div",1),h(2,Vi,1,1,"planejamento-show",2)(3,Fi,5,1,"div",3),d(),u(4,"div",1),h(5,zi,4,1,"div",4)(6,Ri,4,1,"div",5),d(),h(7,Ui,4,1,"div",6),u(8,"div",7)(9,"h6"),I(10,"Aloca\xE7\xE3o:"),d(),u(11,"h5",8),I(12),d(),u(13,"p"),I(14,"For\xE7a de trabalho: "),u(15,"b"),I(16),d()()(),u(17,"div",9)(18,"h6"),I(19,"Atividade:"),d(),u(20,"h5",8),I(21),d(),u(22,"p"),I(23,"Data estipulada para entrega: "),u(24,"b"),I(25),d()()(),J()),n&2){let o=f();l(2),r("ngIf",o.atividade.planejamento),l(),r("ngIf",o.atividade.cadeiaValor),l(2),r("ngIf",o.atividade.objetivos),l(),r("ngIf",o.atividade.processos==null?null:o.atividade.processos.length),l(),r("ngIf",o.atividade.entregasPlanoEntrega),l(5),L(o.atividade.entregaPlanoTrabalho.descricao),l(4),K("",o.atividade.entregaPlanoTrabalho.forca_trabalho,"%"),l(5),L(o.atividade.atividade.descricao),l(4),L(o.util.getDateTimeFormatted(o.atividade.atividade.data_estipulada_entrega))}}var kt=(()=>{let s=class s extends X{constructor(t){super(t),this.injector=t,this.atividadeDao=t.get(Q),this.planoEntregaService=t.get(ht)}ngOnInit(){super.ngOnInit(),this.urlParams.get("id")&&this.loadAtividade(this.urlParams.get("id"))}loadAtividade(t){return _(this,null,function*(){let i=yield this.atividadeDao.getHierarquia(t);i&&(this.atividade=i)})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["atividade-hierarquia"]],features:[k],decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex","align-items-stretch"],[3,"planejamento",4,"ngIf"],["class","cadeiaValor arrow_box first-box w-100 ms-3",4,"ngIf"],["class","objetivos arrow_box w-100",4,"ngIf"],["class","procesos arrow_box w-100 ms-3",4,"ngIf"],["class","plano_entrega_entrega arrow_box",4,"ngIf"],[1,"plano_trabalho_entrega","arrow_box"],[1,"mb-2"],[1,"atividade","arrow_box"],[3,"planejamento"],[1,"cadeiaValor","arrow_box","first-box","w-100","ms-3"],[1,"objetivos","arrow_box","w-100"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"bi","bi-chevron-right"],[1,"procesos","arrow_box","w-100","ms-3"],[1,"plano_entrega_entrega","arrow_box"],[1,"ms-3","flex-grow-1","d-flex","flex-column"],[1,"d-flex","justify-content-start","align-items-center","m-0"],[1,"text-center"],[1,"d-block"],["icon","bi bi-graph-up-arrow","color","light",3,"label"],[1,"text-center","ms-3"],["icon","bi bi-check-lg","color","light",3,"label"],[1,"ms-3","flex-fill"],[1,""],["color","success",3,"value","goal"]],template:function(i,e){i&1&&h(0,Mi,26,9,"ng-container",0),i&2&&r("ngIf",e.atividade)},dependencies:[de,z,ce,Ve,_t],styles:["h6[_ngcontent-%COMP%]{border-bottom:1px solid rgba(194,225,245,.14);padding-bottom:5px;color:var(--bs-body-color)}h5[_ngcontent-%COMP%]{color:var(--bs-body-color);font-weight:300;margin:0}"]});let n=s;return n})();var ji=[{path:"",component:Ne,canActivate:[F],resolve:{config:O},data:{title:"Atividades"}},{path:"grid",component:fe,canActivate:[F],resolve:{config:O},data:{title:"Atividades"}},{path:"new",component:re,canActivate:[F],resolve:{config:O},data:{title:"",modal:!0}},{path:"tarefa",component:Ge,canActivate:[F],resolve:{config:O},data:{title:"Tarefa da Atividade",modal:!0}},{path:"tarefa/concluir",component:ne,canActivate:[F],resolve:{config:O},data:{title:"Concluir Tarefa",modal:!0}},{path:"tarefa/:tarefa_id/comentar",component:Ge,canActivate:[F],resolve:{config:O},data:{title:"Coment\xE1rios",modal:!0}},{path:":id/edit",component:re,canActivate:[F],resolve:{config:O},data:{title:"Edi\xE7\xE3o da Atividade",modal:!0}},{path:":id/consult",component:re,canActivate:[F],resolve:{config:O},data:{title:"Consulta a Atividade",modal:!0}},{path:":id/clonar",component:re,canActivate:[F],resolve:{config:O},data:{title:"Clone de Atividade",modal:!0}},{path:":id/iniciar",component:Tt,canActivate:[F],resolve:{config:O},data:{title:"In\xEDcio de Atividade",modal:!0}},{path:":id/concluir",component:yt,canActivate:[F],resolve:{config:O},data:{title:"Conclus\xE3o de Atividade",modal:!0}},{path:":id/pausar",component:At,canActivate:[F],resolve:{config:O},data:{title:"Suspens\xE3o de Atividade",modal:!0}},{path:":id/prorrogar",component:wt,canActivate:[F],resolve:{config:O},data:{title:"Prorroga\xE7\xE3o de Atividade",modal:!0}},{path:":id/comentar",component:re,canActivate:[F],resolve:{config:O},data:{title:"Coment\xE1rios de Atividade",modal:!0}},{path:":id/hierarquia",component:kt,canActivate:[F],resolve:{config:O},data:{title:"Hierarquia da Atividade",modal:!0}}],qt=(()=>{let s=class s{};s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=Ce({type:s}),s.\u0275inj=be({imports:[Le.forChild(ji),Le]});let n=s;return n})();var Bi=["filterRef"],Ki=["kanbanEtiquetas"],Hi=["dockerNaoIniciado"],Gi=["dockerPausado"],$i=["dockerIniciado"],Wi=["dockerConcluido"],Ji=["planoEntrega"],Zi=["planoEntregaEntrega"];function Xi(n,s){if(n&1){let o=V();u(0,"badge",40),E("click",function(){C(o);let i=f().card,e=f();return y(e.onEntregaClick(i.data))}),d()}if(n&2){let o=f().card,t=f();r("icon",t.entityService.getIcon("Entrega"))("label",o.data.plano_trabalho_entrega.descricao)}}function Yi(n,s){if(n&1&&(u(0,"div"),m(1,"profile-picture",41),d()),n&2){let o=f().card;l(),r("url",o.data.usuario.url_foto)("hint","Respons\xE1vel: "+((o.data.usuario==null?null:o.data.usuario.nome)||"N\xE3o atribuido a nenhum usu\xE1rio"))}}function ea(n,s){if(n&1&&m(0,"badge",49),n&2){let o=s.$implicit,t=f(3);r("color",o.color)("label",o.label)("icon",o.icon)("data",o)("click",o.data.filter?t.onStatusClick.bind(t):void 0)}}function ta(n,s){if(n&1&&m(0,"badge",49),n&2){let o=s.$implicit,t=f(3);r("color",o.color)("label",o.value)("icon",o.icon)("data",o)("click",t.onEtiquetaClick.bind(t))}}function ia(n,s){n&1&&m(0,"separator",50)}function aa(n,s){n&1&&m(0,"i",54)}function oa(n,s){if(n&1&&(u(0,"tr")(1,"td"),h(2,aa,1,0,"i",52),d(),u(3,"td",53),I(4),d()()),n&2){let o=s.$implicit;l(2),r("ngIf",o.checked),l(2),L(o.texto)}}function na(n,s){if(n&1&&(u(0,"table"),h(1,oa,5,2,"tr",51),d()),n&2){let o=f(2).card;l(),r("ngForOf",o.data.checklist)}}function ra(n,s){if(n&1&&(u(0,"small"),I(1),d()),n&2){let o=s.$implicit;l(),L(o.descricao)}}function sa(n,s){if(n&1&&(u(0,"separator",55),h(1,ra,2,1,"small",51),d()),n&2){let o=f(2).card;r("title","Tarefas ("+(o.data.tarefas==null?null:o.data.tarefas.length)+")")("collapsed",!0),l(),r("ngForOf",o.data.tarefas)}}function la(n,s){if(n&1&&(W(0),u(1,"div",42),m(2,"documentos-badge",43),h(3,ea,1,5,"badge",44)(4,ta,1,5,"badge",44),d(),h(5,ia,1,0,"separator",45)(6,na,2,1,"table",39),m(7,"reaction",46),h(8,sa,2,3,"separator",47),m(9,"comentarios-widget",48),J()),n&2){let o=f().card,t=f();l(2),r("documento",o.data.documento_requisicao),l(),r("ngForOf",t.atividadeService.getStatus(o.data)),l(),r("ngForOf",o.data.etiquetas),l(),r("ngIf",o.data.checklist==null?null:o.data.checklist.length),l(),r("ngIf",o.data.checklist==null?null:o.data.checklist.length),l(),r("entity",o.data),l(),r("ngIf",o.data.tarefas==null?null:o.data.tarefas.length),l(),r("entity",o.data)("selectable",!1)("query",t.query)}}function da(n,s){if(n&1&&(h(0,Xi,1,2,"badge",30),u(1,"div",31)(2,"div",32)(3,"div",33)(4,"span",34),I(5),d(),u(6,"span",34),m(7,"i",35),I(8),d(),u(9,"span",36),m(10,"i"),I(11),d()(),u(12,"span",37),m(13,"i",38),I(14),d()(),h(15,Yi,2,2,"div",39),d(),h(16,la,10,10,"ng-container",39)),n&2){let o=s.card,t=f();r("ngIf",o.data.plano_trabalho_entrega),l(5),K(" #",o.data.numero," "),l(3),K(" ",o.data.unidade.sigla," "),l(),Re("title","Respons\xE1vel: ",(o.data.usuario==null?null:o.data.usuario.nome)||"N\xE3o atribuido a nenhum usu\xE1rio",""),l(),Je("bi "+(!(o.data.usuario==null||o.data.usuario.nome==null)&&o.data.usuario.nome.length?"bi-person-check":"bi-person-x")),l(),K(" ",t.util.apelidoOuNome(o.data.usuario,!0)||"(N\xE3o atribu\xEDdo)"," "),l(),Re("title","Demandante: ",(o.data.demandante==null?null:o.data.demandante.nome)||"Desconhecido",""),l(2),K(" ",t.util.apelidoOuNome(o.data.demandante,!0)||"Desconhecido"," "),l(),r("ngIf",o.data.usuario),l(),r("ngIf",!(!(t.filter==null||t.filter.controls==null||t.filter.controls.resumido==null)&&t.filter.controls.resumido.value))}}function ca(n,s){if(n&1&&m(0,"input-select",56),n&2){let o=f();r("size",12)("control",o.formEdit.controls.etiqueta)("items",o.etiquetasEdit)}}function ua(n,s){n&1&&(u(0,"div",57)(1,"div",31)(2,"div",32)(3,"h5",58),m(4,"span",59),d()(),u(5,"div",60)(6,"button",61),m(7,"i",62),d()()(),u(8,"h6",63),m(9,"span",64),d(),u(10,"p",65),m(11,"span",66)(12,"span",67)(13,"span",67)(14,"span",59)(15,"span",64),d()())}function ma(n,s){if(n&1&&(u(0,"kanban",68)(1,"swimlane"),m(2,"docker",69,8),d(),u(4,"swimlane"),m(5,"docker",70,9)(7,"docker",71,10),d(),u(9,"swimlane"),m(10,"docker",72,11),d()()),n&2){let o=f(),t=D(22),i=D(26);r("template",t)("placeholderTemplate",i)("loading",o.loading)("dragSwimlanes",!1),l(2),r("collapse",o.cardsConfig.naoIniciado)("toggle",o.onDockerCollapse.bind(o))("menu",o.menuDockerNaoIniciado)("dragged",o.onDragged.bind(o))("drop",o.onDrop.bind(o))("dropIf",o.canDrop(o.DOCKERS[o.NAOINICIADO]))("cards",o.cards[o.NAOINICIADO]),l(3),r("collapse",o.cardsConfig.iniciado)("toggle",o.onDockerCollapse.bind(o))("dragged",o.onDragged.bind(o))("drop",o.onDrop.bind(o))("dropIf",o.canDrop(o.DOCKERS[o.INICIADO]))("cards",o.cards[o.INICIADO]),l(2),r("collapse",o.cardsConfig.pausado)("toggle",o.onDockerCollapse.bind(o))("dragged",o.onDragged.bind(o))("drop",o.onDrop.bind(o))("dropIf",o.canDrop(o.DOCKERS[o.PAUSADO]))("cards",o.cards[o.PAUSADO]),l(3),r("collapse",o.cardsConfig.concluido)("toggle",o.onDockerCollapse.bind(o))("dragged",o.onDragged.bind(o))("drop",o.onDrop.bind(o))("dropIf",o.canDrop(o.DOCKERS[o.CONCLUIDO]))("cards",o.cards[o.CONCLUIDO])}}function pa(n,s){if(n&1&&m(0,"kanban",73,12),n&2){let o=f(),t=D(22),i=D(24),e=D(26);r("dockers",o.labels)("template",t)("placeholderTemplate",e)("loading",o.loading)("swimlaneDrop",o.onSwimlaneDrop.bind(o))("dockerDragged",o.onDragged.bind(o))("dockerDrop",o.onDrop.bind(o))("dockerEditTemplate",i)("dockerToggle",o.onDockerCollapse.bind(o))("dockerEdit",o.editEtiquetas.bind(o))("dockerSave",o.saveEtiquetas.bind(o))("dockerDelete",o.deleteEtiquetas.bind(o))("dockerCancel",o.cancelEtiquetas.bind(o))("dockerColorStyle",o.getLabelStyle)}}var $e=(()=>{let s=class s extends Pe{constructor(t){super(t),this.injector=t,this.minhas=!1,this.TITLE_OUTRAS="Outras",this.NAOINICIADO=0,this.PAUSADO=1,this.INICIADO=2,this.CONCLUIDO=3,this.AVALIADO=4,this.DOCKERS=["NAOINICIADO","PAUSADO","INICIADO","CONCLUIDO"],this.cards=[[],[],[],[]],this.cardsConfig={naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},this.labels=[],this.cardsVersion=0,this.dragDrop={},this.rowsLimit=500,this.kanbanQueryOptions={},this.etiquetasEdit=[],this.planosEntregas=[],this.planosEntregasEntregas=[],this.toolbarButtons=[{icon:"bi bi-search",label:"Filtros",onClick:()=>this.filterRef?.toggle()},{icon:"bi bi-plus-circle",color:"btn-outline-success",label:"Incluir",onClick:()=>_(this,null,function*(){return yield this.add()})}],this.outrasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.etiquetasButtons=[{icon:"bi bi-plus-circle",color:"btn-outline-success",hint:"Incluir nova lista a direita",onClick:this.incluirLista.bind(this)}],this.menuDockerNaoIniciado=[{icon:"bi bi-plus-circle",color:"btn-outline-primary",hint:"Incluir",onClick:()=>_(this,null,function*(){return yield this.add()})}],this.filterWhere=i=>{let e=this.fixedFilter||[],a=i.value;return a.somente_unidade_atual&&a.unidade_id!=this.auth.unidade?.id&&(i.controls.unidade_id.setValue(this.auth.unidade?.id),a.unidade_id=this.auth.unidade?.id),a.atribuidas_para_mim&&a.usuario_id!=this.auth.usuario?.id&&(i.controls.usuario_id.setValue(this.auth.usuario?.id),a.usuario_id=this.auth.usuario.id),a.usuario_id?.length&&e.push(["usuario_id","==",a.usuario_id]),a.unidade_id?.length&&e.push(["unidade_id","==",a.unidade_id]),a.unidades_subordinadas&&e.push(["unidades_subordinadas","==",!0]),a.etiquetas?.length&&e.push(["etiquetas","in",a.etiquetas.map(c=>c.value)]),a.numero_processo?.length&&e.push(["numero_processo","==",a.numero_processo]),a.status?.length&&!e.find(c=>c[0]=="status")&&e.push(["status","==",a.status]),a.plano_entrega_id?.length&&e.push(["plano_entrega_id","==",a.plano_entrega_id]),a.plano_entrega_entrega_id?.length&&e.push(["plano_entrega_entrega_id","==",a.plano_entrega_entrega_id]),e.push(["data_arquivamento","==",null]),e},this.code="MOD_DMD",this.filter=this.fh.FormBuilder({atribuidas_para_mim:{default:this.minhas},usuario_id:{default:""},somente_unidade_atual:{default:!1},unidades_subordinadas:{default:!1},unidade_id:{default:""},numero_processo:{default:""},status:{default:""},usarEtiquetas:{default:!!this.usuarioConfig?.kanban_usar_etiquetas},resumido:{default:!!this.usuarioConfig?.kanban_resumido},etiquetas:{default:[]},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}}),this.formEdit=this.fh.FormBuilder({etiqueta:{default:null}}),this.cardsConfig=Object.assign(this.cardsConfig,this.usuarioConfig?.kanban_status_dockers),this.groupBy=[],this.loadEtiquetas(),this.loadLabel()}defaultUsuarioConfig(){return Object.assign(super.defaultUsuarioConfig(),{active_tab:"TABELA",kanban_resumido:!1,kanban_usar_etiquetas:!1,kanban_status_dockers:{naoIniciado:!1,pausado:!1,iniciado:!1,concluido:!1},kanban_etiquetas_dockers:[]})}ngAfterViewInit(){super.ngAfterViewInit(),this.minhas?(this.filter?.controls.atribuidas_para_mim.setValue(!0),this.filter?.controls.usuario_id.setValue(this.auth.usuario?.id)):this.filter?.controls.unidade_id.setValue(this.auth.unidade?.id),this.query.onLoadingChange=t=>{this.loading=t,this.cdRef.detectChanges()},this.loading=this.query.loading,this.query.subject.asObservable().subscribe(this.onQueryLoad.bind(this)),this.cdRef.detectChanges()}isOutras(t){return t.title==this.TITLE_OUTRAS&&!t.labels.length}loadLabel(){let t=[...this.usuarioConfig?.kanban_etiquetas_dockers||[]];t.find(this.isOutras.bind(this))||t.splice(0,0,{title:this.TITLE_OUTRAS,labels:[],collapse:!1}),this.labels=t.reduce((i,e)=>(i.find(a=>a.title?.length&&a.title==e.title||a.labels?.length&&e.labels?.length&&a.labels[0].key==e.labels[0].key)||i.push({labels:this.isOutras(e)?[]:e.labels,title:e.title,menu:this.isOutras(e)?this.outrasButtons:this.etiquetasButtons,cards:[],editing:!1,collapse:e.collapse}),i),[])}get isEtiquetas(){return!!this.filter?.controls?.usarEtiquetas?.value}onUsarEtiquetasChange(t){this.saveUsuarioConfig({kanban_usar_etiquetas:this.filter.controls.usarEtiquetas.value}),this.query&&this.onQueryLoad(this.query.rows)}incluirLista(t){this.labels.splice(t.key+1,0,{labels:[],menu:this.etiquetasButtons,cards:[],editing:!0,collapse:!1}),this.kanbanEtiquetas?.refreshDoubleScrollbar(),this.cdRef.detectChanges()}onResumidoChange(t){this.saveUsuarioConfig({kanban_resumido:this.filter.controls.resumido.value}),this.cdRef.detectChanges()}loadEtiquetas(){this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(t,i)=>t.key==i.key)}getLabelStyle(t){return`border-color: ${t.labels.length==1&&t.labels[0].color||"#000000"} !important;`}onDockerCollapse(t,i){this.isEtiquetas?(this.labels[t.key].collapse=i,this.saveEtiquetasUsuarioConfig()):(this.cardsConfig={naoIniciado:!!this.dockerNaoIniciado?.collapse,pausado:!!this.dockerPausado?.collapse,iniciado:!!this.dockerIniciado?.collapse,concluido:!!this.dockerConcluido?.collapse},this.saveUsuarioConfig({kanban_status_dockers:this.cardsConfig})),this.kanbanEtiquetas?.refreshDoubleScrollbar()}editEtiquetas(t){return _(this,null,function*(){let i=this.labels[t.key],e=this.labels.reduce((a,c,p)=>(c.labels.length&&p!=t.key&&a.push(c.labels[0].key),a),[]);this.etiquetasEdit=this.etiquetas.filter(a=>!e.includes(a.key)),this.formEdit.controls.etiqueta.setValue(i.labels.length?i.labels[0].key:null)})}saveEtiquetasUsuarioConfig(){let t=this.labels.reduce((i,e)=>(i.find(a=>a.title?.length&&a.title==e.title||a.labels?.length&&e.labels?.length&&a.labels[0].key==e.labels[0].key)||i.push({title:e.title,labels:e.labels,collapse:e.collapse}),i),[]);this.saveUsuarioConfig({kanban_etiquetas_dockers:t})}saveEtiquetas(t){return _(this,null,function*(){let i=this.formEdit.controls.etiqueta.value;if(i?.length){let e=this.labels[t.key],a=this.etiquetasEdit.find(c=>c.key==i);return a&&(e.labels=[a]),this.query&&this.onQueryLoad(this.query.rows),this.saveEtiquetasUsuarioConfig(),!0}return!1})}cancelEtiquetas(t){return _(this,null,function*(){this.labels[t.key].labels?.length||(this.labels.splice(t.key,1),this.kanbanEtiquetas?.refreshDoubleScrollbar())})}deleteEtiquetas(t){return _(this,null,function*(){this.labels.splice(t.key,1),this.kanbanEtiquetas?.refreshDoubleScrollbar(),this.query&&this.onQueryLoad(this.query.rows),this.saveEtiquetasUsuarioConfig()})}getNomes(t){return Object.getOwnPropertyNames(t.filter.controls||{}).join(",")}modalRefreshId(t){return{modal:!0,modalClose:i=>{let e=this.dragDrop.destination,a=this.dragDrop.source;i&&(e&&a&&(e.list.splice(e.index,0,e.card),a.list.splice(a.index,1)),(this.grid?.query||this.query).refreshId(t.id)),this.dragDrop={}}}}mergeEtiqueta(t){this.etiquetas.find(i=>i.key==t.key)||this.etiquetas.push(t)}filterSubmit(t){return super.filterSubmit(t),this.cards=[[],[],[],[]],this.labels.forEach(i=>i.cards=[]),this.queryOptions}onQueryLoad(t){if(super.onGridLoad(t),this.cardsVersion++,this.filter?.controls?.usarEtiquetas?.value){let i=this.labels.findIndex(this.isOutras.bind(this));t?.forEach(e=>{let a=e,c;a.etiquetas=a.etiquetas||[];for(let p=0;p<a.etiquetas.length;p++){for(let x=1;x<this.labels.length&&!c;x++)this.labels[x].labels[0].key==a.etiquetas[p].key&&(c=this.labels[x]);this.etiquetas.some(x=>x.key==a.etiquetas[p].key)||this.etiquetas.push(a.etiquetas[p])}this.putCard(c?.cards||this.labels[i]?.cards||[],a)});for(let e of this.labels.map(a=>a.cards||[]))for(let a=0;a<e.length;e[a].version!=this.cardsVersion?e.splice(a,1):a++);}else{t?.forEach(i=>{let e=i;switch(this.lookup.ATIVIDADE_STATUS.find(c=>c.key==e.status)?.key||"INCLUIDO"){case"PAUSADO":this.putCard(this.cards[this.PAUSADO],e);break;case"INICIADO":this.putCard(this.cards[this.INICIADO],e);break;case"CONCLUIDO":this.putCard(this.cards[this.CONCLUIDO],e);break;default:this.putCard(this.cards[this.NAOINICIADO],e)}});for(let i of this.cards)for(let e=0;e<i.length;i[e].version!=this.cardsVersion?i.splice(e,1):e++);}this.cdRef.detectChanges()}putCard(t,i){let e=t.findIndex(c=>c.id==i.id),a={id:i.id,title:i.tipo_atividade?.nome||"("+this.lex.translate("Atividade")+" sem tipo de registro de execu\xE7\xE3o atribu\xEDdo)",subTitle:i.descricao||"",data:i,version:this.cardsVersion,menu:void 0,dynamicMenu:this.dynamicCardMenu.bind(this)};e>=0?t[e]=Object.assign(t[e],a):t.push(a)}dynamicCardMenu(t){let i=this.atividadeService.dynamicButtons.bind(this)(t.data,this.optionsMetadata);return i.push({icon:"bi bi-three-dots",hint:"Op\xE7\xF5es",dynamicItems:this.cardDynamicOptions.bind(this)}),(!t.menu||t.menu.map(e=>e.hint).join()!=i.map(e=>e.hint).join())&&(t.menu=i),t.menu}cardDynamicOptions(t){let i=t.menu?.find(e=>e.hint=="Op\xE7\xF5es");if(i){let e=this.atividadeService.dynamicOptions.bind(this)(t.data,this.optionsMetadata);(!i.items||i?.items.map(a=>a.label).join()!=e.map(a=>a.label).join())&&(i.items=e)}return i?.items}canDrop(t){let i=this;return e=>i.isEtiquetas?!0:!!i.atividadeService.dynamicOptions.bind(i)(e.data,i.optionsMetadata).find(c=>c.id==t)}updateEtiquetasAtividade(t){let i=this.labels.find(c=>c.cards==t.source.list)?.labels[0],e=this.labels.find(c=>c.cards==t.destination.list)?.labels[0],a=t.destination.atividade;i&&e&&i.key==e.key||(i&&a.etiquetas.splice(a.etiquetas.findIndex(c=>c.key==i.key),1),e&&a.etiquetas.unshift(e),this.loading=!0,this.dao.update(a.id,{etiquetas:a.etiquetas}).then(c=>this.modalRefreshId(c).modalClose.bind(this)(c.id)).finally(()=>this.loading=!1))}onDragged(t,i,e){if(["copy","move"].includes(e)){let a=i.indexOf(t);this.dragDrop.source={list:i,index:a},this.isEtiquetas&&this.updateEtiquetasAtividade(this.dragDrop)}}onDrop(t,i){if(i&&["copy","move"].includes(t.dropEffect)){let e=t.data.data,a=t.data,c=typeof t.index>"u"?i.length:t.index;if(this.dragDrop={destination:{list:i,index:c,card:a,atividade:e}},!this.isEtiquetas){let p=this.atividadeService.dynamicOptions.bind(this)(e,this.optionsMetadata),x=this.cards.indexOf(i);if(x>=0){let se=p.find(N=>N.id==this.DOCKERS[x]);se?.onClick&&se?.onClick(e)}}}}onStatusClick(t){this.filter?.controls.status.setValue(t.data?.status),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}onEtiquetaClick(t){let i=this.filter.controls.etiquetas.value;i.push(t),this.filter?.controls.etiquetas.setValue(i),this.filterCollapsed=!1,this.filterRef?.onButtonFilterClick(),this.cdRef.detectChanges()}filterClear(t){this.filter.controls.atribuidas_para_mim.setValue(!1),this.filter.controls.usuario_id.setValue(""),this.filter.controls.somente_unidade_atual.setValue(!1),this.filter.controls.unidades_subordinadas.setValue(!1),this.filter.controls.unidade_id.setValue(""),this.filter.controls.numero_processo.setValue(""),this.filter.controls.plano_entrega_id.setValue(null),this.filter.controls.plano_entrega_entrega_id.setValue(null),(!this.fixedFilter?.length||!this.fixedFilter.find(i=>i[0]=="status"))&&this.filter.controls.status.setValue(null),this.filter.controls.etiquetas.setValue([]),super.filterClear(t)}onSwimlaneDrop(t,i){let e=this.labels[i],a=i<t.index?t.index-1:t.index;this.labels.splice(i,1),this.labels.splice(a,0,e),this.saveEtiquetasUsuarioConfig()}onEntregaClick(t){this.go.navigate({route:["gestao","atividade",t.id,"hierarquia"]},{metadata:{atividade:t}})}onUnidadeChange(t){return _(this,null,function*(){let i=yield this.unidadeDao.getById(this.filter?.controls.unidade_id.value,["planos_entrega"]);this.planosEntregas=i?.planos_entrega?.map(e=>Object.assign({key:e.id,value:e.nome}))||[]})}onPlanoEntregaChange(t){return _(this,null,function*(){let i=[];(yield this.unidadeDao.getById(this.filter?.controls.unidade_id.value,["planos_entrega.entregas"]))?.planos_entrega?.forEach(a=>{a.id==this.filter.controls.plano_entrega_id.value&&i.push(a.entregas)}),this.planosEntregasEntregas=i[0].map(a=>Object.assign({key:a.id,value:a.descricao}))||[]})}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["atividade-list-kanban"]],viewQuery:function(i,e){if(i&1&&(g(Bi,5),g(Ki,5),g(Hi,5),g(Gi,5),g($i,5),g(Wi,5),g(Ji,5),g(Zi,5)),i&2){let a;v(a=b())&&(e.filterRef=a.first),v(a=b())&&(e.kanbanEtiquetas=a.first),v(a=b())&&(e.dockerNaoIniciado=a.first),v(a=b())&&(e.dockerPausado=a.first),v(a=b())&&(e.dockerIniciado=a.first),v(a=b())&&(e.dockerConcluido=a.first),v(a=b())&&(e.planoEntrega=a.first),v(a=b())&&(e.planoEntregaEntrega=a.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",minhas:"minhas"},features:[k],decls:29,vars:52,consts:[["filterRef",""],["usuario",""],["unidade",""],["planoEntrega",""],["planoEntregaEntrega",""],["ticket",""],["editDocker",""],["placeholder",""],["dockerNaoIniciado",""],["dockerIniciado",""],["dockerPausado",""],["dockerConcluido",""],["kanbanEtiquetas",""],[3,"buttons"],["labelPosition","left","label","Resumido","controlName","resumido",3,"change","size","control"],["labelPosition","left","label","Usar etiquetas","controlName","usarEtiquetas",1,"me-2",3,"change","size","control"],[3,"deleted","form","where","query","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Minhas","controlName","atribuidas_para_mim",3,"change","size","control"],["controlName","usuario_id",3,"size","label","control","disabled","dao"],["label","Atual","controlName","somente_unidade_atual","labelInfo","Somente as atividades da unidade selecionada",3,"change","size","control"],["maskFormat","00000.000000/0000-00","controlName","numero_processo","labelInfo","Pesquisa no documento de requisi\xE7\xE3o, conclus\xE3o e nos documentos das tarefas",3,"size","label","control"],["label","Status","itemTodos","- Todos -","controlName","status",3,"size","valueTodos","disabled","control","items"],["controlName","unidade_id",3,"change","size","label","control","disabled","dao"],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","control"],["itemTodos","- Todos -","controlName","plano_entrega_id",3,"change","size","label","valueTodos","control","items"],["itemTodos","- Todos -","controlName","plano_entrega_entrega_id",3,"size","label","valueTodos","control","items"],["noForm","","noBox","","label","Etiquetas","controlName","etiquetas",3,"size","control"],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes",4,"ngIf"],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle",4,"ngIf"],["color","info","role","button",3,"icon","label","click",4,"ngIf"],[1,"d-flex","w-100"],[1,"flex-fill"],[1,"text-nowrap"],[1,"badge","bg-light","text-dark"],[1,"bi","bi-briefcase"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark",3,"title"],["data-bs-toggle","tooltip","data-bs-placement","top",1,"badge","bg-light","text-dark","fw-light",3,"title"],[1,"bi","bi-cursor"],[4,"ngIf"],["color","info","role","button",3,"click","icon","label"],[3,"url","hint"],[1,"card-status-container"],[3,"documento"],["class","ms-1",3,"color","label","icon","data","click",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],["origem","ATIVIDADE",3,"entity"],["collapse","",3,"title","collapsed",4,"ngIf"],["origem","ATIVIDADE",3,"entity","selectable","query"],[1,"ms-1",3,"color","label","icon","data","click"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["collapse","",3,"title","collapsed"],["controlName","etiqueta",3,"size","control","items"],[1,"card-body"],[1,"card-title","placeholder-glow"],[1,"placeholder","col-6"],["role","group","aria-label","Basic outlined example",1,"btn-group"],["type","button",1,"btn","btn-sm","btn-outline-secondary","disabled","placeholder"],[1,"bi","bi-question"],[1,"card-subtitle","mb-2","text-muted","placeholder-glow"],[1,"placeholder","col-8"],[1,"card-text","placeholder-glow"],[1,"placeholder","col-7"],[1,"placeholder","col-4"],["useCardData","",3,"template","placeholderTemplate","loading","dragSwimlanes"],["icon","bi bi-hourglass-split","title","N\xE3o iniciado","color","border-warning",3,"collapse","toggle","menu","dragged","drop","dropIf","cards"],["icon","bi bi-play-circle","title","Iniciadas","color","border-info",3,"collapse","toggle","dragged","drop","dropIf","cards"],["icon","bi bi-pause-circle","title","Pausadas","color","border-danger",3,"collapse","toggle","dragged","drop","dropIf","cards"],["icon","bi bi-check-circle","title","Conclu\xEDdas","color","border-primary",3,"collapse","toggle","dragged","drop","dropIf","cards"],["useCardData","",3,"dockers","template","placeholderTemplate","loading","swimlaneDrop","dockerDragged","dockerDrop","dockerEditTemplate","dockerToggle","dockerEdit","dockerSave","dockerDelete","dockerCancel","dockerColorStyle"]],template:function(i,e){if(i&1){let a=V();u(0,"toolbar",13)(1,"input-switch",14),E("change",function(p){return C(a),y(e.onResumidoChange(p))}),d(),u(2,"input-switch",15),E("change",function(p){return C(a),y(e.onUsarEtiquetasChange(p))}),d()(),u(3,"filter",16,0)(5,"div",17)(6,"input-switch",18),E("change",function(p){return C(a),y(e.onAtribuidasParaMimChange(p))}),d(),m(7,"input-search",19,1),u(9,"input-switch",20),E("change",function(p){return C(a),y(e.onSomenteUnidadeAtualChange(p))}),d(),m(10,"input-text",21)(11,"input-select",22),d(),u(12,"div",17)(13,"input-search",23,2),E("change",function(p){return C(a),y(e.onUnidadeChange(p))}),d(),m(15,"input-switch",24),u(16,"input-select",25,3),E("change",function(p){return C(a),y(e.onPlanoEntregaChange(p))}),d(),m(18,"input-select",26,4)(20,"input-multiselect",27),d()(),h(21,da,17,13,"ng-template",null,5,q)(23,ca,1,3,"ng-template",null,6,q)(25,ua,16,0,"ng-template",null,7,q)(27,ma,12,29,"kanban",28)(28,pa,2,14,"kanban",29)}i&2&&(r("buttons",e.toolbarButtons),l(),r("size",2)("control",e.filter.controls.resumido),l(),r("size",2)("control",e.filter.controls.usarEtiquetas),l(),r("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("query",e.query)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",e.filterCollapsed),l(3),r("size",1)("control",e.filter.controls.atribuidas_para_mim),l(),r("size",4)("label",e.lex.translate("Usu\xE1rio"))("control",e.filter.controls.usuario_id)("disabled",e.filter.controls.atribuidas_para_mim.value?"true":void 0)("dao",e.usuarioDao),l(2),r("size",1)("control",e.filter.controls.somente_unidade_atual),l(),r("size",3)("label","N\xBA "+e.lex.translate("Processo")+" (Sei)")("control",e.filter.controls.numero_processo),We("maxlength",250),l(),r("size",3)("valueTodos",null)("disabled",e.fixedFilter!=null&&e.fixedFilter.length&&e.fixedFilter[0][0]=="status"?"true":void 0)("control",e.filter.controls.status)("items",e.lookup.ATIVIDADE_STATUS),l(2),r("size",3)("label",e.lex.translate("Unidade"))("control",e.filter.controls.unidade_id)("disabled",e.filter.controls.somente_unidade_atual.value?"true":void 0)("dao",e.unidadeDao),l(2),r("size",1)("control",e.filter.controls.unidades_subordinadas),l(),r("size",3)("label",e.lex.translate("Plano de Entrega"))("valueTodos",null)("control",e.filter.controls.plano_entrega_id)("items",e.planosEntregas),l(2),r("size",2)("label",e.lex.translate("Entrega do Plano de Entrega"))("valueTodos",null)("control",e.filter.controls.plano_entrega_entrega_id)("items",e.planosEntregasEntregas),l(2),r("size",3)("control",e.filter.controls.etiquetas),l(7),r("ngIf",!e.isEtiquetas),l(),r("ngIf",e.isEtiquetas))},styles:[".comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:initial;white-space:normal}.comentario-badge[data-expanded=true][_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{font-size:12px;height:auto;display:block;max-width:290px;white-space:initial}.atividade-atividade[_ngcontent-%COMP%], .atividade-descricao[_ngcontent-%COMP%]{height:auto;display:block;max-width:200px;white-space:initial}.comentario-badge[_ngcontent-%COMP%]{white-space:nowrap;display:block;background-color:#ffe69c!important;margin-bottom:1px;text-align:left}.comentario-badge[_ngcontent-%COMP%]   .comentario-title[_ngcontent-%COMP%]{display:none}.comentario-badge[_ngcontent-%COMP%]   .comentario-text[_ngcontent-%COMP%]{display:inline-block;max-width:290px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-size:12px}.docker-border[_ngcontent-%COMP%]{border-width:1px}.card-status-container[_ngcontent-%COMP%]{width:330px}"]});let n=s;return n})();var fa=["programa"],ha=["unidadesSubordinadas"],xt=(()=>{let s=class s extends Pe{constructor(t){super(t),this.injector=t,this.validate=(i,e)=>null,this.title=this.lex.translate("Atividades"),this.code="MOD_DMD",this.fh=this.injector.get(at),this.cdRef=t.get(Ze),this.filter=this.fh.FormBuilder({programa_id:{default:""},unidadesSubordinadas:{default:!1}},this.cdRef,this.validate)}ngOnInit(){super.ngOnInit()}};s.\u0275fac=function(i){return new(i||s)(S(w))},s.\u0275cmp=A({type:s,selectors:[["atividade-dashboard"]],viewQuery:function(i,e){if(i&1&&(g($,5),g(fa,5),g(ha,5)),i&2){let a;v(a=b())&&(e.grid=a.first),v(a=b())&&(e.programa=a.first),v(a=b())&&(e.unidadesSubordinadas=a.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter"},features:[k],decls:0,vars:0,template:function(i,e){}});let n=s;return n})();var $n=(()=>{let s=class s{};s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=Ce({type:s}),s.\u0275inj=be({imports:[Xe,qt,pt,gt,vt]});let n=s;return n})();ye(Ne,[z,ie,te,fe,xt,$e],[]);ye(fe,[de,z,$,Se,we,Me,Ue,rt,R,B,Qe,Y,U,H,je,G,ct,ce,Ve,ee,Be,xe,ue,pe,ne],[]);ye($e,[de,z,Me,Ue,R,B,Qe,H,je,G,dt,lt,st,ce,ut,Be,ue,pe],[]);export{ne as a,$n as b};
