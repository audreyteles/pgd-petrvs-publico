import{a as Me}from"./chunk-UFS3OPCG.js";import{b as X}from"./chunk-76VPKZU2.js";import{a as z,b as U}from"./chunk-RMYSPY7H.js";import{M as Ae,N as Re,O as Ne,Q as Le,b as j,f as re,fa as qe,h as se,i as Ie,s as A,t as Se,u as Te,w as Oe,x as le,y as Fe}from"./chunk-XHTD5OAS.js";import{b as ie,c as J,d as K,e as oe,h as ne,m as ae,s as P}from"./chunk-KODYKPWY.js";import{$a as Z,Aa as be,Ab as we,Bb as W,Ca as Q,Db as De,Dd as G,Fa as m,Fb as Ee,Ga as c,Ha as f,Ka as pe,La as O,Ld as k,Ma as E,Md as L,Na as p,P as H,Qc as Pe,Sc as te,U as I,Ua as y,V as Y,Va as V,Wa as w,Xa as C,Ya as x,Z as g,Za as N,_ as v,_a as ye,ba as M,h as D,ic as xe,kb as ee,lb as ue,ma as d,na as S,oc as fe,qd as F,sb as b,tb as Ve,va as T,xa as h,ya as q,za as l}from"./chunk-6YMI2QVU.js";function Xe(n,a){if(n&1&&(m(0,"small",10),x(1),c()),n&2){let r=a.row,i=a.metadata,t=p();d(),N(t.getSequencia(i,r))}}function He(n,a){if(n&1&&f(0,"input-level",11),n&2){let r=p();l("size",6)("validate",r.validateLevel)}}function Ye(n,a){if(n&1&&(m(0,"strong",12),x(1),c()),n&2){let r=a.row,i=a.metadata,t=p();be("margin-left",t.getNivelSequencia(i),"px"),d(),N(r.nome||"")}}function Ze(n,a){if(n&1&&f(0,"input-text",13),n&2){let r=p();l("size",6)("control",r.form.controls.nome),q("maxlength",250)}}var de=(()=>{let a=class a extends ae{set noPersist(i){super.noPersist=i}get noPersist(){return super.noPersist}set control(i){super.control=i}get control(){return super.control}set entity(i){super.entity=i}get entity(){return super.entity}get items(){return this.gridControl.value||this.gridControl.setValue(new L),this.gridControl.value.processos||(this.gridControl.value.processos=[]),this.gridControl.value.processos}constructor(i){super(i),this.injector=i,this.validate=(t,e)=>{let o=null;return["nome"].indexOf(e)>=0&&!t.value?.length&&(o="Obrigat\xF3rio"),["nivel"].indexOf(e)>=0&&(o=this.existePai(t)),o},this.validateLevel=(t,e,o)=>{if(o.length){let s=[...t.map(u=>u.value),e.value];return this.processos(s).length==s.length}else{let s=this.processos(t.map(_=>_.value));return(s.length==t.length&&s.length?this.items.filter(_=>_.processo_pai_id==s[s.length-1].id):[]).length+1>=e.value}},this.processos=t=>{let e=[];return t.reduce((o,s)=>{let u=o.find(_=>_.sequencia==s);return u?(e.push(u),this.items.filter(_=>_.processo_pai_id==u?.id)):[]},this.items.filter(o=>!o.processo_pai_id)),e},this.cdRef=i.get(Ve),this.dao=i.get(F),this.processosDao=i.get(G),this.form=this.fh.FormBuilder({nome:{default:""},sequencia:{default:1},nivel:{default:""}},this.cdRef,this.validate)}existePai(i){let t=null,e=i.value.split("."),o=this.items;if(e.length>1){let s=o.reduce((_,R)=>_.created_at>R.created_at?_:R),u=this.processos(e.slice(0,e.length-1));if(!s.processo_pai_id)u[0].id==s.id?t="N\xE3o existe o n\xEDvel pai":t=u.length+1==e.length?"Adicione o n\xEDvel filho pelo bot\xE3o 'Adicionar filho'":"N\xE3o existe o n\xEDvel pai";else{let _=s.processo_pai_id,R="";for(;_;){let Ce=this.items.find(Ke=>Ke.id==_);R=(Ce?.sequencia||"")+"."+R,_=Ce?.processo_pai_id||null}let B;B=R.split("."),B.pop(),B.push((s.sequencia-1).toString()),this.JSON.stringify(e)<=this.JSON.stringify(B)&&e[e.length-1].parseInt()<=B[B.length-1].parseInt()?t="N\xEDvel j\xE1 existente":e.length>B.length&&(t=u.length+1==e.length?"Adicione o n\xEDvel filho pelo bot\xE3o 'Adicionar filho'":"N\xE3o existe o n\xEDvel pai")}}else if(o.length>0){let s=o.reduce((u,_)=>u.created_at>_.created_at?u:_);e[0]<s.sequencia?t="N\xEDvel j\xE1 existente":e[0]>s.sequencia?t="Insira o n\xEDvel em sequ\xEAncia num\xE9rica":t=s.processo_pai_id==null?null:"Adicione este n\xEDvel pelo bot\xE3o 'Adicionar n\xEDvel'"}return t}loadData(i,t){this.cdRef.detectChanges(),this.sortProcessos()}addChildProcesso(i,t,e){return D(this,null,function*(){let o=new k({id:this.dao.generateUuid(),processo_pai_id:i.id,sequencia:this.items.filter(s=>s.processo_pai_id==i.id).length+1,nome:""});this.items.push(o),this.grid.setMetadata(o,{nivel:this.getSequencia({},o)}),this.sortProcessos(),this.grid.adding=!0,yield this.grid.edit(o)})}getSequencia(i,t){if(!i.nivel){let e=t.processo_pai_id,o="",s=[];for(;e;){s.push(e);let u=this.items.find(_=>_.id==e);o=(u?.sequencia||"")+"."+o,e=u?.processo_pai_id||null}o+=t.sequencia,i.nivel!=o&&(i.nivel=o,i.path=s),this.grid||this.sortProcessosItems()}return i.nivel}getNivelSequencia(i){return 10*(i.nivel.match(/\./g)||[]).length}sortProcessos(){this.items.sort((i,t)=>{let e=(this.grid.getMetadata(i)?.nivel||"").split(".").map(s=>("000"+s).substr(-3)).join("."),o=(this.grid.getMetadata(t)?.nivel||"").split(".").map(s=>("000"+s).substr(-3)).join(".");return e<o?-1:e>o?1:0})}sortProcessosItems(){this.items.sort((i,t)=>{let e=i.processo_pai_id?this.retornaNivel(i):i.sequencia.toString(),o=t.processo_pai_id?this.retornaNivel(t):t.sequencia.toString(),s=(e||"").split(".").map(_=>("000"+_).substr(-3)).join("."),u=(o||"").split(".").map(_=>("000"+_).substr(-3)).join(".");return s<u?-1:s>u?1:0})}retornaNivel(i){let t=i.processo_pai_id,e="";for(;t;){let o=this.items.find(s=>s.id==t);e=(o?.sequencia||"")+"."+e,t=o?.processo_pai_id||null}return e+=i.sequencia,e}addProcesso(){return D(this,null,function*(){return new k({id:this.dao.generateUuid(),sequencia:this.items.filter(t=>!t.processo_pai_id).length+1,nome:""})})}loadProcesso(i,t){return D(this,null,function*(){i.controls.nivel.setValue(this.getSequencia(this.grid?.getMetadata(t),t)),i.controls.sequencia.setValue(t.sequencia),i.controls.nome.setValue(t.nome),this.cdRef.detectChanges()})}removeProcesso(i){return D(this,null,function*(){if(yield this.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")){let e=i;return(this.items.filter(s=>s.processo_pai_id==e.id)||[]).forEach(s=>this.removeProcesso(s)),this.items.splice(this.items.findIndex(s=>s.id==e.id),1),this.isNoPersist||(yield this.processosDao?.delete(i)),!0}else return!1})}saveProcesso(i,t){return D(this,null,function*(){let e;if(this.form.markAllAsTouched(),this.form.valid){let o=i.controls.nivel.value.split("."),s=this.processos(o.slice(0,o.length-1)),u=s?.length?s[s.length-1].id:null,_=o[o.length-1]*1;this.items.filter(R=>R.processo_pai_id==u&&R.sequencia>=_).forEach(R=>R.sequencia++),t.id=t.id=="NEW"?this.dao.generateUuid():t.id,t.sequencia=_,t.cadeia_valor_id=this.entity?.id,t.processo_pai_id=u,t.nome=i.controls.nome.value,e=t,this.isNoPersist||(e=yield this.processosDao?.save(t))}return e})}editEndProcesso(i){this.grid?.clearMetadata(),this.cdRef.detectChanges(),this.sortProcessos(),this.cdRef.detectChanges()}dynamicButtons(i){let t=[];return t.push({hint:"Adicionar filho",icon:"bi bi-plus-circle",onClick:this.addChildProcesso.bind(this)}),t}};a.\u0275fac=function(t){return new(t||a)(S(M))},a.\u0275cmp=I({type:a,selectors:[["cadeia-valor-list-processos"]],viewQuery:function(t,e){if(t&1&&(y(A,5),y(P,5)),t&2){let o;V(o=w())&&(e.editableForm=o.first),V(o=w())&&(e.grid=o.first)}},inputs:{cdRef:"cdRef",noPersist:"noPersist",control:"control",entity:"entity"},features:[T],decls:15,vars:15,consts:[["nivel",""],["editNivel",""],["processo",""],["editProcesso",""],["noButtons","",3,"form","disabled"],[1,"row"],["editable","",3,"items","form","hasDelete","add","load","remove","save","editEnd"],["title","N\xEDvel",3,"template","editTemplate"],["title","Processos",3,"template","editTemplate"],["type","options",3,"dynamicButtons"],[1,"d-block"],["controlName","nivel",3,"size","validate"],[1,"d-block","text-break","w-100"],["controlName","nome",3,"size","control"]],template:function(t,e){if(t&1&&(m(0,"editable-form",4)(1,"div",5)(2,"grid",6)(3,"columns")(4,"column",7),h(5,Xe,2,1,"ng-template",null,0,b)(7,He,1,2,"ng-template",null,1,b),c(),m(9,"column",8),h(10,Ye,2,3,"ng-template",null,2,b)(12,Ze,1,3,"ng-template",null,3,b),c(),f(14,"column",9),c()()()()),t&2){let o=C(6),s=C(8),u=C(11),_=C(13);l("form",e.form)("disabled",e.formDisabled),d(2),l("items",e.items)("form",e.form)("hasDelete",!0)("add",e.addProcesso.bind(e))("load",e.loadProcesso.bind(e))("remove",e.removeProcesso.bind(e))("save",e.saveProcesso.bind(e))("editEnd",e.editEndProcesso.bind(e)),d(2),l("template",o)("editTemplate",s),d(5),l("template",u)("editTemplate",_),d(5),l("dynamicButtons",e.dynamicButtons.bind(e))}},dependencies:[P,K,J,A,j,Te]});let n=a;return n})();var at=["unidade"];function rt(n,a){n&1&&f(0,"toolbar")}function st(n,a){if(n&1&&(m(0,"span",22),f(1,"i",23),x(2),c()),n&2){let r=p().row;d(2),ye(" ",r==null?null:r.length,"")}}function lt(n,a){if(n&1&&h(0,st,3,1,"span",21),n&2){let r=a.row;l("ngIf",r==null?null:r.length)}}function dt(n,a){if(n&1&&f(0,"cadeia-valor-list-processos",24,6),n&2){let r=a.row,i=p(2);l("entity",r)("cdRef",i.cdRef)}}function ct(n,a){if(n&1&&(m(0,"column",20),h(1,lt,1,1,"ng-template",null,4,b)(3,dt,2,2,"ng-template",null,5,b),c()),n&2){let r=C(2),i=C(4),t=p();l("align","center")("hint",t.lex.translate("Processos"))("template",r)("expandTemplate",i)}}function mt(n,a){if(n&1&&(m(0,"span",25),x(1),c()),n&2){let r=a.row;d(),N(r.nome)}}function pt(n,a){if(n&1&&(m(0,"span"),x(1),c()),n&2){let r=a.row,i=p();d(),N(i.dao.getDateFormatted(r.data_inicio))}}function ut(n,a){if(n&1&&(m(0,"span"),x(1),c()),n&2){let r=a.row,i=p();d(),N(i.dao.getDateFormatted(r.data_fim))}}function ft(n,a){if(n&1&&f(0,"column",26),n&2){let r=p();l("onEdit",r.edit)("options",r.options)}}var ce=(()=>{let a=class a extends X{constructor(i){super(i,L,F),this.injector=i,this.selectable=!1,this.filterWhere=t=>{let e=[],o=t.value;return o.unidade_id?.length&&e.push(["unidade_id","==",o.unidade_id]),o.data_inicio&&e.push(["data_fim",">=",o.data_inicio]),o.data_fim&&e.push(["data_inicio","<=",o.data_fim]),e},this.entidadeDao=i.get(Pe),this.unidadeDao=i.get(te),this.join=["processos"],this.code="MOD_CADV",this.filter=this.fh.FormBuilder({data_inicio:{default:null},data_fim:{default:null},unidade_id:{default:""},entidade_id:{default:null}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_CADV_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}onChangeData(){let i=new Date(this.filter.controls.data_inicio.value).getTime();if(new Date(this.filter.controls.data_fim.value).getTime()<i){let e=new Date(i);e.setDate(e.getDate()+1),this.filter.controls.data_fim.setValue(e)}}};a.\u0275fac=function(t){return new(t||a)(S(M))},a.\u0275cmp=I({type:a,selectors:[["cadeia-valor-list-grid"]],viewQuery:function(t,e){if(t&1&&(y(P,5),y(at,7)),t&2){let o;V(o=w())&&(e.grid=o.first),V(o=w())&&(e.unidade=o.first)}},inputs:{snapshot:"snapshot",fixedFilter:"fixedFilter",selectable:"selectable"},features:[T],decls:21,vars:30,consts:[["unidade",""],["columnNome",""],["columnInicio",""],["columnFim",""],["columnProcessos",""],["columnExpandedProcessos",""],["processos",""],[3,"select","dao","add","orderBy","groupBy","join","selectable","hasAdd","hasEdit"],[4,"ngIf"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","unidade_id","required","",3,"size","control","dao"],["date","","label","In\xEDcio","icon","bi bi-calendar-date","controlName","data_inicio",3,"change","size","control","labelInfo"],["date","","label","Fim","icon","bi bi-calendar-date","controlName","data_fim",3,"change","size","control","labelInfo"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate",4,"ngIf"],["title","Nome","orderBy","nome",3,"template"],["title","In\xEDcio",3,"template"],["title","Fim",3,"template"],["type","options",3,"onEdit","options",4,"ngIf"],[3,"rows"],["type","expand","icon","bi bi-boxes",3,"align","hint","template","expandTemplate"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],[3,"entity","cdRef"],[1,"text-break","w-100"],["type","options",3,"onEdit","options"]],template:function(t,e){if(t&1){let o=O();m(0,"grid",7),E("select",function(u){return g(o),v(e.onSelect(u))}),h(1,rt,1,0,"toolbar",8),m(2,"filter",9)(3,"div",10),f(4,"input-search",11,0),m(6,"input-datetime",12),E("change",function(){return g(o),v(e.onChangeData())}),c(),m(7,"input-datetime",13),E("change",function(){return g(o),v(e.onChangeData())}),c()()(),m(8,"columns"),h(9,ct,5,4,"column",14),m(10,"column",15),h(11,mt,2,1,"ng-template",null,1,b),c(),m(13,"column",16),h(14,pt,2,1,"ng-template",null,2,b),c(),m(16,"column",17),h(17,ut,2,1,"ng-template",null,3,b),c(),h(19,ft,1,2,"column",18),c(),f(20,"pagination",19),c()}if(t&2){let o=C(12),s=C(15),u=C(18);l("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable)("hasAdd",e.auth.hasPermissionTo("MOD_CADV_INCL"))("hasEdit",e.auth.hasPermissionTo("MOD_CADV_EDT")),d(),l("ngIf",!e.selectable),d(),l("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),d(2),l("size",6)("control",e.filter.controls.unidade_id)("dao",e.unidadeDao),d(2),l("size",3)("control",e.filter.controls.data_inicio)("labelInfo","In\xEDcio "+e.lex.translate("cadeia de valor")),d(),l("size",3)("control",e.filter.controls.data_fim)("labelInfo","Fim "+e.lex.translate("cadeia de valor")),d(2),l("ngIf",!e.selectable),d(),l("template",o),d(3),l("template",s),d(3),l("template",u),d(3),l("ngIf",!e.selectable),d(),l("rows",e.rowsLimit)}},dependencies:[W,P,K,J,oe,ie,ne,se,re,de]});let n=a;return n})();var ht=["cadeiaValorInstitucional"],gt=["editProcessoForm"],ve=()=>["processo"],Ge=n=>({processo:n});function vt(n,a){if(n&1&&(m(0,"editable-form",3)(1,"div",15),f(2,"input-text",16),c()()),n&2){let r=p();l("form",r.form),d(2),l("size",12)("label","Nome do "+r.lex.translate("processo"))("control",r.form.controls.nome),q("maxlength",250)}}function Ct(n,a){if(n&1){let r=O();m(0,"div",32),E("dndEnd",function(t){g(r);let e=p(4);return v(e.onDragEnd(t))})("dndMoved",function(){let t=g(r).$implicit,e=p().processo,o=p(3);return v(o.onDragged(t,e.children,"move"))})("dndStart",function(t){g(r);let e=p(4);return v(e.onDragStart(t))}),m(1,"div",23)(2,"h5",18),x(3),c(),m(4,"div",33),f(5,"action-button",20),c()(),pe(6,28),c()}if(n&2){let r=a.$implicit;p(2);let i=C(8),t=p(2);Q("--bg:"+r.cor+";--color:black;"),l("dndDisableIf",!t.canEdit)("dndDraggable",r),d(3),Z("",r.level,". ",r.nome,""),d(2),l("data",r)("items",t.options),d(),l("ngTemplateOutlet",i)("ngTemplateOutletContext",ue(10,Ge,r))}}function bt(n,a){if(n&1){let r=O();m(0,"div",29),E("dndDrop",function(t){let e=g(r).processo,o=p(3);return v(o.onDrop(t,e.children))}),m(1,"div",30)(2,"p",10),f(3,"span",24)(4,"span",25),c()(),h(5,Ct,7,12,"div",31),c()}if(n&2){let r=a.processo;l("dndDropzone",ee(4,ve)),d(),Q("--bg:gray;--color:black;"),d(4),l("ngForOf",r.children)}}function yt(n,a){if(n&1){let r=O();m(0,"div",27),E("dndEnd",function(t){g(r);let e=p(2);return v(e.onDragEnd(t))})("dndMoved",function(){let t=g(r).$implicit,e=p().$implicit,o=p();return v(o.onDragged(t,e.children,"move"))})("dndStart",function(t){g(r);let e=p(2);return v(e.onDragStart(t))}),m(1,"div",23)(2,"h4",18),x(3),c(),m(4,"div",19),f(5,"action-button",20),c()(),pe(6,28),h(7,bt,6,5,"ng-template",null,2,b),c()}if(n&2){let r=a.$implicit,i=C(8),t=p(2);Q("--bg:"+r.cor+";--color:black;"),l("dndDisableIf",!t.canEdit)("dndDraggable",r),d(3),Z("",r.level,". ",r.nome,""),d(2),l("data",r)("items",t.options),d(),l("ngTemplateOutlet",i)("ngTemplateOutletContext",ue(10,Ge,r))}}function Vt(n,a){if(n&1){let r=O();m(0,"div",17),E("dndEnd",function(t){g(r);let e=p();return v(e.onDragEnd(t))})("dndMoved",function(){let t=g(r).$implicit,e=p();return v(e.onDragged(t,e.processos,"move"))})("dndStart",function(t){g(r);let e=p();return v(e.onDragStart(t))}),m(1,"div",8)(2,"div",9)(3,"h3",18),x(4),c(),m(5,"div",19),f(6,"action-button",20),c()(),m(7,"div",21),E("dndDrop",function(t){let e=g(r).$implicit,o=p();return v(o.onDrop(t,e.children))}),m(8,"div",22)(9,"div",23)(10,"p",10),f(11,"span",24)(12,"span",25),c()()(),h(13,yt,9,12,"div",26),c()()()}if(n&2){let r=a.$implicit,i=p();l("dndDisableIf",!i.canEdit)("dndDraggable",r),d(),Q("--border-color:"+r.cor+";--bg:white;--color:black;"),d(3),Z("",r.level,". ",r.nome,""),d(2),l("data",r)("items",i.options),d(),l("dndDropzone",ee(12,ve)),d(),Q("--bg:gray;--color:black;"),d(5),l("ngForOf",r.children)}}var ge=class extends k{constructor(a){super(),this.children=[],this.cor="#010101",this.level="",this.initialization(a)}},Ue=(()=>{let a=class a extends ae{constructor(i){super(i),this.injector=i,this.cadeiasValor=[],this.processos=[],this.canEdit=!0,this.options=[{icon:"bi bi-file-earmark-bar-graph",label:"Entregas",onClick:this.consultProcesso.bind(this)},{divider:!0},{icon:"bi bi-plus-circle",label:"Incluir subprocesso",onClick:this.addProcesso.bind(this)},{icon:"bi bi-pencil-square",label:"Alterar",onClick:this.editProcesso.bind(this)},{divider:!0},{icon:"bi bi-trash",label:"Excluir",onClick:this.deleteProcesso.bind(this)}],this.validate=(t,e)=>{let o=null;return e=="nome"&&!t.value?.length&&(o="Obrigat\xF3rio"),o},this.dao=i.get(F),this.cadeiaValorProcessoDao=i.get(G),this.join=["processos"],this.title=this.lex.translate("Cadeias de Valores"),this.form=this.fh.FormBuilder({cadeia_valor_id:{default:null},nome:{default:""}},this.cdRef,this.validate)}ngAfterViewInit(){super.ngAfterViewInit(),this.loadData(this.entity)}consultProcesso(i){this.go.navigate({route:["gestao","plano-entrega","entrega","processos",i.id]})}addProcesso(i){return D(this,null,function*(){let t=new k({path:i.path+"/"+i.id,cadeia_valor_id:i.cadeia_valor_id,processo_pai_id:i.id,nome:"",sequencia:1});yield this.editProcesso(t)})}editProcesso(i){return D(this,null,function*(){this.entity=i,this.form.controls.nome.setValue(i.nome),this.form.controls.nome.setErrors(null);let t=yield this.dialog.template({title:"Processo",modalWidth:500},this.editProcessoForm,[{label:"Gravar",icon:"bi bi-check-circle",color:"btn-outline-success",value:"GRAVAR"},{label:"Cancelar",icon:"bi bi-dash-circle",color:"btn btn-outline-danger",value:"CANCELAR"}]).asPromise();if(t.button.value=="GRAVAR")if(this.form.valid){this.entity.nome=this.form.controls.nome.value,this.submitting=!0;try{(yield this.cadeiaValorProcessoDao.save(this.entity))&&t.dialog.close(),yield this.refreshCadeiaValor()}catch(e){this.dialog.alert("Error",e.message?e.message:e||"Erro desconhecido")}finally{this.submitting=!1}}else this.form.markAllAsTouched();else t.dialog.close()})}deleteProcesso(i){return D(this,null,function*(){if(yield this.dialog.confirm("Exclui ?","Deseja realmente excluir?"))try{yield this.cadeiaValorProcessoDao.delete(i.id),yield this.refreshCadeiaValor()}catch(e){this.dialog.alert("Erro","Erro ao excluir: "+(e?.message?e?.message:e||"Erro desconhecido"))}})}loadData(i,t){return D(this,null,function*(){this.query=this.dao.query({where:[["data_arquivamento","==",null]],orderBy:[["data_inicio","desc"]],join:this.join}),this.query.asPromise().then(e=>{let o=this.form.controls.cadeia_valor_id.value;this.form.controls.cadeia_valor_id.setValue(null),this.cadeiasValor=e.map(s=>Object.assign({},{key:s.id,value:s.nome,data:s})),this.cdRef.detectChanges(),this.form.controls.cadeia_valor_id.setValue(o||(this.cadeiasValor.length?this.cadeiasValor[0].key:null))})})}onCadeiaValorChange(){let i=(t,e)=>e.sort((o,s)=>o.sequencia-s.sequencia).map(o=>Object.assign(new ge({children:i(t+o.sequencia+".",this.cadeiaValor.processos.filter(s=>s.processo_pai_id==o.id)),level:t+o.sequencia,cor:this.lookup.CORES_BACKGROUND[Math.floor(Math.random()*this.lookup.CORES_BACKGROUND.length)].color}),o));this.cadeiaValor=this.cadeiaValorInstitucional?.selectedItem?.data,this.cadeiaValor&&(this.processos=i("",this.cadeiaValor.processos.filter(t=>!t.processo_pai_id)))}refreshCadeiaValor(){return D(this,null,function*(){yield this.loadData(this.entity,this.form)})}onProcessoClick(i){let t=i;this.go.navigate({route:["gestao","cadeiaValor",this.cadeiaValor?.id,"objetivos",t.id]})}onObjetivoDeleteClick(i){let t=i}onObjetivoEditClick(i){let t=i}onDrop(i,t){console.log("Drop",i),t?.splice(typeof i.index>"u"?t.length:i.index,0,i.data)}onDragEnd(i){console.log("DragEnd",i)}onDragged(i,t,e){console.log("Dragged",i,t),t.splice(t.indexOf(i),1)}onDragStart(i){console.log("DragStart",i)}};a.\u0275fac=function(t){return new(t||a)(S(M))},a.\u0275cmp=I({type:a,selectors:[["cadeia-valor-mapa"]],viewQuery:function(t,e){if(t&1&&(y(A,5),y(ht,5),y(gt,5)),t&2){let o;V(o=w())&&(e.editableForm=o.first),V(o=w())&&(e.cadeiaValorInstitucional=o.first),V(o=w())&&(e.editProcessoForm=o.first)}},features:[T],decls:15,vars:9,consts:[["editProcessoForm",""],["cadeiaValorInstitucional",""],["innerProcessos",""],["noButtons","",3,"form"],[1,"row","my-2"],["controlName","cadeia_valor_id",3,"change","size","control","items"],[1,"row","my-2",3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"row","cadeia-valor"],[1,"nivel-1"],[1,"d-flex","justify-content-between"],[1,"card-text","placeholder-glow"],[1,"placeholder","col-2"],[1,"placeholder","col-4"],[1,"placeholder","col-6"],["class","row cadeia-valor","dndType","processo","dndEffectAllowed","move",3,"dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],[1,"row"],["icon","bi bi-textarea-t","controlName","nome",3,"size","label","control"],["dndType","processo","dndEffectAllowed","move",1,"row","cadeia-valor",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[1,"texto","text-break"],[1,"btn-group","dropstart","dropdown-menu-button","ms-2"],["noArrow","","icon","bi bi-wrench-adjustable-circle","color","transparent-black p-1 py-0",3,"data","items"],[1,"d-flex","align-content-stretch","flex-wrap",3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"nivel-2"],[1,"d-flex","justify-content-between","mb-2"],[1,"placeholder","col-5"],[1,"placeholder","col-7"],["class","nivel-2","dndType","processo","dndEffectAllowed","move",3,"style","dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],["dndType","processo","dndEffectAllowed","move",1,"nivel-2",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"dndDrop","dndDropzone"],["dndPlaceholderRef","",1,"nivel-3"],["class","nivel-3","dndType","processo","dndEffectAllowed","move",3,"style","dndDisableIf","dndDraggable","dndEnd","dndMoved","dndStart",4,"ngFor","ngForOf"],["dndType","processo","dndEffectAllowed","move",1,"nivel-3",3,"dndEnd","dndMoved","dndStart","dndDisableIf","dndDraggable"],[1,"btn-group","dropstart","dropdown-menu-button","ms-2","align-button"]],template:function(t,e){if(t&1){let o=O();h(0,vt,3,5,"ng-template",null,0,b),m(2,"editable-form",3)(3,"div",4)(4,"input-select",5,1),E("change",function(){return g(o),v(e.onCadeiaValorChange())}),c()()(),m(6,"div",6),E("dndDrop",function(u){return g(o),v(e.onDrop(u,e.processos))}),m(7,"div",7)(8,"div",8)(9,"div",9)(10,"p",10),f(11,"span",11)(12,"span",12)(13,"span",13),c()()()(),h(14,Vt,14,13,"div",14),c()}t&2&&(d(2),l("form",e.form),d(2),l("size",12)("control",e.form.controls.cadeia_valor_id)("items",e.cadeiasValor),d(2),l("dndDropzone",ee(8,ve)),d(2),Q("--border-color:gray;--bg:white;--color:black;"),d(6),l("ngForOf",e.processos))},dependencies:[we,De,A,j,Ie,Fe,Ae,Ne,Re],styles:['.cadeia-valor[_ngcontent-%COMP%]   .dropdown-menu[_ngcontent-%COMP%]{border:0;padding:0;background:none}.cadeia-valor[_ngcontent-%COMP%]   .dropdown-menu-button[_ngcontent-%COMP%]{margin-top:-5px}.cadeia-valor[_ngcontent-%COMP%]   .align-button[_ngcontent-%COMP%]{margin-top:-10px}.cadeia-valor[_ngcontent-%COMP%]   .texto[_ngcontent-%COMP%]{max-width:200px}.nivel-1[_ngcontent-%COMP%]{border:2px solid var(--border-color);padding:5px;background:var(--bg);position:relative;margin-bottom:15px;color:var(--color)}.nivel-1[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{text-align:center;font-size:18px}.nivel-1[_ngcontent-%COMP%]:after, .nivel-1[_ngcontent-%COMP%]:before{top:100%;left:95%;border:solid #fff;content:"";height:0;width:0;position:absolute;pointer-events:none}.nivel-1[_ngcontent-%COMP%]:after{border-width:20px;margin-left:-20px;border-color:#88b7d500;border-top-color:var(--bg)}.nivel-1[_ngcontent-%COMP%]:before{border-width:23px;margin-left:-23px;border-color:#c2e1f500;border-top-color:var(--border-color)}.nivel-2[_ngcontent-%COMP%]{position:relative;padding:10px;color:var(--color);background-color:var(--bg);margin-bottom:10px;margin-right:40px}.nivel-2[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:16px;text-align:center}.nivel-2[_ngcontent-%COMP%]:before, .nivel-2[_ngcontent-%COMP%]:after{width:20px;height:50%;position:absolute;left:100%;content:""}.nivel-2[_ngcontent-%COMP%]:before{top:0;background:linear-gradient(to right top,var(--bg) 50%,transparent 50%)}.nivel-2[_ngcontent-%COMP%]:after{top:50%;background:linear-gradient(to right bottom,var(--bg) 50%,transparent 50%)}.nivel-3[_ngcontent-%COMP%]{background-color:var(--bg);color:var(--color);padding:5px;margin-bottom:10px}.nivel-3[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:14px;font-weight:400;margin:0}.nivel-3[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-left:10px;margin-top:5px;padding:5px;font-size:13px;background-color:var(--bg);color:var(--color)}']});let n=a;return n})();function Dt(n,a){if(n&1&&f(0,"cadeia-valor-list-grid",5),n&2){let r=p();l("selectable",r.selectable)("snapshot",r.snapshot||r.modalRoute||r.route.snapshot)}}function Et(n,a){n&1&&f(0,"cadeia-valor-mapa")}function xt(n,a){if(n&1&&(m(0,"tab",6),h(1,Et,1,0,"ng-template",null,1,b),c()),n&2){let r=C(2);l("template",r)}}var $e=(()=>{let a=class a extends X{constructor(i){super(i,L,F),this.injector=i,this.filterWhere=t=>{let e=[],o=t.value;return e},this.code="MOD_CADV",this.title=this.lex.translate("Cadeias de Valores"),this.filter=this.fh.FormBuilder({})}ngAfterViewInit(){super.ngAfterViewInit(),this.tabs.active=["TABELA","MAPA"].includes(this.usuarioConfig.active_tab)?this.usuarioConfig.active_tab:"TABELA"}onSelectTab(i){return D(this,null,function*(){this.viewInit&&this.saveUsuarioConfig({active_tab:i.key})})}filterClear(i){i.controls.nome.setValue(""),super.filterClear(i)}};a.\u0275fac=function(t){return new(t||a)(S(M))},a.\u0275cmp=I({type:a,selectors:[["app-cadeia-valor-list"]],viewQuery:function(t,e){if(t&1&&(y(P,5),y(le,5)),t&2){let o;V(o=w())&&(e.grid=o.first),V(o=w())&&(e.tabs=o.first)}},features:[T],decls:5,vars:4,consts:[["grid",""],["mapa",""],["right","",3,"title","select"],["key","TABELA","icon","bi bi-table","label","Lista",3,"template"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template",4,"ngIf"],[3,"selectable","snapshot"],["key","MAPA","icon","bi bi-card-heading","label","Mapa",3,"template"]],template:function(t,e){if(t&1&&(m(0,"tabs",2)(1,"tab",3),h(2,Dt,1,2,"ng-template",null,0,b),c(),h(4,xt,3,1,"tab",4),c()),t&2){let o=C(3);l("title",e.isModal?"":e.title)("select",e.onSelectTab.bind(e)),d(),l("template",o),d(3),l("ngIf",!e.selectable)}},dependencies:[W,le,Oe,ce,Ue]});let n=a;return n})();var Pt=["processos"],It=["unidade"],me=(()=>{let a=class a extends Me{constructor(i){super(i,L,F),this.injector=i,this.validate=(t,e)=>{let o=null;return["nome","unidade_id"].indexOf(e)>=0&&!t.value?.length&&(o="Obrigat\xF3rio"),["data_inicio"].indexOf(e)>=0&&!this.dao?.validDateTime(t.value)&&(o="Inv\xE1lido"),e=="data_fim"&&t.value&&!this.dao?.validDateTime(t.value)&&(o="Inv\xE1lido"),o},this.formValidation=t=>{let e=null;return this.form.controls.data_fim.value&&this.form.controls.data_inicio.value>this.form.controls.data_fim.value?"A data do in\xEDcio n\xE3o pode ser maior que a data do fim!":e},this.titleEdit=t=>"Editando "+this.lex.translate("Cadeia de Valor")+": "+(t?.nome||""),this.unidadeDao=i.get(te),this.join=["processos"],this.form=this.fh.FormBuilder({nome:{default:""},data_inicio:{default:new Date},data_fim:{default:null},unidade_id:{default:""},moveFilhos:{default:!1}},this.cdRef,this.validate)}loadData(i,t){let e=Object.assign({},t.value);t.patchValue(this.util.fillForm(e,i))}initializeData(i){this.entity=new L,this.loadData(this.entity,i)}saveData(i){return D(this,null,function*(){return new Promise((t,e)=>{this.processos.grid.confirm();let o=this.util.fill(new L,this.entity);this.form.value.entidade_id=this.auth.entidade?.id,o=this.util.fillForm(o,this.form.value),o.processos=this.processos.items,t(o)})})}};a.\u0275fac=function(t){return new(t||a)(S(M))},a.\u0275cmp=I({type:a,selectors:[["app-cadeia-valor-form"]],viewQuery:function(t,e){if(t&1&&(y(A,5),y(Pt,5),y(It,5)),t&2){let o;V(o=w())&&(e.editableForm=o.first),V(o=w())&&(e.processos=o.first),V(o=w())&&(e.unidade=o.first)}},features:[T],decls:12,vars:17,consts:[["unidade",""],["processos",""],["initialFocus","nome",3,"submit","cancel","form","disabled","title"],[1,"row"],["icon","bi bi-textarea-t","controlName","nome","required","",3,"size","label","control"],["date","","label","In\xEDcio","icon","bi bi-calendar-date","controlName","data_inicio","required","",3,"size","control","labelInfo"],["date","","label","Fim","icon","bi bi-calendar-date","controlName","data_fim","required","",3,"size","control","labelInfo"],["controlName","unidade_id",3,"size","dao"],["noPersist","",3,"entity","cdRef"]],template:function(t,e){if(t&1){let o=O();m(0,"editable-form",2),E("submit",function(){return g(o),v(e.onSaveData())})("cancel",function(){return g(o),v(e.onCancel())}),m(1,"div",3)(2,"div",3),f(3,"input-text",4),c(),m(4,"div",3),f(5,"input-datetime",5)(6,"input-datetime",6)(7,"input-search",7,0),c()(),f(9,"separator")(10,"cadeia-valor-list-processos",8,1),c()}t&2&&(l("form",e.form)("disabled",e.formDisabled)("title",e.isModal?"":e.title),d(3),l("size",12)("label","Nome da "+e.lex.translate("cadeia de valor"))("control",e.form.controls.nome),q("maxlength",250),d(2),l("size",4)("control",e.form.controls.data_inicio)("labelInfo","In\xEDcio da "+e.lex.translate("cadeia de valor")),d(),l("size",4)("control",e.form.controls.data_fim)("labelInfo","Fim da "+e.lex.translate("cadeia de valor")),d(),l("size",4)("dao",e.unidadeDao),d(3),l("entity",e.entity)("cdRef",e.cdRef))},dependencies:[A,se,j,re,Se,de]});let n=a;return n})();function Mt(n,a){if(n&1&&(m(0,"h3",12),x(1),c()),n&2){let r=p();d(),N(r.title)}}function St(n,a){if(n&1&&f(0,"toolbar",13),n&2){let r=p();l("buttons",r.buttons)}}function Tt(n,a){if(n&1&&(m(0,"span",14),x(1),c()),n&2){let r=a.row,i=a.metadata,t=p();d(),N(t.getSequencia(i,r))}}function Ot(n,a){if(n&1&&(m(0,"span",14),x(1),c()),n&2){let r=a.row;d(),N(r.nome)}}var We=(()=>{let a=class a extends X{constructor(i){super(i,k,G),this.injector=i,this.buttons=[],this.filterWhere=t=>{let e=t.value,o=[];return e.planejamento_id?.length&&o.push(["cadeia_valor_id","==",e.cadeia_valor_id]),e.nome?.length&&o.push(["or",["nome","like","%"+e.nome.trim().replace(" ","%")+"%"],["sigla","like","%"+e.nome.trim().replace(" ","%")+"%"]]),o},this.cadeiaValorDao=i.get(F),this.cadeiaValorProcessoDao=i.get(G),this.title=this.lex.translate("Processos"),this.filter=this.fh.FormBuilder({nome:{default:""},cadeia_valor_id:{default:null}}),this.OPTION_INFORMACOES.onClick=t=>this.go.navigate({route:["gestao","cadeia-valor","processo",t.id,"consult"]},{modal:!0}),this.addOption(this.OPTION_INFORMACOES)}filterClear(i){super.filterClear(i)}getSequencia(i,t){if(!i.nivel){let e=t.processo_pai_id,o="";for(;e;){let s=this.grid?.items.find(u=>u.id==e);o=(s?.sequencia||"")+"."+o,e=s?.processo_pai_id||null}o+=t.sequencia,i.nivel!=o&&(i.nivel=o)}return this.sortProcessos(),i.nivel}sortProcessos(){this.grid?.items.sort((i,t)=>{let e=(this.grid.getMetadata(i)?.nivel||"").split(".").map(s=>("000"+s).substr(-3)).join("."),o=(this.grid.getMetadata(t)?.nivel||"").split(".").map(s=>("000"+s).substr(-3)).join(".");return e<o?-1:e>o?1:0})}};a.\u0275fac=function(t){return new(t||a)(S(M))},a.\u0275cmp=I({type:a,selectors:[["cadeia-valor-list-processos-entregas"]],viewQuery:function(t,e){if(t&1&&y(P,5),t&2){let o;V(o=w())&&(e.grid=o.first)}},features:[T],decls:15,vars:23,consts:[["columnNivel",""],["columnNome",""],["class","my-2",4,"ngIf"],[3,"select","dao","add","orderBy","groupBy","join","selectable"],[3,"buttons",4,"ngIf"],[3,"deleted","form","where","submit","clear","collapseChange","collapsed"],[1,"row"],["label","Nome","controlName","nome","placeholder","Nome",3,"size","control"],["title","N\xEDvel",3,"template"],["title","Nome","orderBy","nome",3,"template"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"my-2"],[3,"buttons"],[1,"d-block"]],template:function(t,e){if(t&1){let o=O();h(0,Mt,2,1,"h3",2),m(1,"grid",3),E("select",function(u){return g(o),v(e.onSelect(u))}),h(2,St,1,1,"toolbar",4),m(3,"filter",5)(4,"div",6),f(5,"input-text",7),c()(),m(6,"columns")(7,"column",8),h(8,Tt,2,1,"ng-template",null,0,b),c(),m(10,"column",9),h(11,Ot,2,1,"ng-template",null,1,b),c(),f(13,"column",10),c(),f(14,"pagination",11),c()}if(t&2){let o=C(9),s=C(12);l("ngIf",!e.isModal),d(),l("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("selectable",e.selectable),d(),l("ngIf",!e.selectable),d(),l("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("clear",e.filterClear.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",!e.selectable&&e.filterCollapsed),d(2),l("size",7)("control",e.filter.controls.nome),q("maxlength",250),d(2),l("template",o),d(3),l("template",s),d(3),l("onEdit",e.edit)("options",e.options),d(),l("rows",e.rowsLimit)}},dependencies:[W,P,K,J,oe,ie,ne,j]});let n=a;return n})();var Ft=[{path:"",component:$e,canActivate:[z],resolve:{config:U},runGuardsAndResolvers:"always",data:{title:"Cadeia de Valor"}},{path:"grid",component:ce,canActivate:[z],resolve:{config:U},data:{title:"Cadeia de Valor"}},{path:"new",component:me,canActivate:[z],resolve:{config:U},runGuardsAndResolvers:"always",data:{title:"Inclus\xE3o de Cadeia de Valor",modal:!0}},{path:":id/edit",component:me,canActivate:[z],resolve:{config:U},runGuardsAndResolvers:"always",data:{title:"Edi\xE7\xE3o de Cadeia de Valor",modal:!0}},{path:":id/consult",component:me,canActivate:[z],resolve:{config:U},runGuardsAndResolvers:"always",data:{title:"Consulta a Cadeia de Valor",modal:!0}},{path:"processoList",component:We,canActivate:[z],resolve:{config:U},runGuardsAndResolvers:"always",data:{title:"Lista de Processos da Cadeia de Valor",modal:!0}}],Je=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=Y({type:a}),a.\u0275inj=H({imports:[fe.forChild(Ft),fe]});let n=a;return n})();var io=(()=>{let a=class a{};a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=Y({type:a}),a.\u0275inj=H({imports:[Ee,qe,xe,Le,Je]});let n=a;return n})();export{io as a};
