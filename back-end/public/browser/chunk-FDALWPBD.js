import{a as Q}from"./chunk-7HV73OHS.js";import{a as pe}from"./chunk-UFS3OPCG.js";import{b as me}from"./chunk-76VPKZU2.js";import{a as x,b as I}from"./chunk-RMYSPY7H.js";import{b as k,fa as ue,n as se,s as G,w as ce,x as fe}from"./chunk-XHTD5OAS.js";import{b as re,c as z,d as V,e as le,h as de,s as b}from"./chunk-KODYKPWY.js";import"./chunk-ORJB5SCJ.js";import{Ab as ee,Bb as M,Bd as ne,Fa as m,Fb as te,Ga as p,Ha as f,Ic as oe,La as J,Ma as j,Na as h,O as Y,P as T,R as Z,U as S,Ua as D,V as O,Va as P,Wa as F,Xa as _,Ya as g,Z as X,Za as v,Zc as B,_ as $,_a as L,ba as A,h as U,ic as ie,ma as d,na as N,oc as K,pc as ae,sb as C,va as R,xa as c,ya as E,za as s}from"./chunk-6YMI2QVU.js";var W=class{constructor(t){t&&Object.assign(this,t)}};var y=class extends ae{constructor(t){super(),this.capacidades=[],this.nivel=0,this.nome="",this.descricao="",this.initialization(t)}};var he=(()=>{let t=class t{constructor(a){this.lookup=a}ordenarTiposCapacidade(a){return a.sort((n,e)=>{let o=n.codigo.toUpperCase(),r=e.codigo.toUpperCase();return o<r?-1:1})}};t.\u0275fac=function(n){return new(n||t)(Z(oe))},t.\u0275prov=Y({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();function De(i,t){if(i&1&&(m(0,"h3",16),g(1),p()),i&2){let l=h();d(),v(l.title)}}function Pe(i,t){if(i&1&&(m(0,"span",25),f(1,"i",26),g(2),p()),i&2){let l=h().row;d(2),L(" ",l.filhos==null?null:l.filhos.length,"")}}function Fe(i,t){if(i&1&&c(0,Pe,3,1,"span",24),i&2){let l=t.row;s("ngIf",l.filhos==null?null:l.filhos.length)}}function Ie(i,t){if(i&1){let l=J();m(0,"tr")(1,"td")(2,"div",29)(3,"span",30)(4,"small",31),f(5,"i",32),g(6),p(),f(7,"span",33),p()()(),m(8,"td")(9,"div",34)(10,"span",35),g(11),p()()(),m(12,"td",36)(13,"div",37)(14,"span",38)(15,"input-switch",39,6),j("change",function(){let n=X(l).$implicit,e=_(16),o=h(3);return $(o.onHabilitadoChangeFilha(n,e.value))}),p()()()()()}if(i&2){let l=t.$implicit,a=h(3);d(6),L(" ",l.codigo,""),d(5),v(l.descricao),d(4),s("size",1)("size",2)("disabled",a.action=="consult"?"true":void 0)("source",l)}}function Te(i,t){if(i&1&&(m(0,"table",27)(1,"tbody"),c(2,Ie,17,6,"tr",28),p()()),i&2){let l=t.row;d(2),s("ngForOf",l.filhos)}}function Se(i,t){if(i&1&&(m(0,"span",40)(1,"strong",41),g(2),p()()),i&2){let l=t.row;d(2),v(l.codigo)}}function Oe(i,t){if(i&1&&(m(0,"span",33),g(1),p()),i&2){let l=t.row;d(),L(" ",l.descricao,"")}}function Ae(i,t){if(i&1){let l=J();m(0,"input-switch",42,6),j("change",function(){let n=X(l).row,e=_(1),o=h(2);return $(o.onHabilitadoChange(n,e.value))}),p()}if(i&2){let l=t.row,a=h(2);s("disabled",a.action=="consult"?"true":void 0)("source",l)}}function Ne(i,t){if(i&1&&(m(0,"tab",17)(1,"grid",18,0)(3,"columns")(4,"column",19),c(5,Fe,1,1,"ng-template",null,1,C)(7,Te,3,1,"ng-template",20,2,C),p(),m(9,"column",21),c(10,Se,3,1,"ng-template",null,3,C),p(),m(12,"column",22),c(13,Oe,2,1,"ng-template",null,4,C),p(),m(15,"column",23),c(16,Ae,2,2,"ng-template",null,5,C),p()()()()),i&2){let l=_(6),a=_(8),n=_(11),e=_(14),o=_(17),r=h();s("label",r.lex.translate("Capacidades")),d(),s("items",r.tiposCapacidades)("scrollable",!0),d(3),s("align","center")("hint","Lista das capacidades com status m\xF3dulo")("template",l)("expandTemplate",a)("minWidth",50),d(5),s("template",n)("minWidth",160)("maxWidth",160),d(3),s("title",r.lex.translate("M\xF3dulo/Capacidade"))("template",e)("minWidth",600),d(3),s("template",o)}}var q=(()=>{let t=class t extends pe{constructor(a){super(a,y,B),this.injector=a,this.tiposCapacidades=[],this.validate=(n,e)=>{let o=null;return["nome","descricao"].indexOf(e)>=0&&!n.value?.length&&(o="Obrigat\xF3rio"),o},this.titleEdit=n=>"Editando "+this.lex.translate("Perfil")+": "+(n?.nome||""),this.tipoCapacidadeDao=a.get(ne),this.perfilService=a.get(he),this.form=this.fh.FormBuilder({nome:{default:""},capacidades:{default:[]},descricao:{default:""},nivel:{default:""},data_inicio:{default:""},data_fim:{default:""}},this.cdRef,this.validate),this.join=["capacidades.tipo_capacidade"]}loadData(a,n){return U(this,null,function*(){let e=Object.assign({},n.value);this.entity=a;var o=new W({where:[["grupo_id","==",null]],orderBy:[["codigo","asc"]],join:["filhos"]});yield this.tipoCapacidadeDao.query(o).asPromise().then(r=>{r.forEach(u=>{this.perfilService.ordenarTiposCapacidade(u.filhos),this.tiposCapacidades.push(u)})}),e=this.util.fillForm(e,a);for(let r of this.tiposCapacidades){let u=a.capacidades?.find(w=>w.tipo_capacidade?.codigo==r.codigo);r._metadata=Object.assign(r._metadata||{},{habilitado:!!u});for(let w of r.filhos){let Ce=a.capacidades?.find(be=>be.tipo_capacidade?.codigo==w.codigo);w._metadata=Object.assign(w._metadata||{},{habilitado:!!Ce})}}n.patchValue(e)})}onHabilitadoChange(a,n){let e=this.entity.capacidades?.find(o=>o.tipo_capacidade_id==a.id);if(n)e&&e._status=="DELETE"&&(e._status=void 0),e||this.entity.capacidades.push(new Q({tipo_capacidade_id:a.id,perfil_id:this.entity.id,_status:"ADD"}));else{e&&!e._status&&(e._status="DELETE"),e&&e._status=="ADD"&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(o=>o.tipo_capacidade_id==a.id),1);for(let o of a.filhos){o._metadata=Object.assign(o._metadata||{},{habilitado:!1});let r=this.entity.capacidades?.find(u=>u.tipo_capacidade_id==o.id);r&&!r._status&&(r._status="DELETE"),r&&r._status=="ADD"&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(u=>u.tipo_capacidade_id==o.id),1)}}this.refreshCapacidadesHabilitadas()}refreshCapacidadesHabilitadas(){return U(this,null,function*(){let a=Object.assign({},this.form.value);a=this.util.fillForm(a,this.entity),this.form.patchValue(a),this.cdRef.detectChanges()})}onHabilitadoChangeFilha(a,n){let e=this.entity.capacidades?.find(r=>r.tipo_capacidade_id==a.id),o=this.tiposCapacidades.find(r=>r.id==a.grupo_id);if(n){if(!o._metadata.habilitado){o._metadata=Object.assign(o._metadata||{},{habilitado:!0});let r=this.entity.capacidades?.find(u=>u.tipo_capacidade_id==o.id);r&&r._status=="DELETE"&&(r._status=void 0),r||this.entity.capacidades.push(new Q({tipo_capacidade_id:o.id,perfil_id:this.entity.id,_status:"ADD"}))}e&&e._status=="DELETE"&&(e._status=void 0),e||this.entity.capacidades.push(new Q({tipo_capacidade_id:a.id,perfil_id:this.entity.id,_status:"ADD"}))}else e&&!e._status&&(e._status="DELETE"),e&&e._status=="ADD"&&this.entity.capacidades.splice(this.entity.capacidades.findIndex(r=>r.tipo_capacidade_id==a.id),1);this.refreshCapacidadesHabilitadas()}initializeData(a){a.patchValue(new y)}saveData(a){return new Promise((n,e)=>{let o=this.util.fill(new y,this.entity);o=this.util.fillForm(o,this.form.value),o.capacidades=o.capacidades.filter(r=>["ADD","DELETE"].includes(r._status||"")),n(o)})}};t.\u0275fac=function(n){return new(n||t)(N(A))},t.\u0275cmp=S({type:t,selectors:[["app-perfil-form"]],viewQuery:function(n,e){if(n&1&&(D(G,5),D(b,5)),n&2){let o;P(o=F())&&(e.editableForm=o.first),P(o=F())&&(e.gridPai=o.first)}},features:[R],decls:10,vars:11,consts:[["gridPai",""],["columnCapacidades",""],["columnExpandedCapacidades",""],["columnCodCapacidade",""],["columnTipoCapacidade",""],["columnSelecionado",""],["habilitado",""],["class","my-2",4,"ngIf"],["initialFocus","nome",3,"submit","cancel","form","disabled"],["display","","right",""],["key","PRINCIPAL","label","Principal"],[1,"row"],["label","Nome","controlName","nome","required","",3,"size"],["numbers","","label","N\xEDvel","controlName","nivel",3,"size","disabled"],["label","Descri\xE7\xE3o","controlName","descricao","required","",3,"size"],["key","CAPACIDADES",3,"label",4,"ngIf"],[1,"my-2"],["key","CAPACIDADES",3,"label"],[3,"items","scrollable"],["type","expand","icon","bi bi-shield-lock",3,"align","hint","template","expandTemplate","minWidth"],[2,"justify-content","inherit"],["title","C\xF3digo","orderBy","codigo",3,"template","minWidth","maxWidth"],[3,"title","template","minWidth"],["title","Habilitado",3,"template"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-grid"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[2,"width","220px"],[1,"text-wrap","text-center"],[1,"micro-text","fw-light"],[1,"bi","bi-key"],[1,"badge","bg-light","text-dark"],[2,"width","450px"],[1,"badge","bg-light","text-dark","text-wrap"],[2,"text-align","right"],[2,"width","60px","margin-left","40px"],[1,"text-align"],["scale","medium","path","_metadata.habilitado",1,"text-align",2,"right","10px",3,"change","size","disabled","source"],[1,"text-wrap"],[1,"grid-group-text"],["path","_metadata.habilitado",2,"width","45px","margin-right","70px",3,"change","disabled","source"]],template:function(n,e){n&1&&(c(0,De,2,1,"h3",7),m(1,"editable-form",8),j("submit",function(){return e.onSaveData()})("cancel",function(){return e.onCancel()}),m(2,"tabs",9)(3,"tab",10)(4,"div",11),f(5,"input-text",12)(6,"input-text",13),p(),m(7,"div",11),f(8,"input-text",14),p()(),c(9,Ne,18,15,"tab",15),p()()),n&2&&(s("ngIf",!e.isModal),d(),s("form",e.form)("disabled",e.formDisabled),d(4),s("size",10),E("maxlength",250),d(),s("size",2)("disabled",e.entity?"disabled":void 0),E("maxlength",250),d(2),s("size",12),E("maxlength",250),d(),s("ngIf",e.auth.hasPermissionTo("MOD_TIPO_CAP")))},dependencies:[ee,M,b,V,z,G,se,k,fe,ce]});let i=t;return i})();function Re(i,t){if(i&1&&(m(0,"h3",11),g(1),p()),i&2){let l=h();d(),v(l.title)}}function je(i,t){if(i&1&&(m(0,"span"),g(1),p()),i&2){let l=t.row;d(),v(l.nivel)}}var _e=(()=>{let t=class t extends me{constructor(a){super(a,y,B),this.injector=a,this.options=[],this.filterWhere=n=>{let e=[],o=n.value;return o.nome?.length&&e.push(["nome","like","%"+o.nome.trim().replace(" ","%")+"%"]),e},this.title=this.lex.translate("Perfis"),this.code="MOD_CFG_PERFS",this.orderBy=[["nome","asc"]],this.filter=this.fh.FormBuilder({nome:{default:""}}),this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_EXCLUIR,"MOD_PERF_EXCL"),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}};t.\u0275fac=function(n){return new(n||t)(N(A))},t.\u0275cmp=S({type:t,selectors:[["app-perfil-list"]],viewQuery:function(n,e){if(n&1&&D(b,5),n&2){let o;P(o=F())&&(e.grid=o.first)}},features:[R],decls:14,vars:22,consts:[["columnNivel",""],["class","my-2",4,"ngIf"],[3,"dao","add","orderBy","groupBy","join","hasAdd","hasEdit"],[3,"deleted","form","where","submit","collapseChange","collapsed"],[1,"row"],["controlName","nome","placeholder","Nome...",3,"size","label","control"],["title","Nome","field","nome"],["title","Descri\xE7\xE3o","field","descricao"],["title","N\xEDvel de acesso",3,"template"],["type","options",3,"onEdit","options"],[3,"rows"],[1,"my-2"]],template:function(n,e){if(n&1&&(c(0,Re,2,1,"h3",1),m(1,"grid",2),f(2,"toolbar"),m(3,"filter",3)(4,"div",4),f(5,"input-text",5),p()(),m(6,"columns"),f(7,"column",6)(8,"column",7),m(9,"column",8),c(10,je,2,1,"ng-template",null,0,C),p(),f(12,"column",9),p(),f(13,"pagination",10),p()),n&2){let o=_(11);s("ngIf",!e.isModal),d(),s("dao",e.dao)("add",e.add)("orderBy",e.orderBy)("groupBy",e.groupBy)("join",e.join)("hasAdd",e.auth.hasPermissionTo("MOD_PERF_INCL"))("hasEdit",e.auth.hasPermissionTo("MOD_PERF_EDT")),d(2),s("deleted",e.auth.hasPermissionTo("MOD_AUDIT_DEL"))("form",e.filter)("where",e.filterWhere)("submit",e.filterSubmit.bind(e))("collapseChange",e.filterCollapseChange.bind(e))("collapsed",e.filterCollapsed),d(2),s("size",12)("label","Nome "+e.lex.translate("Perfil"))("control",e.filter.controls.nome),E("maxlength",250),d(4),s("template",o),d(3),s("onEdit",e.edit)("options",e.options),d(),s("rows",e.rowsLimit)}},dependencies:[M,b,V,z,le,re,de,k]});let i=t;return i})();var Le=[{path:"",component:_e,canActivate:[x],resolve:{config:I},runGuardsAndResolvers:"always",data:{title:"Perfils"}},{path:"new",component:q,canActivate:[x],resolve:{config:I},runGuardsAndResolvers:"always",data:{title:"Inclus\xE3o de Perfil",modal:!0}},{path:":id/edit",component:q,canActivate:[x],resolve:{config:I},runGuardsAndResolvers:"always",data:{title:"Edi\xE7\xE3o de Perfil",modal:!0}},{path:":perfil_id/capacidade",loadChildren:()=>import("./chunk-6YLG3US7.js").then(i=>i.CapacidadeModule),canActivate:[x]},{path:":id/consult",component:q,canActivate:[x],resolve:{config:I},runGuardsAndResolvers:"always",data:{title:"Consulta a Perfil",modal:!0}}],ge=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=O({type:t}),t.\u0275inj=T({imports:[K.forChild(Le),K]});let i=t;return i})();var Dt=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=O({type:t}),t.\u0275inj=T({imports:[te,ue,ie,ge]});let i=t;return i})();export{Dt as PerfilModule};
