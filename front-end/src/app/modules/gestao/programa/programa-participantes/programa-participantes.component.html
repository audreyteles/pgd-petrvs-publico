<grid multiselect [dao]="dao" [form]="form!" [title]="isModal ? '' : title" [orderBy]="orderBy" [groupBy]="groupBy"
    [join]="join" editable [add]="addParticipante.bind(this)" [load]="loadParticipante.bind(this)"
    [remove]="removeParticipante.bind(this)" [save]="saveParticipante.bind(this)" [selectable]="selectable"
    (select)="onSelect($event)" [hasAdd]="auth.hasPermissionTo('MOD_PRGT_PART_INCL')"
    [hasEdit]="auth.hasPermissionTo('MOD_PRGT_PART_EDT')" [hasDelete]="auth.hasPermissionTo('MOD_PRGT_PART_EXCL')"
    [multiselectMenu]="multiselectMenu">
    <toolbar *ngIf="!selectable">
        <input-switch [size]="3" labelPosition="left" label="Todos" controlName="todos" labelInfo="Se OFF, retorna apenas os usuários habilitados. Se ON, inclui também os não habilitados."
            [control]="filter!.controls.todos" (change)="grid!.reloadFilter()"></input-switch>
    </toolbar>
    <filter [deleted]="this.auth.hasPermissionTo('MOD_AUDIT_DEL')" [form]="filter" [where]="filterWhere"
        [submit]="filterSubmit.bind(this)" [collapseChange]="filterCollapseChange.bind(this)"
        [collapsed]="!selectable && filterCollapsed">
        <div class="row">
            <input-search #programaSearch [size]="12" [disabled]="isModal ? 'true' : undefined" controlName="programa_id" [control]="filter!.controls.programa_id" [dao]="programaDao" [where]="[['vigentesUnidadeExecutora', '==', auth.unidade!.id]]" [metadata]="{'vigentesUnidadeExecutora': true}" (change)="onProgramaChange()" required></input-search>
        </div>
        <div class="row">
            <input-text [size]="6" [label]="'Nome do '+ lex.translate('usuário')" controlName="nome_usuario" [control]="filter!.controls.nome_usuario"
                [placeholder]="'Nome do '+ lex.translate('usuario')+'...'" [attr.maxlength]=250></input-text>
            <input-search #unidade [size]="6" [control]="filter!.controls.unidade_id" controlName="unidade_id" [label]="lex.translate('Unidade ') + lex.translate('de lotação')"
                [dao]="unidadeDao"></input-search>
        </div>
    </filter>
    <columns>
        <column icon="bi-person" [align]="'center'" [template]="columnFoto" [editTemplate]="editFoto">
            <ng-template let-row="row" #columnFoto>
                <profile-picture [url]="row.usuario?.url_foto" [size]="40" [hint]="row.usuario?.nome"></profile-picture>
            </ng-template>
            <ng-template let-row="row" #editFoto>
                <profile-picture [url]="usuario?.selectedEntity?.url_foto" [size]="40"></profile-picture>
            </ng-template>
        </column>
        <column title="Usuário" [template]="columnUsuario" [editTemplate]="editUsuario">
            <ng-template let-row="row" #columnUsuario>
                <strong>{{row.usuario?.nome }}</strong><br>
                <small>{{row.usuario?.apelido }}</small>
                <!-- Pensar na possibilidade de por as lotacoes -->
            </ng-template>
            <ng-template let-row="row" #editUsuario>
                <input-search #usuario [size]="12" label icon [control]="form!.controls.usuario_id" [dao]="usuarioDao"
                    required></input-search>
            </ng-template>
        </column>
        <column title="Habilitado" [template]="columnHabilitado" [editTemplate]="editHabilitado">
            <ng-template let-row="row" #columnHabilitado>
                <i *ngIf="row.habilitado" class="bi bi-person-check"></i>
            </ng-template>
            <ng-template let-row="row" #editHabilitado>
                <input-switch [size]="12" #habilitado controlName="habilitado" [control]="form!.controls.habilitado"
                    (change)="onHabilitadoChange(row, habilitado.value)"></input-switch>
            </ng-template>
        </column>
        <column type="options"></column>
    </columns>
    <pagination [rows]="rowsLimit"></pagination>
</grid>