<editable-form [form]="form!" [disabled]="formDisabled" (submit)="onSaveData()" (cancel)="onCancel()">
    <tabs display right [title]="titleAtividade">
        <tab key="ATIVIDADE" label="Atividade">
            <documento-link [sei]="sei" [documento]="form!.controls.documento_requisicao.value"></documento-link>
            <div class="row">
                <input-textarea label="Descrição" [size]="12" [rows]="2" controlName="descricao" [control]="form!.controls.descricao"></input-textarea>
            </div>
            <div class="row">
                <input-search [label]="lex.noun('Unidade')" [size]="6" #unidade controlName="unidade_id" [dao]="unidadeDao"  (change)="onUnidadeChange($event)"></input-search>
                <input-search [label]="lex.noun('Tipo de atividade')" #tipoAtividade [emptyValue]="null" [size]="6" controlName="tipo_atividade_id"  [dao]="tipoAtividadeDao" (select)="onAtividadeSelect($event)" (change)="onAtividadeChange($event)" [labelInfo]="lex.noun('Tipo de atividade') + ' utilizado para classificar a atividade'"></input-search>
            </div>
            <div class="row">
                <input-search label="Responsável" [size]="4" [emptyValue]="null" #usuario controlName="usuario_id" [dao]="usuarioDao" [join]="usuarioJoin" labelInfo="Responsável pela execução" (select)="onUsuarioSelect($event)" (change)="onUsuarioChange($event)"></input-search>
                <input-select [label]="lex.noun('Plano de trabalho')" [size]="4" controlName="plano_trabalho_id" #planoTrabalho [control]="form!.controls.plano_trabalho_id" [items]="planosTrabalhos" (change)="onPlanoTrabalhoChange($event)" [labelInfo]="lex.noun('Plano de trabalho')"></input-select>
                <input-select [label]="lex.noun('Entrega') + lex.noun('plano de trabalho', false, true)" [size]="4" controlName="plano_trabalho_entrega_id" #entrega [control]="form!.controls.plano_trabalho_entrega_id" [items]="entregas" [labelInfo]="lex.noun('Entrega') + lex.noun('plano de trabalho', false, true) + ' que a ' + lex.noun('atividade') + ' é referente'"></input-select>
            </div>
            <div *ngIf="!planoTrabalho?.selectedItem?.entity?.tipo_modalidade?.atividade_esforco; else comEsforco" class="row">
                <input-datetime noIcon [size]="4" [label]="lex.noun('Data de distribuição')" controlName="data_distribuicao" [control]="form!.controls.data_distribuicao" (change)="onDataDistribuicaoChange($event)" labelInfo="Data de inclusão/distribuição/lançamento"></input-datetime>
                <input-number [size]="4" [decimals]="2" label="Progresso" disabled sufix="%" icon="bi bi-clock" controlName="progresso" labelInfo="Progresso de execução (% Concluído)"></input-number>
                <input-datetime noIcon  [size]="4" [label]="lex.noun('Prazo de entrega')" controlName="prazo_entrega" [control]="form!.controls.prazo_entrega" (change)="onPrazoEntregaChange($event)" labelInfo="Data estipulada para entrega da atividade"></input-datetime>
            </div>
            <ng-template #comEsforco>
                <div class="row">
                    <input-datetime noIcon [size]="3" [label]="lex.noun('Data de distribuição')" controlName="data_distribuicao" [control]="form!.controls.data_distribuicao" (change)="onDataDistribuicaoChange($event)" labelInfo="Data de inclusão/distribuição/lançamento"></input-datetime>
                    <input-timer [size]="3" [label]="lex.noun('Esforço')" icon="bi bi-stopwatch" onlyHours controlName="esforco" [control]="form!.controls.esforco" labelInfo="Tempo estimado de execução"></input-timer>
                    <input-number [size]="3" [decimals]="2" label="Progresso" disabled sufix="%" icon="bi bi-clock" controlName="progresso" labelInfo="Progresso de execução (% Concluído)"></input-number>
                    <input-datetime noIcon  [size]="3" [label]="lex.noun('Prazo de entrega')" controlName="prazo_entrega" [control]="form!.controls.prazo_entrega" (change)="onPrazoEntregaChange($event)" labelInfo="Data estipulada para entrega da atividade"></input-datetime>
                </div>
            </ng-template>
            <separator *ngIf="form!.controls.data_entrega.value" title="Conclusão">
                <div *ngIf="!planoTrabalho?.selectedItem?.entity?.tipo_modalidade?.atividade_tempo_despendido; else comTempoDespendido" class="row">
                    <input-datetime noIcon [size]="4" label="Inicio" controlName="data_inicio" [control]="form!.controls.data_inicio" disabled labelInfo="Data em que o usuário iniciou a atividade"></input-datetime>
                    <input-datetime noIcon [size]="4" label="Conclusão" controlName="data_entrega" [control]="form!.controls.data_entrega" disabled labelInfo="Data da conclusão da atividade"></input-datetime>
                    <input-datetime [size]="4" label="Data de arquivamento" controlName="data_arquivamento" [control]="form!.controls.data_inicio" disabled labelInfo="Data de arquivamento da atividade"></input-datetime>
                </div>
                <ng-template #comTempoDespendido>
                    <div class="row">
                        <input-datetime noIcon [size]="4" label="Inicio" controlName="data_inicio" [control]="form!.controls.data_inicio" disabled labelInfo="Data em que o usuário iniciou a atividade"></input-datetime>
                        <input-datetime noIcon [size]="4" label="Conclusão" controlName="data_entrega" [control]="form!.controls.data_entrega" disabled labelInfo="Data da conclusão da atividade"></input-datetime>
                        <input-timer [size]="4" label="Tempo despendido" icon="bi bi-hourglass-bottom" controlName="tempo_despendido" [control]="form!.controls.tempo_despendido" disabled labelInfo="Calculado no fim da atividade, sendo o tempo líquido (considerando pausas)"></input-timer>
                        <input-datetime [size]="4" label="Data de arquivamento" controlName="data_arquivamento" [control]="form!.controls.data_inicio" disabled labelInfo="Data de arquivamento da atividade"></input-datetime>
                    </div>
                </ng-template>
                <documento-link [documento]="form!.controls.documento_entrega.value"></documento-link>
            </separator>
        </tab>
        <tab key="TAREFAS" [label]="lex.noun('Tarefa', true) + ' ' + lex.noun('atividade', false, true)">
            <atividade-list-entrega [control]="form!.controls.tarefas" [atividade]="entity" [disabled]="formDisabled"></atividade-list-entrega>
        </tab>
        <tab key="CARACTERIZACAO" label="Caracterização">
            <div class="row">
                <input-multiselect label="Etiquetas" controlName="etiquetas" [size]="8" [control]="form!.controls.etiquetas" [addItemHandle]="addItemHandleEtiquetas.bind(this)">
                    <input-select [size]="12" #etiqueta controlName="etiqueta" [control]="form!.controls.etiqueta" [items]="etiquetas"></input-select>
                </input-multiselect>
                <div class="col-md-4">
                    <grid [control]="form!.controls.checklist" [form]="formChecklist" [hasAdd]="false" [hasDelete]="false" editable>
                        <columns>
                            <column type="switch" title="Check" field="checked"></column>
                            <column type="display" title="Texto" field="texto" [editable]="false"></column>
                            <column type="options"></column>
                        </columns>
                    </grid>
                </div>
            </div>
        </tab>
        <tab key="COMENTARIOS" label="Comentários">
            <div clss="row">
                <comentarios #comentarios origem="ATIVIDADE" [control]="form!.controls.comentarios"></comentarios>
            </div>
        </tab>
        <tab key="COMPLEMENTARES" label="Complementares">
            <div class="row">
                <input-search label="Demandante" [size]="12" controlName="demandante_id" [dao]="usuarioDao" disabled></input-search>
            </div>
            <div clss="row">
                <div class="card col-md-4 mt-4">
                    <h5 class="card-header">
                        <i class="bi bi-pause-circle"></i>
                        Suspensões/Pausas
                    </h5>
                    <div class="card-body">
                        <grid [control]="form!.controls.pausas" #pausas [hasEdit]="false" [hasDelete]="false" [minHeight]="0" disabled>
                            <columns>
                                <column title="Início" type="datetime" field="data_inicio"></column>
                                <column title="Fim" type="datetime" field="data_fim"></column>
                            </columns>
                        </grid>
                    </div>
                </div>
            </div>
        </tab>
    </tabs>
</editable-form>
